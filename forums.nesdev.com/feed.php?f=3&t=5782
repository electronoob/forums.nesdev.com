<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=5782" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2010-01-29T18:16:39-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=5782</id>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2010-01-29T18:16:39-07:00</updated>
<published>2010-01-29T18:16:39-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55962#p55962</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55962#p55962"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55962#p55962"><![CDATA[
Yeah, that's mine. And, fwiw, the CPU code is one big switch statement and (in my cycle-accurate PPU code, at least) I call the CPU code on <strong>every</strong> PPU cycle.  It runs with low enough CPU utilization that I didn't  bother implementing the catch-up method.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Fri Jan 29, 2010 6:16 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T17:39:17-07:00</updated>
<published>2010-01-29T17:39:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55961#p55961</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55961#p55961"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55961#p55961"><![CDATA[
Not that I'm planning parallel emulators, or maybe yes, the point is, a regular desktop PC you can find today on most homes, should have enough resources to emulate a NES regardless if the emulator has a jump table or not, has one or two switches, the code fits in the cache or not, etc.<br /><br />PS: James, yes I saw nemulator, and that menu is really great. Did you do it?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 5:39 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-01-29T14:05:34-07:00</updated>
<published>2010-01-29T14:05:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55948#p55948</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55948#p55948"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55948#p55948"><![CDATA[
<div class="quotetitle">Petruza wrote:</div><div class="quotecontent"><br />I guess with today computers<br /></div><br />Are you talking desktop, laptop, netbook, PSP/smartphone-class handheld, or DS-class handheld?<br /><br />And how many NES consoles did you plan on emulating at a time? Let's assume you're talking about a nemulator-style menu. A PS1 demo disc needs 12, and a Wii Menu needs 18: 12 for the channels fully on screen, 3 for the ones barely on the left side, and 3 for the ones barely on the right side. (Technically, the PS1 menu is a video and Wii channel banners are sprite animations, but still...)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Jan 29, 2010 2:05 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2010-01-29T14:32:02-07:00</updated>
<published>2010-01-29T14:01:53-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55946#p55946</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55946#p55946"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55946#p55946"><![CDATA[
<a href="http://www.youtube.com/watch?v=KgZx7JA8DZE" class="postlink">yes, even the least efficient emulator can  <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Fri Jan 29, 2010 2:01 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T13:52:02-07:00</updated>
<published>2010-01-29T13:52:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55944#p55944</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55944#p55944"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55944#p55944"><![CDATA[
Anyway, what speed improvements are we speaking of here?<br />I guess with today computers, even the least efficient emulator can handle many parallel virtual NESes running at 1.66 Mhz without problems, or am I wrong?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 1:52 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Tom]]></name></author>
<updated>2010-01-29T13:45:37-07:00</updated>
<published>2010-01-29T13:45:37-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55943#p55943</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55943#p55943"/>
<title type="html"><![CDATA[Re: Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55943#p55943"><![CDATA[
<div class="quotetitle">Disch wrote:</div><div class="quotecontent"><br />So I thought about it... and what if you made two separate switches... one for the addressing mode lookup, and another for the opcode execution?<br /></div><br /><br />A very long time ago I tried having two switches as you described in my emulator.  It was slower than one giant switch, which didn't use any fall through or goto tricks, just repeated code.  But I only ever ran it on a 300Mhz Powerbook G3.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=120">Tom</a> — Fri Jan 29, 2010 1:45 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T11:52:08-07:00</updated>
<published>2010-01-29T11:52:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55931#p55931</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55931#p55931"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55931#p55931"><![CDATA[
Yes, I like goto in this kind of low level programming too.<br />Unfortunately I plan to do a compiler and OS independent plain standard C++ code, at some speed expense maybe, but fully portable.<br />The main idea will be to make a 100% portable and reusable emulator core without the need of touching a single line of it. I.e. include, instantiate and run.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 11:52 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Mednafen]]></name></author>
<updated>2010-01-29T11:42:37-07:00</updated>
<published>2010-01-29T11:42:37-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55929#p55929</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55929#p55929"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55929#p55929"><![CDATA[
If you only care if your code is compilable on ICC and GCC, you can use goto tables:<br /><br />static void *const op_goto_table[256] =<br />{<br /> &amp;&amp;Op00, &amp;&amp;Op01, [etc]<br />};<br /><br />goto *op_goto_table[opcode];<br /><br />Op00: blahblahblah; goto Finish;<br /><br />Op01: vlahvlahvlah; goto Finish;<br /><br />Finish: ;<br /><br /><br />Long live goto! ;p<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1026">Mednafen</a> — Fri Jan 29, 2010 11:42 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T09:47:16-07:00</updated>
<published>2010-01-29T09:47:16-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55924#p55924</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55924#p55924"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55924#p55924"><![CDATA[
Haha thanks for the post fix, I fixed it in the original post.<br /><br />About the switch cache question, ok thanks. Anyway, as I've absolutely zero experience in emulator programming I'll go with the most straightforward approach comes to my mind, and once I get a working emulator, I'll test and see if it badly needs rewrites. (which will surely do)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 9:47 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-01-29T09:15:59-07:00</updated>
<published>2010-01-29T09:15:59-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55922#p55922</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55922#p55922"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55922#p55922"><![CDATA[
<div class="quotetitle">Petruza wrote:</div><div class="quotecontent"><br />The <strong>S</strong>NES is a 16 bit console made by Sony.<br /></div><br />There, fixed that for you. The SPC700 CPU and DSP are Sony parts.<br /><br />Now to your original question, which pertains to emulation of both the NES and Super NES: Modern x86 compilers and CPUs are so complex that the only real answer is to code it both ways, time both approaches, and optionally look at the generated assembly language code to understand the reasons behind the measured times. But yes, level 1 cache performance is one of the big reasons for a timestamp and catch-up approach compared to strict alternation of 3 PPU cycles and 1 CPU cycle like Nintendulator does.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Jan 29, 2010 9:15 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T09:06:12-07:00</updated>
<published>2010-01-29T09:06:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55921#p55921</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55921#p55921"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55921#p55921"><![CDATA[
LOL! I knew that if I posted a wrong statement as obvious as this, someone would reply <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br />Ok, now that I have your attention, don't you feel like reading my previous post and answering it?  <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 9:06 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2010-01-29T09:13:04-07:00</updated>
<published>2010-01-29T08:41:44-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55919#p55919</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55919#p55919"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55919#p55919"><![CDATA[
...<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Fri Jan 29, 2010 8:41 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-29T09:44:34-07:00</updated>
<published>2010-01-29T08:12:39-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55917#p55917</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55917#p55917"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55917#p55917"><![CDATA[
The <strong>S</strong>NES is a 16 bit console made by Sony.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Fri Jan 29, 2010 8:12 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Petruza]]></name></author>
<updated>2010-01-25T19:28:08-07:00</updated>
<published>2010-01-25T19:28:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55706#p55706</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55706#p55706"/>
<title type="html"><![CDATA[Re: Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=55706#p55706"><![CDATA[
<div class="quotetitle">Nessie wrote:</div><div class="quotecontent"><br />If you're thinking of performance, I would <em>guess</em> that if the total size of two switches is smaller than one switch, they could possibly run faster. The few cycles wasted on table lookup are probably insignificant as long as your code fits in the cache.<br /></div><br /><br />The only reason for a smaller code switch running faster is whether it fits in the cache or not?<br />Is there another reason?<br />Apart from caching, which I'm not very aware of, I understand that if the switch gets translated into a jump table, it doesn't matter if the code is longer or shorter, the jumps speed shouldn't be affected, or am I wrong?<br />I prefer speed and source readability rather than smaller executable code, for my emulator.<br /><br />And about the cache, I guess it's very platform-dependent, right?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3773">Petruza</a> — Mon Jan 25, 2010 7:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2009-12-04T16:35:34-07:00</updated>
<published>2009-12-04T16:35:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=53511#p53511</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=53511#p53511"/>
<title type="html"><![CDATA[Multiple switch for CPU emulation]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=5782&amp;p=53511#p53511"><![CDATA[
I guess my perspective is just distorted by trying to make C++-style interfaces (with RAII and the like) to a C library.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Dec 04, 2009 4:35 pm</p><hr />
]]></content>
</entry>
</feed>
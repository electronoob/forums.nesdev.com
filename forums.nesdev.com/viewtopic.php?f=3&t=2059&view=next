<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Speeding up my graphics routine</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Speeding up my graphics routine" href="http://forums.nesdev.com/feed.php?f=3&amp;t=2059" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=5585';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 3:48 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=5585">Speeding up my graphics routine</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=5585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=5585&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=5585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=5585&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=5585&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=5585&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=5585&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50784"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50784">Speeding up my graphics routine</a></div><div style="float: right;"><a href="./viewtopic.php?p=50784#p50784"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 9:19 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It seems that the demo mode for donkey does in fact come up but my graphics routine is apparently super super slow so it takes like a minute to get up.My graphics are probably like around 5 frames a second going by how slow donkey kong is moving.
<br />
<br />Don't know how I'm gonna make it faster but hey I've gotten this far eh.
<br />
<br />GlowCode, a profiler that I got is telling me that my graphics function is taking up 97% of the program time soooooo I think I know what to focus on here. 
<br />
<br />And 98% of my UpdateGraphics function is taken from within the function itself so it seems like the main culprit is stretch_blit(). Though I'm pretty sure the real problem is in my UpdateBackGround() function and how the Buffer BITMAP gets blitted.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void Video::UpdateGraphics&#40;&#41; &#123;<br /><br />&nbsp; &nbsp;UpdateBackGround&#40;&#41;; // Buffer comes from this function<br /><br />// just to show how many times this function got called<br />&nbsp; &nbsp;textprintf_centre_ex&#40;Buffer, font, 75, 0, makecol&#40;100,100,100&#41;, -1, &quot;Update Graphics: %i&quot;, count&#41;; <br />&nbsp; &nbsp;stretch_blit&#40;Buffer, screen, 0, 0, Buffer-&gt;w, Buffer-&gt;h, 0, 0, SCREEN_W, SCREEN_H&#41;;<br />&nbsp; &nbsp;count++;<br /><br />&#125;</div><br /><br />now here's my background graphics routine. Now don't laugh, this just might be the most newbie, unoptimized crap you've ever seen....<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void Video::UpdateBackGround&#40;&#41; &#123;<br /><br />&nbsp; &nbsp;<br />&nbsp; &nbsp;int NTval = 0;&nbsp; &nbsp;// The value of the current NameTable address<br />&nbsp; &nbsp;int PTaddr = 0; // Pattern table address<br />&nbsp; &nbsp;int ATaddr = 0; // The Attribute Table address<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;int PalleteVal = 0;<br />&nbsp; &nbsp;int COLOR = 0;&nbsp; &nbsp;// Current color of the pixel<br />&nbsp; &nbsp;int y = 0; // For use with the PutPixel function<br /><br />&nbsp; &nbsp;// For blitting the Pattern Table onto the Background buffer<br />&nbsp; &nbsp;int TileX = 0;<br />&nbsp; &nbsp;int TileY = 0;<br /><br />&nbsp; &nbsp;int NTstart = NameTableAddr;<br />&nbsp; &nbsp;int NTend = NameTableAddr + 0x3C0;<br /><br />&nbsp; &nbsp;int bit = 7; // used for getting the first 2 bits of Color Index<br /><br /><br />&nbsp; &nbsp;&nbsp; &nbsp;// MAKING OF THE BACKGROUND<br />&nbsp; &nbsp;&nbsp; &nbsp;// 1&#41; Find the current Name Table Value, Pattern Table address, Attribute Table address, and the current<br />&nbsp; &nbsp;&nbsp; &nbsp;//&nbsp; &nbsp; Attribute Table byte<br />&nbsp; &nbsp;&nbsp; &nbsp;// 2&#41; Assemble all the 16 bytes of Pattern Table values to make one tile<br />&nbsp; &nbsp;&nbsp; &nbsp;// 3&#41; Figure out first 2 bits for Color Index<br />&nbsp; &nbsp;&nbsp; &nbsp;// 4&#41; Minus the bit variable for the next loop<br />&nbsp; &nbsp;&nbsp; &nbsp;// 5&#41; Get last 2 bits from the Attribute Table. ATquadrant&#91;&#93; is a map used as a look-up table<br />&nbsp; &nbsp;&nbsp; &nbsp;//&nbsp; &nbsp; to see in which quadrant the Name Table byte is in<br />&nbsp; &nbsp;&nbsp; &nbsp;// 6&#41; Get the Pallete value determined by the ColorIndex number which points to where<br />&nbsp; &nbsp;&nbsp; &nbsp;//&nbsp; &nbsp; in the Pallete table that color is<br />&nbsp; &nbsp;&nbsp; &nbsp;// 7&#41; Find the color using the color from the int array look up table Color&#91;0x40&#93;<br />&nbsp; &nbsp;&nbsp; &nbsp;// 8&#41; Plot that one pixel in the appropriate spot in the PatternTable BITMAP<br />&nbsp; &nbsp;&nbsp; &nbsp;// 9&#41; Loop the x variable until the x coordinate reaches 8. Then up the y coordinate by one<br />&nbsp; &nbsp;&nbsp; &nbsp;// 10&#41; Loop the PTbyte until all pixels have filled the tile<br />&nbsp; &nbsp;&nbsp; &nbsp;// 11&#41; Now we have a Tile!<br />&nbsp; &nbsp;&nbsp; &nbsp;// 12&#41; blit that tile&#40;PatternTable&#41; onto the BGbuffer BITMAP&#40;256 x 240&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;// 13&#41; up the TileX coordinate by 8 to make room for the next tile<br />&nbsp; &nbsp;&nbsp; &nbsp;// 14&#41; Loop back up to the 'addr' for loop&#40;the very top loop&#41; and move on to the next tile<br />&nbsp; &nbsp;&nbsp; &nbsp;// 15&#41; rinse and repeat until all tiles are placed<br />&nbsp; &nbsp;&nbsp; &nbsp;// 16&#41; FINALY: blit the fully tiled BGbuffer BITMAP onto the Buffer BITMAP <br /><br />&nbsp; &nbsp;// Looping the current selected NameTable from beginning to end<br />&nbsp; &nbsp;for &#40;int addr = NTstart; addr &lt; NTend; addr++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;NTval = VideoMem-&gt;GetValue&#40;addr&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;PTaddr = &#40;NTval*0x10&#41; + ScreenPTA;<br />&nbsp; &nbsp;&nbsp; &nbsp;ATaddr = FindATaddr&#40;addr&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ATbyte = VideoMem-&gt;GetValue&#40;ATaddr&#41;;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;// Getting all the values needed to make one tile from the Pattern Table called<br />&nbsp; &nbsp;&nbsp; &nbsp;// from the value in the current Name Table byte.<br />&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int PToffset = 0; PToffset &lt; 16; PToffset++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;PTpixels&#91;PToffset&#93; = VideoMem-&gt;GetValue&#40;PTaddr+PToffset&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int PTbyte = 0; PTbyte &lt; 8; PTbyte++&#41; &#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int x = 0; x &lt; 8; x++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;0, PTpixels&#91;PTbyte&#93;.test&#40;bit&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;1, PTpixels&#91;PTbyte+8&#93;.test&#40;bit&#41;&#41;;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;bit--;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;bit &lt; 0&#41; bit = 7;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;switch&#40;ATquadrant&#91;addr&#93;&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 0: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;0&#41;&#41;; <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;1&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 1: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;2&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;3&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 2:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;4&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;5&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 3:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;6&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;7&#41;&#41;; break;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;switch&#40;ColorIndex.to_ulong&#40;&#41;&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 0: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F00&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 1: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F01&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 2: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F02&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 3: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F03&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 4: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F04&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 5: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F05&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 6: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F06&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 7: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F07&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 8: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F08&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 9: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F09&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 10: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0A&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 11: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0B&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 12: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0C&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 13: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0D&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 14: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0E&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 15: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0F&#41;; break;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int col = 0; col &lt; 0x40; col++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;PalleteVal == col&#41; &#123;COLOR = Color&#91;col&#93;; break;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;putpixel&#40;PatternTable, x, y, COLOR&#41;;<br /><br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;y++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;y == 8&#41; y = 0;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;stretch_blit&#40;PatternTable, BGbuffer, 0, 0, PatternTable-&gt;w, PatternTable-&gt;h, TileX, TileY, 8, 8&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;TileX += 8;<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;TileX == 256&#41; &#123;TileY += 8; TileX = 0;&#125;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;blit&#40;BGbuffer, Buffer, 0, 0, 0, 0, 256, 240&#41;;<br />&nbsp; &nbsp; <br /><br />&#125;</div>
<br />
<br />Anyone that's using allegro, please help me at least somewhat optimize this mess cause I really have no idea here sadly <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50787"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50787">Re: Speeding up my graphics routine</a></div><div style="float: right;"><a href="./viewtopic.php?p=50787#p50787"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 10:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 1079<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Undubbed wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">putpixel&#40;PatternTable, x, y, COLOR&#41;;<br /></div><br /></div>
<br />There's your biggest problem. Calling putpixel for every single pixel you're drawing -- not good, as putpixel will do a lot of unnecessary work like calculating the pixel position and so on. Instead retrieve a pointer to the bitmap contents and modify it manually. I'm not sure how to do this in Allegro but you probably have to "lock" the bitmap to get the pointer. Then to move in X direction you usually just do pointer++ and to move in Y direction pointer += width and so on.
<br />
<br />Good luck <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">hf3X-62PZhJDX-ADPYh81X-31Phg8X-97P^h53X-72P_1&lt;=)helloworld$</span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50789"></a>
				<b class="postauthor">MottZilla</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50789"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50789#p50789"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 11:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=1726.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Dec 06, 2006 8:18 pm<br /><b>Posts:</b> 1799
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">With Allegro there are "inline" versions of putpixel which are ALOT faster. However to use them you must know the color depth you are running in. Look them up in the allegro.txt file.
<br />
<br />Another thing you should think about is the PatternTables. In alot of games CHR-ROM is used meaning that Pattern Tables never change. Therefore it makes sense on ROM loading to convert the CHR-ROM into a faster to use format, some sort of cache. For CHR-RAM games you can still do this and it still makes sense but you have to keep track of when you need to update the tile's decoded/cached data because the game updated the pattern.
<br />
<br />Other than that it's just basic optimization to avoid doing unneeded calculations. The graphics part of your emulator will probably always take the majority of calculation time though so don't like that fool you. The CPU really shouldn't take that much. Maybe sound could compete with graphics but I doubt it.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=1726"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50791"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50791"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50791#p50791"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 12:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks guys I'll look into those for sure, but it turns out that a certain part of the code is causing the slowdown for some reason. 
<br />
<br />GlowCode shows it's a std::map that's taking about 80%+ of my UpdateBackground function. So I took this switch away just to see what happens. ATquadrant[] is the std::map btw. ATbyte and ColorIndex are std::bitset
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">switch&#40;ATquadrant&#91;addr&#93;&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 0: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;0&#41;&#41;; <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;1&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 1: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;2&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;3&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 2:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;4&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;5&#41;&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 3:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;2, ATbyte.test&#40;6&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex.set&#40;3, ATbyte.test&#40;7&#41;&#41;; break;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;</div>
<br />
<br />And it shot up SIGNIFICANTLY. But that's not saying much cause it's still kinda slow. probably 15 or 20 FPS I think.
<br />
<br />Seems like the problem is using a std::map as a lookup table.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50793"></a>
				<b class="postauthor">qeed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50793"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50793#p50793"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 12:18 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jun 17, 2008 11:51 am<br /><b>Posts:</b> 61
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">If you want the best speed, do away with the abstractions like std::map, std::bitset or whatever, and do manipulations by raw array/bitwise operation by hand. Casting char pointers to long or even long long pointers when copying will also help. How you do timing is also one of the biggest contributor to speed, like doing it cycle based run cpu one cycle, then run the ppu, that will be veryyyyy slow. Probably using the catch up timing method is one of the best speedups I can recommend, if you are not doing that already. Also, take a look into decoding the chr rom before hand or decoding the chr ram upon writes to the pattern tables, since drawing takes place alot more often then updating, that way you dont have to decode everything again.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3551"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50794"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50794"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50794#p50794"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 12:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 1079<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The obvious optimization that comes to mind is moving the switch() above this loop which should work because "addr" doesn't change in the loop.
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; for &#40;int PTbyte = 0; PTbyte &lt; 8; PTbyte++&#41; &#123; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for &#40;int x = 0; x &lt; 8; x++&#41; &#123; </div></div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">hf3X-62PZhJDX-ADPYh81X-31Phg8X-97P^h53X-72P_1&lt;=)helloworld$</span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50795"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50795"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50795#p50795"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 12:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">The obvious optimization that comes to mind is moving the switch() above this loop which should work because "addr" doesn't change in the loop.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; for &#40;int PTbyte = 0; PTbyte &lt; 8; PTbyte++&#41; &#123; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for &#40;int x = 0; x &lt; 8; x++&#41; &#123; </div></div>
<br />
<br />WHOA! Holy crap, you're right! FPS shot up quite a bit cause of that.
<br />
<br />And I'll certainly be trying to find a different way than using the abstractions.
<br />
<br />Man, what would I do without you guys?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50798"></a>
				<b class="postauthor">MottZilla</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50798"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50798#p50798"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 2:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=1726.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Dec 06, 2006 8:18 pm<br /><b>Posts:</b> 1799
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">qeed wrote:</div><div class="quotecontent">How you do timing is also one of the biggest contributor to speed, like doing it cycle based run cpu one cycle, then run the ppu, that will be veryyyyy slow. Probably using the catch up timing method is one of the best speedups I can recommend, if you are not doing that already. </div>
<br />
<br />"Very slow" is subjective. On any half decent PC system there is no reason not to do this or even more accurate timing. Really on any modern system (say 2ghz) you should be able to handle running a cpu cycle then ppu cycles to catch up. The whole catch up method you mention is probably better but as I recall the main benefit or rather the drawback to doing cpu cycle then puu cycle is on older CPUs cache was small and access to RAM was quite slow. Nowdays caches are much bigger, RAM is much faster. 
<br />
<br />All I'm saying is that this approach is not really that slow at all. It was the method I used and it never performed slow on any of my PCs I tried it on except for a Pentium 266mhz laptop I tried it on for amusement.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=1726"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50799"></a>
				<b class="postauthor">qeed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50799"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50799#p50799"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 3:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jun 17, 2008 11:51 am<br /><b>Posts:</b> 61
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I should've said slow relative on other timing methods. Sorry if I wasn't clear. Yeah, per cycle isn't that bad of an option anymore, i get ~200 fps here with a cycle based emu 2.0 ghz pentium core, though it can probably be alot more if I used a properly optimized emu, ie, not mine <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3551"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50801"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50801"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50801#p50801"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 4:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9047<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">Really on any modern system (say 2ghz) you should be able to handle running a cpu cycle then ppu cycles to catch up.</div><br />At that point, the bottleneck becomes switching among 12 threads, each <a href="http://www.youtube.com/watch?v=KgZx7JA8DZE" class="postlink">emulating an NES in a file chooser</a> reminiscent of <a href="http://www.youtube.com/watch?v=uNuLr58YE4c&amp;feature=related" class="postlink">old PS1 demo discs</a> or the Wii Menu. Or between your NES and your post-processing filter (e.g. hq3x or TV emulation). Or between your NES and your video encoder if you're recording in DivX (.avi) or Theora (.ogg) format.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The whole catch up method you mention is probably better but as I recall the main benefit or rather the drawback to doing cpu cycle then puu cycle is on older CPUs cache was small and access to RAM was quite slow. Nowdays caches are much bigger</div>
<br />Register files on x86 are still small: ax bx cx dx si di bp sp, unless you go for a 64-bit executable.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50803"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50803"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50803#p50803"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2009 7:38 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 1050<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Register files on x86 are still small: ax bx cx dx si di bp sp, unless you go for a 64-bit executable.</div>
<br />
<br />Err, what?  <!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/X86#32-bit">http://en.wikipedia.org/wiki/X86#32-bit</a><!-- m --></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50813"></a>
				<b class="postauthor">Mednafen</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50813"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50813#p50813"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 23, 2009 3:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Sep 13, 2006 12:45 pm<br /><b>Posts:</b> 40
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Regarding qeed's suggestion of typecasting a single-byte pointer to a multi-byte pointer and dereferencing it for faster memory access, you need to be aware of alignment.  x86 handles misaligned multi-byte memory access in hardware with a reasonable performance penalty, but some other architectures like SPARC(like you care about that ;b) and ARM(maybe newer support it?) do not(at all, or with good performance).  malloc(), calloc(), new, and new[] should return memory aligned to the greatest multi-byte unit addressable by the CPU(ignoring some larger FP types on some archs, and SIMD types), unless your compiler or libc is doing something stupid, and refer to your compiler's manual for directives to align variables themselves.
<br />
<br />Also, using generic C types: long(especially long, considering differences in certain 64-bit ABIs...)/int(relatively safe, unless you're compiling with 16-bit DOS compilers)/short/char(char's generally safe, if you always explicitly define signedness, such as "signed char" and "unsigned char") can be unsafe in practice(I won't bring up really arcane architectures that will warp your mind).  I prefer using uint32_t, int16_t, int8_t, uint8_t, etc. as defined in the header file inttypes.h(though older versions of MSVC are missing it IIRC).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=1026"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p50818"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50818"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50818#p50818"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 23, 2009 5:29 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9047<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Register files on x86 are still small: ax bx cx dx si di bp sp, unless you go for a 64-bit executable.</div><br />Err, what?  <!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/X86#32-bit">http://en.wikipedia.org/wiki/X86#32-bit</a><!-- m --></div>
<br />So I forgot the 'E' in front of each name. Forgive me; all the asm I do is for 6502 and occasionally ARM. But my point is that x86 doesn't have R8 through R15 of x86-64.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p50896"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p50896"></a></div><div style="float: right;"><a href="./viewtopic.php?p=50896#p50896"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 29, 2009 4:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm sure a lot of the techniques I used from you guys made it faster, but it was still slow. Then I just found out that running the program under debugging makes the program much slower :/. So I tried using the EXE outside the IDE and now it's running at more than perfect speed <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> I feel like such a n00b sometimes.
<br />
<br />Updated routine just for closure:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void Video::UpdateBackGround&#40;&#41; &#123;<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;int NTval = 0;&nbsp; &nbsp;// The value of the current NameTable address<br />&nbsp; &nbsp;int PTaddr = 0; // Pattern table address<br />&nbsp; &nbsp;int ATaddr = 0; // The Attribute Table address<br />&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; unsigned int PalleteVal = 0;<br />&nbsp; &nbsp;int COLOR = 0;&nbsp; &nbsp;// Current color of the pixel<br />&nbsp; &nbsp;int y = 0; // For use with the PutPixel function<br /><br />&nbsp; &nbsp;// For blitting the Pattern Table onto the Background buffer<br />&nbsp; &nbsp;int TileX = 0;<br />&nbsp; &nbsp;int TileY = 0;<br /><br />&nbsp; &nbsp;int NTstart = NameTableAddr;<br />&nbsp; &nbsp;int NTend = NameTableAddr + 0x3C0;<br /><br />&nbsp; &nbsp;int bit = 0x80; // used for getting the first 2 bits of Color Index<br /><br />&nbsp; &nbsp;// Looping the current selected NameTable from beginning to end<br />&nbsp; &nbsp;for &#40;int addr = NTstart; addr &lt; NTend; addr++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;NTval = VideoMem-&gt;GetValue&#40;addr&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ATaddr = FindATaddr&#40;addr&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ATbyte = VideoMem-&gt;GetValue&#40;ATaddr&#41;;<br /><br />&nbsp; &nbsp; &nbsp; // preventing tiles from being needlessly rendered<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;NTval == NTchange&#91;addr - NTstart&#93;&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;ATbyte == ATchange&#91;ATaddr - NTend&#93;&#41; &#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;TileX += 8;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;TileX == 256&#41; &#123;TileY += 8; TileX = 0;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;continue;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else ATchange&#91;ATaddr - NTend&#93; = ATbyte;<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;else &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;NTchange&#91;addr-NTstart&#93; = NTval;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;ATbyte != ATchange&#91;ATaddr-NTend&#93;&#41; ATchange&#91;ATaddr - NTend&#93; = ATbyte;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;PTaddr = &#40;&#40;NTval*0x10&#41; + ScreenPTA&#41; &gt;&gt; 4;<br />&nbsp; &nbsp;&nbsp; &nbsp;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;switch&#40;ATquadrant&#91;addr&#93;&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 0: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x01 ? ColorIndex | 0x04 : ColorIndex &amp; &#40;~0x04&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x02 ? ColorIndex | 0x08 : ColorIndex &amp; &#40;~0x08&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 1: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x04 ? ColorIndex | 0x04 : ColorIndex &amp; &#40;~0x04&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x08 ? ColorIndex | 0x08 : ColorIndex &amp; &#40;~0x08&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 2:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x10 ? ColorIndex | 0x04 : ColorIndex &amp; &#40;~0x04&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x20 ? ColorIndex | 0x08 : ColorIndex &amp; &#40;~0x08&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 3:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x40 ? ColorIndex | 0x04 : ColorIndex &amp; &#40;~0x04&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = ATbyte &amp; 0x80 ? ColorIndex | 0x08 : ColorIndex &amp; &#40;~0x08&#41;; break;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int PTbyte = 0; PTbyte &lt; 8; PTbyte++&#41; &#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int x = 0; x &lt; 8; x++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = PatternTable&#91;PTaddr&#93;&#91;PTbyte&#93; &amp; bit ? ColorIndex | 0x01 : ColorIndex &amp; &#40;~0x01&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ColorIndex = PatternTable&#91;PTaddr&#93;&#91;PTbyte+8&#93; &amp; bit ? ColorIndex | 0x02 : ColorIndex &amp; &#40;~0x02&#41;;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;bit &gt;&gt;= 1; // bit/2<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;bit &lt; 1&#41; bit = 0x80;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;switch&#40;ColorIndex&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 0: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F00&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 1: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F01&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 2: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F02&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 3: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F03&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 4: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F04&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 5: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F05&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 6: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F06&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 7: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F07&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 8: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F08&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 9: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F09&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 10: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0A&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 11: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0B&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 12: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0C&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 13: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0D&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 14: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0E&#41;; break;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case 15: PalleteVal = VideoMem-&gt;GetValue&#40;0x3F0F&#41;; break;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int col = 0; col &lt; 0x40; col++&#41; &#123;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;PalleteVal == col&#41; &#123;COLOR = Color&#91;col&#93;; break;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;_putpixel16&#40;PTbmp, x, y, COLOR&#41;;<br /><br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;y++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;y == 8&#41; y = 0;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;stretch_blit&#40;PTbmp, BGbuffer, 0, 0, PTbmp-&gt;w, PTbmp-&gt;h, TileX, TileY, 8, 8&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;TileX += 8;<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;TileX == 256&#41; &#123;TileY += 8; TileX = 0;&#125;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;blit&#40;BGbuffer, Buffer, 0, 0, 0, 0, 256, 240&#41;;<br />&nbsp; &nbsp; <br /><br />&#125;</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p61717"></a>
				<b class="postauthor">ehguacho</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p61717"></a></div><div style="float: right;"><a href="./viewtopic.php?p=61717#p61717"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 21, 2010 5:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4281.jpg" width="84" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Mar 09, 2010 11:12 pm<br /><b>Posts:</b> 82<br /><b>Location:</b> Rosario, Argentina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">thanks Undubbed for your routine. hope it'll helpful for me!</div>

					
						<div class="postbody"><br />_________________<br />sorry about my english, i'm from argentina...
<br />
<br /><a href="http://nestate.uuuq.com" class="postlink">http://nestate.uuuq.com</a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4281"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=5585"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=5585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=5585&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=5585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=5585&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="5585" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
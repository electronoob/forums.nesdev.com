<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - SPC700 instruction cycle breakdown</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - SPC700 instruction cycle breakdown" href="http://forums.nesdev.com/feed.php?f=12&amp;t=16140" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '3');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php?sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php?sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun Oct 29, 2017 4:16 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=6b29b70e018c902f49d4ab4f04ead6b6">Board index</a> &#187; <a href="./viewforum.php?f=25&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Other</a> &#187; <a href="./viewforum.php?f=23&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />

	<div class="forumrules">
		
			<h3>Forum rules</h3><br />
			Related:<br /><ul><li>For making cartridges of your Super NES games, see <a href="http://forums.nesdev.com/viewforum.php?f=28" class="postlink">Reproduction</a>.</li></ul>
		
	</div>

	<br clear="all" />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=16140&amp;start=30&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">SPC700 instruction cycle breakdown</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>6</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 86 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=75">6</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=16140&amp;start=30&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=16140&amp;view=previous&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=16140&amp;view=next&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199273"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199273">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199273&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199273"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 8:31 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1338
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Perfect, thank you. Sorry to be so pedantic, but thanks for your patience.<br /><br />Here's the updated code, which passes hex_usr's and Revenant's test ROMs:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">alwaysinline auto SMP::readRAM(uint16 addr) -&gt; uint8 {<br />&nbsp; if(addr &gt;= 0xffc0 &amp;&amp; io.iplromEnable) return iplrom&#91;addr &amp; 0x3f&#93;;<br />&nbsp; if(io.ramDisable) return 0x5a;&nbsp; //0xff on mini-SNES<br />&nbsp; return apuram&#91;addr&#93;;<br />}<br /><br />alwaysinline auto SMP::writeRAM(uint16 addr, uint8 data) -&gt; void {<br />&nbsp; //writes to $ffc0-$ffff always go to apuram, even if the iplrom is enabled<br />&nbsp; if(io.ramWritable &amp;&amp; !io.ramDisable) apuram&#91;addr&#93; = data;<br />}<br /><br />auto SMP::readPort(uint2 port) const -&gt; uint8 {<br />&nbsp; return io.port&#91;port&#93;;<br />}<br /><br />auto SMP::writePort(uint2 port, uint8 data) -&gt; void {<br />&nbsp; io.port&#91;port&#93; = data;<br />}<br /><br />auto SMP::readBus(uint16 addr) -&gt; uint8 {<br />&nbsp; uint result;<br /><br />&nbsp; switch(addr) {<br />&nbsp; case 0xf0:&nbsp; //TEST -- write-only register<br />&nbsp; &nbsp; return 0x00;<br /><br />&nbsp; case 0xf1:&nbsp; //CONTROL -- write-only register<br />&nbsp; &nbsp; return 0x00;<br /><br />&nbsp; case 0xf2:&nbsp; //DSPADDR<br />&nbsp; &nbsp; return io.dspAddr;<br /><br />&nbsp; case 0xf3:&nbsp; //DSPDATA<br />&nbsp; &nbsp; //0x80-0xff are read-only mirrors of 0x00-0x7f<br />&nbsp; &nbsp; return dsp.read(io.dspAddr &amp; 0x7f);<br /><br />&nbsp; case 0xf4:&nbsp; //CPUIO0<br />&nbsp; case 0xf5:&nbsp; //CPUIO1<br />&nbsp; case 0xf6:&nbsp; //CPUIO2<br />&nbsp; case 0xf7:&nbsp; //CPUIO3<br />&nbsp; &nbsp; synchronize(cpu);<br />&nbsp; &nbsp; return cpu.readPort(addr);<br /><br />&nbsp; case 0xf8:&nbsp; //RAM0<br />&nbsp; &nbsp; return io.ram00f8;<br /><br />&nbsp; case 0xf9:&nbsp; //RAM1<br />&nbsp; &nbsp; return io.ram00f9;<br /><br />&nbsp; case 0xfa:&nbsp; //T0TARGET<br />&nbsp; case 0xfb:&nbsp; //T1TARGET<br />&nbsp; case 0xfc:&nbsp; //T2TARGET -- write-only registers<br />&nbsp; &nbsp; return 0x00;<br /><br />&nbsp; case 0xfd:&nbsp; //T0OUT -- 4-bit counter value<br />&nbsp; &nbsp; result = timer0.stage3;<br />&nbsp; &nbsp; timer0.stage3 = 0;<br />&nbsp; &nbsp; return result;<br /><br />&nbsp; case 0xfe:&nbsp; //T1OUT -- 4-bit counter value<br />&nbsp; &nbsp; result = timer1.stage3;<br />&nbsp; &nbsp; timer1.stage3 = 0;<br />&nbsp; &nbsp; return result;<br /><br />&nbsp; case 0xff:&nbsp; //T2OUT -- 4-bit counter value<br />&nbsp; &nbsp; result = timer2.stage3;<br />&nbsp; &nbsp; timer2.stage3 = 0;<br />&nbsp; &nbsp; return result;<br />&nbsp; }<br /><br />&nbsp; return readRAM(addr);<br />}<br /><br />auto SMP::writeBus(uint16 addr, uint8 data) -&gt; void {<br />&nbsp; switch(addr) {<br />&nbsp; case 0xf0:&nbsp; //TEST<br />&nbsp; &nbsp; if(r.p.p) break;&nbsp; //writes only valid when P flag is clear<br /><br />&nbsp; &nbsp; io.clockSpeed&nbsp; &nbsp; = (data &gt;&gt; 6) &amp; 3;<br />&nbsp; &nbsp; io.timerSpeed&nbsp; &nbsp; = (data &gt;&gt; 4) &amp; 3;<br />&nbsp; &nbsp; io.timersEnable&nbsp; = data &amp; 0x08;<br />&nbsp; &nbsp; io.ramDisable&nbsp; &nbsp; = data &amp; 0x04;<br />&nbsp; &nbsp; io.ramWritable&nbsp; &nbsp;= data &amp; 0x02;<br />&nbsp; &nbsp; io.timersDisable = data &amp; 0x01;<br /><br />&nbsp; &nbsp; io.timerStep = (1 &lt;&lt; io.clockSpeed) + (2 &lt;&lt; io.timerSpeed);<br /><br />&nbsp; &nbsp; timer0.synchronizeStage1();<br />&nbsp; &nbsp; timer1.synchronizeStage1();<br />&nbsp; &nbsp; timer2.synchronizeStage1();<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf1:&nbsp; //CONTROL<br />&nbsp; &nbsp; io.iplromEnable = data &amp; 0x80;<br /><br />&nbsp; &nbsp; if(data &amp; 0x30) {<br />&nbsp; &nbsp; &nbsp; //one-time clearing of APU port read registers,<br />&nbsp; &nbsp; &nbsp; //emulated by simulating CPU writes of 0x00<br />&nbsp; &nbsp; &nbsp; synchronize(cpu);<br />&nbsp; &nbsp; &nbsp; if(data &amp; 0x20) {<br />&nbsp; &nbsp; &nbsp; &nbsp; cpu.writePort(2, 0x00);<br />&nbsp; &nbsp; &nbsp; &nbsp; cpu.writePort(3, 0x00);<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; if(data &amp; 0x10) {<br />&nbsp; &nbsp; &nbsp; &nbsp; cpu.writePort(0, 0x00);<br />&nbsp; &nbsp; &nbsp; &nbsp; cpu.writePort(1, 0x00);<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; //0-&gt;1 transistion resets timers<br />&nbsp; &nbsp; if(!timer2.enable &amp;&amp; (data &amp; 0x04)) {<br />&nbsp; &nbsp; &nbsp; timer2.stage2 = 0;<br />&nbsp; &nbsp; &nbsp; timer2.stage3 = 0;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; timer2.enable = data &amp; 0x04;<br /><br />&nbsp; &nbsp; if(!timer1.enable &amp;&amp; (data &amp; 0x02)) {<br />&nbsp; &nbsp; &nbsp; timer1.stage2 = 0;<br />&nbsp; &nbsp; &nbsp; timer1.stage3 = 0;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; timer1.enable = data &amp; 0x02;<br /><br />&nbsp; &nbsp; if(!timer0.enable &amp;&amp; (data &amp; 0x01)) {<br />&nbsp; &nbsp; &nbsp; timer0.stage2 = 0;<br />&nbsp; &nbsp; &nbsp; timer0.stage3 = 0;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; timer0.enable = data &amp; 0x01;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf2:&nbsp; //DSPADDR<br />&nbsp; &nbsp; io.dspAddr = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf3:&nbsp; //DSPDATA<br />&nbsp; &nbsp; if(io.dspAddr &amp; 0x80) break;&nbsp; //0x80-0xff are read-only mirrors of 0x00-0x7f<br />&nbsp; &nbsp; dsp.write(io.dspAddr &amp; 0x7f, data);<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf4:&nbsp; //CPUIO0<br />&nbsp; case 0xf5:&nbsp; //CPUIO1<br />&nbsp; case 0xf6:&nbsp; //CPUIO2<br />&nbsp; case 0xf7:&nbsp; //CPUIO3<br />&nbsp; &nbsp; synchronize(cpu);<br />&nbsp; &nbsp; writePort(addr, data);<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf8:&nbsp; //RAM0<br />&nbsp; &nbsp; io.ram00f8 = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xf9:&nbsp; //RAM1<br />&nbsp; &nbsp; io.ram00f9 = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xfa:&nbsp; //T0TARGET<br />&nbsp; &nbsp; timer0.target = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xfb:&nbsp; //T1TARGET<br />&nbsp; &nbsp; timer1.target = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xfc:&nbsp; //T2TARGET<br />&nbsp; &nbsp; timer2.target = data;<br />&nbsp; &nbsp; break;<br /><br />&nbsp; case 0xfd:&nbsp; //T0OUT<br />&nbsp; case 0xfe:&nbsp; //T1OUT<br />&nbsp; case 0xff:&nbsp; //T2OUT -- read-only registers<br />&nbsp; &nbsp; break;<br />&nbsp; }<br /><br />&nbsp; writeRAM(addr, data);&nbsp; //all writes, even to MMIO registers, appear on bus<br />}</div><br /><br />Please ignore that all eight registers are most likely inside the SMP core. I'm aware of that.<br /><br />CPU writes to $214x go to a CPU-side 4x8-bit array, CPU reads come from the SMP-side 4x8-bit array.<br />SMP writes to $f4-f7 go to an SMP-side 4x8-bit array, SMP reads come from the CPU-side 4x8-bit array.<br />SMP writes to $f1 can write to the CPU-side 4x8-bit array (which is why all eight bytes are physically in the SMP.)<br />SMP writes to $f4-f7 will also modify the internal APU RAM that the DSP can then read back.<br />DSP reads from $f4-f7 are from underlying APU RAM, DSP writes to $f4-f7 are to underlying APU RAM.<br /><br />...<br /><br />Also, I added emulation of the glitch with mov (x)+ modes. I'm pretty confident writes are correct, but we still need to create test ROMs to narrow down the true behavior of reads.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=375&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">byuu</a> on Thu Jun 29, 2017 10:55 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199275"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199275">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199275&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199275"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 8:53 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">That all looks right to me.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199285"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199285">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199285&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199285"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 10:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 330<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Shoot, I was going to post that hex_usr just made the same demo last night, but was too tired. Still, thank you for the extra test to confirm!</div><br /><br />Damn, that's what I get for not checking your forum as often as this one. Hopefully mine was useful anyway.<br /><br />Re: the test for mov a,(x)+: if my understanding of the SMP timing is correct, would this theoretically work?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">mov x, #$ff<br />mov $fc, #1 ; timer 2 ticks every 16 CPU cycles<br />mov $f1, #0 ; reload timer<br />mov $f1, #1 ; enable timer<br /><br />; wait 12 (16-4) cycles<br />xcn<br />xcn<br />nop<br /><br />; read timer 2 <br />mov a, (x)+<br /></div><br /><br />If I have this right, then cycle 3 of the read will occur 15 cycles after the timer starts, and cycle 4 occurs 16 cycles after, with the timer ticking up in between the two. I have a feeling I might be missing some crucial timing detail, though, so please feel free to correct me before I try making another test ROM.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199302"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199302">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199302&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199302"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 12:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Revenant wrote:</div><div class="quotecontent"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Shoot, I was going to post that hex_usr just made the same demo last night, but was too tired. Still, thank you for the extra test to confirm!</div><br /><br />Damn, that's what I get for not checking your forum as often as this one. Hopefully mine was useful anyway.<br /><br />Re: the test for mov a,(x)+: if my understanding of the SMP timing is correct, would this theoretically work?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">mov x, #$ff<br />mov $fc, #1 ; timer 2 ticks every 16 CPU cycles<br />mov $f1, #0 ; reload timer<br />mov $f1, #1 ; enable timer<br /><br />; wait 12 (16-4) cycles<br />xcn<br />xcn<br />nop<br /><br />; read timer 2 <br />mov a, (x)+<br /></div><br /><br />If I have this right, then cycle 3 of the read will occur 15 cycles after the timer starts, and cycle 4 occurs 16 cycles after, with the timer ticking up in between the two. I have a feeling I might be missing some crucial timing detail, though, so please feel free to correct me before I try making another test ROM.</div><br /><br />I don't think that will work. According to bsnes, it looks like the non-programmable stage of the timers (the one that gives T2 a different base frequency from T0 and T1) ticks constantly whether or not each timer is enabled via $F1. You'd have to enable the timer and then do some blargg voodoo to synchronize your instruction execution with it.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199307"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199307">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199307&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199307"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 1:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 330<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Argh, you're right. Good catch.<br /><br />I wonder if there's a way you could reliably manipulate that stage by (temporarily) changing the timer speed bits in the test register, assuming bsnes/higan is correct about how those actually work. It'd probably be a long shot though.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199312"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199312">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199312&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199312"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 2:30 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Revenant (or anyone with a flashcart handy) can you run &quot;test_speed.smc&quot; from <!-- m --><a class="postlink" href="http://snescentral.com/article.php?id=1115">http://snescentral.com/article.php?id=1115</a><!-- m --> on real hardware and snap a screenshot? I just want to check that it really prints &quot;done&quot; and not &quot;passed&quot; on hardware, and the numbers it prints in current higan still match hardware.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199313"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199313">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199313&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199313"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 2:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 330<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I can check later tonight when I get home unless someone beats me to it again.<br /><br />(Should I run the test_timer_* ones too or are those not as important?)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199314"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199314">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199314&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199314"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 2:36 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Revenant wrote:</div><div class="quotecontent">I can check later tonight when I get home unless someone beats me to it again.<br /><br />(Should I run the test_timer_* ones too or are those not as important?)</div><br /><br />You might as well run all of them if it's no inconvenience, but the test_speed one is the one I'm currently reverse engineering.<br /><br />ETA: by &quot;all of them&quot; I only mean test_timer_speed*, not the freezing ones or whatever.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199332"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199332">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199332&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199332"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 4:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1338
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; You might as well run all of them if it's no inconvenience, but the test_speed one is the one I'm currently reverse engineering.<br /><br />I think blargg's convention was to print &quot;done&quot; on tests where he didn't check the values against known good values. The rest will be &quot;passed&quot; or &quot;failed&quot;, sometimes with a CRC32.<br /><br />test_speed is testing the S-SMP TEST register's speed control. d7,d6 represent the SMP speed:<br />00 = 100% speed<br />01 = 50% speed<br />10 = deadlock<br />11 = 10% speed<br /><br />So when you look at blargg's test numbers, you're seeing this:<br /><br />0a, 1a, 2a, 3a = 100% speed = ~256<br />4a, 5a, 6a, 7a = 50% speed = ~128<br />8a, 9a, aa, ba = deadlock (cannot test)<br />ca, da, ea, fa = 10% speed = ~25.6<br /><br />The actual reality of these speed bits is even more nuanced, however. Different SNES consoles, even when they're the exact same motherboard revision, will lock up with different values. Some will lock with d6,d7!=0. Others will run two speed modes. We've never found an SNES that could run d6,d7=2 without freezing.<br /><br />d5,d4 represent the timer speed. That algorithm is more complicated, but it's:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">io.timerStep = (1 &lt;&lt; io.clockSpeed) + (2 &lt;&lt; io.timerSpeed);</div><br />So when you see his results, the values repeat after every four increments of the upper nibble, because only the lower two affect the timer speed.<br /><br />d3,d2,d1,d0 are timerEnable, ramDisable, ramWritable, timerDisable. Yes, it's very weird to have both an enable and disable bit on the timers. This is set to 0xa for obvious reasons on power-up.<br /><br />EDIT: forgot that we actually did figure out the d5,d4. Added details after refreshing my memory on them.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=375&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">byuu</a> on Thu Jun 29, 2017 4:58 pm, edited 3 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199333"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199333">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199333&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199333"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 4:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 330<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><!-- m --><a class="postlink" href="http://imgur.com/a/cmdk3">http://imgur.com/a/cmdk3</a><!-- m --><br /><br />Here are four runs of test_speed. The values <s>&#40;whatever they are&#41;</s> average slightly lower than what higan shows (i.e. I never see 252 on the real hardware).<br /><br />All of the test_timer_speed ROMs hang after displaying only two rows of values, but appear to be consistent with higan otherwise.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199339"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199339">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199339&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199339"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 6:16 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, I've pretty thoroughly disassembled and reverse engineered speed_test.smc. Using some slightly tricky code, it stores a <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">BRA -2</tt> ($2F $FE) into the last two SMP input ports (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">W:$2142-2143</tt> on the CPU side, <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">R:$00F6-00F7</tt> on the SMP side) and then tells the IPL ROM to jump there, so that the SMP ends up executing a tight infinite loop right out of its input ports. The CPU then controls the SMP by writing two bytes worth of opcodes (one two-byte opcode or two one-byte ones) at a time to $2140-2141, writing $FC to $2143 (changing the BRA -2 to a BRA -4), giving the SMP just enough time to take the changed loop and execute the stored opcode once, and then changing $2143 back to $FE. The sequence of opcodes it executes by this method is as follows:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CD 00 MOV X=#$00<br />E8 xx MOV A=#$xx (xx is the TEST register value)<br />C4 F0 MOV $F0=A<br />00 3D NOP; INC X (for this one there's a delay loop before the CPU resets the BRA target)<br />E8 0A MOV A=#$0A (this one has a delay loop too)<br />C4 F0 MOV $F0=A (this one has a delay loop too)<br />D8 F4 MOV $F4=X<br />(at this point the CPU reads $2140 to get the value of X written by the SMP)<br />E8 00 MOV A=#$00<br />C4 F4 MOV $F4=A</div><br /><br />The results the test program prints to the screen for each value of TEST are the values read from $2140 at line 8: basically, the number of times the SMP was able to execute <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">NOP; INC X; BRA -4</tt> while the CPU was in its delay loop.<br /><br />The important thing is that during this test the SMP doesn't access RAM even once; it's executing entirely out of its I/O ports. So the test program results are fully consistent with nocash's theory that TEST d6-d7 controls the number of cycles an I/O port access takes and d4-d5 controls the number of cycles a RAM access takes. If that theory is right, the complicated formula in higan relating TEST d4-d7 to the timers is simply an artifact of the proportion of RAM accesses to I/O port accesses that blargg's timer test program does.<br /><br />I also suspect that a speed of 2 (for either RAM or I/O) takes 5 cycles but only clocks the timers 4 times, and a speed of 3 takes 10 cycles but only clocks the timers 8 times. That would explain why the SMP runs at 1/10th speed while executing out of I/O ports while TEST.bits(6, 7) == 3, but the fastest the timers can apparently go relative to SMP instruction execution is only 8 times normal (when TEST.bits(4,7) == 0xF).<br /><br />Another possibility for the 8/10 inconsistency is that blargg's timer test program makes the SMP do some ROM accesses in addition to RAM and I/O, and that ROM accesses always take only 1 cycle. I guess I'll have to disassemble it as well to be sure.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199343"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199343">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199343&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199343"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 7:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1338
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">nocash's model is certainly more elegant, but let's note a few things.<br /><br />First, he missed the purpose of $00f0.d2 as being RAM disable. You can still run code out of the I/O ports with RAM disabled. Particularly troublesome as he analyzed my uPD96050 emulation and used my new instruction mnemonics, but I guess he didn't look at my SMP implementation.<br /><br />Second, he mentions $00f0.d6,d7 as controlling not just I/O but ROM access timing ... I can't imagine he's talking about the IPLROM. So ... what ROM?<br /><br />This is kind of a theme with nocash. He's often right, but when he hits undocumented things, sometimes his theories are just off the wall, and he doesn't note them as theories, and he provides no proof of his claims. I suppose that's where we come in (well, Revenant mostly) :P<br /><br />The $00f8,$00f9 note I am much more inclined to believe because he is pointing to actual CPU pins. But I do wonder where he got the P4/P5/P5RD labels from. Similarly, documentation indicates $00fa-00fc is TnTARGET, not TnDIV. He's just renaming registers as he chooses to.<br /><br />Again, I'm not foolish enough to say he's wrong. But I'd love to see some tests to indicate if he's right. Especially one to prove the 20% speed case. Looking at blargg's test_timer_speed:<br /><br />0 = 2731 (100%)<br />1 = 1639 (60%)<br />2 = 911 (33%)<br />3 = 482 (17.5%)<br /><br />Not quite 1/2/5/10. But you seem to have a better grasp on how executing code out of I/O registers can affect timers, so ... I'm willing to make the change he talks about into a higan fork branch, and see if blargg's tests still align properly.<br /><br />Next, he's implying that NOP's idle cycle is a &quot;RAM timing&quot; and TCALL's three idle cycles are &quot;I/O timing.&quot; Yet Overload's logic analyzer traces show that the first cycle of both has the program counter on the bus with RWB=1. In other words, this sounds like memory reads.<br /><br />If both Overload and blargg were able to detect the mov (x)+ anomaly, then how would they have missed that other opcodes had weird effects like that?<br /><br />Again, it's nocash. What even is the &quot;SPC700 waitstates on internal cycles&quot; table? How did he make that? Where is it from? How did he verify that? No answers. Just a table and &quot;just go with it.&quot;<br /><br />And finally, I/O writes fall through and update the underlying APU RAM. So what happens if your I/O speed is 1 but your RAM speed is 10? Does the RAM write just silently fail? Or silently work anyway? Maybe it'd fail if your -actual- APU RAM were timed ten times slower, whereas since it's perfectly capable of 1-waitstate operation, it'll just always work in this case?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199344"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199344">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199344&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199344"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 7:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Revenant, I feel pretty bad for working you like a mule but I've got another test program I'd like you to write. This one should be simpler than the echo buffer test.<br /><br />Upload this tiny program to the SMP (somewhere that won't get clobbered by the IPL ROM--$0200 would be good) and jump to it:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; mov $f1,#$b0&nbsp; &nbsp; ; enable IPL ROM; clear input ports<br />&nbsp; &nbsp; mov $f4,#$00&nbsp; &nbsp; ; clear output port $F4<br />:&nbsp; &nbsp;mov a,$f5<br />&nbsp; &nbsp; beq :-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; loop until the CPU writes nonzero to $2141<br />&nbsp; &nbsp; mov $f0,$f4&nbsp; &nbsp; &nbsp;; set TEST to whatever the CPU wrote to $2140<br />&nbsp; &nbsp; jmp $ffc0&nbsp; &nbsp; &nbsp; &nbsp;; jump to IPL ROM entry point</div><br /><br />Then, have the CPU write different TEST values to $2140-2141 and time how long it takes for the IPL ROM to clear APU zero page and put out the $AA handshake. Something like this on the CPU side:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">(A contains value to write to TEST; $0A, $1A, $4A and $5A should be safe)<br />($CA and $DA are probably safe too, at least on Revenant's SNES)<br />&nbsp; &nbsp; rep #$30<br />&nbsp; &nbsp; ora #$FF00&nbsp; ; set high bits which will be written to $2141<br />&nbsp; &nbsp; tay<br />&nbsp; &nbsp; lda #$2100<br />&nbsp; &nbsp; tcd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; use direct page to make our loop tighter<br />&nbsp; &nbsp; sep #$20<br />&nbsp; &nbsp; lda #$AA<br />&nbsp; &nbsp; ldx #$0000<br />&nbsp; &nbsp; sty $40&nbsp; &nbsp; &nbsp;; = $2140<br />:&nbsp; &nbsp;inx<br />&nbsp; &nbsp; beq hung<br />&nbsp; &nbsp; cmp $40&nbsp; &nbsp; &nbsp;; = $2140<br />&nbsp; &nbsp; bne :-&nbsp; &nbsp; &nbsp; ; loop until $2140 = #$AA (meaning IPL finished clearing zero page)<br />&nbsp; &nbsp; (now print TEST value and X to the screen)<br /><br />hung:<br />&nbsp; &nbsp; (whoops, looks like we hung the SMP with a bad TEST value...)</div><br /><br />The idea is to see which of $F0 d4-d7, if any, affect execution speed when the SMP is accessing ROM and RAM (the IPL ROM startup code runs out of ROM and writes to RAM).<br /><br /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">What even is the &quot;SPC700 waitstates on internal cycles&quot; table? How did he make that? Where is it from? How did he verify that? No answers. Just a table and &quot;just go with it.&quot;</div><br /><br />Agree that that table is probably nonsense. Nocash claims <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">NOP</tt>'s idle cycle has &quot;RAM timing&quot;, but blargg's test_speed.smc does <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">NOP</tt>s and isn't affected by d4-d5 at all.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So what happens if your I/O speed is 1 but your RAM speed is 10? Does the RAM write just silently fail? Or silently work anyway? Maybe it'd fail if your -actual- APU RAM were timed ten times slower, whereas since it's perfectly capable of 1-waitstate operation, it'll just always work in this case?</div><br /><br />The TEST register is probably meant to slow down the SMP while it's running in an ICE or something like that, and isn't meant to be touched on a production system. It's called TEST, after all.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">But you seem to have a better grasp on how executing code out of I/O registers can affect timers</div><br /><br />The test program I disassembled (test_speed.smc) doesn't use or touch the SMP timers at all.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199349"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199349">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199349&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199349"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 9:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 330<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><!-- m --><a class="postlink" href="http://revenant1.net/smptesttest.sfc">http://revenant1.net/smptesttest.sfc</a><!-- m --><br /><br />Results: <!-- m --><a class="postlink" href="http://imgur.com/a/rsHPN">http://imgur.com/a/rsHPN</a><!-- m --></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Revenant</a> on Thu Jun 29, 2017 11:08 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199353"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199353">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199353&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6#p199353"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 29, 2017 10:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry, can you provide source code for that ROM? Even in bsnes-classic, TEST d4-d5 seem to be affecting the result by more than rounding error and $DA is locking up the SMP, and I'm not sure what's going on... You don't have NMI enabled while you're doing the timing loops, do you?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=16140&amp;start=30&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>6</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 86 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=75">6</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=6b29b70e018c902f49d4ab4f04ead6b6">Board index</a> &#187; <a href="./viewforum.php?f=25&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Other</a> &#187; <a href="./viewforum.php?f=23&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12&amp;sid=6b29b70e018c902f49d4ab4f04ead6b6">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google Adsense [Bot]</span> and 7 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php?sid=6b29b70e018c902f49d4ab4f04ead6b6"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="16140" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="6b29b70e018c902f49d4ab4f04ead6b6" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=6b29b70e018c902f49d4ab4f04ead6b6" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
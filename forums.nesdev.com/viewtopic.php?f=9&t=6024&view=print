<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - PowerPak save state mappers</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">PowerPak save state mappers</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=6024">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=6024</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>5</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Sat Feb 06, 2010 9:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>PowerPak save state mappers</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><span style="font-size: 150%; line-height: normal">EDIT: Latest downloads here: <!-- m --><a class="postlink" href="http://kkfos.aspekt.fi/projects/nes/save-state-mappers/">http://kkfos.aspekt.fi/projects/nes/save-state-mappers/</a><!-- m --></span>
<br />
<br />Old info for version 1.0:
<br /><span style="font-size: 75%; line-height: normal"><br />So, here's a little something I've been working on the last couple of days: <!-- m --><a class="postlink" href="http://removed">http://removed</a><!-- m --><br /><br />These mappers allow players to save/load the game state in real time using Select+A/Select+B buttons. So far I've implemented NROM and UNROM (Castlevania, Mega Man, Duck Tales and so on) support.<br /><br />The save state can also be saved to SAV files on the CF card. Note that the SAV file has to be 16KB for this to work. (Actually, for NROM games it should probably work with just 8KB, but I didn't test it.)<br /><br />Currently saved:<br />- CPU 2KB memory + registers<br />- PPU palette + nametables + CHR-RAM + $2000 + $2001<br />- mapper state<br /><br />"TODO":<br />- more mappers<br />- more complete save state (include APU etc)<br />- configurable buttons<br />- more save state slots (not really that useful because state can be saved to CF)<br />- hex editor<br />- the possibilities are endless <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></span>
<br />
<br />EDIT 2011-01-30: removed old link

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jagasian</b> [ Fri Feb 12, 2010 2:04 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Pretty cool.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Feb 12, 2010 2:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I haven't tried yet (haven't had time for playing), but this is definitely a great idea! I didn't even know the PowerPak could do this.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Sat Feb 13, 2010 1:42 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I haven't had time to try it yet either but it sounds awesome if it's anything like the Game Doctor SF's instant game save feature.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>deksar</b> [ Sat Feb 13, 2010 1:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />great feature! Thanks a lot!
<br />i wish it was for all the mappers <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Sat Feb 13, 2010 8:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">deksar wrote:</div><div class="quotecontent">great feature! Thanks a lot!<br />i wish it was for all the mappers <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>
<br />More mappers will come later. The problem is I can't simply add this functionality in to the existing mappers, I have to implement everything from scratch. I will probably do AxROM and CNROM next, then go for MMC1.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jamesv833</b> [ Sun Feb 14, 2010 1:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Just tried it, works great thanks for the 16kb sav file. great work. <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Tue Mar 09, 2010 12:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've now implemented AxROM, CNROM and MMC1, just need to polish them a bit before releasing. MMC3 is also partially working but the scanline counter is giving me some trouble.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thewizdawg</b> [ Tue Mar 09, 2010 5:08 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hello,
<br />
<br />I've tried the save states and it seems to work.  However when I do a reset on the game instead of going back to start screen, it goes back to PowerPak main menu.  Can you check/fix this?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Tue Mar 09, 2010 8:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">thewizdawg wrote:</div><div class="quotecontent">Hello,<br /><br />I've tried the save states and it seems to work.  However when I do a reset on the game instead of going back to start screen, it goes back to PowerPak main menu.  Can you check/fix this?</div>
<br />Yeah I'm aware of this. It's because the example mapper schematics don't have that functionality in them. But I'll look into it at some point.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>No Carrier</b> [ Sun Mar 14, 2010 9:16 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This sounds great! Gonna give it a try soon!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ccovell</b> [ Mon Apr 05, 2010 7:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hey, I just tried out these mappers on my Famicom (Titler) and although the game saving/restarting works great, the palettes get all screwed up on restarting.  Also, 3rd-party controllers are unusable.  Has anyone else had palette glitching with these mappers?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Tue Apr 06, 2010 5:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">ccovell wrote:</div><div class="quotecontent">Hey, I just tried out these mappers on my Famicom (Titler) and although the game saving/restarting works great, the palettes get all screwed up on restarting.  Also, 3rd-party controllers are unusable.  Has anyone else had palette glitching with these mappers?</div>
<br />Hmm that's strange, I've never had any problems with palette. I've seen some other problems, like the status bar doesn't work right in Castlevania for a brief moment after loading and sometimes CHR-RAM wouldn't load correctly in Darkwing Duck. Also in Dragon's Lair sprites would get corrupted. I haven't looked further in to these problems yet.
<br />
<br />And yeah, I forgot to OR the Famicom external controller bit in, thanks for reminding me. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Another possible problem is with games that use DPCM as it doesn't correctly handle multiple reads per frame so if a bit gets corrupted it might save/load automatically in some rare cases.
<br />
<br />...
<br />
<br />In other news I've been also trying to add support for TURBOing the buttons (disabling/enabling through a menu). In concept it seems to be working although it's complicated by some games reading the controller multiple times per frame.
<br />
<br />Still haven't been able to figure out what's the best way to implement the MMC3 scanline counter because of my limited Verilog skills. If anybody has any tips I'd appreciate it. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> I'm talking hardware side here, the "abstract" functioning is well explained in the wiki.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>kyuusaku</b> [ Tue Apr 06, 2010 8:23 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">thefox wrote:</div><div class="quotecontent">In other news I've been also trying to add support for TURBOing the buttons (disabling/enabling through a menu). In concept it seems to be working although it's complicated by some games reading the controller multiple times per frame.</div>
<br />You're overpowering the input buffers? To me that doesn't sound like a good idea.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Tue Apr 06, 2010 8:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">kyuusaku wrote:</div><div class="quotecontent"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">In other news I've been also trying to add support for TURBOing the buttons (disabling/enabling through a menu). In concept it seems to be working although it's complicated by some games reading the controller multiple times per frame.</div><br />You're overpowering the input buffers? To me that doesn't sound like a good idea.</div>
<br />No. I do it like this (simplified):
<br />- watch $4016 strobes and $4016/$4017 reads to get the pad state
<br />- I (attempt to) detect when CPU is executing instructions like LDA $4016 and patch the hibyte on every 2nd time redirecting it to a FPGA register I have set up, like $4816 (this will only work when game is executing code in the ROM since I can't patch RAM code)
<br />- the FPGA reg returns the pad state that was read the previous time with some of the buttons forced to 0, so when player holds a a button down on every 2nd frame game will read 1 and every 2nd frame 0
<br />
<br />Of course this solution is not completely transparent as it will halve the times the controller is actually read (from 60Hz to 30Hz on most if not all games), but I think it should be usable.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>5</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
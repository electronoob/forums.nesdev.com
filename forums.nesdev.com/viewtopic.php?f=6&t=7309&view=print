<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - SuperNSF PCM+PSG driver</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">SuperNSF PCM+PSG driver</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=7309">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=7309</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>coda</b> [ Thu Dec 23, 2010 11:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>SuperNSF PCM+PSG driver</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />hi everyone.
<br />some songs were quietly entered in this past Famicompo Mini (september) that used a new sort of driver.
<br />
<br /><!-- m --><a class="postlink" href="http://dl.dropbox.com/u/2316004/entry001.nsf">http://dl.dropbox.com/u/2316004/entry001.nsf</a><!-- m -->
<br /><!-- m --><a class="postlink" href="http://dl.dropbox.com/u/2316004/entry046.nsf">http://dl.dropbox.com/u/2316004/entry046.nsf</a><!-- m -->
<br /><!-- m --><a class="postlink" href="http://dl.dropbox.com/u/2316004/entry068.nsf">http://dl.dropbox.com/u/2316004/entry068.nsf</a><!-- m -->
<br />
<br />what you may notice about these songs is that they play multiple PCM samples (up to 4 channels) and 2a03 and VRC6 at the same time <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />we also made a straight up MOD player version
<br /><!-- m --><a class="postlink" href="http://dl.dropbox.com/u/2316004/bananasp.nsf">http://dl.dropbox.com/u/2316004/bananasp.nsf</a><!-- m -->
<br />
<br />the tool itself has been released (to little fanfare), so it feel it's a good time to post about it, especially as stuff like NSF v2 and pornotracker are being developed. and i figured this forum would be interested if no one else is.
<br />
<br />tool:
<br /><!-- m --><a class="postlink" href="http://lmao.rotfl.at/upload/B00daW/supernsf.zip">http://lmao.rotfl.at/upload/B00daW/supernsf.zip</a><!-- m -->
<br />
<br />i didn't do any coding but i was involved with the development of supernsf and its predecessors. it uses $4011 to do cpu cycle-timed software mixing at around 12khz (different rate, and different driver for each number of PCM channels from 1 to 4) and supports some basic instrument macros like mml/famitracker. the cpu cycle timing actually causes the pitch to vary slightly relative to the PSG channels across different players, but not catastrophically. of course whatever the driver does also causes seeking to break in many players.
<br />
<br />i supposed that's all the interesting stuff i have to say about it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Dec 24, 2010 3:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />THIS IS REALLY AMAZING !!
<br />Sounds about GBA quality.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri Dec 24, 2010 7:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes, indeed it's amazing.  I was reading <a href="http://battleofthebits.org/academy/GroupThread/2397/SuperNSF+and+SuperNSF%2B/" class="postlink">another page</a> which seemed to highlight a flamewar about whether or not it's "Legitimate" to use mixed PCM in NSF competitions.  (My opinion: it isn't)
<br />
<br />The obvious problem is that it seems next to impossible to use this engine in a game, except for a static screen with no tricks.  The "Rickrolled" demo showed us that you can still pull off one PPU write and scroll every frame even with streaming PCM playing, but I wouldn't throw in any OAM updates in there.
<br />
<br />Edit: I wonder if this could be done with a cycle-based IRQ mapper?  It takes about 41 CPU cycles to respond to an IRQ and play a pre-mixed sample.  So if you make the sample rate 16384Hz, playback takes 37% CPU usage.  Mixing happens in another thread, is it fast enough to keep up?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Dec 24, 2010 8:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">The obvious problem is that it seems next to impossible to use this engine in a game, except for a static screen with no tricks.</div>
<br />In other words, a title screen or other cut scene. There's a reason that <em>Wheel of Fortune</em> and <em>Skate or Die 2</em> have samples in their title screen music, and there's a reason that <em>Castlevania: Circle of the Moon</em> and <em>Animal Crossing: Wild World</em> have streaming samples instead of sequenced music for their title screens.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri Dec 24, 2010 11:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />tepples:
<br />
<br />That's why I think the engine would be perfect for first person adventure games, like a Princess Tomato, Shadowgate, Deja Vu, or Metal Slader Glory remake. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />Dwedit:
<br />
<br />The purpose of Battle of the Bits (for the most part) is abusing old hardware and formats.  We also have competitions sometimes where the rules dictate how big a song might be.  For example:  It might be nice to use Shiru's engine to see how small we can make NSFs.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri Dec 24, 2010 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So this mixes channels through the 7-bit PCM channel.  Has anyone tried to play 4-bit digital samples through the Square and noise channels?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Fri Dec 24, 2010 1:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">So this mixes channels through the 7-bit PCM channel.  Has anyone tried to play 4-bit digital samples through the Square and noise channels?</div>
<br /><!-- m --><a class="postlink" href="http://kkfos.aspekt.fi/2010/11/14/4-bit-pcm-on-nes-using-the-pulse-channel/">http://kkfos.aspekt.fi/2010/11/14/4-bit ... e-channel/</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri Dec 24, 2010 1:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><!-- m --><a class="postlink" href="http://average.truechiptilldeath.com/nesdev/supernsf.zip">http://average.truechiptilldeath.com/ne ... pernsf.zip</a><!-- m -->
<br />
<br />Strobe's Apache server seems to be down at the moment.
<br />
<br />Dwedit:  Yep, it's all done through $4011.  As for the pulse and noise channels, that sounds like delicious abuse.  SN7 PSG used pulse abuse for PWM and PCM samples.  It should be possible, but I haven't heard of anyone doing it.  Memblers's Squeedo does some really interesting things with the pulse and triangle channels.  #mod_shrine, coda's crew, has also thought of making some FM abuse out of the triangle channel with IRQ support of NSF2.  The gates are open for more wank. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Fri Dec 24, 2010 1:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Plus the SuperNSF name is taken by a replacement format for SPC files (Uses SPC700 in the original format) so at least rename it into Enhanced NSF (ENF) or something along the lines.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri Dec 24, 2010 1:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">thefox wrote:</div><div class="quotecontent"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">So this mixes channels through the 7-bit PCM channel.  Has anyone tried to play 4-bit digital samples through the Square and noise channels?</div><br /><!-- m --><a class="postlink" href="http://kkfos.aspekt.fi/2010/11/14/4-bit-pcm-on-nes-using-the-pulse-channel/">http://kkfos.aspekt.fi/2010/11/14/4-bit ... e-channel/</a><!-- m --></div>
<br />
<br />My bad.  However, I can't seem to get the thing to work on PowerPak.  Is this for PAL only?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Fri Dec 24, 2010 1:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">B00daW wrote:</div><div class="quotecontent"><div class="quotetitle">thefox wrote:</div><div class="quotecontent"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">So this mixes channels through the 7-bit PCM channel.  Has anyone tried to play 4-bit digital samples through the Square and noise channels?</div><br /><!-- m --><a class="postlink" href="http://kkfos.aspekt.fi/2010/11/14/4-bit-pcm-on-nes-using-the-pulse-channel/">http://kkfos.aspekt.fi/2010/11/14/4-bit ... e-channel/</a><!-- m --></div><br /><br />My bad.  However, I can't seem to get the thing to work on PowerPak.  Is this for PAL only?</div>
<br />Hmm, shouldn't be.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sat Dec 25, 2010 4:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">and there's a reason that Castlevania: Circle of the Moon [...]  have streaming samples instead of sequenced music for their title screens.</div>
<br />Not really -&gt; the GBA have to stream data anyway if you don't want to be restricted to GBC sound. Castlevania COTM just uses the standard sappy sound engine and the streamed song isn't even compressed.
<br />Also check my Final Fantasy V and VI advance sound restoration hacks where I introduced streamed songs at the place of sequenced ones, without changing anything in the code.
<br />
<br />But I'd agree a title screen with a music like that would be awesome.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Dec 25, 2010 6:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">Not really -&gt; the GBA have to stream data anyway if you don't want to be restricted to GBC sound.</div>
<br />I'm aware of that; I've written a mixed GBC/PCM music engine for the GBA (used in <a href="http://www.pineight.com/tod/" class="postlink">TOD</a>) and a compressed music player for the GBA (<a href="http://www.pineight.com/gba/gsm/" class="postlink">stand-alone</a> and <a href="http://www.pineight.com/lu/" class="postlink">in a game</a>). I was trying to point out that game developers are willing to spend far more resources on the first impression to put players in the mood of "awesome".

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mukunda</b> [ Mon Dec 27, 2010 11:06 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">So this mixes channels through the 7-bit PCM channel.  Has anyone tried to play 4-bit digital samples through the Square and noise channels?</div>
<br />(For the next Famicompo mini Classical) :P

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
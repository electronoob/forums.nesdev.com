<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Famicom expansion hardware recordings</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Famicom expansion hardware recordings</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=8639">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=8639</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Karatorian</b> [ Fri Mar 02, 2012 7:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">compliant NSFs need to return from the play routine before the next update, and in a game implementation you would never write your PCM routine around this limitation.</div> And that's one reason NSF2 was proposed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Sun Mar 04, 2012 3:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Regarding Sunsoft 5B, its audio expansion the same as the AY.
<br />
<br /><!-- m --><a class="postlink" href="http://www.speccy.org/hardware/datasheet/ay38910.pdf">http://www.speccy.org/hardware/datasheet/ay38910.pdf</a><!-- m -->
<br />
<br />Two things that current players do not support is the Noise Generator and Envelope Generator support of the channels.  Each channel can change from pulse to noise and back.  The Envelope Generator was commonly used to create basic waveforms and was used as an additional channel called the "buzzer".
<br />
<br />Here's an example:  <!-- m --><a class="postlink" href="http://www.youtube.com/watch?v=38d4rjORKgc">http://www.youtube.com/watch?v=38d4rjORKgc</a><!-- m -->  The bassline is the "buzzer" or Envelope Generator.
<br />
<br />Generally the Noise and Envelope were not emulated because no commercial games used the functions.  With FamiTracker's active development and many musicians using it, it would be necessary to have a player. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sun Mar 04, 2012 4:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />B00daW have you tested these things with NSFPlay? So far as I have seen it supports both envelopes and the noise channel. If you have an example NSF that doesn't work send it to me.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Sun Mar 04, 2012 10:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Regarding this post ( <!-- m --><a class="postlink" href="http://nesdev.com/bbs/viewtopic.php?t=8483">http://nesdev.com/bbs/viewtopic.php?t=8483</a><!-- m --> ) it seems like there is some debate to how the envelope register should be emulated.  Someone needs to actually record from a Sunsoft 5B devcart.  According to BootGod's site, it seems that Gimmick! and Gremlins 2 Famicom carts are the only ones with actual Sunsoft 5B's.  Strangely, enough it doesn't seem like Gremlins 2 actually used the expansion audio...
<br />
<br />Tonight I decided I was bored and would hack up a MMC5 PCM PoC from currently available SuperNSF NSFs.
<br />
<br /><!-- m --><a class="postlink" href="http://average.truechiptilldeath.com/nesdev/mmc5hax.zip">http://average.truechiptilldeath.com/nesdev/mmc5hax.zip</a><!-- m -->
<br />
<br />I have no idea how this is going to sound.  It uses saturation tables for 4 channels using 7-bit samples instead of 8-bit samples.  It should at least play audio out of the $5011 register though...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sun Mar 04, 2012 11:39 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've got an MMC5 PCM test of my own, but I will test this. VirtuaNSF and some emulators play $5011 writes. But I have yet to find any that will play $8000-BFFF reads in read mode. NSFPlug will do this when I get around to it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sat Mar 10, 2012 5:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />After doing some investigating on the 5B it looks like VirtuaNSF's envelope speed is wrong. The envelope frequency should be exactly 1/16 of the equivalent tone frequency. NSFPlug seems to be correct. VirtuaNES looks mostly correct, except it masks out the high 4 bits of the envelope pitch, so it probably doesn't support very low envelope frequencies. A lot of other emulators don't even bother with noise or envelopes.
<br />
<br />There was a lot of confusion when looking this up, I think primarily because the 5B appears to be a YM2149F running with the clock divider on, cutting the clock rate in half. So, the 5B's frequencies are unfortunately about 1/2 of what you'd get from a ZX (1/3 vs an ST)-- big loss in pitch accuracy! There may also be some confusion whether the "frequency" mentioned in the datasheets means how often the square value flips (I doubt this), or how often it completes the cycle.
<br />
<br />I wrote a wiki page for the 5B, since we didn't have one:
<br /><a href="http://wiki.nesdev.com/w/index.php/Sunsoft_5B_audio" class="postlink">http://wiki.nesdev.com/w/index.php/Sunsoft_5B_audio</a>
<br />
<br />Edit: also just discovered that NSFPlug's FDS modulation is half strength for some reason. Another thing to fix for the next version...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri Mar 16, 2012 5:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">2. Can you possibly get me Strobe's source code and FTMs for those NSFs you think should work but don't? It's will take a lot more time to try to debug it if I have to do it by reverse engineering.</div>
<br />
<br />Strobe was gracious enough to share his source for educational and development purposes.
<br />
<br />I will message you the link on IRC.  This source was also used for Ziberia.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Fri Mar 16, 2012 10:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks! That will be helpful.
<br />
<br />I've gotten NSFPlug down to a small number of known issues; this was one of them. I expect I'll be releasing version 2.1 by the end of March.
<br />
<br />BTW in that xiamus haxus MMC5 NSF you (or whomever hacked it) forgot to set the MMC5 bit in the NSF header. Easy to fix though, and it plays just fine in my WIP version of NSFPlug now.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sat Mar 17, 2012 12:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah, I've discovered the problem. The NSFs are not compliant with the spec.
<br />
<br />The bankswitching bytes in the NSF header (70-77) are all 0. This means (according to the spec) that bankswitching is disabled.
<br />
<br />Just put 00 01 02 03 04 05 06 07 in there and it will work as intended.
<br />
<br /><a href="http://kevtris.org/nes/nsfspec.txt" class="postlink">http://kevtris.org/nes/nsfspec.txt</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sun Apr 01, 2012 3:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />As I create test NSFs I will archive them at: <a href="http://rainwarrior.ca/projects/nsfplay/" class="postlink">http://rainwarrior.ca/projects/nsfplay/</a>
<br />
<br />The current version contains a test for 5B and MMC5 PCM:
<br /><a href="http://rainwarrior.ca/projects/nsfplay/bs_nsf_tests_10.zip" class="postlink">http://rainwarrior.ca/projects/nsfplay/bs_nsf_tests_10.zip</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Fri Apr 06, 2012 11:02 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Beginning to fill my own requests, I acquired a Lagrange Point cart and recorded its entire sound test on my audio-modded NES:
<br />
<br /><a href="http://rainwarrior.thenoos.net/projects/nes/lp_ref.zip" class="postlink">http://rainwarrior.thenoos.net/projects/nes/lp_ref.zip</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue May 01, 2012 1:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've now got a Famicom running, and I have carts of all the expansions available to me now (no FDS at the moment, but that will change).
<br />
<br />I'll be posting reference recordings, and more information later, but for now I have some info on the 5B to share:
<br />
<br />Gimmick's 5B chip does indeed support the noise and envelope features of the YM2149F, and the envelope speed is as I expected. The envelope runs at exactly 1/16 the speed of the equivalent tone frequency (or an octave down in triangle mode). I'll share some code/ROMs/recordings later.
<br />
<br />So, this means: Nestopia is a pretty accurate reference for the 5B sound. NSFPlay/NSFPlug is also pretty good. Most other emulators don't implement the noise/envelope features, and a few (e.g. VirtuaNSF) play envelopes incorrectly at double speed.
<br />
<br />
<br />Edit: I've posted a soundtrack recording and the test code to my OP.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jrlepage</b> [ Sun May 13, 2012 11:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here's some more recordings:
<br />
<br />Namco 163:
<br />-<a href="http://www.mediafire.com/?ec47t4jajbb6ywl" class="postlink">King of Kings (8 channels)</a>
<br />-<a href="http://www.mediafire.com/?lwdf8bfaoguy7e3" class="postlink">Final Lap (4 channels)</a>
<br />-<a href="http://www.mediafire.com/?vby5zhhbhh3hmaq" class="postlink">Megami Tensei II (4 channels)</a>
<br />
<br />VRC6:
<br />-<a href="http://www.mediafire.com/?8aijas3l2yoli1t" class="postlink">Akumajou Densetsu</a>
<br />
<br />All of these were recorded from an AV-modded Famicom (recorded from pin 46).
<br />
<br />I hope these will be useful to someone. I realise there isn't much need for a full recording of Akumajou Densetsu, but I was bored. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Also, the first two tracks were recorded from a different cart; I switched after those because the first one was giving me trouble. I didn't bother rerecording the first two, but found out after the fact that my two carts have different volume balance between VRC6 and 2A03... It's not very noticeable anyway.
<br />
<br />It's worth noting that the only NSF rip of King of Kings is missing the melody in the in-game track (the frequencies are updated but the volume stays at 0 throughout the entire track).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ionustron</b> [ Tue May 15, 2012 8:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yep, that high pitch in King of Kings is definitely there. Bleh.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jrlepage</b> [ Tue May 15, 2012 11:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah.. But it's not as bad as NEZPlug++ or FamiTracker make it sound. At least, I didn't want to murder anything after a minute of listening to King of Kings on the real Famicom, unlike those two emulators...

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
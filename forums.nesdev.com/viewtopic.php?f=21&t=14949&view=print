<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Question for Keisan Game: Sansuu 1 Toshi</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Question for Keisan Game: Sansuu 1 Toshi</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=21&amp;t=14949">http://forums.nesdev.com/viewtopic.php?f=21&amp;t=14949</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Immutable</b> [ Sun Oct 16, 2016 12:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I am unable to remove the &quot;1&quot; character in the title screen of &quot;Keisan Game: Sansuu 1 Toshi&quot;. <br /><br />I have attempted to identify the assembler code by viewing the Name Table Viewer (in FCEUX). Unfortunately, it does not appear. <br /><br />Is there an easy way to find and identify the &quot;1&quot; title graphic in the assembler code?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gilbert</b> [ Sun Oct 16, 2016 6:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I haven't checked that out, but if it doesn't appear in the name table, it is possible that the '1' character is formed by sprites, so you may check that. I think you can also view the sprite table in Fceux?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Immutable</b> [ Sun Oct 16, 2016 7:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I was able to find the assembler code on the PPU Viewer table. Removing the graphic &quot;1&quot; would ruin the gameplay... so I assume that there is another code for the placement of that graphic.<br /><br />By the way, here is a screenshot of the translated game and the PPU Viewer table.<br /><br />Again, my objective for this project is to remove the &quot;1&quot; for the title &quot;Grade 1 Math Games&quot;.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="gensmall"><b>File comment:</b> Screenshot</span><br />
		
			<img src="./download/file.php?id=6844" alt="FGM-0.png" /><br />
			<span class="gensmall">FGM-0.png [ 2.38 KiB | Viewed 2972 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<span class="gensmall"><b>File comment:</b> PPU Viewer with &quot;culprit graphic&quot; highlighted.</span><br />
		
			<a href="./download/file.php?id=6843&amp;mode=view"><img src="./download/file.php?id=6843&amp;t=1" alt="1.PNG" /></a><br />
			<span class="gensmall">1.PNG [ 18.93 KiB | Viewed 2972 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Sumez</b> [ Sun Oct 16, 2016 10:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The PPU viewer window doesn't display assembler codes.<br /><br />You will have to open the debugger and find the place where the game adds the sprites that form the character.<br /><br />It probably pushes its sprites using the OAM DMA with a write to $4014 (though for a math game it's probably not necessary). Set a breakpoint for writes to that address and make note of the number it writes. For example if it writes $02, its sprite buffer will be in the $0200-$02ff area of memory. Try editing this memory just before the DMA write to see different results on the next frame.<br /><br />If the game doesn't use DMA, you're gonna have to look for writes to the OAMADDR and OAMADDR ($2003 and $2004) registers. I'm pretty sure all of these are labeled in Fceux.<br /><br />Ps. You're gonna have to understand these assembler codes before editing them, but I'm guessing getting into that is the core of your project?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Immutable</b> [ Mon Oct 17, 2016 6:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I was hoping to do some simple edits in the assembler code, but I'll look into the debugger program. I am unfamiliar with using this program, but I'll give it a shot and let you know if I make any progress.<br /><br />Thanks for the advice!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Sumez</b> [ Mon Oct 17, 2016 7:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It should definitely be possible with a couple of simple edits to the assembler code.<br /><br />But &quot;assembler code&quot; is what you see in the debugger, it's not the graphics data <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Oct 17, 2016 7:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />A quick debug of this game shows that the &quot;1&quot; is indeed a sprite, which is covering some garbage background tiles. To properly get rid of it you'll have to hide the 4 sprites that make up the number (give them a Y coordinate of 239 or higher), and also patch the background data to use the blank tiles instead of the garbage tiles in that space. The steps for this are the following:<br /><br />1- Open the name table viewer, put the cursor over the garbage tiles and take note of their addresses and IDs;<br /><br />2- Open the CPU debugger and create breakpoints for writes at the PPU addresses you wrote down;<br /><br />3- Reset the game and wait for the breakpoints to trigger. When they do, check if the values being written are the ones you wrote down previously. If so, look at the previous instructions in the disassembly to see where the value are being read from, and take note of the addresses;<br /><br />4- Change the tile IDs in those addresses to the ID of the blank tile using an hex editor (FCEUX has a built in hex editor you can use). The background should be fine now.<br /><br />As for the sprites, this games uses $0200-$02FF as the OAM buffer, so this is where all sprite attributes can be found. Create a breakpoint for writes in this memory range to find out where the Y coordinates for those 4 sprites are coming from, and then patch the code or data to change it to 239 or more.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Immutable</b> [ Mon Oct 17, 2016 8:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes, I was able to remove the background garbage tiles easily, but my main problem was removing the sprites in the foreground, which were not accessible in the Table Viewer. Again, I'll try to locate the register(?) values of the buffer and see if I can relocate that &quot;1&quot; graphic. Thanks!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Oct 17, 2016 12:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Immutable wrote:</div><div class="quotecontent">Again, I'll try to locate the register(?) values of the buffer and see if I can relocate that &quot;1&quot; graphic.</div><br />I hope I'm not being rude, but you do seem to be throwing around expressions you apparently don't know the meaning of, such as &quot;assembler code&quot;, and that's a bit confusing. Let me try to clear this up:<br /><br />&quot;Assembly (not -er) code&quot; is the source code of a program, which an assembler (now it's -er, because this is a program that assembles) will turn into binary code. The binary code is what goes in the ROM, but a debugger might disassemble it on the fly to show you a more readable version of the program.<br /><br />&quot;Registers&quot; are small pieces of memory inside a computer chip necessary for it to perform its tasks. The CPU has A, X, Y, S, P and PC, the PPU has two address registers plus a bunch of other stuff, mappers use registers to keep track of the banks that are mapped in, to count scanlines, and so on. We also use the term &quot;register&quot; to refer to the memory-mapped ports the CPU uses to communicate with other hardware, even if they don't necessarily have a matching internal register.<br /><br />Sprite attributes are not registers, and neither is the memory at $0200-$02FF. $0200-$02FF is just a buffer, a temporary place where the sprite attributes are stored before they're sent to the PPU. A DMA will copy those attributes to memory inside the PPU, where they'll be processed as the screen renders so the PPU knows where to draw the sprites.<br /><br />Unfortunately, FCEUX doesn't help much when it comes to debugging sprites. But you can open the game in Nintendulator for example, and its PPU debugger will show you all the sprites that are currently in use. From that you can tell what part of the OAM buffer is used for the sprite in question, so you can set your breakpoints accordingly. Fortunately, in this game, it looks like the sprites always occupy the same slots, so it should be easy to find the the code that populates them. Other games might cycle OAM slots every frame, making the source of a particular sprite's data harder to locate.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Immutable</b> [ Mon Oct 17, 2016 4:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I resolved the hack - but through the hex editor. <br /><br />Thanks for your help, everyone! <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Mon Oct 17, 2016 8:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oddly enough, PocketNES + NO$GBA does a great job at finding sprites.  NO$NES might also have a similar feature.<br />I think Nintendulator also has an OAM viewer?<br /><br />Edit: yeah, use Nintendulator for finding information about sprites on the screen.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Oct 17, 2016 9:23 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nintendulator is OK for this, but it still doesn't give you any visual indication of what sprite is used where in the screen, you have to deduce this from the sprite's attributes and appearance. I vaguely remember an emulator (not even sure it was an NES one) having red lines connecting the sprites in the OAM preview to their on-screen versions.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Mon Oct 17, 2016 9:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Nintendulator is OK for this, but it still doesn't give you any visual indication of what sprite is used where in the screen, you have to deduce this from the sprite's attributes and appearance. I vaguely remember an emulator (not even sure it was an NES one) having red lines connecting the sprites in the OAM preview to their on-screen versions.</div><br />NO$NES will display OAM details, and draws red lines to sprites depicting where they are when mousing over them.  Proof attached.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<a href="./download/file.php?id=6847&amp;mode=view"><img src="./download/file.php?id=6847&amp;t=1" alt="screenshot.png" /></a><br />
			<span class="gensmall">screenshot.png [ 45.67 KiB | Viewed 2835 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Tue Oct 18, 2016 12:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Cool, that's probably the one I was thinking of then.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Tue Oct 18, 2016 9:26 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question for Keisan Game: Sansuu 1 Toshi</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />OK, I cleaned up a little lua script I wrote a while ago to display sprite information in FCEUX:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
		<span class="genmed">[The extension <strong>lua</strong> has been deactivated and can no longer be displayed.]</span><br />
	</div><br />It detects the sprite height and the OAM page automatically (this is a little hacky, but appears to work just fine), and draws boxes around every sprite on the screen. You can hover the cursor over a box to get more information about a sprite. It only works for sprites transferred by $4014 DMA, from position $00 (which is what the vast majority - if not all - commercial games do), $2003 and $2004 are completely ignored. There might be bugs, I didn't test this thoroughly.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
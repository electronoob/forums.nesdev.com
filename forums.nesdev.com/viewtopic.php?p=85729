<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - NTSC color palette emulation, with the square wave modulator</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - NTSC color palette emulation, with the square wave modulator" href="http://forums.nesdev.com/feed.php?f=3&amp;t=8209" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '7');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=8209';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 11:35 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=8209&amp;start=90">NTSC color palette emulation, with the square wave modulator</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=8209"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>7</strong> of <strong>10</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 148 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=8209&amp;start=75">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=8209">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=75">6</a><span class="page-sep">, </span><strong>7</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=105">8</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=120">9</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=135">10</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=8209&amp;start=105">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=8209&amp;start=90&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=8209&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=8209&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85721"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85721"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85721#p85721"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 1:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent">It raises a new one, instead: Would that not mean that a stripe of constant color would appear having a fluctuating brightness?</div><br />No, because the color phase doesn't reset with every pixel:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&#40;hhhhhhll&#41;&#40;llllhhhh&#41;&#40;hhllllll&#41;<br />\_pixel1_/\_pixel2_/\_pixel3_/</div></div>
<br />Doesn't that only confirm that it <em>would</em> appear to have a fluctuating brightness? Pixel 1 has the total amplitude of 6*h + 2*l. Pixel 2 has 4*h + 4*l. Pixel 3 has 2*h + 6*l.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85722"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85722"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85722#p85722"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 1:48 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 454<br /><b>Location:</b> seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry, I realized I'd misread your post and explained the wrong thing, please go back and read my fixed version.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85724"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85724"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85724#p85724"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 1:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">No, because the reconstructed chroma is subtracted from the received composite signal to calculate the true brightness.</div><br />Hmm... Thanks for the explanation. I did not understand it, though... I am unsure how to phrase a question. I would think this in terms of an algorithm and I cannot figure out how to translate your words into an algorithm. I guess I will try to write something according to what I guess you meant and see if it produces anything that makes sense.<br /><br /><br /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Also the duty cycle is 50% unless you're doing something funny, not 33%.</div>
<br />Ah, sorry, my bad.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85729"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85729"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85729#p85729"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 2:33 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">the color phase doesn't reset with every pixel:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&#40;hhhhhhll&#41;&#40;llllhhhh&#41;&#40;hhllllll&#41;<br />\_pixel1_/\_pixel2_/\_pixel3_/</div></div><br />Doesn't that only confirm that it <em>would</em> appear to have a fluctuating brightness? Pixel 1 has the total amplitude of 6*h + 2*l. Pixel 2 has 4*h + 4*l. Pixel 3 has 2*h + 6*l.</div><br />An analog TV doesn't see pixel boundaries; it only sees a waveform.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">hhhhhhllllllhhhhhhllllll</div>
<br />It then uses various filters, which can be thought of as a moving weighted average, to separate this waveform into chroma (parts of the signal that are momentarily of the same frequency as the colorburst) and luma (the rest of the signal).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85734"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85734">yay</a></div><div style="float: right;"><a href="./viewtopic.php?p=85734#p85734"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 4:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think I got quite a good result. It is now much closer to what I see on the tape than it was before.
<br />Thanks tepples and lidnariq.
<br />
<br />
<br />Source code (caching code redacted for brevity, performance may be bad):
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; SDL_Surface *s;<br /><br />&nbsp; &nbsp; const int xres=256*1, yres=240*1;<br /><br />&nbsp; &nbsp; void Init&#40;&#41;<br />&nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; SDL_Init&#40;SDL_INIT_VIDEO&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; SDL_InitSubSystem&#40;SDL_INIT_VIDEO&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; s = SDL_SetVideoMode&#40;xres, yres, 32,0&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; signal&#40;SIGINT, SIG_DFL&#41;;<br />&nbsp; &nbsp; &#125;<br /><br />&nbsp; &nbsp; static unsigned framecounter=0;<br />&nbsp; &nbsp; static unsigned prev2&#91;3&#93;&#91;240&#93;&#91;xres&#93;=&#123;&#123;&#123;&#125;&#125;&#125;, colorbursts&#91;240&#93;, Colorburst=4;<br />&nbsp; &nbsp; static u16 prev1&#91;3&#93;&#91;240&#93;&#91;256&#93;=&#123;&#123;&#123;&#125;&#125;&#125;; // NES pixels corresponding to each screen location in each tweak offset<br />&nbsp; &nbsp; static bool diffs&#91;240&#93; = &#123;false&#125;;&nbsp; &nbsp; &nbsp;// Whether this scanline has changed from what it was the last time<br /><br />&nbsp; &nbsp; void PutPixel&#40;unsigned px,unsigned py, unsigned pixel&#41;<br />&nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; u16 v = 0x8000^pixel, &amp;p = prev1&#91;Colorburst/4&#93;&#91;py&#93;&#91;px&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; if&#40;p != v&#41; &#123; p = v; diffs&#91;py&#93; = true; &#125;<br />&nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; void FlushScanline&#40;unsigned py, unsigned length&#41; /* length is in pixels: 340 or 341. */<br />&nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; if&#40;py &lt; 240&#41; colorbursts&#91;py&#93; = Colorburst;<br />&nbsp; &nbsp; &nbsp; &nbsp; if&#40;py == 239&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //#pragma omp parallel for schedule&#40;guided&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&#40;py=0; py&lt;240; ++py&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned y1 = &#40;py&nbsp; &#41;*yres/240;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned y2 = &#40;py+1&#41;*yres/240;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned colorburst = colorbursts&#91;py&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto&amp; target = prev2&#91;colorburst/4&#93;&#91;py&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto&amp; line&nbsp; &nbsp;= prev1&#91;colorburst/4&#93;&#91;py&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&#40;diffs&#91;py&#93;&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float sigbuf&#91;256*8&#93;, d07=0.f, d15=0.f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float sigi&#91;256*8&#93;, sigq&#91;256*8&#93;; // Match I &amp; Q at each position.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&#40;unsigned p=0; p&lt;256*8; ++p&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Retrieve NTSC signal from PPU<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int pixel = line&#91;p/8&#93;%512, offset = &#40;colorburst+p&#41; % 12;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Decode the color index.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int color = &#40;pixel &amp; 0x0F&#41;, level = color&lt;0xE ? &#40;pixel&gt;&gt;4&#41; &amp; 3 : 1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Voltage levels, relative to synch voltage<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; static const float black=.518f, white=1.962f, attenuation=.746f,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; levels&#91;8&#93; = &#123;.350f, .518f, .962f,1.550f,&nbsp; // Signal low<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.094f,1.506f,1.962f,1.962f&#125;; // Signal high<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto wave = &#91;&#93;&#40;int p, int color&#41; &#123; return &#40;color+8+p&#41;%12 &lt; 6; &#125;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // NES NTSC modulator &#40;square wave between two voltage levels&#41;:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float spot = levels&#91;level + 4*&#40;color &lt;= 12*wave&#40;offset, color&#41;&#41;&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // De-emphasis bits attenuate a part of the signal:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&#40;&#40;&#40;pixel &amp; 0x40&#41; &amp;&amp; wave&#40;offset,12&#41;&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || &#40;&#40;pixel &amp; 0x80&#41; &amp;&amp; wave&#40;offset, 4&#41;&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || &#40;&#40;pixel &amp;0x100&#41; &amp;&amp; wave&#40;offset, 8&#41;&#41;&#41; spot *= attenuation;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Normalize:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float v = &#40;spot - black&#41; / &#40;white-black&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Apply slight signal degradation to it<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = v-0.5f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d07 = d07*0.3f + 0.7f*v;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d15 = d15*-.5f + 1.5f*v;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = 0.5f + d07*0.7f + d15*0.3f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sigbuf&#91;p&#93; = v;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto cosf = &#91;&#93;&#40;int p&#41; &#123; return std::cos&#40;3.141592653 * p / 6&#41;; &#125;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sigi&#91;p&#93; = v * cosf&#40;p+12+colorburst&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sigq&#91;p&#93; = v * cosf&#40;p+21+colorburst&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float gamma = 1.8f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&#40;unsigned x=0; x&lt;xres; ++x&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float i=0.f, q=0.f, y=0.f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&#40;int s = x*256*8 / xres, p=0; p&lt;12; ++p, ++s&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&#40;s &gt;= 0 &amp;&amp; s &lt; 256*8&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123; i += sigi&#91;s&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; q += sigq&#91;s&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y += sigbuf&#91;s&#93;; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i /= 12.f; q /= 12.f; y /= 12.f;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //float amplitude = std::sqrt&#40;i*i + q*q&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //y = 0.9f * y + 0.1f * sigbuf&#91;x * 256*8 / xres&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //float y = sigbuf&#91;x * 256*8 / xres&#93; - amplitude;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto gammafix = &#91;=&#93;&#40;float f&#41; &#123; return f &lt;= 0.f ? 0.f : std::pow&#40;f, 2.2f / gamma&#41;; &#125;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto clamp = &#91;&#93;&#40;int v&#41; &#123; return v&lt;0 ? 0 : v&gt;255 ? 255 : v; &#125;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; target&#91;x&#93; = 0x10000 * clamp&#40;255.9f* gammafix&#40;y +&nbsp; 0.946882f*i +&nbsp; 0.623557f*q&#41;&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + 0x00100 * clamp&#40;255.9f* gammafix&#40;y + -0.274788f*i + -0.635691f*q&#41;&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + 0x00001 * clamp&#40;255.9f* gammafix&#40;y + -1.108545f*i +&nbsp; 1.709007f*q&#41;&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; diffs&#91;py&#93; = false;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for&#40;unsigned y=y1; y&lt;y2; ++y&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u32* pix = &#40;&#40;u32*&#41; s-&gt;pixels&#41; + y*xres;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std::memcpy&#40;pix, target, sizeof&#40;target&#41;&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&#40;++framecounter%1 == 0&#41; SDL_Flip&#40;s&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; Colorburst = &#40;Colorburst + length*8&#41; % 12;<br />&nbsp; &nbsp; &#125;</div>
<br />
<br />Various title screens rendered in 256x240 and in, umm, 800x240, as tests (vertical scaling would only have increased post length without any information value).
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_a_i.gif" alt="Image" /> <img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_a_s.gif" alt="Image" /> <img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_a_r.gif" alt="Image" /> <img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_a_w.gif" alt="Image" />
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_b_i.gif" alt="Image" />
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_b_s.gif" alt="Image" />
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_b_r.gif" alt="Image" />
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_b_w.gif" alt="Image" />
<br />
<br />
<br />There is one thing that bothers me still in this, though. I am not calculating Y in the manner suggested by lidnariq. Instead, I am simply taking the average of the 12 amplitudes nearest to the current pixel. As a curiosity, here's what I get if I calculate the luma corresponding to the calculated chroma and subtract it from the momentary signal value...
<br />It looks a bit even weirder than it should because of aliasing artifacts.
<br />
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_ntsc_c_i.gif" alt="Image" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85739"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85739"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85739#p85739"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Oct 28, 2011 9:05 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 454<br /><b>Location:</b> seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Looks very nice!
<br />
<br />So, the way I understand NTSC demodulation works is as follows:
<br />
<br />Read the colorburst. This is phase -U. Then either do the "proper NTSC thing"  according to the standards or the cheap thing (what the majority of analog televisions did).
<br />
<br />The cheap thing: Generate new sine waves at phases U (+ve means bluish) and V (+ve means reddish). Multiply your input composite samples by both sinusoids. Horizontally spatially lowpass both of these demodulated inputs at ~1.5MHz. These are your U and V samples to be used later. Now multiply (remodulate) your lowpassed U and V outputs by the original sinusoids you generated at the top. Subtract this from the input composite signal. Possibly lowpass (less clearly necessary) this at 4MHz to get your "true" Y.
<br />
<br />The 'proper NTSC thing': Using -U, generate carriers I and Q at 57° and 147° clockwise. Demodulate I (+ve is orangish) and Q (+ve is pinkish) components the same way as above. Lowpass I and Q at 1.4 MHz and 500kHz respectively instead of the common bandwidth specified for U and V above. You now have I and Q. The rest is the same as above.
<br />
<br />As tepples pointed out, nowhere does the TV know where the pixels are, so the edges of pixels are necessarily blurred; calculating the instantaneous luma from each 8-sample subset of pixels is giving you the weird result you have on the Ice Climbers screen there. By treating each 8-sample subset as isolated, you in fact do get the light-dark pattern you were earlier asking us about.
<br />
<br />The wikipedia article on <a href="http://en.wikipedia.org/wiki/YIQ" class="postlink">YIQ</a> is my source for the above frequencies. I've also taken the image of the <a href="http://en.wikipedia.org/wiki/File:YIQ_IQ_plane.svg" class="postlink">colorspace on the YIQ article</a> and combined it with the demonstration <a href="http://en.wikipedia.org/wiki/File:SMPTE_color_bars_on_NTSC_vectorscope.png" class="postlink">output</a>  from a <a href="http://en.wikipedia.org/wiki/Vectorscope" class="postlink">Vectorscope</a> showing the <a href="http://en.wikipedia.org/wiki/SMPTE_color_bars" class="postlink">standard test bars</a> and combined them with a small overlay to show the <a href="http://eamp.org/li/ntsc/SMPTE_color_bars_on_NTSC_vectorscope_w_nes.jpg" class="postlink">NTSC NES hues</a> denoted in small black numbers.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3512">lidnariq</a> on Fri Feb 24, 2012 10:52 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85740"></a>
				<b class="postauthor">HardWareMan</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85740"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85740#p85740"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 12:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=2016.gif" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 01, 2007 11:12 am<br /><b>Posts:</b> 75
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">No one looked at my pictures from the oscilloscope? Let me tell you a terrible secret: PPU makes color subcarrier only for dyed colors. White, black and gray shades are always without subcarrier and look clearly at actual pixel boundaries. This is a terrible simplification goes against the standard of PAL / NTSC, but for decoder ultimately does not matter: there is no subcarrier means no color, simplicity doubles profit. However, the color burst is always present, because it sets the sync decoder.
<br />So, everything simple: you must stop shuffling whole lines - looks terrible. You must make 12 references for color brightness for each subcarrier phase and use it only for colored pixel index. Look at my example (wich a long time ago I made on some forum):
<br />Source:
<br /><a href="http://img515.imageshack.us/i/1rgb.png/" class="postlink"><img src="http://img515.imageshack.us/img515/8922/1rgb.th.png" alt="Image" /></a>
<br />Colored only:
<br /><a href="http://img59.imageshack.us/i/4color.png/" class="postlink"><img src="http://img59.imageshack.us/img59/685/4color.th.png" alt="Image" /></a>
<br />Colored and not colored are combined together:
<br /><a href="http://img688.imageshack.us/i/5compositebw.png/" class="postlink"><img src="http://img688.imageshack.us/img688/7058/5compositebw.th.png" alt="Image" /></a>
<br />Result:
<br /><a href="http://img59.imageshack.us/i/6composite.png/" class="postlink"><img src="http://img59.imageshack.us/img59/615/6composite.th.png" alt="Image" /></a>
<br />Quite simple, isn't it?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=2016"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85741"></a>
				<b class="postauthor">LocalH</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85741"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85741#p85741"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 1:47 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Mar 02, 2006 12:30 pm<br /><b>Posts:</b> 101
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I don't know so much about PAL, but with NTSC, the mere presence of color burst means that the set will try to decode the chroma, even where there is supposed to be none, and luma will bleed over into chroma in certain situations (it's the whole concept behind artifact colors such as seen on the Apple II, TRS-80 CoCo, and IBM CGA). It all depends on the relationship between the pixel clock and the color burst.
<br />
<br />I suppose PAL doesn't do this, however, seeing as none of the systems that can do artifact color will generate it on a PAL system, instead just outputting black and white (with occasional light color fringing but nothing that could be called "artifact color").</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=325"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85742"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85742"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85742#p85742"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 2:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">HardWareMan wrote:</div><div class="quotecontent">No one looked at my pictures from the oscilloscope? Let me tell you a terrible secret: PPU makes color subcarrier only for dyed colors.</div>
<br />I do not understand how that is a secret. That is even described at <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/NTSC_video">http://wiki.nesdev.com/w/index.php/NTSC_video</a><!-- m --> .
<br />I did look at the pictures.
<br />
<br />For comparison, here is a signal dump of what my most recent version (source code above) produces for scanline 78 of Rockman 2 title screen (right under the "Rockman" text: black, purple solid, white text (begins atop the purple, then continues atop black), black, peach solid, one pixel black, purple solid, black); right above the black line between the peach and the purple in "2".
<br />Sync/colorburst are not shown, because I do not generate them as signals (they are just shortcut-implemented as logic rather than as signal). The dump length is 256*8 samples.
<br />
<br /><a href="http://bisqwit.iki.fi/kala/snap/nesemu1_rmdump8.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/nesemu1_rmdump8_thu.png" alt="Image" /></a>
<br />Click to get a magnificated version.
<br />Sure it's not identical down to every detail, but I do not see any categorical differences.
<br />
<br />Top: Original, perfectly sharp signal. Bottom: The signal after applying two filters to it in order to get a smoother shape with some high frequency noise. This is the one that gets processed by the simulated "TV".
<br />The ones in the middle are various differently filtered versions, for testing.
<br />The gray bars in the background identify where PPU's pixels begin and end.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85743"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85743"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85743#p85743"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 5:20 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I implemented the 1.4 Mhz and 500 kHz lowpass filters to I and Q respectively. Y is filtered at 3.5 MHz. (Actual implementation weighted-averages them at 31, 86 and 12 samples respectively; it's not a perfect solution to lowpass-filtering...)
<br />It also does the 57 and 147 degree offsets to the colorburst, which means that the colors are sightly different to previous demos.
<br />It's getting a bit too large for an inline GIF, so here's a 800x600 AVI, 60.0988 FPS, 18 seconds long, 8 megabytes. Be sure to rightclick and select "save as" and not try to watch it without saving first.
<br /><!-- m --><a class="postlink" href="http://bisqwit.iki.fi/kala/snap/nesemu1_ntscmario800by600b.avi">http://bisqwit.iki.fi/kala/snap/nesemu1 ... by600b.avi</a><!-- m -->
<br />I rendered it at 2048x1536 and lanczos-scaled down to 800x600 (because not many a computer can play 2048x1536 videos at 60 fps).
<br />
<br />I did not put it to YouTube because YouTube caps the FPS at 30, which is really inconvenient when you are trying to demo something that has relevant details at higher rate than that.
<br />
<br />P.S. Initially I accidentally used for Q a ratio 143 rather than 86 for some reason. For curiosity, it's available here. Nice gradients! <!-- m --><a class="postlink" href="http://bisqwit.iki.fi/kala/snap/nesemu1_ntscmario800by600wide.avi">http://bisqwit.iki.fi/kala/snap/nesemu1 ... 00wide.avi</a><!-- m --></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> on Sat Oct 29, 2011 6:02 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85744"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85744"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85744#p85744"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 5:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just a little question: the NES output come from the RF or composite cable for those pics?</div>

					
						<div class="postbody"><br />_________________<br /><strong>Zepper</strong><br /><a href="http://rocknes.web.fc2.com/" class="postlink"><em>RockNES developer</em></a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85745"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85745"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85745#p85745"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 5:49 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 186
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">Just a little question: the NES output come from the RF or composite cable for those pics?</div>
<br />Is not the difference only in whether it is modulated by the aerial carrier frequency (i.e. RF modulation) and whether the audio is also transmitted along it?
<br />I'm not doing audio side-effects in this simulation, and I also ignore any side-effects caused by the RF modulation.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85746"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85746"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85746#p85746"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 29, 2011 6:21 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">Just a little question: the NES output come from the RF or composite cable for those pics?</div><br />Is not the difference only in whether it is modulated by the aerial carrier frequency (i.e. RF modulation) and whether the audio is also transmitted along it?</div>
<br />That, and the fact that RF is supposed to have a low-pass at 4.2 MHz, and the fact that RF tends to have more noise.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p85763"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85763"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85763#p85763"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 30, 2011 10:09 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just want to say that I find it really cool that you are going this far to emulate the NES. Most people don't care about faithful video emulation.
<br />
<br />Why do flat areas have diagonal stripes though? I don't think my NES does this, or blargg's NTSC filter either.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p85765"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p85765"></a></div><div style="float: right;"><a href="./viewtopic.php?p=85765#p85765"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 30, 2011 10:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Why do flat areas have diagonal stripes though?</div>
<br />Bisq and I discussed this on IRC, and it appears the filter for Y (luma) wasn't rejecting <em>all</em> of the chroma signal. The stopband attenuation around 3.6 MHz needed to be several dB greater. We tried switching to a 12-sample box filter for Y, and the stripes disappeared.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=8209&amp;start=90"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=8209"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>7</strong> of <strong>10</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 148 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=8209&amp;start=75">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=8209">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=75">6</a><span class="page-sep">, </span><strong>7</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=105">8</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=120">9</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=8209&amp;start=135">10</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=8209&amp;start=105">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=28">jsr</a> and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="8209" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
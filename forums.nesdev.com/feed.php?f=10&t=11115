<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=10&amp;t=11115" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2014-04-04T12:43:01-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=10&amp;t=11115</id>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2014-04-04T12:43:01-07:00</updated>
<published>2014-04-04T12:43:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127424#p127424</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127424#p127424"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127424#p127424"><![CDATA[
They're all working fine for me in 2.2.2 so possibly it's been fixed?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Fri Apr 04, 2014 12:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-04-04T10:12:51-07:00</updated>
<published>2014-04-04T10:12:51-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127421#p127421</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127421#p127421"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127421#p127421"><![CDATA[
In FCEUX 2.2.0, I've run into problems where PPU:, Scanline:, and Pixel: don't update properly when I step through a program. Is this fixed in the latest version?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Apr 04, 2014 10:12 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2014-04-04T10:03:19-07:00</updated>
<published>2014-04-04T10:03:19-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127420#p127420</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127420#p127420"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127420#p127420"><![CDATA[
FCEUXD is really old, I suggest getting the latest FCEUX. I don't know what the debugger looks like in FCEUXD, but here's where to find the VRAM address in FCEUX 2.2.2<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Fri Apr 04, 2014 10:03 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[DrDementia]]></name></author>
<updated>2014-04-04T09:15:04-07:00</updated>
<published>2014-04-04T09:15:04-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127419#p127419</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127419#p127419"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127419#p127419"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />the correct way to (re)set the scroll is not to manipulate the address register directly, but using the registers that are actually meant to control scrolling: $2000 (name table selection) and $2005 (pixel scroll within the selected name table).<br /></div><br /><br />so looking at this <a href="http://wiki.nesdev.com/w/index.php/PPU_registers" class="postlink">page</a><br />trying to get a better understanding of how this works.<br /><br />And shiru's &quot;vram_adr&quot; does this <br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">_vram_adr:<br />   stx PPU_ADDR<br />   sta PPU_ADDR<br />   rts</div><br /><br />and he has PPU_ADDR defined as $2006. which matches the wiki, but what's in x,a? the example on the wiki of writing to $2006 makes a little more sense<br /> <br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   lda #$21<br />  sta PPUADDR<br />  lda #$08<br />  sta PPUADDR</div><br /> <br />here  $21,$08 are getting loaded into a and then stored to PPUADDR (upper byte first)<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />This register is internal to the PPU and you can't watch it by looking at memory addresses. The emulator has to show you its value. I think FCEUX's debugger shows you the current VRAM address, others might too.<br /></div><br /><br />FCEUXD shows a,x,y but I didn't see the current vram address anywhere. might be there somewhere though<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6237">DrDementia</a> — Fri Apr 04, 2014 9:15 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2014-04-04T07:45:34-07:00</updated>
<published>2014-04-04T07:45:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127411#p127411</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127411#p127411"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127411#p127411"><![CDATA[
<div class="quotetitle">DrDementia wrote:</div><div class="quotecontent"><br />so say I write to 0x2180 after that I should set the scroll back to 0x2000 where my nametable starts and was loaded to. like this?<br />vram_adr(0x2000);<br /></div><br />I can't say anything specific to programming in C, because I only program in assembly, but the correct way to (re)set the scroll is not to manipulate the address register directly, but using the registers that are actually meant to control scrolling: $2000 (name table selection) and $2005 (pixel scroll within the selected name table). The library you're using should provide a way to set the scroll through $2000 and $2005, you should look for that.<br /><br />The address register should only be manipulated for scrolling purposes when changing the scroll OUTSIDE of VBlank, like is done for status bars and parallax effects, which I'm pretty sure is not your case.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />where's that register located in memory, maybe I can use a debugger and watch that spot, that may help me understand what's going on.<br /></div><br />This register is internal to the PPU and you can't watch it by looking at memory addresses. The emulator has to show you its value. I think FCEUX's debugger shows you the current VRAM address, others might too.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Fri Apr 04, 2014 7:45 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[DrDementia]]></name></author>
<updated>2014-04-04T06:54:06-07:00</updated>
<published>2014-04-04T06:54:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127410#p127410</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127410#p127410"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127410#p127410"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br /><div class="quotetitle">DrDementia wrote:</div><div class="quotecontent">(making the screen scroll to where I write to)<br /></div><br />This is a symptom of not resetting the scroll after writing/reading to/from PPU memory. See, the internal address register programs use to access PPU memory is the same one the PPU uses when reading its own memory for rendering images, so rendering will start from wherever that register points to when rendering starts. After you're done updating VRAM, you should always set the scroll to the place where you want rendering to start from.</div><br /><br />so say I write to 0x2180 after that I should set the scroll back to 0x2000 where my nametable starts and was loaded to. like this?<br />vram_adr(0x2000);<br /><br /><br />where's that register located in memory, maybe I can use a debugger and watch that spot, that may help me understand what's going on.<br /><br />@RW I 'm going to test some stuff out and reply to your post.<br />thanks guys for trying to help me figure out this out. it's annoying me a bit I can't get this to work correctly.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6237">DrDementia</a> — Fri Apr 04, 2014 6:54 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2014-04-03T21:20:29-07:00</updated>
<published>2014-04-03T21:20:29-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127396#p127396</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127396#p127396"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127396#p127396"><![CDATA[
The problem, I think, is with the implementation of ppu_on_all().<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">_ppu_on_all:<br />   lda &lt;PPU_MASK_VAR<br />   ora #%00011000<br />ppu_onoff:<br />   sta &lt;PPU_MASK_VAR<br />   sta PPU_MASK<br />   jsr _ppu_waitnmi<br />   lda #$00<br />   sta PPU_ADDR<br />   sta PPU_ADDR<br />   lda &lt;PPU_CTRL_VAR<br />   sta PPU_CTRL<br />   rts</div><br />Please correct me if I'm wrong in this analysis, but this turns on rendering immediately, which means it might happen in the middle of a frame somewhere, giving you half a blank screen and half of an incorrectly scrolled screen for the first frame it is turned on. Next it waits for an NMI to complete and immediately sets the VRAM address to 0, which will force the scroll to 0,0 for the second frame (unless the NMI routine is finished before the end of vblank -- this might depend whether or not music is playing). It will only start applying your scroll correctly on the third frame, as far as I can tell.<br /><br />The purpose of ppu_off() and ppu_on_all() is generally to leave rendering disabled for an extended period of time (i.e. multiple frames) while you make some changes to the nametable (direct vram writes). If you're only turning off rendering occasionally, the two frames of incorrect apperance might not be a big deal, and for a game where the scrolling is supposed to be at 0,0 anyway, you're only talking about one frame of incorrect appearance.<br /><br />You may want to remove these 3 lines from _ppu_on_all:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   lda #$00<br />   sta PPU_ADDR<br />   sta PPU_ADDR</div><br />These lines serve no purpose, as the correct scroll will already get applied during the line: jsr _ppu_waitnmi<br /><br />This should cut the incorrect visual down to a single half-rendered frame.<br /><br /><br />In the examples he provided, this half-rendered frame seems to be hidden by an all-black palette. The new palette doesn't get applied until the _ppu_waitnmi subroutine, so the bad frame is not seen. The second problem frame is also not an issue since all the examples start at 0,0 scroll anyway. This might explain why _ppu_on_all does not appear very robust; in the way shiru was using it, there really is no problem to be seen. You could hide the problem yourself by clearing the palette, and rendering one frame before calling ppu_off():<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pal_clear()<br />ppu_waitnmi()<br />ppu_off()<br />// ... do your vram writes here<br />// ... setup your new palette<br />ppu_on_all()</div><br />This adds an extra frame of latency to your turning off the PPU (probably negligible), but should hide the half-rendered frame.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Thu Apr 03, 2014 9:20 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2014-04-03T20:44:20-07:00</updated>
<published>2014-04-03T20:44:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127395#p127395</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127395#p127395"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127395#p127395"><![CDATA[
<div class="quotetitle">DrDementia wrote:</div><div class="quotecontent"><br />(making the screen scroll to where I write to)<br /></div><br />This is a symptom of not resetting the scroll after writing/reading to/from PPU memory. See, the internal address register programs use to access PPU memory is the same one the PPU uses when reading its own memory for rendering images, so rendering will start from wherever that register points to when rendering starts. After you're done updating VRAM, you should always set the scroll to the place where you want rendering to start from.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Thu Apr 03, 2014 8:44 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[DrDementia]]></name></author>
<updated>2014-04-03T18:40:12-07:00</updated>
<published>2014-04-03T18:40:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127393#p127393</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127393#p127393"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127393#p127393"><![CDATA[
don't worry about it guys, it wasn't really that OT. I was turning the ppu off/on because that's the only way shiru's vram_write works. <br /><br />another odd thing I noticed vram_put is displaying similar odd behavior (making the screen scroll to where I write to) when I compile some of my old code with the new version of neslib. the code worked fine in the old version. might be my version of cc65. <br />Wish shiru would mention what version he used, or link it or something.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6237">DrDementia</a> — Thu Apr 03, 2014 6:40 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-03-25T06:36:38-07:00</updated>
<published>2014-03-25T06:36:38-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127155#p127155</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127155#p127155"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127155#p127155"><![CDATA[
A clean split isn't possible because of too many posts dealing with both topics. I've summarized the discussion so far to <a href="http://forums.nesdev.com/viewtopic.php?p=127154#p127154" class="postlink">this post</a>.<br /><br />Now back to your regularly scheduled &quot;write to vram - in c problems&quot;.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Tue Mar 25, 2014 6:36 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Movax12]]></name></author>
<updated>2014-03-24T23:22:39-07:00</updated>
<published>2014-03-24T23:22:39-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127153#p127153</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127153#p127153"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127153#p127153"><![CDATA[
I need all I can get, to a point. The game I was working on could run even better with more write time. Feel free to split to a new thread.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4680">Movax12</a> — Mon Mar 24, 2014 11:22 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-03-24T21:40:58-07:00</updated>
<published>2014-03-24T21:40:58-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127152#p127152</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127152#p127152"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127152#p127152"><![CDATA[
[ot]<br />The difference between enabling during prerender and enabling after start of picture is that as long as rendering is reenabled before x=304 of the pre-render line, no special &quot;skinny&quot; address write sequences are needed to set the scroll position.<br />[/ot]<br /><br />Anyway, unless you're updating a LOT of video memory at once (CHR RAM animation, rapid scrolling, sub-screen scrolling, or FMV playback), you shouldn't need to worry about micro-optimizing video memory updates yet. <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it" class="postlink">You probably aren't gonna need it</a> right now, and when you do, let us know.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Mon Mar 24, 2014 9:40 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2014-03-24T21:23:04-07:00</updated>
<published>2014-03-24T21:23:04-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127151#p127151</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127151#p127151"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127151#p127151"><![CDATA[
Oh, so it's not really any different than the regular technique of keeping rendering off at the top of the screen, only where you happen to be turning back on? Okay. (Anyhow, sorry for the hijack.)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Mon Mar 24, 2014 9:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2014-03-24T20:32:51-07:00</updated>
<published>2014-03-24T20:32:51-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127150#p127150</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127150#p127150"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127150#p127150"><![CDATA[
<div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent"><br />If disabling rendering during vblank gives a performance boost I'd like to read more about it<br /></div><br />There's no performance boost, you just get a little extra time for PPU memory accesses because the PPU itself won't be accessing memory during the pre-render scanline when rendering is off. Personally, I prefer to not disable rendering, but I wouldn't think twice about doing if I needed a few more dozen cycles of VBlank time.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Mon Mar 24, 2014 8:32 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2014-03-24T19:10:16-07:00</updated>
<published>2014-03-24T19:10:16-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127149#p127149</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127149#p127149"/>
<title type="html"><![CDATA[Re: write to vram - in c problems]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11115&amp;p=127149#p127149"><![CDATA[
I'm referring specifically to the consequences of shiru's routine ppu_on_all, and only that. If you call it every frame you're going to get a visual problem.<br /><br />If disabling rendering during vblank gives a performance boost I'd like to read more about it, actually, but I think it's a bit off topic in this thread. (I can't seem to find information about this on the wiki.)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Mon Mar 24, 2014 7:10 pm</p><hr />
]]></content>
</entry>
</feed>
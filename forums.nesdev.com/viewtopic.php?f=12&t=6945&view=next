<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - n00b SNESdev questions</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - n00b SNESdev questions" href="http://forums.nesdev.com/feed.php?f=12&amp;t=6945" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 2:28 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=6946">n00b SNESdev questions</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=6946"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=6946&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=6946&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=6946&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p67367"></a>
				<b class="postauthor">artakserkso</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67367">n00b SNESdev questions</a></div><div style="float: right;"><a href="./viewtopic.php?p=67367#p67367"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 08, 2010 5:01 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 01, 2009 4:29 pm<br /><b>Posts:</b> 34<br /><b>Location:</b> Samobor, Croatia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, here's some code I threw together with help of Bazz's tutorial (available <a href="http://wiki.superfamicom.org/snes/show/HomePage" class="postlink">here</a>). In bsnes it works fine, so I thought it should work on the SNES PowerPak after a quick ucon64 -padn=524288. It doesn't.
<br />
<br />The point is showing a Mario sprite in the middle of the screen and doing nothing until Right on the D-pad is pressed. That's when the Mario sprite should do... Guess what! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />
<br />
<br />So far I've had no trouble with padding something small/homebrew for the PowerPak and getting it to run (for example, when I had no joypad code and only wanted to put Mario on screen).
<br />
<br />This time Mario either pops up on screen, does nothing when I press anything and after a while <em>dissapears</em> off screen. Huh?! Sometimes when I reset or recopy the code from CF, he doesn't appear on screen at all. I'm very puzzled by all this.
<br />
<br />Anyway, here's the code. Also, any good programming tips I might be able to use are highly appreciated. Sorry for the code being messy as all hell.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.INCLUDE &quot;header.inc&quot;<br />.INCLUDE &quot;initsnes.asm&quot;<br /><br />.MACRO LoadPalette&nbsp; &nbsp;&nbsp; &nbsp;;DMA transfers a palette to CGRAM &#40;A:8b,XY:16b&#41;<br />&nbsp; &nbsp;lda #\2&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;;args: 24b source, 8b dest, 8b number of colors<br />&nbsp; &nbsp;sta $2121<br />&nbsp; &nbsp;lda #:\1<br />&nbsp; &nbsp;ldx #\1<br />&nbsp; &nbsp;ldy #&#40;\3*2&#41;<br />&nbsp; &nbsp;jsr DMAPalette<br />.ENDM<br /><br />.MACRO LoadBlockToVRAM&nbsp; &nbsp;&nbsp; &nbsp;;DMA transfers a block to VRAM &#40;A:8b,XY:16b&#41;<br />&nbsp; &nbsp;ldx #\2&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;args: 24b source, 16b dest, 8b size in bytes<br />&nbsp; &nbsp;stx $2116<br />&nbsp; &nbsp;lda #:\1<br />&nbsp; &nbsp;ldx #\1<br />&nbsp; &nbsp;ldy #\3<br />&nbsp; &nbsp;jsr LoadVRAM<br />.ENDM<br /><br />.BANK 0 SLOT 0<br />.ORG 0<br /><br /><br />.ENUM $0002<br />Joy1Raw&nbsp; &nbsp; &nbsp;DW&nbsp; &nbsp; &nbsp; ; Holder of RAW joypad data from register &#40;from last frame&#41;<br />Joy2Raw&nbsp; &nbsp; &nbsp;DW<br /><br />Joy1Press&nbsp; &nbsp;DW&nbsp; &nbsp; &nbsp; ; Contains only pressed buttons &#40;not held down&#41;<br />Joy2Press&nbsp; &nbsp;DW<br /><br />Joy1Held&nbsp; &nbsp; DW&nbsp; &nbsp; &nbsp; ; Contains only buttons that are Held<br />Joy2Held&nbsp; &nbsp; DW<br /><br />&nbsp;.ENDE<br /><br />&nbsp; &nbsp;<br />.SECTION &quot;Main&quot;<br />&nbsp; &nbsp;<br />Start:<br />&nbsp; &nbsp;InitSNES<br />&nbsp; &nbsp;lda #$80<br />&nbsp; &nbsp;sta $4200<br />&nbsp; &nbsp;lda #$80&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;don't increment VRAM address until written to $2119<br />&nbsp; &nbsp;sta $2115&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;&#40;as opposed to $2118&#41;<br />&nbsp; &nbsp;LoadPalette SprPal, 128, 16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sprite palettes start at 128<br />&nbsp; &nbsp;LoadBlockToVRAM Sprite, $0000, $0800<br />&nbsp; &nbsp;jsr SpriteInit<br />&nbsp; &nbsp;lda #&#40;256/2-16&#41;<br />&nbsp; &nbsp;sta $0000<br />&nbsp; &nbsp;lda #&#40;224/2-16&#41;<br />&nbsp; &nbsp;sta $0001<br />&nbsp; &nbsp;lda #%01010100<br />&nbsp; &nbsp;sta $0200<br />&nbsp; &nbsp;jsr SetupVideo<br />&nbsp; &nbsp;<br />loop:<br />&nbsp; &nbsp;wai<br />&nbsp; &nbsp;lda Joy1Press+1<br />&nbsp; &nbsp;and #$01<br />&nbsp; &nbsp;beq loop<br />&nbsp; &nbsp;inc $0000<br />&nbsp; &nbsp;inc $0000<br />&nbsp;&nbsp; &nbsp;jmp loop<br /><br />SetupVideo:<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;rep #$10<br />&nbsp; &nbsp;sep #$20<br />&nbsp; &nbsp;stz $2102<br />&nbsp; &nbsp;stz $2103<br />&nbsp; &nbsp;ldy #$0400<br />&nbsp; &nbsp;sty $4300<br />&nbsp; &nbsp;stz $4302<br />&nbsp; &nbsp;stz $4303<br />&nbsp; &nbsp;lda #$7E<br />&nbsp; &nbsp;sta $4304<br />&nbsp; &nbsp;ldy #$0220<br />&nbsp; &nbsp;sty $4305<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $420B<br />&nbsp; &nbsp;lda #%10100000<br />&nbsp; &nbsp;sta $2101<br />&nbsp; &nbsp;lda #%00010000<br />&nbsp; &nbsp;sta $212C<br />&nbsp; &nbsp;lda #$0F<br />&nbsp; &nbsp;sta $2100<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rts<br /><br />LoadVRAM:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;initiates DMA transfer to VRAM<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;stx $4302<br />&nbsp; &nbsp;sta $4304<br />&nbsp; &nbsp;sty $4305<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $4300&nbsp; &nbsp;&nbsp; &nbsp;;first write to $2118, then $2119, then $2118...<br />&nbsp; &nbsp;lda #$18<br />&nbsp; &nbsp;sta $4301<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $420B<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rts<br />&nbsp; &nbsp;<br />DMAPalette:&nbsp; &nbsp;&nbsp; &nbsp; ;initiates DMA transfer to CGRAM<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;stx $4302<br />&nbsp; &nbsp;sta $4304<br />&nbsp; &nbsp;sty $4305<br />&nbsp; &nbsp;stz $4300&nbsp; &nbsp;&nbsp; &nbsp;;only write to $2122<br />&nbsp; &nbsp;lda #$22<br />&nbsp; &nbsp;sta $4301<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $420B<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rts<br /><br />SpriteInit:&nbsp; &nbsp;&nbsp; &nbsp; ;move all sprites off screen<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;rep #$30<br />&nbsp; &nbsp;ldx #$0000<br />&nbsp; &nbsp;lda #$01<br />_offscreen:<br />&nbsp; &nbsp;sta $0000,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;cpx #$0200<br />&nbsp; &nbsp;bne _offscreen<br /><br />&nbsp; &nbsp;lda #$5555<br />&nbsp; &nbsp;ldx #$0000<br />_xsmb:<br />&nbsp; &nbsp;sta $0200,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;cpx #$0020<br />&nbsp; &nbsp;bne _xsmb<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rts<br />&nbsp; &nbsp;<br />VBlank:<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;jsr Joypad<br />&nbsp; &nbsp;stz $2102<br />&nbsp; &nbsp;stz $2103<br />&nbsp; &nbsp;sep #$20<br />&nbsp; &nbsp;lda $0000<br />&nbsp; &nbsp;sta $2104<br />&nbsp; &nbsp;lda $0001<br />&nbsp; &nbsp;sta $2104<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rti<br /><br />Joypad:<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;rep #$30<br />&nbsp; &nbsp;lda $4212<br />&nbsp; &nbsp;and #$01<br />&nbsp; &nbsp;beq Joypad<br />&nbsp; &nbsp;lda #$81<br />&nbsp; &nbsp;sta $4200<br />&nbsp; &nbsp;ldx Joy1Raw<br />&nbsp; &nbsp;lda $4218<br />&nbsp; &nbsp;sta Joy1Raw<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;eor Joy1Raw<br />&nbsp; &nbsp;and Joy1Raw<br />&nbsp; &nbsp;sta Joy1Press<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;and Joy1Raw<br />&nbsp; &nbsp;sta Joy1Held<br />&nbsp; &nbsp;plp<br />&nbsp; &nbsp;rts&nbsp; &nbsp;<br />.ENDS<br />&nbsp; &nbsp;<br />.BANK 1 SLOT 0<br />.ORG 0<br />.SECTION &quot;CharacterData&quot;<br />Sprite:<br />&nbsp; &nbsp;.INCBIN &quot;biker.pic&quot;<br /><br />SprPal:<br />&nbsp; &nbsp;.INCBIN &quot;biker.clr&quot;<br />.ENDS<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4096"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p67369"></a>
				<b class="postauthor">mic_</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67369"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67369#p67369"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 08, 2010 5:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Oct 05, 2006 6:29 am<br /><b>Posts:</b> 686
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I didn't do a full analysis so there may be other problems as well, but this:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Joypad:<br />&nbsp; &nbsp;php<br />&nbsp; &nbsp;rep #$30<br />&nbsp; &nbsp;lda $4212<br />&nbsp; &nbsp;and #$01<br />&nbsp; &nbsp;beq Joypad <br /></div>
<br />does not seem like a good idea, since you could end up trashing the stack completely by having the PHP instruction inside the loop.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=1181"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p67376"></a>
				<b class="postauthor">artakserkso</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67376"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67376#p67376"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 08, 2010 7:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 01, 2009 4:29 pm<br /><b>Posts:</b> 34<br /><b>Location:</b> Samobor, Croatia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I knew it was something ridiculous, but this...  <img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> 
<br />
<br />Thanks, mic_!
<br />
<br />I have to be more careful with the P reg...
<br />
<br />Btw, Mario moves a bit differently than I would have expected him to. If I tap Right fairly quickly (without trying too much), but at constant speed, Mario only moves once every two taps. Also, when I press and hold Right, he moves every half-second or so.
<br />
<br />In bsnes, however, pressing and holding Right only moves him once and tapping quickly really does move him as many times as I tap (this behaviour is what I would expect and like). Guess that must have something to do with cycles and my taking care of VBlank/the Joypad routine improperly.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4096"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p67378"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67378"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67378#p67378"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 08, 2010 8:06 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9047<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">If you enable automatic joypad reading (bit 0 of $4200 = 1), it takes about three scanlines after vertical blank for the bits of $4218-$421F to settle. So do your DMA transfers to VRAM and wait for the controller reads to finish (that is, wait for bit 0 of $4212 to become 0) before you read them.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p67381"></a>
				<b class="postauthor">artakserkso</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67381"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67381#p67381"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 08, 2010 8:49 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 01, 2009 4:29 pm<br /><b>Posts:</b> 34<br /><b>Location:</b> Samobor, Croatia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ah, right... You only need to set bit 0 of $4200 once. Noted.
<br />
<br />Also, I already had the wait for joypad stuff. But I accidentally put rep #$30 after the check, which probably meant I waited too long from when the joypad was ready to actually reading it.
<br />
<br />Thanks, tepples, it now works as it should!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4096"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p67416"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67416"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67416#p67416"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 09, 2010 6:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 517
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">In bsnes, however, pressing and holding Right only moves him once and tapping quickly really does move him as many times as I tap (this behaviour is what I would expect and like).</div>
<br />
<br />You mean it works differently on real hardware?
<br />
<br />Yeah, that's most likely auto joypad polling. It strobes the controller between V=225 to V=227, bit-by-bit. But unfortunately nobody knows how that strobe works. blargg looked into the timing for me, but it turns out to be ridiculously complex.
<br />
<br />At the moment, I do all the polling at V=227. So if you read at V=225 with that on, you're basically getting the previous frames' completed state, whereas on the real thing you'd get weird data back.
<br />
<br />There's a small number of things even I can't do yet:
<br />- auto joypad polling
<br />- CPU revision 1 HDMA&lt;&gt;DMA conflict crashing
<br />- CPU&lt;&gt;SMP bus conflict issues
<br />- CGRAM/OAM writes mid-scanline going to the wrong addresses
<br />- SMP test register has two timing bits, and r1 has a rare timer glitch
<br />- DSP has a mute pulse, not an instant mute
<br />- initial memory states are not 'randomized' like the real thing
<br />- PPU doesn't always cache registers at the right times for mid-scanline writes
<br />
<br />Outside of those issues, and bugs we don't even know about yet, it should be perfect.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p67426"></a>
				<b class="postauthor">artakserkso</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p67426"></a></div><div style="float: right;"><a href="./viewtopic.php?p=67426#p67426"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Sep 10, 2010 3:44 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 01, 2009 4:29 pm<br /><b>Posts:</b> 34<br /><b>Location:</b> Samobor, Croatia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks a lot for the inside info, byuu, that's always great to hear!
<br />
<br />I hope some day the issues you mentioned get sorted out.
<br />
<br />By the way, bsnes is fantastic. It really helps when I have to test my code. I absolutely adore the debugger. Without the memory editor, I'm completely certain I'd never be able to understand why my code fails at first.
<br />
<br />Keep up the good work!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4096"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=6946"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=6946"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="6946" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
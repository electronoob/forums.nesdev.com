<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Help me fix Wizards &amp; Warriors</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Help me fix Wizards &amp; Warriors</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1998">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1998</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Sep 08, 2006 7:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Help me fix Wizards &amp; Warriors</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've been trying to track down this issue for some time, but can't quite figure it out.
<br />
<br /><img src="http://slepicka.net/images/ww.jpg" alt="Image" />
<br />Look at the line below the castle -- looks like I'm changing name tables at the wrong time.  I suspect that my NMI/vblank timing is off, but I can't figure out why.  In game, I see some other anomolies as well (flickering when entering the first level, or when showing the treasure screen), but it otherwise plays fine.
<br />
<br />Has anyone else run into this issue and/or have any advice?
<br />
<br />Thanks,
<br />James

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Sep 08, 2006 10:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So you're the guy with the 'James' username... Grr!
<br />
<br />It's hard to tell what the problem is. Nestopia runs the game without the corruption, so it is your emulator and not a normal bug. Since I do not have access to your code, then I strongly recommend some of blargg's PPU tests.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Sep 08, 2006 10:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So you're the guy with the 'James' username... Grr! </div><br />yep <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">blargg's PPU tests</div>
<br />I can't get to the site right now (is it down?), so I will try later and/or bug blargg for them.
<br />
<br />p.s. -- source code (an older version of it at least) is available at the website in my sig.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Sep 08, 2006 1:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">James wrote:</div><div class="quotecontent">nemulator and nemulator.com copyright Â© 2003-2005 James Slepicka. nemulator is a trademark of James Slepicka.</div>
<br />
<br />You're called James Slepicka too!? Where are you from?
<br />
<br />I downloaded you source code. Nice to see an emulator without 1,000,000 files. Even better to see someone working in C++ and not C.
<br />
<br />I've had a quick look through your code, but I haven't the time right now to read it all. The best bet is to wait until you can get your hands on blargg's tests.
<br />
<br />I do have one comment though;
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void CMemoryBus::WriteByte&#40;WORD Address, unsigned char Value&#41;<br />&#123;<br />&nbsp; &nbsp;if &#40;Address &gt;= 0x8000&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;Cart-&gt;WriteByte&#40;Address, Value&#41;;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x6000&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;!Cart-&gt;writeProtectSram&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Sram&#91;Address - 0x6000&#93; = Value;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x5000&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;//write to expansion modules<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x2000&#41;...</div><br /><br />You should have return; inside of those statements, otherwise it will continue to check code even when it is unnecessary.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">int Function&#40;&#41;<br />&#123;<br />&nbsp; &nbsp;if&#40; !x &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;x = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;if&#40; !y &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;y = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;if&#40; !z &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;z = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&#125;</div><br /><br />The return; statements ensure that that does not happen. Alternatively, I use the following;<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">int WriteMem&#40;&#41;<br />&#123;<br />&nbsp; &nbsp;switch&#40;Address&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 0x0000: return CPU.Memory&#91;0x0000&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 0x2000: return CPU.Memory&#91;0x2000&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 0x5003: SRAM&#91;0x0003&#93; = 0xXXXX;<br />&nbsp; &nbsp;&nbsp; &nbsp;etc...<br />&nbsp; &nbsp;&#125;<br />&#125;</div>
<br />
<br />Big, but very effective. Every case is catered for. Very specific.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Quietust</b> [ Fri Sep 08, 2006 1:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">void CMemoryBus::WriteByte&#40;WORD Address, unsigned char Value&#41;<br />&#123;<br />&nbsp; &nbsp;if &#40;Address &gt;= 0x8000&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;Cart-&gt;WriteByte&#40;Address, Value&#41;;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x6000&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;!Cart-&gt;writeProtectSram&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;Sram&#91;Address - 0x6000&#93; = Value;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x5000&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;//write to expansion modules<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;else if &#40;Address &gt;= 0x2000&#41;...</div><br /><br />You should have return; inside of those statements, otherwise it will continue to check code even when it is unnecessary.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">int Function&#40;&#41;<br />&#123;<br />&nbsp; &nbsp;if&#40; !x &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;x = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;if&#40; !y &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;y = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;if&#40; !z &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;z = 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;return;<br />&nbsp; &nbsp;&#125;<br />&#125;</div><br /><br />The return; statements ensure that that does not happen.</div>
<br />
<br />Actually, that is not true - his original code did if / <strong>else</strong> if / <strong>else</strong> if / etc., which means it will skip all the way to the end once it handles one successful condition.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Sep 08, 2006 1:44 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />True. But something to be very wary of for future reference.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Sep 08, 2006 1:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">You should have return; inside of those statements, otherwise it will continue to check code even when it is unnecessary.</div>You should look up the meaning of "<a href="http://www.its.strath.ac.uk/courses/c/subsection3_8_1.html" class="postlink">else</a>" first and then remove your off-topic comments unrelated to the bug the author was asking about.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Sep 08, 2006 1:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">You're called James Slepicka too!? Where are you from?</div><br />You too?  Seriously?!?  PM or email me (james at nemulator dot com)<br /><br /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">I downloaded you source code. Nice to see an emulator without 1,000,000 files. Even better to see someone working in C++ and not C. </div><br />Thanks!  I like it.  It's a bit of a mess, but that's what sporadically working on something for years -- and learning/changing styles in the meantime -- will do.  It's in need of a rewrite.<br /><br /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">otherwise it will continue to check code even when it is unnecessary.</div>
<br />With an if/else, the compiler will generate code that will not check each condition (you can verify this in the asm output).  In any event, in later versions, I changed this to a switch statement:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">switch &#40;Address &gt;&gt; 12&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;case 0:<br />&nbsp; &nbsp;case 1:<br />&nbsp; &nbsp;&nbsp; &nbsp;return cpuRam&#91;Address &amp; 0x7FF&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;case 2:<br />&nbsp; &nbsp;case 3:<br />&nbsp; &nbsp;case 4:<br />&nbsp; &nbsp;&nbsp; &nbsp;if &#40;Address &lt;= 0x2007&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; ...<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Sep 08, 2006 1:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">You should have return; inside of those statements, otherwise it will continue to check code even when it is unnecessary.</div>You should look up the meaning of "<a href="http://www.its.strath.ac.uk/courses/c/subsection3_8_1.html" class="postlink">else</a>" first and then remove your off-topic comments unrelated to the bug the author was asking about.</div>
<br />
<br />Back off. I was only trying to help. I have already pointed him in the right direction anyway.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Sep 08, 2006 1:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />hey blargg -- long time.  Hope all is well.  Above I mentioned that I couldn't download the test roms from your site.  Is it down?  Do you have an alternate location?
<br />
<br />Thanks,
<br />James

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>laughy</b> [ Fri Sep 08, 2006 10:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />wtf, two people with the name "James Slepicka" both writing nes emulators? odds anyone?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sat Sep 09, 2006 1:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" />  <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> 
<br />
<br />Dude, it was a joke.
<br />
<br /> <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>laughy</b> [ Sun Sep 10, 2006 3:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm confused. Why do people like to confuse poor laughy <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Mon Sep 11, 2006 7:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />!nuf s'it esuaceB.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Mon Sep 11, 2006 11:01 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok -- not quite fixed yet (still some timing issue), but it turns out that I was not correctly accounting for cpu cycles used by sprite DMA transfers.  oops...

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - sd2snes</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">sd2snes</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=12&amp;t=7361">http://forums.nesdev.com/viewtopic.php?f=12&amp;t=7361</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>4</strong> of <strong>7</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hilmarf</b> [ Thu Apr 14, 2011 5:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Got myself a snes powerpak, but still...I'm interested to know if you will produce sd2snes units

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Fri Jun 17, 2011 5:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Finished the uPD77C25 core. DSP1-4 work fine. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> (DSPx roms required.)
<br />
<br />There will probably be a first batch of 100 sd2sneses this year, maybe another 100 next year. Not so sure yet.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sat Jun 18, 2011 2:02 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />&gt; Finished the uPD77C25 core. DSP1-4 work fine. Smile (DSPx roms required.)
<br />
<br />Neat :D
<br />Is there enough memory to support the ST-0010 and ST-0011? It needs 52KB instead of 8KB per game, but the instruction set is the same, just with a new jump mechanism.
<br />
<br />If not, I believe we can get ST-0010 support in there by intentionally trimming the ROM (it's 90% padding) and treating it like a 7725 instead of a 96050. That game barely uses the chip at all.
<br />
<br />Also, if you haven't stopped by my forum recently, we were able to RE the Hitachi HG51B169 (Cx4) for MMX2/MMX3. The program ROM is stored on the mask ROM, and you only need 0x1800 bytes for data RAM+data ROM. It does have a high clock rate though, 20MHz. May not be worth the work/FPGA space for only two games.
<br />
<br />&gt; There will probably be a first batch of 100 sd2sneses this year, maybe another 100 next year. Not so sure yet.
<br />
<br />Awesome! Please save one for me to buy :D

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Sat Jun 18, 2011 2:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Awesome! Please save one for me to buy</div>
<br />+1 on that.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Sat Jun 18, 2011 3:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Is there enough memory to support the ST-0010 and ST-0011? It needs 52KB instead of 8KB per game, but the instruction set is the same, just with a new jump mechanism. </div>
<br />Sadly no, the FPGA has roughly 36kB of block RAM. 17kB of those are always dedicated to MSU1 for data+sound buffers (MSU1 should be supported alongside any custom chips).
<br />
<br />Now I could theoretically use both my external memory chips combined to fetch a 24bit instruction in a single cycle but I doubt I can get to 8MHz core clock with that (the SNES must access both buses quasi-simultaneously and one of the memory chips is only 70ns).
<br />
<br />About the CX4 (AWESOME feat, read a lot about it!) - Doesn't it also have an internal program RAM where it copies one 512b "page" from the mask ROM prior to execution? Or does it fetch directly from mask ROM? How is SNES ROM access handled then? Or does it have a switch like the SuperFX?
<br />I think I should read the source already... <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sat Jun 18, 2011 4:16 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Sadly no, the FPGA has roughly 36kB of block RAM.</div><br /><br />Drat. Okay, if you want to try and get F1 ROC II running anyway ... try this.<br /><br />Cut the first 6KB of the ST-0010 ROM to a new file, this will be the program ROM. Now go 48KB into the file, and copy the next 4KB into our new file. This will give you a 10KB file similar to the other dspN.bin files, only it'll use an extra 2KB of data ROM. See if F1 ROC II will run using your 7725 core @ 8MHz, I believe it will. It does not use any new opcodes, the only obvious thing is that it needs one extra bit on the data ROM pointer address.<br /><br />st0010.bin only has 0x640 bytes of PROM, and 0xbe0 bytes of DROM.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Doesn't it also have an internal program RAM where it copies one 512b "page" from the mask ROM prior to execution? Or does it fetch directly from mask ROM? How is SNES ROM access handled then? Or does it have a switch like the SuperFX?</div>
<br />
<br />Yes. It has to buffer in the first page as well. You can load in pages from the SNES or Cx4 side. I don't know yet if the SNES side can load in both pages or just the primary/active one. I also don't know how the buffering works from the Cx4 side. My guess is the chip freezes until the buffering is finished.
<br />
<br />The mask ROM is completely inaccessible to the SNES while buffering is under way. The Cx4 takes over the ROM chip to do its own buffering as needed. It doesn't appear that access is restored until the Cx4 hits a halt opcode. So you're pretty much fucked if it gets stuck in a loop I guess.
<br />
<br />The Cx4 also has a simple DMA that can move mask ROM into Cx4 RAM. This also locks out the SNES CPU from accessing the ROM (and presumably the Cx4 RAM) while it is active.
<br />
<br />And lastly, it allows vector override. Write new vectors into $7f60-7f, and when the Cx4 is active, it will give those values for $ffe0-ffff for NMI/IRQ support. MMX2/3 don't seem to use this feature, though. It just turns off all interrupts prior to executing a function.
<br />
<br />-----
<br />
<br />I do love the clock speed, the instruction set, and number of registers. But this chip honestly sucks compared to the uPD and SA-1 in terms of power. Having to multi-task out of work RAM is really shitty, and 256-instruction pages are much too small.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Sat Jun 18, 2011 11:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Trying it out now.
<br />Do I also need to map the data RAM?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sat Jun 18, 2011 6:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />For the chip to function, no. It only communicates with the SNES via DR/SR, just like the DSP-n chips.
<br />
<br />However, it does use the mapped data RAM area as non-volatile save RAM. Basically just map that in like regular cartridge SRAM and it should be fine.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Sun Jun 19, 2011 6:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hm, looks like it communicates exclusively via DP. I logged all dsp accesses in bsnes and DR/SR are not touched even once by F1 ROC II. However once the race starts, there's a firework on DP.
<br />I guess I'll have to implement it then <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Sun Jun 19, 2011 1:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />ST0010 now works. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />Had to up the DataRAM size from 256 to 1024 words and make it shared between the uPD and SNES.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sun Jun 19, 2011 3:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah, guess I was wrong after all. Sorry about that :(
<br />Glad to hear that it works though, great job! I was hopeful you could get it to work, given how small the program ROM turned out to be.
<br />
<br />We'll have to leave the ST-0011 to the emulators for now. That thing is a real beast, and you really need all 15MHz since it's a Chess AI.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Mon Jun 20, 2011 7:21 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Evil idea:
<br />
<br />The ST0011 program ROM uses only 410 different instruction words... so I could reduce the instruction size to 9 bits and use a LUT. Of course that's far from a universal approach.
<br />It would still require cutting MSU1 support for ST0011 but it might be better than nothing (except, well, it's just some Shogi game  <img src="./images/smilies/icon_twisted.gif" alt=":twisted:" title="Twisted Evil" /> )
<br />
<br />EDIT: ugh, disregard that... I counted only among the first 2048 instruction words. <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" /> Now there are 2139 different instructions.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Mon Jun 20, 2011 9:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />More info on Cx4:
<br />
<br />Cleaned source code @ snes/chip/hitachidsp in:
<br /><!-- m --><a class="postlink" href="http://bsnes.googlecode.com/files/bsnes_v079r04.tar.bz2">http://bsnes.googlecode.com/files/bsnes_v079r04.tar.bz2</a><!-- m -->
<br />(vector override portion is not used by MMX2/MMX3)
<br />
<br />Hardware requirements:
<br />0xc00 bytes data RAM aka IRAM
<br />0xc00 bytes data ROM
<br />~0x200 bytes registers and MMIO stuff
<br />
<br />Technical requirements:
<br />24-bit registers with 24-bit signed multiplication to 48-bit result
<br />Roughly 32 or so unique opcodes, all very simplistic
<br />Has a DMA mode that transfers from ROM to IRAM
<br />Either the SNES or the Cx4 has control of the ROM/IRAM, never both
<br />It's safe to always allow SNES ROM/IRAM access, so long as it won't stall out the Cx4
<br />Program ROM is inside the game itself. You can either buffer in 2x512-byte pages, or fetch on demand. The former is more correct, but the latter works fine as well.
<br />Wants to run @ 20MHz, but it can be safely under-clocked a good bit, from what I hear.
<br />
<br />Anyway, it seems like you are well on your way here to an official release. I'm not suggesting you expend effort on Cx4 support or anything, unless you really want to.
<br />
<br />But if you do want the chip support, let me know if I can be of any assistance :D
<br />
<br /><div class="quotetitle">ikari_01 wrote:</div><div class="quotecontent">It would still require cutting MSU1 support for ST0011 but it might be better than nothing</div><br /><br />Do you mean only that one game could not use ST0011+MSU1 at the same time? Or that you'd have to remove it entirely to support it? If the former, not a big deal. If the latter, ;_;<br /><br />The first one's easy to get anyway if people really want to play it. But I mean there's probably two people in the world interested in playing it anyway. F1 ROC II on the other hand seems pretty popular, Lord Nightmare is a big fan of it.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">EDIT: ugh, disregard that... I counted only among the first 2048 instruction words. :( Now there are 2139 different instructions.</div>
<br />
<br />ST-0011 is an absolute beast. The most powerful coprocessor (sans maybe the ST-0018), and utilized almost 100%. It also really wants to be run at 15MHz. You can probably get away with 8MHz, but AI moves would take twice as long. You'd have to hack the title screen to read "遅指し 二段 森田将棋" :P

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ikari_01</b> [ Mon Jun 20, 2011 2:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Haha don't worry. I'd never ax MSU1 for one custom chip. If I had to decide I'd rather ditch ST0011 completely. <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />
<br />I meant disable MSU1 when ST0011 is used.
<br />
<br />And of course I want to support Cx4. Mega Man X2/3 are essential IMO.
<br />Even if I don't finish it now, sd2snes can flash itself from SD Card, so I'm expecting a variety of features to arrive after release anyway.
<br />
<br />Anyway, thanks for all the details on the Cx4. It seems very nice to implement instruction architecture wise.
<br />
<br />About the ST0011: I have the 7725 core running @13.71MHz (96/7) at the moment anyway, so 15MHz (would be 16MHz then) is probably not a far cry. However ST0011 doesn't have top priority now.
<br />Also LOL @遅指し <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />
<br />
<br />Ah btw, how is the DataRAM split up with the ST0011? F1 ROC II seems to use the lower half of the ST0010's DataRAM for data exchange between the DSP and SNES, and the upper half for storing save data.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Tue Jun 21, 2011 1:01 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That's a good question. I'm afraid I haven't looked at Morita Shougi 1 any more than necessary to get it playable, heh. It's a very boring game.
<br />
<br />The flashing thing sounds cool. Lots of potential there for Cx4, OBC1, S-DD1 (proper - for SFA2) and SPC7110; perhaps some entrepreneurs will take a stab at it for you, ala the Retrode's dumping adapters.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>4</strong> of <strong>7</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Intel Atom and C compiling with gcc</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Intel Atom and C compiling with gcc</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=5&amp;t=17376">http://forums.nesdev.com/viewtopic.php?f=5&amp;t=17376</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun May 20, 2018 7:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><a href="http://rocknes.web.fc2.com/" class="postlink">My emulator</a> is running at 330 FPS in my Core i5-2320 3GHz, not the most modern PC. By playing a NSF, it goes at 550 FPS. Even with all the recent optimizations, including the gcc <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-march=atom</tt>, my emulator stucks at 30 FPS in my netbook (<a href="https://support.hp.com/us-en/document/c02172107" class="postlink">HP Mini Intel Atom with Windows 7 Starter</a>). In rare times, I got 70 FPS, but something seems wrong, since the speed seems to slowdown and get stuck at 30 or a value between 19 and 26 FPS. There's no secret in my gcc flags, <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-Ofast -Wall -funroll-loops -ffast-math -fomit-frame-pointer -pipe -flto</tt>.<br /><br />Any thoughts?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun May 20, 2018 7:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The CPU is an Atom N450, the same as in the Inspiron mini 1012 that I used to use. It has 1 in-order core and 2 threads. To get the most out of that core in the face of load and branch penalties, you'll need to keep both threads busy.<br /><br />The first thing I'd try is to handle audio timing, such as the 240 Hz clock, in your CPU thread and signal generation in another thread. And if you're doing any video filtering, such as NTSC or Scale2x, I'd recommend pushing that out to a thread as well. On scanlines that don't contain sprite 0, you could run the PPU mostly in its own thread and pass only <a href="https://wiki.nesdev.com/w/index.php/Catch-up" class="postlink">catch-up logs</a> to the PPU thread.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Sun May 20, 2018 7:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If it runs fast at first but then slows down, that might be due to dynamic frequency scaling in the processor. For example, if the CPU heats up too much it will try compensate by tuning down the clock frequency. You may want to monitor the CPU clock frequency while you run the emulator.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Sun May 20, 2018 8:53 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />One thing I read is that <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-funroll-loops</tt> will not always help (this is due to the instruction cache, if the computer has one), so try removing that flag and see if it work better; see whether it is better with or without that flag.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun May 20, 2018 8:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Zepper wrote:</div><div class="quotecontent"><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-funroll-loops</tt><br /></div>Unrolling loops doesn't necessarily make code faster; it trades branch penalties for RAM bandwidth.<br /><br />Gcc's manual page says <blockquote style="margin-left: 1%; padding-left: 1%; border-left: 3px solid #555577;">
This option makes code larger, and may or may not make it run faster.
</blockquote><br /><br />I'd see what fell out of the profiler (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-pg</tt>) to figure out what's consuming more time.<br /><br />The person who wrote VirtualDub has a blog entry about <a href="http://virtualdub.org/blog/pivot/entry.php?id=286" class="postlink">optimizing code for the Atom</a> and it's not clear that any compiler other than <a href="https://hydrogenaud.io/index.php/topic,65862.0.html" class="postlink">Intel's own knows how</a> to optimize for the N450's in-order CPU.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun May 20, 2018 9:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How does QuickNES run on an Atom?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun May 20, 2018 9:42 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent"><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-funroll-loops</tt><br /></div>Unrolling loops doesn't necessarily make code faster; it trades branch penalties for RAM bandwidth.<br /><br />Gcc's manual page says <blockquote style="margin-left: 1%; padding-left: 1%; border-left: 3px solid #555577;">
This option makes code larger, and may or may not make it run faster.
</blockquote><br /></div><br />Removing the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-funroll-loops</tt> makes the FPS to be... 274~280 (much slower).<br />On Atom, no difference... except the dropping effect in framerate again.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun May 20, 2018 9:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">How does QuickNES run on an Atom?</div><br />URL for downloading ?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun May 20, 2018 9:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />QuickNES is available from these:<br /><br /><ul><li> Original 2008 version: <!-- m --><a class="postlink" href="https://www.zophar.net/download_file/13029">https://www.zophar.net/download_file/13029</a><!-- m --></li><li> Included in BizHawk: <!-- m --><a class="postlink" href="https://github.com/TASVideos/BizHawk/releases">https://github.com/TASVideos/BizHawk/releases</a><!-- m -->  (NES menu, pick the QuickNES core instead of NesHawk core)</li><li> Availble for RetroArch: <!-- m --><a class="postlink" href="https://buildbot.libretro.com/stable/1.7.3/windows/x86/">https://buildbot.libretro.com/stable/1.7.3/windows/x86/</a><!-- m --> (use the core downloader to get it)</li></ul>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>pubby</b> [ Sun May 20, 2018 11:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Run it through a profiler. That's the most useful thing you could do right now.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun May 20, 2018 1:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">Removing the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-funroll-loops</tt> makes the FPS to be... 274~280 (much slower).<br />On Atom, no difference... except the dropping effect in framerate again.<br /></div>You're not going to get a single correct set of optimization flags for all possible architectures. Things that worked well on (e.g.) the pentium3 worked disastrously on the pentium4. (And things that worked well on the pentium 4 were ... passable but suboptimal on the pentium3)<br /><br />Atom is a different enough ISA that you may well want to make a separate build for it.<br /><br />It kinda looks like you might be able to get a free-as-in-beer copy of ICC from Intel for the cost of giving them your contact information (and needing to re-get it every three months)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun May 20, 2018 2:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">pubby wrote:</div><div class="quotecontent">Run it through a profiler. That's the most useful thing you could do right now.</div><br />What profiler do you suggest for it? (free)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun May 20, 2018 4:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Microsoft Visual Studio 2017 has a very nice profiler.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun May 20, 2018 4:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm not familiar with... a profiler.  <img src="./images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /> <br />I got one named GlowCode and I can launch the emulator, but I couldn't find a way to link the EXE with the source code, sort of. All I did is compiling with <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-gstabs</tt> and debug it with GDB (<em>usually</em> only if my program's crashing).<br /><br />My setup is <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">gcc &#40;MinGW.org GCC-6.3.0-1&#41; 6.3.0</tt> with Orwell's Dev-Cpp.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun May 20, 2018 5:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Intel Atom and C compiling with gcc</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Got a nightly I could try?  (preferably without symbols stripped)<br />Maybe also a suggested test case game...<br /><br />Finally, use <a href="https://ci.appveyor.com/api/projects/rainers/visuald/artifacts/cv2pdb.exe?job=Environment%3A%20os%3DVisual%20Studio%202013%2C%20VS%3D12%2C%20APPVEYOR_BUILD_WORKER_IMAGE%3DVisual%20Studio%202015" class="postlink">`cv2pdb`</a> to generate PDB files out of the DWARF debug symbols.  Debuggers and profilers prefer to see those files, then they can name the functions that are slow.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
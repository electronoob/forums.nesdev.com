<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - new to NES, layering simulation effect question</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - new to NES, layering simulation effect question" href="http://forums.nesdev.com/feed.php?f=2&amp;t=9317" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en&amp;sid=0579673f3701ae6c4691c350f14b3319" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '4');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php?sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php?sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Mon Nov 07, 2016 7:26 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=0579673f3701ae6c4691c350f14b3319">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=0579673f3701ae6c4691c350f14b3319">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=0579673f3701ae6c4691c350f14b3319">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=0579673f3701ae6c4691c350f14b3319">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=0579673f3701ae6c4691c350f14b3319">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=9317&amp;start=45&amp;sid=0579673f3701ae6c4691c350f14b3319">new to NES, layering simulation effect question</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320&amp;sid=0579673f3701ae6c4691c350f14b3319">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>4</strong> of <strong>13</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 191 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=30">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=30">3</a><span class="page-sep">, </span><strong>4</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=90">7</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=180">13</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=60">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=9317&amp;start=45&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=9317&amp;view=previous&amp;sid=0579673f3701ae6c4691c350f14b3319">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=9317&amp;view=next&amp;sid=0579673f3701ae6c4691c350f14b3319">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99911"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99911">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99911&amp;sid=0579673f3701ae6c4691c350f14b3319#p99911"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 6:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I don't remember the exact timing, but IIRC the IRQ fires kinda late in the scanline, so there might not be enough time to update the scroll before the PPU does its internal scrolling maintenance. If this is the case, the fine X scroll (pixel 0-7) would update (it's updated immediately), but the coarse scroll (tile 0-31) wouldn't be updated until the next scanline, resulting in a glitchy scanline. You could try delaying your scroll change until the end of the next scanline, with some timed code before the write to $2005.<br /><br />EDIT: There's no need to turn off rendering. You just have to be sure that the $2005 write finishes before the X scroll is reset internally. I searched and it seems that the <a href="http://forums.nesdev.com/viewtopic.php?p=46833#p46833" class="postlink">X scroll is reset on cycle/pixel 257</a>, and the <a href="http://forums.nesdev.com/viewtopic.php?p=62444#p62444" class="postlink">MMC3 IRQ fires at cycle 260</a>, so you really have to wait until the next scanline.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99913"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99913">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99913&amp;sid=0579673f3701ae6c4691c350f14b3319#p99913"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 7:09 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 17206<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">IRQ fires at dot 260, and the fetches to load the first tiles of the next scanline begin at 320.<br /><br />Here is your current IRQ handler, with execution times in dots (assuming NTSC or RGB system). Internally, an IRQ or NMI is performed by <a href="http://www.pagetable.com/?p=410" class="postlink">replacing the input to the instruction decoder with $00 (which is the opcode for BRK)</a>, so I'll show the IRQ's entry as &quot;Brk&quot; in the following.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">xxx xxxxx&nbsp; ;&nbsp; 0-18: wait for current instruction to finish<br />Brk $00&nbsp; &nbsp; ; 21: enter IRQ<br />Pha&nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; 9<br />Lda #$01&nbsp; &nbsp;;&nbsp; 6<br />Sta $E000&nbsp; ; 12<br />Lda #$20&nbsp; &nbsp;;&nbsp; 6<br />Sta $2005&nbsp; ; 12<br />Pla<br />Rti<br /></div><br />So it takes 66 to 82 dots before the write completes.<br /><br />Technically you don't need to store any particular value into $E000 for MMC3, and you might as well make the $2005 write happen as early as possible. This one completes the write in 48-66 dots:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">xxx xxxxx&nbsp; ;&nbsp; 0-18: wait for current instruction to finish<br />Brk $00&nbsp; &nbsp; ; 21: enter IRQ<br />Pha&nbsp; &nbsp; &nbsp; &nbsp; ;&nbsp; 9<br />Lda #$20&nbsp; &nbsp;;&nbsp; 6<br />Sta $2005&nbsp; ; 12<br />Sta $E000<br />Pla<br />Rti<br /></div><br />So trigger the IRQ handler a scanline early, write only the coarse scroll value, and then write the new fine scroll value during the <em>next</em> horizontal blank.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99916"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99916">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99916&amp;sid=0579673f3701ae6c4691c350f14b3319#p99916"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 8:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Good stuff.  Currently reading the loopy doc on scrolling. <br /><br />3 dots per CPU clock?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99917"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99917">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99917&amp;sid=0579673f3701ae6c4691c350f14b3319#p99917"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 9:48 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">exdeath wrote:</div><div class="quotecontent">Currently reading the loopy doc on scrolling.</div><br />It has some good info for when you need to change the vertical scroll mid frame, which is significantly more complex than changing just the horizontal scroll.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">3 dots per CPU clock?</div><br />On NTSC, yes. On PAL it's 3.2 dots.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99918"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99918">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99918&amp;sid=0579673f3701ae6c4691c350f14b3319#p99918"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 11:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 1682<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">exdeath wrote:</div><div class="quotecontent">So just started messing with MMC3 IRQs.   Just experimenting with split screen for all of 5 minutes.<br /><br />Got it working but the line seems indefinite. +/- 1 which I've read about.<br />  <br />And the scroll is messed up on the line separating the two screens.<br /><br />So it looks like 119 lines 0 scroll, 1 line like 10-50 scroll then remaining 120 lines 20 scroll.  Just ordered a PowerPak so haven't tried on real hardware yet.</div><br /><br />The accuracy is good with the actual mmc3.  But from what I'm told the power pak's isn't so great.  It tends to jump back and forth a few scan lines on some games...  So keep that in mind, it's not necessarily the mmc3 as much as it's the power pak.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99920"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99920">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99920&amp;sid=0579673f3701ae6c4691c350f14b3319#p99920"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 12:43 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 2680<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">The accuracy is good with the actual mmc3.  But from what I'm told the power pak's isn't so great.  It tends to jump back and forth a few scan lines on some games...  So keep that in mind, it's not necessarily the mmc3 as much as it's the power pak.</div><br />This might have been true back when PowerPak was released, but I haven't had any problems like that with the loopy's latest mappers (or my own save state mappers). Still good to keep that what you said in mind of course.</div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">Download STREEMERZ for NES from <a href="http://www.fauxgame.com" class="postlink">fauxgame.com</a>! — Some other stuff I've done: <a href="https://kkfos.aspekt.fi/" class="postlink">kkfos.aspekt.fi</a></span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99921"></a>
				<b class="postauthor">MottZilla</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99921">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99921&amp;sid=0579673f3701ae6c4691c350f14b3319#p99921"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 12:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=1726.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Dec 06, 2006 8:18 pm<br /><b>Posts:</b> 2732
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Also the MMC5 mapper file for the PowerPAK may not be complete, I don't think it is. So don't assume the PowerPAK running a game with complex operation to mean it will work on the original mapper exactly the same. Simple mappers you can likely count on to operate just about identically, like MMC1.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=1726&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99924"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99924">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99924&amp;sid=0579673f3701ae6c4691c350f14b3319#p99924"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 1:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yeah, well see what happens once I properly implement mid frame scrolling first.<br /><br />Just writing xpos trivially  to $2005 on IRQ doesn't cut it apparently.<br /><br />Trying to get more clarification on the course vs fine scroll and when and where to write them.<br /><br />Ill have to play with nops to experiment with the timing.<br /><br />So the value written to $2005 has a diff meaning during rendering than a simple scroll integer?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99926"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99926">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99926&amp;sid=0579673f3701ae6c4691c350f14b3319#p99926"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 2:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Oh I get it now.<br /><br />Earlier it was said modifying the palette mid frame was tricky if not impossible due to screwing up the scroll.... Now I know... because its using the same address registers internally while rendering and screwing up the PPUs current location.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99929"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99929">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99929&amp;sid=0579673f3701ae6c4691c350f14b3319#p99929"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 3:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">exdeath wrote:</div><div class="quotecontent">because its using the same address registers internally while rendering and screwing up the PPUs current location.</div><br />Exactly. When you set the scroll during VBlank you are actually setting the initial value of the VRAM address register, which is used during rendering to fetch tiles and such. The only part of the scroll that's not related to the VRAM address register is the fine X scroll, and that's the reason it takes effect immediately on writes to $2005.<br /><br />During rendering, these register have to be manipulated according certain rules:<br /><br />You can write to $2005 freely, but it affects the temporary address register. Since the screen is drawn from top to bottom, every scanline the X part of the VRAM register is reloaded with the temporary register, but the Y part is never reloaded, and this is the reason you can't change the vertical scroll mid frame through $2005 - the value you write is never copied from the temporary register to the address register.<br /><br />In order to modify the Y scroll you have to use $2006, which forces the contents of the temporary register to be copied over to the address register. However, since $2006 was meant for writing/reading data to/from VRAM (pattern tables, name/attribute tables and palettes), it masks off the top 2 bits of the written address (not necessary for accessing $0000-$3FFF), one of which is necessary to control the scroll, meaning you can't fully set the scroll with $2006 alone (that and the fact that the fine X scroll is a separate thing). Hence the need for mixed $2005/$2006 writes.<br /><br />All that complexity is because of the vertical scroll. For the horizontal scroll you should be OK doing what tepples said: set the coarse scroll during HBlank (after cycle 257, which is when the value from the temporary register is copied, meaning the value you wrote will not be used just yet), and then during the next HBlank you set the fine scroll. You will obviously be wasting some time this way, since you can't change the scroll right as the IRQ fires and you have to wait yet another scanline to set the fine scroll, but that's what's require for a clean, unnoticeable split. If you pay attention, you'll see that most commercial games don't have such a clean split (even high profile games like SMB3), and you can easily see glitches because of badly timed scroll changes.<br /><br />IMO, the most notorious case of glitchy scroll changes in a commercial game is Mega Man 3. The stage select screen has very noticeable glitches right above Shadow Man, and so does the top of the weapon selection menu, and at various times when the background is used for special effects the ground is severely affected.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99932"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99932">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99932&amp;sid=0579673f3701ae6c4691c350f14b3319#p99932"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 4:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It's definitely a fine scroll issue, as the messed up line is never +/- 8 pixels from the line above it.<br /><br />So I guess that's where I'm missing:<br /><br />1) when, how, and where to write &quot;fine&quot; scroll vs &quot;coarse&quot; scroll.  Do these HAVE to be written separately?  It does not appear that simply writing once to $2005 with appropriate delay is enough;  I just go from overshooting the end of the current line to messing up the next line with a single extra NOP.<br /><br />2) how to determine next hblank knowing that the IRQ is called at dot 260 of the current line.<br /><br />Top part of screen scrolls, and I'm trying to fix the bottom part at scroll $20 on MMC3 IRQ at line 120.  IRQ just acks the mmc3 int, then tries to nop until next hblank before writing $20 to $2005.  As I keep adding nops, I see the line stabilized from left to right with the glitches shrinking to the right, but just when Im down to the last couple pixels, one more NOP and bam the entire next line glitches.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99933"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99933">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99933&amp;sid=0579673f3701ae6c4691c350f14b3319#p99933"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 4:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3645
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">To do mid-screen scrolling for horizontal and vertical scrolling, it's 4 writes:<br /><br />2006/1 ---- NN-- (nametable select)<br />2005/2 VV-- -vvv (upper two bits of coarse V scroll, all bits of fine V scroll)<br />2005/1 ---- -hhh (fine horizontal scrolling) (takes effect immediately)<br />2006/2 VVVH HHHH (lower three bits of coarse V scroll, all bits of coarse H scroll)<br /><br />* The first two writes only affect Loopy_T, so they can happen at any time during the scanline.<br />* The third write (setting fine X) should happen at dot 256 or later. Since writes take 4 CPU cycles (12 PPU dots) to finish, the store to $2005 instruction should begin at dot 244 or later.<br />* The fourth write should happen before dot 304. The store to $2006 instruction should begin before dot 292. <br /><br />There's also another way to do it for just horizontal scrolling:<br />Write to 2005 between dot 256 and dot 304 to set the coarse scroll that will change after the next scanline, and fine scroll that will apply to the next scanline.  So fine scroll applies immediately, and coarse scroll is lagged until the next scanline.<br />Write to 2005 one scanline later between dot 256 and dot 304 to set the coarse and fine scrolling.<br /><br />I prefer the four write method, because you don't need to wait one scanline for it to finish.  Even though you still need to calculate X and Y scrolling bits for the four writes.</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99934"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99934">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99934&amp;sid=0579673f3701ae6c4691c350f14b3319#p99934"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 5:03 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">exdeath wrote:</div><div class="quotecontent">It does not appear that simply writing once to $2005 with appropriate delay is enough;  I just go from overshooting the end of the current line to messing up the next line with a single extra NOP.</div><br />Yeah, one $2005 write isn't enough for a clean split. The X scroll is reset at cycle 257, just after the 256 visible pixels of the scanline, and for the coarse scroll to take effect on the next scanline it has to be changed before that. However, since the fine scroll takes effect immediately, anything before cycle 257 would be during the visible scanline, meaning you'd get glitches at the end of the scanline.<br /><br />You can however do it all in one go with mixed $2005/$2006 writes (as Dwedit explained above).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">2) how to determine next hblank knowing that the IRQ is called at dot 260 of the current line.</div><br />Use timed code. You can just use NOPs at first (1 scanline is nearly 57 NOPs long) just to see how many cycles you have to burn, and then you can optimize the waiting code with a loop or something. You can never get things 100% synced though, since the CPU waits for the current instruction to finish before answering the IRQ, so your IRQ handler (and NMI handler too)will always jitter a bit, and you have to take that into account when operations have to happen at precise time intervals (I usually aim for the middle of the window, so that a little jittering is still inside the window).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">As I keep adding nops, I see the line stabilized from left to right with the glitches shrinking to the right, but just when Im down to the last couple pixels, one more NOP and bam the entire next line glitches.</div><br />That matches precisely the explanation I gave above.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p99935"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99935">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99935&amp;sid=0579673f3701ae6c4691c350f14b3319#p99935"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 5:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK lets see if I have this right:<br /><br />MMC3 IRQ fires at dot 260 for the current line N after it's done rendering and N+1 is about to start.<br /><br />It's too late to modify coarse scroll for the upcoming line N+1, so I have to write it for N+2.  But I DO have to do it now, or at least before dot 256 of line N+1.<br /><br />In doing so I affect the fine scroll for the soon to start N+1, which is why I have a line artifact that is coarse scrolled to the upper half of my screen but off by +/- 8 pixels because the fine scroll was reset.<br /><br />So when I write the first write to $2005 at the start of the IRQ I need to have the coarse scroll for N+2, but mask in the old fine scroll from the previous line N so that the line N+1 happening immediately after the IRQ, which is unaffected by the coarse scroll change, continues to match the top half of the screen for just one more line while I wait a 1 line delay.<br /><br />Then wait an entire line N+1.<br /><br />Then during the hblank of link N+1, write $2005 again with the same coarse scroll but the new fine scroll.<br /><br />Then my next question is, is there a diagram of the entire horizonal sweep with dot timing?  Is is 341 dots per line where 0-255 is the active line or...?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p99939"></a>
				<b class="postauthor">exdeath</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p99939">Re: new to NES, layering simulation effect question</a></div><div style="float: right;"><a href="./viewtopic.php?p=99939&amp;sid=0579673f3701ae6c4691c350f14b3319#p99939"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 20, 2012 7:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 15, 2012 6:58 pm<br /><b>Posts:</b> 103
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">W00t</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=48&amp;sid=0579673f3701ae6c4691c350f14b3319">test.zip</a> [4.31 KiB]
			</span><br />
			<span class="gensmall">Downloaded 59 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5673&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=9317&amp;start=45&amp;sid=0579673f3701ae6c4691c350f14b3319"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>4</strong> of <strong>13</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 191 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=30">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=30">3</a><span class="page-sep">, </span><strong>4</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=90">7</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=180">13</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=9317&amp;sid=0579673f3701ae6c4691c350f14b3319&amp;start=60">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=0579673f3701ae6c4691c350f14b3319">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=0579673f3701ae6c4691c350f14b3319">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=0579673f3701ae6c4691c350f14b3319">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google Adsense [Bot]</span> and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php?sid=0579673f3701ae6c4691c350f14b3319"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="9317" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="0579673f3701ae6c4691c350f14b3319" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=0579673f3701ae6c4691c350f14b3319" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - asm6 issue</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">asm6 issue</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=17483">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=17483</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charliee1151</b> [ Fri Jun 29, 2018 2:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I believe I may have found an issue with asm6.  I am using version 1.6,which is the one given on RomHacking.<br /><br /><br />Is this program still being maintained?  How may I contact the programmer/author?<br /><br />Thank you<br />Charlie

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>loopy</b> [ Fri Jun 29, 2018 4:59 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Email address should be in the readme.  It's not actively maintained, though there are unofficial branches that might be.<br />If you have issues with it, right here is the best place to talk about it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Jun 29, 2018 5:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you've really found a bug, sharing it here might be helpful to other members too, as more people will be able to avoid/circumvent the issue until it's fixed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charliee1151</b> [ Sat Jun 30, 2018 5:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thank you.  I will make up a code snippet to demonstrate my question.<br /><br />Regarding the lengthy discussion in reference to homebrew  (I admit I did not read it all), I've attached (I hope) a bmp file.  It is my &quot;homebrew&quot; game, and is a blatent rip-off of a C64 game &quot;Oils Well&quot; (IIRC).  It is not intended for profit, and I am willing to submit it, with source code, to {someplace}, if it is appropriate to do so.  Does this type of programming qualify as a &quot;port&quot; of the original?  It is not an exact duplicate of the play function, just close enough to make it playable.<br /><br />Thanks<br />Charlie

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="gensmall"><b>File comment:</b> Screen shot of &quot;NESOil&quot;, my port of the Commodore game &quot;Oils Well&quot;</span><br />
		
			<img src="./download/file.php?id=12929" alt="NESOil.bmp" /><br />
			<span class="gensmall">NESOil.bmp [ 238.93 KiB | Viewed 1433 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charliee1151</b> [ Sat Jun 30, 2018 9:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok, here is an example of my question:<br />  First the code snippet, file name is &quot;test.asm&quot;:<br />----------------------------------------<br />someIndex		= $2E<br /><br />.org $c000<br /><br />Data1:			<br />	 .db #$00, #$00, #$00, #$00, #$00	<br />Data1Size:<br />	 .db (Data1Size - Data1)	/ 5<br /><br />Test:	<br />	lda someIndex<br />	;cmp #Data2Size		;Uncomment to see issue<br />	cmp #Data1Size	<br /><br />Data2:			<br />	.db #$FF, #$FF, #$FF, #$FF, #$FF		<br />Data2Size:<br />	.db (Data2Size - Data2)	/ 5<br />-----------------------------------------------<br /><br />Compiling as is, is ok:<br /><br />E:\temp&gt;asm6 -L test.asm test.nes test.lst<br />pass 1..<br />test.nes written (17 bytes).<br />test.lst written.<br /><br />Compiling with the comment removed:<br /><br />E:\temp&gt;asm6 -L test.asm test.nes test.lst<br />pass 1..<br />pass 2..<br />last try..  <br />test.nes written (20 bytes).<br />test.lst written.<br /><br />Note the output &quot;last try...&quot;, which would:<br /> (1) seem to indicate an error, even though the list file &quot;test.lst&quot; shows correct data<br /> (2) does not give any indication of the &quot;error&quot;.  This may be correct, as there doesn't appear to actually be any error.<br /><br />Note that the difference is that the calculated Size data is, in the first instance, BEFORE the code that uses it, and in the second instance, is AFTER the code that uses it.<br /><br /><br />Thanks<br />Charlie

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sat Jun 30, 2018 9:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You should not be using the &quot;#&quot; in those CMP instructions though. This symbol is for immediate values, so what this will do is compare the accumulator to the ADDRESS that label points to, not the value at that address. The address is a 16-bit value though, so this should be an invalid instruction on 6502 assembly, so the assembler should throw an error, instead of silently using only the lower byte of the address or whatever else it's doing.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sat Jun 30, 2018 9:42 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Maybe what you want to do is this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Data1:&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;.db #$00, #$00, #$00, #$00, #$00&nbsp; &nbsp;<br />Data1Size = ($ - Data1) / 5 ;this will calculate the value you want, but will not output it to the ROM<br /><br />&nbsp; &nbsp;;(...)<br /><br />&nbsp; &nbsp;CMP #Data1Size</div><br />Or, if you really want the size to be stored in the ROM with a .db statement, do exactly like you did but remove the # from the CMP instructions. Either way should work fine, regardless of whether there size is calculated before or after it's used.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charliee1151</b> [ Sat Jun 30, 2018 1:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks, all,  for the info.<br /><br />I have tried both with and without the &quot;#&quot;, using Asm6 and running on the Nintendoulator (my real code, of course, not the sample snippet).  In both cases, the Debug Disassembly shows the same code:<br /><br />D11A A5 2E        LDA $2E = 05<br />D11C CD 60 C4   CMP $C460 = 08<br />D11F D0 07        BNE $D128  <br /><br />However, removing the &quot;#&quot; DOES eliminate the Asm6 issue, and so I have edited my real code to match.<br /><br />(Edit: So, maybe the Asm6 message actually WAS an error indicator, since my source actually was incorrect, and an update is needed to add the text of the error message?)<br /><br />Charlie

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>loopy</b> [ Sat Jun 30, 2018 1:23 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">charliee1151 wrote:</div><div class="quotecontent">E:\temp&gt;asm6 -L test.asm test.nes test.lst<br />pass 1..<br />pass 2..<br />last try..  <br />test.nes written (20 bytes).<br />test.lst written.<br /><br />Note the output &quot;last try...&quot;, which would:<br /> (1) seem to indicate an error, even though the list file &quot;test.lst&quot; shows correct data<br /> (2) does not give any indication of the &quot;error&quot;.  This may be correct, as there doesn't appear to actually be any error.<br /></div><br />&quot;last try..&quot; isn't an error condition. It just means it's the final assembly pass.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zutano</b> [ Mon Jul 02, 2018 12:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">charliee1151 wrote:</div><div class="quotecontent">I have tried both with and without the &quot;#&quot;, using Asm6 and running on the Nintendoulator (my real code, of course, not the sample snippet).  In both cases, the Debug Disassembly shows the same code:<br /><br />D11A A5 2E        LDA $2E = 05<br />D11C CD 60 C4   CMP $C460 = 08<br />D11F D0 07        BNE $D128  <br /><br />However, removing the &quot;#&quot; DOES eliminate the Asm6 issue, and so I have edited my real code to match.</div><br /><br />ASM6 tends to assume what you may have meant to do when it sees an invalid operation.<br />In this case it saw you were trying to use a 16-bit label as an immediate value (using &quot;#&quot;), and it assumed (correctly) that you meant to <div class="codetitle"><b>Code:</b></div><div class="codecontent">CMP Absolute</div> instead of <div class="codetitle"><b>Code:</b></div><div class="codecontent">CMP #Immediate</div><br />This is why the disassembly is the same with and without the &quot;#&quot;<br /><br />As for the &quot;last try&quot; message, that just means the assembler did an extra pass, it is not an error. The extra pass came from your ambiguous &quot;CMP&quot;, the assembler first assumed that &quot;Data2Size&quot; would be an 8-bit value that would be defined later in the source. But instead it found it as a 16-bit label, and had to do an extra pass to adjust the original &quot;CMP&quot; opcode to reflect that.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>charliee1151</b> [ Mon Jul 02, 2018 2:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: asm6 issue</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Excellent explanation, thanks!<br /><br />Charlie

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
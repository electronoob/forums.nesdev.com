<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - N64 programming (libdragon)</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Other Retro Dev" href="http://forums.nesdev.com/feed.php?f=23" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - N64 programming (libdragon)" href="http://forums.nesdev.com/feed.php?f=23&amp;t=15615" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=23&amp;t=15988';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 16, 2018 11:05 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=23&amp;t=15988">N64 programming (libdragon)</a></h2>


</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=23"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=23&amp;t=15988"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>5</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 66 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=60">5</a> &nbsp;<a href="./viewtopic.php?f=23&amp;t=15988&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=23&amp;t=15988&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=23&amp;t=15988&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=23&amp;t=15988&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196612"></a>
				<b class="postauthor">BMBx64</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196612">N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196612#p196612"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 8:40 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://i.imgur.com/mtz71DO.png" width="64" height="64" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu May 25, 2017 7:27 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hi, since i don't know a place for N64 scene im trying here, i was wondering if anyone have done some tests with libdragon.<br /><br />So far i did some.. well very basic tests, my target is always 60fps, so i use the RDP rasterizer, i have some question on the bottom of the message, sorry for my english and the long post.<br /><br />These tests works on real hardware, maybe on CEN64 or MESS, some downloads are attached others on mega.<br /><br /><strong>TEST 1: EXPLOSIONS</strong><br />Random explosions on screen using textures of 16bits (32x32) with RDP.<br /><img src="http://i.imgur.com/RYZd6Ri.gif" alt="Image" /><br /><br />Performance without optimizations:<br />410 at 60fps (NTSC)<br />507 at 50fps (PAL)<br /><br />Texture strategy, use the same texture for other sprites without reload TMEM:<br />480<br />579<br /><br />Flush texture disabled:<br />593<br />728<br /><br />Probably there must be other ways to optimize further.<br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!Rkp2jRgJ!GpFxMwJ3g294r1CjwrmYR6mi-nIq4nhMuINdrsJRPwo" class="postlink">https://mega.nz/#!Rkp2jRgJ!GpFxMwJ3g294r1CjwrmYR6mi-nIq4nhMuINdrsJRPwo</a><br /><br /><strong>TEST 2: BIGGER EXPLOSIONS</strong><br />Instead of 2KB explosions these are around 122x96 (22KB), so they are split in several pieces to fit the 4KB cache (i dont use stride function on libdragon, is slower than manage single textures), i wonder if there is an easy way to use 4 or 8bit textures with libdragon (they are limited to 16bit-32bit).<br /><img src="http://i.imgur.com/uJBXRcj.gif" alt="Image" /><br /><br />Performance is lower than expected, around 50 explosions at 60fps.<br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!loAQyQSb!NjiU9HUihztLdVz-ULFNcx8NhmLFnQBYuYk5FHTgFhw" class="postlink">https://mega.nz/#!loAQyQSb!NjiU9HUihztLdVz-ULFNcx8NhmLFnQBYuYk5FHTgFhw</a><br /><br /><strong>TEST 3: SNOW</strong><br />RDP rectangles (non textured) of 4x4 with a blue color.<br /><img src="http://i.imgur.com/XYee0nh.gif" alt="Image" /><br /><br />Performance:<br />5120 rectangles at 60fps<br />6430 rectangles at 50fps<br /><br />Use int16 instead of int32:<br />5600<br />7120<br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!R9YEwBSD!_7jzjJd0UXLLDIgvKNxVt0pwtKhSdyJ46QhFRMG7EWA" class="postlink">https://mega.nz/#!R9YEwBSD!_7jzjJd0UXLLDIgvKNxVt0pwtKhSdyJ46QhFRMG7EWA</a><br /><br /><strong>CONTROLS</strong><br />A - Increase<br />B - Decrease<br />Start - Min<br />Z - Max<br />C up - clean buffer with RDP (test 1,2)<br />C left - clean buffer with CPU (test 1,2)<br />C down - do not clean (test 1,2)<br />R - Color rectangles (test 3)<br /><br /><strong>CASTLEVANIA: SOTN OST</strong><br />The whole soundtrack converted into ogg 44KHz/Stereo/128kbps using libogg, 34 songs, fits on a 64MB cartridge, plays from start to end, can skip songs with c button.<br /><img src="http://i.imgur.com/wMRIbZj.png" alt="Image" /><br /><br />It slowdowns 25fps to sync with the audio (i don't know how to use threads), but since its static background there is no problem at all.<br /><br />DOWNLOAD (wonder if can be shared?)<br /><a href="https://mega.nz/#!Y9pQjYgC!S3LojMylb3lQ-RWEpdtdVxzCJKy9Td1b9AHr7Sq370w" class="postlink">https://mega.nz/#!Y9pQjYgC!S3LojMylb3lQ-RWEpdtdVxzCJKy9Td1b9AHr7Sq370w</a><br /><br />=&gt; Added get_pixel function, this is already inside the libdragon but i didnt see the function for end users?<br /><br /><strong>GET_PIXEL</strong><br />Gets a pixel color from a buffer in x/y position.<br />- Returns a packed color (twice) in 16bits for RDP compatibility.<br /><br />graphics.c:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">uint32_t get_pixel( display_context_t disp, int x, int y )<br />{<br />&nbsp; &nbsp; if( disp == 0 ) { return 0; }<br /><br />&nbsp; &nbsp; if( __bitdepth == 2 )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; uint16_t *buffer16 = (uint16_t *)__get_buffer( disp );<br />&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;uint16_t packed_rdp = __get_pixel( buffer16, x, y );<br />&nbsp; &nbsp; &nbsp; &nbsp; return packed_rdp | (packed_rdp &lt;&lt; 16);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; uint32_t *buffer32 = (uint32_t *)__get_buffer( disp );<br />&nbsp; &nbsp; &nbsp; &nbsp; return __get_pixel( buffer32, x, y );<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp;<br />}<br /></div><br /><br />graphics.h<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">uint32_t get_pixel( display_context_t disp, int x, int y);</div><br /><br />USES<br />- Can be used on a paint program (or those racing games with a menu to select a color for a car)<br />- Can be used as hidden collision map (since it reads the current buffer)<br />- Allows users to create new functions<br />- Can transform color into data to copy block areas or do special effects (VERY SLOW)<br /><br />TEST<br />A color table is written on the buffer, the mouse reads the color from the buffer and shows it on the rectangle.<br /><img src="http://i.imgur.com/wIGmdGr.jpg" alt="Image" /><br /><br />16bit value to RGB conversion (this conversion is not necessary, but just in case)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">color=get_pixel(disp,mouse_x,mouse_y);<br /><br />// Extract<br />uint8_t r1 = (color &amp; 0xF800) &gt;&gt; 11; // 63488<br />uint8_t g1 = (color &amp; 0x7C0) &gt;&gt; 6; // 1984<br />uint8_t b1 = (color &amp; 0x3E) &gt;&gt; 1; // 62<br /><br />// Expand to 8-bit<br />r = r1 &lt;&lt; 3;<br />g = g1 &lt;&lt; 3;<br />b = b1 &lt;&lt; 3;<br /></div><br /><br />Uses RGB555, i was expecting 565.<br /><br />CONTROLS<br />Joystick - Mouse<br />A - Set background color with the color selected<br />R - Alternate white or black letter fonts<br />Z - Reset background and letter colors<br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!g5IRgYwA!Mk-vrgPmAi0HhN5aPKPLNDNVnbtdgxFkGXTkmGBmZcg" class="postlink">https://mega.nz/#!g5IRgYwA!Mk-vrgPmAi0HhN5aPKPLNDNVnbtdgxFkGXTkmGBmZcg</a><br /><br />Added math functions (fget_angle, fget_dist, get_distx, get_disty)<br /><br />Allows some game logic and this kind of effects..<br /><img src="https://i.imgur.com/MXDZigM.gif" alt="Image" /><br /><br />Since i don't have yet raster effects (buffer) i had to use giant horizontally textures (320x4), so i can move the blocks separately.<br /><br />- Libdragon won't allow textures beyond 256 wide, they are repeated at this point or mirrored depending on the settings.<br /><br />The effect is generated in real time (instead of tables) and can be edited:<br />C left / C right = wave<br />C up / C down = radius<br />A / B = Speed<br />R = hide text<br /><br />A better gif (graphics sample from Last Blade 2):<br /><img src="https://i.imgur.com/UreFOYJ.gif" alt="Image" /><br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!UpIBkJBb!TqZc9F3V8lZSpkxQoYp_T_QbyrhSNQcu29zsYVEpews" class="postlink">https://mega.nz/#!UpIBkJBb!TqZc9F3V8lZSpkxQoYp_T_QbyrhSNQcu29zsYVEpews</a><br /><br />---<br />I could provide the source code of these examples, but probably the level skills on this board are better than me.<br /><br />Right now im trying to figure how to add hardware flip to the sprites, it is possible by changing the order of the loading or using mirror S or T coords when drawing, but this code brings me headaches, i simply don't know where to start:<br /><br />(the code is slightly modified from the source, i have removed texture slots)<br /><br />rdp.c<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">static uint32_t __rdp_load_texture(int mirror_enabled, sprite_t *sprite, int sl, int tl, int sh, int th )<br />{<br />&nbsp; &nbsp; /* Invalidate data associated with sprite in cache */<br />&nbsp; &nbsp; if( flush_strategy == FLUSH_STRATEGY_AUTOMATIC )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; data_cache_hit_writeback_invalidate( sprite-&gt;data, sprite-&gt;width * sprite-&gt;height * sprite-&gt;bitdepth );<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; /* Point the RDP at the actual sprite data */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xFD000000 | ((sprite-&gt;bitdepth == 2) ? 0x00100000 : 0x00180000) | (sprite-&gt;width - 1) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (uint32_t)sprite-&gt;data );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Figure out the s,t coordinates of the sprite we are copying out of */<br />&nbsp; &nbsp; int twidth = sh - sl + 1;<br />&nbsp; &nbsp; int theight = th - tl + 1;<br /><br />&nbsp; &nbsp; /* Figure out the power of two this sprite fits into */<br />&nbsp; &nbsp; uint32_t real_width&nbsp; = __rdp_round_to_power( twidth );<br />&nbsp; &nbsp; uint32_t real_height = __rdp_round_to_power( theight );<br />&nbsp; &nbsp; uint32_t wbits = __rdp_log2( real_width );<br />&nbsp; &nbsp; uint32_t hbits = __rdp_log2( real_height );<br /><br />&nbsp; &nbsp; /* Because we are dividing by 8, we want to round up if we have a remainder */<br />&nbsp; &nbsp; int16_t round_amount = (real_width % 8) ? 1 : 0;<br /><br />&nbsp; &nbsp; /* Instruct the RDP to copy the sprite data out */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xF5000000 | ((sprite-&gt;bitdepth == 2) ? 0x00100000 : 0x00180000) | <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(((((real_width / 8) + round_amount) * sprite-&gt;bitdepth) &amp; 0x1FF) &lt;&lt; 9));<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (mirror_enabled == 1 ? 0x40100 : 0) | (hbits &lt;&lt; 14 ) | (wbits &lt;&lt; 4) );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Copying out only a chunk this time */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xF4000000 | (((sl &lt;&lt; 2) &amp; 0xFFF) &lt;&lt; 12) | ((tl &lt;&lt; 2) &amp; 0xFFF) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (((sh &lt;&lt; 2) &amp; 0xFFF) &lt;&lt; 12) | ((th &lt;&lt; 2) &amp; 0xFFF) );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Save sprite width and height for managed sprite commands */<br />&nbsp; &nbsp; cache.width = twidth - 1;<br />&nbsp; &nbsp; cache.height = theight - 1;<br />&nbsp; &nbsp; cache.s = sl;<br />&nbsp; &nbsp; cache.t = tl;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; /* Return the amount of texture memory consumed by this texture */<br />&nbsp; &nbsp; return ((real_width / 8) + round_amount) * 8 * real_height * sprite-&gt;bitdepth;<br />}<br /></div><br /><br />This second one is used for drawing the texture once is loaded into tmem, so either when loading could be mirrored or now, i have added  if ( tx &lt; -cache.width ) { return; }, prevents system to hang when a sprite is out of screen from the left (it seems to be the only exception).<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void rdp_draw_textured_rectangle_scaled( int tx, int ty, int bx, int by, double x_scale, double y_scale )<br />{<br />&nbsp; &nbsp; uint16_t s = cache.s &lt;&lt; 5;<br />&nbsp; &nbsp; uint16_t t = cache.t &lt;&lt; 5;<br /><br />&nbsp; &nbsp; /* Cant display &lt; 0, so must clip size and move S,T coord accordingly */<br />&nbsp; &nbsp; if( tx &lt; 0 )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;if ( tx &lt; -cache.width ) { return; }<br />&nbsp; &nbsp; &nbsp; &nbsp; s += (int)(((double)((-tx) &lt;&lt; 5)) * (1.0 / x_scale));<br />&nbsp; &nbsp; &nbsp; &nbsp; tx = 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; if( ty &lt; 0 )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; t += (int)(((double)((-ty) &lt;&lt; 5)) * (1.0 / y_scale));<br />&nbsp; &nbsp; &nbsp; &nbsp; ty = 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; /* Calculate the scaling constants based on a 6.10 fixed point system */<br />&nbsp; &nbsp; int xs = (int)((1.0 / x_scale) * 4096.0);<br />&nbsp; &nbsp; int ys = (int)((1.0 / y_scale) * 1024.0);<br /><br />&nbsp; &nbsp; /* Set up rectangle position in screen space */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xE4000000 | (bx &lt;&lt; 14) | (by &lt;&lt; 2) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (tx &lt;&lt; 14) | (ty &lt;&lt; 2) );<br /><br />&nbsp; &nbsp; /* Set up texture position and scaling to 1:1 copy */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (s &lt;&lt; 16) | t );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (xs &amp; 0xFFFF) &lt;&lt; 16 | (ys &amp; 0xFFFF) );<br /><br />&nbsp; &nbsp; /* Send command */<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br />}<br /></div></div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=9035">get_pixel.rar</a> [62.14 KiB]
			</span><br />
			<span class="gensmall">Downloaded 92 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row1">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=9034">test3.rar</a> [42.22 KiB]
			</span><br />
			<span class="gensmall">Downloaded 106 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=9033">test2.rar</a> [87.83 KiB]
			</span><br />
			<span class="gensmall">Downloaded 117 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row1">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=9032">test1.rar</a> [41.91 KiB]
			</span><br />
			<span class="gensmall">Downloaded 92 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=8494">BMBx64</a> on Thu May 25, 2017 2:14 pm, edited 2 times in total.</span>
						

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8494"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196617"></a>
				<b class="postauthor">getafixx</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196617">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196617#p196617"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 10:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5783_1365366973.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Dec 04, 2012 3:28 pm<br /><b>Posts:</b> 348<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Awesome stuff!<br /><br />The SOTN demo worked really well, music played until it got to BGM 12, then it stalled the system. Had to reset.<br /><br />Tried again, skipping tracks to get the BGM 12 which now worked, but when I skipped to BGM 13 it stalled again.<br /><br />This is testing on an Everdrive64.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5783"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196620"></a>
				<b class="postauthor">Drew Sebastino</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196620">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196620#p196620"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 10:57 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Espozo</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6683_1462234663.png" width="64" height="66" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 15, 2014 4:35 pm<br /><b>Posts:</b> 3359<br /><b>Location:</b> Nacogdoches, Texas
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">BMBx64 wrote:</div><div class="quotecontent">i don't know a place for N64 scene</div><br />Because there isn't one. <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" /><br /><br />May I ask, what is libdragon?<br /><br />Also, I don't understand how the second explosion demo has such worse performance than the first. Are you drawing all the pieces of an explosion with the same graphic before swapping out the texture in the texture cache? This should improve GPU performance, put then you'd also have to use the hardware z-buffer when drawing the explosion pieces instead of just sorting the order they are drawn with the CPU, which may negate the performance increase from changing the texture cache less often.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6683"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196623"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196623">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196623#p196623"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 11:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A <a href="https://www.google.com/search?q=n64+libdragon" class="postlink">Google search for n64 libdragon</a> brings up a <a href="https://github.com/DragonMinded/libdragon" class="postlink">library for N64 homebrew development</a> by the developer of DSOrganize.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196625"></a>
				<b class="postauthor">Drew Sebastino</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196625">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196625#p196625"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 11:10 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Espozo</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6683_1462234663.png" width="64" height="66" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 15, 2014 4:35 pm<br /><b>Posts:</b> 3359<br /><b>Location:</b> Nacogdoches, Texas
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I actually did Google libdragon, but I didn't really know what I was looking at. Is it a full game engine, or routines that could be used to make one? Seems pretty limited if it apparently can't support 4bpp or 8bpp textures, which shouldn't have been any harder to implement than 16bpp or 24bpp or 32bpp textures other than a palette also needs to be uploaded. (Also to the texture cache?)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6683"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196627"></a>
				<b class="postauthor">adam_smasher</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196627">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196627#p196627"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 11:16 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Mar 27, 2011 10:49 am<br /><b>Posts:</b> 259<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">...but then you'd also have to use the hardware z-buffer when drawing the explosion pieces instead of just sorting the order they are drawn with the CPU, which may negate the performance increase from changing the texture cache less often.</div><br />I don't know the first thing about N64 development, but isn't the whole point of a hardware Z-buffer that it's faster than sorting polys on the CPU?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4826"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196630"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196630">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196630#p196630"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 11:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I imagine that libdragon is analogous to Shiru's neslib.<br /><br />Using a depth buffer incurs an extra memory read per pixel and write per drawn pixel, and it doesn't work for translucent objects. I don't know enough about the Nintendo 64's memory controller to know under what exact conditions the tradeoff is favorable. It was common on the PlayStation to use a bucket sort based on the Z coordinate of the centroid, which is fairly fast provided there are no pathological cases of large triangles close together.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196633"></a>
				<b class="postauthor">Drew Sebastino</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196633">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196633#p196633"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 11:58 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Espozo</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6683_1462234663.png" width="64" height="66" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 15, 2014 4:35 pm<br /><b>Posts:</b> 3359<br /><b>Location:</b> Nacogdoches, Texas
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">adam_smasher wrote:</div><div class="quotecontent">isn't the whole point of a hardware Z-buffer that it's faster than sorting polys on the CPU?</div><br />Yes. However, using the hardware Z-buffer is slower for the GPU. If you are not changing out the texture cache for identical pieces in this case, you have to use the hardware Z-buffer, because you won't be able to sort the pieces of the explosions on a per pixel level by the CPU like the hardware Z-buffer will. You can avoid using the hardware Z-buffer by writing entire explosions in order, but then you have to change out the texture cache for every piece being drawn.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6683"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196636"></a>
				<b class="postauthor">adam_smasher</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196636">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196636#p196636"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 12:13 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Mar 27, 2011 10:49 am<br /><b>Posts:</b> 259<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yeah, I get it - I guess I'm just surprised using the Z-buffer is so much slower that it might be better to do CPU sorting &amp; constantly trash the texture cache when you're not even pushing the GPU that hard (5000 unshaded unlit triangles per second). And that's not an &quot;I'm surprised because that sounds unlikely and think you're wrong&quot; kind of surprised, but a genuine, &quot;woah, the N64's Z-buffer must be <em>terrible</em>&quot; kind of surprised.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4826"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196637"></a>
				<b class="postauthor">BMBx64</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196637">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196637#p196637"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 12:16 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://i.imgur.com/mtz71DO.png" width="64" height="64" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu May 25, 2017 7:27 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">getafixx wrote:</div><div class="quotecontent">Awesome stuff!<br /><br />The SOTN demo worked really well, music played until it got to BGM 12, then it stalled the system. Had to reset.<br /><br />Tried again, skipping tracks to get the BGM 12 which now worked, but when I skipped to BGM 13 it stalled again.<br /><br />This is testing on an Everdrive64.</div><br /><br />Thanks  <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> , not sure why it crashes, do you use expansion pak? I have PAL N64 with expansion and works fine forcing PAL or NTSC modes on Everdrive 2.5.<br /><br />However i know fopen/fclose have a memory leak, once the 100th file is open the next ones will fail (no handles), this can be &quot;fixed&quot; by using (dfs_open and dfs_close variant), i have to look at it, audio specially has been hard on N64 so far.<br /><br />Here a bit more info about this memory leak:<br /><a href="https://krikzz.com/forum/index.php?topic=5969.15" class="postlink">https://krikzz.com/forum/index.php?topic=5969.15</a><br /><br /><br /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">Also, I don't understand how the second explosion demo has such worse performance than the first. Are you drawing all the pieces of an explosion with the same graphic before swapping out the texture in the texture cache? This should improve GPU performance, put then you'd also have to use the hardware z-buffer when drawing the explosion pieces instead of just sorting the order they are drawn with the CPU, which may negate the performance increase from changing the texture cache less often.</div><br /><br />I wanted to check how goes the performance when textures are loaded without strategy, just to imagine worst scenarios, the sorting is done by the order in the program, a loop from 0 to max number of explosions, i don't know if Z-buffer is available for 2D rectangles.<br /><br />--<br /><br />For 8bit palettes, the low 2KB of the TMEM are filled with data, but the higher 2KB needs the color table lookup, then there are different formats, the grayscale ones works different i think, you can take more TMEM and set the color on the vertex.<br /><br />I may be interested specially on 4bit palette support (MD,SNES,etc), but i hope to fix all the basic things, like flip a sprite if anyone can help a bit with the rdp.c code i can do all kind of tests.<br /><br />--<br /><br />I forgot this one..<br /><br /><strong>TEST: LAYERS</strong><br />Small tiled scroll that manages unlimited layers (they impact performance at some point), some features:<br />- Layers can have a custom number of rows and columns<br />- Different tile sizes in each layer separately (ex: main scroll layer 32x32, background layer 64x32)<br />- Layers can be set to repeat horizontally or vertically.<br /><br />This pic shows 8 full screen layers (320x240x16), each one with unique texture:<br /><img src="https://i.imgur.com/PwtY1zC.gif" alt="Image" /><br /><br />CONTROLS<br />Push joystick to move camera at different speed<br /><br />DOWNLOAD<br /><a href="https://mega.nz/#!IhgTwJwK!AK67vHgNl6LpGoasvQtTuD1wGbYBGynOKYNT0yek6PE" class="postlink">https://mega.nz/#!IhgTwJwK!AK67vHgNl6LpGoasvQtTuD1wGbYBGynOKYNT0yek6PE</a></div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=9031">test4.rar</a> [40.2 KiB]
			</span><br />
			<span class="gensmall">Downloaded 95 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=8494">BMBx64</a> on Thu May 25, 2017 2:11 pm, edited 1 time in total.</span>
						

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8494"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196643"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196643">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196643#p196643"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 1:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">BMBx64, you should feel free to use the attachment interface here for anything that doesn't infringe copyright.<br /><br /><em>Especially</em> when they're only 40 KiB</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196716"></a>
				<b class="postauthor">Drew Sebastino</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196716">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196716#p196716"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 26, 2017 4:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Espozo</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6683_1462234663.png" width="64" height="66" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 15, 2014 4:35 pm<br /><b>Posts:</b> 3359<br /><b>Location:</b> Nacogdoches, Texas
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You know, I was going to post some thoughts I had on these demos and ideas on how to improve them, but I realized I really have no clue how exactly the N64 really works. I think the GPU is split into two parts, the RSP and the RDP, with the RSP being programmable and running the non-programmable RDP. Each one has 4KB of ram, with the RSP's ram holding instruction data and the RDP's ram holding texture data. What I really want to know, is how is the data changed? Is it by DMA initiated by the CPU, because if so, it seems the CPU would be doing nothing but waiting for the GPU to be done with its current task (like writing to the SPC700 on the SNES), unless the GPU can actually generate an interrupt.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6683"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196723"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196723">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196723#p196723"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 26, 2017 7:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">As I understand it: Ideally, while the RSP is rendering a frame, the CPU is running game logic and generating the display list for the RSP to render in the next frame.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196740"></a>
				<b class="postauthor">BMBx64</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196740">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196740#p196740"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 27, 2017 5:07 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://i.imgur.com/mtz71DO.png" width="64" height="64" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu May 25, 2017 7:27 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I finally added hardware flip feature, i will bring an example later.<br /><br />Instead of reverse texture on the load i though it was more wise when drawing, there could be plenty of uses without reload such as axial symmetry.<br /><br />I had to debug first how it works, the textures seems to be power of two sizes, for example mario texture is 16x31 and its rounded to 16x32, s and t coords have to be set accordingly to avoid garbage.<br /><img src="http://i.imgur.com/w1W0Mj8.jpg" alt="Image" /><br /><br />The performance seems to be about the same when setting MIRROR_ENABLED on the RDP (for hardware flip) so i removed some flags from rdp_load, this function previously used to be:<br />rdp_load_texture (uint32_t texslot, uint32_t texloc, mirror_t mirror_enabled, sprite_t *sprite)<br /><br />Now its just the texture call (which is faster):<br />rdp_load_texture ( sprite_t *sprite )<br /><br />Flags for the flip:<br />0 - Normal<br />1 - Horizontally<br />2 - Vertically<br />3 - Both<br /><br />rdp.c<br /><br />Changes on rdp_load:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">static uint32_t __rdp_load_texture(sprite_t *sprite, int sl, int tl, int sh, int th )<br />{<br />&nbsp; &nbsp; /* Invalidate data associated with sprite in cache */<br />&nbsp; &nbsp; if( flush_strategy == FLUSH_STRATEGY_AUTOMATIC )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; data_cache_hit_writeback_invalidate( sprite-&gt;data, sprite-&gt;width * sprite-&gt;height * sprite-&gt;bitdepth );<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; /* Point the RDP at the actual sprite data */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xFD000000 | ((sprite-&gt;bitdepth == 2) ? 0x00100000 : 0x00180000) | (sprite-&gt;width - 1) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (uint32_t)sprite-&gt;data );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Figure out the s,t coordinates of the sprite we are copying out of */<br />&nbsp; &nbsp; int twidth = sh - sl + 1;<br />&nbsp; &nbsp; int theight = th - tl + 1;<br />&nbsp; &nbsp; uint8_t mirror_enabled = 0;<br /><br />&nbsp; &nbsp; /* Figure out the power of two this sprite fits into */<br />&nbsp; &nbsp; uint32_t real_width&nbsp; = __rdp_round_to_power( twidth );<br />&nbsp; &nbsp; uint32_t real_height = __rdp_round_to_power( theight );<br />&nbsp; &nbsp; uint32_t wbits = __rdp_log2( real_width );<br />&nbsp; &nbsp; uint32_t hbits = __rdp_log2( real_height );<br /><br />&nbsp; &nbsp; /* Because we are dividing by 8, we want to round up if we have a remainder */<br />&nbsp; &nbsp; int16_t round_amount = (real_width % 8) ? 1 : 0;<br /><br />&nbsp; &nbsp; /* Instruct the RDP to copy the sprite data out */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xF5000000 | ((sprite-&gt;bitdepth == 2) ? 0x00100000 : 0x00180000) | <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(((((real_width / 8) + round_amount) * sprite-&gt;bitdepth) &amp; 0x1FF) &lt;&lt; 9));<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (mirror_enabled == 0 ? 0x40100 : 0) | (hbits &lt;&lt; 14 ) | (wbits &lt;&lt; 4) );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Copying out only a chunk this time */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xF4000000 | (((sl &lt;&lt; 2) &amp; 0xFFF) &lt;&lt; 12) | ((tl &lt;&lt; 2) &amp; 0xFFF) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (((sh &lt;&lt; 2) &amp; 0xFFF) &lt;&lt; 12) | ((th &lt;&lt; 2) &amp; 0xFFF) );<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br /><br />&nbsp; &nbsp; /* Save sprite width and height for managed sprite commands */<br />&nbsp; &nbsp; cache.width = twidth - 1;<br />&nbsp; &nbsp; cache.height = theight - 1;<br />&nbsp; &nbsp; cache.s = sl;<br />&nbsp; &nbsp; cache.t = tl;<br />&nbsp; &nbsp; cache.real_width = real_width;<br />&nbsp; &nbsp; cache.real_height = real_height;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; /* Return the amount of texture memory consumed by this texture */<br />&nbsp; &nbsp; return ((real_width / 8) + round_amount) * 8 * real_height * sprite-&gt;bitdepth;<br />}</div><br /><br />Changes on rdp_draw_textured_rectangle_scaled, still i have to test different texture sizes just to make sure its correct.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;if (flags &gt; 0)<br />&nbsp; &nbsp;{&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;if (flags != 2)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;s += ( (cache.width+1) + ((cache.real_width-(cache.width+1))&lt;&lt;1) ) &lt;&lt; 5;<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;if (flags != 1)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;t += ( (cache.height+1) + ((cache.real_height-(cache.height+1))&lt;&lt;1) ) &lt;&lt; 5;&nbsp; &nbsp;<br />&nbsp; &nbsp;}<br /></div><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void __rdp_draw_textured_rectangle_scaled( int tx, int ty, int bx, int by, double x_scale, double y_scale, int flags )<br />{<br />&nbsp; &nbsp; uint16_t s = cache.s &lt;&lt; 5;<br />&nbsp; &nbsp; uint16_t t = cache.t &lt;&lt; 5;<br /><br />&nbsp; &nbsp; /* Cant display &lt; 0, so must clip size and move S,T coord accordingly */<br />&nbsp; &nbsp; if( tx &lt; 0 )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp;&nbsp; &nbsp;if ( tx &lt; -cache.width ) { return; }<br />&nbsp; &nbsp; &nbsp; &nbsp; s += (int)(((double)((-tx) &lt;&lt; 5)) * (1.0 / x_scale));<br />&nbsp; &nbsp; &nbsp; &nbsp; tx = 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; if( ty &lt; 0 )<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; t += (int)(((double)((-ty) &lt;&lt; 5)) * (1.0 / y_scale));<br />&nbsp; &nbsp; &nbsp; &nbsp; ty = 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; /* Calculate the scaling constants based on a 6.10 fixed point system */<br />&nbsp; &nbsp; int xs = (int)((1.0 / x_scale) * 4096.0);<br />&nbsp; &nbsp; int ys = (int)((1.0 / y_scale) * 1024.0);<br /><br />&nbsp; &nbsp; if (flags &gt; 0)<br />&nbsp; &nbsp; {&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp; if (flags != 2)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; s += ( (cache.width+1) + ((cache.real_width-(cache.width+1))&lt;&lt;1) ) &lt;&lt; 5;<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp; if (flags != 1)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; t += ( (cache.height+1) + ((cache.real_height-(cache.height+1))&lt;&lt;1) ) &lt;&lt; 5;&nbsp; &nbsp;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp;<br />&nbsp; &nbsp; /* Set up rectangle position in screen space */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( 0xE4000000 | (bx &lt;&lt; 14) | (by &lt;&lt; 2) );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (tx &lt;&lt; 14) | (ty &lt;&lt; 2) );<br /><br />&nbsp; &nbsp; /* Set up texture position and scaling to 1:1 copy */<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (s &lt;&lt; 16) | t );<br />&nbsp; &nbsp; __rdp_ringbuffer_queue( (xs &amp; 0xFFFF) &lt;&lt; 16 | (ys &amp; 0xFFFF) );<br /><br />&nbsp; &nbsp; /* Send command */<br />&nbsp; &nbsp; __rdp_ringbuffer_send();<br />}</div><br /><br />I tried it combined with scale_x and scale_y, seems to be right with scale_y (also mid screen, with clipping):<br /><img src="http://i.imgur.com/SDdIHI5.jpg" alt="Image" /><br /><br />However i tested it with scale_x and pain arrived, i tried it without my code and still does the same, maybe a bug on the lib? I have to look at it.<br /><img src="http://i.imgur.com/wF6I2wa.jpg" alt="Image" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8494"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196760"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196760">Re: N64 programming (libdragon)</a></div><div style="float: right;"><a href="./viewtopic.php?p=196760#p196760"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 27, 2017 10:43 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">BMBx64 wrote:</div><div class="quotecontent">However i tested it with scale_x and pain arrived, i tried it without my code and still does the same, maybe a bug on the lib? I have to look at it.<br /><img src="http://i.imgur.com/wF6I2wa.jpg" alt="Image" /><br /></div>Looks like it's reading the source pixels four pixels as a time...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=23&amp;t=15988"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=23"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=23&amp;t=15988"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>5</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 66 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=23&amp;t=15988&amp;start=60">5</a> &nbsp;<a href="./viewtopic.php?f=23&amp;t=15988&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=355">ccovell</a> and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="15988" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23" selected="selected">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
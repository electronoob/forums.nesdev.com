<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - no$nes v1.1 emulator update released</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">no$nes v1.1 emulator update released</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9359">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9359</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>nocash</b> [ Sun Sep 30, 2012 10:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Updated my no$nes emulator, <!-- m --><a class="postlink" href="http://nocash.emubase.de/nes.htm">http://nocash.emubase.de/nes.htm</a><!-- m --> - The main news are: Excessive support for almost every controller and add-on that I've ever heard of. And support for the arcade and hotelbox variants of the NES hardware.<br /><br />Some things that will be still needed to be worked on are: MMC3 seems to cause various problems, don't know if this is a general emulation bug, or if it's related to different variants of MMC3 boards. And, since the last update, around 100 more or less obscure new mappers have showed up, which still aren't supported. And APU is still lacking DMC sound and APU needs some general testing and tuning, and a bunch of external audio sources also need to be implemented someday. Anyways, at the moment - and after some months of continous work - I am just happy to have finished the update.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Sun Sep 30, 2012 3:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How about supporting the variants of NROM-368, with CPROM, CNROM and Vs. System supported:<br /><br /><a href="http://wiki.nesdev.com/w/index.php/NROM-368" class="postlink">http://wiki.nesdev.com/w/index.php/NROM-368</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>nocash</b> [ Sun Sep 30, 2012 4:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Came across them recently too, but forgot to add them to the todo list (did so now). Many thanks for reminding me there! Would have been easy to forget them as they have no own mapper number. Hmmmm... that also leads to: Then I can scrap the sentence in the everynes.htm specs that says that Mapper 0 with more than 32K PRG-ROM is clearly indicating a corrupt file :-/ life isn't that simple. I guess updating the mapper specs may be another 6-months project.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Sep 30, 2012 5:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I like the debugging features, but found a little weird that the graphics in the VRAM viewer stretch with the window, and there's no way to snap to an integer scale, so everything is always distorted. I liked the &quot;assumed palette&quot; feature, but it would be nice if we could manually pick palettes too. Also, the BG Map and the tile info graphics are drawn with patterns that are mapped at the end of the frame, which doesn't allow us to debug the upper parts of the screen when patterns are switched mid screen. FCEUX has a &quot;show on scanline&quot; box so that you can sample the PPU on specific scanlines.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Sep 30, 2012 5:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I tested several games in this emulator.<br />There's no DMC channel emulation, so naturally, DMC IRQs don't work either.  No frame IRQs either.<br />Triangle Wave sometimes plays longer than it should in games like Kirby's Adventure.<br />The Slalom Test fails.  Coarse X scroll and Fine X scroll do not seem to be updated correctly.  Fine X should update immediately, and Coarse X should be updated on the next scanline due to the timing of the scroll writes.<br />Super Mario 3 crashes (KIL opcode) when you start a new game, and half of the Nintendo logo is missing.<br />My Chu Chu Rocket homebrew looks really bad on the emulator, not just IRQ problems, but wrong CHR problems as well.  Many emulators get this game wrong, but it's usually always IRQ timing problems.  I guess it's a good testcase for debugging MMC3 and timing problems.<br />Kickmaster doesn't run at all.<br />&quot;High Hopes&quot; demo mostly works, but has a few scrolling glitches, but the streaming PCM sounds great.  I was surprised to hear this when DMC wasn't working.<br />Elite is very shaky.<br />PAL sound pitch is too high, it's playing at NTSC-like frequencies.<br />Battletoads dies (misses the sprite 0 hit).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>nocash</b> [ Sun Sep 30, 2012 5:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />@ tokumaru<br />Good ideas! ...and more work to implement them.<br />Snapping would be neat, and would also require a disable snapping option (else scaling to factor 1.99 would become much smaller as the user may have desired it). The other thing that would be need (and more work) would be smooth resampling.<br />For palettes, you can select grayscale (useful if palette is all zerofilled). A feature for selecting from the 8 PPU palettes... I don't know how useful it'd be - it would require the user to select palettes manually, in most cases that's probably more user-interaction than you want to do (assuming that you just want to have a short look at what is in vram).<br />Scanline select could be really comfortable. At the moment (less comfortable), it should work if you place a breakpoint somewhere mid-frame (at least, it SHOULD work, if it doesn't, then I've screwed up something).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>nocash</b> [ Sun Sep 30, 2012 6:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />@ Dwedit<br />Thanks! Slalom test... that's the Slalom games, like in VS Slalom? I had noticed that game didn't work when testing VS emulation - but didn't figure out what I did wrong with it - must have been related to the Fine X thing, good to know that!<br />For APU, until a few days ago, I wasn't even aware of the more subtle PAL vs NTSC differences. The timing constants (like noise frequency table) seem to be different for PAL; and aren't yet emulated. For the normal triangle/rectangle channels, I was thinking that the game is responsible for matching the frequency values to PAL, so I could just use the same FrequencyValue to CpuClockCycle conversion as for NTSC, which should be working &quot;automatically&quot;. Maybe I've messed up something else elsewhere - like the fundamental 50Hz base frame rate :-) or it's been just a PAL detection problem - did you try selecting &quot;PAL&quot; manually in setup?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Sep 30, 2012 7:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: no$nes v1.1 emulator update released</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sound Frequency = CPU speed / 16 / (period value + 1)<br />NTSC Mode runs the CPU at 1.789772667MHz.  PAL Mode runs the CPU at 1.662607MHz.<br />So the sounds play at a different frequency on the NTSC console vs the PAL console for the same period value.  It's roughly one half-step lower on the PAL console.  127.595 cents lower.  (Cents is a logarithmic scale, 100 cents is the difference between C and C#)<br /><br />I was testing this with the High Hopes demo, which only runs in PAL mode.  I configured the emulator to force PAL mode.  And the sound frequency was about one half-step too high.<br /><br />About Slalom...<br />Slalom writes to 2005 during the &quot;hblank time&quot;, which is the time between dot 256 and 341.  Slalom begins most of its writes between dot 293 and dot 317.<br />At dot 257 of each scanline, the coarse horizontal scroll bits (.....x.....xxxxx) are copied from the latch value &quot;T&quot; to the vram address value &quot;V&quot;.<br />So even though the game just wrote a new scroll value to 2005, it won't apply until the next time the PPU reaches dot 257.<br />But changes to fine X scroll apply instantly no matter when the 2005 write took place.<br /><br />So the game is writing values to $2005 with the low 3 bits containing fine X for the upcoming scanline, and the top 5 bits containing the coarse X for the scanline after that.<br /><br />Note that write instructions begin at a particular timestamp, but the write only actually happens when the write cycle of an instruction completes.  For example, most games do sta XXXX, which takes 4 CPU cycles.  The write cycle is the last part of that instruction.  If you multiply by 3 to convert to PPU dots (for NTSC), you get 12 dots.  So an instruction might begin executing at dot 245, but will finish at dot 257.<br /><br />Important timings:<br />Dot 304 of prerender scanline: V = T<br />Dot 251 of each scanline: Y scroll bits of V are incremented.  T is unaffected.<br />Dot 257 of each scanline: X scroll bits of T are copied to V.<br /><br />Get these timings good, and all the scrolling glitches disappear.  Then you just have to worry about accurate timing for external IRQs, like MMC3.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - some advice here please</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">some advice here please</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1194">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1194</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Anes</b> [ Mon Mar 06, 2006 2:06 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>some advice here please</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Im planning to change my cpu core to a "cycle by cycle" one, is it a good idea?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Mon Mar 06, 2006 8:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ha ha ha ha ha ha ha ha ha ha!
<br />
<br />.....
<br />
<br />Ha ha ha ha ha ha ha ha ha ha! Ha ha ha ha ha ha ha ha ha ha!
<br />
<br />Sorry, Anes but I almost passed out when I read that post. Read here for your answer.
<br />
<br /><a href="http://nesdev.com/bbs/viewtopic.php?t=547" class="postlink">http://nesdev.com/bbs/viewtopic.php?t=547</a>
<br />
<br />Yes you read it right <em>x30</em> slower.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Mon Mar 06, 2006 12:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />One might not be aiming for speed. Some designs are simpler to implement, debug, and change. Also remember that you can't time a method of emulation, only an <em>implementation</em> of that method. Some implementations are slower than others.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Mar 06, 2006 1:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I couldn't fix timing problems while using scanline rendering. Everything was <em>gone</em> after the cycle exact emulation. Plus, the speed wasn't SO bad. Modern machines can run it nicely. Be honest- you won't use a CPU clock less than 800MHz nowadays... -_-;; (NESticle, *bump*, baboo)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hyde</b> [ Mon Mar 06, 2006 2:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Ha ha ha ha ha ha ha ha ha ha!<br /><br />.....<br /><br />Ha ha ha ha ha ha ha ha ha ha! Ha ha ha ha ha ha ha ha ha ha!<br /><br />Sorry, Anes but I almost passed out when I read that post. Read here for your answer.<br /><br /><a href="http://nesdev.com/bbs/viewtopic.php?t=547" class="postlink">http://nesdev.com/bbs/viewtopic.php?t=547</a><br /><br />Yes you read it right <em>x30</em> slower.</div><br /><br />Ha.<br /><br /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent">Be honest- you won't use a CPU clock less than 800MHz nowadays... </div>
<br />
<br />I disagree. I'm a proud user of a 600 MHz Celeron processor.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Mon Mar 06, 2006 2:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent">I couldn't fix timing problems while using scanline rendering. Everything was gone after the cycle exact emulation.</div>
<br />
<br />It's possible to emulate the CPU-affecting aspects of the PPU to 5.4 MHz accuracy, but do the actual scanline rendering instantaneously at some point along the scanline. This way you get full accuracy for anything that doesn't rely on mid-scanline reads and writes, and only minor cosmetic glitches for games that do mid-scanline writes. All the sprite 0 hit and other PPU timing ROMs I've written pass on an emulator written this way.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Mar 06, 2006 5:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">It's possible to emulate the CPU-affecting aspects of the PPU to 5.4 MHz accuracy, but do the actual scanline rendering instantaneously at some point along the scanline. This way you get full accuracy for anything that doesn't rely on mid-scanline reads and writes, and only minor cosmetic glitches for games that do mid-scanline writes.</div>
<br />If you can timestamp all writes to PPU registers and then render pixels in horizontal runs between timestamps, either at the end of a scanline or whenever $2002 is read on an "interesting" scanline, how would you get any sort of cosmetic glitch?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Mon Mar 06, 2006 6:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You wouldn't get any cosmetic glitch if you rendered partial scanlines; my point was that you can avoid that complexity without affecting the accuracy of the CPU and game, just with slight cosmetic issues for those few games that rely in mid-scanline changes. The comment was directed at the mentality that you can either run the CPU in uninterrupted bursts of 113/114 clocks and have the resulting low accuracy, or run the PPU every pixel and pay a big performance penalty.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Mar 06, 2006 8:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />SO... I would had to accept the hillarious "HAHAHA" from WedNESDay after all. No, just don't label cycle-exact emulation as "slow" or anything that blows away all the effort in order to emulate the NES hardware accurately. *I* couldn't fix the timing problems- if you have the magic, great. If a lot of timestamps are useful rather than pixel-exact emu, go laugh a bit... -_-;;

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Mar 06, 2006 10:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Timestamps <em>are</em> pixel-exact. It's just that emulation of one processor at a time, switching only when processors interact, might be a lot more friendly to unrolling and caching mechanisms.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mozz</b> [ Tue Mar 07, 2006 12:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Timestamps are pixel-exact. It's just that emulation of one processor at a time, switching only when processors interact, might be a lot more friendly to unrolling and caching mechanisms.</div>
<br />The "switching only when processors interact" part is important.  You don't have to simulate the separate pieces of hardware in lock-step unless they can have unilateral side effects on each other at any time (such as raising interrupts).  I don't know much about NES hardware but it sounds like the CPU can unilaterally affect PPU but not the other way around.  So you simulate the CPU ahead and pause to let the PPU simulation "catch up" whenever you need to cause a side effect on the PPU or read a port value which depends on what the PPU has been doing up to the CPU's current simulated time.
<br />
<br />This concept can be applied even when the two pieces of hardware don't share a clock.  The important thing is to identify what kind of side effects are possible from each piece of hardware to each other piece, and ensure (e.g. with timestamps) that all visible side effects are ordered correctly.  For example, in an SNES, the CPU and the SPC700 sound chip run on totally unrelated clocks, but any communication between the two requires a port write by one chip *and then* a port read by the other chip.  Because both chips have to participate in the communication, you can actually let either of them run "ahead" in its simulation and just log the writes in case the "behind" chip wants to know what values were in the ports at a certain time.  Only when the "ahead" chip wants to read from the "behind" chip do you have to context switch.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>augnober</b> [ Tue Mar 07, 2006 1:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />optimistic devil's advocate post:
<br />If it really is simpler to develop, it doesn't seem particularly crazy to me to go ahead and write it (a learning exercise in itself) and then have it available later on for reference and development purposes when writing a faster implementation if you later choose.  This is especially when NES emulation is already such a crowded space.  Why not write the best cycle-based NES emulator?  Who knows.. you may even end up with interesting techniques if you continue to attack the accuracy+speed problem from a different starting point, and there's a possibility you could even be fortunate enough to first attain high accuracy sooner this way - possibly accelerating development of a faster revision.  Even if it can never run full-speed, you can still log all you want and record videos, or even run cores in parallel to check for diffs.  If you want to see things run full-speed and accurate enough for generally sane purposes, the easy solution is to download Nintendulator (or whatever) and you're done without the effort.. but if you're going through the trouble of writing one yourself, that's hardly the point anyway.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Tue Mar 07, 2006 8:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent">SO... I would had to accept the hillarious "HAHAHA" from WedNESDay after all...</div>
<br />
<br />Ha ha ha (Cough! Cough!)... Ouch...
<br />
<br />I've gone back to the normal method of opcode execution, and I'm pleased to say it only needs 25Mhz. If I did stay with the cycle for cycle version I would need 750Mhz, <span style="text-decoration: underline">just</span> for the CPU alone. So if 1.79Mhz needs 750Mhz, god knows what a PSX/Gamecube emulator would need. Here is a snippet of my cycle for cycle accurate 6502;
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">inline void OpticCodeAD&#40;&#41;<br />&#123;<br />&nbsp; &nbsp;switch&#40;CPU.Cycle&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 0:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.PC++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Cycle++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 1:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Address = CPU.Memory&#91;CPU.PC&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.PC++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Cycle++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 2:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Address += &#40;CPU.Memory&#91;CPU.PC&#93; &lt;&lt; 8&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.PC++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Cycle++;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;&nbsp; &nbsp;case 3:<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.A = CPU.Memory&#91;CPU.Address&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.P &amp;= 0x7D;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if&#40; !CPU.A &#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.P += 0x02;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.P += &#40;CPU.A &amp; 0x80&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CPU.Cycle = 0;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;break;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;CPU.CC++;<br />&#125;<br /></div>
<br />
<br />Though I have to admit that Quietust's method is better.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Tue Mar 07, 2006 2:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Ha ha ha (Cough! Cough!)... Ouch...</div><br /><br />bump.<br /><br /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">I've gone back to the normal method of opcode execution, and I'm pleased to say it only needs 25Mhz. If I did stay with the cycle for cycle version I would need 750Mhz, <span style="text-decoration: underline">just</span> for the CPU alone. So if 1.79Mhz needs 750Mhz, god knows what a PSX/Gamecube emulator would need. Here is a snippet of my cycle for cycle accurate 6502;<br /><br />Though I have to admit that Quietust's method is better.</div>
<br />
<br />bump++;
<br />Well, the latest public release of my emu is simply slower than a turtle, but it was drastically improved. A few overloads were slowing down the things, plus the frame sync problem. I remember from old times when timestamp was used for APU emulation (read: it <strong>failed</strong>) and... there was a glitchy game, making the real-time emulation required for proper work. ^_^;; 
<br />
<br />Anyway, if you w4nn4 sp33d, you should try NESticle! &gt;_&lt;

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Tue Mar 07, 2006 2:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent">Anyway, if you w4nn4 sp33d, you should try NESticle! &gt;_&lt;</div>
<br />
<br />And if you want a really old and incompatible emulator, you should try NESticle! &gt;_&lt;

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
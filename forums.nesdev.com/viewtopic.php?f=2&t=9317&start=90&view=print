<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - new to NES, layering simulation effect question</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">new to NES, layering simulation effect question</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9317">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9317</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>7</strong> of <strong>13</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Fri Sep 21, 2012 5:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes but I'd consider CHR-RAM to be as &quot;special support&quot; or even above CHR-ROM bank switching.<br /><br />Vertical would be tricky with the sprite limits... more reason to try it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sat Sep 22, 2012 1:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Crude right now, needs some clean up and polish but here we go.<br /><br />I cheated and avoid messing with the attribute table just yet, no sprites yet, etc.  Work in progress but demonstrates the effect.  <br /><br />Could even have a scrolling 2 screen room with 2k of VRAM on the cart for X scroll.  16 versions of the BG tile (8 horizontal x 2 4 pix vertical) and you could even have the BG parallax scrolling horizontally while the floor and ceiling are moving up and down.<br /><br />Hit a small snag initially, totally forgot about 16 bit arithmetic handling dynamic name table updates on a 8 bit CPU <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=54">crush.zip</a> [1.16 KiB]
			</span><br />
			<span class="gensmall">Downloaded 33 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sat Sep 22, 2012 2:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sped it up and added a delay at the extents to be something more like what you would see in a game.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=55">crush.zip</a> [1.18 KiB]
			</span><br />
			<span class="gensmall">Downloaded 51 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sat Sep 22, 2012 2:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />With a moving pattern that simple, you don't even need to animate the CHR data.  Swapping to a secondary nametable, or palette animation would work too.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sat Sep 22, 2012 2:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">With a moving pattern that simple, you don't even need to animate the CHR data.  Swapping to a secondary nametable, or palette animation would work too.</div><br /><br />Yeah it's just a place holder.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sat Sep 22, 2012 3:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Interesting! That would be really cool in a game.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sun Sep 23, 2012 2:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Interesting! That would be really cool in a game.</div><br />This !

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sun Sep 23, 2012 4:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Messing around a little more.<br /><br />Next up probably dynamically updating attribute tables so I can put the BG parts on their own palette.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=58">crush.zip</a> [2.05 KiB]
			</span><br />
			<span class="gensmall">Downloaded 154 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sun Sep 23, 2012 9:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hmm attribute table handling is getting out of hand when you start having features split across attribute bytes, having to read/mask/write, skip every other frame, etc.<br /><br />So I'm going to rethink my approach by using display lists that instead just have address, count, and data and just blast per frame changes to the name table/attribute table with a unique display list per frame of animation.  Then the code just simplifies to a simple array loop [lugging bytes into 2006/2007.<br /><br />The code using LDA/STA sequences was already hard coded to a specific screen, so that doesn't matter.  The display lists will be smaller than the code I'm using now currently since they will be the same exact data without the opcode bytes and STA addresses, and will clean up the code considerably into a generic reusable loop.  I won't even have to do address calculations or offset by the frame count, since everything will be pre-computed in the addresses in the display list.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Sep 23, 2012 9:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Since this is just a demo and not a game, I guess that cheating with pre-computed data is OK.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sun Sep 23, 2012 10:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is it cheating though?  It's not a simple case of adding a row/column to the name/attribute table as in regular scrolling.<br /><br />The changes made per frame are unique and specific to the &quot;room&quot; being shown and are in a fixed pattern tied to the layout of the &quot;room&quot;, thus the data is hard coded and tied to the screen being shown regardless of being a game or demo.<br /><br />Making them as display lists tied to the &quot;room&quot; is no different than pre-computed name/attribute tables for a given room.<br /><br />Making them as display lists makes the &quot;room&quot; animation data driven and straight forward to manipulate as data belonging to the &quot;room&quot; rather than having to write/modify unique specific code for every single room<br /><br />I suppose it could be argued another alternative would be to do an array copy from the existing name/attribute table and just bring down the parts I want one row at a time.  But doing that is far more cumbersome because again, there are lots of random breaks in what gets copied, it's not just straight rows/cols, so you will always need some unique data/code saying what to copy and when.<br /><br />6 tile row starting at (x, y), 4 tile row starting at (x2, y2), etc.<br /><br />If anything I'll look to compressing the display lists by simply referencing the existing name table and how many tiles to copy so the data (tile index bytes) isn't duplicated in the display lists.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Sep 23, 2012 10:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, to me it's cheating if it can't be implemented in a game. I guess that if you were to do it exactly like in Bucky O'Hare, where this happens in a room with no scrolling, it wouldn't be cheating. However, if this was part of a larger scrolling map, hardcoding VRAM updates would be harder because this special section would have to play nice with the scrolling engine, which is very dynamic.<br /><br />I do like demos, but in the end, what matters to me is that things are feasible in actual games. =) If it works well inside the game engine and feels like it belongs there, I guess don't mind that the data necessary for special effects is pre-calculated.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sun Sep 23, 2012 11:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The biggest trouble I'm having is the read/modify/write required with the attribute table if I am to modify the attribute data in place instead of blowing it away with a display list.<br /><br />Due to the auto-incrementing nature of $2006/$2007, it would require writing the same address twice, to LDA $2007 an attribute byte, mask in the affected row (either bits 0-3 or 4-7), then STA to zero page in order to LDAx2 the address again, STAx2 the SAME address again , re-LDA the saved attribute byte from zero page, and STA $2007 it.  Just seems highly inefficient to me.  All that address reading/writing to modify a single attribute byte.  <br /><br />Of course I could do a read pass to ram, modify in ram, then a write pass, haven't tried that yet.  It IS only 8 bytes of attribute data after all per vertical animation frame (of only a nibble of each is actually being updated).  But again the data is broken up into regions, not just straight across, so the address setting to $2006 is going to have to be coded in specific to the level geometry.<br /><br />I thought about just doing a reading the attribute data from the original source in PRG-ROM, modifying, and writing IT to avoid that problem, but it's still messy.  I'm going to experiment with this too: read non incrementing row from ROM, modify and write to incrementing VRAM to duplicate downward, then erasing would be trivially recopying the original ROM table back to VRAM 1 line at a time in reverse.<br /><br />The display list solution is just more elegant, and from the perspective of a level designer doesn't require special code that is tied to the tile layout of the level data.<br /><br />It could be easily modified to work with scrolling by simply adding offsets when loading the base address from the display list.<br /><br />Regardless of how I implement it, the code or precomputed data IS going to be tied to the geometry of the scene, there is no avoiding that since the rows/columns are broken up into varying regions, making it &quot;special case&quot;.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>exdeath</b> [ Sun Sep 23, 2012 11:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think it's time to invest in a generic name table/attribute table row/column copy library.<br /><br />I was thinking with 2k CHR-ROM I would do 2 scrolling screens of vertically animated floor/ceiling, but I got to thinking, that's not enough... I eventually want to be able to scroll indefinitely so I need to be able to copy any arbitrary row/column at any scroll offset.  Display lists will become significant in size and data duplication with anything more than a few screens.<br /><br />I am starting to think like some of the Super Mario World levels where the entire level is navigating a maze where the ceiling is moving up and down.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Sep 23, 2012 11:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: new to NES, layering simulation effect question</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Did you ever see <a href="http://www.qmtpro.com/~nes/demos/smwstomp.zip" class="postlink">Quietust's Stomp demo</a>?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>7</strong> of <strong>13</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
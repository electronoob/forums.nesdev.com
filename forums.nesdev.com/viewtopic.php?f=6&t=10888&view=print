<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - FamiTone2 audio library</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">FamiTone2 audio library</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=10888">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=10888</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shiru</b> [ Mon Jan 13, 2014 8:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><a href="http://shiru.untergrund.net/files/src/famitone2.zip" class="postlink">Download FamiTone2</a><br /><br />The original FamiTone got a major update, with data formats change and player and tools code rewrite. The most important improvements are:<br /><br />- Built-in FamiTracker text export support instead of the old TextExporter plug-in<br />- Faster code<br />- Smaller data size<br />- Tempo support<br />- Full NTSC/PAL support, with pitch and speed compensation

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Mon Jan 13, 2014 8:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Dendy support too?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shiru</b> [ Mon Jan 13, 2014 8:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />No.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Mon Jan 13, 2014 11:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Which assemblers are supported, which expansion audio is supported, and can any other formats be imported (such as MML or Csound)?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Jan 13, 2014 12:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">zzo38 wrote:</div><div class="quotecontent">Which assemblers are supported</div><br />From readme.txt:<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">text2data outputs data in NESASM format by default, you can use -ca65 or -asm6 switches to get output for these assemblers.</div><br />From text2data.cpp:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#define OUT_NESASM&nbsp; &nbsp;0<br />#define OUT_CA65&nbsp; &nbsp;1<br />#define OUT_ASM6&nbsp; &nbsp;2</div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">which expansion audio is supported</div><br />Doesn't look like any. From text2data.cpp:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#define MAX_PACKED_PATTERNS&nbsp; &nbsp;(5*MAX_ORDER*MAX_SUB_SONGS)</div><br />That covers pulse, pulse, triangle, noise, and DPCM.<br /><br />From nsf2data.cpp:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;if(nsf_data&#91;0x7b&#93;)<br />&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;printf(&quot;Expansion chips are not supported\n&quot;);<br />&nbsp; &nbsp;&nbsp; &nbsp;free(nsf_data);<br />&nbsp; &nbsp;&nbsp; &nbsp;return 1;<br />&nbsp; &nbsp;}<br /></div><br />Let me know which expansion audio is supported by any all-new-parts flash cartridge.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">and can any other formats be imported (such as MML or Csound)?</div><br />I see something that appears designed for sound effects in FamiTracker NSFs, but not much more.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shiru</b> [ Mon Jan 13, 2014 2:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is it really necessary to quote random code pieces and make guesses when everything is clearly stated in the readme.txt, and is not changed since the original version? Please understand, I don't need any docs by myself, I spend quite some time and effort to write them for your convenience. Please read them.<br /><br /><div class="quotetitle">line 14 of the readme.txt wrote:</div><div class="quotecontent">Expansion sound chips are not supported.</div><br /><div class="quotetitle">'How to use the library' section wrote:</div><div class="quotecontent">The main version of the FamiTone2 is written in NESASM. There are <br />versions for CA65 and ASM6 assemblers included in the package as well.</div><br /><br /><div class="quotetitle">zzo38 wrote:</div><div class="quotecontent">can any other formats be imported (such as MML or Csound)</div><br />No. It is clearly explained in the readme.txt which formats are supported and how it all works. It is possible to use other import sources, but you'll have to write your own converter, which is a good half of the whole thing.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>DevEd</b> [ Tue Jan 14, 2014 7:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm having trouble getting this to work with cc65. I have sound effects working fine, but I can't get music to work at all.<br /><br />This line of code is what *SHOULD* play the music:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if(controllerInput&amp;PAD_START) music_play(music_test);</div><br /><br />Here is the function definition for music_play (I DID modify it slightly):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">_music_play:<br />&nbsp; &nbsp;stx &lt;PTR<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;ldy &lt;PTR<br />&nbsp; &nbsp;jmp FamiToneMusicPlay</div><br /><br />Is there something I'm missing?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Jan 14, 2014 8:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If music_play is a fastcall function with one parameter, that parameter is in A. What are you doing with X?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Tue Jan 14, 2014 8:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The confusion maybe stems from the fact that in FamiTone1, FamiToneMusicStart took a 16-bit parameter (pointer to the music data), whereas in FamiTone2 FamiToneMusicPlay takes a single byte (sub song number).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>DevEd</b> [ Tue Jan 14, 2014 1:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What exactly do I need to do in order to get a song to play with cc65?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Jan 14, 2014 2:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Your _music_play function is broken, is what I was saying. I don't know where you got that from, as it does not appear to be part of FamiTone2.<br /><br />The first question is whether it is declared correctly. If it takes one parameter in A, it should be declared like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">extern void __fastcall__ music_play(unsigned char a);</div><br /><br />The second problem is the contents of your _music_play routine. There is no useful value in X when it music_play is called from C, so storing it is counter-productive. Similarly, I don't know what you're doing with X or Y before you call FamiToneMusicPlay, which according to the readme takes a single parameter in A. Your _music_play should just look like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">_music_play:<br />&nbsp; &nbsp; jmp FamiToneMusicPlay</div><br /><br />The rest of how to use it is in the readme, from what I can tell. Did you initialize it?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Punch</b> [ Tue Jan 14, 2014 5:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes, thanks! I really didn't have any problems with version 1 but I appreciate the work that went in the text export support and better performance.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>JRoatch</b> [ Wed Feb 05, 2014 7:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />With these changes, Dendy can be supported by separating out tempo and pitch. Note the different input spec of A for FamiToneInit<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">--- famitone2.s&nbsp; &nbsp;2014-02-03 11:15:22.886592429 -0500<br />+++ famitone2-edit.s&nbsp; &nbsp;2014-02-03 11:17:29.781515804 -0500<br />@@ -209,7 +209,7 @@<br />&nbsp;<br />&nbsp;;------------------------------------------------------------------------------<br />&nbsp;; reset APU, initialize FamiTone<br />-; in: A&nbsp; &nbsp;0 for PAL, not 0 for NTSC<br />+; in: A&nbsp; &nbsp;bit 7 is frame rate. bit 6 is pitch. 0 for PAL, 1 for NTSC<br />&nbsp;;&nbsp; &nbsp; &nbsp;X,Y pointer to music data<br />&nbsp;;------------------------------------------------------------------------------<br />&nbsp;<br />@@ -221,10 +221,7 @@<br />&nbsp;&nbsp; &nbsp;sty &lt;FT_TEMP_PTR_H<br />&nbsp;<br />&nbsp;&nbsp; &nbsp;.if(FT_PITCH_FIX)<br />-&nbsp; &nbsp;tax&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;set SZ flags for A<br />-&nbsp; &nbsp;beq @pal<br />-&nbsp; &nbsp;lda #64<br />-@pal:<br />+&nbsp; &nbsp;and #192&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; mask out other bits<br />&nbsp;&nbsp; &nbsp;.else<br />&nbsp;&nbsp; &nbsp;.if(FT_PAL_SUPPORT)<br />&nbsp;&nbsp; &nbsp;lda #0<br />@@ -374,8 +371,8 @@<br />&nbsp;&nbsp; &nbsp;bne @set_channels<br />&nbsp;<br />&nbsp;<br />-&nbsp; &nbsp;lda FT_PAL_ADJUST&nbsp; &nbsp;&nbsp; &nbsp;;read tempo for PAL or NTSC<br />-&nbsp; &nbsp;beq @pal<br />+&nbsp; &nbsp;bit FT_PAL_ADJUST&nbsp; &nbsp;&nbsp; &nbsp;;read tempo for PAL or NTSC<br />+&nbsp; &nbsp;bpl @pal<br />&nbsp;&nbsp; &nbsp;iny<br />&nbsp;&nbsp; &nbsp;iny<br />&nbsp;@pal:<br />@@ -580,6 +577,7 @@<br />&nbsp;&nbsp; &nbsp;adc FT_CH1_NOTE_OFF<br />&nbsp;&nbsp; &nbsp;.if(FT_PITCH_FIX)<br />&nbsp;&nbsp; &nbsp;ora FT_PAL_ADJUST<br />+&nbsp; &nbsp;and #127&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;zero out bit 7<br />&nbsp;&nbsp; &nbsp;.endif<br />&nbsp;&nbsp; &nbsp;tax<br />&nbsp;&nbsp; &nbsp;lda FT_CH1_PITCH_OFF<br />@@ -613,6 +611,7 @@<br />&nbsp;&nbsp; &nbsp;adc FT_CH2_NOTE_OFF<br />&nbsp;&nbsp; &nbsp;.if(FT_PITCH_FIX)<br />&nbsp;&nbsp; &nbsp;ora FT_PAL_ADJUST<br />+&nbsp; &nbsp;and #127&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;zero out bit 7<br />&nbsp;&nbsp; &nbsp;.endif<br />&nbsp;&nbsp; &nbsp;tax<br />&nbsp;&nbsp; &nbsp;lda FT_CH2_PITCH_OFF<br />@@ -646,6 +645,7 @@<br />&nbsp;&nbsp; &nbsp;adc FT_CH3_NOTE_OFF<br />&nbsp;&nbsp; &nbsp;.if(FT_PITCH_FIX)<br />&nbsp;&nbsp; &nbsp;ora FT_PAL_ADJUST<br />+&nbsp; &nbsp;and #127&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;zero out bit 7<br />&nbsp;&nbsp; &nbsp;.endif<br />&nbsp;&nbsp; &nbsp;tax<br />&nbsp;&nbsp; &nbsp;lda FT_CH3_PITCH_OFF<br />@@ -1010,8 +1010,8 @@<br />&nbsp;<br />&nbsp;&nbsp; &nbsp;.if(FT_PITCH_FIX)<br />&nbsp;<br />-&nbsp; &nbsp;lda FT_PAL_ADJUST&nbsp; &nbsp;&nbsp; &nbsp;;add 2 to the sound list pointer for PAL<br />-&nbsp; &nbsp;bne @ntsc<br />+&nbsp; &nbsp;bit FT_PAL_ADJUST&nbsp; &nbsp;&nbsp; &nbsp;;add 2 to the sound list pointer for PAL tempo<br />+&nbsp; &nbsp;bmi @ntsc<br />&nbsp;&nbsp; &nbsp;inx<br />&nbsp;&nbsp; &nbsp;bne @no_inc1<br />&nbsp;&nbsp; &nbsp;iny<br /></div><br /><br />Edit: typo

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>pops</b> [ Wed Feb 05, 2014 11:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Tempo support makes this a huge improvement. Thank you Shiru!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>pops</b> [ Fri Feb 07, 2014 12:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FamiTone2 audio library</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I translated the FamiTone2 library to the assembler format used by <a href="http://michaelcmartin.github.io/Ophis/" class="postlink">Ophis</a>. Because Ophis does not support conditional compilation (ifdef, etc.), I simply left all features enabled.<br /><br />Total library size is 1632 bytes, including 259 bytes of data. Song data for my project is 20% smaller than the previous version of FamiTone.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=1200">famitone2ophis.asm</a> [27.16 KiB]
			</span><br />
			<span class="gensmall">Downloaded 129 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Replacement Graphics in Shonumi's Game Boy Enhanced</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Replacement Graphics in Shonumi's Game Boy Enhanced</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=20&amp;t=11216">http://forums.nesdev.com/viewtopic.php?f=20&amp;t=11216</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Tygerbug</b> [ Sun May 04, 2014 7:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Shonumi's Game Boy Enhanced emulator project can replace graphics in Game Boy games.<br /><br />Kirby's Dream Land gets a color makeover here:<br /><!-- m --><a class="postlink" href="https://www.youtube.com/watch?v=kbd7lGXfRxI">https://www.youtube.com/watch?v=kbd7lGXfRxI</a><!-- m --><br /><br /><!-- m --><a class="postlink" href="http://code.google.com/p/gb-enhanced/">http://code.google.com/p/gb-enhanced/</a><!-- m --><br /><!-- m --><a class="postlink" href="http://6bit.net/shonumi/2013/07/18/emulating-game-boy-games-with-customcolorized-sprites/">http://6bit.net/shonumi/2013/07/18/emul ... d-sprites/</a><!-- m --><br /><!-- m --><a class="postlink" href="https://forums.dolphin-emu.org/Thread-programming-discussion-thread?page=18">https://forums.dolphin-emu.org/Thread-p ... ad?page=18</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>strat</b> [ Wed Oct 15, 2014 5:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here's a crazy thought:  Could that emulator be used to take the color out of GBC games?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Oct 15, 2014 5:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />R = G = B = .3R + .6G + .1B also takes the color out of games for any platform that uses RGB color.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Sik</b> [ Wed Oct 15, 2014 1:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />But that wouldn't be the same as using original GB palettes, right? (I imagine that's the idea here)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shonumi</b> [ Wed Oct 15, 2014 9:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It would also be possible to do something like:<br /><br />1) Examine each of the color palettes, calculate the brightness of each color<br />2) Based on the brightness, try to map this to an equivalent DMG shade of gray when drawing<br />3) Hope for the best<br /><br />It's something that crossed my mind, although I'm not certain how well that would or wouldn't work. Can't say until I've tested it.<br /><br />BUT, I think strat was asking something more along the lines of &quot;can GB Enhanced replace a game's original colorized graphics with my custom grayscale graphics?&quot; The answer is complicated. Yes, in practice one should be able to dump the game's colorized graphics, convert them to grayscale in an editor, and have GB Enhanced upload them when it plays a GBC titles. GB Enhanced doesn't care whether the uploaded images are grayscale or not; it's just pixels to the program, so any style will work (neon, pastel, metal, etc). <br /><br /><strong>However</strong>, GB Enhanced can only experimentally dump and load sprites from GBC titles (and BG dumping/loading hasn't been implemented at all). The whole process of adequately hashing GBC tiles is more involving than DMG tiles, and I never got around to finishing custom graphics support for GBC games. The work is mostly complete in a separate branch, but I started working on the successor to GB Enhanced (unsurprisingly called GB Enhanced+, or GBE+). I'm aiming on making it a DMG/GBC/GBA emulator with the ability to replace graphics for all 3 handhelds. I'm knee-deep in GBA emulation at the moment, but rest assured GBE+ will improve upon GB Enhanced. It'll also have a GUI, which is somewhat essential for extensive editing. So what strat is looking to do will be possible, eventually.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>GGuy</b> [ Tue Dec 16, 2014 8:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've been working with games on GBE for quite awhile now. Yesterday I found a way around the duplicate tile problem but it's pretty much a chr hack. It works well enough though. I've also edited the source to package everything into a nice little way for releases. There are some glaring issues that I can't figure out how to fix which is disappointing. LCD brightness I think it is. The tiles dump but don't load. Not sure why...<br /><br />Anyways here's an unofficial build of Game Boy Enhanced from August.<br /><a href="https://drive.google.com/file/d/0B5aZT1MLfWJsY185RTF3TDZBZ0U/view?usp=sharing" class="postlink">https://drive.google.com/file/d/0B5aZT1MLfWJsY185RTF3TDZBZ0U/view?usp=sharing</a><br /><br />Looking forward to GBE-plus!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shonumi</b> [ Wed Dec 17, 2014 7:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />When you say duplicate tile issue, I assume you're talking about the issue brought up on Google Code (involving Metroid II?) I'd love to know (on a technical level) just what exactly is causing that and how to reliably reproduce it myself. I think root may be an issue with XORing the palette data onto the tile's hash. That may not be enough to gaurantee that collisions don't happen.<br /><br />In the end though, I may just have to prefix the hash with the DMG palette represented in hex (which should have been my 1st choice anyway). This is similar to what's required for dumping and loading GBC sprites (which need color palette data to be prefixed to the base hash to create a unique hash). I'll look at the code you posted later and see what's up. I may just have to break compatibility in GBE+ (but it's simple enough to add an option to for backwards compatibility).<br /><br />GBE+ is going well btw. Almost 90 days of constant commits to the project have lead to a lot of progress. A lot of GBA games boot up and run just fine, and I haven't even emulated all of the DMA channels, interrupts, or timers. I never expected to get this far this soon. To put things in perspective, this time last year, I was struggling with GB sound emulation, hadn't touched the GBC yet, and didn't even have the foundations worked out for HD/replacement graphics.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Wed Dec 17, 2014 10:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I would love support for SNES as well, Because I may want to enhance the graphics as an option for my SNES hacks (currently focused on SMW). Assuming 256 (255+Transparent), 16 (15+Transparent) and/or 4 (3+Transparent) greyscale colors depending on certain modes.<br /><br />That is, Without killing backwards compatibility.<br /><br />NES is already done by someone else, but could be better, so that's redundant, unless completion is required to a degree!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shonumi</b> [ Wed Dec 17, 2014 10:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That reminds me, I still haven't published my general  theory about Tile Replacement for systems with tile-based graphics (the SNES included). The paper I'm working on outlines the methods I used, how they are implemented, the specific challenges that require more advanced algorithms and techniques to overcome (dealing with color is a big one) and stuff of that nature. Whenever I got around to publishing it, I had hoped it would help others create support in other emulators (Sega Genesis, Wonderswan, whatever floats your boat). As it concerns emulation, I'm pretty much dedicated to working with Nintendo's portables, but my work could easily be applicable to any other tile-based console.  Currently I'm laying out how the theory needs to be improved to account for some challenges specific to the GBA, and from what I can tell it is graphically similar to a lot of what the SNES was capable of, so anyone willing could hack SNES9x or higan if they had the time.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Dec 17, 2014 11:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How do you plan for your technique to handle text in <em>Hamtaro</em> for GBC and GBA, <em>Pok√©mon</em> for GBA, or <em>RHDE</em> for NES in PocketNES on GBA?<br /><br /><br /><span style="font-size: 85%; line-height: normal">hint: non-8x8 fonts</span>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>GGuy</b> [ Wed Dec 17, 2014 3:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here is a proof of concept for pack releases. It's very hacky. IPS patching random pixel noise data over the CHR to ensure all tiles have a unique hash resulting in garbage data if played without loaded sprites. However with the new custom tiles it works as intended. Working with it graphically to make new art is very time consuming though.<br />v0.1 <a href="https://drive.google.com/file/d/0B5aZT1MLfWJsbFF4cDdaTDhEV1U/view?usp=sharing" class="postlink">https://drive.google.com/file/d/0B5aZT1MLfWJsbFF4cDdaTDhEV1U/view?usp=sharing</a><br /><br /><s>edit: I will be periodically updating the demo.</s> <em>Maybe</em>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shonumi</b> [ Wed Dec 17, 2014 5:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />@Teeples - Unfortunately, there is no cute way to handle those cases. If the games split the text between OBJ and BG tiles, that's how the emulator will dump them and that's how users have to edit them. That would potentially result in hundreds of unique tiles. Ideally, any sort of mass editing will be through batch processing.<br /><br />There is a very WIP idea I came up with as an alternative solution. This method involves post-processing the final layers to identify specific patterns. Whenever that pattern is encountered, the emulator replaces that pixel on the relevant layers. The patterns can be letters or any symbol really, so it could work regardless of whether the font character is split between tiles. After replacing the pixel data, the layers could be merged, accounting for things like transperencies and stuff like that.<br /><br />It has several drawbacks in that scaled, rotated, and scrolled text may not match the pattern, rendering this method ineffective. It would also be CPU intensive, so it would better be suited as a pixel shader. But even without this method, GBE is able to handle games like Hamtaro just fine for replacing text. It's just that it might not be entirely user friendly.<br /><br />@GGuy - The cumbersome nature is to be expected. You're essentially working with the CLI and/or a basic text file. I mean, if you want to dump the whole BG, you have to click on it tile-by-tile! The usability is pretty rough without a GUI.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>GGuy</b> [ Thu Dec 18, 2014 12:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh yeah Shonumi the duplicate tile issue I was talking about is the solid color one and duplicate tiles in the CHR that are the exact same but used elsewhere in the game. <s>I&#39;m not sure if the door and leg thing still happens with Metroid II since that was awhile ago and I believe you changed the hashing method since then.</s> I will check it out using the latest source build and update you.<br /><br />Edit: Nope still happens.<br /><img src="http://fc06.deviantart.net/fs70/f/2014/351/2/5/untitled_by_greenguy22-d8a912c.png" alt="Image" /><br /><br />These two are hashed the same it seems.<br /><img src="http://fc07.deviantart.net/fs70/f/2014/351/b/f/untitled_by_greenguy22-d8a91lw.png" alt="Image" /><br /><br />How to reproduce the issue: Dump the sprites and walk a few frames, load the dumped sprites, walk and that's it!<br />Output file is 993993993993993993993993

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Dec 18, 2014 9:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Congratulations on finding a <a href="http://en.wikipedia.org/wiki/Collision_%28computer_science%29" class="postlink">hash collision</a>. There are two ways to <a href="http://en.wikipedia.org/wiki/Hash_table#Collision_resolution" class="postlink">resolve this</a>: chaining and quadratic probing.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shonumi</b> [ Thu Dec 18, 2014 10:08 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Replacement Graphics in Shonumi's Game Boy Enhanced</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The thing is, it doesn't look like a hash collision at all on closer inspection. It's just that the hashing itself is incorrect. That is to say the algorithm generates two separate hashes (in stand-alone tests) but for some reason when applied in real-time it generates the same hash for the sprites GGuy pointed out (which I've reproduced now, thanks GGuy!).<br /><br />The hashes are actually an entire recreation of the pelleted pixel data (in string format) for each 8x8 or 8x16 tile and it uses the two OBJ palletes as a 16-bit salt. Hash collisions are theoretically possible, but most likely only if you tried to match up garbage data with the real graphics. The issue seems to be that the tile in question (Samus' leg) has an OBJ tile number of $5F (data is then at $85F0), and the door has an OBJ tile number of $F5 (data is then at $8F50). For whatever reason, the code is then trying to look at one but not the other.<br /><br />EDIT: On even closer inspection, it appears that GBE finds the hash for one (the door) and thinks it's similar enough to the next (Samus' leg) that it just ignores the latter. To avoid needlessly re-dumping existing tiles, GBE stores a list of which hashes have been dumped, so if it encounters the hash, it skips the dumping process. The door sprite is actually loaded into OAM (but not drawn) when you start the game right after the title screen. GBE sees this first and dumps it, the stores the hash in its list. It encounters Samus' leg sprite, hashes it, but sees that it's similar to an existing one and passes it up. The solution was to change the salt to account for OBJ palettes <strong>AND</strong> sprite tile numbers. So <a href="http://code.google.com/p/gb-enhanced/issues/detail?id=13" class="postlink">you were right all along GGuy</a>  <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />The solution breaks compatibility with existing dumped tiles, since the hashes are now completely different, although a feature for backwards compatibility can be added in GBE+.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
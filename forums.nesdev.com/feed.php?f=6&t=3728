<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=6&amp;t=3728" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2009-02-16T15:59:43-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=6&amp;t=3728</id>
<entry>
<author><name><![CDATA[bucky o'hare]]></name></author>
<updated>2009-02-16T15:59:43-07:00</updated>
<published>2009-02-16T15:59:43-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43406#p43406</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43406#p43406"/>
<title type="html"><![CDATA[Re: Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43406#p43406"><![CDATA[
<div class="quotetitle">Celius wrote:</div><div class="quotecontent"><br />So I made my own table that lists all the appropriate 11-bit to store into the sound registers for the Square Waves to get the desired note.<br /></div><br /><br />I apologize in advance for having nothing relevant to add, but this seems oddly appropriate:<br /><br /><img src="http://img.photobucket.com/albums/v281/abstartselect/pulsewavespirit.gif" alt="Image" /><br /><br /> <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1096">bucky o'hare</a> — Mon Feb 16, 2009 3:59 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-16T13:23:43-07:00</updated>
<published>2009-02-16T13:23:43-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43401#p43401</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43401#p43401"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43401#p43401"><![CDATA[
<div class="quotetitle">MetalSlime wrote:</div><div class="quotecontent"><br /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">I'm glad you found it so useful <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> . Even enough to print it out! That makes me happy to know I made something worth printing on actual paper.<br /></div><br /><br />Yes, well worth printing out!  I keep it in my backpack right next to blargg's APU reference <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div><br /><br />Mine? Next to blargg's APU reference? Wow I feel so important!<br /><br /><div class="quotetitle">MetalSlime wrote:</div><div class="quotecontent"><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Octave 1:<br /><br />TGL        Celius<br /><br />7FE  A     7F1<br />78E  A#    780<br />720  B     713   <br />6BA  C     6AD<br />65A  C#    64D<br />5FE  D     5F3<br />5A8  D#    59D<br />556  E     54D<br />50A  F     500<br />4C2  F#    4B8<br />47E  G     475<br />43C  G#    435<br /><br />Octave 2:<br /><br />TGL        Celius<br /><br />3FF  A     3F8<br />3C7  A#    3BF<br />390  B     389<br />35D  C     356<br />32D  C#    326<br />2FF  D     2F9<br />2D4  D#    2CE<br />2AB  E     2A6<br />285  F     27F<br />261  F#    25C<br />23F  G     23A<br />21E  G#    21A</div><br /></div><br /><br />Hmm, those values look like they could be slightly out of tune... Does the game manipulate those values at all before storing them into the sound regs? It could be for pre-arpeggio purposes. Otherwise, it's possible they are all in tune with each other, but just a little flat as a whole.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Mon Feb 16, 2009 1:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MetalSlime]]></name></author>
<updated>2009-02-16T04:19:18-07:00</updated>
<published>2009-02-16T04:19:18-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43388#p43388</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43388#p43388"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43388#p43388"><![CDATA[
<div class="quotetitle">Celius wrote:</div><div class="quotecontent"><br />I'm glad you found it so useful <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> . Even enough to print it out! That makes me happy to know I made something worth printing on actual paper.<br /></div><br /><br />Yes, well worth printing out!  I keep it in my backpack right next to blargg's APU reference <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />So how off were the values? Did they vary from more than to less than for each entry? Or perhaps they tweaked it by hand to see if rounding up/down made it sound better. It could also be a precision thing where mine has more or less precision than theirs.<br /></div><br /><br />They were pretty close.  I don't even know how to begin to calculate if they vary at a constant rate or not.  I'd bet that your values are the more precise ones, since you followed the formula and tested the sounds with a tuner. <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" />   The game (The Guardian Legend, btw) doesn't sound out of tune to my ears though.  I haven't finished tracing the sound engine, so I don't know yet if the game fudges around with the values before committing them to the sound registers.  I have seen them write the values to the corresponding sound reg copies in RAM though.<br /><br />Here are the values from their chart, laid out next to your chart (just the first two octaves.  I don't want to annoy people with a long post):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Octave 1:<br /><br />TGL        Celius<br /><br />7FE  A     7F1<br />78E  A#    780<br />720  B     713   <br />6BA  C     6AD<br />65A  C#    64D<br />5FE  D     5F3<br />5A8  D#    59D<br />556  E     54D<br />50A  F     500<br />4C2  F#    4B8<br />47E  G     475<br />43C  G#    435<br /><br />Octave 2:<br /><br />TGL        Celius<br /><br />3FF  A     3F8<br />3C7  A#    3BF<br />390  B     389<br />35D  C     356<br />32D  C#    326<br />2FF  D     2F9<br />2D4  D#    2CE<br />2AB  E     2A6<br />285  F     27F<br />261  F#    25C<br />23F  G     23A<br />21E  G#    21A</div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3632">MetalSlime</a> — Mon Feb 16, 2009 4:19 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-16T01:01:24-07:00</updated>
<published>2009-02-16T01:01:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43387#p43387</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43387#p43387"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43387#p43387"><![CDATA[
Hey, sweet!<br /><br />I'm glad you found it so useful <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> . Even enough to print it out! That makes me happy to know I made something worth printing on actual paper.<br /><br />So how off were the values? Did they vary from more than to less than for each entry? Or perhaps they tweaked it by hand to see if rounding up/down made it sound better. It could also be a precision thing where mine has more or less precision than theirs.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Mon Feb 16, 2009 1:01 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MetalSlime]]></name></author>
<updated>2009-02-16T00:10:12-07:00</updated>
<published>2009-02-16T00:10:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43386#p43386</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43386#p43386"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43386#p43386"><![CDATA[
<div class="quotetitle">Celius wrote:</div><div class="quotecontent"><br /><div class="quotetitle">MetalSlime wrote:</div><div class="quotecontent">Nice.  Thanks a lot for making these tables Celius!<br /></div><br /><br />No problem. Like I said, I decided to make them because I wanted to look at them as references, but I thought the NESDev community might make some use out of them. Glad I was right  <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> .<br /></div><br /><br />Turns out to be useful in more ways than one.  I was tracing through a game today (my first one ever actually!), specifically through the sound engine and I actually found their table of note/tone values!  It was like an "Aha!" moment for me.  They had slightly different values from the ones in your chart, but they were close enough that it was obvious what it was.  I wonder how they calculated their values, since they were a bit different from the ones on your chart...<br /><br />Anyway, if I hadn't printed out your chart beforehand, I might have missed it completely and written question marks in my notes.  What a life saver!<br /><br />It's all coming together.  This NES sound stuff is starting to make sense to me.  Thanks again!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3632">MetalSlime</a> — Mon Feb 16, 2009 12:10 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Jarhmander]]></name></author>
<updated>2009-02-13T23:23:02-07:00</updated>
<published>2009-02-13T23:23:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43306#p43306</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43306#p43306"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43306#p43306"><![CDATA[
<div class="quotetitle">Celius wrote:</div><div class="quotecontent"><br />And it looks like I'm going to have to really study how all the sound really works, because I just realized I don't quite get it. As far as I've been concerned since I've learned how to work with the sound regs, you just plop a value in and it makes a sound. And plus, I always just set the registers to play a constant sound so I can manually adjust the volume for envelopes, and manually silence them.<br /></div><br /><br />Ahaha... I can help you with that. Well, the most basic thing you have to know is that musical notes works in a exponetial manner (in regard to frequency), and hopefully for us, rising to an octave higher only require to double the frequency, or, in our case because we mess with timers (period = 1/F) you just have to divide by two (read: LSR) your value to be put in a period register <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=";)" title="Wink" />  <br /><br /><br />To calculate exact things, nothing beat a mathematic formula. Because frequency grows exponentially when notes goes up, the formula has to be of exponential type, more precisely in base two. Because there is already a reference in music (A4 = 440 Hz) that would be not much of a trouble calculating the frequency, if you can 'digitalise' note. So, given a system where:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Note = octave + semi-tones/12 + cents/100</div><br />So A 4 = 4 + 9/12 = 4.75, the formula is as easy as:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Frequency = 440 Hz * 2^&#40;note - 4.75&#41;</div><br />And there's its reciprocal:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Note = log2&#40;frequency/440 Hz&#41; + 4.75</div><br />That things beat every table you'll find on the net. Of course, we don't like wasting time on the NES calculating that thing, so a small look-up table of 11 elements is sufficient, since getting the other octaves simply uses LSR,. And because I think you're lazy, I even made a Excel sheet that does the job for you, plus calculate the value to write to the register and even calculate the error. <a href="http://jarhmander.home.googlepages.com/f2n.xls" class="postlink">http://jarhmander.home.googlepages.com/f2n.xls</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=336">Jarhmander</a> — Fri Feb 13, 2009 11:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-13T16:26:49-07:00</updated>
<published>2009-02-13T16:26:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43295#p43295</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43295#p43295"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43295#p43295"><![CDATA[
<div class="quotetitle">Anders_A wrote:</div><div class="quotecontent"><br />There really is no need to keep 13 bits around that are just going to be shifted away since only the most significant bit that's shifted out matters for correct rounding. It's only in some rare cases where that bit is already rounded it might be off by one, and that is only in the second octave (the one that's only shifted once).<br /></div><br /><br />Oh, sorry, duh. I knew that the MSb of the decimal place would determine rounding, but I wasn't thinking when it came to defining the extra byte. So yeah, just add the carry after shifting (the MSb will be in the carry, and if you need to round down it will be 0, adding nothing, and it will be 1 for rounding up, adding one, which will all work out in your favor).<br /><br />But where did the number 13 come from?<br /><br /><div class="quotetitle">Anders_A wrote:</div><div class="quotecontent"><br />I generated alot of semi notes aswell for vibrato (thanks bregalad for that great idea!), but I did use your table for comparison after generation just in case I got something wrong.<br /><br />EDIT:<br />Bregalad: Did you try having 15 seminotes between each note instead of 31? And if so, was that too coarse for nice sounding vibratos? (it would be nice to have it all under 256 bytes for easier indexing)<br /></div><br /><br />That's actually what I have too. I can bend a pitch by x/32 of a note. I just have a look up table where each entry is the difference between two tones divided by 32. If I want to bend a pitch up by 7/32, I find the difference between that note and the next /32, multiply it by 7, and add it to the original pitch.<br /><br />I was able to fit mine in &lt;128 bytes, with some shifting.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Fri Feb 13, 2009 4:26 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Anders_A]]></name></author>
<updated>2009-02-13T15:45:56-07:00</updated>
<published>2009-02-13T15:45:56-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43294#p43294</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43294#p43294"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43294#p43294"><![CDATA[
There really is no need to keep 13 bits around that are just going to be shifted away since only the most significant bit that's shifted out matters for correct rounding. It's only in some rare cases where that bit is already rounded it might be off by one, and that is only in the second octave (the one that's only shifted once).<br /><br />I generated alot of semi notes aswell for vibrato (thanks bregalad for that great idea!), but I did use your table for comparison after generation just in case I got something wrong.<br /><br />EDIT:<br />Bregalad: Did you try having 15 seminotes between each note instead of 31? And if so, was that too coarse for nice sounding vibratos? (it would be nice to have it all under 256 bytes for easier indexing)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1601">Anders_A</a> — Fri Feb 13, 2009 3:45 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-13T10:30:01-07:00</updated>
<published>2009-02-13T10:30:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43288#p43288</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43288#p43288"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43288#p43288"><![CDATA[
Yeah I'd say with one octave you can't get much more precise than that. But you might want to store the values as 24 bit, so you can have 8 bits of extra precision.<br /><br />And feel free to use my table as a reference for making the lower octave. I have the exact values written in decimal, already calculated.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Fri Feb 13, 2009 10:30 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Anders_A]]></name></author>
<updated>2009-02-13T04:57:32-07:00</updated>
<published>2009-02-13T04:57:32-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43284#p43284</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43284#p43284"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43284#p43284"><![CDATA[
So to get the most possible precision using the "one octave table and shift" method I would have to do the following.<br /><br />Generate a LUT for the lowest octave (octave 0) using 1662607/(f*16) where f is the frequecy of the notes.<br /><br />And then the following in the playback code.<br /><br />get period from LUT<br />divide period by 2^octave (correctly rounded)<br />subtract 1<br /><br />Will this give maximum possible precision?<br /><br />EDIT:<br />I live in PAL land.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1601">Anders_A</a> — Fri Feb 13, 2009 4:57 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-13T00:56:01-07:00</updated>
<published>2009-02-13T00:56:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43283#p43283</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43283#p43283"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43283#p43283"><![CDATA[
So you can just add .5 and clip off the numbers beyond the decimal point as a method of rounding. That's pretty clever; I don't think I would have thought of that  <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> .<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Fri Feb 13, 2009 12:56 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2009-02-12T14:20:38-07:00</updated>
<published>2009-02-12T14:20:38-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43275#p43275</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43275#p43275"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43275#p43275"><![CDATA[
<div class="quotetitle">Celius wrote:</div><div class="quotecontent"><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">But rounding to the nearest integer itself has two steps:<br />1. Add 0.5.<br />2. Round down.<br /></div><br />What? I don't understand that.</div><br />Round 5.7 to the nearest integer:<br />1. Add 0.5. Result: 6.2.<br />2. Round down. Result: 6.<br /><br />Round 8.3 to the nearest integer:<br />1. Add 0.5. Result: 8.8.<br />2. Round down. Result: 8.<br /><br />Further information: <a href="http://en.wikipedia.org/wiki/Rounding" class="postlink">Rounding on Wikipedia</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Thu Feb 12, 2009 2:20 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-12T13:32:22-07:00</updated>
<published>2009-02-12T13:32:22-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43273#p43273</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43273#p43273"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43273#p43273"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />But rounding to the nearest integer itself has two steps:<br />1. Add 0.5.<br />2. Round down.<br /></div><br /><br />What? I don't understand that.<br /><br />And it looks like I'm going to have to really study how all the sound really works, because I just realized I don't quite get it. As far as I've been concerned since I've learned how to work with the sound regs, you just plop a value in and it makes a sound. And plus, I always just set the registers to play a constant sound so I can manually adjust the volume for envelopes, and manually silence them.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Thu Feb 12, 2009 1:32 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2009-02-12T13:05:29-07:00</updated>
<published>2009-02-12T13:05:29-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43270#p43270</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43270#p43270"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43270#p43270"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />For example, Celius' formula uses a rounded NTSC CPU frequency (1790000) instead of the actual one (1789772.666...). Can't that result in wrong values?<br /></div><br />Not noticeably. Celius' rounded frequency is only 0.01% off. The octave is divided into 1,200 "cents" (hundredths of a semitone). People can't notice differences smaller than five cents, and the ratio between two frequencies that are five cents apart is 2^(5/1200), or a difference of 0.29%.<br /><br />The 16 in "Freq * 16" is there because the square period registers effectively get clocked every 2 CPU cycles, and there are eight steps in each waveform.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Also, why subtract 1 from the result of the division?<br /></div><br />Think of it like this: When you write N to the period register, the period divider counts down from N to 0 and then resets the counter to N one cycle <em>after</em> the cycle where it is zero, making a total of N+1 steps. So given the number of steps, we need to subtract 1 to get the period value.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Why does tepples subtract 0.5?<br /></div><br />The proper procedure:<br />1. Subtract 1.0.<br />2. Round to the nearest integer.<br /><br />But rounding to the nearest integer itself has two steps:<br />1. Add 0.5.<br />2. Round down.<br /><br />Plug it into the procedure:<br />1. Subtract 1.0.<br />2. Add 0.5.<br />3. Round down.<br /><br />Apply <a href="http://en.wikipedia.org/wiki/Constant_folding" class="postlink">constant folding</a>:<br />1. Subtract 0.5.<br />2. Round down.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Thu Feb 12, 2009 1:05 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2009-02-11T22:47:08-07:00</updated>
<published>2009-02-11T22:47:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43263#p43263</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43263#p43263"/>
<title type="html"><![CDATA[Square Wave Notes]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3728&amp;p=43263#p43263"><![CDATA[
I learned that formula from the NES 101 document, I think. I suppose that it doesn't give you the exact value now that I think about it. They give you very accurate results. I held a tuner once up to a speaker when I played a note made by my table and it read back as exactly in tune.<br /><br />I honestly am not quite sure why the formula is the way it is. I just know that (CPUSpeed/(Freq * 16)) - 1 gives you the correct value for a given frequency. I think if you just use 1789772 as the CPU speed, it will give you the exact result.<br /><br />I think you can find a tuner that displays frequency for not too much money. If you can, use the formula and play the value you get, holding the tuner up to the speaker. If the value on the tuner reads back as what you intended, then you'll know it works.<br /><br />I didn't do much testing, as I play the piano and know a note when I hear it. So once I determined it was right, I thought it was good enough.<br /><br />EDIT: I just tested the formula. Using 1790000 as the CPU speed with 55 Hz gives a result of 2033.090909. Using 1789772 gives 2032.8318181, which both round to 2033 (aka $7F1). The higher the frequency, the lower the difference. Let's use 8000 Hz for example. Using 1790000, I get 12.984375. Using 1789772, I get 12.98259375. Honestly, the difference by that point is so small that it doesn't matter. <br /><br />The only thing you'd have to worry about is when the formula generates say 1000.513 using either the rounded or precise speed, and 1000.492 for the other. One would round up and the other would round down. It hasn't made an audible difference for me though.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Wed Feb 11, 2009 10:47 pm</p><hr />
]]></content>
</entry>
</feed>
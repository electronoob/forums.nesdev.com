<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Fixing ROMs for EMS 64 GB Smart Card USB</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Fixing ROMs for EMS 64 GB Smart Card USB</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=20&amp;t=5804">http://forums.nesdev.com/viewtopic.php?f=20&amp;t=5804</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>12</strong> of <strong>19</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zeichi</b> [ Tue Apr 09, 2013 10:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent"><div class="quotetitle">Zeichi wrote:</div><div class="quotecontent">Hi everyone, i see that there are some Fix patch for the GB and GBC roms, I download and use all of them, but i have some problem with 3 games actually, one of them is Revelation - The Demon Slayer for GBC this give me a Black Screen, and the other two are FF Lengends I and II, don't save, well FFL2 if i select continue on the Title Screen the Game start from the Story Line to the Select Hero Screen, but if i press &quot;B&quot; to come back to the title screen and select Continue again, the save file is there, anyone have try Revelation Game or have a fix for it? Thk and sorry for my english.</div><br /><br />Did you try this version yet? &quot;Revelations - The Demon Slayer (U) [C][BF]&quot;? It might work. If it does not, let me know. I'm not sure about FF Legends.</div><br /><br />I try &quot;Revelations - The Demon Slayer (U) [C][BF]&quot; but i got the Black Screen too  <img src="./images/smilies/icon_cry.gif" alt=":cry:" title="Crying or Very sad" /> thks

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Apr 10, 2013 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think I found the problem. Try applying this patch. It should work.<br /><br />If it doesn't work on the regular version, try using the patch on the BF version. But try the regular version first.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=547">Revelations - The Demon Slayer (U) [C] (Fix).zip</a> [208 Bytes]
			</span><br />
			<span class="gensmall">Downloaded 162 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zeichi</b> [ Wed Apr 10, 2013 2:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I use the IPS PATCH on both roms, but don't work, maybe the rom have some type of proteccion or somthing like that  <img src="./images/smilies/icon_cry.gif" alt=":cry:" title="Crying or Very sad" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Apr 10, 2013 9:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Actually that's what the IPS patch was supposed to remove. If i get a chance I will try it on my SmartCard tomorrow.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Sat May 11, 2013 11:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi MottZilla, did you get a chance to look at the saving issue with Pokemon Red/Blue?<br /><br />For what it's worth, I can open the save in a save editor on the PC and have it load again on the GB, but the names and moves are garbled. Seems something is overwriting that section of data in the save and corrupting it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Sun May 12, 2013 5:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I have not had the time yet. If there is corruption and it only happens using my menu and not the stock menu that would narrow the cause down. But another possibility is not all SmartCard's are the same. If possible, give exact details and try both stock menu and my menu. Tell me which fix patch you are using.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Sun May 12, 2013 9:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The corruption does not happen with the stock menu.<br /><br />I am using the patch by Great Hierophant on your site.<br /><br />It is reproducible by saving the game and restarting the GBC. When starting the game again, it will act as if nothing had ever been saved to the cart.<br /><br />The save can be transferred from the cart and opened in pikasav and most of the data appears to be correct aside from things like Pokemon names, moves, PP values.<br /><br />If it would help I could try to save a game with the stock menu, and save it again with your menu, so that you can compare them on a lower level and see which areas of memory were affected.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Mon May 13, 2013 10:52 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That would be fantastic if you could figure out exactly where the corruption happens. But since you narrowed it down to the menu, I'll maybe peek around my code again and see if there might be a bug.<br /><br />One possibility is that during either saving or loading, 32K saves somehow don't entirely load. This could be tested by playing Pokemon and making a new game. Turn it off and back on and it'll backup the save. Then turn it off again and copy the save file to your computer. Banks 0-3 should contain the un-altered Pokemon save. Later banks, 4 and on, will have Pokemon backed up in there somewhere. If you have no saves other than Pokemon, then you should see the first 32kb and second 32kb as identical. If they are not then it's an issue in saving. If they are identical, then perhaps it is an issue in loading.<br /><br />For example you play Pokemon, save your game and then restart the console and play some other game. Then you come back to Pokemon and maybe the last 8kb bank is corrupted. It's just a guess. If I get some time, I'll look into it! But 8KB save games should all work fine from what feedback I've gotten.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Mon May 13, 2013 2:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm almost positive the corruption happens during saving, as the save is visibly corrupted when analyzed with pikasav. If I re-save the file with pikasav, and re-upload it to your menu, the save will then load, but the corruption will be in the places I've mentioned (and which I observed in pikasav).<br /><br />So evidently the loading procedure appears to work fine, but something is being corrupted during the save.<br /><br />I will do what you said and see if I can narrow it down to which banks appear to be getting corrupted.<br /><br />EDIT: Well I made a fresh save (with just pokemon red on the cart) and uploaded it to my computer. I opened the 128KB save file up in a hex editor and compared the first 32KB and second 32KB. They are identical. So it appears the unaltered save in banks 0-3 and the backup (in banks 4-7?) are the same. Not sure where to go from here, but let me know if there is anything else I can do to help.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Mon May 13, 2013 9:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />To be absolutely sure. You started a new game after clearing all SRAM files out. Then you play Pokemon and created a save. After this, you turned off the system and turned it back on allowing the save file to be backed up. Then you turned it off and uploaded the save file to the PC. Correct? And the first 32kb and second 32kb both contain a correct Pokemon save file? <br /><br />I checked just briefly and I'm not sure why either saving or loading would be incorrect but not the other. They largely use the same code. One of these days I'll have the time to poke at it myself. Have you tried any other games which use 32 kilobyte save files and had similar problems?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Mon May 13, 2013 9:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes everything you said is correct except that the first and second 32KB blocks contain <em>correct</em> save files. The 32KB sections are <em>identical</em>, but both are corrupted.<br /><br />I will check to see if the same issue arises in other games with 32KB save files within the next few days (I'm out of town right now). Let me know if there are any specific titles you would like to see tested.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue May 14, 2013 8:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh if the saves are corrupt, here is another way to test what is going on then. Play Pokemon and create a save game. Save your game and turn off the system. Immediately dump the SRAM to your PC (don't even run the menu to backup the save) and see if it is corrupted. Then after you've done that, run the menu and dump the SRAM again and compare. It will be telling if the SRAM is corrupted before running the menu to backup data or after.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Tue May 14, 2013 3:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah okay, I will do that as soon as I get a chance (probably Friday night).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Reign</b> [ Wed May 22, 2013 3:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Alright did some testing. I cleared the SRAM, loaded Pokemon Red, saved a game, and immediately turned it off and uploaded the SRAM to my PC. Then I turned the GBC on, let the menu back the save up, and uploaded the SRAM again to my PC.<br /><br />I compared the first 32KB of each SRAM in a hex editor, and the file compare function confirmed the blocks were identical.<br /><br />Furthermore, I compared the first 32KB and the second 32KB block of the second SRAM file, and they were NOT identical this time.<br /><br />The first 32KB blocks of each SRAM appear to be functional saves; the second 32KB block from the second SRAM file was corrupted starting at the 12288 byte, and gave &quot;The file data is destroyed!&quot; message in an emulator.<br /><br />I must have done something incorrectly in my earlier post (perhaps I mixed up a file at some point). It does appear now that the menu backup is being corrupted. I will do the process again to ensure the menu backup of the save is, in fact, being corrupted.<br /><br />EDIT: Yep I was able to reproduce the exact situation on Pokemon Blue this time. Cleared the SRAM, saved a game, and uploaded immediately to PC. Then booted the menu to let it backup, and saved the second SRAM to PC. The first 32KB blocks of each SRAM are, again, valid save files, but the second 32KB block (the menu backup) is corrupted starting at the exact same offset as the Pokemon Red save (byte 12288). I should mention that I'm referring to the 12288 byte of the second block, so it is actually the 45056 byte of the 128KB SRAM, and halfway through the 6th bank. Hope this helps.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Thu May 23, 2013 11:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Fixing ROMs for EMS 64 GB Smart Card USB</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If your numbers are corrupt and I'm reading them correctly, basically only the first 8KB of the save is being backed up correctly and after that it's garbage. I'll know where to focus now.<br /><br />I'll still have to try this out myself and see exactly what is going on. It's somewhat complicated because my main PC can't run the flasher program, I have to use a different PC than the one I work on.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>12</strong> of <strong>19</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
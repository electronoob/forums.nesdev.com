<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - DMC channel</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">DMC channel</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=3706">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=3706</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>5</strong> of <strong>7</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Dec 04, 2007 6:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The common mappers have a 512 KiB limit on the size of a program. At this rate, I can't fit more than two minutes of telephone quality sound.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Tue Dec 04, 2007 6:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">but I can't fit more than 2 minutes into a 512 KiB (max mmc1/mmc3 size) file</div>
<br />Store the samples in CHR-ROM! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Then you could go up to 768KB...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Dec 04, 2007 6:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">but I can't fit more than 2 minutes into a 512 KiB (max mmc1/mmc3 size) file</div><br />Store the samples in CHR-ROM! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Then you could go up to 768KB...</div>
<br />That'd be a bitch to do, even with a static display. Big Bird stored its shortest samples in unused parts of CHR, but I don't feel like tracing the code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Sun Feb 15, 2009 12:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've been wanting to experiment with using $4011 for sound samples for a while. I understand basically all you have to do is at (carefully) timed intervals, load and store a value into $4011. That's easy enough.
<br />
<br />However, I'm a total newb when it comes to the way sound works in general. So the actual data that is stored in there, I have no idea how it works. I don't know what the values actually represent, and I just thought I'd ask: what do they mean?
<br />
<br />Secondly, what should I do to go about making a store-it-into-$4011-friendly sound sample from an audio file?
<br />
<br />Thanks so much in advance.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Sun Feb 15, 2009 12:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">However, I'm a total newb when it comes to the way sound works in general. So the actual data that is stored in there, I have no idea how it works. I don't know what the values actually represent, and I just thought I'd ask: what do they mean?<br /></div><br />Sound works in waves, length of the wave is the frequency.  The timing that the sample changes with (your $4011 update rate) is the frequency (aka digital sample-rate).  The values that you write to $4011 is the amplitude for each sample.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Secondly, what should I do to go about making a store-it-into-$4011-friendly sound sample from an audio file?<br /></div>
<br />
<br />Save it in an 8-bit unsigned format.  Since $4011 is 7-bit, you could either reduce the volume by half on the whole sample beforehand, or do an LSR on-the-fly as you play each sample.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Feb 15, 2009 1:16 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">what do they mean?</div>
<br />The values are raw PCM data. Each value is a "photo" taken of a sound wave at a particular instant in time. With a series of values you can draw any sound wave you want, with 7 bits of precision.
<br />
<br />WAV files are just like that, a series of "photos" of a sound wave taken at a certain frequency. You can easily convert information from WAV files into the raw values the NES expects, you just have to research the exact format of the numbers. You have to know if they are signed or not, that kind of thing. <a href="http://www.wotsit.org/list.asp?page=4&amp;fc=12&amp;search=&amp;al=" class="postlink">This</a> is a place with a few documents about the WAV format.
<br />
<br />You'll have to see the frequency at which you'll be able to write the values on the NES, and you'll probably have to use a sound editor to convert the source WAV file to that frequency. Or you could just try to achieve the same frequency used by the original WAV file.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Sun Feb 15, 2009 3:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for the replies, guys.
<br />
<br />So you have to convert a WAV file to a raw format (assuming you have a WAV file)?
<br />
<br />Also, I understand that pitch is determined by frequency, and that if you play the sample faster, the pitch will be higher. But I still don't know how pitch is determined <em>within</em> the sample. All the values are "amplitudes", you say. Does that just mean they're like Y values for a "pixelated" (quantized?) sound wave? And also, are the values signed or unsigned?
<br />
<br />Sorry for all the questions. Thanks again, guys for helping me.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sun Feb 15, 2009 4:02 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The pitch is determined within a simple at which rate a waveform repeats. If you understand what a square wave is, how close to each other the edge are determines the frequency (or pitch). How height the wave is determine the amplitude (or volume).
<br />
<br />WAV files can be made with more complex forms than square waves. With fourrier transform, everything can be decomposed into a sum of sine waves. The lowest freqency sine wave is the fundamental and determines the pitch of the sound. The higher frequency of sine waves are the harmonics and determine how the sound sounds. Note that some waves, such as white noise cannot be decomposed into sine waves because they are random, so this doesn't appy. That's why you don't hear any pitch when you hear white noise (or any other kind of "noise").

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Feb 15, 2009 5:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">However, I'm a total newb when it comes to the way sound works in general.</div>
<br /><a href="http://www.bores.com/courses/intro/" class="postlink">Bores.com has a DSP tutorial</a> that should help you understand.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Feb 15, 2009 8:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">Does that just mean they're like Y values for a "pixelated" (quantized?) sound wave?</div>
<br />That's pretty much it. The frequency in which these Y coordinates are updated is... well, the frequency.
<br />
<br />I second your question: The 7 bits the NES expects should represent a signed value?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Feb 15, 2009 10:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Values written to $4011 are not signed. $40 is center,[1] $00 is bottom, and $7F is top.
<br />
<br /><span style="font-size: 84%; line-height: normal">[1] Almost. The DAC is in fact slightly nonlinear, though not nearly as much as on the Game Gear. </span>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Sun Feb 15, 2009 1:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So take these graphs of waves:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">|<br />|<br />| xx xx xx xx x<br />|xxxxxxxxxxxxxx<br />|xxxxxxxxxxxxxx<br />|--------------<br /><br />|&nbsp; x&nbsp; &nbsp; x&nbsp; &nbsp; x<br />| xxx&nbsp; xxx&nbsp; xxx<br />|xxxxxxxxxxxxxx<br />|xxxxxxxxxxxxxx<br />|xxxxxxxxxxxxxx<br />|--------------<br /><br /></div>
<br />
<br />All "x"s are 1 sample fetch wide, and the higher the number of x's stacked, the higher the number stored into $4011 is. Basically it's a bad graph. But the top one would make a higher, quieter sound, and the lower one would make a lower, louder sound, right?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Feb 15, 2009 2:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Correct. The top one has a period (time between repeats) of 3 samples and an amplitude (half the distance between top and bottom) of 0.5. The bottom one has a period of 5 samples and an amplitude of 1.0.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Sun Feb 15, 2009 5:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, I've got some samples working now by doing the lsr trick memblers mentioned. It was an 8-bit mono WAV file at 6 KHz. I'm not quite sure why it didn't work when I tried it last, but now it did.
<br />
<br />I was hoping to make some use of this channel running at 60 Hz (hahaha). Yeah, probably not going to happen for anything but like a helicopter sound effect. It might be possible to play sounds clocked at really low speeds though (6000 Hz max if you plan on performing anything while playing samples, even if using an IRQ). For example, I wanted to have my character die in the game, and possibly let out a scream of some sort. Their body flies back, and the screen would scroll over a little while it plays the game over music. For that, I'd have to do a little game logic, and would probably want to play the sound with a scanline counter. And I would want to do that as little as possible, so the quality would have to be lowish...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Feb 15, 2009 8:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">I was hoping to make some use of this channel running at 60 Hz (hahaha). Yeah, probably not going to happen for anything but like a helicopter sound effect.</div><br />I just tried an S3M simulation of writing $7F, $3F, $1F, $00, at 60 Hz, and it made a sound that could be used as a passable kick drum.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">For example, I wanted to have my character die in the game, and possibly let out a scream of some sort. Their body flies back</div>
<br />You could try hardware DPCM playback instead. Otherwise, OAM DMA will cause a 512-cycle hiccup in your sample playback.
<br />
<br />One thing you can do to save space is convert your samples into 4-bit and pack two samples to the byte. Plenty of commercial NES games did this with linear PCM (e.g. $8A $43 $67 $D6 in wav -&gt; $84 $6D in rom -&gt; $40 $20 $30 $68 in $4011) for a modest improvement over hardware DPCM quality especially in the treble. In <a href="http://nesdev.com/bbs/viewtopic.php?t=3712" class="postlink">another topic</a>, I explained a software ADPCM technique that brought still more improvement.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>5</strong> of <strong>7</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=69" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2010-02-27T18:57:50-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=69</id>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2004-12-20T17:23:17-07:00</updated>
<published>2004-12-20T17:23:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=659#p659</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=659#p659"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=659#p659"><![CDATA[
<div class="quotetitle">TimW wrote:</div><div class="quotecontent"><br />sllightly better then linear interpolation with out the over head of fir would be a weighed guassian with it's center at the center of the sample period<br /></div><br />That <em>is</em> FIR. FIR and convolution are the same thing. Or are you describing some sort of IIR filter with a roughly Gaussian impulse response?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Mon Dec 20, 2004 5:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[TimW]]></name></author>
<updated>2004-12-20T05:11:21-07:00</updated>
<published>2004-12-20T05:11:21-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=651#p651</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=651#p651"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=651#p651"><![CDATA[
sllightly better then linear interpolation with out the over head of fir would be a weighed guassian with it's center at the center of the sample period I can't remember the coefficents, but there are some with power of two coefficents which of course eliminates the divide, if anyone cares, I'll post em. example<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=71">TimW</a> — Mon Dec 20, 2004 5:11 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[laughy]]></name></author>
<updated>2004-11-30T19:18:42-07:00</updated>
<published>2004-11-30T19:18:42-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=390#p390</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=390#p390"/>
<title type="html"><![CDATA[Re: :)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=390#p390"><![CDATA[
<div class="quotetitle">Fx3 wrote:</div><div class="quotecontent"><br /><div class="quotetitle">laughy wrote:</div><div class="quotecontent">Would you mind posting those emails somewhere Disch for those who may run into the same problems you did?<br /></div><br /><br />Yay better, assemble a document. I'm sure it'll be much welcome.</div><br /><br />Hey you did a good job on RockNes - however my facepic is still better.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=50">laughy</a> — Tue Nov 30, 2004 7:18 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2004-11-30T15:01:53-07:00</updated>
<published>2004-11-30T15:01:53-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=383#p383</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=383#p383"/>
<title type="html"><![CDATA[Re: :)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=383#p383"><![CDATA[
<div class="quotetitle">laughy wrote:</div><div class="quotecontent"><br />Would you mind posting those emails somewhere Disch for those who may run into the same problems you did?<br /></div><br /><br />Yay better, assemble a document. I'm sure it'll be much welcome.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Nov 30, 2004 3:01 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[laughy]]></name></author>
<updated>2004-11-30T12:10:23-07:00</updated>
<published>2004-11-30T12:10:23-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=381#p381</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=381#p381"/>
<title type="html"><![CDATA[:)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=381#p381"><![CDATA[
Would you mind posting those emails somewhere Disch for those who may run into the same problems you did?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=50">laughy</a> — Tue Nov 30, 2004 12:10 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2004-11-29T21:05:02-07:00</updated>
<published>2004-11-29T21:05:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=376#p376</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=376#p376"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=376#p376"><![CDATA[
<div class="quotetitle">baisoku wrote:</div><div class="quotecontent"><br />but that's why on all of them, you can hear the aliasing effects in the kid icarus intro and the solstice music.  :)<br /></div><br /><br />The reasoning the aliasing appears for Kid Icarus in NotSo is because I emulate the non-linear interdependency square output as layed out in blargg's doc (and he tells me that he noticed the same aliasing appearing from the real thing.. though I haven't personally tested this).  When I have both channels outputting independent, linear output... I can't notice any audible aliasing.<br /><br />Perhaps I could record a quick wav or something for a demo and see if you guys notice any?<br /><br />But yes...  I've gotten Blargg's methods working and the results were definatly worth it.  Less CPU intensive since you don't have to run each channel seperately for each sample (you can run them all at once for a big chunk the size of your output buffer).  A crisper sound, and allows for more nifty sound tricks and easier filter application.<br /><br />It's definatly worth it.  It's just somewhat weird to understand.  I didn't understand it fully myself until I exchanged several e-mails with Blargg.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Mon Nov 29, 2004 9:05 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[baisoku]]></name></author>
<updated>2004-11-29T17:38:48-07:00</updated>
<published>2004-11-29T17:38:48-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=375#p375</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=375#p375"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=375#p375"><![CDATA[
<div class="quotetitle">Quietust wrote:</div><div class="quotecontent"><br />My emulator also does the same 'naive' downsampling, mainly because a proper FIR filter would be trying to consume CPU time that simply isn't available.<br /></div><br /><br />as does mine.  and i assume that's what most are doing.  but that's why on all of them, you can hear the aliasing effects in the kid icarus intro and the solstice music.  <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=35">baisoku</a> — Mon Nov 29, 2004 5:38 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2004-11-29T16:50:48-07:00</updated>
<published>2004-11-29T16:50:48-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=374#p374</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=374#p374"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=374#p374"><![CDATA[
WOOHOO!!!  <img src="http://forums.nesdev.com/images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> <br />What a nice day... hehehe <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=";)" title="Wink" /> <br />It worked nicely. Thanks for the help!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Mon Nov 29, 2004 4:50 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Quietust]]></name></author>
<updated>2004-11-29T15:53:25-07:00</updated>
<published>2004-11-29T15:53:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=373#p373</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=373#p373"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=373#p373"><![CDATA[
My emulator also does the same 'naive' downsampling, mainly because a proper FIR filter would be trying to consume CPU time that simply isn't available.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=7">Quietust</a> — Mon Nov 29, 2004 3:53 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[laughy]]></name></author>
<updated>2004-11-29T15:43:24-07:00</updated>
<published>2004-11-29T15:43:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=372#p372</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=372#p372"/>
<title type="html"><![CDATA[:(]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=372#p372"><![CDATA[
My head hurts <img src="http://forums.nesdev.com/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br /><br />I did it the "naive" way<br /><br />Hey Disch, if you ever actually implement Blargg's buffering thing make sure you tell us if it was worth it <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=50">laughy</a> — Mon Nov 29, 2004 3:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[baisoku]]></name></author>
<updated>2004-11-29T13:28:19-07:00</updated>
<published>2004-11-29T13:28:19-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=370#p370</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=370#p370"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=370#p370"><![CDATA[
<div class="quotetitle">Disch wrote:</div><div class="quotecontent"><br />The easiest way I've found to downsample is simple:<br /><br />Accumulate the output of each channel every cycle and when you output a sample, divide that value by the number of cycles passed.  It's not dreadfully slow, and produces a mighty-fine quality sound (although there are better methods)<br />[snip]<br /></div><br /><br />while the naive linear interpolation method you describe does produce generally acceptable results (it's what i used in my shitty nsf plugin way back in the day), it's important to note that it is exactly why shay presented his bandlimited technique - lerp creates aliasing, especially in the upper range of the nes frequencies.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=35">baisoku</a> — Mon Nov 29, 2004 1:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2004-11-29T11:52:21-07:00</updated>
<published>2004-11-29T11:52:21-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=369#p369</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=369#p369"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=369#p369"><![CDATA[
The easiest way I've found to downsample is simple:<br /><br />Accumulate the output of each channel every cycle and when you output a sample, divide that value by the number of cycles passed.  It's not dreadfully slow, and produces a mighty-fine quality sound (although there are better methods)<br /><br />For an example... every cycle the channel is clocked (this can be optimized by mutliplying Channel_Output by a value... I'll show sample code later):<br /><br />OutputBuffer += Channel_Output;<br /><br /><br />When you output a sample:<br /><br />SampleOut = OutputBuffer / CyclesPastSinceLastSample;<br />fTicksUntilNextSample += fTicksPerSample;<br /><br />fTicksPerSample should be floating point and set to   CPU_CLOCK_RATE / SAMPLE_RATE.  On an NTSC system outputting at 44KHz, this will be roughly 40.58  (don't round too much).  This means CyclesPastSinceLastSample will alternate between 40 and 41 as samples are generated.<br /><br />This is the method I use in NotSo Fatso and I'd say it works quite well.<br /><br />In case it's still unclear... here's some demo code to further clarify:<br /><br />void DoSquareTicks(int ticks)<br />{<br /> int mn;<br /><br /> while(ticks)<br /> {<br />  mn = min(nFreqCount, ticks);<br /><br />  ticks -= mn;<br />  nFreqCount -= mn;<br /><br />  if(nDutyCount &lt; nDutyCycle)<br />   nSquareOutputBuffer += nVolume * mn;  /*output volume if duty cycle is in positive section*/<br /><br />  if(nFreqCount &lt;= 0)<br />  {<br />   nFreqCount = nFreqTimer.W + 1;<br />   nDutyCount = (nDutyCount + 1) &amp; 0x0F;<br />  }<br /> }<br />}<br /><br /><br />void RunAPU(int tick)<br />{<br /> int mn;<br /><br /> while(tick)<br /> {<br />  mn = min( tick, ceil(fTicksUntilNextSample) );<br /><br />  fTicksUntilNextSample -= mn;<br />  tick -= mn;<br /><br />  DoSquareTicks(mn);<br /><br />  nCyclesPassed += mn;<br /><br />  if(fTicksUntilNextSample &lt;= 0)<br />  {<br />   fTicksUntilNextSample += fTicksPerSample;<br />   OutputSample( nSquareOutputBuffer / nCyclesPassed );<br />   nCyclesPassed = 0;<br />  }<br /> }<br />}<br /><br /><br /><br />That code wont' work... but it'll give the general idea.<br /><br />The method Blargg discusses in his doc (the one where you put transitions in a buffer, then run through the buffer later to generate samples) is likely faster and higher quality.  It's kind of hard to understand though.  I have yet to actually finish a player which impliments it.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Mon Nov 29, 2004 11:52 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2010-02-27T18:57:50-07:00</updated>
<published>2004-11-29T06:39:47-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=366#p366</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=366#p366"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=366#p366"><![CDATA[
Thank you for the information... Quite interesting. <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Mon Nov 29, 2004 6:39 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Anonymous]]></name></author>
<updated>2004-11-29T03:59:17-07:00</updated>
<published>2004-11-29T03:59:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=364#p364</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=364#p364"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=364#p364"><![CDATA[
Oh, I forgot one thing.  I'd use gmeteor to create the filter coefficients.  Be warned that it can run very slowly.<br /><br /><!-- m --><a class="postlink" href="http://gmeteor.sourceforge.net/">http://gmeteor.sourceforge.net/</a><!-- m --><p>Statistics: Posted by Guest — Mon Nov 29, 2004 3:59 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Anonymous]]></name></author>
<updated>2004-11-29T03:57:08-07:00</updated>
<published>2004-11-29T03:57:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=69&amp;p=363#p363</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=363#p363"/>
<title type="html"><![CDATA[Bandlimited waveforms algorithm?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=69&amp;p=363#p363"><![CDATA[
A slow, but generally accurate, way would be to generate one sample per NES CPU cycle(effective rate would be about 1.78977272Mhz with NTSC), and resample it to 44.1KHz or whatever the output rate is.<br /><br />If I were to reimplement the resampling code in FCE Ultra from scratch, I'd look into using an MMX or SSE based FIR filtering routine to resample the stream by an integral divisor(32 would be good) of the original rate, and then use libsamplerate <!-- m --><a class="postlink" href="http://www.mega-nerd.com/SRC/api.html">http://www.mega-nerd.com/SRC/api.html</a><!-- m --> to resample it to the output rate.<br /><br />So, you would have:<br /><br />1.789772 MHz MMX/SSE FIR filter-&gt; 55,930.4 Hz libsamplerate-&gt; 44,100Hz<p>Statistics: Posted by Guest — Mon Nov 29, 2004 3:57 am</p><hr />
]]></content>
</entry>
</feed>
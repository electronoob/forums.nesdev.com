<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Why do we block Google?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Why do we block Google?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=13&amp;t=4000">http://forums.nesdev.com/viewtopic.php?f=13&amp;t=4000</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Mar 23, 2008 1:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Why do we block Google?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The robots.txt file of this domain is currently configured to exclude almost all pages of this domain, including the entire forum. Why is this? The policy as of now appears to hurt 1. the visibility of nesdev and 2. the ability of members to search the board more efficiently.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sun Mar 23, 2008 1:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Maybe bandwidth? I notice a lot of boards have a "low-bandwidth" version that search engines index. Aside from that, every page here has about 7K of inline style-sheet, which is surely a waste of bandwidth. The style sheet even has a comment about this:
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">NOTE: These CSS definitions are stored within the main page body so that you can use the phpBB2 theme administration centre. When you have finalised your style you could cut the final CSS code and place it in an external file, deleting this section to save bandwidth.</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Mar 23, 2008 7:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This board is less active than Pocket Heaven or even tetrisconcept.com, yet those boards get indexed. If you're worried about server load, use Crawl-delay: .

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Mon Mar 24, 2008 12:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you care about server load, use a better caching system and/or accelarated php.
<br />
<br />Or maybe use Punbb.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Mar 25, 2008 10:03 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, the main Nesdev page, who links to this forum, can be found in Google, but unfotunately it hasn't been updated for almost 3 years or so, and 75% of links in the page are broken by now.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Tue Mar 25, 2008 12:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It would be nice if Google was able to find this place.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat Mar 29, 2008 4:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It isn't specific to this site, it's specific to all the sites on the Parodius Network.  It's a global robots.txt.
<br />
<br />I did this because archival bots -- including Googles -- gets stuck in infinite loops when fetching content from message boards, and have awful problems dealing with sites that have multiple Host entries which point to the same content (nesdev.com vs. nesdev.com, etc.).  The bandwidth usage is the main one.
<br />
<br />We just had this happen tonight with a bunch of Chinese IPs.  For the past 10 hours they've been pounding the nesdev site, and we've been spitting out up to 2mbit/sec worth of traffic for about 10 hours.  I would have noticed sooner except I was sleeping.  Did they honour robots.txt?  Nope.  It was a distributed leech session across multiple IPs within China, which means it was probably compromised machines being used to download content.
<br />
<br />This is very likely going to cost me hundreds of dollars in 95th percentile overusage payments with the co-location provider.
<br />
<br />EDIT: I've uploaded pictures of the incident tonight, to give you some idea what happens to the server, to the network, and to the firewall state tables when leeching or webcrawler bot software encounters message boards.  As you can see, I had to firewall off portions of China to alleviate the problem (using deny statements in Apache doesn't help -- they don't honour anything other than HTTP 404, so the only way to stop them is to block their packets).
<br />
<br /><a href="http://jdc.parodius.com/lj/china_incident/" class="postlink">http://jdc.parodius.com/lj/china_incident/</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sat Mar 29, 2008 7:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Too bad there's no way to have something watch for excessive usage like this and simply shut down the entire site until a human can figure out what to block. Makes me angry hearing about it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Sat Mar 29, 2008 8:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I fell every site on earth should be on Google always because everyone has the right to knowledge and information.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sat Mar 29, 2008 8:31 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">NotTheCommonDose wrote:</div><div class="quotecontent">I fell every site on earth should be on Google always because everyone has the right to knowledge and information.</div>
<br />
<br />...and downloads? And leeching?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Sat Mar 29, 2008 9:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat Mar 29, 2008 9:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Too bad there's no way to have something watch for excessive usage like this and simply shut down the entire site until a human can figure out what to block. Makes me angry hearing about it.</div>
<br />
<br />The part I'm still trying to figure out is how they managed to get that amount of network I/O out of us.
<br />
<br />The nesdev site is rate-limited to ~50KBytes/sec (shared across all visitors -- yes, that's why the site seems slow sometimes), which means technically it shouldn't have exceeded 384kbit/sec.  I'm thinking there's a bug in the bandwidth limiting module we use, and if that's the case, I have another I can try -- or I'll just end up sticking the site on it's own IP and use ALTQ in the network stack to do the rate-limiting.
<br />
<br />Alternatives I've come up with, none of which are very user-friendly:
<br />
<br />1) Use a module which limits the number of requests-per-second submit per IP address; if they exceed the limit, they're blocked for something like 5-10 minutes.  The problem with that method is that it can sometimes go awry (and I've seen it happen on sites I've visited), especially if someone loads different pages of the site in multiple tabs or windows.
<br />
<br />It also doesn't solve issues like what happened this morning, because the requests being made by the leechers still come in and hit the webserver, and it still has to spit back some brief HTML saying they've been blocked temporarily.  This doesn't stop the requests.
<br />
<br />2) Use a module which limits the total site bandwidth to X number of kilobytes per minute/hour/day/week/month.  If this number is exceeded, the site essentially shuts down hard until the limit is reset (by me).  You might've seen this on some web pages out there, where you get a brief HTML message saying "Bandwidth Exceeded".
<br />
<br />The problem with this is that all it takes is some prick downloading the entire site (which happens regularly) with wget or some *zilla downloader, and then the site goes offline for everyone until I get around to noticing or someone contacts me to reset the limit.
<br />
<br />There's really no decent solution to this problem, folks, at least not one that's ultimately user-friendly, while still being resource-friendly and won't financially screw me into oblivion.
<br />
<br />P.S. -- <a href="http://jdc.parodius.com/lj/china_incident/dropped_packets_0329_0950.png" class="postlink">http://jdc.parodius.com/lj/china_incident/dropped_packets_0329_0950.png</a> shows that the leechers *still* have not shut off their leeching programs.
<br />
<br />EDIT: I figured out how the leechers managed to get past the bandwidth limit.  The bandwidth limiting module we were using was setting the total amount of bandwidth per user to 384kbit, not for the entire site.  Thus, multiple simultaneously connections could indeed reach 2mbit.  For those who are technical, the module I was using was mod_bw.  The documentation for this module is badly written; once I went back and re-read the docs for the directive, I realised "Oh, so THAT'S what they mean... ugh."
<br />
<br />I've addressed this by switching to mod_cband, which lets you set a maximum bandwidth limit for a site as a total, not per-client.
<br />
<br />Also, looks like some of the leechers have finally noticed and stopped fetching data: <a href="http://jdc.parodius.com/lj/china_incident/dropped_packets_0329_1054.png" class="postlink">http://jdc.parodius.com/lj/china_incident/dropped_packets_0329_1054.png</a>.  Now all I'm left wondering is if they're just going to find other machines to do this from...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Sat Mar 29, 2008 1:08 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What's the point of these people leeching? They just want to download the entire site for some reason? Just greedy/selfish people?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat Mar 29, 2008 1:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">What's the point of these people leeching? They just want to download the entire site for some reason? Just greedy/selfish people?</div>
<br />
<br />I don't know, you'd have to ask them.
<br />
<br />There's a **lot** of people who have done this over the years; it's why Memblers put the "Do not download full copies of the site through the webserver. Use the FTP mirror" note on the main page.  That ZIP file is updated weekly, and automatically.  I did it solely so people would stop leeching the site, but I guess that's wishful thinking on my part.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Mar 29, 2008 1:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">There's a **lot** of people who have done this over the years; it's why Memblers put the "Do not download full copies of the site through the webserver. Use the FTP mirror" note on the main page.  That ZIP file is updated weekly, and automatically.</div>
<br />As far as I can tell, the forum is the most interesting part of the site, especially because the front page is years out of date. But I just downloaded all 70 MB of the site's archive over FTP five minutes ago, and a static copy of /bbs/ isn't in there.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
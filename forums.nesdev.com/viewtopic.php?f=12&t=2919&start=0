<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Emulation and streaming asynchronous audio resampling</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Emulation and streaming asynchronous audio resampling" href="http://forums.nesdev.com/feed.php?f=12&amp;t=2919" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=2919';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun Sep 21, 2014 1:41 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=2919">Emulation and streaming asynchronous audio resampling</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=2919"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 19 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=2919&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=2919&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=2919&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=2919&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=2919&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21733"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21733">Emulation and streaming asynchronous audio resampling</a></div><div style="float: right;"><a href="./viewtopic.php?p=21733#p21733"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 31, 2007 11:18 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hello, I'm sorry to ask this question here (I also asked at mameworld.info), but there's a (not so) surprising lack of people out there who might be able to help me with this ... I was hoping that perhaps someone here has encountered this issue in the past and worked out some possible solutions already.
<br />
<br />Basically, emulation has two really important outputs: video and audio. Video typically runs at close to but not exactly a monitor refresh rate (in my case, ~60.09fps emulation vs ~60.00fps monitor), and the same for audio (~32,040hz emulation vs ~32,000hz sound card). So, in order to get smooth audio and video: you either have to resample the video (skip/duplicate frames), which is quite visible to a user; or you have to resample the audio. This theoretically should be less noticeable to the user if done right, as you can interpolate per sample rather than outright drop frames. I've been completely unable to think of how to do this, however.
<br />
<br />My setup is that I use DirectSound (the API is unimportant) and a 3-ring audio buffer, plus one very very large temporary buffer. The ring size is adjustable, typically ~800 samples for 32khz (~25*3=75ms latency). I run emulation, and each time a sample is generated, I add it to the temporary buffer and then check the current playback position in the audio buffer. As soon as I see that the playback position has reached a new ring (of 3, it wraps), I then take the temporary buffer, resample it and stick it two rings ahead of the currently playing ring, and flush the temporary buffer. Why two ahead of the current ring? A: to give time for resampling, and B: I use 3 rings instead of 2 because I also want to allow syncing via dropping video frames and that requires 3 minimum if you think about it.
<br />
<br />Now, the problem is the resampling part. My output clock rate is consistent at 32khz, but I can only roughly detect the current playback position, and not every sample edge. My input clock rate is known (~32,040hz), however the number of samples I actually generate can vary wildly based on how much time the OS gives my emulator, and how complex emulation is during the next "ring". The number of input samples can be more or less than the number of output samples I need to fill the next audio ring buffer, so I'm using a godawful point resample ("drop-sample") filter for now (I know you can practically get into quantum physics and n-dimensional trig/calculus trying to resample audio, but I chose the simple approach to start) to convert x input samples to y output samples.
<br />
<br />The problem is that audio is just waaay too sensitive to this, regardless of latency. A sample conversion log (with a massive latency of 8000 samples, ~250 * 3ms) looks like this:
<br />7950 samples -&gt; 8000 samples
<br />7980 samples -&gt; 8000 samples
<br />8020 samples -&gt; 8000 samples
<br />7990 samples -&gt; 8000 samples
<br />
<br />Every single ring buffer that gets played back has an extremely noticeable pitch shift from the previous sample block (even for very, very small sample differences, which surprised me), and the result is truly something horrible to listen to. It actually sounds better to leave it crackling by not resampling the audio at all and just ignoring buffer overruns/underruns. In the rare cases that I get several blocks with the same number of input and output samples, it sounds quite tolerable, again until the input sample rate changes and the pitch shifts again. I can get more blocks sounding the same by testing playback position every n samples rather than every single sample, but then eventually that rounds off and one ring buffer has an even more massive pitch difference from the others to compensate. I also want to be able to handle differing times with at least a ~5-10% tolerance (eg if I need 800 output samples, I want audio to sound good when the input sample count is within ~700-900 samples), as sometimes emulation will fall below 60fps, and I'd like it if the audio didn't go all to hell when that happened.
<br />
<br />Obviously, I'd need to even out the pitch over multiple ring buffers. But my question is, how in the world is this possible when you are streaming asynchronous audio data? You can't possibly predict how many samples you'll get in the next ring/block until you emulate it, and the more you buffer to try and even things out, the more terrible your latency gets. At anything &gt; 100ms, you can noticeably tell the delay between eg Link swinging his sword and the sound effect for it playing back. If you buffer the video back to account for this delay, then your input to onscreen response gets delayed even more.
<br />
<br />Please note that manipulating the CPU/SMP frequency counters to control video frames/second to audio samples/second is not an option, as that affects emulation accuracy. I'm also not able to ask the emulated DSP to generate more samples, as that would result in changes to DSP processor registers visible to program code: again, also not good for accuracy.
<br />
<br />Any help would be greatly appreciated, thanks in advance.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21738"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21738"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21738#p21738"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 31, 2007 2:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Overall, your emulator is generating video frames and audio samples at rates that are of a precise relation to each other (say exactly 32040 stereo samples per 60 video frames, or 60.xxx/59.xxx or whatever). These are fed to the host system, which accepts them at rates very close to what they are generated at. If the host's rates were both off by the exact same amount, say 1% faster, then emulation would simply run a bit faster. The problem is that the host's rates are off by different amounts, say the video 1% faster and audio 2% slower. The solution is to a) buffer one or both, b) choose one to be the "master", c) continually adjust the slave's data rate so that the slave's buffer is kept filled to approximately the same level. Note that none of this is affecting emulation accuracy, only the data after the emulator has output it.
<br />
<br />You have apparently chosen to use video as the master and audio as the slave, changing the pitch of the audio very slightly so as to keep the audio buffer from completely emptying or staying completely full. If the problem is that the pitch is changing too much, then you probably need to average out the adjustments so they are finer. This might require a larger audio buffer or finer granularity.
<br />
<br />My main aim is to keep unnecessary implementation details out of the picture (but I may have misunderstood your problem).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21741"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21741">Re: Emulation and streaming asynchronous audio resampling</a></div><div style="float: right;"><a href="./viewtopic.php?p=21741#p21741"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 31, 2007 2:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 12424<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Basically, emulation has two really important outputs: video and audio. Video typically runs at close to but not exactly a monitor refresh rate (in my case, ~60.09fps emulation vs ~60.00fps monitor)</div><br />I haven't seen a monitor that can do anything close to 50 Hz. Have you chosen not to support Europe-only titles in your emulator? Or are you requiring a 100 Hz monitor for PAL mode?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">and the same for audio (~32,040hz emulation vs ~32,000hz sound card).</div><br />A lot of sound cards have hardware resampling, and Windows can do software resampling.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The problem is that audio is just waaay too sensitive to this, regardless of latency. A sample conversion log (with a massive latency of 8000 samples, ~250 * 3ms) looks like this:<br />7950 samples -&gt; 8000 samples<br />7980 samples -&gt; 8000 samples<br />8020 samples -&gt; 8000 samples<br />7990 samples -&gt; 8000 samples</div><br />What you are hearing is <a href="http://en.wikipedia.org/wiki/Flutter" class="postlink">flutter</a>. The human auditory system can perceive pitch changes of about 6 "cents", where an octave is 1200 cents. This 6 cents corresponds to a change in sample rate of about 0.35 percent.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Obviously, I'd need to even out the pitch over multiple ring buffers. But my question is, how in the world is this possible when you are streaming asynchronous audio data? You can't possibly predict how many samples you'll get in the next ring/block until you emulate it</div>
<br />How does this vary? At least on $(SomeOtherSystem), every 2-frame unit should give exactly (341*262*2-1)/3 = 59,561 samples on NTSC or (341*312*2)/3.2=66,495 samples on PAL. There are similar figures for any set of PPU and DSP operated off the same clock divider.
<br />
<br />(Edited for context)</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=9" style="color: #AA0000;" class="username-coloured">tepples</a> on Wed Jan 31, 2007 5:15 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21743"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21743"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21743#p21743"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 31, 2007 3:09 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The problem is that the host's rates are off by different amounts, say the video 1% faster and audio 2% slower. The solution is to a) buffer one or both, b) choose one to be the "master", c) continually adjust the slave's data rate so that the slave's buffer is kept filled to approximately the same level.</div><br /><br />a) buffering doesn't work well.<br />If audio is always slower than video, then the audio buffer continues to drain until it is empty. If it's faster, then it will overflow. The SNES outputs the same video frames to samples ratio (which changes based on runtime toggleable interlace setting), but the PC is where the variance comes into play. The PC can make it so that one is always faster or slower than the other, and to compensate, eventually you have to resample or drop/skip data.<br /><br />b) I want to have the master be selectable as an option. Audio master is "easier", as you just simply drop/skip video frames. I'm sure it's theoretically possible to "blend" video frames somehow, but I don't have the power or the high refresh rates needed to even joke about attempting something like that ... anyway, I'm now trying to get another optional mode that always outputs every video frame in sync with the video card refresh rate and resample the audio. Hence this post.<br /><br />c) How can I adjust the slave's data rate without affecting accuracy? You mean I should constantly ask the host to change the playback frequency? I've had problems with cheap onboard sound cards refusing to work with non-standard pitch rates (32040, etc), even on Windows XP. The emulator would just freeze completely. Probably bad drivers, but it was a common chipset (AC'97), so this really isn't the "best" option, but it would probably sound better than any pitch shifting I tried.<br /><br />Also, I can't make my audio buffer that big. The bigger the buffering, the longer the latency. It's already barely perceptible at 75ms. And I can't buffer the video more to compensate as that would lag out the input responsiveness even more.<br /><br />So now, here's what I've come up with: the pitch change, fluttering, is detectable even with the lowest possible latency setting (~25ms ring buffers x 3). Any lower latency, and sound breaks up because audio is playing too fast. The more I raise the latency, the less responsive audio appears to video/input. I can try and smooth out each block by overbuffering past the exact start of a new ring buffer (eg if one frame has 790 samples and one has 810, I can get two 800's out of it by buffering them), but this rounding continues to stack up, one frame I'm 10 samples behind, next I'm 20, then 40, and eventually it rounds down and now I have a buffer that's resampled from 700 samples instead of 800 samples, and the pitch distortion is even worse.<br />The only way I can see getting around the fluttering is to resample smaller blocks at a time. I'd have to resample it at a latency rate lower than the best sound card can handle, so that won't work either.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I haven't seen a monitor that can do anything close to 50 Hz. Have you chosen not to support Europe-only titles in your emulator? Or are you requiring a 100 Hz monitor for PAL mode?</div><br /><br />Neither have I. I won't have a choice with PAL. Either the user will have to use the audio sync method and drop/skip frames, or turn off video buffering all together and deal with shearing/tearing, or I could try and add a 100hz mode that just waits two vsyncs instead of one. Kind of annoying as I won't be able to test it (of my four CRTs and one LCD, none support 100hz in <em>any</em> resolution. They all go back down to 85hz. Two of the monitors are very expensive, too).<br />The last, most evil method might be to pull off some sort of pulldown method to perform 50-&gt;60hz transform. It won't look good, though.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">What you are hearing is flutter. The human auditory system can perceive pitch changes of about 6 "cents", where an octave is 1200 cents. This 6 cents corresponds to a change in sample rate of about 0.35 percent.</div>
<br />
<br />I don't understand "cents" (why do we need a million measurements for the same thing?), unfortunately. You mean if I'm playing at 32000hz, a change to +/ 32000*0.0035-&gt;32112hz will be perceivable, but anything below this (31889hz - 32111hz) will not be detectable?
<br />
<br />I was reading a forum post where someone was resampling 7999hz to 8000hz ( <!-- m --><a class="postlink" href="http://www.dsprelated.com/showmessage/33844/1.php">http://www.dsprelated.com/showmessage/33844/1.php</a><!-- m --> ), and the one sample difference was audible for them as a clicking sound. The person was duplicating the last sample, as that was really his only choice.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21747"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21747"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21747#p21747"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 31, 2007 5:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">a)If audio is always slower than video, then the audio buffer continues to drain until it is empty. If it's faster, then it will overflow.</div><br />And if you adjust the audio to be faster/slower in just the right proportion, the buffer never becomes completely empty or full. This would be a closed-loop system, where the adjustments are in response to how full the buffer is.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The SNES outputs the same video frames to samples ratio (which changes based on runtime toggleable interlace setting), but the PC is where the variance comes into play. The PC can make it so that one is always faster or slower than the other, and to compensate, eventually you have to resample or drop/skip data.</div><br />Exactly. So another way of stating the solution is that you resample the audio or video so that the resulting audio/video ratio matches that of the PC (again, using feedback).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">How can I adjust the slave's data rate without affecting accuracy? You mean I should constantly ask the host to change the playback frequency?</div><br />Adjust the slave's data rate by speeding up/slowing down the data that the emulator produces. For video, you change the delay between frames. For audio, you resample it. In either case you ultimately go from X to Y data units per second (frames or samples). Since these transformations are done after emulation, accuracy is not affected.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Also, I can't make my audio buffer that big. The bigger the buffering, the longer the latency. It's already barely perceptible at 75ms.</div><br />As long as the audio buffer is several times the resolution of the "how full is the buffer?" function, you can get enough feedback to adjust the audio rate. For example, if buffer is 1/2 full, resample output to 32000 Hz. If buffer is less than 1/3 full, resample output to 31950 Hz. If buffer is more than 2/3 full, resample output to 32050 Hz. You should probably look at the average of several buffer readings so you don't change the rate really often (in case the reading itself jumps around often).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So now, here's what I've come up with: the pitch change, fluttering, is detectable even with the lowest possible latency setting (~25ms ring buffers x 3).</div><br />Pitch change (change in resample ratio) will be much more noticeable if you're not using a high-quality resampler, as the artifacts introduced by lower-quality methods can change a lot when even small changes are made to the ratio. So the ratio change problem might not be due to pitch change alone.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I was reading a forum post where someone was resampling 7999hz to 8000hz, and the one sample difference was audible for them as a clicking sound. The person was duplicating the last sample, as that was really his only choice.</div>
<br />Duplicating the last sample is not merely changing the pitch by 1/8000; it's doing a lot more things (like adding noise/harmonics to the signal). It is possible to resample by that amount, it's just not as cheap as duplicating the last sample.
<br />
<br />I think slaving the video to audio is a far superior solution that's a ton simpler, and necessary when the monitor's refresh rate isn't exactly 60.whatever Hz. To do this, you adjust the frame rate based on how full the audio buffer is, on average. To reduce consistent frame dropping/doubling, you should resample the audio to an unchanging rate based on the audio card's actual rate and the monitor's actual frame rate.
<br />
<br />Here's an example of the above: say your emulated SNES generates 60.09 frames and 32040 stereo samples per second, and your host PC's monitor runs at 60.10 Hz and audio card at 31900 Hz (even though it claims 32000 Hz). For the fewest dropped/doubled video frames, you'd want to resample the audio to 31905.31 Hz. Played at 31900 Hz, this would use 32045.332 SNES stereo samples per second, resulting in 60.1 video frames per second, which matches the host rate. Invariably, the host rates will vary a tiny bit over time, so there would be an occasional dropped or doubled video frame.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21801"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21801"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21801#p21801"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Feb 02, 2007 8:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry for the delayed response.
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">And if you adjust the audio to be faster/slower in just the right proportion, the buffer never becomes completely empty or full. This would be a closed-loop system, where the adjustments are in response to how full the buffer is.</div><br /><br />That's what I was hoping to do, but it seems that according to tepples, I cannot adjust by more than 100 samples/second, or the audio pitch will noticeably change. While I should hopefully be able to stay within that range when emulation stays at 100%, I would like to cover cases when speed drops below 100%. The differences between every audio block is far too great for just resampling block by block. Example: with 750ms latency (eg a massive latency buffer): format = req:resampledfrom@32khz<br />8000:7850<br />8000:8200<br />8000:7400<br />... etc.<br /><br />I would like to avoid locking the emulation speed to the lowest known frequency; in the above case, slowing emulation down 7400/8000% permanently.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Adjust the slave's data rate by speeding up/slowing down the data that the emulator produces. For video, you change the delay between frames. For audio, you resample it. In either case you ultimately go from X to Y data units per second (frames or samples). Since these transformations are done after emulation, accuracy is not affected.</div><br /><br />I guess I'm just worried that resampling audio to <em>any</em> inconsistent rate will be audibly noticeable. I suppose I can write a test application too to test the 0.35% thing. I do know that when I was getting variances of ~1% due to triple buffering being locking (haven't rewritten it to poll the video card vblank or added high resolution timers to test audio position yet), it was unbelievably noticeable. You could clearly hear when each buffer started playing at a different pitch rate.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">You should probably look at the average of several buffer readings so you don't change the rate really often (in case the reading itself jumps around often).</div><br /><br />Doing this causes more severe rounding, and pitch rate changes even more drastically, but less frequently:<br />eg instead of 31119, 32007, 32002, 32003; now you have:<br />32000, 32000, 32000, 32011<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Pitch change (change in resample ratio) will be much more noticeable if you're not using a high-quality resampler, as the artifacts introduced by lower-quality methods can change a lot when even small changes are made to the ratio. So the ratio change problem might not be due to pitch change alone.</div><br /><br />Ok, I'm using these filters now:<br /><!-- m --><a class="postlink" href="http://byuu.cinnamonpirate.com/temp/audio.txt">http://byuu.cinnamonpirate.com/temp/audio.txt</a><!-- m --><br /><br />Aside from the small issue of no clamping in the cubic filter, they seem to sound ok. I can fix the cubic one, I was just running out of time when I wrote the above code.<br /><br />Should cubic or cosine be sufficient for resampling? It still sounds just as noticeable to me when pitch change &gt;= 1%.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Here's an example of the above: say your emulated SNES generates 60.09 frames and 32040 stereo samples per second, and your host PC's monitor runs at 60.10 Hz and audio card at 31900 Hz (even though it claims 32000 Hz). For the fewest dropped/doubled video frames, you'd want to resample the audio to 31905.31 Hz. Played at 31900 Hz, this would use 32045.332 SNES stereo samples per second, resulting in 60.1 video frames per second, which matches the host rate. Invariably, the host rates will vary a tiny bit over time, so there would be an occasional dropped or doubled video frame.</div>
<br />
<br />Ah, ok. So what you want me to do is get the best resampling rate possible, and then always resample to that constant rate, and occasionally add/drop a video frame. This will at least make dropped frames far, far less frequent than once every ten seconds. I was thinking you were aiming for always resampling the audio so that the SNES is always synchronized to the video refresh rate; hence never any dropped frames.
<br />I was hoping to offer two modes, one that always guarantees no resampling of audio, but will have video frame dropping; and one that guarantees no dropped frames, but will always resample audio. Are these two impractical / impossible?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21802"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21802"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21802#p21802"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Feb 02, 2007 8:57 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">While I should hopefully be able to stay within that range when emulation stays at 100%, I would like to cover cases when speed drops below 100%.</div><br />By 100%, do you mean how fast it's running relative to a SNES? I don't think you're going to have much luck handling a situation where the emulator drops to 80% real-time for a second without a significant audio glitches, unless you add a lot of latency. I can imagine it. Start emulating a game and see "buffering..."<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I guess I'm just worried that resampling audio to any inconsistent rate will be audibly noticeable.</div><br />An inconsistent rate? You should be resampling the audio to a consistent rate, as in, an equal time delay between each sample.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">You should probably look at the average of several buffer readings so you don't change the rate really often (in case the reading itself jumps around often).</div><br />Doing this causes more severe rounding, and pitch rate changes even more drastically, but less frequently: <br />eg instead of 31119, 32007, 32002, 32003; now you have: <br />32000, 32000, 32000, 32011</div><br />If you're averaging values, then they will vary <em>less</em> between readings, not more. Averaging is a form of low-pass filtering.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Ah, ok. So what you want me to do is get the best resampling rate possible, and then always resample to that constant rate, and occasionally add/drop a video frame. This will at least make dropped frames far, far less frequent than once every ten seconds.</div><br />Right. But one frame glitch every 10 seconds is already pretty good, in my opinion.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I was thinking you were aiming for always resampling the audio so that the SNES is always synchronized to the video refresh rate; hence never any dropped frames.</div><br />That's what <em>you</em> want(ed) to do, and what I was mostly offering ideas about. The simpler solution is what I prefer, since it's mostly self-explanatory.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I was hoping to offer two modes, one that always guarantees no resampling of audio, but will have video frame dropping; and one that guarantees no dropped frames, but will always resample audio. Are these two impractical / impossible?</div>
<br />I doubt you'll frame glitches on a general-purpose operating system. If you really want to give it a fair chance, write some simple test applications that find out whether it's possible at all. One of them shouldn't do any audio, just video.
<br />
<br />I've been working on my polyphase (FIR) resampler again and will put some time into allowing really fine ratio adjustment.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21805"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21805"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21805#p21805"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Feb 02, 2007 11:53 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">By 100%, do you mean how fast it's running relative to a SNES? I don't think you're going to have much luck handling a situation where the emulator drops to 80% real-time for a second without a significant audio glitches, unless you add a lot of latency. I can imagine it. Start emulating a game and see "buffering..."</div><br /><br />Aww :(<br />And the problem with the buffering is that it delays input responsiveness. Not to mention, video buffering eats up a ton of memory. So, I guess I'll just have to specify that if you want clear audio, you'll have to cap emulation speeds at 50% for P4s, 25% for P2s, or for 486s that people still insist on running, 10%, heh.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If you're averaging values, then they will vary <em>less</em> between readings, not more. Averaging is a form of low-pass filtering.</div><br /><br />Hmm, my averaging technique was: instead of testing every sample to see when we hit the next audio buffer, we test every 256 SNES audio samples generated. So the # of samples-&gt;output samples is always mod 256. It was cleaning out the audio a little more, but the differences seemed more extreme as a result (eg instead of 4,4,5,5,5,4,5; you get 4,4,4,4,4,4,8).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I've been working on my polyphase (FIR) resampler again and will put some time into allowing really fine ratio adjustment.</div>
<br />
<br />Sounds interesting. I already can't tell the difference between linear and cubic, despite it being very evident on graphs (hence I didn't bother writing a 4-tap hermite resampler), but I'm really not resampling by more than 50%, either.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21814"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21814"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21814#p21814"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Feb 03, 2007 6:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ok, I've tried again for the 67th time to get the audio working plus the video syncing to vblank and dropping frames it can't possibly draw without tearing.
<br />
<br />It's basically your method, blargg, but I haven't enabled the audio resampling to try and even out the audio&lt;&gt;video refresh rate ratio just yet (I actually tried it using a quick hack, and it helped a tiny bit, but there's a much larger problem somewhere making the whole thing not work).
<br />
<br />I posted the code I was using, and an explanation of how it works, here:
<br /><!-- m --><a class="postlink" href="http://board.zsnes.com/phpBB2/viewtopic.php?p=139973#139973">http://board.zsnes.com/phpBB2/viewtopic ... 973#139973</a><!-- m -->
<br />
<br />I don't suppose anyone sees any obvious flaws with this? I don't even know where things are going wrong, sadly :(</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21826"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21826"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21826#p21826"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Feb 03, 2007 12:12 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 12424<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">In the Super NES hardware, are the 65C816 CPU, the SPC700 CPU, and the DSP clocked from the same crystal, such that there are exactly 32040.00000 samples per 3579545.454 CPU cycles? Or is there unit-to-unit variation in their clock speeds?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21827"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21827"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21827#p21827"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Feb 03, 2007 12:43 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">tepples, I'm guessing that you're going to suggest to take advantage of variations to simplify the task at hand. As in, if the SPC is clocked by a separate crystal (which it is), then make slight adjustments to the emulated crystal's rate rather than trying to resample the output. I took advantage of something similar in my NTSC filter regarding the output aspect ratio, since TVs can vary.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21828"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21828"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21828#p21828"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Feb 03, 2007 4:16 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Darn, seems no one knows why my code isn't working :/
<br />
<br />tepples, there are two crystal clocks inside the SNES. There's one shared by S-CPU, S-PPU1, S-PPU2 and S-WRAM at ~315/88*6mhz, and another one shared by the S-SMP (SPC700), S-DSP and the 64k WRAM they share (don't know if that one has a name or not), running at ~32040*768hz.
<br />
<br />Although both clocks obviously have precision variances in real life, in emulation I can at least guarantee a constant ratio of clock cycles between the two processors.
<br />
<br />I really don't wish to to fake the emulated speeds of either processor to get them more synced up (in fact, EWJ2 sound effects break if you change the sound clock enough to get 32khz output). Though I realize that since I don't (and really can't) emulate a true crystal clock's variance in realtime, the 32040*768hz approach is still more accurate than 32000*768hz. I will have to resample the audio output <em>and</em> drop video frames, sadly.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21829"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21829"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21829#p21829"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Feb 03, 2007 5:27 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Darn, seems no one knows why my code isn't working :/</div>
<br />The answer is probably that you're trying to solve it in a way that goes beyond your skills (remember, debugging takes twice the effort as coding). First thing, write a minimal app from scratch that manifests the problem. If possible, write all the relevant code from scratch and keep it damn simple. Real-time behavior can get complex very easily. From what you're written, it sounds like you're debugging all this in bsnes. I know the urge to hack away and put off doing a clean prototype.
<br />
<br />I've also done more work on resamplers (did you get the ones I e-mailed yesterday?) and linear is quite fine for SNES. I just did an all-integer implementation of cosine interpolation, which is a bit better than linear. I love this fast sin approximation:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">double fast_sin&#40; double x &#41;<br />&#123;<br />&nbsp; &nbsp; double pi = 3.14159265358979323846;<br />&nbsp; &nbsp; assert&#40; -pi &lt;= x &amp;&amp; x &lt;= pi &#41;;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; x /= pi;<br />&nbsp; &nbsp; return &#40;1 - fabs&#40; x &#41;&#41; * x * 4;<br />&#125;</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p21832"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21832"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21832#p21832"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Feb 04, 2007 1:50 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The answer is probably that you're trying to solve it in a way that goes beyond your skills (remember, debugging takes twice the effort as coding). First thing, write a minimal app from scratch that manifests the problem. If possible, write all the relevant code from scratch and keep it damn simple. Real-time behavior can get complex very easily. From what you're written, it sounds like you're debugging all this in bsnes. I know the urge to hack away and put off doing a clean prototype.</div><br /><br />You're correct, I am not skilled enough to debug code running in realtime like this. I think I see the problem, however. I simply can't reliably detect the start of vblank and have the video code blitted to the screen. No matter how many places I tell bsnes to check to see if we've reached vblank (over 40,000 times a second), it's still not enough and I miss entire vblank periods 20% of the time. Most likely, there are too many parts in bsnes that eat up so much CPU time that it jumps right over vblank. I patched all the obvious ones, adding checks to every scanline rendered both by the PPU and the filter, to every audio sample generated, and during every wait state inside the audio sync code. I even removed all Sleep(1) calls in case that 1ms were to kick me out of vblank. Still wasn't good enough.<br /><br />It's too bad video drivers and/or API developers are too incompetent to design APIs that handle page flipping completely transparently in the background without deadlocking your applications when you request to blit the image to the screen. Realistically, all you need is a hardware interrupt to trigger the second vblank edge is reached. It's amazing the way a twenty year old video game system has such a device (NES NMI, etc), and yet modern computers still lack this very useful functionality.<br /><br />Anyway, I've given up, sadly. I can't think of any way to do this, and I've exceeded my patience and run out of ideas. Thanks for trying to help, though. I really wish I knew how other emulators managed to do this, but the answer is probably something I wouldn't be willing to do anyway (eg force emulation to generate more samples, which would be visible to the system's sound registers).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I've also done more work on resamplers (did you get the ones I e-mailed yesterday?) and linear is quite fine for SNES. I just did an all-integer implementation of cosine interpolation, which is a bit better than linear. I love this fast sin approximation:</div>
<br />
<br />I like cosine, because the graphs for it are prettier, they look almost identical to hermite, and besides the end points, very similar to cubic as well. Whereas linear looks very mechanical and unnatural, even though I agree that it sounds just fine.
<br />
<br />Hmm, I like the sin algorithm. Perhaps I can take advantage of it. How do you convert that value to cosine again?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p21834"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p21834"></a></div><div style="float: right;"><a href="./viewtopic.php?p=21834#p21834"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Feb 04, 2007 3:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 835
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Well, I just realized something very stupid.
<br />
<br />I had forgotten about the way I implemented cothreads in bsnes: I basically take advantage of the fact that I don't have to back out of the CPU or SMP like normal emulators do, since I can swap between the two at any time thanks to cothreads; and so I run the currently active core as long as possible: either until one accesses the other, or until ~300,000 clock ticks have passed on one or the other (and even that is only to keep the audio buffer from emptying and the difference counters from overflowing).
<br />
<br />This of course means that the CPU and SMP can be desynchronized by up to 1/8th of a second at any given time. Hence, the wildly fluctuating samples generated per video frame.
<br />
<br />I can disable this behavior, but I will lose much of the benefits of cooperative multithreading and take a massive speed hit, especially on platforms where libco doesn't run as fast. At least I'll still get the cleaner code benefits. I guess I can give it a try, though I still think the resampling rate will be too sporadic to sound good.
<br />
<br />Funny that I just now realized that when sinimas made the comment that the number of audio samples generated per video frame should be constant, and while immediately thinking "no, that's not true", realized, "wait... actually, yes, that should be true". Oh well.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=2919"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=2919"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 19 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=2919&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=2919&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 3 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="2919" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
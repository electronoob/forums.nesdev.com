<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - comprehensive SMB1 disassembly</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">comprehensive SMB1 disassembly</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=2987">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=2987</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>10</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Fri Mar 30, 2007 9:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh, goddamnit.  These things are coming out of the woodwork. 
<br />
<br /> Yeah, I went ahead and fixed that.  Then I ran a complete check on every branch and jump in the file, and could find no others.  But anyway, thanks again for finding those bugs.
<br />
<br />My methodology was simple: I ran a disassembler on the program rom, then started at the beginning (reset vector) and traced out all the code.  The first version of this file I uploaded was full of gaping code and data holes.
<br />
<br />Anyway, sometimes I would trace out more code, sometimes I would go over the code with both FCEU and my intuition to figure out what the code did, and sometimes I did both at the same time.  I was able to expedite the process of figuring out the level data format by comparing notes with others who had done SMB1 hacking in the past, and I was able to actually verify that, for the most part, their own ideas were correct.  Some other parts, like enemy data, I had sparse information on.  For the rest of the code, however, I was for the most part completely on my own.
<br />
<br />It became fully functional (meaning it could be assembled) sometime in February I believe.  But although it was filled with comments, it was almost completely devoid of labels.  So I went back and replaced all the memory locations with addresses.  Some of the values which would have led to confusion I replaced with constants.  This was the part I call the clean-up phase.  Still, I'm only human, and even I overlooked some of them, apparently.
<br />
<br />Anyway, that's pretty much how I did it.  It's not something that anyone else with a lot of free time and a shitload of patience couldn't do.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Mar 30, 2007 11:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Can it be reassembled and still work even if you move parts of the program and data around within the 32 KiB PRG space? If so, rom hackers will have a new tool for making even more total conversions. Imagine moving all the level data and enemy logic to $8000-$BFFF so that S*ROM or U*ROM can switch it out when needed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beneficii</b> [ Fri Mar 30, 2007 12:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />tepples,
<br />
<br />Yes.  I converted it to being assembleable with CA65 and then modularized it and then moved the modules around.  This was how I discovered those bugs.  But once I fixed the 2 bugs I mentioned here, it's a good build! ^_^
<br />
<br />EDIT: Additionally, I wonder what is the best method for modularizing so that you could add in extra switchable banks so that you can add more data in?
<br />
<br />-----------------------------------------------
<br />
<br />doppelganger,
<br />
<br />I've been eying doing disassemblies of smb2J and smb3 (Japanese version), but I realize they would be much tougher because of the bank switching.  Nevertheless, though I'm still trying to figure out the data loading/saving mechanisms of the FDS, I think I'm making decent progress in planning how I'm going to do the smb3 disassembly.
<br />
<br />Basically, I made some modifications to FCEUXD SP v1.07 having added an Address Use Logger, which among other things logs the exact PRG (as opposed to just ROM) addresses accessed by opcodes.  I'm not done obviously, but I think that if used in conjunction with the Code/Data Logger you can get a pretty good idea of how this is to be disassembled and how you're going to apply labels to each of the referenced addresses.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Mar 30, 2007 12:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Good job. Now all we have to do is write a freely licensed replacement for each of the modules, <a href="http://en.wikipedia.org/wiki/LAME#History_and_development" class="postlink">like LAME did</a>, and we'll have bootstrapped ourselves a complete side-scroller engine free of Nintendo copyright. Who's up for the task? Or is it too big?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beneficii</b> [ Fri Mar 30, 2007 12:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />tepples,
<br />
<br />Or just use it for a ROM Hack--though the IPS file for that would probably contain a lot of the original game code--, or just use it as a guide to learn how to write your own sidescroller.
<br />
<br />EDIT:
<br />
<br />For a ROM Hack, you might just want to distribute the source code and the INES header (with possibly the CHR-ROM if it's heavily modified) along with instructions for how to assemble it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Sat Mar 31, 2007 4:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I am curious to see how you modularized it.  It was pretty chaotic to do, I bet.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CKY-2K/Clay Man</b> [ Sun Apr 01, 2007 2:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've tried everything to get it to assemble.
<br />
<br />X112F doesn't do anything, when I try to use it it says "not enough memory"
<br />
<br />And I tried the other assembler and did all the changes, but it still gets errors.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Apr 01, 2007 4:39 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">CKY-2K/Clay Man wrote:</div><div class="quotecontent">And I tried the other assembler and did all the changes, but it still gets errors.</div>
<br />Which "the other assembler", and which errors?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beneficii</b> [ Sun Apr 01, 2007 10:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Clay Man,
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">X112F doesn't do anything, when I try to use it it says "not enough memory" </div>
<br />
<br />If you're using Windows XP, then you probably want to get something like DOSBox (Google it) so that you can have an environment under which the assembler can be run.
<br />
<br />All,
<br />
<br />Has the source code to the assembler been released?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Mon Apr 02, 2007 9:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">CKY-2K/Clay Man wrote:</div><div class="quotecontent">X112F doesn't do anything, when I try to use it it says "not enough memory"</div>
<br />
<br />I don't think you need DOSbox for this.  I can run it in 2k just fine... after I change its memory settings.
<br />
<br />Right click on the exe and go to properties.  In the Memory tab, you have to change one of the settings to give it more mem (I forget which kind of mem, though).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beneficii</b> [ Wed Apr 04, 2007 1:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Disch,
<br />
<br />I was having the issue on my school's computers (which have XP) and I had set the memory settings to max.  So in response I got DOSBox.  But whatever gets it working for the person... ^_^

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Wed Apr 04, 2007 3:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Perhaps I should break this thing up into smaller pieces.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CKY-2K/Clay Man</b> [ Wed Apr 04, 2007 4:04 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, Windows XP seriously pisses me off.  I can only run pure DOS things under command promt.
<br />
<br />One of the reasons why I was urging my mom to install Windows 98 on our old computer.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Apr 04, 2007 4:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Make it for the CA65 toolchain, and everyone will be happy. CA65 is ported to Linux, to Windows, and to PC DOS.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CKY-2K/Clay Man</b> [ Wed Apr 04, 2007 5:21 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It works fine.  Perfectly done.  This is my first time really trying out compilers/assemblers and all.  Same exact hex.
<br />
<br />All I need to do after I compile it is add an iNES header and the graphics.
<br />
<br />Good job.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>10</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
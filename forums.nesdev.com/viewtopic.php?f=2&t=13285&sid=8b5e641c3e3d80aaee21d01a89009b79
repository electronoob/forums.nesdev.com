<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Stack-based VRAM update system</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Stack-based VRAM update system" href="http://forums.nesdev.com/feed.php?f=2&amp;t=13285" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en&amp;sid=041dfea522ebaa29455a98fd3f1e992d" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php?sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php?sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Mon Nov 07, 2016 7:16 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=041dfea522ebaa29455a98fd3f1e992d">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=041dfea522ebaa29455a98fd3f1e992d">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=041dfea522ebaa29455a98fd3f1e992d">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=041dfea522ebaa29455a98fd3f1e992d">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=041dfea522ebaa29455a98fd3f1e992d">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d">Stack-based VRAM update system</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320&amp;sid=041dfea522ebaa29455a98fd3f1e992d">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 26 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=13285&amp;view=previous&amp;sid=041dfea522ebaa29455a98fd3f1e992d">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=13285&amp;view=next&amp;sid=041dfea522ebaa29455a98fd3f1e992d">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155848"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155848">Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155848&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155848"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 2:37 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">In another thread I started talking about a way to do VRAM updates that is completely stack-based, and can be used for the entire game. I decided to start this new thread mainly to share what I have designed so far, possibly helping people in search of a VRAM update system, but also to get some input from you guys and maybe make this better.<br /><br />The first thing I have is this piece of code in the NMI handler, after the OAM DMA, that takes care of running all the updates:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;;swap stack pointers<br />&nbsp; &nbsp;tsx<br />&nbsp; &nbsp;stx RealSP<br />&nbsp; &nbsp;ldx FakeSP<br />&nbsp; &nbsp;txs<br /><br />UpdateVRAM:<br /><br />&nbsp; &nbsp;;set the output address and jump to the byte copy code<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;rts<br /><br />RestoreSP:<br /><br />&nbsp; &nbsp;;restore the stack pointer<br />&nbsp; &nbsp;ldx RealSP<br />&nbsp; &nbsp;txs</div><br />For each VRAM update, an output VRAM address is pulled from the stack and used, and the RTS jumps to some point in the middle of the following unrolled loop, depending on the amount of bytes that need to be copied:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Copy32Bytes:<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /><br />Copy31Bytes:<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /><br />&nbsp; &nbsp;(...)<br /><br />Copy2Bytes:<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /><br />Copy1Byte:<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /><br />CopyNothing:<br /><br />&nbsp; &nbsp;jmp UpdateVRAM</div><br />This will copy a certain amount of bytes and JMP back to the update loop, so the next update can be processed. I decided that 32 bytes is the ideal length for this unrolled loop because it allows you to update the whole palette and a whole row of name table entries. You'll most likely only need more than that for pattern updates only, but there's nothing wrong in breaking those up into pairs of tiles (32 bytes = 2 tiles).<br /><br />When does the update loop end then, if the program keeps JMPing back to <strong>UpdateVRAM</strong>? Well, in order to process the updates as fast as possible, I decided to not explicitly check for the end of the updates, but instead feed the RTS of the last iteration of the update loop with the address to <strong>RestoreSP</strong>. Yes, this means that the last address written to $2006 is a bogus one (if it makes you feel better, you can write $0000, like some people do anyway), but since it takes 16 cycles to set that address, that's equivalent to 8 non taken branches that would be necessary inside the loop to check for a flag that breaks out of the loop. I'm optimizing for the worst case here, so whenever there are more than 8 updates, it's cheaper to set the address unnecessarily than to check for a flag every update.<br /><br />What about PPU address increments? Same thing. Whenever the increment mode has to be changed, the RTS is fed with the address of a routine that changes the increment mode, before RTSing again to reach the actual byte copy code.<br /><br />All decisions so far were made to make the most out of the vblank time, meaning there's a lot of work to do before vblank starts, so the stack is formatted correctly. Personally, I'd rather use indexed addressing to fill the update stack, to avoid having to manipulate the stack pointer mid-frame and to avoid having to write all the data backwards. If you want to build the update stack using PHA, you'll have to do the next steps in the opposite order.<br /><br />For each update you need to &quot;schedule&quot;, you have to first check whether the current PPU address increment mode is the one you need. If it isn't, you have to write the address (minus 1, since it will be called with an RTS) of the routine that changes the increment mode. Then, you have to write the output address for the data, and then the data.<br /><br />Once all updates have been written, you need a bogus VRAM address, which can be anything really, but you can use $0000 if that makes you more comfortable. Then you need the address of <strong>RestoreSP - 1</strong>, because that's what will allow the update loop to end. Even if there are no updates at all, you still need these last 4 bytes so the program doesn't crash.<br /><br />Another interesting advantage of this method is that you can cheat, and use the RTS to jump to other types of byte copying routines besides the chain of PLA + STA. For example, to update attribute table data, I prefer to copy the bytes directly from my shadow attribute tables, instead of wasting time copying them over to the stack. In cases like this, you can simply use the address of the specialized byte copy code (minus 1) instead of the addresses from the regular look-up table. This allows you to have a constant NMI handler for the whole program, but doesn't prevent you from doing more specialized updates if you need to. This is useful if you need to switch banks and copy data directly from ROM, for example. As long as you JMP back to <strong>UpdateVRAM</strong> in the end, everything is game.<br /><br />Does anyone have any comments or suggestions? The thing that's bothering me the most is the bogus VRAM address at the end, but like I said, in the worst case, it's cheaper to have that than checking a flag for every update.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p155853"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155853">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155853&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155853"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 8:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">There's one important thing I forgot to talk about&#058; when trying to buffer an update, there must a way to tell whether there's still enough time left to process it. I'm not sure if going by how full the buffer is is enough, since the same buffer is used for addresses and data, and these take different amounts of time to process (let's not forget the increment mode change, which is an additional routine). The most precise thing to do would probably be to count cycles. Initialize a variable with the total amount of cycles that can be used for VRAM updates and subtract from it whenever a new update is buffered. A look-up table could hold the number of cycles necessary for byte transfers of different lengths.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155854"></a>
				<b class="postauthor">Movax12</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155854">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155854&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155854"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 8:38 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4680_1345480112.png" width="100" height="33" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 02, 2011 11:50 am<br /><b>Posts:</b> 522
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Reminds me of how I add routines to NMI. I wanted it to be easy to hook anything into NMI. I load $0100 and up with the addresses of task I want to complete (minus 1), set the SP and RTS to the first routine. The next RTS will load the next task, and whatever the last task is, its RTS will jump to the routine that restores the stack pointer. I just avoid using the stack for anything in my &quot;NMI&quot; routines. If I really need to I can swap the stack pointer inside the routine.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4680&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p155859"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155859">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155859&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155859"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 9:31 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Movax12 wrote:</div><div class="quotecontent">I wanted it to be easy to hook anything into NMI. I load $0100 and up with the addresses of task I want to complete (minus 1), set the SP and RTS to the first routine. The next RTS will load the next task, and whatever the last task is, its RTS will jump to the routine that restores the stack pointer.</div><br />Cool idea, very clever and elegant! And you can still have VRAM addresses and data on the stack that the tasks can use, if you want to.<br /><br />Doing the math though, it sounds like your way ends up being slightly slower, at least for the common case of simply copying variable amounts of bytes to a dynamic VRAM location. For each task, there's 6 cycles for the RTS, and then inside the task you need 16 cycles to set the VRAM address, then another RTS to jump to the middle of the unrolled loop. That's 28 cycles of preparation before the transfer itself.<br /><br />In the code I wrote above, there's 16 cycles of setting up the VRAM address, followed by the 6 cycles of the RTS that jumps to the unrolled loop. Then, after all bytes are copied, there's 3 cycles for the JMP, for a total of 25 cycles of overhead for each block of data. There's also what's lost with the dummy $2006 writes in the end, which adds a bit more overhead to the whole process though, so it's not as elegant as your solution.<br /><br />I was just thinking, and realized that the overhead for updating small amounts of data is quite annoying. Say, when updating a single metatile for a block that's been destroyed: that's 2 rows of 2 tiles followed by 1 attribute byte. These need 3 separate transfers (3 * 25 cycles of overhead = 75 cycles) and 5 bytes of data (5 * 8 cycles = 40 cycles). I thought that 115 cycles sounded like a lot to update just one metatile, but then it hit me: all metatile updates have the same structure, so instead of calling the generic byte copy routine 3 times I can make a routine specifically for updating single metatiles, that doesn't JMP back to the NMI handler until it's done with the 3 transfers. That brings the amount of time it takes to update the metatile down to 97 cycles, which is much more reasonable. So I guess I can have the simple byte copy routine for the more generic stuff, but I have the option to create new specialized routines whenever they seem necessary, so this solution is still very flexible even though the first couple of $2006 writes of each update are done outside the update routine itself. A little messy, but flexible. <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I just avoid using the stack for anything in my &quot;NMI&quot; routines. If I really need to I can swap the stack pointer inside the routine.</div><br />Yeah, that doesn't bother me at all. The goal is to move as much processing as possible away from the PPU update code, which should eliminate the need for regular stack operations.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155861"></a>
				<b class="postauthor">Kasumi</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155861">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155861&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155861"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 9:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3504.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Apr 02, 2008 2:09 pm<br /><b>Posts:</b> 985
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I realized too late this is probably describing what Movax12 does, but I've already gone and written it.<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">but instead feed the RTS of the last iteration of the update loop with the address to RestoreSP. Yes, this means that the last address written to $2006 is a bogus one </div><br />Couldn't you use the same trick for the end of the loop?<br />i.e:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Copy1Byte:<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /><br />CopyNothing:<br /><br />&nbsp; &nbsp;rts<br /></div><br />3 cycles slower per case, but since the extra setup of $2006 at the end is 22 cycles, it'd require more than 7 different update streams before it matters. Then again, I suppose attribute bytes would do that. But, because the routine would no longer need to always start from UpdateVRAM, different addresses could be pushed for different types of streams like:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">UpdateVRAMinc32:<br />&nbsp; &nbsp;lda shadow2000<br />&nbsp; &nbsp;ora #%00000100<br />&nbsp; &nbsp;sta shadow2000<br />&nbsp; &nbsp;sta $2000<br /><br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;rts<br /></div><br />So something that needed to change the increment type would do it, set the address, and RTS to the number of updates. Where yours would presumably have to jmp to UpdateVRAM, RTS to what would presumably change the increment type, then RTS again to the right number of updates. (Unless you had a change increment type above every number of updates duplicated as well.)<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">so instead of calling the generic byte copy routine 3 times I can make a routine specifically for updating single metatiles, that doesn't JMP back to the NMI handler until it's done with the 3 transfers</div><br />That's more or less what I do for vertical attributes, since they need a new address so often. I have a series of updates in ROM much like your copy32bytes etc that sets $2006 and then writes $2007.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3504&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p155864"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155864">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155864&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155864"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 21, 2015 10:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Kasumi wrote:</div><div class="quotecontent">3 cycles slower per case, but since the extra setup of $2006 at the end is 22 cycles, it'd require more than 8 different update streams before it matters. Then again, I suppose attribute bytes would do that.</div><br />Yeah. Updating the attributes of a column of metatiles requires 4 separate transfers, and then there's obviously the name table data. Based on this I think that it should be fairly common to have more than 8 updates per frame. And when there aren't, the overhead isn't such a big issue, since less updates means more free time which means the wasted cycles are not as important.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">But, because the routine would no longer need to always start from UpdateVRAM, different addresses could be pushed for different types of streams like:</div><br />There's that... Since I figured I could optimize specific types of updates (by not jumping back to UpdateVRAM all the time), the final update count could easily drop below 8, so this is indeed something to consider.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">That's more or less what I do for vertical attributes, since they need a new address so often. I have a series of updates in ROM much like your copy32bytes etc that sets $2006 and then writes $2007.</div><br />I see. Another trick to speed up vertical attribute updates is that you can update 2 bytes per address if you keep the increment 32 mode. Since 32 bytes is the same as 4 attribute rows, for each address you can write 1 attribute byte and the one that comes 4 rows down, so you only have to set the address 4 times for the whole column.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155868"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155868">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155868&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155868"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2015 1:25 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 6834<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Oh, this is pretty clever and cool. A good idea would be to force the &quot;Copy32Bytes&quot; etc.... routines so that their address can be calculated directly from the # of bytes to copy without using a lookup table. Does it allow to update more data than more regular VRAM update systems (i.e. is it faster ?)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p155871"></a>
				<b class="postauthor">Movax12</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155871">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155871&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155871"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2015 2:31 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4680_1345480112.png" width="100" height="33" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 02, 2011 11:50 am<br /><b>Posts:</b> 522
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Movax12 wrote:</div><div class="quotecontent">I wanted it to be easy to hook anything into NMI. I load $0100 and up with the addresses of task I want to complete (minus 1), set the SP and RTS to the first routine. </div><br /><br />Looking at this after some sleep, not sure if I was clear. During &quot;game logic&quot; I can call a macro that adds a new routine to this list in the stack page. In NMI, you swap the SP and start through the list with RTS. I actually have three lists. One is for vram updates - they are called as soon as possible in NMI. Then I have lower priority routines, and a third for things that don't need to be done in any hurry, like read the controller. And if you need to do something once, the routine can remove itself from the list quite easily (if it was added to the list last).<br /><br />So, compared to having some static JSRs in NMI, and/or checking flags to decide what needs to be done (and ignoring the overhead in the &quot;game logic&quot; thread) this is quite fast.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4680&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155877"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155877">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155877&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155877"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2015 7:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">A good idea would be to force the &quot;Copy32Bytes&quot; etc.... routines so that their address can be calculated directly from the # of bytes to copy without using a lookup table.</div><br />Great idea! Since there are 4 bytes of instructions for copying each byte (PLA, STA $XXXX), the offset could be calculated with bit shifts. The only problem is that the less bytes you have, the greater the address, so in addition to being shifted, the number needs to be complemented. Actually, since RTS takes addresses - 1, we can use one's complement instead of two's complement:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;;X = number of bytes to copy<br />&nbsp; &nbsp;lda #&gt;Copy32Bytes ;2<br />&nbsp; &nbsp;pha ;5<br />&nbsp; &nbsp;txa ;7<br />&nbsp; &nbsp;asl ;9<br />&nbsp; &nbsp;asl ;11<br />&nbsp; &nbsp;eor #$ff ;13<br />&nbsp; &nbsp;pha ;16 cycles</div><br />For this to work, Copy32Bytes must be at $XX80. That way, if I want to copy 32 bytes, the result will be: (32 * 4) XOR 255 = $XX7F, exactly 1 less than the start of the byte copy routine. If I want to copy 1 byte, the math is: (1 * 4) XOR 255 = $XXFB, exactly one less than the address of the last copy, which is at $XXFC-$XXFF. It's 2 cyles slower than using the jump table, but you save 64 or 66 bytes.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Does it allow to update more data than more regular VRAM update systems (i.e. is it faster ?)</div><br />Well, the byte copy itself is as fast as it gets without having to resort to ZP or dynamic code, it's the overhead of going from one update to the next that slows things down. I tried to minimize that overhead as much as possible, but it does add up when you have lots of small transfers.<br /><br /><div class="quotetitle">Movax12 wrote:</div><div class="quotecontent">Looking at this after some sleep, not sure if I was clear.</div><br />It was pretty clear to me. <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Did I say anything that sounded like I didn't get it?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p155882"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155882">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155882&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155882"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2015 9:31 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 8981<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK, here's another approach, targeting maximum speed - Create 2 unrolled copy loops:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CopyLoop1:<br />&nbsp; &nbsp;.rept 32<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;.endr<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;rts</div><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CopyLoop2:<br />&nbsp; &nbsp;.rept 32<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;.endr<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;jmp RestoreSP</div><br />The first one is used for all updates except for the last, which uses the second. This means there will be overhead at all (except for setting a new VRAM address, but that's nearly always necessary anyway), since one update jumps directly to the next. It's still customizable, since you jump to routines other than these 2 loops (to change increment modes or fetch data from other sources).<br /><br />The only drawback is that filling the buffer with index addressing becomes a little awkward, since you never know whether an update is the last one when you're buffering it. You'd have to save the index of the address of the most recent update so you can change it to use the second copy routine once all the logic is done and you know that no more updates will be buffered. Filling the buffer with PLA is more straightforward, since the first update you push is always the last one to be executed, so you can just start using the second copy routine and then use the first for all other updates.<br /><br />EDIT: It may seem wasteful to have a second copy routine, but when you consider that it eliminates the need for specialized  routines in certain cases (<s>like the metatiles I mentioned before</s> actually, since metatile updates have fixed lengths, it's still faster to use a custom routine), this might actually be saving storage space.<br /><br />I really liked Movax12's idea of one routine calling the next, so I just took it to the next level.<br /><br />EDIT 2: Actually, if you don't mind the dummy $2006 writes, you can do with just the first routine, and have the RTS break out of the loop, like in my original idea.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d">tokumaru</a> on Tue Sep 22, 2015 9:56 am, edited 4 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p155883"></a>
				<b class="postauthor">Movax12</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p155883">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=155883&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p155883"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 22, 2015 9:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4680_1345480112.png" width="100" height="33" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 02, 2011 11:50 am<br /><b>Posts:</b> 522
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">Movax12 wrote:</div><div class="quotecontent">Looking at this after some sleep, not sure if I was clear.</div><br />It was pretty clear to me. <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Did I say anything that sounded like I didn't get it?</div><br /><br />Not really, but I wasn't sure if I got it after reading it in the morning.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4680&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p156173"></a>
				<b class="postauthor">Sogona</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p156173">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=156173&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p156173"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 27, 2015 8:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jul 23, 2015 7:54 pm<br /><b>Posts:</b> 122
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thank you so much for this, tokumaru. I had originally planned on trying to read 2 bytes of the stack for the $2006 updates, reading another byte for how many bytes to copy, putting that in X, and then using a loop to copy X amount of bytes, and I was gonna try to do this with both palettes, 25 tiles in fixed positions, and then try to squeeze a few more tiles in. I was just waiting until I'd run out of VBlank time. This also made me stop being lazy and learn how the RTS trick works.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7124&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p163800"></a>
				<b class="postauthor">thenewguy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p163800">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=163800&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p163800"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 03, 2016 10:44 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Feb 03, 2016 10:39 pm<br /><b>Posts:</b> 32
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I know that I'm totally resurrecting this, but I thought it was interesting enough that I looked into it. <br /><br />Performance wise, PLA takes 4 cycles. Because of this, using the stack is no faster than using any other memory. So while this method is cool, it would be better to devote non-stack memory to updating nametables UNLESS you're not using the stack very much, and you're not updating the screen with too much information.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7403&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p163801"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p163801">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=163801&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p163801"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 03, 2016 11:00 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 17206<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think one of the advantages of the PLA/STA $2007 loop is that you can determine the point to jump in by shifting the negative number of bytes to the left by 2.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p163802"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p163802">Re: Stack-based VRAM update system</a></div><div style="float: right;"><a href="./viewtopic.php?p=163802&amp;sid=041dfea522ebaa29455a98fd3f1e992d#p163802"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 03, 2016 11:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 2680<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thenewguy wrote:</div><div class="quotecontent">So while this method is cool, it would be better to devote non-stack memory to updating nametables UNLESS you're not using the stack very much, and you're not updating the screen with too much information.</div><br />Or flip that around and get: Use the stack area for PPU update buffers, UNLESS you need most of it for other things (e.g. some recursive algorithm).</div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">Download STREEMERZ for NES from <a href="http://www.fauxgame.com" class="postlink">fauxgame.com</a>! â€” Some other stuff I've done: <a href="https://kkfos.aspekt.fi/" class="postlink">kkfos.aspekt.fi</a></span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 26 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=13285&amp;sid=041dfea522ebaa29455a98fd3f1e992d&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=041dfea522ebaa29455a98fd3f1e992d">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=041dfea522ebaa29455a98fd3f1e992d">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=041dfea522ebaa29455a98fd3f1e992d">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 6 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php?sid=041dfea522ebaa29455a98fd3f1e992d"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="13285" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="041dfea522ebaa29455a98fd3f1e992d" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=041dfea522ebaa29455a98fd3f1e992d" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=12&amp;t=11404" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2015-03-09T19:56:16-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=12&amp;t=11404</id>
<entry>
<author><name><![CDATA[93143]]></name></author>
<updated>2015-03-09T19:56:16-07:00</updated>
<published>2015-03-09T19:56:16-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=142691#p142691</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=142691#p142691"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=142691#p142691"><![CDATA[
<div class="quotetitle">byuu wrote:</div><div class="quotecontent"><br />Given the extremeness of raster effects, I would recommend writing a very specialized, static loop for the active display area. No IRQs, no checking counters. Each line consumes exactly 1324 cycles. Then run your NMI routine (doesn't even have to be a real NMI since you know you're in Vblank now) to do your game logic, then sync up to V=0,H=0 and start the next frame.<br /><br />That will require some learning on your part in how to calculate exact cycle times and penalties. But set an IRQ for V=261,H=~330 or so and then use WAI. Have that bail out so that you're now within 6 clocks of V=0,H=0. You can actually sync perfectly to V=0,H=0 but it's complicated, so you'll have to learn that on your own.<br /></div><br /><div class="quotetitle">93143 wrote:</div><div class="quotecontent"><br />A cycle-timed game engine (or part of it) could be the best of both worlds.<br /></div><br />Okay, so I tried the static loop thing over the weekend, and it doesn't seem to work properly if I use mostly fast cycles (the mode switch point drifts by an average of no less than one master cycle per scanline).  Using mostly slow cycles, if I'm careful with the position of the fast cycles (ie: where I put the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">nop</tt>es in relation to the time-delay loop) I can nail it and get a wobbly equilibrium.<br /><br />That's right, wobbly.  The position of the switch is different on every scanline except the first, and changes every frame.  This is with the first scanline perfectly synchronized and rock solid every frame (at least in higan where I can actually see the blasted thing), using an interrupt designed to exit at a constant dot position given an entry point anywhere in a particular eight-pixel range.<br /><br />The interaction with the DRAM refresh and/or the HDMA seems to be really finicky.  I suspect I won't be drawing any text boxes with the brightness register, and I may well end up just using an H-interrupt for the mode switch.<br /><br />...<br /><br />Though there <em>was</em> a tantalizing scenario I ran across where some frames had a ~1-dot offset per scanline, resulting in a diagonal seam, but other frames were perfectly synchronized with no wobble (after a slight offset between the second and third scanlines)...  maybe it <em>is</em> possible to figure this out, and maybe even write game logic around the timing events...  I'd have to have separate game engines for launch model and later-model decks, though, because IIRC they changed how the DRAM refresh works...  and this is starting to sound like a recipe for never getting the game done...<br /><br />...<br /><br />Also, I added a column of sprites to mask the garbage.  For some reason I don't see any artifacting; those infamous flecks don't show up even when I set colour #0 to bright green and the constant colour to bright red <em>and</em> change the mode switch to target Mode 2 instead of Mode 1...  Maybe I should change the colour of the sprite mask; it's kinda dark on a real CRT...  It would be great if the flecks didn't show up in the final game, but why wouldn't they when they do in the Anthrox cracktro?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6595">93143</a> — Mon Mar 09, 2015 7:56 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Augustus Blackheart]]></name></author>
<updated>2014-08-26T10:07:59-07:00</updated>
<published>2014-08-26T10:07:59-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133100#p133100</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133100#p133100"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133100#p133100"><![CDATA[
<div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />This demo shows that the black flecks (blue flecks in this demo) are where mode 2 is bleeding through the sprite layer.<br /></div><br /><br />Not really mode 2 or mode 7 bleeding through exactly, but at the point where mode 2 and 7 intersect those flecks show up and they are whatever the background color is.  I'm not seeing the flecks changing color when the mode 7 logo goes under those spots.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6621">Augustus Blackheart</a> — Tue Aug 26, 2014 10:07 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[93143]]></name></author>
<updated>2014-08-26T01:01:00-07:00</updated>
<published>2014-08-26T01:01:00-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133084#p133084</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133084#p133084"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133084#p133084"><![CDATA[
<div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><br />I could send you some money via PayPal, enough to cover the costs of a Super Everdrive + S/H and you could get it yourself.<br /></div><br />Sure, that works.  I've PMed you.<br /><br />I'm not actually all that worried about trustworthiness - you do look like a reliable character, as much as an online presence can.  It's mostly a formality, since you can never be too careful on the internet etc....<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />It's hard for me to tell if your mtest_* stuff has the same behaviour as Pan's demo, re: black specks.<br /></div><br />I don't think it does.  The specks seem to show up on the sprite layer when it's used to mask the garbage in the BG layers that results from the mode switch; I wanted to see what the background layers did, so I didn't use a sprite mask.  That flickering black area in my test is uncensored.<br /><br />There are only three tiles in my tests - the colourful Mode 7 tile (which is zoomed in 2x), the partly-transparent Mode 1 numeral tile (BG1), and the blue textured Mode 1 backdrop tile (BG2).  All three tiles are mapped to every entry in their respective tilemaps (which is really easy since they're all tile #0).  Anything else that shows up on the screen is garbage - I suspect that area is mostly black in my case because the VRAM is mostly empty...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />I sincerely do not think the SNES initialisation code is what's responsible for the &quot;speck&quot; problem.<br /></div><br />I'm with you there.  I think the specks would show up regardless.  But the speck pattern has been observed to change between runs, and I thought <em>that</em> might be related to initialization.  After what tepples said about the NES, though, I'm not so sure that's the explanation - it could be unavoidable hardware behaviour:<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />A properly-initialized NES can start in one of four relative alignments between the CPU and PPU. The Super NES may have more or fewer, given the phase of the DMA unit.<br /></div><br /><br /><div class="quotetitle">Augustus Blackheart wrote:</div><div class="quotecontent"><br />Here's a modified version of Pan's horizontal split demo.<br /></div><br />Cool.  I know the results I'm getting from higan aren't exactly correct (and my laptop is too slow to run it at full speed, so the music crackles), but I can still see most of what you're talking about.<br /><br />I think I'll still enhance my test code, simply because I need to learn how to do all this.  But apparently there's no rush...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />This demo shows that the black flecks (blue flecks in this demo) are where mode 2 is bleeding through the sprite layer.<br /></div><br />Okay, so there may actually be a way to jigger this so the flecks are fairly unobtrusive.  I mean, they're already fairly unobtrusive compared with the mess underneath the sprite mask, but if they could be made to appear in a similar colour to the sprite mask itself, they'd be almost invisible...<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6595">93143</a> — Tue Aug 26, 2014 1:01 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Augustus Blackheart]]></name></author>
<updated>2014-08-26T10:09:00-07:00</updated>
<published>2014-08-24T15:17:32-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133023#p133023</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133023#p133023"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133023#p133023"><![CDATA[
Here's a modified version of Pan's horizontal split demo.<br /><br />Press left or right  to decrease where the horizontal split happens.  Press up or down to move the sprites left or right. Press select to toggle the sprite layer.  Press A to toggle vertical  plasma and b to toggle horizontal plasma.  Press Y or X to decrease or increase the raster split.  Press L to change the background color.  Press R to reset to defaults. (Some of the toggles will mess up the timing for the scroll text).<br /><br />This demo shows that the black flecks (blue flecks in this demo) are where mode 2 is bleeding through the sprite layer.<br /><br />If nobody beats me to it I'll get a video posted soon.<br /><br /><a href="http://www.morganleahrecords.com/augustus/blackheart/rom/horiz.sfc" class="postlink">http://www.morganleahrecords.com/augustus/blackheart/rom/horiz.sfc</a><br /><br />Another interesting thing, now that I've changed the sprites, is that the 40 pixels of junk is part of the sprite layer.  If you move the horizontal split close to the right edge of the screen it will settle down and you can clearly see a copy of the sprite layer.<br /><br />edit: updated to add ability to increase or decrease sprite xpos, change background color, raster split<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6621">Augustus Blackheart</a> — Sun Aug 24, 2014 3:17 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Augustus Blackheart]]></name></author>
<updated>2014-08-24T10:06:28-07:00</updated>
<published>2014-08-24T10:06:28-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133012#p133012</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133012#p133012"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133012#p133012"><![CDATA[
<div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><br />I don't know why you disabled sprites (or how you did that on the hardware; or maybe you just modified the demo source?), but your subsequent line states clearly that with sprites enabled the black dots (like in my video) are visible for you too, which means this is not an issue specific to my SNES or my setup.<br /></div><br />I just used a hexeditor to change the value being written to REG_TM.  When I'm not working on other projects I plan on trying various modifications to the source to see if I can get anything useful or interesting to happen.  <br /><br /><div class="quotetitle">byuu wrote:</div><div class="quotecontent"><br /><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">the &quot;black static&quot; in Pan's demo tends to change its size and location (horizontally within the &quot;ATX&quot; logo) every time I power-cycle and run the demo<br /></div><br />Looks to be right where DRAM refresh tends to hang around, too. I know that tends to darken the image for some people in the middle of the screen, <strong>but haven't seen anything like what you are getting.</strong></div><br />My SNES darkens in the middle of the screen.  A lot.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6621">Augustus Blackheart</a> — Sun Aug 24, 2014 10:06 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2014-08-24T02:39:17-07:00</updated>
<published>2014-08-24T02:39:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133002#p133002</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133002#p133002"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=133002#p133002"><![CDATA[
I don't know why you disabled sprites (or how you did that on the hardware; or maybe you just modified the demo source?), but your subsequent line states clearly that with sprites enabled the black dots (like in my video) are visible for you too, which means this is not an issue specific to my SNES or my setup.  This is all mainly in response to this:<br /><br /><div class="quotetitle">byuu wrote:</div><div class="quotecontent"><br /><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">the &quot;black static&quot; in Pan's demo tends to change its size and location (horizontally within the &quot;ATX&quot; logo) every time I power-cycle and run the demo<br /></div><br />Looks to be right where DRAM refresh tends to hang around, too. I know that tends to darken the image for some people in the middle of the screen, <strong>but haven't seen anything like what you are getting.</strong></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Sun Aug 24, 2014 2:39 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Augustus Blackheart]]></name></author>
<updated>2014-08-24T00:32:44-07:00</updated>
<published>2014-08-24T00:32:44-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132998#p132998</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132998#p132998"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132998#p132998"><![CDATA[
<div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><br />Augustus, is it possible to get a recording of you running MODE7.SMC on your setup?<br /></div><br />This is a new video of the original anthrox demo with sprites disabled.  It is hard to tell with the mess going on in the middle but the black specks do not appear to be visable when the sprite layer is disabled.<br /><br />I don't have a video yet with sprites enabled but I can confirm that the black dots are visable.<br /><br /><a href="http://www.morganleahrecords.com/augustus/blackheart/tmp/horiz_nospr.mp4" class="postlink">http://www.morganleahrecords.com/augustus/blackheart/tmp/horiz_nospr.mp4</a><br /><br />edit: That file is kind of large at 36MBytes...<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6621">Augustus Blackheart</a> — Sun Aug 24, 2014 12:32 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-08-23T18:15:58-07:00</updated>
<published>2014-08-23T18:15:58-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132995#p132995</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132995#p132995"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132995#p132995"><![CDATA[
<div class="quotetitle">93143 wrote:</div><div class="quotecontent"><br />I would expect a properly-initialized SNES to behave deterministically.<br /></div><br />A properly-initialized NES can start in one of four relative alignments between the CPU and PPU. The Super NES may have more or fewer, given the phase of the DMA unit.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />I don't have an S-video cable, but they're dirt cheap and the TV does have the appropriate hookups, so maybe I should consider getting one...<br /></div><br />Yeah, for anything 480i, S-Video is going to be very nearly as good as component/RGB.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Speaking of strangers, how would you propose to execute such a donation without potentially compromising either of our personal data?<br /></div><br />That depends on what you consider &quot;personal data&quot;.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Aug 23, 2014 6:15 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2014-08-23T17:42:27-07:00</updated>
<published>2014-08-23T17:42:27-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132994#p132994</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132994#p132994"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132994#p132994"><![CDATA[
Just a brief follow-up:<br /><br />I hooked my SNES up to my Dell 2407WFP.  It shows the &quot;black specks&quot; as well, which means it isn't my capture device.  I recorded some videos using my crappy point-and-shoot camera in 60fps, recording the Dell monitor.  Camera will only record up to 60 seconds, and I can't adjust focus or zoom once recording, sorry.<br /><br /><ul><li><a href="https://www.dropbox.com/s/gngxtiji5s2kr17/MVI_2425.XviD.avi?dl=0" class="postlink">MVI_2425.XviD.avi</a> -- MODE7.SMC (Pan of Anthox demo) -- 320x240, XviD quality 7500, no audio, 25.4MBytes</li><li><a href="https://www.dropbox.com/s/wdy453e2s16qdks/MVI_2426.XviD.avi?dl=0" class="postlink">MVI_2426.XviD.avi</a> -- MODE7.SMC (Pan of Anthox demo) -- 320x240, XviD quality 7500, no audio, 26.8MBytes</li></ul><br />The 1st recording shows that the &quot;black specks&quot; basically shifting up and down a pixel (possibly half a pixel), in a column along the left side of the ATX logo.  There's similar gobbledegook at the top of the logo.  Near the end I hardware reset (not power-cycle) the SNES, and the pattern/rate at which the &quot;specks&quot; move changes.<br /><br />The 2nd recording is after a full power-cycle (although I've gotten this to happen after a hardware reset as well, it just varies).  The &quot;black specks&quot; are in two columns.  Mid-way I power-cycle the console again, and get the same two-columns-of-specks issue, but the pattern/rate at which the &quot;specks&quot; move changes (shifting/jiggling up and down rapidly).<br /><br />I may invest in another SNES just to rule out some hardware inside flaking out (I've had this unit since my childhood), but I don't see this kind of behaviour in any commercial carts, ditto with games loaded via the SD2SNES.  Presently I'm of the firm opinion that this is just some kind of side-effect of mid-scanline MODE changing.  Obviously more testing is needed, so the more folks who can test this out on actual hardware the better.<br /><br />Augustus, is it possible to get a recording of you running MODE7.SMC on your setup?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Sat Aug 23, 2014 5:42 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2014-08-23T16:49:12-07:00</updated>
<published>2014-08-23T16:49:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132993#p132993</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132993#p132993"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132993#p132993"><![CDATA[
I could send you some money via PayPal, enough to cover the costs of a Super Everdrive + S/H and you could get it yourself.  Alternately I could buy one, test it/make sure it works, and then ship it to you, but that'd require me having your mailing address.  The former is a lot less invasive, and just requires me to know your PayPal address (you can PM it to me).  I'm sure we can work something out!<br /><br />If you're worried about trustworthiness, there are lots of folks here who I'm sure can attest to the fact that I respect people's privacy -- ex. I just got some Famicom stuff from mikejmoffitt in the mail today, Zycrow and I shipped things back/forth a lot in <a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=11202" class="postlink">this thread</a>, I sent a non-working SWC DX off to Ramsis (per this thread) not too long ago, and I help admin the forum.  There's also the data point that I ran Parodius for nearly 20 years, and we had to have contact info for all the folks who had accounts... :-)<br /><br />As for the rest of the post:<br /><br />- It's hard for me to tell if your mtest_* stuff has the same behaviour as Pan's demo, re: black specks.  Possibly the white/grey &quot;specks&quot; in yours are effectively the same thing as the black specks in Pan's, I really don't know.  Your mtest_* stuff tends to have some black areas where the mode transition takes place (shown in yellow <a href="http://forums.nesdev.com/viewtopic.php?p=131627#p131627" class="postlink">here</a>, and shown with black-grey lines <a href="http://forums.nesdev.com/viewtopic.php?p=131822#p131822" class="postlink">here</a>), while Pan's has a definitive (non-black) ATX logo (using sprites I believe), so it's easier to see the &quot;specks&quot;.<br /><br />- I'm going to try to rule out the &quot;black specks&quot; (in Pan's demo) being either specific to my capture device (anything is possible) by checking on an actual display.  The only display I have that does S-Video input is my Dell 2407FWP monitor, and the hardware deinterlacing it does isn't the best in the world.  But let's just say I wouldn't be surprised if it turned out to be some silliness with my capture device.  I suppose alternately I could just use composite out and hook it up to my CRT directly + record that with my crappy point-and-shoot camera (which can do 60fps, oddly enough).<br /><br />- I sincerely do not think the SNES initialisation code is what's responsible for the &quot;speck&quot; problem.  My own opinion is that it's a direct result of changing MODE mid-scanline (while electron gun is drawing) -- my guess is that the PPU and related circuitry ends up reading gobbledegook from somewhere during the short period of time (not sure how long) it takes for the PPU to actually &quot;fully&quot; switch modes.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Sat Aug 23, 2014 4:49 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[93143]]></name></author>
<updated>2014-08-23T16:01:22-07:00</updated>
<published>2014-08-23T16:01:22-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132990#p132990</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132990#p132990"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132990#p132990"><![CDATA[
<div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><br />Re: black flecks: which video are you referring to (there are &quot;black dots&quot; in all of them in some manner of speaking <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=";-)" title="Wink" /> )?  I'm going to assume you're referring to Pan's demo -- if so, they're the same height as the &quot;white/grey flecks&quot; in mtest_scroll and mtest_reverse.  My gut instinct is that these are probably the screen artefacts previously discussed when changing video modes mid-scanline.<br /></div><br />Yeah, I meant Pan's demo.  We kinda knew the BG layers filled with garbage for a bit while the PPU was getting its bearings in the new mode (you can see this plainly in my test, as well as the sprite-free version of the Anthrox demo Augustus posted earlier), but I at least didn't expect the sprite layer to show any artifacts.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Re: black flecks moving horizontally between power cycles: I doubt this has to do with your SNES init code -- as I said it happens on Pan's demo as well.  It's probably just a timing thing combined with the mid-scanline $2105 adjustment.<br /></div><br />I would expect a properly-initialized SNES to behave deterministically.  Maybe I'm just a sucker...<br /><br />But I wasn't referring to my code.  I don't know if my code does that; I was referring to what you said you'd observed in the Anthrox demo, which I haven't checked to see if it initializes properly (it would take a while, at my level of expertise...).<br /><br />...wait, are you saying it <em>does</em> happen with my code too?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />If you want original non-deinterlaced video (but still in XviD format), I can do another recording.<br /></div><br />No, that's fine.  The apparent pixel size of the black flecks was just weirding me out/giving me vague hope that they wouldn't show up well on a CRT.  It's probably a compression artifact or something - I don't know what else could possibly cause this - but they really do look half-height...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />they're overpriced for no legit reason I can think of and I'm inclined to say &quot;not worth it&quot;.<br /></div><br />Yeah, I checked a bit myself, and it looked like the market price was north of $70, which informed my response.  I'd tend to agree with you here.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />So here's my question for you: how exactly are you testing the code you're writing?  Are you using emulators exclusively?  Do *YOU* have a CRT and a SNES?  <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=";-)" title="Wink" /><br /></div><br />Higan v094 accuracy core (when necessary; bsnes v072 compatibility core when not), yes (for testing, at least), and yes.  I don't have a flash cart or any sort of copier, and I don't have any digital video capture hardware or even a decent camera, but I do have a working deck w/power supply and composite cable, two working controllers (oh wait - my little brother borrowed one), a real TV (not one of these newfangled Back To The Future jobs that can't handle real game consoles properly), and a bunch of games.  I don't have an S-video cable, but they're dirt cheap and the TV does have the appropriate hookups, so maybe I should consider getting one...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />I would be willing to donate some money to getting you a <a href="http://www.gamersection.com/product_info.php?cPath=51&amp;products_id=1084" class="postlink">Super EverDrive</a> not the v2 unit -- seems nobody has stock of those right now) as my way of saying &quot;kudos to someone still developing stuff on the SNES!&quot;  It'd at least get you started and working on real hardware.<br /></div><br />...wow.  That's very generous of you, on top of all the procurement you've done already.<br /><br />Getting started on real hardware would be great; I could fiddle around with stuff like this with low latency and without leaning on strangers I meet on the 'net every time I want to change something.  I could also see what the graphics assets look like on a real TV; bsnes with blargg's NTSC filter is close, but not close enough, and I suspect that engaging byuu's gamma ramp too is giving me a bit of double-counting...<br /><br />Speaking of latency, that would be another advantage - gameplay just isn't the same in an emulator, unless you're playing SimCity or something...<br /><br />Speaking of strangers, how would you propose to execute such a donation without potentially compromising either of our personal data?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6595">93143</a> — Sat Aug 23, 2014 4:01 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-08-23T11:35:41-07:00</updated>
<published>2014-08-23T11:35:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132976#p132976</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132976#p132976"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132976#p132976"><![CDATA[
<div class="quotetitle">Sik wrote:</div><div class="quotecontent"><br />As far as I know, copy protection is done by putting garbage dots inside vblank area, which results in naive recording hardware to get jammed (e.g. the autoadjusting recording hardware in VHS players).<br /></div><br />This is true of gain control copy protection. But there's also a later method called &quot;four-line colorstripe&quot; that most &quot;video stabilizer&quot; boxes can't remove, in which the horizontal positioning of the colorburst varies slightly throughout a frame. (<a href="https://w2.eff.org/IP/DMCA/Macrovision_v_321Studios/20030320_Macrovision_APS.pdf" class="postlink">Source, PDF</a>)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Aug 23, 2014 11:35 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Sik]]></name></author>
<updated>2014-08-23T02:23:30-07:00</updated>
<published>2014-08-23T02:23:30-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132971#p132971</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132971#p132971"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132971#p132971"><![CDATA[
Forgot to comment on this (whoops)<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />But my DVD recorder doesn't like it very well. I wonder if its PPU2v1 is part of this. Reportedly the PPU2v1 puts out an even more nonstandard* signal than the more common PPU2v3, and the DVD recorder might be confusing the nonstandard qualities of its composite output with copy protection used on major studio movies.<br /></div><br />As far as I know, copy protection is done by putting garbage dots inside vblank area, which results in naive recording hardware to get jammed (e.g. the autoadjusting recording hardware in VHS players). I know this actually happens to be a serious issue with Mega Drive games because CRAM dots often get mistaken to be copy protection by some devices =P<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4526">Sik</a> — Sat Aug 23, 2014 2:23 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[byuu]]></name></author>
<updated>2014-08-22T10:39:17-07:00</updated>
<published>2014-08-22T10:39:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132936#p132936</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132936#p132936"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132936#p132936"><![CDATA[
&gt; Well, my guess was that the mode 7 deformation calculations would not be performed outside mode 7<br /><br />Correct. So far I'm doing the actual multiplication on each pixel instead of adding a step per pixel and only multiplying once per scanline start. Just haven't gotten to adapting anomie's algorithm for single-stepping yet. It really is early days with dot-based rendering, if that wasn't obvious enough by now. So yeah, don't use mode 7 on the right side of a horizontal-split mode. Although you probably could make it work anyway if you timed things just right (eg let it run in mode7 for the initial multiplication.)<br /><br />&gt; mode7.XviD.avi -- MODE7.SMC (Pan of Anthrox demo) -- 720x480, deinterlaced, XviD quality 7500, no audio, 10.2MBytes<br /><br />Thanks a bunch for making this! I feel bad being so lazy, given I have an sd2snes myself. Just ... don't want to dig out all my kit for SNES dev right now.<br /><br />Good news is we are getting the offset-per-tile effect correct now under emulation. Hooray.<br /><br />&gt; the &quot;black static&quot; in Pan's demo tends to change its size and location (horizontally within the &quot;ATX&quot; logo) every time I power-cycle and run the demo<br /><br />Looks to be right where DRAM refresh tends to hang around, too. I know that tends to darken the image for some people in the middle of the screen, but haven't seen anything like what you are getting.<br /><br />&gt; I can invest in a SNES Jr. and see if there are any differences if needed.<br /><br />I haven't done extensive raster effects testing with an SNES Jr. But I did run my &quot;write out text using only $2100 INIDISP brightness changes&quot; demo, and Air Strike Patrol (before I knew about the BG3 text raster effect.)<br /><br />Both had the same issue: the shadowing seemed to be seriously diluted. Where my letters were pitch black on a classic SNES, they were light gray on the SNES Jr, and their positions were shifted off somewhat. Not a brightness issue, I had 75ohm resistors on the RGB lines (modded it to output raw RGB. Real fun trying to solder onto that tiny S-ENC chip.)<br /><br />I often say the SNES Jr is more like a console clone than a revision. May be a bit overly harsh compared to the reality, but I felt it was really shady the way they didn't bump the chip revision# s, yet changed a bunch of things (PPU raster stuff, SMP timer glitch fixes, etc.) I haven't done super extensive testing, but every time I do any kind of deep testing, I spot a new difference. There's probably a ton more we don't know about, even if that's conjecture for now.<br /><br />It's also neutered: no underside expansion port, no fun cart ejection, no power LED, what I want to call maliciously disconnected multi-out lines, etc. It does have one amazing picture, though. Equal to the final full-size SNES revision, which is hard to find since sellers don't know/list motherboard revisions.<br /><br />&gt; I believe he only ended up accurately emulating that because Taz-Mania relied on it to work (and/or because blargg reverse-engineered it), and this looks even more complicated...<br /><br />What you need to understand about my methodology is that I don't avoid things until they are required: I avoid doing things that I don't know of any software doing, and as a result of that I can't test at all. Because every time I write untested code paths, they have serious bugs.<br /><br />It just turns out that having a real-world example of a given behavior gives us something to verify that we're at least more right than we were before.<br /><br />&quot;But you could write the tests!&quot;, yeah if I didn't already have hundreds of other things I needed to be doing. And I did that for a whole lot of behaviors that nothing ever relies on: like VIRQ off-by-one glitch on the first frame after power-on, IRQ I/O-&gt;read cycle penalty on 2-cycle instructions, DMA&lt;&gt;CPU sync, HDMA channel 7 short-circuit glitch, weird double-height sprite glitch, etc. (if you want details, read higan source, I don't recall them well enough offhand.)<br /><br />If someone wrote a test ROM that relied on starting a multiplication during a division and reading out the half-multiplied, half-divided, clusterfuck bits ... I would not be emulating that. Not even if d4s used it for an emulator check screen :P<br /><br />I already failed to figure out the regular MUL/DIV partial computation bits. Thankfully blargg cracked that algorithm for us.<br /><br />&gt; and this looks even more complicated...<br /><br />If you really want to be &quot;a dick&quot;, mess with the PPU multiplication registers (different from the CPU ones) while displaying mode 7 data. Obviously the PPU is going to be using that hardware during mode7 rendering. Who knows what will happen when you fuck with it yourself.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=375">byuu</a> — Fri Aug 22, 2014 10:39 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-08-22T07:16:54-07:00</updated>
<published>2014-08-22T07:16:54-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132923#p132923</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132923#p132923"/>
<title type="html"><![CDATA[Re: BGMODE or parameter changes during scanline]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11404&amp;p=132923#p132923"><![CDATA[
I have a PowerPak with Simba firmware and a launch Super NES!!!!1/1/1<br /><br />But my DVD recorder doesn't like it very well. I wonder if its PPU2v1 is part of this. Reportedly the PPU2v1 puts out an even more nonstandard* signal than the more common PPU2v3, and the DVD recorder might be confusing the nonstandard qualities of its composite output with copy protection used on major studio movies.<br /><br /><br /><span style="font-size: 85%; line-height: normal">* Grammar Nazis shut up.</span><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Aug 22, 2014 7:16 am</p><hr />
]]></content>
</entry>
</feed>
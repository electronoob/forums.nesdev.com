<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - intro storyline</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Newbie Help Center" href="http://forums.nesdev.com/feed.php?f=10" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - intro storyline" href="http://forums.nesdev.com/feed.php?f=10&amp;t=1833" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '3');
	var per_page = '15';
	var base_url = './viewtopic.php?f=10&amp;t=1833';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 8:19 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=10&amp;t=1833&amp;start=30">intro storyline</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=1833"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 56 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=10&amp;t=1833&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=10&amp;t=1833">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=1833&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=1833&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=1833&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=10&amp;t=1833&amp;start=30&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=10&amp;t=1833&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=10&amp;t=1833&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15862"></a>
				<b class="postauthor" style="color: #AA0000">Memblers</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15862"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15862#p15862"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 31, 2006 11:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=10.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 20, 2004 6:04 am<br /><b>Posts:</b> 2711<br /><b>Location:</b> Indianapolis
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sounds odd.  I'm not sure what's going on then.  Posting the new code (or editing the previous post with it) might shed some light (include the full NMI routine also).
<br />
<br />Often a good thing to do in cases like this is step through the code with a debugger and see what happens there.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=10"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15869"></a>
				<b class="postauthor">lynxsolaris</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15869"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15869#p15869"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 5:52 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=284.gif" width="18" height="34" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jan 17, 2006 10:39 am<br /><b>Posts:</b> 143<br /><b>Location:</b> North Carolina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Memblers wrote:</div><div class="quotecontent">Sounds odd.  I'm not sure what's going on then.  Posting the new code (or editing the previous post with it) might shed some light (include the full NMI routine also).<br /></div>
<br />
<br />
<br />Memblers,
<br />
<br />Here is the code in its entirety:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />&nbsp;.inesprg&nbsp; &nbsp;1<br />&nbsp;.ineschr&nbsp; &nbsp;1<br />&nbsp;.inesmap&nbsp; &nbsp;0<br />&nbsp;.inesmir&nbsp; &nbsp;1<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;.zp<br />text_flag = $00<br />&nbsp;<br />&nbsp;.bss<br />&nbsp;<br />&nbsp;<br />&nbsp;.code<br />&nbsp;.org $8000<br />&nbsp;.bank 0<br />&nbsp;<br />reset: <br />&nbsp;sei<br />&nbsp;cld<br />&nbsp;<br />&nbsp;ldx #$40<br />&nbsp;stx $4017<br />&nbsp;<br />&nbsp;ldx #$ff<br />&nbsp;txs<br />&nbsp;inx<br />&nbsp;stx $2000<br />&nbsp;stx $2001<br />&nbsp;ldx #$99<br />&nbsp;stx text_flag<br />&nbsp;<br />&nbsp;jsr wait_vblank<br />&nbsp;jsr wait_vblank<br />&nbsp;<br />&nbsp;;load color palette first<br />&nbsp;lda #$3F<br />&nbsp;sta $2006<br />&nbsp;lda #$00<br />&nbsp;sta $2006<br />&nbsp;<br />&nbsp;ldx #$00<br />loop_pal:<br />&nbsp;lda color_pal,X<br />&nbsp;sta $2007<br />&nbsp;inx<br />&nbsp;cpx #$10<br />&nbsp;bne loop_pal<br />&nbsp;<br />&nbsp;<br /><br />&nbsp;lda #$20<br />&nbsp;sta $2006<br />&nbsp;lda #$84<br />&nbsp;sta $2006<br />&nbsp;<br />&nbsp;<br />&nbsp;; text demo will display &quot;A&#40;0B&#41; B&#40;0C&#41;&quot;<br /><br />&nbsp;<br />&nbsp;lda #$0B<br />&nbsp;sta $2007<br />&nbsp;<br />&nbsp;lda #$00<br />&nbsp;sta $2006<br />&nbsp;sta $2006<br />&nbsp;<br />&nbsp;lda #%10001000<br />&nbsp;sta $2000<br />&nbsp;lda #%00011000<br />&nbsp;sta $2001<br /><br />wait_again:<br />&nbsp;lda text_flag<br />&nbsp;cmp #$00<br />&nbsp;bne wait_again<br />&nbsp;lda #$99<br />&nbsp;sta text_flag<br />&nbsp;<br />&nbsp;<br />&nbsp;lda #$00<br />&nbsp;sta $2000<br />&nbsp;sta $2001<br /><br /><br /><br />&nbsp;lda #$20<br />&nbsp;sta $2006<br />&nbsp;lda #$85<br />&nbsp;sta $2006<br />&nbsp;<br />&nbsp;lda #$0C<br />&nbsp;sta $2007<br />&nbsp;<br />&nbsp;lda #$00<br />&nbsp;sta $2006<br />&nbsp;sta $2006<br />&nbsp;<br /><br />&nbsp;<br />&nbsp;lda #%10001000<br />&nbsp;sta $2000<br />&nbsp;lda #%00011000<br />&nbsp;sta $2001<br />&nbsp;<br />&nbsp;text_end:<br />&nbsp; jmp text_end <br />&nbsp;<br />&nbsp;<br />&nbsp;<br />&nbsp;<br />wait_vblank:<br />&nbsp;bit $2002<br />&nbsp;bpl wait_vblank<br />&nbsp;rts<br />&nbsp;<br />&nbsp;color_pal:<br />&nbsp; .db $0D,$30,$22,$16,$0D,$00,$10,$30,$0D,$00,$16,$30,$0D,$3C,$1B,$09<br />&nbsp;<br />nmi:<br />&nbsp;lda #%10010000<br />&nbsp;sta $2000<br />&nbsp;dec text_flag<br /><br />&nbsp;int:<br />&nbsp; rti<br />&nbsp; <br />&nbsp;.bank 1<br />&nbsp;.org $fffa<br />&nbsp;.dw reset,nmi,int<br />&nbsp;<br />&nbsp;.bank 2<br />&nbsp;.org $0000<br />&nbsp;.incbin &quot;text.chr&quot;<br /></div>
<br />
<br />Thanks for your help.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=284"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15872"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15872"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15872#p15872"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 10:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 5143<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Your NMI routine modify the content of the accumulator. You should save at least your accumulator on the stack and I'd reccomand to save X and Y too, in case you modify the NMI routine to use code with the use of X and Y registers, then restore all these register at the end of the NMI routine, in order to not have the accumulator randomly changed in the main code by the interrupt, that can happen ANYTIME you enabled it.
<br />
<br />The cmp #$00 instruction is useless, because when loading the value in the accumulator, the Z flag is automatically set if the value loaded is zero, so you can just delete this line and this won't affect anything, saving you two bytes.
<br />
<br />I have no idea why you write twice to $2006 after writing one name table byte, you'd better write twice to $200<strong>5</strong> in order to proprely reset the scrolling registers.
<br />Also, I'd put a value lower than $99 in your wait timer, because $99 is several second long and you would want less time as far as I understand.
<br />I'd also do a decent programm that writes the content of a text buffer to the screen with VBlank interval and a decent programm that fill the buffer with $0b, $0c, $00 (for example, assuming that $00 marks the end) and call for the first routine. This would structure your code in a decent way and make your life easier.</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15875"></a>
				<b class="postauthor">lynxsolaris</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15875"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15875#p15875"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 1:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=284.gif" width="18" height="34" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jan 17, 2006 10:39 am<br /><b>Posts:</b> 143<br /><b>Location:</b> North Carolina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">The cmp #$00 instruction is useless, because when loading the value in the accumulator, the Z flag is automatically set if the value loaded is zero, so you can just delete this line and this won't affect anything, saving you two bytes.<br /></div><br />Yeah, that was dumb of me.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I have no idea why you write twice to $2006 after writing one name table byte, you'd better write twice to $200<strong>5</strong> in order to proprely reset the scrolling registers.<br /></div><br /><br />I've been doing this because its the only way I could get my character to show up @ all.....  I <strong>MUST</strong> be doing something wrong.  $2005x2 writes aren't working for me.  With <strong>just</strong> writes to $2005 my "A" (or "B") isn't displayed.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Also, I'd put a value lower than $99 in your wait timer, because $99 is several second long and you would want less time as far as I understand.<br /></div><br /><br />I put it that high just so I'd actually see it happen.  See the code I posted in this thread is just test code.  I wouldn't actually do it exactly like that in my real code.  But my problem here is that "B" is never displayed.  It's like I never get past the <strong>wait_again</strong> loop. <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'd also do a decent programm that writes the content of a text buffer to the screen with VBlank interval and a decent programm that fill the buffer with $0b, $0c, $00 (for example, assuming that $00 marks the end) and call for the first routine. This would structure your code in a decent way and make your life easier.</div><br /><br />Yeah, again, just test code <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Your NMI routine modify the content of the accumulator. You should save at least your accumulator on the stack and I'd reccomand to save X and Y too, in case you modify the NMI routine to use code with the use of X and Y registers, then restore all these register at the end of the NMI routine, in order to not have the accumulator randomly changed in the main code by the interrupt, that can happen ANYTIME you enabled it. <br /></div>
<br />
<br />Do you think this is why I'm having problems?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=284"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15876"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15876"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15876#p15876"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 1:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 5143<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm not sure, because when NMI is SUPPOSED to hit, you're just looping if a is nonzero, and if A contain the value written to $2000 instead, the branch happen anyways, so I'm unsure if your problems are caused by this or not, but anyway you must save all register you modify in your NMI routine, just because it doesn't always hit when it is supposed too, and that shouldn't crash your programm.
<br />I don't see any other error, but maybe by doing a more decent structured programm that doesn't write the hard-wired letter "A" and "B", but that can write any message and another that order it to write "AB", then you must have less problems figuring your bugs. I'd highly reccomand directly tring to code the routine you want to be coded, even for test purposes.
<br />
<br />Oh by the way you souldn't use $0d as black, but $0e or $0f because $0d will output noncorrect color voltage to the TV. This shouldn't cause problems with emulators, tough.
<br />
<br />Finally, you should "bit $2002" in your NMI, to clear the VBlank flag, to avoid another NMI to be triggered as soon as the first one exits.</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15877"></a>
				<b class="postauthor" style="color: #AA0000">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15877"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15877#p15877"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 2:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1028
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">Finally, you should "bit $2002" in your NMI, to clear the VBlank flag, to avoid another NMI to be triggered as soon as the first one exits.</div>
<br />
<br />That is incorrect - the <strong>only</strong> thing that would cause a repeat NMI in such a circumstance is if you were to clear and then re-set the NMI enable flag in $2000. Remember, NMIs are <em>edge</em>-triggered, unlike IRQs (which are level-triggered).</div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15878"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15878"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15878#p15878"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 2:32 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 5143<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Remember, NMIs are edge-triggered, unlike IRQs (which are level-triggered).</div>
<br />For some reasong I was under the beliving of the other way arround.
<br />So yeah, I still have the habbit to use $2002 at the begining of VBlank, but this may not be necessary.</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15879"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15879"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15879#p15879"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 2:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I would still recommend doing the "bit $2002" in NMI.  If nothing else it will reset the $2005/$2006 toggle and clear the VBlank flag so that if you do happen to disable and re-enable NMIs in the same VBlank, you won't run into a problem.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15881"></a>
				<b class="postauthor">lynxsolaris</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15881"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15881#p15881"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 3:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=284.gif" width="18" height="34" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jan 17, 2006 10:39 am<br /><b>Posts:</b> 143<br /><b>Location:</b> North Carolina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Quietust wrote:</div><div class="quotecontent">That is incorrect - the <strong>only</strong> thing that would cause a repeat NMI in such a circumstance is if you were to clear and then re-set the NMI enable flag in $2000. Remember, NMIs are <em>edge</em>-triggered, unlike IRQs (which are level-triggered).</div><br /><br /><br /><div class="quotetitle">Disch wrote:</div><div class="quotecontent">I would still recommend doing the "bit $2002" in NMI. If nothing else it will reset the $2005/$2006 toggle and clear the VBlank flag so that if you do happen to disable and re-enable NMIs in the same VBlank, you won't run into a problem.<br /></div><br /><br /><br />so bit $2002 in NMI or no?<br /><br /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">you must save all register you modify in your NMI routine, just because it doesn't always hit when it is supposed too, and that shouldn't crash your programm<br /></div>
<br /> I haven't done much with pushing or pulling off the stack yet.  If I save my values in NMI do I need to restore them once out of NMI?
<br />
<br />Does anyone else have any suggestions for me?  Thanks for the help thus far.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=284"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15892"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15892"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15892#p15892"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 6:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lynxsolaris wrote:</div><div class="quotecontent">so bit $2002 in NMI or no?</div><br /><br />You have nothing to lose by doing it other than the 4 cycles it takes.  And while it isn't necessarily manditory, it sure can't hurt, and possibly will prevent future potential problems.<br /><br />So yes, do it.<br /><br />Q was only saying that the NMI won't reoccur on RTI if you don't do it -- he never said it shouldn't be done.  (He was merely making a technical correction -- not really offering advice).<br /><br /><div class="quotetitle">lynxsolaris wrote:</div><div class="quotecontent">I haven't done much with pushing or pulling off the stack yet.  If I save my values in NMI do I need to restore them once out of NMI?</div>
<br />
<br />Well if you don't restore them, what's the point of saving them?  :P
<br />
<br />The reason A/X/Y registers are often backed up and restored in NMI/IRQ routines is because they are not automatically backed up by the interrupt.  If the interrupt cut into code that was executing -- that code would could get REALLY screwed up if A/X/Y suddenly changed on it.
<br />
<br />For example, consider the following:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">something_the_program_is_doing:<br />&nbsp; LDA #$05<br />&nbsp; CLC<br />&nbsp; ADC #$05<br />&nbsp; STA somewhere<br />&nbsp; RTS<br /><br />nmi_routine:<br />&nbsp; LDA #$00<br />&nbsp; RTI<br /></div><br /><br />'somewhere' would be expected to have $0A written to it ($05 + $05).  But what would happen if the NMI tripped right before that CLC?  The executed code would flow something like the following:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />LDA #$05<br />; **nmi occurs here, go to nmi vector**<br />LDA #$00<br />RTI&nbsp; ; return to previous routine<br />CLC<br />ADC #$05&nbsp; ; 0 + 5 = $05, NOT $0A like it should be<br />STA somewhere&nbsp; ; somewhere is officially screwed<br /></div>
<br />
<br />If such an interruption occurs during program critical calculations, it's very possible for such an occurance to completely crash and burn the program.  However if you save and restore A/X/Y in interrupts, such problems are avoided because none of the registers change and the code being interrupted has no idea its been interrupted (a good thing).
<br />
<br />Though now... you're typically enabling NMIs and just waiting around for them to happen because your program isn't complicated.  So you probably don't NEED to backup your registers -- however it's one of those things like the $2002 thing.  It can't hurt, and it costs nothing aside from a handful of CPU cycles.
<br />
<br />So yeah... do it.  Every NMI, every IRQ.  Backup and restore A/X/Y.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15893"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15893"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15893#p15893"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 6:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lynxsolaris wrote:</div><div class="quotecontent">I haven't done much with pushing or pulling off the stack yet.  If I save my values in NMI do I need to restore them once out of NMI?</div>
<br />Just a quick note here: you have to restore them <strong>before</strong> leaving the NMI, like, the last thing before the RTI. The way you said it looks like you want to restore them <strong>after</strong> leaving the NMI, wich you can't, because you don't know where you'll be after returning.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15895"></a>
				<b class="postauthor">lynxsolaris</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15895"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15895#p15895"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 7:40 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=284.gif" width="18" height="34" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jan 17, 2006 10:39 am<br /><b>Posts:</b> 143<br /><b>Location:</b> North Carolina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">lynxsolaris wrote:</div><div class="quotecontent">I haven't done much with pushing or pulling off the stack yet.  If I save my values in NMI do I need to restore them once out of NMI?</div><br />Just a quick note here: you have to restore them <strong>before</strong> leaving the NMI, like, the last thing before the RTI. The way you said it looks like you want to restore them <strong>after</strong> leaving the NMI, wich you can't, because you don't know where you'll be after returning.</div>
<br />
<br />Nah, I figured that much out on my own <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  As you just said, there isn't any way to tell where in the code NMI will occur.  I was hoping that some of the tips above would help with my issue.  Unfortunately, it didn't.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=284"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15900"></a>
				<b class="postauthor">lynxsolaris</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15900"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15900#p15900"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 9:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=284.gif" width="18" height="34" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jan 17, 2006 10:39 am<br /><b>Posts:</b> 143<br /><b>Location:</b> North Carolina
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ok, I've changed some of the code around.  Here is the updated code:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.zp <br />text_flag = $00 <br /><br />&nbsp;.bss<br /><br />&nbsp;.code<br />&nbsp;.org $8000<br />&nbsp;.bank 0<br /><br />reset:<br />&nbsp;sei<br />&nbsp;cld<br /><br />&nbsp;ldx #$40<br />&nbsp;stx $4017<br /><br />&nbsp;ldx #$ff<br />&nbsp;txs<br />&nbsp;inx<br />&nbsp;stx $2000<br />&nbsp;stx $2001<br /><br />&nbsp;ldx #$02<br />&nbsp;stx text_flag<br /><br />&nbsp;<br />&nbsp;lda #$3F<br />&nbsp;sta $2006<br />&nbsp;lda #$00<br />&nbsp;sta $2006<br /><br />&nbsp;ldy #$00<br />loop_pal:<br />&nbsp;lda pal_colors,Y<br />&nbsp;sta $2007<br />&nbsp;iny<br />&nbsp;cpy #$10<br />&nbsp;bne loop_pal<br /><br /><br />&nbsp;lda #$21<br />&nbsp;sta $2006<br />&nbsp;lda #$84<br />&nbsp;sta $2006<br /><br />&nbsp;lda #$0B<br />&nbsp;sta $2007<br /><br />&nbsp;lda #$00<br />&nbsp;sta $2006<br />&nbsp;sta $2006<br /><br />&nbsp;lda #%10001000<br />&nbsp;sta $2000<br />&nbsp;lda #%00011000<br />&nbsp;sta $2001<br /><br />wait_again:<br />&nbsp;lda text_flag<br />&nbsp;bne wait_again<br /><br />&nbsp;lda #$00<br />&nbsp;sta $2000<br />&nbsp;sta $2001<br /><br />&nbsp;lda #$21<br />&nbsp;sta $2006<br />&nbsp;lda #$85<br />&nbsp;sta $2006<br /><br />&nbsp;lda #$0C<br />&nbsp;sta $2007<br /><br />&nbsp;lda #$00<br />&nbsp;sta $2006<br />&nbsp;sta $2006<br />&nbsp;<br />&nbsp;ldx #%10001000<br />&nbsp;stx $2000<br />&nbsp;ldx #%00011000<br />&nbsp;stx $2001<br /><br /><br />nmi:<br />&nbsp;pha<br />&nbsp;txs<br />&nbsp;tya<br />&nbsp;pha<br />&nbsp;sec<br />&nbsp;lda text_flag<br />&nbsp;sbc #$01<br />&nbsp;sta text_flag<br />&nbsp;<br />&nbsp;lda #$00<br />&nbsp;sta $2005<br />&nbsp;sta $2005<br />&nbsp;lda #%10001000<br />&nbsp;sta $2000<br />&nbsp;<br />&nbsp;bit $2002<br />&nbsp;pla <br />&nbsp;tay<br />&nbsp;tsx<br />&nbsp;pla<br />&nbsp;rti<br /><br />int:<br />&nbsp;rti<br /><br />pal_colors:<br />&nbsp;.db $0E,$30,$22,$16,$0E,$00,$10,$30,$0E,$00,$16,$30,$0E,$3C,$1B,$09<br /><br />&nbsp;.bank 1<br />&nbsp;.org $fffa<br />&nbsp;.dw reset,nmi,int<br /><br />&nbsp;.bank 2<br />&nbsp;.org $0000<br />&nbsp;.incbin &quot;text.chr&quot;<br /></div><br /><br /><br />"A" still shows and "B" does not.  This is what appears in the debug window of nintendulator:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />Invalid opcode $FF &#40;ISB&#41; encountered at $0000<br />Invalid opcode $03 &#40;SLO&#41; encountered at $0103<br />Invalid opcode $03 &#40;SLO&#41; encountered at $0903<br /><br /></div><br /><br />and when the code is running (according to CPU Trace) it seems to just be  sitting in  <br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">wait_again:<br />&nbsp;lda text_flag<br />&nbsp;bne wait_again<br /></div>
<br />
<br />It seems to be that something is wrong in my NMI and my subtraction of the text_flag var.
<br />
<br />Any ideas?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=284"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p15901"></a>
				<b class="postauthor" style="color: #AA0000">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15901"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15901#p15901"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 01, 2006 9:45 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1028
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lynxsolaris wrote:</div><div class="quotecontent">It seems to be that something is wrong in my NMI and my subtraction of the text_flag var.<br /><br />Any ideas?</div>
<br />
<br />Yes.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">nmi:<br />&nbsp;pha<br />&nbsp;txs<br />&nbsp;tya<br />&nbsp;pha<br />&nbsp;sec<br />&nbsp;lda text_flag<br />&nbsp;sbc #$01<br />&nbsp;sta text_flag<br />&nbsp;<br />&nbsp;lda #$00<br />&nbsp;sta $2005<br />&nbsp;sta $2005<br />&nbsp;lda #%10001000<br />&nbsp;sta $2000<br />&nbsp;<br />&nbsp;bit $2002<br />&nbsp;pla<br />&nbsp;tay<br />&nbsp;tsx<br />&nbsp;pla<br />&nbsp;rti </div><br /><br />You do NOT want to be doing txs/tsx in your save/restore registers code - doing so modifies the <strong>stack pointer</strong>, making it very easy to corrupt the interrupt's return address if you're not very careful (which, in this case, you are not).<br /><br />Your NMI routine should read as follows:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">nmi:<br />&nbsp;pha<br />&nbsp;txa<br />&nbsp;pha<br />&nbsp;tya<br />&nbsp;pha<br /><br />&nbsp; &#40;stuff&#41;<br /><br />&nbsp;pla<br />&nbsp;tay<br />&nbsp;pla<br />&nbsp;tax<br />&nbsp;pla<br />&nbsp;rti </div></div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p15902"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p15902"></a></div><div style="float: right;"><a href="./viewtopic.php?p=15902#p15902"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 02, 2006 1:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 5143<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Also, why did your remove your two wait for VBlank at startup ? There really was nothing wrong with it, but it is wrong that your removed it.
<br />You must do your bit $2002 at the <em>start</em> of the NMI to reset the $2005/$2006 flip-flop.
<br />As Quitetust stated, this is not a good idea to save X on the stack <strong>POINTER</strong> because this will effectivly save the X register, but will totally corrupt the stack, so Y will backup anywhere in the stack in function of the old value of X, and restore correctly, but the A register and the return adress WON'T return correctly, causing your programm to crash.
<br />
<br />I think you misunderstood txs and tsx as being phx and plx, wich just doesn't exist.
<br />
<br />On a side not, you should do a routine that fills at least one whole Name Table and Attribute Table (PPU $2000-$23ff) with known values. Typically, $00 is your "blank" tile, you should fill it wihth $00, using color $00 for the whole screen. Most emulators will do it automatically, but NOT the real hardware. Remember that is not because you didn't write the number of a tile in your programm that it will be blank on the screen.
<br />
<br />Now you shouldn't have that much problems from here. If it still doesn't work, use FCE Ultra to trace your code.</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=10&amp;t=1833&amp;start=30"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=1833"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 56 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=10&amp;t=1833&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=10&amp;t=1833">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=1833&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=1833&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=1833&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="1833" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10" selected="selected">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
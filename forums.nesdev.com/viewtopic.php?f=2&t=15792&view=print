<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - FDS .qd format?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">FDS .qd format?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=15792">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=15792</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jaek_3</b> [ Wed Apr 12, 2017 4:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you didn't know, the version of The Legend of Zelda on the Famicom Mini features a prologue that <em>isn't</em> in broken English. Anyways, after a lot of searching, I was finally able to find the game inside of the console - but, it's in Nintendo's .qd format, so I can't actually write it to a physical disk. Is there anyway to convert this to .fds? I've been looking all through the internet, but most of the information available on the subject are in Japanese. I did read that there was a converter (qd2fds) but the link seems to have gone down. Any help would be appreciated!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ccovell</b> [ Wed Apr 12, 2017 5:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You'll have to examine the differences between this format and the FWNES/iNES .FDS format.  Could it be similar to the Virtual Console format, as in this thread? <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=12169&amp;p=138161">viewtopic.php?f=2&amp;t=12169&amp;p=138161</a><!-- l --><br /><br /><br />I did modify FDSList to handle the VC dump in this version: <!-- m --><a class="postlink" href="http://www.chrismcovell.com/data/FDSLCRC.zip">http://www.chrismcovell.com/data/FDSLCRC.zip</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jaek_3</b> [ Wed Apr 12, 2017 8:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">jaek_3 wrote:</div><div class="quotecontent">If you didn't know, the version of The Legend of Zelda on the Famicom Mini features a prologue that <em>isn't</em> in broken English. Anyways, after a lot of searching, I was finally able to find the game inside of the console - but, it's in Nintendo's .qd format, so I can't actually write it to a physical disk. Is there anyway to convert this to .fds? I've been looking all through the internet, but most of the information available on the subject are in Japanese. I did read that there was a converter (qd2fds) but the link seems to have gone down. Any help would be appreciated!</div>Well, I converted the .qd into .fds - but now the text is identical to the original unmodified game!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ccovell</b> [ Wed Apr 12, 2017 8:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Without running afoul of copyright, could you<br /><br />1) Document the QD format and<br />2) see if a patch (that modifies the text) is somewhere in the .qd or elsewhere in the Famicom Mini?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Nicole</b> [ Wed Apr 12, 2017 9:04 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I remember hearing something along the lines of Nintendo actually patching this stuff at run-time, rather than modifying the actual game images themselves.<br /><br />There's already evidence they've done stuff like this with the Virtual Console in things like EarthBound, which mitigates certain screen-flashing effects by fading the screen during them, in a way that isn't possible on a real SNES. There's also Pokémon Yellow on 3DS, which recolors Jynx to be purple in a way that gives the sprite more colors than normally possible on a Game Boy Color.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Myask</b> [ Thu Apr 13, 2017 6:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Relatedly, <br />Gamecube (and, I expect, VC) versions of <em>Zelda II: the Adventure of Link</em> have a glaring, not-tile-aligned/sized PAUSE text (kinda like closed-captioning white-on-black) on the overworld…that isn't in the ROM.<br /><br />(The alterations of the flashing on death are in there, though.)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>hex_usr</b> [ Thu Apr 13, 2017 7:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />At a glance: in the .qd format, each side is 65,536 bytes long instead of 65,500 bytes. Also, there is no header. In .fds, the 16-byte header is required by a few emulators and optional in others, but it doesn't exist in .qd. Also, each block ends in the 16-byte CRC that actual Famicom Disks have, but I think the CRC for the *NINTENDO-HVC* header might be bad: it's just 00 00.<br /><br />It's worth noting that the FDS BIOS in the Famicom Mini is different from the one in the actual Famicom Disk System RAM adapter. Its SHA256 hash is FDC1A76E654FEEA993FCB38366E05EE5F4EB641F86FE6BEBAEEFD412E112DD72.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Pokun</b> [ Fri Apr 14, 2017 12:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So in other words, maybe the Famicom Mini BIOS doesn't check the CRC.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>hex_usr</b> [ Fri Apr 14, 2017 8:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think I found a lead on where the runtime patches are stored.<br /><br />I did a search on the entire /usr/share/ directory for the byte sequence 10 0A 17 18 17, which spells &quot;GANON&quot; in the game's text encoding. I found only 1 file with this byte string:<br /><br />/usr/share/games/nes/kachikachi/CLV-P-HAANJ/autoplay/0be33d87903018bde4f01672b434800b89c4fa7e_0.inputs.state<br /><br />This looks like a save state that the emulator loads every time the game is loaded.<br /><br />In it, there is a block of data that is exactly <s>0xB96D</s> 0x1802 bytes long, starting at $013FD2 which patches the .qd image at $008665. It includes the entire intro text and a few other things. Most notably, the <strong><em>font</em></strong> is <s>included in this patch</s> included in a separate patch in this file; the original had &quot;©&quot; copyright symbol glyphs at 0xF0 and 0xFC, but the Famicom Mini version replaces the one at 0xFC with a &quot;,&quot; comma glyph, which is the cause of a typo on the ending screen.<br /><br /><img src="http://legendsoflocalization.com/wp-content/uploads/2017/04/copyrightj3.png" alt="Image" /><br /><br />=============================<br /><div class="quotetitle">Myask wrote:</div><div class="quotecontent">Gamecube (and, I expect, VC) versions of <em>Zelda II: the Adventure of Link</em> have a glaring, not-tile-aligned/sized PAUSE text (kinda like closed-captioning white-on-black) on the overworld…that isn't in the ROM.</div><br />I don't know about the Wii Virtual Console versions, but among the GameCube versions, the first game also has that very same pause graphic:<br /><img src="http://i.imgur.com/ZR1SLWg.png" alt="Image" /><br /><img src="http://i.imgur.com/ISKhYuV.png" alt="Image" /><br />The Game Boy Advance versions have smaller &quot;PAUSE&quot; graphics instead. They are not in the 3DS or Wii U Virtual Console versions.<br /><br />EDIT: Crossed out some errors in my patch research.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jaek_3</b> [ Sat Apr 15, 2017 10:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">hex_usr wrote:</div><div class="quotecontent">I think I found a lead on where the runtime patches are stored.<br /><br />I did a search on the entire /usr/share/ directory for the byte sequence 10 0A 17 18 17, which spells &quot;GANON&quot; in the game's text encoding. I found only 1 file with this byte string:<br /><br />/usr/share/games/nes/kachikachi/CLV-P-HAANJ/autoplay/0be33d87903018bde4f01672b434800b89c4fa7e_0.inputs.state<br /><br />This looks like a save state that the emulator loads every time the game is loaded.<br /><br />In it, there is a block of data that is exactly 0xB96D bytes long, starting at $013FD2 which patches the .qd image at $008665. It includes the entire intro text and a few other things. Most notably, the <strong><em>font</em></strong> is included in this patch; the original had &quot;©&quot; copyright symbol glyphs at 0xF0 and 0xFC, but the Famicom Mini version replaces the one at 0xFC with a &quot;,&quot; comma glyph, which is the cause of a typo on the ending screen.<br /><br /><br /><br />=============================<br /><div class="quotetitle">Myask wrote:</div><div class="quotecontent">Gamecube (and, I expect, VC) versions of <em>Zelda II: the Adventure of Link</em> have a glaring, not-tile-aligned/sized PAUSE text (kinda like closed-captioning white-on-black) on the overworld…that isn't in the ROM.</div><br />I don't know about the Wii Virtual Console versions, but among the GameCube versions, the first game also has that very same pause graphic:<br /><br />The Game Boy Advance versions have smaller &quot;PAUSE&quot; graphics instead. They are not in the 3DS or Wii U Virtual Console versions.</div><br />Is there any chance that you could post a patched copy of the .qd?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sat Apr 15, 2017 10:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The giant Pause screens are built into the emulator, not the game itself.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>hex_usr</b> [ Sat Apr 15, 2017 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Do you really want me posting copyrighted ROMs on the NesDev forums? I'll PM it to you instead, and you can share it at your discretion after that.<br /><br />But unfortunately, I made some errors in my calculations. Both offsets are correct (from inputs.state: $013FD2 to qd: $008665), but the size is actually 0x1802, not 0xB96D. And that section only affects the intro text and not the font, so I think there's another patch section specifically for the font. I'll analyze it further, then create an archive with both .qd and .fds versions of both the unpatched and patched versions to PM to jaek_3.<br /><br />If you can't find a Famicom Mini for cheap enough and you really want the files it comes with, they have been preserved in torrent form along with the files in the NES Classic Edition. I won't say where to find that torrent, but it's easy if you know where to look.<br /><br />EDIT: The font is at $008AD2 in the save state/patch, and it patches offset $000161 in the .qd image for 0x2000 bytes. It includes graphics for Link, some of the items he uses, the title screen, the main font, and most importantly, the comma that replaces the copyright symbol.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>JoelSun</b> [ Wed Nov 15, 2017 7:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: FDS .qd format?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">The giant Pause screens are built into the emulator, not the game itself.</div><br /><br />Ah yes, they are annoying as hell. Any way to change them?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Pently: a flexible, space-efficient NES music player</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Pently: a flexible, space-efficient NES music player</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=13589">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=13589</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>4</strong> of <strong>5</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jul 01, 2016 2:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">dougeff wrote:</div><div class="quotecontent">I find volume control to be one of the most important effects. Every channel, preferred.</div><br />Would four levels (1/4, 1/2, 3/4, full) be enough for this? Or is there a musical use case for more?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Also, down the road, ot would be nice if we had a library of instruments, so every musician doesn't have to reinvent the wheel (or piano-ish volume envelope, for example).</div><br />I agree. Compose with <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pentlyas</tt> and let's build one.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dougeff</b> [ Fri Jul 01, 2016 2:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How would that correspond to Famitracker's volume column? Something like...<br /><br />D-F = 100%<br />9-c = 75%<br />5-8 = 50%<br />1-4 = 25%<br />0 = off<br /><br />??

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jul 01, 2016 2:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That'd be about right: 4, 8, B, F.<br /><br />The thing motivating the limit of 4 levels is that the NES CPU is slow at multiplying, and I don't want to introduce a bunch of 256-entry lookup tables to make it fast. So I plan to make an engineering tradeoff among control, ROM space, and CPU time.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dougeff</b> [ Fri Jul 01, 2016 2:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh good. I feel good about the new, improved Pently. It seems to be filling in the short-comings of other music drivers. I may try to use it in the future, for game development.<br /><br />I'm not sure how sound effects will work with it, but I really haven't tried yet. It sounds like you've gotten it to work with your own games, so I guess I'll probably figure that out too, when I get to that point.<br /><br />Edit...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">NES CPU is slow at multiplying....compromise</div><br /><br />Agreed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jul 01, 2016 2:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sound effects work in almost exactly the same way as the drum track. Each drum is made of one or two sound effects. Or did you mean you haven't had a chance to understand how drums work either?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dougeff</b> [ Fri Jul 01, 2016 2:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sorry, I mean game-generated sound events. Collect a coin = ding.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jul 01, 2016 3:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">musicseq.pently</tt>, make <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sfx ding on pulse</tt>. Then do this from the game code:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; lda #PE_ding<br />&nbsp; jsr pently_start_sound<br /></div><br />(The &quot;PE_&quot; part stands for &quot;Pently effect&quot;.)<br /><br />Thread safety caution: Some people like to run the music engine in the NMI handler to avoid audible consequence of slowdown. If you call <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_update_sound</tt> in the NMI handler, don't also call Pently API functions in the main thread; that'll cause undefined behavior if it interrupts itself. Instead, add commands to a list in RAM that the NMI handler processes.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Sat Jul 02, 2016 4:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is there a any possibility of ''Go to Track #n'' and ''Go to Previously Buffered Track'' effects for pently?<br /><br />Makes things easier for full-on jingle effects, such as the ''Time Running Out'' jingle in mario games!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Jul 02, 2016 4:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />From the manual's description of <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pentlyconfig.inc</tt>:<br /><blockquote style="margin-left: 1%; padding-left: 1%; border-left: 3px solid #555577;">
If <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">PENTLY_USE_ROW_CALLBACK</tt> is enabled, the main program must <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.export</tt> two callback functions: <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_row_callback</tt> and <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_dalsegno_callback</tt>.  These are called before each row is processed and when a <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">dalSegno</tt> or <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">fine</tt> command is processed, respectively. They can be useful for synchronizing animations to music. For <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_dalsegno_callback</tt>, carry is clear at the end of a track or set if looping.
</blockquote><br />So turn it on and use <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_dalsegno_callback</tt> to know when to restart the music.<br /><br />Do you want more details?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Sat Jul 02, 2016 6:26 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Do you want more details?</div><br /><br />Yes... That would help a lot if more details are added

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Jul 02, 2016 6:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><ol style="list-style-type: decimal"><li>When you start the song for a level, save the song number of the song for the level in a variable.</li><li>When you play a temporary song that ends, such as a fanfare that time is about to expire, do not save its song number.</li><li>In <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pentlyconfig.inc</tt>, change <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">PENTLY_USE_ROW_CALLBACK = 0</tt> to <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">PENTLY_USE_ROW_CALLBACK = 1</tt>.</li><li>Create a subroutine in your main program called <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_row_callback</tt> that does nothing (that is, immediately executes the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">rts</tt> instruction). This is required because the same configuration option enables both <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_dalsegno_callback</tt> and <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_row_callback</tt></li><li>Create a subroutine in your main program called <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_dalsegno_callback</tt>, and <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.export</tt> this subroutine. If called while carry is clear, this means that the temporary song that ends, such as a fanfare that time is about to expire, has ended. In this case, it should load the song number from variable in step 1, and if it's a valid song number, call <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pently_play_music</tt>.</li></ol><br />If this is not enough, then as I wrote in <a href="http://forums.nesdev.com/viewtopic.php?p=174553#p174553" class="postlink">this post</a>:<br /><blockquote style="margin-left: 1%; padding-left: 1%; border-left: 3px solid #555577;">
Please give us more details on your requests for &quot;more details&quot;. What parts of the post did you understand, and what parts of the post did you not understand? If you are unable to express what parts of the posts you did and did not understand, I will have to break up the explanation into smaller posts, as if this were a chat room instead of a forum, and ask you whether you understood each part.
</blockquote><br /><br />Or did you want me to actually write the code for you?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Sat Jul 02, 2016 4:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So from what i gathered... Follow how the NES Mario engines originally does things:<br /><br />-Make and use a subroutine for Main to handle the two music buffers, One for main songs, and one for event (effect) songs<br />-Then store the songs in one of two buffers, Restore back to the main song when the event (effect) song finishes<br /><br />I think it is good enough from here if so...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Nov 21, 2016 10:52 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Many free software licenses require the license to be reproduced in full in all copies, such as the <a href="https://en.wikipedia.org/wiki/MIT_License" class="postlink">MIT License (Expat variant)</a> currently used for Pently. This is why the NES Classic Edition's front end includes several pages of &quot;Legal Notices&quot;. But then it can afford to do so because it has half a gigabyte of NAND flash for the Linux kernel, emulator, and game ROMs. NES games distributed on Game Paks, on the other hand, are in the tens to hundreds of kilobytes and may not have enough space to store a viewer for the entire software license in the binary. So the MIT License (Expat variant) alone might not be the best choice, as it requires the notice to be reproduced in all copies. This has already <a href="https://forums.nesdev.com/viewtopic.php?p=174349#p174349" class="postlink">caused problems for use of Pently in ROM hacks</a>.<br /><br />There are a few other non-copyleft licenses. Before Pently moved to Git, I had been using a variant of the <a href="https://www.gnu.org/prep/maintain/html_node/License-Notices-for-Other-Files.html" class="postlink">GNU All-Permissive License</a> changed to limit the credit requirement to source code:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Copying and distribution of this file, with or without modification, are permitted in any medium without royalty provided the copyright notice and this notice are preserved in all source code copies. This file is offered as-is, without any warranty.</div><br /><br />My project templates and the game <em>RHDE: Furniture Fight</em> still use this license.<br /><br />If we find it useful to go with a better-known license, I was considering switching to the <a href="https://en.wikipedia.org/wiki/Zlib_License" class="postlink">license of zlib</a>, which similarly requires the full notice only in source code and encourages but does not require credit in object code. This license is also <a href="http://liballeg.org/license.html" class="postlink">used by the Allegro 5 library</a>, and it carries forth the spirit of the &quot;giftware&quot; license used by Allegro 4.<br /><br />As the only contributor so far, I have the right to make this license change unilaterally, but I'm opening this to others' input because I'm nice. So comment here or in <a href="https://github.com/Qix-/pently/issues/10" class="postlink">bug 10</a>.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jan 11, 2017 3:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Channel volume control is checked into GitHub.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Jun 01, 2017 7:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pently music player is coming</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've proposed five enhancements to how arpeggios can be entered into a score.<br /><br /><ul><li><a href="https://github.com/Qix-/pently/issues/11" class="postlink">Create arpeggios from chorded notes</a></li><li><a href="https://github.com/Qix-/pently/issues/12" class="postlink">Specify arpeggios using chord names</a></li><li><a href="https://github.com/Qix-/pently/issues/13" class="postlink">Single-note arpeggio</a></li><li><a href="https://github.com/Qix-/pently/issues/14" class="postlink">Arpeggio inversion</a></li><li><a href="https://github.com/Qix-/pently/issues/15" class="postlink">Transpose note down by top note of arpeggio</a> </li></ul><br />Thoughts?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>4</strong> of <strong>5</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
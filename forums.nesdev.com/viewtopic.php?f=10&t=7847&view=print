<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - How often do you use multiplication?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">How often do you use multiplication?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7847">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7847</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ian A</b> [ Sun Jun 12, 2011 4:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>How often do you use multiplication?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How often do you guys use multiplication in your engines and are there any specific things you use it for?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Jun 12, 2011 4:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I avoid it like the plague, but I did have to use them for some tasks. I have used multiplications for effects in my (WIP) music engine, but I'm trying to find a way to get rid of them. I also need multiplications for angled motion of my main character, like when he's on slopes and such. I obviously needed a lot of them in <a href="http://nesdev.com/bbs/viewtopic.php?p=50964#50964" class="postlink">my raycaster</a>, because of all the trigonometry.
<br />
<br />I believe that most NES games don't need multiplications though. Many calculations can be approximated and the players won't even notice.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Shiru</b> [ Sun Jun 12, 2011 5:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think, you can see division more often than multiplication in the games. The division is usually needed to display a number in decimal format.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Sun Jun 12, 2011 5:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't use it yet. I have yet to use 16 bit math, although in a side thing I did use it. Finally made sense why you have to use ADC and SBC with the carry bit! Doh.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Jun 12, 2011 5:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Multiplication by a constant is fairly common, but that's just a small amount of shifts and adds.  Want to multiply by 12?  Use x*8 + x*4.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ian A</b> [ Sun Jun 12, 2011 6:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, awesome guys.  Thanks!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Jun 12, 2011 7:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thwaite is my first game to use a lot of multiplication:
<br /><ul><li>It uses multiplication by 19/16 and 13/16 as approximations of 60.0988/50.0070 and its reciprocal to adjust missile speeds when run on a PAL console. </li><li>It uses arbitrary multiplication to scale missile velocities by the level's missile speed. </li><li>It uses dot product a few times to make unit vectors when aiming player missiles, as described in <a href="http://nesdev.com/bbs/viewtopic.php?p=79608#79608" class="postlink">this post</a>. </li></ul>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Mon Jun 13, 2011 1:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I definitely don't use often multiplications or divisions in a standard 2D NES game, but it's really handful to know how to do one.
<br />
<br />One common place where I think divisions are needed is if you do vertical scrolling. Because the screen is exactly 15 metatile high you have to divide your Y map position by 15 and can't get away with simple shifts. However it's pretty simple to do just look at my examples on the wiki.
<br />
<br />The most complex math I had to do was for homing projectile. I had to compute it's H and V speed based on player's X and Y coordinates, and the projectile's initial X' and Y' position. The formula to be used is :
<br />HSpeed = (X-X')/root((X-X')^2 + (Y-Y')^2)
<br />VSpeed = (Y-Y')/root((X-X')^2 + (Y-Y')^2)
<br />
<br />At first I did it with a lookup table, but then I figured I could do ALL the math in assembly, squared is just a multiplication by itself, division is pretty simple, and for the root... I used an example on 6502.org
<br />I was surprised how well it worked to do all this in assembly without a lockup table, and the code to do the complex math took ony half the size of the lookup table (I used a 256 entry table) and was more precise so of course this is the solution I took.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Jun 13, 2011 2:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">One common place where I think divisions are needed is if you do vertical scrolling. Because the screen is exactly 15 metatile high you have to divide your Y map position by 15 and can't get away with simple shifts.</div>
<br />When I was first designing my scrolling engine I considered this option, but ended up just maintaining a secondary Y coordinate. Whenever the camera coordinate is updated, I modify the secondary coordinate by the same amount, and make it wrap around as necessary. I'm sure this is much faster than dividing by 15 all the time.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kasumi</b> [ Mon Jun 13, 2011 6:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I do as Tokumaru does as well.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Tue Jun 14, 2011 5:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />As do I. Most multiplication can be worked around I find <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Jun 14, 2011 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">When I was first designing my scrolling engine I considered this option, but ended up just maintaining a secondary Y coordinate. Whenever the camera coordinate is updated, I modify the secondary coordinate by the same amount, and make it wrap around as necessary. I'm sure this is much faster than dividing by 15 all the time.</div>
<br />In this case you save nothing because when you'll want to acess the map, the vertical index would be 15*Highcounter + Low counter so you need some multiplication !
<br />
<br />So I'd rather keep the map easier to access and do the integer division to render it. If it's a constant (it's the case here) it's really simple and fast, as is multiplication by a constant anyways.
<br />I really think the complexity of such simple math routines are terribly overrated. Even the square root I described could be done in plain assembly, yes it's not very fast but as long as you do it only once in a while this is no problem.
<br />
<br />Pieces of codes which should be very fast should be stuff like sprite mazing routines, VBlank updates or collision detection. NOT logic that is never executed in a loop.
<br />
<br />Even if multiplications and divisions can be "worked arround", there is really NO POINT to work around them because they are VERY EASY to do. You are just looking to fix a non-issue. In french we call this something that would translate to "slashing your sword into water" which really is a good image <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Tue Jun 14, 2011 1:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">In this case you save nothing because when you'll want to acess the map, the vertical index would be 15*Highcounter + Low counter so you need some multiplication !</div><br />I think you didn't understand my solution, because I don't need multiplications or divisions. Let me explain:<br /><br />I have a variable called <strong>CameraY</strong> which represents the position of the camera within the map. In addition to that I have a variable called <strong>NTCameraY</strong>, that represents the position of the camera in the name tables. Every time <strong>CameraY</strong> changes, <strong>NTCameraY</strong> is changed by the same amount, so they move together, but each over their own space: <strong>CameraY</strong> moves over the map, while <strong>NTCameraY</strong> moves over the name tables. <strong>NTCameraY</strong> wraps around respecting the dimensions of the name tables, but both variables are always in sync.<br /><br />Whenever I need to render a new row or column of blocks, I use <strong>CameraY</strong> to read from the map and <strong>NTCameraY</strong> to calculate their target address in VRAM. There are no multiplications or divisions involved at all.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Even if multiplications and divisions can be "worked arround", there is really NO POINT to work around them because they are VERY EASY to do.</div>
<br />They might be EASY, but they are SLOW. Whenever I can work around them I do, because it's always FASTER to avoid them, even if the code gets a little more complex (which is not always the case).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Jun 17, 2011 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh yes I guess I didn't understand your solution. Ironically in my unfinished game it's almost the same, except that since screens are always only one screen tall, the CameraY would rather be a constant that points to the uncompressed screen memory (there is only one at a time "loaded" into memory). So in fact this variable does not exsist.
<br />
<br />However I have something equivalent to your NTCameraY, that goes from 0 to 15 and warps arround, because my screens are less tall than the screen, because I have a status bar, so I need a variable to record "where" in the nametable my screen is.
<br />
<br />Not that this solution is good for 1-screen game, but if I was to make a game with larger multidirectional scrolling, since I have the normal Camera variables I'd rather use the same variables for nametable positioning, although there is absolutely no need to do that.
<br />
<br />I remember that I studied scrolling that there is basically two kind of approaches : The "camera" one where you always start at (0,0) (or wathever value it is) when rendering the screen, and then advance when scrolling is needed. The other approach, is to do some divisions/shifting from the camera positioning directly, it needs less variables, and the map will always be rendered at the same offset in the nametable, no matter where the rendering has started.
<br />
<br />I don't think one method is better than the other it's just two different approaches.
<br />
<br />And multiplications and divisions are not THAT slow. You say this as it would take forever for each one, which is not the case. For example if you wanted to do a sprite mazing routine that would need a division for each sprite (you remember someone proposed this not long ago...) I'd say forget it because you want to be able to maze 64 sprites in a frame, so you don't want to loose time for 64 divisions !! Then I 100% agree with you.
<br />
<br />If we talk about something like at most 1 division per frame, such as in the scrolling code, then it's really a non-issue.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Fri Jun 17, 2011 11:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How big of an issue it is depends on the CPU requirements of your game, I guess. Especially when using WRAM I am more often CPU-bound than memory-bound, so I'd rather use more RAM and less CPU cycles.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
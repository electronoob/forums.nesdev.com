<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - What Mapper Did Gradius II Repro Use?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">What Mapper Did Gradius II Repro Use?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=3801">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=3801</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Feb 06, 2008 3:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Ofcourse I'd also love to see a Contra (J) conversion to MMC3, because the VRC2b version kicked the ass of the UNROM version.</div>
<br />This is <a href="http://jonathan.microclub.ch/contra" class="postlink">already done</a>.
<br />
<br />This is weird, for some reason I was sure that all non-Nintendo mappers weren't doccumented on the wiki. I didn't even check there <img src="./images/smilies/icon_wink.gif" alt=";-)" title="Wink" /> I'll try to convert Gradius II to MMC3, but I won't be able to test it on hardware right now because I have no EPROM programmer at this time, I'll have to buy a new one.
<br />
<br />EDIT : This whole adress pin swap thing is really confusing, Konami really got nasty here, but I'll still try to do something.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Feb 06, 2008 11:58 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, I've spent my day hacking the game to MMC3 with sucess.
<br />I still haven't completed the game as a whole to see if there is scrambled graphics later, but for now I encountered none, I haven't had to change anything in the CHRROM (yet). The game works perfect in all inacurate emulators (including Nesticle !), but I've the two following issues :
<br />
<br />- Nintendulator : The status bar is shaking by one pixel for some reason. I cannot find why, I always setup the IRQ at the exact same time during NMI.
<br />
<br />- Nestopia : This is the weirdest thing I've ever seen in emulation. The graphics are scrabled at opening for some reason I don't know, they work perfect in any other emulator. But the really weird thing is that as soon as the game starts, graphics are perfect, but the player dies immediately, and again, again until it's game over. There is absolutely nothing to do about this !! This is really the thing that makes we wonder what the f... is happening.
<br />
<br />Also the game uses a 2KB SRAM I think so TSROM will be needed at least, I guess. Or add a 2KB RAM on a TLROM board yourself if you want.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Feb 06, 2008 12:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'll test them on the Powerpak if you like. Ignore my private message about Contra as I replied before reading this. Sweet stuff man. Send me a patch for Gradius 2 and I'll test it out.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Feb 06, 2008 12:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, I've <em>temporarly</em> updated data of the last 8k PRG bank ($e000-$ffff) here <a href="http://jonathan.microclub.ch/contra/gradius2_patch.bin" class="postlink">http://jonathan.microclub.ch/contra/gradius2_patch.bin</a>.
<br />To run the game as an iNES ROM just go with an hex editor to offset $1E010, paste this (overwriting previous data), and change the header so that it is mapper 4 and not mapper 25 (so that nobody can call me illegaly distributing the ROM).
<br />I really wonder how it looks on real hardware, status bar is probably shaking, I tried change the timing a bit but I couldn't get rid of this shaking. Tell me if your ship is always destroyed as it is in Nestopia, this is really weird.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Feb 06, 2008 1:23 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I got the same results on Nestopia as you. Ship dieing always. Also the first screen of the ship had all wrong gfx. Nintendulator didnt have either problem. I'm assuming you know the sprites are messed up. I'm going to try it on the powerpak shortly.
<br />
<br />On Powerpak it performs like it does on Nintendulator. The ship doesn't constantly explode. Just the sprites are wrong, and the status bar jumps around a whole bunch. More so when I got past the first space area and where the red fireball planetoids were and was shooting lasers.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Feb 06, 2008 1:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">To run the game as an iNES ROM just go with an hex editor to offset $1E010, paste this (overwriting previous data), and change the header so that it is mapper 4 and not mapper 25 (so that nobody can call me illegaly distributing the ROM).</div>
<br />Do you know how to work an <a href="http://www.zophar.net/trans/ipsfaq.html" class="postlink">IPS patcher</a>?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Feb 06, 2008 2:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Do you know how to work an <a href="http://www.zophar.net/trans/ipsfaq.html" class="postlink">IPS patcher</a>?</div>
<br />Yeah but for some reason I didn't want to go though the trouble of making a ips file.
<br />
<br />I now played though the whole game (savestates rules !!) and yeah, a lot of sprites are screwed on later levels (comes from the wrong CHR bank), but everything is perfect on the first level, and I don't know how an human person is able to pass it on the real hardware (who lack savestates) even with the 30 lives code. The ending has screwed up graphics as well because the game swaps bg and sprites banks to normal via $2000 (I've made them backwards so that MMC3 IRQ counter works). I don't know if there is any sprites from the BG bank exept the cursor in the secret sound mode. (if there is any during gameplay this may screw IRQs up). Finally I've got the game freeze randomly several time when too much objects are on screen, don't know why (with VirtuaNES).
<br />
<br />I guess I could go through the trouble of editing the game's CHRROM in order to work on MMC3, but I fell I've done enough work with this game today.
<br />
<br />Anyone is free to try it, for information the games swaps "virtual 8 KB banks", which are consisted of 8 bytes of 1 KB bank. The game have a huge table of 256 bytes (that's 32 "virtual" 8 KB banks) located in the main PRG bank at $EA1D (location in iNES ROM is $1EA2D). Bytes comes in this order : BG part 1, BG part 2, ..., Sprites part 3, sprites part 4. In the MMC3 version sprites part 2 and sprites part 4 are ignored, and are "substitued" by sprites part 1 + 1 and sprites part 3 + 1 instead, which don't always works. I guess one have to try to change the order of the banks, possibly duplicating data so that each numbers in sprite data are consecutive numbers (this can be applied to the original ROM), and thrus re-arrange the CHRROM as needed. Note that I'm unsure if dynamical BG animation is based on this table or not, at the end of the first level the games changes the BG bank used via IRQ, so I guess it's not, it adds or substract from the "normal" bank.
<br />
<br />Also if anyone has an idea why a MMC3 IRQ could vary randomly by an amout of one (resulting in a shaking bar) I'm listening. I've got a lot of shaking bars in VirtuaNES, and weirdly when the real bar is shaking it's not in VirtuaNES. So VirtuaNES is always wrong, that's kind of fun.
<br />
<br />Finally, I found interesting how Gradius II handles its IRQs. There is always a IRQ triggering at 2 different positions on the screen, regardless of other parameters. Then the IRQs does something like change the CHR banks, or change scrolling to the status bar, only if the main game ordered it so. That's quite of a good idea I think.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Feb 06, 2008 3:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm guessing you must have changed the CHR, cause the sprites for me are always messed up with just that 8kb prg change. If you're done with it, and not just done with it for the day, I'd love to see any notes and get a copy of where you are at. I'd like to see the first level with correct sprites.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Feb 06, 2008 4:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">I now played though the whole game (savestates rules !!) and yeah, a lot of sprites are screwed on later levels (comes from the wrong CHR bank), but everything is perfect on the first level, and I don't know how an human person is able to pass it on the real hardware (who lack savestates) even with the 30 lives code.</div>
<br />Have you ever watched any DoDonPachi or Espgaluda videos on YouTube? Some people who play scrolling shooters are obse^H^H^H^H dedicated enough to survive that kind of enemy firepower.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>BMF54123</b> [ Wed Feb 06, 2008 5:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Could the exploding ship have anything to do with Konami's infamous copy protection? I don't know if this game has it, but some other games become either much more difficult (Yume Penguin Monogatari) or entirely unplayable (Kid Dracula; enemies and sprite platforms disappear at level 2) if they're tampered with. Kinda weird that it wouldn't happen on other emulators, though.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Feb 06, 2008 6:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">BMF54123 wrote:</div><div class="quotecontent">Could the exploding ship have anything to do with Konami's infamous copy protection? I don't know if this game has it, but some other games become either much more difficult (Yume Penguin Monogatari) or entirely unplayable (Kid Dracula; enemies and sprite platforms disappear at level 2) if they're tampered with. Kinda weird that it wouldn't happen on other emulators, though.</div>
<br />
<br />Considering the exploding ship fails to happen on the actual NES when I tested, I doubt it's that protection in Nestopia.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Feb 07, 2008 2:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">I'm guessing you must have changed the CHR, cause the sprites for me are always messed up with just that 8kb prg change. If you're done with it, and not just done with it for the day, I'd love to see any notes and get a copy of where you are at. I'd like to see the first level with correct sprites.</div>
<br />I didn't remember changing anything outside of the main PRG bank, but I guess I was wrong, because this was needed to swap pattern tables, I've done an <a href="http://jonathan.microclub.ch/gradius2MMC3.ips" class="postlink">IPS Patch</a> instead (apply on the original Gradius II) hoping you'll get better results.
<br />
<br />Note that my original Gradius II ROM has C71D4CE7 as PRG CRC and 537B6F6A as CHR CRC, I don't know if there is any variants floating arround.
<br />
<br />I'll try to change the order of CHR banks todays, and that's the only thing left to do, among with fixing that damn shaking status bar, and removing the point where the games sets BG pattern table to 1 again at the ending.
<br />I guess I'll try to figure this out today, but I cannot guarantee anything. Feel free to try change the CHR banks, I've tell above how they function (at least for most part of the game), the game just swaps them in 8 KB chunks made of 8 1KB chunks.
<br />
<br />EDIT : I've fixed the exploding ship problem. This was due to SRAM to be disabled by default in Nestopia, and enabled by default with other emus. If there is no SRAM, the ship explodes, Konami is pretty cool.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Feb 07, 2008 5:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, guys I have very good news. The hack is 100% finished, and graphics should in theory be 100% intact on MMC3, and that with still 128 KB CHR ROM a bit rearanged (altrough I haven't played through the whole game again yet), status bar is no longer shaking (this was due to the IRQ to be set before the game does it's nametable updates, who caused the counter to ocasionally clock during VBlank !).
<br />
<br />I've updated my <a href="http://jonathan.microclub.ch/gradius2MMC3.ips" class="postlink">IPS file</a>, tell me if it works on real hardware, and if it does, I'll update my Contra page to fix the spelling errors and turn it into a dual Contra/Gradius II page.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Thu Feb 07, 2008 1:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />There are 2 dumps of Gradius 2 I know of. I'll check if they are that different. I'll also test out the ips patch. I'll edit or post again when I have tested.
<br />
<br />Edit: Initial tests with my Gradius 2 (J) show good sprites and all, really everything looked flawless, on Nestopia so far. I will test on Powerpak next. But I compared the alternate dump of Gradius 2. It seems to have a different CHR. CRC32 is 7E31C1D7. That's for the CHR, not the whole rom. Rom name was Gradius 2 (J) [a1].nes
<br />
<br />Oddly, the program roms are identical. And there's no visible difference. But i'm not sure if it wouldn't work on it. I'll test it later. But so far it looks like you've done a great job, now I just need a game genie code to help me play through the whole game. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />
<br />
<br />Edit:
<br />From NESTopia
<br />
<br />File:        Gradius 2 (J).nes
<br />Directory:   D:\ROMS\NesFC\Japan\
<br />CRC:         0x5ADBF660
<br />Region:      NTSC
<br />Board/Chips: KONAMI VRC4 Y
<br />Mapper:      25
<br />PRG-ROM:     128k, CRC: 0xC71D4CE7
<br />CHR-ROM:     128k, CRC: 0x537B6F6A
<br />Mirroring:   Mapper Controlled
<br />Battery:     No
<br />Trainer:     No
<br />Condition:   Good
<br />
<br />---
<br />
<br />File:        Gradius 2 (J) [a1].nes
<br />Directory:   D:\ROMS\NesFC\Japan\
<br />CRC:         0x779158DD
<br />Region:      NTSC
<br />Board/Chips: KONAMI VRC4 Y
<br />Mapper:      25
<br />PRG-ROM:     128k, CRC: 0xC71D4CE7
<br />CHR-ROM:     128k, CRC: 0x7E31C1D7
<br />Mirroring:   Mapper Controlled
<br />Battery:     No
<br />Trainer:     No
<br />Condition:   Good
<br />
<br />Both work with the MMC3 ips. Atleast they play into the first level.
<br />
<br />About the status bar, it stays where it should, except when there are alot of sprites on screen. Then it will glitch. I'll have to try the original rom to see if that happened in it or not. But it's still perfectly playable.  Haven't tried it on Powerpak yet.
<br />
<br />GTSVLGLA - Start with 99 Lives

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Feb 07, 2008 2:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You can do the UUDDLRLRBA code at title screen to get 30 lives, however the game is still almost as hard because you restart back on each live (unlike in Life Force where this code makes the game significantly easier).
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">About the status bar, it stays where it should, except when there are alot of sprites on screen. Then it will glitch. I'll have to try the original rom to see if that happened in it or not. But it's still perfectly playable. Haven't tried it on Powerpak yet.<br /></div>
<br />Yes. I've noticed this too, I don't know why. At some points, there is sprites from the BG pattern table who accidentally clock the IRQ counter, making the status bar higher. I'm a bit screwed here, either the status bar is wrong, or either I force the sprite to be in the right pattern table, then the status bar will be right but the sprites will look wrong.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - What is WRONG with my PPU???</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - What is WRONG with my PPU???" href="http://forums.nesdev.com/feed.php?f=3&amp;t=3585" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '2');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=3585';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 9:50 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=3585&amp;start=15">What is WRONG with my PPU???</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=3585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=3585&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=3585">1</a><span class="page-sep">, </span><strong>2</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=3585&amp;start=15&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=3585&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=3585&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27042"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27042"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27042#p27042"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 4:58 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK so (if rendering is on)...
<br />
<br />    if (S.PPU_Scanline == 0)         S.vAddr = S.vAddr_Latch &amp; 0x3FFF;
<br />
<br />And after rendering the scanline's BG, but before HBLANK:
<br />
<br />    S.vAddr = S.vAddr &amp; 0x41F | (S.vAddr_Latch &amp; 0x41F);
<br />
<br />This is in addition to my previous modifications to vAddr, correct? Did they all look right?
<br />
<br />If I'm all set with vAddr updates, I presume now I should be calculating X and Y from this. First, let me show you how I'm doing it now:
<br />
<br />1. Set S.PPU_SCROLL_X and S.PPU_SCROLL_Y using [the wrong] methods in the registers
<br />2. Calculate the values that the DrawScanline function REALLY uses:
<br />
<br />
<br />  S.PPU_SCROLL_Y_BYTE = (S.PPU_SCROLL_Y &gt;&gt; 3);
<br />  S.PPU_SCROLL_Y_BIT  = (S.PPU_SCROLL_Y &amp; 7);
<br />  S.PPU_SCROLL_X_BYTE = (S.PPU_SCROLL_X &gt;&gt; 3);
<br />  S.PPU_SCROLL_X_BIT  = (S.PPU_SCROLL_X &amp; 7);
<br />
<br />So, should I throw all of this away and do it some other way? If keeping the above code makes sense, then I just need to know how and when to develop S.PPU_SCROLL_X and S.PPU_SCROLL_Y.
<br />
<br />Otherwise, I need to understand the whole caboodle.
<br />
<br />I see the previous posts about how to get it from the vAddr, except for Fine-X (where is that btw)... should I be using that, and if so, when specifically?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27043"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27043"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27043#p27043"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 5:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Current state of my code:
<br />
<br />Read Operations:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; case 0x2000:&nbsp; /* PPU */<br />&nbsp; &nbsp; &nbsp; &nbsp; switch&#40; wAddr &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2007&#41;: /* VRAM Read */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.vAddr &lt;0x3F00&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch = S.vAddr;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch &amp;= 0x3FFF;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bScratch = S.PPU_R7;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R7 = W.PPUBANK&#91; wScratch &gt;&gt; 10 &#93;&#91; wScratch &amp; 0x3FF &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bScratch = W.PPUBANK&#91; wScratch &gt;&gt; 10 &#93; &#91; wScratch &amp; 0x3FF &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr += &#40;S.PPU_R0 &amp; R0_INC_ADDR&#41; ? 0x20 : 0x01;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr &amp;= 0x3FFF;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return bScratch;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2004&#41;: /* SPR-RAM Read */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S.SPRRAM&#91; S.PPU_R3 &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2002&#41;:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_Latch_Flag = 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S.PPU_R2;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: /* $2000, $2001, $2003, $2005, $2006 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S.PPU_R7;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#125;<br /></div><br /><br />Write Operations:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;case 0x2000:&nbsp; /* PPU */<br />&nbsp; &nbsp; &nbsp; switch &#40; wAddr &#41;<br />&nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2000: /* PPU Control Register 1 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R0 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_SP_Height&nbsp; &nbsp; &nbsp;= &#40;S.PPU_R0 &amp; R0_SP_SIZE&#41; ? 0x10 : 0x08;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPU_BG = &#40;S.PPU_R0 &amp; R0_BG_ADDR&#41; ? S.ChrBuf + 0x4000 : S.ChrBuf;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPU_SP = &#40;S.PPU_R0 &amp; R0_SP_ADDR&#41; ? S.ChrBuf + 0x4000 : S.ChrBuf;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_NameTable = NAME_TABLE0 + &#40; S.PPU_R0 &amp; R0_NAME_ADDR &#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2001: /* PPU Control Register 2 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R1 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2002: /* PPU Status - NOT WRITABLE */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2003: /* Sprite RAM ADDR */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R3 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2004: /* Sprite RAM DATA */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.SPRRAM&#91; S.PPU_R3++ &#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2005: /* Scroll Register */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.PPU_Latch_Flag ^= 1&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R5A = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R5B = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.PPU_R5B &gt; 240&#41;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_NameTable ^= NAME_TABLE_V_MASK;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2006: /* VRAM Address Register */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.PPU_Latch_Flag ^= 1&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.PPU_R6A = byData;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0xFF&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &#40;&#40;word&#41; &#40;byData &amp; 0xFF&#41; &lt;&lt; 8&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.PPU_R6B = byData;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0xFF00&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &#40;&#40;word&#41; byData &amp; 0xFF&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr = S.vAddr_Latch &amp; 0x3FFF;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /></div><br /><br />Scroll development (called every scanline at the moment)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void NESCore_Develop_Scroll_Values&#40;&#41; &#123;<br /><br />&nbsp; S.PPU_SCROLL_Y_BYTE = &#40;S.vAddr &gt;&gt; 5&#41; &amp; 0x1F;<br />&nbsp; S.PPU_SCROLL_Y_BIT&nbsp; = &#40;S.vAddr &gt;&gt; 12&#41; &amp; 0x07;<br /><br />&nbsp; S.PPU_SCROLL_X_BYTE = &#40;S.vAddr &amp; 0x1F&#41;;<br />&nbsp; S.PPU_SCROLL_X_BIT&nbsp; = &#40;S.PPU_R5A &amp; 0x7&#41;;<br />&#125;<br /><br /></div><br /><br />Within DrawScanline:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;if &#40;!&#40; S.PPU_R1 &amp; R1_SHOW_SCR &#41;&#41;<br />&nbsp; &#123;<br />&nbsp; &nbsp; /* Clear scanline if display is off */<br />&nbsp; &nbsp; memset&#40; pPoint, 0, NES_DISP_WIDTH &lt;&lt; 1 &#41;; /* Assumes 16-Bit buffer! */<br />&nbsp; &nbsp; Exec6502&#40;&amp;S.m6502_state, 85&#41;;<br />&nbsp; &#125;<br />&nbsp; else<br />&nbsp; &#123;<br /><br />&nbsp; &nbsp; if &#40;S.PPU_Scanline == 0&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; S.vAddr = S.vAddr_Latch &amp; 0x3FFF;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; NESCore_Develop_Scroll_Values&#40;&#41;;<br /><br />...<br /></div><br /><br />Before HBLANK:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; S.vAddr = S.vAddr &amp; 0x41F | &#40;S.vAddr_Latch &amp; 0x41F&#41;;<br /></div>
<br />
<br />So far, things look wonky but I hope I'm close.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27045"></a>
				<b class="postauthor">dvdmth</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27045"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27045#p27045"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 6:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 22, 2006 8:00 am<br /><b>Posts:</b> 354
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I strongly recommend that you read Brad Taylor's PPU document:
<br />
<br /><!-- m --><a class="postlink" href="http://nesdev.com/2C02%20technical%20reference.TXT">http://nesdev.com/2C02%20techn ... erence.TXT</a><!-- m -->
<br />
<br />This explains in detail how the NES PPU works, inclusing how the BG and sprite layers are rendered and when during a scanline/frame things take place.
<br />
<br />Here's a summary of how the PPU address/scroll registers work:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">V = active VRAM address<br />T = VRAM address latch<br />X = fine X scroll register<br /><br />$2000 Write:<br />T = &#40;T &amp; 0x0C00&#41; | &#40;data &lt;&lt; 10&#41;;<br /><br />$2005 First Write:<br />T = &#40;T &amp; 0x7FE0&#41; | &#40;data &gt;&gt; 3&#41;;<br />X = data &amp; 0x07;<br /><br />$2005 Second Write:<br />T = &#40;T &amp; 0x0C1F&#41; | &#40;&#40;data &amp; 0x07&#41; &lt;&lt; 12&#41; | &#40;&#40;data &amp; 0xF8&#41; &lt;&lt; 2&#41;;<br /><br />$2006 First Write:<br />T = &#40;T &amp; 0x00FF&#41; | &#40;&#40;data &amp; 0x3F&#41; &lt;&lt; 8&#41;;<br /><br />$2006 Second Write:<br />T = &#40;T &amp; 0x7F00&#41; | data;<br />V = T;<br /><br />$2007 Write:<br />if &#40;&#40;V &amp; 0x3F00&#41; == 0x3F00&#41;<br />&nbsp; &nbsp; palette&#91;&#40;V &amp; 0x3&#41; ? V &amp; 0x1F : V &amp; 0x0F&#93; = data &amp; 0x3F;<br />else<br />&nbsp; &nbsp; PerformVRAMWrite&#40;V &amp; 0x3FFF, data&#41;;<br />V = &#40;V + &#40;&#40;$2000 &amp; 0x04&#41; ? 0x20 : 0x01&#41; &amp; 0x7FFF;<br /><br />$2007 Read:<br />if &#40;&#40;V &amp; 0x3F00&#41; == 0x3F00&#41;<br />&nbsp; &nbsp; data = palette&#91;&#40;V &amp; 0x3&#41; ? V &amp; 0x1F : V &amp; 0x0F&#93;;<br />else<br />&nbsp; &nbsp; data = readBuffer;<br />readBuffer = PerformVRAMRead&#40;V &amp; 0x3FFF&#41;;<br />V = &#40;V + &#40;&#40;$2000 &amp; 0x04&#41; ? 0x20 : 0x01&#41; &amp; 0x7FFF;<br /><br />Vertical Reset:<br />V = T;<br /><br />Horizontal Reset:<br />V = &#40;V &amp; 0x7BE0&#41; | &#40;T &amp; 0x041F&#41;;<br /><br />Vertical Increment:<br />V = &#40;V + 0x1000&#41; &amp; 0x7FFF;<br />if &#40;&#40;V &amp; 0x7000&#41; == 0&#41;<br />&#123;<br />&nbsp; &nbsp; V = &#40;V &amp; 0x7C1F&#41; | &#40;&#40;V + 0x20&#41; &amp; 0x03E0&#41;;<br />&nbsp; &nbsp; if &#40;&#40;V &amp; 0x03E0&#41; == 0x03C0&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; V = &#40;V &amp; 0x7C1F&#41; ^ 0x0800&#41;;<br />&#125;<br /><br />Horizontal Increment:<br />V = &#40;V &amp; 0x7FE0&#41; | &#40;&#40;V + 0x01&#41; &amp; 0x1F&#41;;<br />if &#40;&#40;V &amp; 0x1F&#41; == 0&#41;<br />&nbsp; &nbsp; V ^= 0x0400;</div>
<br />
<br />Vertical reset occurs at cycle 304 of the "dummy" scanline (in Brad Taylor's document, this is scanline 20).  Horizontal reset occurs once per scanline, including the dummy scanline, at cycle 257 (right after H-Blank).  Vertical increment occurs once per scanline as well, but at cycle 251 (shortly BEFORE H-Blank).
<br />
<br />Horizontal increment occurs 34 times per scanline, at cycle 3 of each 8-cycle rotation (that is, at cycles 3, 11, 19, 27, etc., as well as at cycles 323 and 331 at the end of H-Blank).
<br />
<br />It may not be possible to implement this and maintain full speed on devices such as the iPhone.  However, numerous NES titles rely on this behavior to work properly, so if your goal is accuracy, you'll have to implement it.  (Nestopia is an emulator that has this implemented, and it actually runs slower than some <strong>Super</strong> NES emulators, to give an idea.)</div>

					
						<div class="postbody"><br />_________________<br />"Last version was better," says Floyd. "More bugs. Bugs make game fun."</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=360"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27048"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27048"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27048#p27048"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 6:40 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Horizontal increment occurs 34 times per scanline, at cycle 3 of each 8-cycle rotation (that is, at cycles 3, 11, 19, 27, etc., as well as at cycles 323 and 331 at the end of H-Blank). </div>
<br />
<br />Is there a calculation that works on a per-pixel basis?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27051"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27051"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27051#p27051"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 7:31 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">As far as accuracy goes, I'd just like rad racer, smb3, and others to work - I don't need to run obscure japanese games, etc.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27058"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27058"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27058#p27058"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 4:54 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You do not need a per-pixel renderer to fix the gross graphical errors in games like Rad Racer and Crystalis. That only requires implementing rendering per scanline using the VRAM address. If your target platform is the iPhone or other handheld devices, then per-pixel rendering would be far too slow anyway.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27059"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27059"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27059#p27059"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 5:18 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Right now i just want to use whatever's going to get most of the popular games to run. I don't think I'm going to have enough resources for a perfect emulator. But if you guys can help get rad racer and others working that would be great. This is the latest state of the code, I think it's sick... 
<br />
<br />Read Ops:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; case 0x2000:&nbsp; /* PPU */<br />&nbsp; &nbsp; &nbsp; &nbsp; switch&#40; wAddr &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2007&#41;: /* VRAM Read */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.vAddr &lt;0x3F00&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch = S.vAddr;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch &amp;= 0x3FFF;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bScratch = S.PPU_R7;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R7 = W.PPUBANK&#91; wScratch &gt;&gt; 10 &#93;&#91; wScratch &amp; 0x3FF &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bScratch = W.PPUBANK&#91; wScratch &gt;&gt; 10 &#93; &#91; wScratch &amp; 0x3FF &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr += &#40;S.PPU_R0 &amp; R0_INC_ADDR&#41; ? 0x20 : 0x01;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr &amp;= 0x3FFF;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return bScratch;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2004&#41;: /* SPR-RAM Read */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S.SPRRAM&#91; S.PPU_R3 &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case &#40;0x2002&#41;:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_Latch_Flag = 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ret = S.PPU_R2;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R2 &amp;= 0x7F;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return ret;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default: /* $2000, $2001, $2003, $2005, $2006 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return S.PPU_R7;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; break;<br /></div><br /><br />Write Ops:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; case 0x2000:&nbsp; /* PPU */<br />&nbsp; &nbsp; &nbsp; switch &#40; wAddr &#41;<br />&nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2000: /* PPU Control Register 1 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R0 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_SP_Height&nbsp; &nbsp; &nbsp;= &#40;S.PPU_R0 &amp; R0_SP_SIZE&#41; ? 0x10 : 0x08;^M<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPU_BG = &#40;S.PPU_R0 &amp; R0_BG_ADDR&#41; ? S.ChrBuf + 0x4000 : S.ChrBuf;^M<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPU_SP = &#40;S.PPU_R0 &amp; R0_SP_ADDR&#41; ? S.ChrBuf + 0x4000 : S.ChrBuf;^M<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_NameTable = NAME_TABLE0 + &#40; S.PPU_R0 &amp; R0_NAME_ADDR &#41;;^M<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0xF3FF&#41; | &#40;&#40;word&#41;&#40;byData &amp; 3&#41; &lt;&lt; 10&#41;;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2001: /* PPU Control Register 2 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R1 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2002: /* PPU Status - NOT WRITABLE */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2003: /* Sprite RAM ADDR */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_R3 = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2004: /* Sprite RAM DATA */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.SPRRAM&#91;S.PPU_R3&#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2005: /* Scroll Register */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lowerBits = &#40;byData &amp; 7&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; upperBits = &#40;byData &gt;&gt; 3&#41;;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.PPU_Latch_Flag&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;byData &gt; 240&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_NameTable ^= NAME_TABLE_V_MASK;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0x8C1F&#41; | &#40;upperBits &lt;&lt; 5&#41; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#40;lowerBits &lt;&lt; 12&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0xFFE0&#41; | upperBits;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.PPU_R5A = lowerBits;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_Latch_Flag ^= 1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2006: /* VRAM Address Register */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.PPU_Latch_Flag&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;S.vAddr_Latch &amp; 0xFF00&#41; | byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr = S.vAddr_Latch;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;S.vAddr_Latch = &#40;&#40;byData &amp; 0x3F&#41; &lt;&lt; 8&#41; | &#40;S.vAddr_Latch &amp; 0xFF&#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPU_Latch_Flag ^= 1;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; case 0x2007: /* VRAM Data */<br />&nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch = S.vAddr;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wScratch &amp;= 0x3FFF;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr += &#40;S.PPU_R0 &amp; R0_INC_ADDR&#41; ? 0x20 : 0x01;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;S.vAddr &gt; 0x3FFF&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.vAddr &amp;= 0x3FFF;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &#40;wScratch &lt; 0x2000 &amp;&amp; S.VRAMWriteEnable&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Pattern Data */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.ChrBufUpdate |= &#40; 1 &lt;&lt; &#40; wScratch &gt;&gt; 10 &#41; &#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPUBANK&#91; wScratch &gt;&gt; 10 &#93;&#91; wScratch &amp; 0x3FF &#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if &#40;wScratch &lt; 0x3F00 &#41;&nbsp; /* 0x2000 - 0x3EFF */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Name Table and Mirror */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPUBANK&#91; &#40;wScratch&#41; &gt;&gt; 10 &#93;&#91; wScratch &amp; 0x3ff &#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; W.PPUBANK&#91; &#40;wScratch ^ 0x1000&#41; &gt;&gt; 10&#93;&#91; wScratch &amp; 0x3FF &#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if &#40;!&#40;wScratch &amp; 0xF&#41;&#41;&nbsp; /* 0x3F00 or 0x3F10 */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Palette Mirror */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPURAM&#91; 0x3f10 &#93; = S.PPURAM&#91; 0x3f14 &#93; = S.PPURAM&#91; 0x3f18 &#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = S.PPURAM&#91; 0x3f1c &#93; = S.PPURAM&#91; 0x3f00 &#93; = S.PPURAM&#91; 0x3f04 &#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = S.PPURAM&#91; 0x3f08 &#93; = S.PPURAM&#91; 0x3f0c &#93; = byData;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PalTable&#91; 0x00 &#93; = S.PalTable&#91; 0x04 &#93; = S.PalTable&#91; 0x08 &#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = S.PalTable&#91; 0x0c &#93; = S.PalTable&#91; 0x10 &#93; = S.PalTable&#91; 0x14 &#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = S.PalTable&#91; 0x18 &#93; = S.PalTable&#91; 0x1c &#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = NesPalette&#91; byData &#93; | 0x8000;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if &#40;wScratch &amp; 0x03&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Palette */<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PPURAM&#91; wScratch &#93; = byData;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; S.PalTable&#91; wScratch &amp; 0x1f &#93; = NesPalette&#91; byData &#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &#125;<br /></div><br /><br />Scroll Registers:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void NESCore_Develop_Scroll_Values&#40;&#41; &#123;<br /><br />&nbsp; S.PPU_SCROLL_Y_BYTE = &#40;S.vAddr &gt;&gt; 5&#41; &amp; 0x1F;<br />&nbsp; S.PPU_SCROLL_Y_BIT&nbsp; = &#40;S.vAddr &gt;&gt; 12&#41; &amp; 0x07;<br /><br />&nbsp; S.PPU_SCROLL_X_BYTE = &#40;S.vAddr &amp; 0x1F&#41;;<br />&nbsp; S.PPU_SCROLL_X_BIT&nbsp; = S.PPU_R5A;<br />&#125;<br /></div><br /><br />Increments:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; if &#40;!&#40; S.PPU_R1 &amp; R1_SHOW_SCR &#41;&#41;<br />&nbsp; &#123;<br />&nbsp; &nbsp; /* Clear scanline if display is off */<br />&nbsp; &nbsp; memset&#40; pPoint, 0, NES_DISP_WIDTH &lt;&lt; 1 &#41;; /* Assumes 16-Bit buffer! */<br />&nbsp; &nbsp; Exec6502&#40;&amp;S.m6502_state, 85&#41;;<br />&nbsp; &#125;<br />&nbsp; else<br />&nbsp; &#123;<br /><br />&nbsp; &nbsp; if &#40;S.PPU_Scanline == 0&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; S.vAddr = S.vAddr_Latch &amp; 0x7FFF;<br />...<br /><br />End of HBLANK<br /><br />&nbsp; &nbsp; S.vAddr = &#40;S.vAddr &amp; 0xFBE0&#41; | &#40;S.vAddr_Latch &amp; 0x41F&#41;;<br /><br /><br /></div>
<br />
<br />The last increment there after the hblank seems to break a lot of stuff as well, although more appears to be broken.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27062"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27062"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27062#p27062"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 7:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm getting a lot closer; implemented horizontal / vertical increments.  I think the biggest problem right now is selection of the proper name table. $2000 sets the name table, and $2005 flips it if bData &gt; 240. I also flip it locally inside my rendering routines for vertical / horizontal mirroring. Is there some other way I should be doing it? I tried reloading it after each clock, but that doesn't seem to set it right either.
<br />
<br />EDIT: It looks like nY is never &gt; 29 any more now that I'm doing it right, so how can I tell if I need to flip the name table?
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;/* Develop Scroll Values */<br />&nbsp; &nbsp; PPU_SCROLL_Y_BYTE = &#40;S.vAddr &gt;&gt; 5&#41; &amp; 0x1F;<br />&nbsp; &nbsp; PPU_SCROLL_Y_BIT&nbsp; = &#40;S.vAddr &gt;&gt; 12&#41; &amp; 0x07;<br />&nbsp; &nbsp; PPU_SCROLL_X_BYTE = &#40;S.vAddr &amp; 0x1F&#41;;<br />&nbsp; &nbsp; PPU_SCROLL_X_BIT&nbsp; = S.FineX; <br /><br />&nbsp; &nbsp; nY = PPU_SCROLL_Y_BYTE;<br />&nbsp; &nbsp; nX = PPU_SCROLL_X_BYTE;<br />&nbsp;<br />&nbsp; &nbsp; nYBit = PPU_SCROLL_Y_BIT; <br />&nbsp; &nbsp; nYBit &lt;&lt;= 3;<br />&nbsp;<br />&nbsp; &nbsp; /* Name Table Selection: Flip for vertical scrolling */<br />&nbsp; &nbsp; nNameTable = S.PPU_NameTable;<br />&nbsp; &nbsp; if &#40;nY &gt; 29&#41; &#123;&nbsp; &lt;-------- NEVER TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; nY -= 30;&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; nNameTable ^= NAME_TABLE_V_MASK;<br />&nbsp; &nbsp; &#125;<br /></div>[/quote]</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27063"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27063"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27063#p27063"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 8:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9048<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">NerveGas wrote:</div><div class="quotecontent">EDIT: It looks like nY is never &gt; 29 any more now that I'm doing it right, so how can I tell if I need to flip the name table?</div>
<br />You don't "flip" VRAM address bit 11 ($0800) when a "high" Y scroll value is written through $2005 or $2006. The hardware renders rows 30, 31, 0, 1, 2, 3, ... of a single nametable. Bit 11 changes during rendering only when the VRAM address updates after the bottom line of row 29.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27064"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27064"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27064#p27064"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 8:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ah ok, so I get it from vAddr... how often should i update that, every scanline?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27077"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27077"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27077#p27077"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 18, 2007 7:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Awright well things are finally starting to shape up, SMB3 is running properly, and rad racer looks good except for a few glitches (some gaps, and tracks in the distance are choppy). Overall though, a lot of games are rendering properly now. 
<br />
<br />One strange thing that happened - rolling thunder and gi joe no longer run at all. They didn't run to begin with, after forking the project, but with a little massaging of the PPU, they did come up for a bit. Now I just get a blank screen once again, and I can tell they haven't initialized. Any ideas what might be causing this?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27127"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27127"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27127#p27127"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Sep 21, 2007 9:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm having trouble figuring out a good way to get the code running on Windows. Are you doing all your testing on the iPhone?
<br />
<br />What is the current speed of execution on the iPhone? Does it require frameskipping?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27138"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27138"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27138#p27138"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Sep 22, 2007 8:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think we figured out rolling thunder and GI joe...there's a crucial 6-steps between vblank and the NMI that need to get executed. We also weren't counting the 512 steps for DMA... fixing all that seemed to fix everything in the code.
<br />
<br />On the iphone, it's auto-frameskip...i'm getting around 1 or 2 skip. It still runs pretty smooth.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27156"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27156"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27156#p27156"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Sep 22, 2007 2:01 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm trying to think of ways that the rendering code might be optimized. It should be possible to draw 2 pixels per operation by using a short (16x4) look-up table to convert the planar bits to a 32-bit int. Do you happen to know if there's a penalty for unaligned DWORD-length writes on the iPhone's ARM CPU? That would make a difference in how such an algorithm would be implemented.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27158"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27158"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27158#p27158"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Sep 22, 2007 2:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm not sure, but you can try it. Another method might be to try using OpenGL ES instead of CoreSurfaces. I suspect, though, that OpenGL would have to go through CoreSurfaces, so that may prove counter-intuitive.
<br />
<br />I'd like to find ways to optimize the mapper 5 code...it appears to run _very_ slow. Making Castlevania III and other mapper 5 games run may prove more useful than optimizing video.
<br />
<br />My current hit list is:
<br />- Mapper 5 too slow / not completely right
<br />- Mapper 119 (Which should be the same as mapper 4, but with RAM/ROM selection on bit 6); yet pinbot and high speed don't render properly.
<br />- Rad Racer 2 has a completely mangled background
<br />- When I set VBLANK START to 141 (where it should be) instead of 143, weird things happen in Mach Rider (screen flicker); trying to find the root of the problem.
<br />- Star Wars doesn't initialize
<br />- Cool Spot doesn't initialize
<br />- Green background in Fantasy Zone
<br />- Kung Fu and Rad Racer render OK, but due to (possibly) sprite hit stuff (which jodan is working on fixing), there is some distortion
<br />- Punchout / Mike Tyson's Punchout has some rendering glitches on the title screen and in-between certain rounds (such as Von Kaiser)
<br />- NES Scroll Test still fails vertically (might just be a lame test)
<br />- TMNT 3 doesnt initialize
<br />- Videomation appears to be broken (mapper problem?)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=3585&amp;start=15"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=3585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=3585&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=3585">1</a><span class="page-sep">, </span><strong>2</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google [Bot]</span> and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="3585" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
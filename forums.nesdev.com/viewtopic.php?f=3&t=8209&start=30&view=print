<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - NTSC color palette emulation, with the square wave modulator</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">NTSC color palette emulation, with the square wave modulator</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=8209">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=8209</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>3</strong> of <strong>10</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun Oct 16, 2011 3:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">beannaich wrote:</div><div class="quotecontent">ask and ye shall receive</div>
<br />
<br />The colors are inverted. Funny. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />Plus, the background color of SMB1. Should it be purple or blue? We get a blue with HUE +1 (30 degrees), but other colors (like Mario colors) become purple-ished.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Sun Oct 16, 2011 5:23 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />nice job!  I tried this with my emulator (increased the saturation a bit), and it looks great!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beannaich</b> [ Sun Oct 16, 2011 6:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">The colors are inverted. Funny. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>
<br />Inverted? Weird. I suggest you just generate one for yourself then, seeing how it's not hard to port to any language.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun Oct 16, 2011 7:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">beannaich wrote:</div><div class="quotecontent"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">The colors are inverted. Funny. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div><br />Inverted? Weird. I suggest you just generate one for yourself then, seeing how it's not hard to port to any language.</div>
<br />
<br />Yup, I had to do a XOR $FF to fix the palette.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beannaich</b> [ Mon Oct 17, 2011 3:46 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Haha, I must have generated your palette while I was making my "negative" palette!
<br />
<br />sorry zepper

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Oct 17, 2011 8:14 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />No problem. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />Back to my question...
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Plus, the background color of SMB1. Should it be purple or blue? We get a blue with HUE +1 (30 degrees), but other colors (like Mario colors) become purple-ished.</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beannaich</b> [ Mon Oct 17, 2011 8:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Plus, the background color of SMB1. Should it be purple or blue? We get a blue with HUE +1 (30 degrees), but other colors (like Mario colors) become purple-ished.</div>
<br />
<br />As far as I can remember, the background was slightly purple on my tube television back in the early 90's. Of course, that answer is stooped in subjectivity, and different televisions with different settings would produce different results. But it's not at all out of the ordinary for SMB's background to be a light-tone blue-purple mix, while all the other colors look "normal".
<br />
<br />Hope that helps answer your question.
<br />
<br />edit: <a href="http://imageshack.us/photo/my-images/560/capturexy.png/" class="postlink">here</a> is what it looks like running on nintemulator

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Eugene.S</b> [ Wed Oct 19, 2011 5:31 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><strong>Bisqwit: </strong>http://bisqwit.iki.fi/utils/nespalette.php -- create and download tailor made NTSC palette with this tool. </div>
<br />
<br />Can you make standalone-generator, please?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bisqwit</b> [ Wed Oct 19, 2011 5:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Eugene.S wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><strong>Bisqwit: </strong>http://bisqwit.iki.fi/utils/nespalette.php -- create and download tailor made NTSC palette with this tool. </div><br />Can you make standalone-generator, please?</div>
<br />I think mr. beannaich made one in Java, I presume it could be used as a standalone program. beannaich?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kinopio</b> [ Wed Oct 19, 2011 7:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The NES palette has always interested me. I wrote an NES program that shows all 64 colors and then ran it (powerpak) on the consoles I own (pal, ntsc, famicom av). I captured the result to PC with my philips video card and then used another program I created to get a 192 byte pal-file from the captured image.
<br />
<br />Finding a video capture setting (hue, brightness, etc) that matched what my pal-tv displayed and looked good to me was the hardest part, but I think I eventually found some pretty good settings and nice looking palettes.
<br />
<br />Here are captured screens with my nes palette viewer running on NTSC and PAL consoles. Famicom is very close to NTSC (obviously) so it's not shown.
<br />
<br />NTSC:
<br /><a href="http://imageshack.us/photo/my-images/402/ntscpalettecaptured.png/" class="postlink"><img src="http://img402.imageshack.us/img402/9426/ntscpalettecaptured.th.png" alt="Image" /></a>
<br />
<br />PAL:
<br /><a href="http://imageshack.us/photo/my-images/257/palpalettecaptured.png/" class="postlink"><img src="http://img257.imageshack.us/img257/5500/palpalettecaptured.th.png" alt="Image" /></a>
<br />
<br />
<br />Even though I liked the palettes created from this I've always felt that this is something like a "hack" and generating the palette in code is a much better way. The problem is that I've tried many different palette generators and never really liked the result. Mostly because they don't match my captured palettes very good. Perhaps I just couldn't find the right settings? Other strange thing is that the default setting in palette generators produce something more like my captured PAL-palette even though they are supposed to be NTSC-generators?
<br />
<br />So I'm wondering if you Bisqwit or someone else can tell me what settings I should use in a palette generator to match my captured palettes (PAL and NTSC)?
<br />
<br />And is Bisqwit's generator closest to the "real thing"? I was under the impression that not enough is known about exactly how the PPU generates colors to correctly emulate it?
<br />
<br />And if anyone is interested I've uploaded the nes palette viewer rom and program I mentioned above (use at own risk). Also included are the pal-files if someone wants to try them in emulators.
<br /><!-- m --><a class="postlink" href="http://www.mediafire.com/?9rniim958a31eys">http://www.mediafire.com/?9rniim958a31eys</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Wed Oct 19, 2011 7:44 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That problem with that approach is that you're at the mercy of how your video capture device encodes the colors.
<br />
<br />edit: Palette version:  (NTSC)
<br /><img src="http://i.imgur.com/yjzks.png" alt="Image" />
<br />
<br />And PAL:
<br /><img src="http://i.imgur.com/q2zwn.png" alt="Image" />
<br />
<br />
<br />Edit:
<br />It's not my palette, it's Kinopio's.
<br />I took the pictures of Kinopio's palette, and turned it into solid colors with palette attached.  The original image did not have solid colors, you'll notice that there are striped patterns and stuff like that in there, almost as if it was saved as a JPEG first.  So I took the average of the inside of the squares by using a mosaic filter in Photoimpact.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Wed Oct 19, 2011 7:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Kinopio wrote:</div><div class="quotecontent">I was under the impression that not enough is known about exactly how the PPU generates colors to correctly emulate it?</div>We know exactly how the PPU generates color. The problem is that every television parses the output slightly differently, and so there isn't <strong>one</strong> correct palette.
<br />
<br />(For example: US NTSC has a black level at 7 IRE that's not the same as not-sync (0 IRE), making the NES's colors more saturated and darker than the Famicom's. Televisions that implement proper YIQ decoding will blur some colors more than those that just do YUV decoding. And some televisions actually distort the colorspace transform to RGB to "enhance skin tones", whatever that means to the NES)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ReaperSMS</b> [ Wed Oct 19, 2011 8:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I recall kevtris mentioning that the video signal as seen by his scope wasn't a straight square wave, because of the video filtering in the system already. He mentioned it looking like a somewhat distorted, slightly lopsided sin wave.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>HardWareMan</b> [ Wed Oct 19, 2011 10:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: NTSC color palette emulation, with the square wave modul</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent">Reading the NTSC encoder page at <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/NTSC_video">http://wiki.nesdev.com/w/index.php/NTSC_video</a><!-- m --> , I decided to create my own palette synthesizer based on the description. I first looked upon Blargg's nes_ntsc, but it seems to use a sinewave rather than the described squarewave for the color synthesis.</div>
<br />Not entirely true. Of course, the PPU produces a square subcarrier of color. But between the PPU and the decoder has a lot of electronics and transformations. Even if you omit the RF channel, suggesting a connection via AV, is present even here a couple of stages of amplifiers or repeaters (the two-stage repeater are directly connected to the PPU video output). These circuits have limited bandwidth, so the square wave (which theoretically requires infinitely high frequency) can be integrated into almost a triangle. I see this on an oscilloscope even on AV output. Something like this:
<br /><img src="http://savepic.su/403755.png" alt="Image" />
<br />So, we have some additional phase shift, which is critical for PAL/NTSC systems. And this shift is slightly distorts the resulting color. Here the video (yellow) and the signal F2 (blue):
<br /><a href="http://savepic.su/457002.png" class="postlink"><img src="http://savepic.su/457002m.png" alt="Image" /></a>
<br />If you increase the color burst, you can see that it is not rectangular, as expected.
<br /><a href="http://savepic.su/454954.png" class="postlink"><img src="http://savepic.su/454954m.png" alt="Image" /></a>
<br />Your move. :3

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ReaperSMS</b> [ Thu Oct 20, 2011 12:21 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In theory, the phase shift should cancel out. Yes, the colorburst is shifted, but the color is determined by the phase relationship between the colorburst and the mid-line chroma signal, which should be hit with the same phase shift.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>3</strong> of <strong>10</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
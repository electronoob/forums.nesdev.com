<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - PPU Memory Access per-cycle list?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">PPU Memory Access per-cycle list?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=6213">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=6213</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beaub</b> [ Tue Mar 23, 2010 7:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>PPU Memory Access per-cycle list?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If all PPU registers are 0, and the cart does absolutely nothing (or not present), what address does the PPU read per-cycle for a frame? IE:
<br />0: 0x2000
<br />1: 0x2000
<br />2: 0x2000
<br />3: 0x2001
<br />4: 0x2001
<br />5: 0x2001
<br />6: 0x2001
<br />7: 0x2001
<br />8: 0x2001
<br />9: 0x2001
<br />10: 0x2001
<br />11: 0x2002
<br />12: 0x2002
<br />13: 0x2002
<br />14: 0x2002
<br />15: 0x2002
<br />16: 0x2002
<br />17: 0x2002
<br />18: 0x2002
<br />19: 0x2003
<br />
<br />I am trying to get cycle/pixel accurate using loopy_v/t. It would be a great resource if known cycle/pixel accurate emulators had this information in a table format.
<br />
<br />I've looked at other emulators source, but a lot of them do not use the full PPU address space as laid out in an actual NES. IE: Access name tables via nametable[x] instead of PPU.Memory[0x2000 + x].
<br />
<br />It's mostly hard to determine when to reset the address from the latch (V=T in loopy terms) during rendering cycles.
<br />
<br />Thanks.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cpow</b> [ Tue Mar 23, 2010 9:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: PPU Memory Access per-cycle list?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">beaub wrote:</div><div class="quotecontent">what address does the PPU read per-cycle for a frame? <br /><br />It's mostly hard to determine when to reset the address from the latch (V=T in loopy terms) during rendering cycles.<br /><br />Thanks.</div>
<br />
<br />I certainly won't claim expert on this, but if you're looking for what the PPU is doing, NESICIDE2 gives a cycle-by-cycle dump.  It includes real PPU fetches, garbage fetches, and the extra cycle.  It also shows when the CPU is doing accesses to the PPU memory.
<br />
<br />It is <a href="http://www.gitorious.org/nesicide/nesicide2-master" class="postlink">here</a>.  Unfortunately there's no installer yet but if you ask on #nesicide or here someone can probably build you one.  [I'm hoping for some installer help!]
<br />
<br />The dump I'm talking about is available in the Execution Inspector by clicking on "Show PPU Execution" checkbox.  The Execution Inspector is in the menus View-&gt;Debugger-&gt;Execution Inspector.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Tue Mar 23, 2010 9:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Look at the Nintendulator source code.  It's the easiest to read summary of what the PPU does at each cycle.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beaub</b> [ Fri Mar 26, 2010 8:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So what's the story with cycle 323 and 331?
<br />
<br />It appears as though the PPU pre-fetches the last 2 tiles per-scan line and these cycles essentially setup the pre-fetched tiles to the right location in memory for the next scan line to fetch them from?
<br />
<br />I noticed that after the first scan line, each line after that begins at an address 2 more than the previous one (2 tiles more).
<br />
<br />Can someone explain this a bit better? Or acknowledge this? Is there a good document on what the hardware really does to pre-cache these tiles?
<br />
<br />Thanks again.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cpow</b> [ Sat Mar 27, 2010 6:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">beaub wrote:</div><div class="quotecontent">So what's the story with cycle 323 and 331?<br /><br />It appears as though the PPU pre-fetches the last 2 tiles per-scan line and these cycles essentially setup the pre-fetched tiles to the right location in memory for the next scan line to fetch them from?<br /><br />I noticed that after the first scan line, each line after that begins at an address 2 more than the previous one (2 tiles more).<br /><br />Can someone explain this a bit better? Or acknowledge this? Is there a good document on what the hardware really does to pre-cache these tiles?<br /><br />Thanks again.</div>
<br />
<br />This is one of the reasons for the pre-render scanline, from what I can tell.  It fills what I call the "pixel pipeline" for the first rendered scanline.
<br />
<br />In each scanline the two tile fetches at the end of the scanline are for the next one.  
<br />
<br />Consider the case where the X-scroll is set to 7.  That means that 1 pixel from the first tile and 7 pixels from the second tile need to be displayed right away when the PPU starts rendering the next scanline.  If it had to fetch the data for those two tiles at the beginning of the scanline there'd be missing graphics on the left side [It takes 8 PPU clocks to fetch all the pieces required to render a tile, 1 NT byte, 1 AT byte, and 2 tile planes].  
<br />
<br />So the 2-tile fetches fill a 16-bit shift register ["pixel pipeline"] which is siphoned off at the X-scroll position when rendering the scanline.  Then as the subsequent tiles are fetched they fill the second 8-bits of tte 16-bit shifter for seamless rendering.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
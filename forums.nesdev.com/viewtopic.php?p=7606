<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Any standardized savestate format?</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Any standardized savestate format?" href="http://forums.nesdev.com/feed.php?f=3&amp;t=838" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=838';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 4:15 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=838">Any standardized savestate format?</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=838"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 25 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=838&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=838&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=838&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=838&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=838&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7546"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7546">Any standardized savestate format?</a></div><div style="float: right;"><a href="./viewtopic.php?p=7546#p7546"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 19, 2005 1:59 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_online.gif" alt="Online" title="Online" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 2546
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Are there any standardized savestate formats to use, or does each emulator need to create its own custom incompatible proprietary format?</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7547"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7547"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7547#p7547"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 19, 2005 2:48 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">There was some discussion of one earlier this year ("<a href="http://nesdev.com/bbs/viewtopic.php?t=423" class="postlink">RSNS Savestate Proposal</a>") but it didn't continue for very long. I've also done some further work on it in my emulator (including a movie format with one or more key frames for quick seeking). I'm interested in working on a common format, but only if it's done carefully and based on experimentation with alternative designs before committing to one.
<br />
<br />If you're interested in doing some design work, it might be good to refine some ideas in e-mail and then present them here.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7559"></a>
				<b class="postauthor" style="color: #AA0000">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7559"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7559#p7559"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 19, 2005 4:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1028
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">SNSS was the only real attempt at a standardized savestate format. It did not work, for several reasons:
<br />
<br />1. It was difficult to use - multibyte values were stored in BIG ENDIAN, requiring nearly all emulators to use byte-swapping code (considering a vast majority of NES emulators run on LITTLE ENDIAN hardware). The reason given was to make it more "human readable", which is completely ridiculous as it is a BINARY file format.
<br />
<br />2. It didn't divide information into separate blocks properly. The state for the CPU and PPU were crammed together into a single "base registers" block.
<br />
<br />3. It didn't store enough detail. The CPU state had nothing for interrupts or open bus, the PPU state had nothing for the VRAM address latch (or the value that lingers on the PPU I/O bus and which is readable from any write-only register), and the APU state block held nothing but the last values written to $4000-$4013 and $4015, which is horribly insufficient for proper emulation.
<br />
<br />4. Some state information was stored in the wrong place. The PPU block stored the current mirroring state, and the mapper block directly stored the current 8KB PRG ROM and 1KB CHR ROM banks mapped at $8000-$FFFF and $0000-$1FFF, respectively. Information like this should be encoded within the "custom mapper state" to take up an optimum amount of space, as well as allow additional detail to be stored (such as RAM banks mapped, along with write protection). The "SRAM" block also contained a "write enable" bit (which wasn't even documented properly, labeled as "0=no, &gt;0=yes"), which properly belongs within the mapper state.
<br />
<br />5. The Mapper state block was too restrictive. It allocated exactly 128 bytes for mappers to store their state information. For more complex mappers, such as the FDS, the Namco 106, and VRC7, this was not enough to store the complete state of their sound logic. For simpler mappers (such as UNROM, CNROM, or even NROM) it was a complete waste of space, since these mappers could store their complete state in a single byte (or in no space at all, in the case of NROM).
<br />
<br />6. Some state data wasted space where not necessary - as mentioned above, the "custom mapper state" was fixed at 128 bytes even if the mapper itself stored only a single byte within it. Controller data was fixed to 4 bytes per frame including a "repeat count", and always stored data for both controllers (even if a 2nd controller was not even connected). PRG RAM (SRAM) was always stored in 4KB multiples (along with a "write enable" byte which doesn't even belong there - see #4), and the same was true for CHR RAM (VRAM) except for the "write enable" bit.
<br />
<br />7. Some types of data were not stored at all, such as applied Game Genie codes or updated disk data on FDS games.
<br />
<br />8. The "mapper state" blocks were ridiculously over-simplified, containing only the information which was not implied by the other bits of mapper-related state scattered throughout the rest of the file (again, see #4). The MMC3 state consisted of only four bytes - the IRQ counter, the IRQ latch, the IRQ counter enable, and the last value written to $8000 (by comparison, the MMC3 state in my emulator is 16 bytes long).
<br />
<br />9. It pandered to obsolete file systems by restricting itself to the extensions .SS0 through .SS9 and supporting only 10 savestates, even though it was used almost exclusively on Windows 9x/NT, which has no such limitation.
<br />
<br />
<br />If anyone is to attemp to devise a new "standard savestate format", it would be highly advised to avoid making these same mistakes again.
<br />
<br />The main problem is that not all emulators are created equally - some are more precise than others. If you implement a savestate format according to a less precise emulator (like Nesticle), more accurate emulators will be unable to use it (as it will not properly preserve the system state they are maintaining). If you implement it according to a more precise emulator (like Nintendulator), then less precise emulators won't be able to fill in all of the necessary state information and, as a result, savestates created by them will not work correctly with more precise emulators. Even if you pick a "middle ground", you'll still run into the same problem, though with fewer casualties.</div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7561"></a>
				<b class="postauthor">danimal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7561"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7561#p7561"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 19, 2005 6:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 16, 2005 6:38 pm<br /><b>Posts:</b> 47<br /><b>Location:</b> Fullerton, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A standardize format would be great.  I would be willing to help.  Send a pm on the board to exchange email.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=241"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7562"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7562"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7562#p7562"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 19, 2005 9:22 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hmmm, your last point dwarfs everything else. The main functionality that would be nice is basic transfer of saved games. That's one nice thing about battery RAM saves; the format can be standard for all emulators. But of course implementing similar for save states might require full accuracy when restoring the state.
<br />
<br />Quietust, are you interested in exploring the issue of whether it's even possible to design a format that captures all information, but doesn't require Nintendulator's level of emulation to properly fill out? At the core, it's an issue of finding the smallest "state bottleneck" to save state at. If it's an impossibility, I'd like to see clearly why.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7583"></a>
				<b class="postauthor">baisoku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7583"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7583#p7583"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Dec 21, 2005 8:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=35.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Nov 11, 2004 5:30 am<br /><b>Posts:</b> 121<br /><b>Location:</b> San Francisco, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Agreed, <a href="http://snss.baisoku.org" class="postlink">SNSS</a> is a pile. Most of its failings, save the lack of maintenance, have been described by Quietust above. Let's never mention it again.
<br />
<br />I'm wary of another format. Basically, if a new piece of information is discovered, say blargg's APU clock jitter, does that invalidate all previous savestates? Really, if emulators don't have similar implementations of some systems, it will be hard to make the library work for everything.
<br />
<br />It might be easier just to make an extremely accurate NES emulation library available. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					
						<div class="postbody"><br />_________________<br />...patience...</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=35"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7596"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7596"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7596#p7596"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Dec 21, 2005 3:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Basically, if a new piece of information is discovered, say blargg's APU clock jitter, does that invalidate all previous savestates?</div>
<br />
<br />This argument also applies to save states from older versions of the <em>same</em> emulator. This seems like a good miniature version of the problem to work on. The only reasonable approach seems to be filling in missing information and hoping for the best. There could still be code which doesn't work in this hybrid case, but does work with both the old version and new version. A contrived example would be code which determined which version it was running on, then kept verifying that it was running on the same version (i.e. checks for APU jitter, then keeps checking whether it magically started being emulated in the middle of the run, broken by a save state and restore in the new emulator).
<br />
<br />The issue of discovery of new details is problematic. What comes to mind for me is the <a href="http://nesdev.com/wiki/?page=PPU+Frame+Timing" class="postlink">NMI suppression behavior</a> I recently mapped out. One approach regarding a common file format is to deal with each new discovery individually, perhaps adding new fields that override the old ones and defining what a newer emulator should put into the old fields. If a few of us can spend some time considering actual scenarios, without rushing to something, I think progress can be made on the question of whether it's possible, and if so, how to achieve it. While we're on the subject, it's extremely time-intensive to reliably map out the details of these things. There are so many fallible links in the reverse-engineering chain for a given test that it requires hours of careful design to do tests on a given aspect.
<br />
<br />So far it's clear that the best compatibility of save states between emulators wouldn't likely exceed that of the <em>same</em> emulator with older versions of itself. To take a more black-box empirical approach, how about we do some actual tests of moving save states between our emulators for common games to see how well it works in practice? I think that would give most of the benefits of perfect compatibility at a fraction of the cost.
<br />
<br />I just got an image of the kinds of processes we're dealing with at an information level. There are some which amplify differences (open-loop) and others which suppress them (closed-loop). For example a random number seed loop amplifies small timing differences, while an infinite loop that waits for the next NMI suppresses them. What matters is that any differences in system state when restoring in a different emulator are not picked up by amplifying processes. The NMI suppression is a great example of a hardware-level amplifier: reading from $2002 at one particular PPU clock out of the almost 90000 per frame can suppress the NMI and thus cause very different behavior for that frame. Fortunately most games are written to suppress long-term effects of this, even though it might cause a doubled frame in the short-term.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7598"></a>
				<b class="postauthor">danimal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7598"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7598#p7598"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Dec 21, 2005 4:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 16, 2005 6:38 pm<br /><b>Posts:</b> 47<br /><b>Location:</b> Fullerton, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ideas:
<br />
<br />Wouldn't it be less complicated to limit the place where you can save the state, such as only between frames and instructions.  (immediately before VBLANK) Based on my board readings emulators render Video VBLANK by VBLANK and cpu instruction by instruction.
<br />
<br />Using standardized descriptions we could also have a set of imprecise ones that would not be too difficult to solve into a more precise state.  Less precise emu should be able to interpret the states of the more precise emu always (as long as that emu support the game), but not the other way around.  Using the imprecise definitions the more precise emulators could make an educated guess based on the ROM or user input.
<br />
<br />I know a binary format will save space compared to this but using xml with utf-8 encoding would allow easy manual editing, parsing, and be more platform independent.  Short descriptive words and phrases or hex values could be used.  Since this is a single byte text format (ie not utf-16 or 32)  endianness would not be a problem, also mutiple save states could be contained into a single file. This website has a basic tutorial of what xml is and how it works <a href="http://www.w3schools.com/xml/default.asp" class="postlink">http://www.w3schools.com/xml/default.asp</a>
<br />
<br />Hope I was not as confusing as any of my previous posts.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=241"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7606"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7606"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7606#p7606"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Dec 22, 2005 4:08 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Wouldn't it be less complicated to limit the place where you can save the state, such as only between frames and instructions?</div><br /><br /><em>Certainly</em>. That was what my "find the state bottleneck" was about. And actually, the bottleneck is smaller just after the NMI has been vectored (due to the NMI suppression behavior I mentioned above).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Less precise emu should be able to interpret the states of the more precise emu always (as long as that emu support the game), but not the other way around.</div><br /><br />It needs to be the other way around, because it's the more precise emulators that will get even moreso with the discovery of new information. A (impractical) brute-force approach to this would be to store multiple versions of state so that less-precise emulators would use the older subset, with a new version spawned for each new set of discoveries. But this kind of intricate bloat would likely be rejected, so the approach to this issue will have to be more streamlined.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I know a binary format will save space compared to this but using xml with utf-8 encoding would allow easy manual editing, parsing, and be more platform independent.</div>
<br />
<br />I'm quite sure that XML would be rejected by most emulator authors, not just due to space, but many issues. It has to be straightforward to parse with only a page or so of ANSI C code. Using a simple binary variable-sized block format with nesting would be more than sufficient.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7642"></a>
				<b class="postauthor">danimal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7642"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7642#p7642"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Dec 23, 2005 3:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 16, 2005 6:38 pm<br /><b>Posts:</b> 47<br /><b>Location:</b> Fullerton, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">blargg wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Less precise emu should be able to interpret the states of the more precise emu always (as long as that emu support the game), but not the other way around.</div><br /><br />It needs to be the other way around, because it's the more precise emulators that will get even moreso with the discovery of new information. A (impractical) brute-force approach to this would be to store multiple versions of state so that less-precise emulators would use the older subset, with a new version spawned for each new set of discoveries. But this kind of intricate bloat would likely be rejected, so the approach to this issue will have to be more streamlined.<br /></div><br /><br />Coping with variation in version is something xml can handle, unknown tags are easily skipped.  Since there are emulators that can handle just about every game I doubt there will be any new discoveries that are so fundamental to require a major update.  Instead of taking a "what each thing does" approach a "what is the value of this thing" may be a better way to look at things.  The values (or configuration) of these things in the hardware are the basis for modelling of all emu's. (Registers, blocks of ram, mirroring bits, etc). <br /><br />This scenario is what i imagine happening with emu's of different precision use the same save state:<br />Consider an emu that does not support sound save states generated from emu would not work well in another that does support sound.  If the situtation were revered the save state would work well.  The best way I see of coping with this situtation would be to implement the APU registers as 0 initalized ram and write any updates to the section of the file.  There may be enough data for an a precise emu to cope with but eventually, by change of the stage for example, it would be able to continue with sound emulation.<br /><br />Having a minimum level of information must be a part of the standard.<br /><br /><div class="quotetitle">blargg wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I know a binary format will save space compared to this but using xml with utf-8 encoding would allow easy manual editing, parsing, and be more platform independent.</div><br /><br />I'm quite sure that XML would be rejected by most emulator authors, not just due to space, but many issues. It has to be straightforward to parse with only a page or so of ANSI C code. Using a simple binary variable-sized block format with nesting would be more than sufficient.</div>
<br />
<br />I understand that authors would want something very easy to code, however 1 page seems ambitious to me.  Unless there was a library that was doing all the leg work.  If there were a common library, I imagine calling something like getUchar ("/savestate/nes/cpu/register$value=&quot;x\'") to poll for information.  I know xml will lend itself to that formatting.  Xml already has several libraries availible for it too. 
<br />
<br />Another varition is a single file with an xml portion and binary block section.  It would prevent editing with some text editors but a hybrid file seems easy enough to do.
<br />
<br />Whether or not we can decide how we save the data, we need to talk about what to save.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=241"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7644"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7644"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7644#p7644"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Dec 23, 2005 5:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The APU state is a good example. If an emulator isn't handling it at all, any games which use the APU interrupt or poll the status register won't work, thus we can assume that no save states lacking APU state will be using the APU. The default state should have everything silent and the frame interrupt disabled ($4017=$40).
<br />
<br />As far as file format, about the simplest I can come up with that is extensible is the AIFF chunk style, where the file is a series of data blocks, each having a header with a fixed-length type tag and a fixed-length size, followed by size data bytes. This is easy to write and read without any extra state information. Any additional complexity in reading and writing has to give some useful benefit.
<br />
<br />Here's something I just threw together as an example. The use of an end marker block allows nested groups of blocks, for example when you have multiple save states at the key frames in a movie file. Note how it also allows expansion of a given block, with older emulators reading a subset of the data, and newer emulators only reading as much data as the file provides.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void write_block&#40; long type, long size, const void* in, FILE* out &#41;<br />&#123;<br />&nbsp; &nbsp; unsigned char b &#91;8&#93; = &#123; type, type&gt;&gt;8, type&gt;&gt;16, type&gt;&gt;24,<br />&nbsp; &nbsp; &nbsp; &nbsp; size, size&gt;&gt;8, size&gt;&gt;16, size&gt;&gt;24 &#125;;<br />&nbsp; &nbsp; fwrite&#40; b, 8, 1, out &#41;;<br />&nbsp; &nbsp; fwrite&#40; in, size, 1, out &#41;;<br />&#125;<br /><br />void write_state&#40; FILE* file &#41;<br />&#123;<br />&nbsp; &nbsp; write_block&#40; 'NAPU', sizeof &#40;apu_state&#41;, &amp;apu_state, file &#41;;<br />&nbsp; &nbsp; write_block&#40; 'NPPU', sizeof &#40;ppu_state&#41;, &amp;ppu_state, file &#41;;<br />&nbsp; &nbsp; /* etc... */<br />&nbsp; &nbsp; write_block&#40; 'endb', 0, &quot;&quot;, file &#41;;<br />&#125;<br /><br />void read_data&#40; long size, void* out, FILE* in &#41;<br />&#123;<br />&nbsp; &nbsp; unsigned char b &#91;4&#93;;<br />&nbsp; &nbsp; if &#40; fread&#40; b, 4, 1, in &#41; &#41;<br />&nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; long actual = b&#91;3&#93;&lt;&lt;24 | b&#91;2&#93;&lt;&lt;16 | b&#91;1&#93;&lt;&lt;8 | b&#91;0&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; fread&#40; out, &#40;size &lt; actual ? size : actual&#41;, 1, in &#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40; actual &gt; size &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fseek&#40; in, actual - size, SEEK_CUR &#41;;<br />&nbsp; &nbsp; &#125;<br />&#125;<br /><br />void read_state&#40; FILE* file &#41;<br />&#123;<br />&nbsp; &nbsp; unsigned char b &#91;4&#93;;<br />&nbsp; &nbsp; while &#40; fread&#40; b, 4, 1, file &#41; &gt; 0 &#41;<br />&nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; switch &#40; b&#91;3&#93;&lt;&lt;24 | b&#91;2&#93;&lt;&lt;16 | b&#91;1&#93;&lt;&lt;8 | b&#91;0&#93; &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; case 'NAPU':<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_data&#40; sizeof apu_state, &amp;apu_state, file &#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; case 'NPPU':<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; read_data&#40; sizeof ppu_state, &amp;ppu_state, file &#41;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; /* etc... */<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; case 'endb':<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fseek&#40; file, 4, SEEK_CUR &#41;; // skip size<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br />&nbsp; &nbsp; &nbsp; &nbsp; &#125;<br />&nbsp; &nbsp; &#125;<br />&#125;<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7645"></a>
				<b class="postauthor">danimal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7645"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7645#p7645"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Dec 23, 2005 6:37 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 16, 2005 6:38 pm<br /><b>Posts:</b> 47<br /><b>Location:</b> Fullerton, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Wow that code is a lot cleaner that I thought it would be for a binary file.
<br />
<br />Your format has maximum space saving. The only real limitation I can see at this point are block names having a limited format and endianness.
<br />
<br />I know it sounds like i won't let my xml idea die, but I have to say this.  The hybrid xml file idea would allow binary chunks without limiting the space for tags and endianness.
<br />
<br />xml Hybrid example
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&lt;savestate&gt;<br />&lt;nes&gt;<br />&lt;state&gt;<br />&lt;description&gt;Motherbrain with 255 Missles and max health&lt;/description&gt;<br />&lt;cpu&gt;<br />&lt;register&gt;0x0 0x5&lt;/register&gt;<br />&lt;ram&gt;0x6 0x800&lt;/ram&gt;<br />&lt;/cpu&gt;<br />...<br />&lt;/state&gt;<br />...<br />&lt;/savestate&gt;<br />&lt;binary data here&gt;<br /></div>
<br />
<br />The hex numbers above show the start offset and length from the first byte of &lt;binary data here&gt;.  I can see the resistance to xml is because of the formatting involved but it might be worth the extra effort allow for updates and variation.
<br />
<br />Edit: Changed first word of paragraph 2 from "This" to "Your" for the sake of clarity.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=241"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7652"></a>
				<b class="postauthor">hap</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7652"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7652#p7652"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Dec 24, 2005 8:23 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=115.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Mar 24, 2005 3:17 pm<br /><b>Posts:</b> 354
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm all for a standardized savestate format. Though it's a very hard task, to design a format everyone would be happy with. You'll have to think, not what you'd prefer yourself, but what the majority of emulator authors would prefer.
<br />
<br />In the case of XML, I don't think the majority would prefer that..
<br />
<br />
<br />merry christmas <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=115"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p7653"></a>
				<b class="postauthor">WedNESday</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7653">Re: Any standardized savestate format?</a></div><div style="float: right;"><a href="./viewtopic.php?p=7653#p7653"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Dec 24, 2005 9:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Sep 15, 2005 9:23 am<br /><b>Posts:</b> 777<br /><b>Location:</b> England
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">Are there any standardized savestate formats to use, or does each emulator need to create its own custom incompatible proprietary format?</div>
<br />
<br />I think that it would be easier for us all to stick to the our own savestate format for two reasons. First of all we can't even get a 16-byte ROM header right and secondly each emulator has it's own accuracy. If one were to be created then we would need full knowledge of every bit and byte register that the NES (specifically the PPU) has. Really, just like fixing the iNES header, it's too late.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=191"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p7663"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p7663"></a></div><div style="float: right;"><a href="./viewtopic.php?p=7663#p7663"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Dec 24, 2005 2:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The only real limitation I can see at this point are block names having a limited format and endianness.</div><br /><br />What practical problems do these pose? The main limitations are the layout of the actual state structures, specifically preventing compiler-inserted padding and putting multi-byte values into little-endian format. Both are fairly trivial. I've been able to lay out structures for PPU and APU state in a logical way that is entirely usable as the in-memory format during emulation, the only step necessary before saving is to swap the multi-byte values to little-endian format (I develop on a big-endian Mac).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'm all for a standardized savestate format. Though it's a very hard task, to design a format everyone would be happy with. You'll have to think, not what you'd prefer yourself, but what the majority of emulator authors would prefer.</div>
<br />
<br />What if a few of us organize to crate a save state format that initially only aims to move games between emulators (as you can already do with battery RAM saves), perhaps with slight inaccuracies? This is a more modest goal, and would give experience on whether full accuracy were possible and worth the effort.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=838"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=838"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 25 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=838&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=838&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="838" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
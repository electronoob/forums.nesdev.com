<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - US NES - video output format?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">US NES - video output format?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=7137">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=7137</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>clueless</b> [ Wed Nov 10, 2010 9:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How much lag does it introduce?  A co-worker and I were discussing using USB tv-tuner cards with our PCs for playing NES games.  He mentioned that he once tries to use a USB tuner with his PS2 and the lag was almost 1 second, which made accurate play difficult.
<br />
<br />My concern would be for testing my homebrew on a real NES using my computer as the TV... Once Blargg finishes the kick-ass Game Genie hack + ram cart.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>neilbaldwin</b> [ Wed Nov 10, 2010 9:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Thanks for updating us. This should go on the Wiki somewhere. So this thing does 60 FPS correctly, without interlace artifacts or anything?</div>
<br />
<br />I've not <em>recorded</em> anything yet (I only want to use it as a picture-in-picture monitor for my NES) but I can do some tests if it would be useful.
<br />
<br />Any suggestions?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Wed Nov 10, 2010 11:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Just play a game and let us know how it looks on your computer monitor as compared to playing an emulator (this way any lag of your LCD will affect the emulator too, and not cause a difference). Do this for the preview, and also for recording. How much lag for the preview? The old PowerMac I use has composite video input, and the on-screen preview looks good and doesn't have any noticeable lag, for example. It's very useful to have video input, so you don't need a TV on your desk when doing NES development.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Wed Nov 10, 2010 12:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Even emulators have lag of up to 3 frames.  Which is why Punch Out is easiest on a NES hooked up to a CRT.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Wed Nov 10, 2010 12:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It wasn't a question of whether the video capture lagged by a couple of frames; it was whether it lags by tens or hundreds of frames, as some people have mentioned some video capture devices do. I would always expect a lag of a few frames at minimum with a video input device, and wouldn't use it if I wanted to play the NES. The main use is during development, where you're seeing if something works right, and where a lag of one second would be really annoying, but 5 frames wouldn't. At least that's how I use video input.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Nov 10, 2010 5:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The front-loading NES and original Super NES have both an RF output and a composite video output. Connect the capture card to the composite video output and play lag-free on the RF output.
<br />
<br />As for interlace artifacts, a video capture solution is acceptable if it captures both fields. Even if the end result is woven together, ending up with a heavily combed 640x480, 704x480, or 720x480 at 30 fps, that's easy for AviSynth to split up into two fields.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>kevtris</b> [ Thu Nov 11, 2010 8:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />just to throw my 2 cents in on the video capture business, I had similar problems here trying to videocap the NES.
<br />
<br />Seems the cheap voodoo TV card I had (remember those?)  worked GREAT with the NES.  I used this for a long time to take screencaps and video of the NES.
<br />
<br />Then I got a more expensive and higher end video capture card.  (sorry, can't remember the model)  Unfortunately, it didn't work very well with the NES.  You'd plug video in and get exactly 1 frame displayed for maybe 1/2 second, then blue screen.
<br />
<br />Apparently it doesn't like the nintendo's 240 line progressive output, and it only will work with interlaced output.  I tried all the options in its configuration panel such as "VCR mode" (not sure what that is supposed to do) and a few others.  The card itself was fine since if I plugged a video camera into it, or the VCR, it would work fine.  It just hated the 240P coming out of the NES with a passion.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>LocalH</b> [ Fri Nov 12, 2010 8:36 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Something to keep in mind - the most common way to handle 240p signals in a capture device is to treat the frames as fields and record a 480i signal, so there may be need to split the "480i" frames into 240p fields. At this point, to create a high-quaity 240p result, if your device captures at 720px wide, then crop 16px horizontally (I think the NES output has more border on the left?) and then resize to 640px - this will keep the aspect ratio as close to exact as one would be able to detect at these sizes). Then, you can either double the vertical resolution as mentioned (for 640x480) or halve the horizontal resolution (giving 320x240). If you resize to 320px wide, you'll notice a slight uneven nature to horizontal image data (especially where the same tile or two is repeated across the screen), but if you leave it at 640px wide you'll have a bigger filesize for the end result.
<br />
<br />I find the combination of <a href="http://www.avisynth.org" class="postlink">Avisynth</a> and <a href="http://www.virtualdub.org" class="postlink">VirtualDub</a> invaluable for processing video such as this. Best of all, both tools are 100% legally free, and they're much faster than doing similar processing with more traditional tools. Avisynth does require some basic scripting knowledge, albeit nothing that a veteran 6502 coder shouldn't be able to wrap their head around =P

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hojo_Norem</b> [ Fri Nov 12, 2010 12:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">LocalH wrote:</div><div class="quotecontent">Something to keep in mind - the most common way to handle 240p signals in a capture device is to treat the frames as fields and record a 480i signal, so there may be need to split the "480i" frames into 240p fields. At this point, to create a high-quaity 240p result, if your device captures at 720px wide, then crop 16px horizontally (I think the NES output has more border on the left?) and then resize to 640px - this will keep the aspect ratio as close to exact as one would be able to detect at these sizes). Then, you can either double the vertical resolution as mentioned (for 640x480) or halve the horizontal resolution (giving 320x240). If you resize to 320px wide, you'll notice a slight uneven nature to horizontal image data (especially where the same tile or two is repeated across the screen), but if you leave it at 640px wide you'll have a bigger filesize for the end result.<br /><br />I find the combination of <a href="http://www.avisynth.org" class="postlink">Avisynth</a> and <a href="http://www.virtualdub.org" class="postlink">VirtualDub</a> invaluable for processing video such as this. Best of all, both tools are 100% legally free, and they're much faster than doing similar processing with more traditional tools. Avisynth does require some basic scripting knowledge, albeit nothing that a veteran 6502 coder shouldn't be able to wrap their head around =P</div>
<br />
<br />I had a go at making a AviSynth script to do just that a while ago but I found that the image would flicker slightly, kinda like then you see the PS1 go into hi-res mode.  So after a bit of tinkering and sifting through the AviSynth script manual I came up with this:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">crop_x=33<br />crop_y=35<br />crop_w=640<br />crop_h=480<br />trim_s=10<br />trim_e=28<br />a=FFmpegSource2&#40;&quot;VR_MOVIE.mpg&quot;,atrack=-1&#41;<br />a=trim&#40;a,trim_s,framecount&#40;a&#41;-trim_e&#41;<br />a=SeparateFields&#40;a&#41;<br />c=selectodd&#40;a&#41;<br />c=Converttorgb32&#40;c&#41;<br />d=selecteven&#40;a&#41;<br />d=converttorgb32&#40;d&#41;<br />c=crop&#40;c,0,1,width&#40;c&#41;,height&#40;c&#41;-1&#41;<br />c=addborders&#40;c,0,0,0,1&#41;<br />e=interleave&#40;c,d&#41;<br />e=pointresize&#40;e,width&#40;e&#41;,height&#40;e&#41;*2&#41;<br />e=crop&#40;e,crop_x,crop_y,crop_w,crop_h&#41;<br />e<br /></div>
<br />
<br />(I use FFmpegSource2 because I capture my stuff on my Panasonic DVD-Recorder, also this is my first attempt at a semi serious script)
<br />
<br />I take the source video, double the framerate by creating new frames from the even and odd lines.  Then I take the odd frames and shift them down by one pixel, recombine with the even frames, double the height to regain the original aspect ratio and the result is a video clip that very closely matches the original game (not including resolution).
<br />
<br />Here is a <a href="http://www.youtube.com/watch?v=ZQZOvsIHLT0" class="postlink">example</a> of the scrip in action (shame Youtube butchers the framerate)

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - DMC DMA causing double-$2002 reads?</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - DMC DMA causing double-$2002 reads?" href="http://forums.nesdev.com/feed.php?f=3&amp;t=9022" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 8:31 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=9030">DMC DMA causing double-$2002 reads?</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=9030"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 11 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=9030&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=9030&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=9030&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95755"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95755">DMC DMA causing double-$2002 reads?</a></div><div style="float: right;"><a href="./viewtopic.php?p=95755#p95755"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 2:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I was just dorking around more with Visual2A03 [my favorite topic lately], trying to completely understand the DMC DMA and its impact.  I recognize that there's lots of talk about how a DMC DMA can cause an extra controller read.  I happened to be just randomly trying to find out how many cycles RDY is held in different situations, and created the following <a href="http://www.qmtpro.com/~nes/chipimages/visual2a03/expert.html?a=fffe&amp;d=40&amp;a=fffc&amp;d=0&amp;a=200&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=2c0&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=c000&amp;d=e0e1e2e3&amp;a=0&amp;d=58a9c08d1740a9018d1340a98f8d1040a9108d1540ad022010fe&amp;logmore=c_rdy" class="postlink">program</a>.  
<br />
<br />The output of this surprised me a bit, and got me thinking...DMC DMA could maybe cause skipped frames.
<br />
<br />Here's the relevant portion of the log:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">cycle&nbsp; &nbsp;ab&nbsp; &nbsp;db&nbsp; &nbsp;rw&nbsp; &nbsp;Fetch&nbsp; &nbsp;pc&nbsp; &nbsp;a&nbsp; &nbsp;x&nbsp; &nbsp;y&nbsp; &nbsp;s&nbsp; &nbsp;p&nbsp; &nbsp;c_rdy<br />34&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />34&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />35&nbsp; &nbsp;0015&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />35&nbsp; &nbsp;0015&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;0016&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;0016&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0017&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0017&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />39&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />39&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />40&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />40&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;e0&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;1<br />41&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;e0&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;1<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;1<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;1<br /></div>
<br />At cycle 38, read $2002 has gone on the bus and RDY is asserted.  Then in cycle 40 the DMC DMA happens.  Then cycle 41, read $2002 goes back on the bus.
<br />
<br />The pattern above is identical regardless of the address being read, obviously...so it makes me think that the above pattern is representative of the $4016/$4017 extra reads.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95758"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95758"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95758#p95758"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 3:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">AFAIK the DMC read can affect every register read, including $2002, $2007, $4015, etc.
<br />
<br />With $2002 it doesn't really matter, because reading that to check for VBlank is <em>already</em> unreliable, even without the DMC as a factor.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95793"></a>
				<b class="postauthor">Drag</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95793"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95793#p95793"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 8:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:57 pm<br /><b>Posts:</b> 584
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Out of curiosity, does the DMC affect <em>writes</em> to 2007, or just reads? I think I still don't quite understand what exactly is going on.</div>

					
						<div class="postbody"><br />_________________<br />-Drag</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=21"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95794"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95794"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95794#p95794"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 8:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 2546
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm guessing no, otherwise you'd see glitches all over the place in any game that uses DMC.
<br />Also that DMC takes one cycle less when it falls on a write.</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95800"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95800"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95800#p95800"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 9:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Writes are unaffected.
<br />
<br />I swear blargg went over all this in a post.  Let me see if I can find it.
<br />
<br />EDIT:
<br />
<br />Here:  <!-- m --><a class="postlink" href="http://nesdev.com/bbs/viewtopic.php?p=33564#33564">http://nesdev.com/bbs/viewtopi ... 3564#33564</a><!-- m --></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95802"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95802"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95802#p95802"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 9:33 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">I'm guessing no, otherwise you'd see glitches all over the place in any game that uses DMC.<br />Also that DMC takes one cycle less when it falls on a write.</div>
<br />I've been doing a lot of looking at writes...and never bothered to try to explain what I'm seeing.  Here goes.
<br />
<br />Here's a <a href="http://www.qmtpro.com/~nes/chipimages/visual2a03/expert.html?a=fffe&amp;d=40&amp;a=fffc&amp;d=0&amp;a=0&amp;d=58a9c08d1740a9018d1340a98f8d1040a9108d15408d022010fe&amp;a=200&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=2c0&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=c000&amp;d=e0e1e2e3&amp;logmore=c_rdy" class="postlink">program</a> that does everything exactly the same as the previous program in this thread except the LDA $2002 is now a STA $2002.  [I know...I know...that's an invalid NES thing to do but this isn't a NES it's just a 2A03.]
<br />
<br />Relevant portion of the log:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">34&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />34&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />35&nbsp; &nbsp;0015&nbsp; &nbsp;8d&nbsp; &nbsp;1&nbsp; &nbsp;STA Abs&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />35&nbsp; &nbsp;0015&nbsp; &nbsp;8d&nbsp; &nbsp;1&nbsp; &nbsp;STA Abs&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;0016&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;0016&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0017&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0017&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;2002&nbsp; &nbsp;20&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;2002&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />40&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />40&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />44&nbsp; &nbsp;0019&nbsp; &nbsp;fe&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />44&nbsp; &nbsp;0019&nbsp; &nbsp;fe&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br /></div>
<br />Not only does the DMC DMA not interrupt the write, it is *stalled* beyond the write.  In the previous example using LDA $2002 the DMC DMA occurs between cycles 38 and 40.  In the STA $2002 case above we can see RDY is not pulled low in cycle 38 as in the LDA $2002 case.  Cycle 38 is a write.  It is pulled low in cycle 39 which is a read.  Further, this DMA takes four total cycles [counting from the assertion of RDY in 39 to the completion of the DMA in 42].  This too is contrary to the stated "DMC DMA takes one cycle less on a write".  In the LDA $2002 example the DMA starts in cycle 38 and completes in cycle 40 -- three cycles.  DMC DMA appears to take one cycle less in a read.  I've seen similar results with trying to cause DMC DMA during an interrupt sequence.  If the DMA would otherwise occur during one of the stack-write cycles, it is delayed until those write cycles complete then RDY is pulled low during the vector fetch.  More to come...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95803"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95803"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95803#p95803"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 9:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">cpow wrote:</div><div class="quotecontent">More to come...</div>
<br />
<br />This <a href="http://www.qmtpro.com/~nes/chipimages/visual2a03/expert.html?a=fffe&amp;d=40&amp;a=fffc&amp;d=0&amp;a=0&amp;d=58a9c08d1740a9018d1340a98f8d1040a9108d154010fe&amp;irq0=66&amp;a=200&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=2c0&amp;d=a0a1a2a3a4a5a6a7a8a9aaabacadaeafa0a1a2a3a4a5a6a7a8a9aaabacadaeaf&amp;a=c000&amp;d=e0e1e2e3&amp;logmore=c_rdy,c_irq" class="postlink">program</a> shows a DMC DMA occurring during the vector fetch phase of an IRQ.  
<br />
<br />Relevant log parts:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">37&nbsp; &nbsp;01bd&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />37&nbsp; &nbsp;01bd&nbsp; &nbsp;00&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />38&nbsp; &nbsp;01bc&nbsp; &nbsp;15&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />38&nbsp; &nbsp;01bc&nbsp; &nbsp;15&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />39&nbsp; &nbsp;01bb&nbsp; &nbsp;15&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />39&nbsp; &nbsp;01bb&nbsp; &nbsp;20&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />40&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />40&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;0&nbsp; &nbsp;0<br />41&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;0&nbsp; &nbsp;0<br />41&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;0&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;0&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;0&nbsp; &nbsp;0<br />43&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />43&nbsp; &nbsp;fffe&nbsp; &nbsp;40&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />44&nbsp; &nbsp;ffff&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑BdIzc&nbsp; &nbsp;1&nbsp; &nbsp;0<br />44&nbsp; &nbsp;ffff&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0015&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;ba&nbsp; &nbsp;nv‑BdIzc&nbsp; &nbsp;1 0</div>
<br />Here the RDY assertion is delayed again.  Following the LDA $2002 example I would expect RDY to assert in cycle 38 [nothing about the DMC setup has changed, DMC DMA occurs between cycles 38-40 if 38 is a read cycle].  Instead, it's as if the 2A03 has additional logic that does its own "RDY processing" -- meaning it won't even bother the CPU during a write cycle because it knows the CPU won't halt, so it waits until the next read cycle, then asserts RDY and starts the 3-cycle DMA.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95805"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95805"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95805#p95805"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 20, 2012 10:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think the conclusion to draw is that the actual DMC DMA -- the memory read -- will always occur coincident with where a sprite DMA memory read cycle would occur if sprite DMA were also occurring.  [Someone mentioned this possibility in another thread that I'm not finding...]  That has been shown in the Visual2A03 program traces where I interrupted sprite DMA with one or two DMC DMAs.  The memory read cycle of the read/write sprite DMA beats is where the DMC memory read occurs.  So, the "whether a DMC DMA takes 3 or 4 cycles when not also during sprite DMA" is most likely because of this synchronization, not at all because of the read/write state of the CPU's external bus.  That state, it seems, drives another hold-off circuit that prevents even the assertion of RDY.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95828"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95828"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95828#p95828"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 21, 2012 7:45 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">If anyone else finds this interesting...it appears that DMC DMA always takes 3 cycles if the RDY occurs coincident with a CPU memory-read [cases 1 and 2 below].  If the RDY would occur coincident with a CPU memory write, it is held off until the next CPU read cycle.  If it's held off one CPU write cycle that results in a 4-cycle DMC DMA [case 3 below].  If it's held off for two CPU write cycles that results in a 3-cycle DMC DMA [case 4 below].  Maintaining synchronization with the 2-cycle DMA read/write beat.
<br />
<br />1. DMC started at cycle 36.  3-cycle DMC DMA (cycles 40-42) occurs.  This is the "control" because there's nothing going on to hinder when the DMC DMA could occur -- no writes, no sprite DMA.
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">36&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;2002&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;00&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑BdiZc&nbsp; &nbsp;0</div><br /><br /><br />2. DMC started at cycle 37.  3-cycle DMC DMA (cycles 40-42) occurs.  This is similar to the "control" case above except the DMC is started one cycle later.  I believe this shows the 2-beat synchronization of the sprite/DMC DMA engines, with reads occurring on even cycles, writes on odd cycles [sprite DMA only].<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">37&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;ad&nbsp; &nbsp;1&nbsp; &nbsp;LDA Abs&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0018&nbsp; &nbsp;02&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0019&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0019&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;0019&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;001a&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />41&nbsp; &nbsp;0019&nbsp; &nbsp;20&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;001a&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;001a&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;001a&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0</div><br /><br />3. DMC started at cycle 36.  4-cycle DMC DMA (cycles 41-44) immediately following a memory write (cycle 40) by the CPU.  I believe this is a write that "gets in the way of" the DMA/RDY because it occurs the cycle where the RDY assertion occurs in the write case above.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">36&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;95&nbsp; &nbsp;1&nbsp; &nbsp;STA zp,X&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;95&nbsp; &nbsp;1&nbsp; &nbsp;STA zp,X&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;81&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;81&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0081&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0081&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0041&nbsp; &nbsp;00&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0041&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />41&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />41&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />44&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0<br />44&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;0</div><br /><br />4. DMC started at cycle 36.  3-cycle DMC DMA (cycles 42-44) immediately following a dual memory write (cycles 40 and 41) by the CPU.  These two writes delay RDY assertion but do not result in a 4-cycle DMA.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">36&nbsp; &nbsp;4015&nbsp; &nbsp;40&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />36&nbsp; &nbsp;4015&nbsp; &nbsp;10&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;c6&nbsp; &nbsp;1&nbsp; &nbsp;DEC zp&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />37&nbsp; &nbsp;0016&nbsp; &nbsp;c6&nbsp; &nbsp;1&nbsp; &nbsp;DEC zp&nbsp; &nbsp;0016&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;80&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />38&nbsp; &nbsp;0017&nbsp; &nbsp;80&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0017&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0080&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />39&nbsp; &nbsp;0080&nbsp; &nbsp;00&nbsp; &nbsp;1&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0080&nbsp; &nbsp;00&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />40&nbsp; &nbsp;0080&nbsp; &nbsp;00&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;nv‑Bdizc&nbsp; &nbsp;1<br />41&nbsp; &nbsp;0080&nbsp; &nbsp;55&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;1<br />41&nbsp; &nbsp;0080&nbsp; &nbsp;ff&nbsp; &nbsp;0&nbsp; &nbsp;&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;1<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;1<br />42&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;0<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;0<br />43&nbsp; &nbsp;0018&nbsp; &nbsp;10&nbsp; &nbsp;1&nbsp; &nbsp;BPL &nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;0<br />44&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;0<br />44&nbsp; &nbsp;c000&nbsp; &nbsp;e0&nbsp; &nbsp;1&nbsp; &nbsp;CPX #&nbsp; &nbsp;0019&nbsp; &nbsp;10&nbsp; &nbsp;c0&nbsp; &nbsp;00&nbsp; &nbsp;bd&nbsp; &nbsp;Nv‑Bdizc&nbsp; &nbsp;0</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95829"></a>
				<b class="postauthor">Nessie</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95829"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95829#p95829"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 21, 2012 8:22 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 20, 2004 11:13 am<br /><b>Posts:</b> 134<br /><b>Location:</b> Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">cpow wrote:</div><div class="quotecontent">If anyone else finds this interesting...</div>
<br />Just want to say I find this interesting but can't post any meaningful response because I'm having trouble following what's actually going on <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />Have to do some testing myself with blargg's framework before I'll be able to wrap my head around this.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=12"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95839"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95839"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95839#p95839"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 21, 2012 10:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Nessie wrote:</div><div class="quotecontent"><div class="quotetitle">cpow wrote:</div><div class="quotecontent">If anyone else finds this interesting...</div><br />Just want to say I find this interesting but can't post any meaningful response because I'm having trouble following what's actually going on <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br />Have to do some testing myself with blargg's framework before I'll be able to wrap my head around this.</div>
<br />Sorry, I'll try to be more clear.  I am just playing with Visual2A03 to see if I can completely characterize the actual behavior of the DMA 'controllers' within it.  I realize there's little-to-no practical use for any of this, since most emulators are "accurate enough".  I just find it interesting that we now have the tool(s) to check earlier assumptions.  People might get offended by this as if I'm trying to prove them wrong--not the case!
<br />
<br />First, to clarify what I mean when I say "DMC DMA".  I mean the cycles where the 6502 is held off the bus by the DMA 'controller' within the 2A03 asserting RDY.  This is distinct from the period where the DMA 'controller' itself holds off asserting RDY to the 6502 because it sees the 6502 is writing.  I surmise that if the 6502 were to initiate a 15-cycle write [impossible] this 'pre RDY assertion' phase would last from when the DMA 'controller' wants the bus to the point where the 6502 goes back to reading [up to 15 cycles].  I've shown several Visual2A03 logs where, all else being held constant, an intervening 6502 write cycle is the only possible explanation for the delayed RDY.  As for how many cycles the "DMC DMA" takes.  That, too, is variable but not in the way we've been thinking.  There definitely appears to be a DMA drumbeat that is shared between the DMA 'controllers' [not my idea...first posited <a href="http://nesdev.com/bbs/viewtopic.php?t=6100" class="postlink">here</a>, I believe, in a reply from ReaperSMS.
<br />
<br />The DMA drumbeat I'm observing is opposite of what ReaperSMS posited, though:
<br />
<br />0 - read
<br />1 - write
<br />2 - read 
<br />3 - write 
<br />4 - read
<br />...
<br />
<br />RDY assertion is delayed if the CPU is writing.  Period.  If the DMA drumbeat is on a read cycle when the CPU is done writing, the DMC DMA will take three cycles.  If the DMA drumbeat is on a write cycle when the CPU is done writing, the DMC DMA will take four cycles.
<br />
<br />Maybe I'm just a victim of misinterpretation -- definitely happens often enough to me.  My interpretation of the DMC DMA 'idea' has always been that RDY is driven to the 6502 *then* a wait for up to three writes occurs.  Since I've seen that the cycles where RDY is asserted varies from 3-4 with the last cycle being the memory read for the DMA, it cannot be the case that RDY assertion is holding off for "up to three CPU writes".  That's done by the 'pre RDY assertion' phase.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=9030"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=9030"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 11 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="9030" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
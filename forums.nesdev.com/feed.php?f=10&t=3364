<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=10&amp;t=3364" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2007-05-16T10:17:55-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=10&amp;t=3364</id>
<entry>
<author><name><![CDATA[mcfiredrill]]></name></author>
<updated>2007-05-16T10:17:55-07:00</updated>
<published>2007-05-16T10:17:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24249#p24249</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24249#p24249"/>
<title type="html"><![CDATA[trying to get nullsleep's NSF playback code working...]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24249#p24249"><![CDATA[
Ack! Well after I added those changes my emulator won't even open the .nes file. It gives a corrupt file error. I'm thinking maybe there's a better assembler I should use...any ideas? I'll try X186 again.<br /><br />NoCarrier: I plan on adding a simple graphic later so I don't think NSFulator would help me(?).<br /><br />Here's my code in case someone notices something obviously wrong with it:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">      .inesprg   2<br />      .ineschr   1<br />      .inesmir   1<br />      .inesmap   0<br /><br />   .bank 0<br />   .org $8000      ; replace dashes with load address MINUS $80<br />   .incbin &quot;nomryi.nsf&quot;   ; include NSF tune <br /><br />   <br />Reset_Routine:<br />   cld         ; clear decimal flag<br />   sei         ; disable interrupts<br />   lda #%00000000      ; disable vblank interrupts by clearing<br />   sta $2000      ; the most significant bit of $2000<br />   <br />; *** WAIT 2 VBLANKS ***<br />WaitV1:   <br />   lda $2002      ; give the PPU a little time to initialize<br />   bpl WaitV1      ; by waiting for a vblank<br />WaitV2:   <br />   lda $2002      ; wait for a second vblank to be safe<br />   bpl WaitV2      ; and now the PPU should be initialized<br />   <br />; *** CLEAR SOUND REGISTERS ***<br />   lda #$00      ; clear all the sound registers by setting<br />   ldx #$00      ; everything to 0 in the Clear_Sound loop<br />Clear_Sound:<br />   sta $4000,x      ; store accumulator at $4000 offset by x<br />   inx         ; increment x<br />   cpx #$0F      ; compare x to $0F<br />   bne Clear_Sound      ; branch back to Clear_Sound if x != $0F<br /><br />   lda #$10      ; load accumulator with $10<br />   sta $4010      ; store accumulator in $4010<br />   lda #$00      ; load accumulator with 0<br />   sta $4011      ; clear these 3 registers that are <br />   sta $4012      ; associated with the delta modulation<br />   sta $4013      ; channel of the NES<br />   <br />; *** ENABLE SOUND CHANNELS ***<br />   lda #%00001111      ; enable all sound channels except<br />   sta $4015      ; the delta modulation channel<br />   <br />; *** RESET FRAME COUNTER AND CLOCK DIVIDER ***<br />   lda #$C0      ; synchronize the sound playback routine <br />   sta $4017      ; to the internal timing of the NES<br />   <br />; *** SET SONG # &amp; PAL/NTSC SETTING ***<br />   lda #$00      ; replace dashes with song number<br />   ldx #$00      ; replace with $00 for NTSC or $01 for PAL<br />   jsr $8000      ; replace dashes with init address<br />   <br />; *** ENABLE VBLANK NMI ***<br />   lda #%10000000      ; enable vblank interrupts by setting the <br />   sta $2000      ; most significant bit of $2000<br /><br />Loop:<br />   jmp Loop      ; loop loop loop loop ...<br />   <br />NMI_Routine:<br />   lda $2002      ; read $2002 to reset the vblank flag<br />   lda #%00000000      ; clear the first PPU control register  <br />   sta $2000      ; writing 0 to it<br />   lda #%10000000      ; reenable vblank interrupts by setting<br />   sta $2000      ; the most significant bit of $2000<br />   jsr $8003      ; replace dashes with play address<br />   rti         ; return from interrupt routine<br />   <br />IRQ_Routine:<br />   rti         ; return from interrupt routine<br /><br />   <br /><br />   .bank 1<br />   .org $FFFA<br />   .dw   NMI_Routine   ; setup the NMI vector at $FFFA<br />   .dw   Reset_Routine   ; setup the Reset vector at $FFFC<br />   .dw   IRQ_Routine   ; setup the IRQ vector at $FFFE<br />   <br /></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3338">mcfiredrill</a> — Wed May 16, 2007 10:17 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[No Carrier]]></name></author>
<updated>2007-05-14T03:44:55-07:00</updated>
<published>2007-05-14T03:44:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24185#p24185</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24185#p24185"/>
<title type="html"><![CDATA[trying to get nullsleep's NSF playback code working...]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24185#p24185"><![CDATA[
Or, if you get really stuck, you could try NSFulator:<br /><br /><!-- m --><a class="postlink" href="http://nesdev.com/bbs/viewtopic.php?t=1184">http://nesdev.com/bbs/viewtopic.php?t=1184</a><!-- m --><br /><br />I re-uploaded it here, since the link in that thread is dead:<br /><br /><!-- m --><a class="postlink" href="http://www.sendspace.com/file/riblqn">http://www.sendspace.com/file/riblqn</a><!-- m --><br /><br />Good luck!<br /><br />NC<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=265">No Carrier</a> — Mon May 14, 2007 3:44 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Memblers]]></name></author>
<updated>2007-05-13T21:17:53-07:00</updated>
<published>2007-05-13T21:17:53-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24182#p24182</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24182#p24182"/>
<title type="html"><![CDATA[trying to get nullsleep's NSF playback code working...]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24182#p24182"><![CDATA[
First thing I noticed is that .inesprg 1 should be .inesprg 2 since you want a 32kB program instead of 16kB.<br /><br />Secondly, NESASM is just weird.  It's kinda notorious for assembling non-working code (and not giving an error or warning) if you don't follow it's special conventions.  One of those is that you have to use the .bank command before .org.  Try .bank 0 at the beginning, then before the .org $FFFA .bank 1 2 or 3.  I don't know what it expects really.. if you're still stuck after trying that, check out the source to another program that uses NESASM and see how it does it.  MCK is one program that uses it successfully.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=10">Memblers</a> — Sun May 13, 2007 9:17 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[mcfiredrill]]></name></author>
<updated>2007-05-13T20:52:08-07:00</updated>
<published>2007-05-13T20:52:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24181#p24181</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24181#p24181"/>
<title type="html"><![CDATA[trying to get nullsleep's NSF playback code working...]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3364&amp;p=24181#p24181"><![CDATA[
hello all,<br /><br />I'm trying to get the NSF playback code from Nullsleep's guide working...the only problem is I am using NESASM because I couldn't get X186 to work.Here is the code I had at first:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">; *** X816 SETTINGS ***<br />   .mem 8         ; 8-bit memory mode<br />   .index 8      ; 8-bit index mode<br />   .opt on         ; address optimize<br />   <br />   .org $8000      ; replace dashes with load address MINUS $80<br />   .incbin &quot;nomryi.nsf&quot;   ; include NSF tune <br /><br />   <br />Reset_Routine:<br />   cld         ; clear decimal flag<br />   sei         ; disable interrupts<br />   lda #%00000000      ; disable vblank interrupts by clearing<br />   sta $2000      ; the most significant bit of $2000<br />   <br />; *** WAIT 2 VBLANKS ***<br />WaitV1:   <br />   lda $2002      ; give the PPU a little time to initialize<br />   bpl WaitV1      ; by waiting for a vblank<br />WaitV2:   <br />   lda $2002      ; wait for a second vblank to be safe<br />   bpl WaitV2      ; and now the PPU should be initialized<br />   <br />; *** CLEAR SOUND REGISTERS ***<br />   lda #$00      ; clear all the sound registers by setting<br />   ldx #$00      ; everything to 0 in the Clear_Sound loop<br />Clear_Sound:<br />   sta $4000,x      ; store accumulator at $4000 offset by x<br />   inx         ; increment x<br />   cpx #$0F      ; compare x to $0F<br />   bne Clear_Sound      ; branch back to Clear_Sound if x != $0F<br /><br />   lda #$10      ; load accumulator with $10<br />   sta $4010      ; store accumulator in $4010<br />   lda #$00      ; load accumulator with 0<br />   sta $4011      ; clear these 3 registers that are <br />   sta $4012      ; associated with the delta modulation<br />   sta $4013      ; channel of the NES<br />   <br />; *** ENABLE SOUND CHANNELS ***<br />   lda #%00001111      ; enable all sound channels except<br />   sta $4015      ; the delta modulation channel<br />   <br />; *** RESET FRAME COUNTER AND CLOCK DIVIDER ***<br />   lda #$C0      ; synchronize the sound playback routine <br />   sta $4017      ; to the internal timing of the NES<br />   <br />; *** SET SONG # &amp; PAL/NTSC SETTING ***<br />   lda #$00      ; replace dashes with song number<br />   ldx #$00      ; replace with $00 for NTSC or $01 for PAL<br />   jsr $8000      ; replace dashes with init address<br />   <br />; *** ENABLE VBLANK NMI ***<br />   lda #%10000000      ; enable vblank interrupts by setting the <br />   sta $2000      ; most significant bit of $2000<br /><br />Loop:<br />   jmp Loop      ; loop loop loop loop ...<br />   <br />NMI_Routine:<br />   lda $2002      ; read $2002 to reset the vblank flag<br />   lda #%00000000      ; clear the first PPU control register  <br />   sta $2000      ; writing 0 to it<br />   lda #%10000000      ; reenable vblank interrupts by setting<br />   sta $2000      ; the most significant bit of $2000<br />   jsr $8003      ; replace dashes with play address<br />   rti         ; return from interrupt routine<br />   <br />IRQ_Routine:<br />   rti         ; return from interrupt routine<br /><br />.pad $FFFA<br />   .dw   NMI_Routine   ; setup the NMI vector at $FFFA<br />   .dw   Reset_Routine   ; setup the Reset vector at $FFFC<br />   .dw   IRQ_Routine   ; setup the IRQ vector at $FFFE<br /><br />   <br /></div><br /><br />Then I tried to change the X186 settings to the ines settings required by NESASM...and I change the .pad to .org, because the assembler didnt recognize .org:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">      .inesprg   1<br />      .ineschr   1<br />      .inesmir   1<br />      .inesmap   0<br />   <br />   .org $8000      ; replace dashes with load address MINUS $80<br />   .incbin &quot;nomryi.nsf&quot;   ; include NSF tune <br /><br />   <br />Reset_Routine:<br />   cld         ; clear decimal flag<br />   sei         ; disable interrupts<br />   lda #%00000000      ; disable vblank interrupts by clearing<br />   sta $2000      ; the most significant bit of $2000<br />   <br />; *** WAIT 2 VBLANKS ***<br />WaitV1:   <br />   lda $2002      ; give the PPU a little time to initialize<br />   bpl WaitV1      ; by waiting for a vblank<br />WaitV2:   <br />   lda $2002      ; wait for a second vblank to be safe<br />   bpl WaitV2      ; and now the PPU should be initialized<br />   <br />; *** CLEAR SOUND REGISTERS ***<br />   lda #$00      ; clear all the sound registers by setting<br />   ldx #$00      ; everything to 0 in the Clear_Sound loop<br />Clear_Sound:<br />   sta $4000,x      ; store accumulator at $4000 offset by x<br />   inx         ; increment x<br />   cpx #$0F      ; compare x to $0F<br />   bne Clear_Sound      ; branch back to Clear_Sound if x != $0F<br /><br />   lda #$10      ; load accumulator with $10<br />   sta $4010      ; store accumulator in $4010<br />   lda #$00      ; load accumulator with 0<br />   sta $4011      ; clear these 3 registers that are <br />   sta $4012      ; associated with the delta modulation<br />   sta $4013      ; channel of the NES<br />   <br />; *** ENABLE SOUND CHANNELS ***<br />   lda #%00001111      ; enable all sound channels except<br />   sta $4015      ; the delta modulation channel<br />   <br />; *** RESET FRAME COUNTER AND CLOCK DIVIDER ***<br />   lda #$C0      ; synchronize the sound playback routine <br />   sta $4017      ; to the internal timing of the NES<br />   <br />; *** SET SONG # &amp; PAL/NTSC SETTING ***<br />   lda #$00      ; replace dashes with song number<br />   ldx #$00      ; replace with $00 for NTSC or $01 for PAL<br />   jsr $8000      ; replace dashes with init address<br />   <br />; *** ENABLE VBLANK NMI ***<br />   lda #%10000000      ; enable vblank interrupts by setting the <br />   sta $2000      ; most significant bit of $2000<br /><br />Loop:<br />   jmp Loop      ; loop loop loop loop ...<br />   <br />NMI_Routine:<br />   lda $2002      ; read $2002 to reset the vblank flag<br />   lda #%00000000      ; clear the first PPU control register  <br />   sta $2000      ; writing 0 to it<br />   lda #%10000000      ; reenable vblank interrupts by setting<br />   sta $2000      ; the most significant bit of $2000<br />   jsr $8003      ; replace dashes with play address<br />   rti         ; return from interrupt routine<br />   <br />IRQ_Routine:<br />   rti         ; return from interrupt routine<br /><br />   .org $FFFA<br />   .dw   NMI_Routine   ; setup the NMI vector at $FFFA<br />   .dw   Reset_Routine   ; setup the Reset vector at $FFFC<br />   .dw   IRQ_Routine   ; setup the IRQ vector at $FFFE<br />   <br /></div><br /><br /><br />I can get this to compile but I don't get any sound at all. Any help would be appreciated, thanks alot!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3338">mcfiredrill</a> — Sun May 13, 2007 8:52 pm</p><hr />
]]></content>
</entry>
</feed>
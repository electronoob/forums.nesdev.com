<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=10853" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2014-01-06T06:20:45-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=10853</id>
<entry>
<author><name><![CDATA[Boolean]]></name></author>
<updated>2014-01-06T06:20:45-07:00</updated>
<published>2014-01-06T06:20:45-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123381#p123381</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123381#p123381"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123381#p123381"><![CDATA[
<div class="quotetitle">LocalH wrote:</div><div class="quotecontent"><br /><div class="quotetitle">Boolean wrote:</div><div class="quotecontent">2. When my emulator run <em>Double Dragon</em>, a strange thing occured.<br />When I killed the boss of mission 3 the mission didn't over, I went ahead and wraped to mission 3's start.<br /></div><br />This is normal behavior if you fight the two Abobos and then walk offscreen to the right. To advance in the game, you have to enter one of the two holes that the Abobos leave in the wall.</div><br /><br />Thank you.<br />The two Abobos aren't real boss. <img src="http://forums.nesdev.com/images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6322">Boolean</a> — Mon Jan 06, 2014 6:20 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[LocalH]]></name></author>
<updated>2014-01-06T01:24:10-07:00</updated>
<published>2014-01-06T01:24:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123376#p123376</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123376#p123376"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123376#p123376"><![CDATA[
<div class="quotetitle">Boolean wrote:</div><div class="quotecontent"><br />2. When my emulator run <em>Double Dragon</em>, a strange thing occured.<br />When I killed the boss of mission 3 the mission didn't over, I went ahead and wraped to mission 3's start.<br /></div><br />This is normal behavior if you fight the two Abobos and then walk offscreen to the right. To advance in the game, you have to enter one of the two holes that the Abobos leave in the wall.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=325">LocalH</a> — Mon Jan 06, 2014 1:24 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2014-01-05T09:35:02-07:00</updated>
<published>2014-01-05T09:35:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123335#p123335</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123335#p123335"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123335#p123335"><![CDATA[
<div class="quotetitle">Boolean wrote:</div><div class="quotecontent"><br /><a href="http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games" class="postlink">http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games</a> <strong>Tricky-to-emulate games page</strong> lists Bill &amp; Ted only.<br /></div><br /><br />Trust me, Bill &amp; Ted isn't the only one.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Sun Jan 05, 2014 9:35 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2014-01-05T07:49:41-07:00</updated>
<published>2014-01-05T07:49:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123332#p123332</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123332#p123332"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123332#p123332"><![CDATA[
I reworded the example on that page not to imply that it is exhaustive. Expect to see a few other games that INC $FFFD (or the like) to reset the mapper.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sun Jan 05, 2014 7:49 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Boolean]]></name></author>
<updated>2014-01-05T06:00:25-07:00</updated>
<published>2014-01-05T06:00:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123328#p123328</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123328#p123328"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123328#p123328"><![CDATA[
<a href="http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games" class="postlink">http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games</a> <strong>Tricky-to-emulate games page</strong> lists Bill &amp; Ted only.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6322">Boolean</a> — Sun Jan 05, 2014 6:00 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2014-01-05T04:46:18-07:00</updated>
<published>2014-01-05T04:46:18-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123325#p123325</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123325#p123325"/>
<title type="html"><![CDATA[Re: a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123325#p123325"><![CDATA[
AD&amp;D Hillsfar won't run unless you allow only 1 MMC1 write per opcode.<br /><br />The game immediately performs a RMW Absolute on a memory location which most emulators that have cycle-accurate CPU consider 2 writes instead of just 1. Bill &amp; Ted and other games require this behaviour.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Sun Jan 05, 2014 4:46 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Boolean]]></name></author>
<updated>2014-01-04T21:10:20-07:00</updated>
<published>2014-01-04T21:10:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123295#p123295</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123295#p123295"/>
<title type="html"><![CDATA[a MMC1 simple problem]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10853&amp;p=123295#p123295"><![CDATA[
Hello, everyone.<br /><br />1. My emulator executed 43319 instructions after launched <em>AD&amp;D Hillsfar (J)</em>, whether my MMC1 implementation manner was wrong?<br />following is stdout<br /><strong><br />Write addr      9000    data    1e<br />Write addr      b000    data    0<br />Write addr      ff00    data    0<br />Write addr      ff00    data    1a<br />Write addr      ff00    data    12<br />执行未文档化的操作码    $92<br />执行指令总数    43319<br /></strong><br /><br /><em>执行未文档化的操作码</em> means <em>CPU executed one bad opcode</em>, maybe CPU not switched<br />PRG-ROM Bank properly.<br /><em>执行指令总数</em> means <em>CPU already executed instructions</em><br /><br />2. When my emulator run <em>Double Dragon</em>, a strange thing occured.<br />When I killed the boss of mission 3 the mission didn't over, I went ahead and wraped to mission 3's start.<br /><br />Here is my MMC1 implementation using C++:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#ifndef __MAPPER001__H__<br />#define __MAPPER001__H__<br /><br />/*********************************************<br /> *<br /> * 2013年12月12日22:46:58<br /> *<br /> * Mapper001 (MMC1)<br /> *<br /> * Example :<br /> * Double Dragon 1<br /> *********************************************/<br /><br />#include &lt;iostream&gt;<br />using namespace std;<br /><br />#include &quot;Mapper.h&quot;<br />#include &quot;ROMParser.h&quot;<br /><br />// CPU Memory<br />extern BYTE *PROM&#91;4&#93;;<br /><br />// PPU Memory<br />extern BYTE *VROM&#91;8&#93;;<br /><br />class Mapper001 : public Mapper<br />{<br />public:<br />   Mapper001(ROMParser *parser):Mapper(parser){<br /><br />      // PROM BANK 16KB<br />      // VROM BANK 4KB<br /><br />      // 开始的16KB<br />      for(int i = 0;i &lt; 2;i++){<br />         ::PROM&#91;i&#93; = Mapper::PROM + i * 0x2000;<br />      }<br />      <br />      // 结尾的16KB<br />      for(int i = 0;i &lt; 2;i++){<br />         ::PROM&#91;i + 2&#93; = Mapper::PROM + (np - 1) * 0x4000 + i * 0x2000;<br />      }<br /><br />      for(int i = 0;i &lt; 8;i++){<br />         ::VROM&#91;i&#93; = Mapper::VROM + i * 0x400;<br />      }<br /><br />      // 清空寄存器<br />      memset(this-&gt;reg, 0, sizeof(reg));<br />      <br />      // 清空临时寄存器<br />      Reg = 0;<br /><br />      // 写偏移置为0<br />      Pos = 0;<br />   }<br /><br />   void SetData(WORD addr, BYTE data){<br />      if(data &amp; 0x80){ // 复位<br />         Pos = 0;<br />         reg&#91;0&#93; |= 0x0C;<br />      }else{<br />         // 想写入的数据<br />         BYTE b = data &amp; 0x01;<br />         b ? Reg |= (1 &lt;&lt; Pos) : Reg &amp;= ~(1 &lt;&lt; Pos);<br />         Pos++;<br /><br />         //cout&lt;&lt;&quot;This is &quot;&lt;&lt;hex&lt;&lt;(int)Pos&lt;&lt;&quot;th write addr\t$&quot;&lt;&lt;addr&lt;&lt;&quot;\tdata\t$&quot;&lt;&lt;(int)data&lt;&lt;endl;<br /><br />         if(Pos == 5){ // full<br /><br />            Reg &amp;= 0x1F;<br />            cout&lt;&lt;&quot;Write addr\t&quot;&lt;&lt;hex&lt;&lt;(int)addr&lt;&lt;&quot;\tdata\t&quot;&lt;&lt;(int)Reg&lt;&lt;endl;<br /><br />            if(addr &lt; 0xA000){         // 设置镜像 固定BANK<br />               reg&#91;0&#93; = Reg;<br />               this-&gt;Write0();<br /><br />            }else if(addr &lt; 0xC000){   // 设置VROM $0000 8K 或 4K<br />               reg&#91;1&#93; = Reg;<br />               this-&gt;Write1();<br /><br />            }else if(addr &lt; 0xE000){   // 设置VROM $1000 4K<br />               reg&#91;2&#93; = Reg;<br />               this-&gt;Write2();<br /><br />            }else{                  // 设置PROM<br />               reg&#91;3&#93; = Reg;<br />               this-&gt;Write3();<br />            }<br />            Pos = 0;<br />         }<br />      }<br />   }<br />   <br />   void  Load(BYTE* /*data*/, int /*len*/){<br /><br />      cout&lt;&lt;&quot;Mapper未实现加载状态&quot;&lt;&lt;endl;<br />      //system(&quot;pause&quot;);<br /><br />   }<br />   BYTE* Save(int * /*len*/){<br /><br />      cout&lt;&lt;&quot;Mapper未实现保存状态&quot;&lt;&lt;endl;<br />      //system(&quot;pause&quot;);<br />      return NULL;<br />   }<br />private:<br />   BYTE reg&#91;4&#93;;<br />   BYTE Reg; // 临时寄存器<br />   BYTE Pos; // 0 ~ 4<br /><br />   void Write0(){<br />      int mirror;<br />      int which = (0x03 &amp; reg&#91;0&#93;);<br />      switch(which){<br />         case 0:<br />            mirror = 2;<br />            break;<br />         case 1:<br />            mirror = 3;<br />            break;<br />         case 2:<br />            mirror = 1;<br />            break;<br />         default:<br />            mirror = 0;<br />      }<br />      ppu-&gt;SetMirrorManner( mirror );<br /><br />      <br />      // 固定BANK<br />      switch((reg&#91;0&#93; &gt;&gt; 2) &amp; 0x03){<br />         case 2: // fix first bank at $8000<br />            for(int i = 0;i &lt; 2;i++){<br />               ::PROM&#91;i&#93; = Mapper::PROM + i * 0x2000;<br />            }<br />            break;<br />         case 3: // fix last bank at $C000<br />            for(int i = 0;i &lt; 2;i++){<br />               ::PROM&#91;i + 2&#93; = Mapper::PROM + (Mapper::np - 1) * 0x4000 + i * 0x2000;<br />            }<br />            break;<br />      }<br />   }<br /><br />   void Write1(){<br /><br />      reg&#91;1&#93; %= 2 * Mapper::nv;<br /><br />      if(0x10 &amp; reg&#91;0&#93;){ // 切换4KB VROM in $0000<br /><br />         for(int i = 0;i &lt; 4;i++){<br />            ::VROM&#91;i&#93; = Mapper::VROM + (0x1F &amp; reg&#91;1&#93;) * 0x1000 + 0x400 * i;<br />         }<br /><br />      }else{ // 切换8KB VROM<br /><br />         for(int i = 0;i &lt; 8;i++){<br />            ::VROM&#91;i&#93; = Mapper::VROM + (0x1F &amp; reg&#91;1&#93;) * 0x1000 + 0x400 * i;<br />         }<br /><br />      }<br />   }<br />   void Write2(){<br />      if(0x10 &amp; reg&#91;0&#93;){<br /><br />         reg&#91;2&#93; %= 2 * Mapper::nv;<br /><br />         for(int i = 0;i &lt; 4;i++){ // 切换4KB VROM in $1000<br />            ::VROM&#91;4 + i&#93; = Mapper::VROM + (0x1F &amp; reg&#91;2&#93;) * 0x1000 + 0x400 * i ;<br />         }<br />      }<br /><br />   }<br />   void Write3(){<br />      if(!(0x08 &amp; reg&#91;0&#93;)){ // 切换32KB PROM<br /><br />         //reg&#91;3&#93; %= Mapper::np / 2;<br />         for(int i = 0;i &lt; 2;i++){<br />            ::PROM&#91;i&#93; = Mapper::PROM + ((0x0F &amp; reg&#91;3&#93;) &gt;&gt; 1) * 0x8000 + i * 0x2000;<br />            ::PROM&#91;i + 2&#93; = Mapper::PROM + ((0x0F &amp; reg&#91;3&#93;) &gt;&gt; 1) * 0x8000 + i * 0x2000 + 0x4000;<br />         }<br /><br />      }else{ // 切换16KB PROM<br /><br />         //reg&#91;3&#93; %= Mapper::np;<br />         if((0x0c &amp; reg&#91;0&#93;) == 0x0c){ // in $8000<br /><br />            for(int i = 0;i &lt; 2;i++){<br />               ::PROM&#91;i&#93; = Mapper::PROM + (0x0F &amp; reg&#91;3&#93;) * 0x4000 + i * 0x2000;<br />            }<br /><br />         }else if((0x08 &amp; reg&#91;0&#93;) == 0x08){ // in $C000<br /><br />            for(int i = 0;i &lt; 2;i++){<br />               ::PROM&#91;i + 2&#93; = Mapper::PROM + (0x0F &amp; reg&#91;3&#93;) * 0x4000 + i * 0x2000;<br />            }<br />            <br />         }else{<br />            cout&lt;&lt;&quot;16KB 切换出错&quot;&lt;&lt;endl;<br />            system(&quot;pause&quot;);<br />         }<br />      }<br />   }<br /><br />};<br /><br />#endif<br /><br /></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6322">Boolean</a> — Sat Jan 04, 2014 9:10 pm</p><hr />
]]></content>
</entry>
</feed>
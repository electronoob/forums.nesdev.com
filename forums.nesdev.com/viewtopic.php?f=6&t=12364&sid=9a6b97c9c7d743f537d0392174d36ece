<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - DMC confusion</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NES Music" href="http://forums.nesdev.com/feed.php?f=6" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - DMC confusion" href="http://forums.nesdev.com/feed.php?f=6&amp;t=12364" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Mar 20, 2015 5:43 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=6">NES Music</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=6&amp;t=12364">DMC confusion</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=6"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=6&amp;t=12364"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=6&amp;t=12364&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=6&amp;t=12364&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=6&amp;t=12364&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p140935"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p140935">DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=140935#p140935"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 10, 2015 12:21 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 66<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I was just trying out DMC samples, but I'm a little confused on how they exactly work. The $4011 degister is the most confusing one, since some documents call it DMC Load, some call it DMC Raw and some call it DAC. Which one is correct and what is it actually used for? Next thing is that I don't know which one of the DMC registers activate the sample playback when you write to them. The last things are the sample address and length. How can you load a 16 bit sample address with a 8 bit value? Do I write it twice like in PPUScroll? An what if sample lenth is longer than what 8 bit values can handle?  Do I have to play it as two individual samples or is there a way around this?</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p140936"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p140936">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=140936#p140936"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 10, 2015 1:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2023<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Playing a sample requires that you set the frequency ($4010), the sample address ($4012) and length ($4013) of the sample, then enabling the channel with $4015.<br /><br />Your other specific questions should be answered here: <a href="http://wiki.nesdev.com/w/index.php/APU_DMC" class="postlink">http://wiki.nesdev.com/w/index.php/APU_DMC</a><br /><br />If it's not clear from the wiki, ask again.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p140994"></a>
				<b class="postauthor">Bavi_H</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p140994">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=140994#p140994"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 10, 2015 11:58 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Mar 03, 2013 1:52 am<br /><b>Posts:</b> 20<br /><b>Location:</b> Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Here are some other documents:<br /><ul><li><a href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29" class="postlink">APU</a> (section DMC)</li><li><a href="http://nesdev.com/apu_ref.txt" class="postlink">Blargg's NES APU Reference</a></li></ul><br /><strong>Address and Length</strong><br /><br /><ul><li><a href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29" class="postlink">APU</a> says &quot;DPCM samples must begin in the memory range $C000-FFFF at an address set by register $4012 (address = %11AAAAAA.AA000000). The length of the sample in bytes is set by register $4013 (length = %LLLL.LLLL0001).&quot;</li><li><a href="http://nesdev.com/apu_ref.txt" class="postlink">Blargg's NES APU Reference</a> says &quot;When the DMC sample is restarted, the address counter is set to register $4012 * $40 + $C000 and the bytes counter is set to register $4013 * $10 + 1.&quot;</li></ul><br />I found Blargg's explaination easier to understand. In the wiki documents, be aware that % is sometimes used to prefix binary digits, like $ is used to prefix hexadecimal digits. And the . seems to just mark a byte boundary. Then you can see the % code is showing you how the bits you put in the register affect the resulting address and length values used.<br /><br /><strong>$4011 register</strong><br /><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">The $4011 degister is the most confusing one, since some documents call it DMC Load, some call it DMC Raw and some call it DAC. Which one is correct and what is it actually used for?</div><br />The various names all mean the same thing: The $4011 register sets the &quot;current level&quot; the DMC is outputting. <span style="font-size: 85%; line-height: normal">(Most people didn't have an official Nintendo document to know the &quot;official&quot; name for the register, so different documents give it different names. When an official Nintendo document was found, the <a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=10611#p119814" class="postlink">official APU register names</a> were rather undescriptive, so it's unlikely anyone would use the official name.)</span><br /><br />Here are some things this &quot;direct load&quot; register is used for:<br /><br /><ul><strong>Changing the starting level of a sample</strong><br /><br />As you may know, the sample format only lets you specify each point as &quot;go up&quot; or &quot;go down&quot;, not at exact value. As the sample is played, if the level is too low to go down further, or too high to go up further, it will stay where it is. By using different starting levels before playing the sample, you might be able to get different variations of sound from the same sample.<br /><br />In Ikinari Musician, a sample with a general downward trend is used. When the starting level is set to higher values, this causes the sample to be audible slightly longer before it bottoms out and effectively becomes silent. Using the different starting levels produces different variations of a click sound from the same sample.<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=2666" alt="downward-sample.png" /><br />
			<span class="gensmall">downward-sample.png [ 1.71 KiB | Viewed 220 times ]</span>
		

		<br />
	</div><br /><span style="font-size: 85%; line-height: normal">(P.S. In emulator FCEUX's lua scripting environment, register $4011 is called dmcseed, likely because it's used to set a seed or starting value for the sample.)</span><br /><br /><strong>Making sounds directly</strong><br /><br /><a href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29" class="postlink">APU</a> says &quot;The $4011 register can be used to play PCM samples directly by setting the counter value at a high frequency. Because this requires intensive use of the CPU, when used in games all other gameplay is usually halted to facilitate this.&quot;<br /><br />That is, if you are able to load the &quot;direct load&quot; register at a fast enough rate, you can make sounds beyond the restrictions of the &quot;go up&quot; / &quot;go down&quot; sample format. You are in charge of the exact value of each point, but you have to spend a lot of time updating the register.<br /><br />Battletoads uses direct DMC loading for some percussion sounds. TMNTDEMO.NES plays the Teenage Mutant Ninja Turtles cartoon theme song using direct DMC loading. <span style="font-size: 85%; line-height: normal">(In FCEUX, use SoundDisplay.lua and you can see the &quot;DMC Seed&quot; changing, but the note line doesn't flash because a sample is never started.)</span><br /><br /><strong>Triangle volume control (partial)</strong><br /><br /><a href="http://wiki.nesdev.com/w/index.php/APU#DMC_.28.244010-4013.29" class="postlink">APU</a> says &quot;Because of the APU's <a href="http://wiki.nesdev.com/w/index.php/APU#Mixer" class="postlink">nonlinear</a> mixing, a high value in the PCM counter reduces the volume of the triangle and noise channels. This is sometimes used to apply limited volume control to the triangle channel (e.g. Super Mario Bros. adjusts the counter between levels to accomplish this).&quot;</ul></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5902"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p140996"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p140996">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=140996#p140996"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 11, 2015 6:11 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 66<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks for the help.<br /><br />One last thing is that what do I use to trigger the DMC sample playback? Does the APU check that I have at least written something to $4010, $4012 and $4013 and then play the sample, or do I have to write the DMC triggering somewhere else?<br /><br />I remember seeing a RAM address in RECCA that quickly changes to 1 and then back to 0 when DMC is triggered. Is this just for the game to keep track that the sample has started, or is it used somehow else?<br /><br />Lastly, how should I make the DMC tracks for the music? Should I have a counter that counts down from specified value and then once it hits 0, it will play the next sample? Also, should I start the counter from DMC trigger or end?</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141001"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141001">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=141001#p141001"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 11, 2015 8:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=9_1426464006.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 13502<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">Lastly, how should I make the DMC tracks for the music? Should I have a counter that counts down from specified value and then once it hits 0, it will play the next sample?</div><br />In your music engine, how do you tell when any other note starts?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141006"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141006">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=141006#p141006"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 11, 2015 10:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2023<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">One last thing is that what do I use to trigger the DMC sample playback? Does the APU check that I have at least written something to $4010, $4012 and $4013 and then play the sample, or do I have to write the DMC triggering somewhere else?</div><br />The frequency state ($4010) applies immediately. The sample address and length ($4012 and $4013) apply at the next sample start or loop.<br /><br />To play a new sample, you use $4015. Typically you want to write to $4015 with the DMC bit clear first to stop any playing sample, then write a second time with the bit set to start the new sample.<br /><br /><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">I remember seeing a RAM address in RECCA that quickly changes to 1 and then back to 0 when DMC is triggered. Is this just for the game to keep track that the sample has started, or is it used somehow else?</div><br />What any game does with any RAM address is entirely arbitrary, so there's no way for me to tell you anything about what that RAM byte means from just this description.<br /><br /><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">Lastly, how should I make the DMC tracks for the music? Should I have a counter that counts down from specified value and then once it hits 0, it will play the next sample? Also, should I start the counter from DMC trigger or end?</div><br />The DMC maintains its own counter. You can read $4015 to check if the DMC bit is still on to see if the sample has finished. Are you trying to play a long stream of continuous sound through it? If you just want to stitch samples end to end, you might use the IRQ feature, possibly in combination with the looping state.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p142443"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p142443">Re: DMC confusion</a></div><div style="float: right;"><a href="./viewtopic.php?p=142443#p142443"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Mar 05, 2015 7:37 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 66<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry for not getting back to this one sooner. I just finished my code that plays DMC samples when pressing 'A'. 'Left' and 'Right' Lets you choose a different sample. All the selections caused by button presses seems to be working, but the first time I play a sample I hear a 'pop' sound and after that nothing if I try again.<br /><br />Here is whats in my main loop (and few lines before it):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDA #%00010000<br />&nbsp;STA APUStatus<br /><br />MainLoop:<br />&nbsp;LDA joy_1_frame<br />&nbsp;AND #%00000001<br />&nbsp;CMP #%00000001<br />&nbsp;BNE SkipA<br />&nbsp;LDA #$01<br />&nbsp;STA DMCTrigger<br /><br />SkipA:<br />&nbsp;LDA joy_1_frame<br />&nbsp;AND #%01000000<br />&nbsp;CMP #%01000000<br />&nbsp;BNE SkipLeft<br />&nbsp;LDA DMCSample<br />&nbsp;SEC<br />&nbsp;SBC #$01<br />&nbsp;CMP #$FF<br />&nbsp;BNE SkipUnderflow<br />&nbsp;LDA #$00<br />SkipUnderflow:<br />&nbsp;STA DMCSample<br /><br />SkipLeft:<br />&nbsp;LDA joy_1_frame<br />&nbsp;AND #%10000000<br />&nbsp;CMP #%10000000<br />&nbsp;BNE SkipRight<br />&nbsp;LDA DMCSample<br />&nbsp;CLC<br />&nbsp;ADC #$01<br />&nbsp;CMP #$06<br />&nbsp;BNE SkipOverflow<br />&nbsp;LDA #$05<br />SkipOverflow:<br />&nbsp;STA DMCSample<br /><br />SkipRight:<br />&nbsp;LDA #$01<br />&nbsp;STA sleeping<br />MainSleep:<br />&nbsp;LDX sleeping<br />&nbsp;CPX #$00<br />&nbsp;BNE MainSleep<br />&nbsp;JMP MainLoop<br /></div><br /><br />Here is my DMC code (in NMI):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">DMCPlay:<br />&nbsp;LDX DMCTrigger<br />&nbsp;CPX #$01<br />&nbsp;BNE SkipDMC<br />&nbsp;LDY DMCSample<br />&nbsp;LDA DPCMFreq, y<br />&nbsp;STA DMCFreq<br />&nbsp;LDA DPCMLoad, y<br />&nbsp;STA DMCLoad<br />&nbsp;LDA DPCMAddr, y<br />&nbsp;STA DMCAddr<br />&nbsp;LDA DPCMLength, y<br />&nbsp;STA DMCLength<br /><br />&nbsp;LDX #$00<br />&nbsp;STX DMCTrigger<br /><br />SkipDMC:<br />...<br /></div><br /><br />Here are the lookup tables:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">DPCMFreq:<br />&nbsp;.db $0F,$0F,$0F,$0F,$0F,$0F<br /><br />DPCMLoad:<br />&nbsp;.db $3C,$40,$40,$3C,$40,$30<br /><br />DPCMAddr:<br />&nbsp;.db $00,$24,$1E,$04,$11,$2C<br /><br />DPCMLength:<br />&nbsp;.db $10,$20,$18,$34,$34,$1C<br /></div><br /><br />And here is the .incbins:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.bank 3<br />&nbsp;.org $C000<br />&nbsp;.incbin &quot;Recca_$C000.dmc&quot;<br />&nbsp;.org $C100<br />&nbsp;.incbin &quot;Recca_$C100.dmc&quot;<br />&nbsp;.org $C440<br />&nbsp;.incbin &quot;Recca_$C440.dmc&quot;<br />&nbsp;.org $C780<br />&nbsp;.incbin &quot;Recca_$C780.dmc&quot;<br />&nbsp;.org $C900<br />&nbsp;.incbin &quot;Recca_$C900.dmc&quot;<br />&nbsp;.org $CB00<br />&nbsp;.incbin &quot;Recca_$CB00.dmc&quot;<br /></div><br /><br />The samples and lookup table values are from Recca (didn't include the pitched down samples) to make it easier for me to at least get things working.</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=6&amp;t=12364"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=6"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=6&amp;t=12364"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=6">NES Music</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="12364" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6" selected="selected">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;Reproduction</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
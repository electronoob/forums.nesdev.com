<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - New NTSC decoder with integer-only math (short C++ code)</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - New NTSC decoder with integer-only math (short C++ code)" href="http://forums.nesdev.com/feed.php?f=2&amp;t=14338" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=14338';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Tue Mar 19, 2019 6:10 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=14338">New NTSC decoder with integer-only math (short C++ code)</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=14338"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 31 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=14338&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=14338&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=14338&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=14338&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=14338&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=14338&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172329"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172329">New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172329#p172329"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 01, 2016 11:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A year or two ago someone on #nesdev talked with me about my NTSC decoder. I think it was Thefox. After I created the example code for the NTSC video wiki page, I had rewritten the NTSC modem for my QuickBASIC NES emulator, resulting in much more efficient design. I promised them to share my code, but I never did. Here it is now:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/**<br />&nbsp;* NTSC_DecodeLine(Width, Signal, Target, Phase0)<br />&nbsp;*<br />&nbsp;* Convert NES NTSC graphics signal into RGB using integer arithmetics only.<br />&nbsp;*<br />&nbsp;* Width: Number of NTSC signal samples.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; For a 256 pixels wide screen, this would be 256*8. 283*8 if you include borders.<br />&nbsp;*<br />&nbsp;* Signal: An array of Width samples.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The following sample values are recognized:<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -29 = Luma 0 low&nbsp; &nbsp;32 = Luma 0 high (-38 and&nbsp; 6 when attenuated)<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -15 = Luma 1 low&nbsp; &nbsp;66 = Luma 1 high (-28 and 31 when attenuated)<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;22 = Luma 2 low&nbsp; 105 = Luma 2 high ( -1 and 58 when attenuated)<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;71 = Luma 3 low&nbsp; 105 = Luma 3 high ( 34 and 58 when attenuated)<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;In this scale, sync signal would be -59 and colorburst would be -40 and 19,<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;but these are not interpreted specially in this function.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The value is calculated from the relative voltage with:<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;floor((voltage-0.518)*1000/12)-15<br />&nbsp;*<br />&nbsp;* Target: Pointer to a storage for Width RGB32 samples (00rrggbb).<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Note that the function will produce a RGB32 value for _every_ half-clock-cycle.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This means 2264 RGB samples if you render 283 pixels per scanline (incl. borders).<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The caller can pick and choose those columns they want from the signal<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to render the picture at their desired resolution.<br />&nbsp;*<br />&nbsp;* Phase0: An integer in range 0-11 that describes the phase offset into colors on this scanline.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Would be generated from the PPU clock cycle counter at the start of the scanline.<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;In essence it conveys in one integer the same information that real NTSC signal<br />&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;would convey in the colorburst period in the beginning of each scanline.<br />&nbsp;*/<br />void NTSC_DecodeLine(int Width,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const char Signal&#91;/*Width*/&#93;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unsigned Target&#91;/*Width*/&#93;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int Phase0)<br />{<br />&nbsp; &nbsp; static constexpr int Ywidth = 12, Iwidth = 23, Qwidth = 23;<br />&nbsp; &nbsp; /* Ywidth, Iwidth and Qwidth are the filter widths for Y,I,Q respectively.<br />&nbsp; &nbsp; &nbsp;* All widths at 12 produce the best signal quality.<br />&nbsp; &nbsp; &nbsp;* 12,24,24 would be the closest values matching the NTSC spec.<br />&nbsp; &nbsp; &nbsp;* But off-spec values 12,22,26 are used here, to bring forth mild<br />&nbsp; &nbsp; &nbsp;* &quot;chroma dots&quot;, an artifacting common with badly tuned TVs.<br />&nbsp; &nbsp; &nbsp;* Larger values = more horizontal blurring.<br />&nbsp; &nbsp; &nbsp;*/<br />&nbsp; &nbsp; static constexpr int Contrast = 167941, Saturation = 144044;<br /><br />&nbsp; &nbsp; static constexpr char sinetable&#91;27&#93; = {0,4,7,8,7,4, 0,-4,-7,-8,-7,-4,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0,4,7,8,7,4, 0,-4,-7,-8,-7,-4,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0,4,7}; // 8*sin(x*2pi/12)<br />&nbsp; &nbsp; // To finetune hue, you would have to recalculate sinetable&#91;&#93;.<br />&nbsp; &nbsp; // Coarse changes can be made with Phase0.<br /><br />&nbsp; &nbsp; auto Read = &#91;=&#93;(int pos) -&gt; char { return pos&gt;=0 ? Signal&#91;pos&#93; : 0; };<br />&nbsp; &nbsp; auto Cos&nbsp; = &#91;=&#93;(int pos) -&gt; char { return sinetable&#91;(pos+36)%12&nbsp; +Phase0&#93;; };<br />&nbsp; &nbsp; auto Sin&nbsp; = &#91;=&#93;(int pos) -&gt; char { return sinetable&#91;(pos+36)%12+3+Phase0&#93;;&nbsp; &nbsp;};<br /><br />&nbsp; &nbsp; int ysum = 0, isum = 0, qsum = 0;<br />&nbsp; &nbsp; for(int s=0; s&lt;Width; ++s)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; ysum += Read(s)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - Read(s-Ywidth);<br />&nbsp; &nbsp; &nbsp; &nbsp; isum += Read(s) * Cos(s) - Read(s-Iwidth) * Cos(s-Iwidth);<br />&nbsp; &nbsp; &nbsp; &nbsp; qsum += Read(s) * Sin(s) - Read(s-Qwidth) * Sin(s-Qwidth);<br />&nbsp; &nbsp; &nbsp; &nbsp; constexpr int br=Contrast, sa=Saturation;<br />&nbsp; &nbsp; &nbsp; &nbsp; constexpr int yr = br/Ywidth, ir = br* 1.994681e-6*sa/Iwidth, qr = br* 9.915742e-7*sa/Qwidth;<br />&nbsp; &nbsp; &nbsp; &nbsp; constexpr int yg = br/Ywidth, ig = br* 9.151351e-8*sa/Iwidth, qg = br*-6.334805e-7*sa/Qwidth;<br />&nbsp; &nbsp; &nbsp; &nbsp; constexpr int yb = br/Ywidth, ib = br*-1.012984e-6*sa/Iwidth, qb = br* 1.667217e-6*sa/Qwidth;<br />&nbsp; &nbsp; &nbsp; &nbsp; int r = std::min(255,std::max(0, (ysum*yr + isum*ir + qsum*qr) / 65536 ));<br />&nbsp; &nbsp; &nbsp; &nbsp; int g = std::min(255,std::max(0, (ysum*yg + isum*ig + qsum*qg) / 65536 ));<br />&nbsp; &nbsp; &nbsp; &nbsp; int b = std::min(255,std::max(0, (ysum*yb + isum*ib + qsum*qb) / 65536 ));<br />&nbsp; &nbsp; &nbsp; &nbsp; Target&#91;s&#93; = (r &lt;&lt; 16) | (g &lt;&lt; 8) | b;<br />&nbsp; &nbsp; }<br />}</div><br />Tip: This code lends itself excellently to parallelization. I will leave the required changes as an exercise to the reader.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> on Sun Jun 05, 2016 8:20 pm, edited 4 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172332"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172332">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172332#p172332"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 01, 2016 11:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 21204<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Under what license may this decoder be used?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172333"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172333">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172333#p172333"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jun 01, 2016 11:54 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Under what license may this decoder be used?</div><br />MIT. Or CC-BY-SA, I guess. Since this is more of a documentation thing.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172394"></a>
				<b class="postauthor">feos</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172394">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172394#p172394"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 12:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4847_1429913142.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 19, 2011 11:26 am<br /><b>Posts:</b> 107<br /><b>Location:</b> RU
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Woah how smart! That still can be done in old C++ with #define, can it? I think lambda is also traslatable. If I manage to tweak it to meet the PAL standard, it will save me months of brainstorming.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4847"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172422"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172422">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172422#p172422"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 8:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">feos wrote:</div><div class="quotecontent">Woah how smart! That still can be done in old C++ with #define, can it? I think lambda is also traslatable. If I manage to tweak it to meet the PAL standard, it will save me months of brainstorming.</div><br />Yes, lambda can be converted into a #define and constexpr into const, to support compilation on more than 5 years old compilers.<br /><br />As far as I know, to change it into PAL, you have to convert the YIQ matrix (those floating point constants) into YUV matrix, and that's pretty much it for this function (and even then it is unnecessary, since YUV is just a phase variant of YIQ). In the signal generator you would generate opposing phases on every other scanline, and indicate Phase0 accordingly.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172424"></a>
				<b class="postauthor">feos</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172424">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172424#p172424"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 8:52 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4847_1429913142.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 19, 2011 11:26 am<br /><b>Posts:</b> 107<br /><b>Location:</b> RU
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Right. Can you post some example images of your filter?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4847"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172430"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172430">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172430#p172430"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 9:43 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">feos wrote:</div><div class="quotecontent">Right. Can you post some example images of your filter?</div><br />Well I haven't put it into any emulator, but here's three snapshots created by recording the NTSC signal from my QuickBASIC NES emulator, saving it into file, and decoding with this C++ program, rendering at 640x240 (with no interpolation), writing to stdout, and rendering with ffplay with its default sws scaler to 1280x960 (I believe that's bicubic). Click to view full size. I have not adjusted the hue/contrast/saturation settings to match some particular palette, so they are what they are.<br /><a href="http://bisqwit.iki.fi/kala/snap/ntsc0_cv.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_cv_thu.jpg" alt="Image" /></a> <a href="http://bisqwit.iki.fi/kala/snap/ntsc0_smb.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_smb_thu.jpg" alt="Image" /></a> <a href="http://bisqwit.iki.fi/kala/snap/ntsc0_kby.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_kby_thu.jpg" alt="Image" /></a></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> on Thu Jun 02, 2016 10:04 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172434"></a>
				<b class="postauthor">feos</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172434">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172434#p172434"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 9:57 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4847_1429913142.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 19, 2011 11:26 am<br /><b>Posts:</b> 107<br /><b>Location:</b> RU
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">If not inside an emulator, then how did you test it?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4847"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172435"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172435">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172435#p172435"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 9:59 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 21204<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You may have missed this line:<br /><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent">recording the NTSC signal from my QuickBASIC NES emulator, saving it into file, and decoding with this C++ program</div><br /><br />Another way would involve a &quot;preview&quot; tool that works on BMP or PNG images.<br /><ol style="list-style-type: decimal"><li>Load a screenshot of an NES game </li><li>Convert RGB values to closest NES color numbers </li><li>Run filter on each line </li><li>Save filtered screenshot </li></ol><br />These screenshots appear to be of one field. Normally the NES PPU's color subcarrier phase has a two-field sequence due to the missing dot between pre-render and the first line of picture on every other field. So to operate on still images (instead of live emulator output), use starting phase offsets 0 and 4 and average them.<br /><br /><br />This appears to be a generic NTSC signal decoder that operates at 12 times color burst. I bet it wouldn't need any change to work on Apple II graphics or CGA graphics in the unofficial 640x200+color burst mode, which operate at 2 to 4 times color burst: just feed each hires pixel 6 times or each double hires pixel 3 times, with transitions delayed by 3 units in slivers with bit 7 set to true.<br /><br />One optimization might be to produce output only for pixels at 0, 3, 7, 11, 14, ... which would have the side effect of also correcting the pixel aspect ratio to an even 1:2.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172437"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172437">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172437#p172437"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 10:07 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">As I just explained. Maybe you didn't read it. In my <a href="http://bisqwit.iki.fi/jutut/kuvat/programming_examples/qbnes/" class="postlink">QuickBASIC NES emulator</a>, that does contain a NTSC modem, I save the generated NTSC signal into a file.*<br /><br />Then this file gets read by the C++ program showcased in this thread. The C++ program generates RGB. The main program nearest-neighbor-scales the picture down to 640Ã—240 (from the 2240Ã—240 that it is), and writes into stdout. This output is piped into the following command, which renders it. <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">ffplay -pix_fmt bgra -s 640x240 -vf scale=1280:960 -f rawvideo -</tt> And lastly a window screenshot is saved into a PNG file.<br /><br />For the sake of completeness, here's the rest of the program.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#include &lt;cmath&gt;<br />#include &lt;algorithm&gt;<br />#include &lt;iostream&gt;<br /><br />&lt;&lt;&lt; Insert the function from the first post here&gt;&gt;&gt;<br /><br />int main()<br />{<br />&nbsp; &nbsp; /* Read 280x240 image frames (2240*240), render them at 640*240 */<br />&nbsp; &nbsp; FILE* fp = popen(&quot;lz4 -d &lt;/chii/bisqwit/qbexample/qbnes/ntsclog.bin.lz4&quot;, &quot;r&quot;);<br />&nbsp; &nbsp; FILE* fp2 = stdout;//fopen(&quot;rgb.bin&quot;, &quot;wb&quot;);<br />&nbsp; &nbsp; const unsigned W = 280 * 8;<br />&nbsp; &nbsp; while(!feof(fp))<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; unsigned Screen&#91;W*240&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; char Buf&#91;W*240&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; for(int rem=sizeof(Buf), p=0, c; rem&gt;0 &amp;&amp; (c=std::fread(Buf+p,1,rem,fp)) &gt; 0; rem-=c, p+=c)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {}<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; #pragma omp parallel for<br />&nbsp; &nbsp; &nbsp; &nbsp; for(unsigned y=0; y&lt;240; ++y)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NTSC_DecodeLine(W, Buf+y*W, Screen+y*W, (11+y*4)%12);<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; for(unsigned y=0; y&lt;240; ++y)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(unsigned x=0; x&lt;640; ++x)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unsigned p = Screen&#91;y*W + (x*W/640)&#93;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std::fwrite(&amp;p, 1, 4, fp2);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />}</div><br />NES palette color numbers are not involved at any point.<br /><br />*) Portions of the signal. The NTSC modem in that emulator actually processes contiguous signal for the whole frame, including the vblank, hsyncs, colorbursts and all that; but I only write into the file the portions corresponding to the visible region. Here's an example of that signal (LZ4 compressed): <!-- m --><a class="postlink" href="http://bisqwit.iki.fi/kala/snap/ntsc0_kby_log.lz4">http://bisqwit.iki.fi/kala/snap/ntsc0_kby_log.lz4</a><!-- m --> And here's what it looks like <em>if interpreted as monochrome television signal</em> or using a digital oscilloscope, using <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">lz4 -d &lt; file.lz4 | ffplay -pix_fmt gray -s 2240x240 -vf scale=1280:960 -f rawvideo -</tt>:<br /><a href="http://bisqwit.iki.fi/kala/snap/ntsc0_kby_mono.png" class="postlink">http://bisqwit.iki.fi/kala/snap/ntsc0_kby_mono.png</a><br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">This appears to be a generic NTSC signal decoder that operates at 12 times color burst. I bet it wouldn't need any change to work on Apple II graphics or CGA graphics in the unofficial 640x200+color burst mode, which operate at 2 to 4 times color burst: just feed each hires pixel 6 times or each double hires pixel 3 times, with transitions delayed by 3 units in slivers with bit 7 set to true.<br /><br />One optimization might be to produce output only for pixels at 0, 3, 7, 11, 14, ... which would have the side effect of also correcting the pixel aspect ratio to an even 1:2.</div><br />You are correct.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> on Thu Jun 02, 2016 10:37 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172443"></a>
				<b class="postauthor">feos</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172443">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172443#p172443"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 10:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4847_1429913142.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 19, 2011 11:26 am<br /><b>Posts:</b> 107<br /><b>Location:</b> RU
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It all makes sense now, thank you.<br /><br />Can you feed it this ROM? Preferably, in both monochrome and color.</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=5932">nes palette viewer.nes</a> [24.02 KiB]
			</span><br />
			<span class="gensmall">Downloaded 248 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4847"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172445"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172445">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172445#p172445"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 10:43 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">feos wrote:</div><div class="quotecontent">It all makes sense now, thank you.<br />Can you feed it this ROM? Preferably, in both monochrome and color.</div><br /><a href="http://bisqwit.iki.fi/kala/snap/ntsc0_pale0.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_pale0_thu.jpg" alt="Image" /></a> <a href="http://bisqwit.iki.fi/kala/snap/ntsc0_pale1.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_pale1_thu.jpg" alt="Image" /></a><br />It seems to be a bit on the unsaturated side, but like I said before, I haven't particularly finetuned those settings. The second picture is not perfectly grayscale, because ffmpeg is interpreting the negative luma0-lo as a large positive number. Shortcoming of the simple ffmpeg commandline I used. The pictures are also of different frames, which explains the differences in the positionings of the little artifacts.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172451"></a>
				<b class="postauthor">feos</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172451">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172451#p172451"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 11:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4847_1429913142.gif" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 19, 2011 11:26 am<br /><b>Posts:</b> 107<br /><b>Location:</b> RU
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I just compared it to my FamicomAV captured through a tuner. It's <strong>damn close</strong>!<br /><br /><img src="https://dl.dropboxusercontent.com/u/13609086/famicom-interpolated.PNG" alt="Image" /><br /><br />Can you say a few words how your filter only adds moire to color borders? I can't instantly see it form the code.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4847"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p172460"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172460">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172460#p172460"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 02, 2016 12:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The blue is kind of different though.<br /><br /><div class="quotetitle">feos wrote:</div><div class="quotecontent">Can you say a few words how your filter only adds moire to color borders? I can't instantly see it form the code.</div><br />It comes naturally from how NTSC works. To accurate determine a both color and amplitude, you need 12 samples of the color signal (in terms of NES PPU half-clock cycles).<br />A color signal could look like this: <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LLLLHHHHHHLL</tt>, which repeated gives <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LLLLHHHHHHLLLLLLHHHHHHLLLLLLHHHHHHLLLLLLHHHHHHLL</tt>. A nice square wave.<br />Another color would look like this: <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LLHHHHHHLLLL</tt>, which repeated gives <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LLHHHHHHLLLLLLHHHHHHLLLLLLHHHHHHLLLLLLHHHHHHLLLL</tt>.<br />You can sample this square wave from any point you want, and you always get the same color, provided you know which phase you are comparing it against (this is the colorburst, or Phase0 in my decoder). But when these two signals are put next to each others:<br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LLLLHHHHHHLLLLLLHHHHHHLLLLHHHHHHLLLLLLHHHHHHLLLL</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">000000000000111111111111222222222222333333333333</tt><br />And here in the middle of the transition, you get a signal sample like this:<br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">HHHHLLLLHHHH</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">111111222222</tt><br />Which decodes into something completely different from either source color. It's not even a nicely-proportioned square wave anymore: there's more &quot;high&quot; than &quot;low&quot; in it. That's how the color edge artifacts are born. That is the basic idea. This is compounded by the fact that NES pixels are 8 samples long, not 12, even though the color wavelength is 12 samples.<br /><br />As for the staircase pattern, this is caused by the PPU clock cycle counter being different on each scanline, repeating every 3 scanlines. You can see this easily in the monochrome pictures shown earlier.<br />Suppose you have a 4x6 pixel region. For this 4x6 pixel region, on consecutive clockcycles, the PPU signal generator clock could go like this:<br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">pixel0..pixel1..pixel2..pixel3..</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">0123456789AB0123456789AB01234567</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">456789AB0123456789AB0123456789AB</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">89AB0123456789AB0123456789AB0123</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">0123456789AB0123456789AB01234567</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">456789AB0123456789AB0123456789AB</tt><br /><tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">89AB0123456789AB0123456789AB0123</tt><br />The color-wave clock (periodicity = 12) aligns differently with respect to screen pixels (periodicity = 8) on each scanline. Because of this, the pattern that gets falsely decoded between two pixels changes from scanline to the next. The pixels themselves do not move, but the decoding of colors produces different results at the edges of color changes.<br />There is nothing in the NTSC decoder that is responsible for producing or simulating this phenomenon. It is just a fact of how the NTSC signal is generated by the NES PPU in the first place.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p172817"></a>
				<b class="postauthor">Bisqwit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p172817">Re: New NTSC decoder with integer-only math (short C++ code)</a></div><div style="float: right;"><a href="./viewtopic.php?p=172817#p172817"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jun 05, 2016 8:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://bisqwit.iki.fi/kala/hloop.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Oct 14, 2011 1:09 am<br /><b>Posts:</b> 248
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I said earlier the brightness &amp; hue options have not been particularly finetuned. I have updated the code in the first post now. I generated a palette with Drag's tool at <!-- m --><a class="postlink" href="http://drag.wootest.net/misc/palgen.html">http://drag.wootest.net/misc/palgen.html</a><!-- m --> , set brightness to -0.15 (the default was -0.20), all clipping methods to desaturate, and downloaded a .pal file. Then I created a program that optimizes the parameters in my generator using a genetic algorithm until it gets a palette that is very close to what Drag's tool generated. (Tip: Instead of changing the sine wave offset, you can bake the phase rotation into the YIQ-RGB conversion matrix, for same effect.)<br /><br />Note that this process also involved changing the input data values.<br /><br />Sample output:<br /><a href="http://bisqwit.iki.fi/kala/snap/ntsc0_pale2.png" class="postlink"><img src="http://bisqwit.iki.fi/kala/snap/ntsc0_pale2_thu.jpg" alt="Image" /></a><br /><br />Here's a tiny version of the function, without a saturation adjust knob:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void NTSC_DecodeLine(int Width, const char* Signal, unsigned* Target, unsigned Phase0)&nbsp; &nbsp; &nbsp;<br />{<br />&nbsp; &nbsp; static constexpr int Ywidth = 12, Cwidth = 23, Y = 168084/Ywidth;<br />&nbsp; &nbsp; auto sine = &#91;p=Phase0+11u&#93;(unsigned x)<br />&nbsp; &nbsp; &nbsp; &nbsp; { return &quot;\4\7\10\7\4\0\374\371\370\371\374&quot;&#91;(p+x)%12u&#93;; }; // 8*sin((Phase0+x) * 2pi / 12)<br />&nbsp; &nbsp; for(int y=0,i=0,q=0, s=0; s&lt;Width; ++s)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; y += Signal&#91;s&#93;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- (s&gt;=Ywidth ? Signal&#91;s-Ywidth&#93;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 0);<br />&nbsp; &nbsp; &nbsp; &nbsp; i += Signal&#91;s&#93; * sine(0+s) - (s&gt;=Cwidth ? Signal&#91;s-Cwidth&#93; * sine(0+s-Cwidth%12) : 0);<br />&nbsp; &nbsp; &nbsp; &nbsp; q += Signal&#91;s&#93; * sine(3+s) - (s&gt;=Cwidth ? Signal&#91;s-Cwidth&#93; * sine(3+s-Cwidth%12) : 0);<br />&nbsp; &nbsp; &nbsp; &nbsp; Target&#91;s&#93; = 0x1u * std::min(255u, unsigned(std::max(0, y*Y + i*(-25002/Cwidth) + q*( 40674/Cwidth))) &gt;&gt; 16)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + 0x100u * std::min(255u, unsigned(std::max(0, y*Y + i*(&nbsp; 1852/Cwidth) + q*(-16386/Cwidth))) &gt;&gt; 16)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + 0x10000u * std::min(255u, unsigned(std::max(0, y*Y + i*( 48343/Cwidth) + q*( 23925/Cwidth))) &gt;&gt; 16);<br />&nbsp; &nbsp; }<br />}</div><br /><br />EDIT: Here is a version that uses Intel AVX2 intrinsics to calculate <em>eight pixels</em> simultaneously with a single CPU core using the 256-bit YMM registers. It is significantly faster.<br />It requires a CPU capable of AVX2, i.e. Haswell or newer.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#include &lt;immintrin.h&gt;<br /><br />void NTSC_DecodeLine(int Width, const char* Signal, unsigned* Target, unsigned Phase0)<br />{<br />&nbsp; &nbsp; static constexpr int YW = 12, CW = 23;<br />&nbsp; &nbsp; __m128i yiq = _mm_setzero_si128();<br />&nbsp; &nbsp; for(int s=0; s&lt;Width; s+=8)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; auto to128lo = &#91;&#93;(__m256i a) { return _mm256_extractf128_si256(a, 0); };<br />&nbsp; &nbsp; &nbsp; &nbsp; auto to128hi = &#91;&#93;(__m256i a) { return _mm256_extractf128_si256(a, 1); };<br />&nbsp; &nbsp; &nbsp; &nbsp; auto combine128 = &#91;&#93;(__m128i a,__m128i b) { return _mm256_insertf128_si256(_mm256_castsi128_si256(b), a, 1); };<br />&nbsp; &nbsp; &nbsp; &nbsp; auto modulo12 = &#91;&amp;&#93;(__m256i v)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return _mm256_sub_epi16(v, _mm256_mullo_epi16(_mm256_set1_epi16(12),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_srli_epi16(_mm256_mulhi_epu16(v,_mm256_set1_epi16(0xAAAB)),3)));<br />&nbsp; &nbsp; &nbsp; &nbsp; };<br />&nbsp; &nbsp; &nbsp; &nbsp; auto sine = &#91;&amp;&#93;(__m256i mod12) // 8*sin(x * 2pi / 12)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //static constexpr int st&#91;12&#93;={0,4,7,8,7,4,0,-4,-7,-8,-7,-4};<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //return _mm256_i32gather_epi32(st, mod12, 4);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mod12 = _mm256_slli_epi32(mod12, 2); // Multiply by 4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; auto c = _mm256_set1_epi32(0x478740), t = _mm256_set1_epi32(24);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // x&lt;24 ? ((0x478740u&gt;&gt;(x)) &amp; 0xF) : -((0x478740u&gt;&gt;(x-24)) &amp; 0xF);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return _mm256_blendv_epi8(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_and_si256(_mm256_set1_epi32(0xF), _mm256_srlv_epi32(c, mod12)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_sub_epi32(_mm256_setzero_si256(),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_and_si256(_mm256_set1_epi32(0xF), _mm256_srlv_epi32(c, _mm256_sub_epi32(mod12, t)))),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cmpgt_epi32(mod12, _mm256_set1_epi32(23)));<br />&nbsp; &nbsp; &nbsp; &nbsp; };<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; // Load signal samples. 3 values for each pixel (current, y-old, c-old)<br />&nbsp; &nbsp; &nbsp; &nbsp; auto sigoffsets0 = _mm256_add_epi16(_mm256_set1_epi16(s),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_set_epi16(3-CW,3-YW,7,5, 2-CW,2-YW,6,4,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1-CW,1-YW,3,1, 0-CW,0-YW,2,0));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto sigoffsets1 = _mm_add_epi16(_mm_set1_epi16(s),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm_set_epi16(7-CW,7-YW,5-CW,5-YW, 6-CW,6-YW, 4-CW,4-YW));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto siggood0 = _mm256_cmpgt_epi16(sigoffsets0, _mm256_set1_epi16(-1));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto siggood1 =&nbsp; &nbsp; _mm_cmpgt_epi16(sigoffsets1,&nbsp; &nbsp; _mm_set1_epi16(-1));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i sigs0 = _mm256_sub_epi32(_mm256_and_si256(_mm256_add_epi32(_mm256_set1_epi32(128),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mask_i32gather_epi32(_mm256_setzero_si256(), (const int*)Signal,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(to128lo(sigoffsets0)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(to128lo(siggood0)), 1)), _mm256_set1_epi32(0xFF)), _mm256_set1_epi32(128));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i sigs1 = _mm256_sub_epi32(_mm256_and_si256(_mm256_add_epi32(_mm256_set1_epi32(128),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mask_i32gather_epi32(_mm256_setzero_si256(), (const int*)Signal,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(to128hi(sigoffsets0)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(to128hi(siggood0)), 1)), _mm256_set1_epi32(0xFF)), _mm256_set1_epi32(128));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i sigs2 = _mm256_sub_epi32(_mm256_and_si256(_mm256_add_epi32(_mm256_set1_epi32(128),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mask_i32gather_epi32(_mm256_setzero_si256(), (const int*)Signal,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(sigoffsets1),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_cvtepi16_epi32(siggood1), 1)), _mm256_set1_epi32(0xFF)), _mm256_set1_epi32(128));<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; // Load sinetable values. 4 values for each pixel (sin+cos now and back-then)<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i nv0 = modulo12(_mm256_add_epi16(_mm256_set1_epi16(Phase0+s),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_set_epi16(90-CW,87-CW,90,87, 89-CW,86-CW,89,86, 88-CW,85-CW,88,85, 87-CW,84-CW,87,84)));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i n0 = sine(_mm256_cvtepu16_epi32(to128lo(nv0))), n1 = sine(_mm256_cvtepu16_epi32(to128hi(nv0)));<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i nv1 = modulo12(_mm256_add_epi16(_mm256_set1_epi16(Phase0+s),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_set_epi16(94-CW,91-CW,94,91, 93-CW,90-CW,93,90, 92-CW,89-CW,92,89, 91-CW,88-CW,91,88)));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i n2 = sine(_mm256_cvtepu16_epi32(to128lo(nv1))), n3 = sine(_mm256_cvtepu16_epi32(to128hi(nv1)));<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; // Multiply and subtract<br />&nbsp; &nbsp; &nbsp; &nbsp; auto ca = _mm256_sub_epi32(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs0, 0x00), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n0,16), 0x66)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs0, 0xFE), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n0,56), 0x66)));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto cb = _mm256_sub_epi32(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs0, 0x55), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n1,16), 0x66)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs1, 0xFE), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n1,56), 0x66)));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto cc = _mm256_sub_epi32(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs1, 0x00), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n2,16), 0x66)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs2, 0x54), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n2,56), 0x66)));<br />&nbsp; &nbsp; &nbsp; &nbsp; auto cd = _mm256_sub_epi32(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs1, 0x55), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n3,16), 0x66)),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _mm256_mullo_epi32(_mm256_shuffle_epi32(sigs2, 0xFE), _mm256_blend_epi32(_mm256_set_epi32(0,0,0,1, 0,0,0,1), _mm256_shuffle_epi32(n3,56), 0x66)));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m128i a = _mm_add_epi32(yiq, to128lo(ca)), b = _mm_add_epi32(a, to128hi(ca)); __m256i com0=combine128(a,b);<br />&nbsp; &nbsp; &nbsp; &nbsp; __m128i c = _mm_add_epi32(b,&nbsp; &nbsp;to128lo(cb)), d = _mm_add_epi32(c, to128hi(cb)); __m256i com1=combine128(c,d);<br />&nbsp; &nbsp; &nbsp; &nbsp; __m128i e = _mm_add_epi32(d,&nbsp; &nbsp;to128lo(cc)), f = _mm_add_epi32(e, to128hi(cc)); __m256i com2=combine128(e,f);<br />&nbsp; &nbsp; &nbsp; &nbsp; __m128i g = _mm_add_epi32(f,&nbsp; &nbsp;to128lo(cd)), h = _mm_add_epi32(g, to128hi(cd)); __m256i com3=combine128(g,h); yiq = h;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; // Convert into RGB<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i lo0 = _mm256_unpacklo_epi32(com0,com2), lo1 = _mm256_unpacklo_epi32(com1,com3);<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i hi0 = _mm256_unpackhi_epi32(com0,com2), hi1 = _mm256_unpackhi_epi32(com1,com3);<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i dy = _mm256_mullo_epi32(_mm256_set1_epi32( 168084/YW ),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_permutevar8x32_epi32(_mm256_unpacklo_epi32(lo0,lo1), _mm256_set_epi32(3,7,2,6,1,5,0,4)));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i di = _mm256_permutevar8x32_epi32(_mm256_unpackhi_epi32(lo0,lo1), _mm256_set_epi32(3,7,2,6,1,5,0,4));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i dq = _mm256_permutevar8x32_epi32(_mm256_unpacklo_epi32(hi0,hi1), _mm256_set_epi32(3,7,2,6,1,5,0,4));<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i R = _mm256_max_epi32(_mm256_add_epi32(_mm256_add_epi32(dy,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(di,_mm256_set1_epi32( -25002/CW ))),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(dq,_mm256_set1_epi32(&nbsp; 40674/CW ))), _mm256_setzero_si256());<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i G = _mm256_max_epi32(_mm256_add_epi32(_mm256_add_epi32(dy,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(di,_mm256_set1_epi32(&nbsp; &nbsp;1852/CW ))),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(dq,_mm256_set1_epi32( -16386/CW ))), _mm256_setzero_si256());<br />&nbsp; &nbsp; &nbsp; &nbsp; __m256i B = _mm256_max_epi32(_mm256_add_epi32(_mm256_add_epi32(dy,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(di,_mm256_set1_epi32(&nbsp; 48343/CW ))),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_mullo_epi32(dq,_mm256_set1_epi32(&nbsp; 23925/CW ))), _mm256_setzero_si256());<br />&nbsp; &nbsp; &nbsp; &nbsp; R =&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_mm256_min_epu32(_mm256_set1_epi32(0xFF), _mm256_srli_epi32(R, 16));<br />&nbsp; &nbsp; &nbsp; &nbsp; G = _mm256_slli_epi32(_mm256_min_epu32(_mm256_set1_epi32(0xFF), _mm256_srli_epi32(G, 16)), 8);<br />&nbsp; &nbsp; &nbsp; &nbsp; B = _mm256_and_si256(_mm256_min_epu32(B, _mm256_set1_epi32(0xFF0000)), _mm256_set1_epi32(0xFF0000));<br />&nbsp; &nbsp; &nbsp; &nbsp; _mm256_storeu_si256((__m256i*)(Target+s), _mm256_add_epi32(_mm256_add_epi32(R,G),B));<br />&nbsp; &nbsp; }<br />}</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5043"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=14338"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=14338"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 31 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=14338&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=14338&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=14338&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google Adsense [Bot]</span> and 3 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="14338" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
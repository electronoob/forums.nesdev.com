<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Schedulers (attn: AWJ)</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Schedulers (attn: AWJ)" href="http://forums.nesdev.com/feed.php?f=12&amp;t=14594" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=14594';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Jan 18, 2019 7:58 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />

	<div class="forumrules">
		
			<h3>Forum rules</h3><br />
			<ul><li>For making cartridges of your Super NES games, see <a href="http://forums.nesdev.com/viewforum.php?f=28" class="postlink">Reproduction</a>.</li></ul>
		
	</div>

	<br clear="all" />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=14594">Schedulers (attn: AWJ)</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=14594"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 30 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=14594&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=14594&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=14594&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=14594&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=14594&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176310"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176310">Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176310#p176310"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 12:59 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You mentioned that MAME uses a scheduler that's accurate to the attosecond, but for that you needed to use 128-bit numbers. May I ask why?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;1,000,000,000,000,000,000 =&gt; the number of attoseconds in one second<br />18,446,744,073,709,551,615 =&gt; 2^64-1</div><br /><br />As long as we subtract the smallest value from all counters every ~9 seconds, there's no chance of an overflow. Doing it once per frame on an emulated system should be far more than enough.<br /><br />If you're going to use 128-bit counters, then why not up your accuracy to Planck time? :P<br /><br />...<br /><br />For what it's worth, I am using this currently:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">auto create(... long double frequency) {<br />&nbsp; /*uint64*/ scalar = 1.0 / frequency * 1'000'000'000'000'000'000.0 + 0.5;&nbsp; //round to attoseconds<br />}<br />auto step(uint clocks) {<br />&nbsp; clock += clocks * scalar;<br />}<br />auto synchronize(Thread&amp; thread) {<br />&nbsp; if(clock &gt; thread.clock) co_switch(thread.handle);<br />}</div><br /><br />Seems to be working just fine for me. Here's my before and after results:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&#91;FC&#93;<br />Mega Man 2 = 169fps (stage select) -&gt; 186fps<br />Zelda = 172fps (in-game) -&gt; 193fps<br /><br />&#91;SFC&#93;<br />Zelda 3 = 131fps (save select) -&gt; 140fps<br />Kirby 3 = 99fps (stage select) -&gt; 106fps<br /><br />&#91;GB&#93;<br />Mega Man II = 228fps (stage select) -&gt; 246fps<br />Zelda DX = 211fps (save select) -&gt; 214fps<br /><br />&#91;GBA&#93;<br />Riviera = 180fps (opening) -&gt; 180fps<br />Minish Cap = 154fps (save select) -&gt; 154fps<br /><br />&#91;WSC&#93;<br />Riviera = 177fps (title screen) -&gt; 198fps<br />Final Fantasy = 158fps (name select) -&gt; 163fps</div><br /><br />Not bad for a few hours of work. It's a really great idea to use attoseconds instead of relative frequency counters.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=375">byuu</a> on Fri Jul 29, 2016 2:55 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176312"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176312">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176312#p176312"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 1:50 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">MAME never rebases the counters; it uses them to log the exact emulated time that events occur (e.g. inputs in a movie file) Also, the counters aren't simply 128-bit integers; they consist of a 64-bit attoseconds part and a 64-bit seconds part. Great for friendly logging, not so great for efficiency (attotime calculations are a significant source of overhead in MAME drivers with many CPUs and other devices that use the scheduler)<br /><br />Choosing a suitable base unit of time for an arbitrary set of clock domains is indeed the hard part. The problem MAME has is that many common crystal values have a repeating decimal when you take their reciprocal. Even using attoseconds, you end up with component A that's supposed to run at exactly 3 times the speed of component B, but gains an extra cycle once every 20 minutes due to truncation. I believe there are some demos that fail on MAME for this exact reason.<br /><br />If you want perfect accuracy you have to do something like this:<br /><br />Calculate the greatest common divisor of all the clock domains in the emulated system, and divide all the clocks by it (this step is only needed to reduce the likelihood of overflow in the next step)<br /><br />Calculate the scaled reciprocal of each clock. The scaled reciprocal is the product of all the clocks except that one (or alternatively, the product of all the clocks divided by that clock)<br /><br />Again calculate the greatest common divisor of all the clock reciprocals, and divide them all by it.<br /><br />The result is an exact-integer cycle length for each clock, in some arbitrary unit. If you care what that unit is for some reason, multiply the cycle length of any one of the devices by its frequency in Hz. The result is the number of &quot;some arbitrary units&quot; in a second.<br /><br />(Also, if you want to make sure you've done all the math right, assert that every device's calculated cycle length times its frequency is the same number)<br /><br />If you need to add a new clock domain at runtime... Sorry, you're fucked. Hope you don't need to support hot plugging devices with their own crystal in them.<br /><br />ETA: I said &quot;something like&quot; for a reason. I literally came up with the above algorithm at 5 a.m. right before falling asleep, and I'm sure someone can improve on my method or point out some awful flaw in it...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176317"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176317">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176317#p176317"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 3:08 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Posted timing results to the first post before I saw you replied. They're pretty interesting.<br /><br />&gt; MAME never rebases the counters; it uses them to log the exact emulated time that events occur<br /><br />Oh, I see. Well, someone out there is going to be <em>pissed</em> when they run MAME for 31.71 billion years and then suddenly the program deadlocks because not all of the counters wrapped. So much for MAME caring about accuracy /s<br /><br />&gt; Great for friendly logging, not so great for efficiency (attotime calculations are a significant source of overhead in MAME drivers with many CPUs and other devices that use the scheduler)<br /><br />Yeah, I can totally see that. Especially given the above timing results on my end.<br /><br />You could speed that up by using a __uint128 where available. And don't separate it to {top 64-bits = seconds; bottom 64-bits = attoseconds}; just divide by 1 quintillion when you need the number of seconds, and modulus by it when you need the fraction. For systems without 128-bit integers, simply add the clocks to the low 64-bit value, and if the new value is less than the old value, increment the upper 64-bit value by one. Or even better, do it with assembly instructions and use the processor carry; then add zero with carry to the upper 64-bits. Extracting time would be a bit more painful on systems without 128-bit types, but you could write a software divide for that. I'd imagine extracting timestamps is way less common than time passing during emulation.<br /><br />&gt; Even using attoseconds, you end up with component A that's supposed to run at exactly 3 times the speed of component B, but gains an extra cycle once every 20 minutes due to truncation. I believe there are some demos that fail on MAME for this exact reason.<br /><br />Well ... the way I'm doing it is: if there's a single oscillator, then I'll use that. The GBA, WS/C, MD all share this. In this case, my step() function just adds the clock cycle count to the clock counter and that's it.<br /><br />But if there is more than one oscillator, then I add clocks * reciprocal_attoseconds instead. In the case of the SNES, even in the worst case of an extra clock every 20 minutes ... nothing is going to break because of that. The real oscillators on real consoles vary by larger amounts than that due to aging, temperature changes, etc.<br /><br />My old system did handle this case perfectly, but being perfect beyond what's even possible for real hardware really isn't all that critical, and it didn't scale to the Genesis scenario anyway, so it had to go.<br /><br />&gt; Calculate the greatest common divisor of all the clock domains in the emulated system<br /><br />Completely impractical. The SNES can have 6+ oscillators thanks to controllers, cartridges and expansion port devices. And they're mostly repeating fractions thanks to color burst timings being psychotic values for both NTSC and PAL.<br /><br />&gt; If you need to add a new clock domain at runtime... Sorry, you're fucked. Hope you don't need to support hot plugging devices with their own crystal in them.<br /><br />Yep, there are several cases where I have to adjust the frequency dynamically. And this is another area where this attosecond-based approach works better than my old &quot;weighted scale&quot; approach: there's no longer any need to do any adjustments to the clock to represent the clock skew difference anymore. Just change the scalar and you're done.<br /><br />This comes up with: the SNES SGB's speed settings (with the Horii controller), the GBC toggling double-speed CPU mode, and hot-plugging controller and expansion port devices (the latter is, of course, psychotic to attempt.) I'm sure more cases will come up in the future, too.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176319"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176319">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176319#p176319"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 3:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I thought the GBC only changed its clock divider. Can't you emulate it the same way as the SuperFX, by adding 1 clock per instruction cycle in double speed mode and 2 clocks in single speed mode?<br /><br />Yeah, my suggested approach is complete overkill. You don't care about exact ratios between components on different clock domains, only ones that are on the same clock with different dividers.<br /><br />Here's take 2, which is similar to yours but eschews floating point math (which is a whole kettle of worms...)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">scaler = (HUGE_NUMBERull / frequency()) * divider();</div><br /><br />Where frequency() and divider() are virtual functions that return integers (not data members, so as not to bloat every object layout with data that's only used once at startup).Chips that run off of the same xtal should return the same frequency <br />as each other; this will ensure that their scalers are exact integer ratios. Chips that change dividers on the fly (like the GBC CPU) should report a divider of 1 and multiply their cycles themselves, at runtime. On the other hand chips with a fixed divider can take advantage of precalculating it (integer multiplication is not <em>that</em> expensive on modern CPUs, but why do unneeded extra work every emulated cycle? And weren't you hoping to make your emulator more ARM-friendly in the future?)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176321"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176321">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176321#p176321"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 6:49 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; Can't you emulate it the same way as the SuperFX, by adding 1 clock per instruction cycle in double speed mode and 2 clocks in single speed mode?<br /><br />I probably can. But that'd have to go on the to-do list. I don't want to keep getting side-tracked from the Genesis core while it's so young.<br /><br />&gt; Here's take 2, which is similar to yours but eschews floating point math (which is a whole kettle of worms...)<br /><br />scaler is a uint64 type. I just do the initial computation via long double. That math only happens once at power-up, so I'm not too worried about its performance. All my audio resampling / anti-aliasing is done in floating point, which is probably a whole lot worse. Especially at the obscene 2-3MHz sampling ratios of some of these systems.<br /><br />&gt; And weren't you hoping to make your emulator more ARM-friendly in the future?<br /><br />I certainly was before I killed the balanced and performance profiles.<br /><br />But amazingly, this change seems to have boosted framerates from 29fps (v100) to 45fps on my 1.4GHz Celeron box. I can't explain how this would be such a large speedup. Hopefully it lasts.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176322"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176322">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176322#p176322"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 8:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_online.gif" alt="Online" title="Online" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 21003<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">In <a href="http://forums.nesdev.com/viewtopic.php?p=176307#p176307" class="postlink">this post</a>, byuu wrote:</div><div class="quotecontent">[The assumption of one crystal is] trickier though with the SNES where there are multiple independent clock rates.</div><br />You can come close by running the audio unit at 1/7 of the master clock.<br /><br />APU ceramic resonator: 24576000 Hz<br />Divided by 8 to form audio master clock: 3072000 Hz<br /><br />Cost-reduced APU shares CPU/PPU crystal: 945/44 MHz = 21477272 Hz<br />Divided by 7 to form audio master clock: 3068181 Hz<br /><br />Would being 1 part in 804.6 off improve frame rates? And would it be within tolerance of the APU's ceramic resonator? If not, you could instead divide by 945/44/3.072 = 39375/5632 = 6.9913, and everything would still be within a clock domain.<br /><br /><br /><span style="font-size: 85%; line-height: normal">Based on the consensus resulting from <a href="http://forums.nesdev.com/viewtopic.php?f=13&amp;t=14304" class="postlink">a discussion two months ago about overuse of moderator powers</a>, I have chosen to move this post from <a href="http://forums.nesdev.com/viewtopic.php?p=176307#p176307" class="postlink">a previous derailed topic</a> through cut and paste, as if I were not a moderator, rather than using my moderator powers. I apologize for this bump.</span></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176323"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176323">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176323#p176323"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 9:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">scaler is a uint64 type. I just do the initial computation via long double. That math only happens once at power-up, so I'm not too worried about its performance. All my audio resampling / anti-aliasing is done in floating point, which is probably a whole lot worse. Especially at the obscene 2-3MHz sampling ratios of some of these systems.</div><br /><br />Again, it's precision I'm worried about, not performance. After all the work you've done on accuracy you don't want to start letting the S-PPU gain a cycle on the S-CPU every 20 minutes.<br /><br />Here's another problem I've just spotted:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">auto synchronize(Thread&amp; thread) {<br />&nbsp; if(clock &gt; thread.clock) co_switch(thread.handle);<br />}</div><br /><br />Before, you had one side testing for clock &lt; 0 and the other side testing for clock &gt;= 0: exact opposite conditions. Now you've got both sides testing for inequality. This introduces a wobble between two devices running at the same frequency: sometimes device A will run 1 cycle ahead of device B and sometimes device B will run 1 cycle ahead of device A, depending on which is currently executing when their clocks become equal.<br /><br />Unfortunately I suspect that this wobble is responsible for a significant amount of the performance gain you're seeing. Devices that should be running in perfect lockstep (e.g. the SMP and the DSP) are now leapfrogging each other, each running 2 cycles at a time.<br /><br />The solution is to initialize each device's clock with a unique bias, so that two devices' clocks never become exactly equal. If you initialize the SMP's clock to 0 and the DSP's to 1, the SMP will always lead the DSP instead of leapfrogging, or vice-versa (I'd look at which way the relationships went before and choose biases that preserve the same priority)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176339"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176339">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176339#p176339"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 12:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; Again, it's precision I'm worried about, not performance. After all the work you've done on accuracy you don't want to start letting the S-PPU gain a cycle on the S-CPU every 20 minutes.<br /><br />Will that happen when the two chips are running at the same frequency? They would both exhibit rounding errors at the same time.<br /><br />But, I don't see a solution, short of moving to Planck time units or something.<br /><br />&gt; Unfortunately I suspect that this wobble is responsible for a significant amount of the performance gain you're seeing.<br /><br />... damn. It was such a nice performance boost, too.<br /><br />What about &quot;if(clock &gt;= thread.clock) co_switch(thread.handle);&quot; instead? This test will never be called until a thread adds to the clock value, obviously, so there's not going to be some pathological non-stop switching event going on. It's starting to get sloppy, introducing virtual offset values into each clock.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176340"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176340">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176340#p176340"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 12:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">&gt; Again, it's precision I'm worried about, not performance. After all the work you've done on accuracy you don't want to start letting the S-PPU gain a cycle on the S-CPU every 20 minutes.<br /><br />Will that happen when the two chips are running at the same frequency? They would both exhibit rounding errors at the same time.</div><br /><br />No, it's not a problem if both of the chips are created with exactly the same frequency. Just make sure that clock dividers are applied via integer multiplication (either at creation time or at runtime), not via division nor any floating-point operation. Example:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">auto create(... long double frequency, uint divider) {<br />&nbsp; /*uint64*/ scalar = 1.0 / frequency * 1'000'000'000'000'000'000.0 + 0.5;&nbsp; //round to attoseconds<br />&nbsp; scalar *= divider;<br />}</div><br /><br />Don't divide <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">frequency</tt> by <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">divider</tt>, and don't multiply <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">scalar</tt> by <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">divider</tt> until after <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">scalar</tt> has been cast to an integer.<br /><br />For the MD, you'd create all the chips with the master oscillator as <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">frequency</tt> and their respective dividers as <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">divider</tt> (only for chips where it doesn't change at runtime, i.e. not the VDP).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">&gt; Unfortunately I suspect that this wobble is responsible for a significant amount of the performance gain you're seeing.<br /><br />... damn. It was such a nice performance boost, too.<br /><br />What about &quot;if(clock &gt;= thread.clock) co_switch(thread.handle);&quot; instead? This test will never be called until a thread adds to the clock value, obviously, so there's not going to be some pathological non-stop switching event going on. It's starting to get sloppy, introducing virtual offset values into each clock.</div><br /><br />That's going to have exactly the same problem, except that the non-currently-executing device will win when the clocks become tied. You're still going to have the two devices leapfrogging each other. The bias values aren't arbitrary or &quot;sloppy&quot;; they indicate exactly what order you want lockstep devices to execute in (and in a much more clear way than the difference between &gt;= and &gt; does) The device that you want to execute first gets a bias of 0, the one you want to execute second gets a bias of 1, etc.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176342"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176342">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176342#p176342"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 1:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; That's going to have exactly the same problem, except that the non-currently-executing device will win when the clocks become tied.<br /><br />But how is that ever going to be a problem in practice? The chip that runs first will be the one that gets entered first after a reset.<br /><br />SMP = 0; DSP = 0<br />CPU runs first; synchronizes to SMP; so SMP is always first<br />SMP step 1; sync if 1 &gt;= 0; switch to DSP<br />DSP step 1; sync if 1 &gt;= 1; switch to SMP<br />SMP step 1; sync if 2 &gt;= 1; switch to DSP<br />DSP step 1; sync if 2 &gt;= 2; switch to SMP<br />The only way things would get nasty is if we did the sync if test before the step (would cause wobbling), or possibly a sync call without any step (infinite loop if both sides did it.) But I never do that anywhere in my code. It's always &quot;step(n); sync();&quot; everywhere.<br /><br />&gt; The bias values aren't arbitrary or &quot;sloppy&quot;<br /><br />Well, I have one decent idea for them, at least. In Thread::create, I have this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">handle = co_create(entrypoint, stacksize);<br />scheduler.append(*this);</div><br /><br />So inside scheduler.append, I can do:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">thread.clock += scheduler.threads.size();</div><br />So that CPU=1, SMP=2, PPU=3, DSP=4, &lt;coprocessors=5-30&gt;, &lt;peripherals=31-33 ... will get a bit screwy with hot-swapping but will be bounded by threads.size() so they won't go off the rails.&gt;<br /><br />I definitely don't want to build a giant enum that lists the &quot;priority&quot; of every possible Thread source. There's so damned many in the SNES.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176343"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176343">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176343#p176343"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 1:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">&gt; That's going to have exactly the same problem, except that the non-currently-executing device will win when the clocks become tied.<br /><br />But how is that ever going to be a problem in practice? The chip that runs first will be the one that gets entered first after a reset.<br /><br />SMP = 0; DSP = 0<br />CPU runs first; synchronizes to SMP; so SMP is always first<br />SMP step 1; sync if 1 &gt;= 0; switch to DSP<br />DSP step 1; sync if 1 &gt;= 1; switch to SMP<br />SMP step 1; sync if 2 &gt;= 1; switch to DSP<br />DSP step 1; sync if 2 &gt;= 2; switch to SMP<br />The only way things would get nasty is if we did the sync if test before the step (would cause wobbling), or possibly a sync call without any step (infinite loop if both sides did it.) But I never do that anywhere in my code. It's always &quot;step(n); sync();&quot; everywhere.</div><br /><br />That's fine for the SMP and DSP, but what about devices that have different dividers and/or that don't always sync after every cycle, like the CPU and PPU? Every time one leapfrogs the other due to adding more cycles than the other's divider or due to not syncing for a bit, their priority will flip until the next time they happen to leapfrog. With the CPU/PPU, you'll have the h/v counters sporadically becoming off by one for a while.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">&gt; The bias values aren't arbitrary or &quot;sloppy&quot;<br /><br />Well, I have one decent idea for them, at least. In Thread::create, I have this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">handle = co_create(entrypoint, stacksize);<br />scheduler.append(*this);</div><br /><br />So inside scheduler.append, I can do:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">thread.clock += scheduler.threads.size();</div><br />So that CPU=1, SMP=2, PPU=3, DSP=4, &lt;coprocessors=5-30&gt;, &lt;peripherals=31-33 ... will get a bit screwy with hot-swapping but will be bounded by threads.size() so they won't go off the rails.&gt;</div><br /><br />How are you ending up with 25 coprocessors on the SNES? Are you creating a thread for every possible coprocessor, and not just the one in the currently-loaded cartridge?<br /><br />You don't actually need a unique bias for every chip on the SNES, because you never have coprocessors syncing to the PPU etc. You can just use 0 for the CPU and SMP and 1 for everything else. The only chips that need biases to prevent leapfrogging are those that both (1) run off of the same clock (possibly with dividers) <em>and</em> (2) directly sync to each other.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176344"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176344">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176344#p176344"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 1:42 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; but what about devices that have different dividers and/or that don't always sync after every cycle, like the CPU and PPU?<br /><br />The CPU and PPU have the same exact scalar value 1/21MHz*Attosecond. I don't see why it matters how many clocks pass before syncing to another, as long as the value is greater than zero.<br /><br />I'm likely going to need an actual demonstrable simulation showing a problem. I'll toy around with a tiny mock-up on my end to look for problems.<br /><br />&gt; How are you ending up with 25 coprocessors on the SNES?<br /><br />Theoretical worst case with the manifest from hell :P<br /><br />&gt; You don't actually need a unique bias for every chip on the SNES<br /><br />The goal, if I decide to use a bias, is to do it in one place rather than in ten places or more.<br /><br />Does MAME actually have this bias system in place? Being honest, I wish I had known about this before I started on this redesign. But, I'd still have to solve the MD sync issue, so ... maybe I'd still have chosen this anyway.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176345"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176345">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176345#p176345"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 3:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">&gt; but what about devices that have different dividers and/or that don't always sync after every cycle, like the CPU and PPU?<br /><br />The CPU and PPU have the same exact scalar value 1/21MHz*Attosecond. I don't see why it matters how many clocks pass before syncing to another, as long as the value is greater than zero.<br /><br />I'm likely going to need an actual demonstrable simulation showing a problem. I'll toy around with a tiny mock-up on my end to look for problems.</div><br /><br />Okay, imagine you have two devices that normally both step 1 clock at a time but sometimes step 2 clocks at a time (because of memory wait states or whatever):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">dev1 step 1 (total 1); sync if 1 &gt;= 0; switch to dev2<br />dev2 step 1 (total 1); sync if 1 &gt;= 1; switch to dev1<br />dev1 step 1 (total 2); sync if 2 &gt;= 1; switch to dev2<br />dev2 step 1 (total 2); sync if 2 &gt;= 2; switch to dev1<br />; so far everything is okay... let's see what happens when dev2 steps 2 clocks at a time<br />dev1 step 1 (total 3); sync if 3 &gt;= 2; switch to dev2<br />dev2 step 2 (total 4); sync if 4 &gt;= 3; switch to dev1<br />dev1 step 1 (total 4); sync if 4 &gt;= 4; switch to dev2<br />dev2 step 1 (total 5); sync if 5 &gt;= 4; switch to dev1<br />dev1 step 1 (total 5); sync if 5 &gt;= 5; switch to dev2<br />; this isn't good... dev2 is now running ahead of dev1 instead of behind it<br />; dev1 should've gotten an extra cycle when dev2 took 2 at a time, but didn't<br />dev2 step 2 (total 7); sync if 7 &gt;= 5; switch to dev1<br />dev1 step 1 (total 6); sync if 6 &gt;= 7; no switch<br />dev1 step 1 (total 7); sync if 7 &gt;= 7; switch to dev2<br />dev2 step 1 (total 8); sync if 8 &gt;= 7; switch to dev1<br />dev1 step 1 (total 8); sync if 8 &gt;= 8; switch to dev2<br />; well, at least they can't get more than 1 cycle out of step. what happens when dev1 takes 2 cycles?<br />dev2 step 1 (total 9); sync if 9 &gt;= 8; switch to dev1<br />dev1 step 2 (total 10); sync if 10 &gt;= 9; switch to dev2<br />dev2 step 1 (total 10); sync if 10 &gt;= 10; switch to dev1<br />dev1 step 1 (total 11); sync if 11 &gt;= 10; switch to dev2<br />dev2 step 1 (total 11); sync if 11 &gt;= 11; switch to dev1<br />; and now dev1 is running ahead of dev2 again<br /></div><br /><br />Each time the trailing device gets <em>ahead</em> of the leading device rather than merely catching up to it, their order of execution swaps. You might object that the SNES doesn't have any pair of devices with those exact clock characteristics, but the point is that the order of execution is fundamentally unstable, and your core shared emulation functionality shouldn't rely on accidental characteristics of the emulated hardware to avoid the consequences of its bugs.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Does MAME actually have this bias system in place? Being honest, I wish I had known about this before I started on this redesign. But, I'd still have to solve the MD sync issue, so ... maybe I'd still have chosen this anyway.</div><br /><br />MAME uses a very different type of scheduler; the only thing it's got in common with your new scheduler is how the time bases are handled. The MAME scheduler runs CPUs (and other &quot;executable&quot; devices) in a round-robin sequence in the order they were declared in. A CPU in MAME can't yield to another specific CPU; it can only give up its timeslice, causing the scheduler to pass it to the next CPU in the sequence. MAME can't handle things like context switching in the middle of a read handler to let the device being read from catch up. To achieve bsnes-level accuracy in MAME, you have to run at &quot;perfect interleave&quot;, meaning the round robin timeslices are equal to the frequency of the fastest chip in the emulated machine. The 8-bit Commodore drivers do this, and the C64 and C128 barely run at full speed on a top-end PC (and for other reasons those drivers still aren't as accurate as dedicated emulators)<br /><br />Basically, MAME is amazing for being able to emulate everything from 1970s 6502 boards to Pentium-class PCs using a single infrastructure, but it's not something you should try to imitate in all its particulars in a project of much more limited scope like higan.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p176348"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176348">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176348#p176348"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 4:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1398
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Testing reveals some nasty results. You'll need the latest nall/libco from Gitlab to use this:<br /><br /><!-- m --><a class="postlink" href="http://hastebin.com/raw/ukoyikabez">http://hastebin.com/raw/ukoyikabez</a><!-- m --><br /><br />But this is a test framework for the old and new synchronization methods.<br /><br />When I run the CPU and SMP at their specification rates, and step the CPU by 4, the SMP by 5; the attosecond-based method desyncs at 15,151 context switches. That number is horrifyingly low, and completely unacceptable.<br /><br />I wasn't gaining any precision beyond femtoseconds, so I moved from long double reciprocal division to pre-scaled integer division and scaling with 128-bit types. Even yoctoseconds isn't enough, I had to go 1000x more precise than that. Since I had the headroom, I went ahead and increased this to 100000x the precision of a yoctosecond. Can't fit planck time * 32-bit frequency into a 128-bit integer, so ... boo.<br /><br />Still, this is really shitty. I trusted the &quot;one clock desync every 20 minutes&quot; thing, but it's not even close to that in practice with attoseconds.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p176352"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p176352">Re: Schedulers (attn: AWJ)</a></div><div style="float: right;"><a href="./viewtopic.php?p=176352#p176352"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jul 29, 2016 4:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The bias thing only helps when the two clocks are dividers of the same base frequency (which is also the only time that level of perfection should matter). When you have two completely unrelated frequencies, there's nothing you can do to stop the streams from crossing eventually. Except for keeping a separate &quot;priority&quot; field and testing &quot;if((clock &gt; other.clock) || (clock == other.clock &amp;&amp; priority &lt; other.priority))<br /><br />Does one of the threads actually permanently gain a cycle on the other, or do they just execute one cycle out of order and then fall back into synchronization? It's one thing if one of the chips is actually running 0.01% too fast (although I don't see how that large an error is remotely possible) but I don't think it's a big deal if one chip executes a cycle early or late every now and then compared to the previous method (relative to a chip on a different oscillator, I mean).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=14594"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=14594"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 30 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=14594&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=14594&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google [Bot]</span> and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="14594" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
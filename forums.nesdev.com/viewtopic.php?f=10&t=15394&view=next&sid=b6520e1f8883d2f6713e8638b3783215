<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Problems Loading a NameTable to show Game Over Screen</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="https://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="https://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="https://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="https://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Newbie Help Center" href="https://forums.nesdev.com/feed.php?f=10" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Problems Loading a NameTable to show Game Over Screen" href="https://forums.nesdev.com/feed.php?f=10&amp;t=15394" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en&amp;sid=f4a86de245904096cb854f974fda7403" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php?sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php?sid=f4a86de245904096cb854f974fda7403"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=f4a86de245904096cb854f974fda7403"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun Oct 01, 2017 5:24 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=f4a86de245904096cb854f974fda7403">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=f4a86de245904096cb854f974fda7403">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=f4a86de245904096cb854f974fda7403">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=f4a86de245904096cb854f974fda7403">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10&amp;sid=f4a86de245904096cb854f974fda7403">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403">Problems Loading a NameTable to show Game Over Screen</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320&amp;sid=f4a86de245904096cb854f974fda7403">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 22 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=10&amp;t=15391&amp;view=previous&amp;sid=f4a86de245904096cb854f974fda7403">Previous topic</a> | <a href="./viewtopic.php?f=10&amp;t=15391&amp;view=next&amp;sid=f4a86de245904096cb854f974fda7403">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186859"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186859">Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186859&amp;sid=f4a86de245904096cb854f974fda7403#p186859"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 3:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hi All,<br /><br />So in my pong game, I'm trying to learn how to transition from one background screen to another. I'm able to load a title screen, and switch from the title screen to my playfield screen without issues. The code I use to do that is here.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDA #%00000000 ;Turn Screen Off<br />&nbsp; STA $2001<br /><br />LoadPlayScreen:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; load playfield screen<br />&nbsp; LDA $2002&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; read PPU status to reset the high/low latch<br />&nbsp; LDA #$20<br />&nbsp; STA $2006&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; write the high byte of $2000 address<br />&nbsp; LDA #$00<br />&nbsp; STA $2006&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; write the low byte of $2000 address<br /><br />&nbsp; LDA #$00<br />&nbsp; STA pointerLo&nbsp; &nbsp; &nbsp; &nbsp;; put the low byte of the address of background into pointer<br />&nbsp; LDA #HIGH(playfield)<br />&nbsp; STA pointerHi&nbsp; &nbsp; &nbsp; &nbsp;; put the high byte of the address into pointer<br /><br />&nbsp; LDX #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; start at pointer + 0<br />&nbsp; LDY #$00<br />PlayFieldOutsideLoop:<br /><br />PlayFieldInsideLoop:<br />&nbsp; LDA &#91;pointerLo&#93;, y&nbsp; ; copy one background byte from address in pointer plus Y<br />&nbsp; STA $2007&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; this runs 256 * 4 times<br /><br />&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; inside loop counter<br />&nbsp; CPY #$00<br />&nbsp; BNE PlayFieldInsideLoop&nbsp; &nbsp; &nbsp; ; run the inside loop 256 times before continuing down<br /><br />&nbsp; INC pointerHi&nbsp; &nbsp; &nbsp; &nbsp;; low byte went 0 to 256, so high byte needs to be changed now<br /><br />&nbsp; INX<br />&nbsp; CPX #$04<br />&nbsp; BNE PlayFieldOutsideLoop&nbsp; &nbsp; &nbsp;; run the outside loop 256 times before continuing down</div> <br /><br /><br /><br />But when I use basically the same code to switch from playfield screen to the gameover screen (after a winning score has been achieved) the code doesn't function properly. The screen goes blank and stays blank. Now I expect it to go blank because I turn the screen off to allow time to draw the background, <br />But the screen doesn't come back on. My NMI handler should turn it back on because it has a &quot;clean up&quot; piece of code that re-enables everything. <br /><br />Here is the code I use to draw the game over screen. Again basically the same code I use to draw the playfield after I switch from title. Allthough the screen stays blank, if I check FCEUX's Nametable viewer, it shows that screen has indeed drawn<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">LDA #%00000000 ;Turn Screen Off<br />&nbsp; STA $2001<br /><br />LoadGameOverScreen:&nbsp; &nbsp; &nbsp;;Load Game Over Screen<br />&nbsp; LDA $2002&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; read PPU status to reset the high/low latch<br />&nbsp; LDA #$20<br />&nbsp; STA $2006&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; write the high byte of $2000 address<br />&nbsp; LDA #$00<br />&nbsp; STA $2006&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; write the low byte of $2000 address<br /><br />&nbsp; LDA #$00<br />&nbsp; STA pointerLo&nbsp; &nbsp; &nbsp; &nbsp;; put the low byte of the address of background into pointer<br />&nbsp; LDA #HIGH(gameover)<br />&nbsp; STA pointerHi&nbsp; &nbsp; &nbsp; &nbsp;; put the high byte of the address into pointer<br /><br />&nbsp; LDX #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; start at pointer + 0<br />&nbsp; LDY #$00<br />GameOverOutsideLoop:<br />&nbsp; <br />GameOverInsideLoop:<br />&nbsp; LDA &#91;pointerLo&#93;, y&nbsp; ; copy one background byte from address in pointer plus Y<br />&nbsp; STA $2007&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; this runs 256 * 4 times<br />&nbsp; <br />&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; inside loop counter<br />&nbsp; CPY #$00<br />&nbsp; BNE GameOverInsideLoop&nbsp; &nbsp; &nbsp; ; run the inside loop 256 times before continuing down<br /><br />&nbsp; INC pointerHi&nbsp; &nbsp; &nbsp; &nbsp;; low byte went 0 to 256, so high byte needs to be changed now<br />&nbsp; <br />&nbsp; INX<br />&nbsp; CPX #$04<br />&nbsp; BNE GameOverOutsideLoop&nbsp; &nbsp; &nbsp;; run the outside loop 256 times before continuing down</div><br /><br />And here is my NMI code<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">NMI:<br />&nbsp; PHA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; back up registers (important)<br />&nbsp; TXA<br />&nbsp; PHA<br />&nbsp; TYA<br />&nbsp; PHA<br /><br />&nbsp; LDA #$00<br />&nbsp; STA $2003&nbsp; &nbsp; &nbsp; &nbsp;; set the low byte (00) of the RAM address<br />&nbsp; LDA #$02<br />&nbsp; STA $4014&nbsp; &nbsp; &nbsp; &nbsp;; set the high byte (02) of the RAM address, start the transfer<br /><br />Score:<br />&nbsp; LDA gamestate<br />&nbsp; CMP #STATETITLE<br />&nbsp; BEQ CleanUp<br />&nbsp; JSR DrawScore<br /><br />CleanUp:<br />&nbsp; LDA #%10010000&nbsp; &nbsp;; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1&nbsp; -&nbsp; ;;PPU clean up section, so rendering the next frame starts properly.<br />&nbsp; STA $2000<br />&nbsp; LDA #%00011110&nbsp; &nbsp;; enable sprites, enable background, no clipping on left side<br />&nbsp; STA $2001<br />&nbsp; LDA #$00&nbsp; &nbsp; &nbsp; &nbsp; ;;tell the ppu there is no background scrolling<br />&nbsp; STA $2005<br />&nbsp; STA $2005&nbsp; &nbsp; &nbsp; &nbsp;;;;all graphics updates done by here, run game engine<br /><br />&nbsp; JSR ReadController1&nbsp; ;;get the current button data for player 1<br />&nbsp; JSR ReadController2&nbsp; ;;get the current button data for player 2<br /><br />GameEngine:<br /><br />StateTitle:<br />&nbsp; LDA gamestate<br />&nbsp; CMP #STATETITLE<br />&nbsp; BNE StateGameOver&nbsp; &nbsp; ;;game is displaying title screen<br />&nbsp; JMP EngineTitle<br /><br />StateGameOver:<br />&nbsp; LDA gamestate<br />&nbsp; CMP #STATEGAMEOVER<br />&nbsp; BNE StatePlaying&nbsp; ;;game is displaying ending screen<br />&nbsp; JMP EngineGameOver<br /><br />StatePlaying:<br />&nbsp; LDA gamestate<br />&nbsp; CMP #STATEPLAYING<br />&nbsp; BNE GameEngineDone<br />&nbsp; JMP EnginePlaying&nbsp; &nbsp;;;game is playing<br />GameEngineDone:<br /><br />&nbsp; JSR UpdateSprites&nbsp; ;;set ball/paddle sprites from positions<br /><br />&nbsp; PLA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; restore regs and exit<br />&nbsp; TAY<br />&nbsp; PLA<br />&nbsp; TAX<br />&nbsp; PLA<br />&nbsp; RTI</div><br /><br />Any thoughts on this would be greatly appreciated here. I'm really banging my head on this. Seeing as how switching screens is pretty important I really want to understand the concept well. Also, I have attached the full code of my PONG game to this post as well if anyone would like to see it to help me determine my problem. There is also a screen shot in there of the nametable viewer in FCEUX showing the GameOver screen.<br /><br />Thank You So Much<br /><br />Hundo</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=7600&amp;sid=f4a86de245904096cb854f974fda7403">PongCodeRev111617Hundo.zip</a> [225.43 KiB]
			</span><br />
			<span class="gensmall">Downloaded 24 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186861"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186861">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186861&amp;sid=f4a86de245904096cb854f974fda7403#p186861"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 4:00 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10020<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Have you used FCEUX's debugger to trace the code? If something isn't behaving as expected, the best thing to do is set a breakpoint and step through the code to see what's actually happening.<br /><br />I normally set breakpoints on writes to $ff (a memory position that's hardly ever used in my programs), so I can just put an <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta $ff</tt> right before the thing I want to debug.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186862"></a>
				<b class="postauthor">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186862">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186862&amp;sid=f4a86de245904096cb854f974fda7403#p186862"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 4:01 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 3192<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Gut feeling says this is being caused by $2000/2002/2005/2006 manipulation in such an order that certain internal VRAM addresses are pointing to a location different than you expect, especially if you're seeing the screen in FCEUX's nametable viewer but it isn't visibly rendering on-screen.  This is a very common problem for homebrewers and complex to understand, which is why it's one of the largest pages on the wiki (do not let the name of the wiki page make you think it specifically has to do with &quot;screen panning&quot; -- it's more complicated than that).  I'm sorry to say you'll need to read it (not skim it), although someone on the forum may be a able to write a more terse version for you: <!-- m --><a class="postlink" href="https://wiki.nesdev.com/w/index.php/PPU_scrolling">https://wiki.nesdev.com/w/index.php/PPU_scrolling</a><!-- m --><br /><br />Edit: add $2000 too.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3&amp;sid=f4a86de245904096cb854f974fda7403">koitsu</a> on Mon Jan 16, 2017 4:20 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186863"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186863">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186863&amp;sid=f4a86de245904096cb854f974fda7403#p186863"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 4:14 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Have you used FCEUX's debugger to trace the code? If something isn't behaving as expected, the best thing to do is set a breakpoint and step through the code to see what's actually happening.<br /><br />I normally set breakpoints on writes to $ff (a memory position that's hardly ever used in my programs), so I can just put an <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta $ff</tt> right before the thing I want to debug.</div><br /><br />I do use the debuger, however I've never thought to use $ff to set a marker to make the debugger easier to use. Thank You! That is a super helpful tip. <br />I stepped through the code with the debugger and it looks to be behaving as it should be. So I'm still confused.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186864"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186864">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186864&amp;sid=f4a86de245904096cb854f974fda7403#p186864"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 4:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10020<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think I found the problem. You have 3 states, but they don't behave the same way. The title screen state works because it waits for the time to change the background, and when it does change the background it switches to the gameplay state, meaning the background is drawn only once. But the game over state is different, it immediately draws a new background, and doesn't change states. Since your NMI handler calls the current state every frame, the game over state is redrawing the background over and over again. The NMI tries to enable rendering, but when this state is called it turns rendering off again and draws the background again... that's why the screen is blank.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186868"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186868">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186868&amp;sid=f4a86de245904096cb854f974fda7403#p186868"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 4:39 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10020<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You should try to format all game states in a similar way, because currently they're kinda all over the place and don't follow a set pattern. The title screen is drawn during reset, and its handler draws the gameplay background. The gameplay handler has the game logic but doesn't draw any backgrounds, and the game over handler only draws its background over and over.<br /><br />I suggest you have a reset routine for each state, that draws its background sets the necessary variables, and then sets the variable that indicates the active state. Another important thing to do is disable NMIs (or have them don't do anything, which's better) during state transitions, otherwise the NMI handler might interrupt the transitions and screw everything up.<br /><br />the different states could follow a standard like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ResetTitle:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'TITLE'<br />UpdateTitle:<br />&nbsp; &nbsp;;wait for start to jump to ResetGameplay<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameplay:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEPLAY'<br />UpdateGameplay:<br />&nbsp; &nbsp;;run game logic<br />&nbsp; &nbsp;;jump to ResetGameOver on death<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameOver:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEOVER'<br />UpdateGameOver:<br />&nbsp; &nbsp;;wait for timer to expire before jumping to ResetTitle<br />&nbsp; &nbsp;jsr GameEngineDone</div><br />To prevent the NMI from doing anything that could ruin the loading process of the states, you could maybe have a 'TRANSITIONING' state, that when active cause the NMI handler to not do a sprite DMA or touch any PPU registers. Playing audio is OK.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186878"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186878">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186878&amp;sid=f4a86de245904096cb854f974fda7403#p186878"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 5:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">I think I found the problem. You have 3 states, but they don't behave the same way. The title screen state works because it waits for the time to change the background, and when it does change the background it switches to the gameplay state, meaning the background is drawn only once. But the game over state is different, it immediately draws a new background, and doesn't change states. Since your NMI handler calls the current state every frame, the game over state is redrawing the background over and over again. The NMI tries to enable rendering, but when this state is called it turns rendering off again and draws the background again... that's why the screen is blank.</div><br /><br />Thank you Tokumaru! That was the problem. Not sure why I missed it. I think my brain fried out a bit after staring at the code for 2 hours. With your suggestion I fixed the problem very quickly!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186880"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186880">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186880&amp;sid=f4a86de245904096cb854f974fda7403#p186880"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 6:00 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">You should try to format all game states in a similar way, because currently they're kinda all over the place and don't follow a set pattern. The title screen is drawn during reset, and its handler draws the gameplay background. The gameplay handler has the game logic but doesn't draw any backgrounds, and the game over handler only draws its background over and over.<br /><br />I suggest you have a reset routine for each state, that draws its background sets the necessary variables, and then sets the variable that indicates the active state. Another important thing to do is disable NMIs (or have them don't do anything, which's better) during state transitions, otherwise the NMI handler might interrupt the transitions and screw everything up.<br /><br />the different states could follow a standard like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ResetTitle:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'TITLE'<br />UpdateTitle:<br />&nbsp; &nbsp;;wait for start to jump to ResetGameplay<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameplay:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEPLAY'<br />UpdateGameplay:<br />&nbsp; &nbsp;;run game logic<br />&nbsp; &nbsp;;jump to ResetGameOver on death<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameOver:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEOVER'<br />UpdateGameOver:<br />&nbsp; &nbsp;;wait for timer to expire before jumping to ResetTitle<br />&nbsp; &nbsp;jsr GameEngineDone</div><br />To prevent the NMI from doing anything that could ruin the loading process of the states, you could maybe have a 'TRANSITIONING' state, that when active cause the NMI handler to not do a sprite DMA or touch any PPU registers. Playing audio is OK.</div><br /><br />I am totally going to rewrite my code for this little pong game. As the general pieces of it started to come together I realized it was something of a hacked together mess. I was also right on the verge of having it work, so I figured I may as well press on despite it being a shit show. Now that its done and all the major pieces are working I'm going to re-write it following the guidelines you have suggested. I'm sure it will be a good learning exercise. Also after browsing through the literature here, I've come to the conclusion that handling the logic in the NMI as the original tutuorial suggests is a bad thing, so I'm going to try to change that as well. I'll do my best, but I'm sure you guys will be hearing from me : ) Thanks again for the help!<br /><br />Hundo</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186881"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186881">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186881&amp;sid=f4a86de245904096cb854f974fda7403#p186881"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 16, 2017 6:03 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">Gut feeling says this is being caused by $2000/2002/2005/2006 manipulation in such an order that certain internal VRAM addresses are pointing to a location different than you expect, especially if you're seeing the screen in FCEUX's nametable viewer but it isn't visibly rendering on-screen.  This is a very common problem for homebrewers and complex to understand, which is why it's one of the largest pages on the wiki (do not let the name of the wiki page make you think it specifically has to do with &quot;screen panning&quot; -- it's more complicated than that).  I'm sorry to say you'll need to read it (not skim it), although someone on the forum may be a able to write a more terse version for you: <!-- m --><a class="postlink" href="https://wiki.nesdev.com/w/index.php/PPU_scrolling">https://wiki.nesdev.com/w/index.php/PPU_scrolling</a><!-- m --><br /><br />Edit: add $2000 too.</div><br /><br />Thank you Koitsu for the suggestion. I will be sure to read it. Currently in school trying to become a Doctor, so I'll fit this paper in between Neuroanatomy and Biochemistry. Lol this classic NES stuff is WAY to interesting and addicting ; )</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186911"></a>
				<b class="postauthor">Pokun</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186911">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186911&amp;sid=f4a86de245904096cb854f974fda7403#p186911"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jan 17, 2017 8:13 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue May 28, 2013 5:49 am<br /><b>Posts:</b> 761<br /><b>Location:</b> Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">hundonostudy wrote:</div><div class="quotecontent">after browsing through the literature here, I've come to the conclusion that handling the logic in the NMI as the original tutuorial suggests is a bad thing, so I'm going to try to change that as well.<br /><br />Hundo</div><br />The All in NMI way is a valid approach that some comercial games use (like Super Mario Bros). But I think that keeping logic in the Reset handler and graphic updates in the NMI is a clean way to separate the two.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6013&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186913"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186913">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186913&amp;sid=f4a86de245904096cb854f974fda7403#p186913"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jan 17, 2017 8:40 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10020<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Pokun wrote:</div><div class="quotecontent">The All in NMI way is a valid approach that some comercial games use (like Super Mario Bros).</div><br />Not without some undesirable side effects, such as music slowdown and raster effect glitches on lag frames. I heard that in some cases the game can even crash (due to a missed sprite 0 hit, I'm assuming).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">But I think that keeping logic in the Reset handler and graphic updates in the NMI is a clean way to separate the two.</div><br />It's the most robust setup when it comes to handling lag frames, because you get to prioritize some tasks that must run at 60Hz even in case of slowdown, while with the other methods (all in NMI or all in Reset) everything slows down (&quot;slowing down&quot; being an euphemism when it comes to raster effects, since when slowed down they can cause severe visual glitches).<br /><br />I'd only recommend the &quot;all in X&quot; methods for games that are guaranteed to never slow down, which is normally only the case of single screen or screen by screen games with a controlled number of active objects. Anything more dynamic than that is bound to run into lag frames every once in a while.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186961"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186961">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186961&amp;sid=f4a86de245904096cb854f974fda7403#p186961"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jan 17, 2017 6:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">You should try to format all game states in a similar way, because currently they're kinda all over the place and don't follow a set pattern. The title screen is drawn during reset, and its handler draws the gameplay background. The gameplay handler has the game logic but doesn't draw any backgrounds, and the game over handler only draws its background over and over.<br /><br />I suggest you have a reset routine for each state, that draws its background sets the necessary variables, and then sets the variable that indicates the active state. Another important thing to do is disable NMIs (or have them don't do anything, which's better) during state transitions, otherwise the NMI handler might interrupt the transitions and screw everything up.<br /><br />the different states could follow a standard like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ResetTitle:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'TITLE'<br />UpdateTitle:<br />&nbsp; &nbsp;;wait for start to jump to ResetGameplay<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameplay:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEPLAY'<br />UpdateGameplay:<br />&nbsp; &nbsp;;run game logic<br />&nbsp; &nbsp;;jump to ResetGameOver on death<br />&nbsp; &nbsp;jsr GameEngineDone<br /><br />ResetGameOver:<br />&nbsp; &nbsp;;draw background<br />&nbsp; &nbsp;;set state to 'GAMEOVER'<br />UpdateGameOver:<br />&nbsp; &nbsp;;wait for timer to expire before jumping to ResetTitle<br />&nbsp; &nbsp;jsr GameEngineDone</div><br />To prevent the NMI from doing anything that could ruin the loading process of the states, you could maybe have a 'TRANSITIONING' state, that when active cause the NMI handler to not do a sprite DMA or touch any PPU registers. Playing audio is OK.</div><br /><br />Hi Tokumaru! I'm about to start re-writing this monstrosity! Just a quick question before I start. Would you recommend putting these &quot;Reset Routines&quot; Before the Infinite Game Loop so that they're not infinitely repeating? Just looking for some best practices to work with before I get started.<br /><br />Thanks!<br /><br />Hundo</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186967"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186967">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=186967&amp;sid=f4a86de245904096cb854f974fda7403#p186967"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jan 17, 2017 7:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10020<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">hundonostudy wrote:</div><div class="quotecontent">Just a quick question before I start. Would you recommend putting these &quot;Reset Routines&quot; Before the Infinite Game Loop so that they're not infinitely repeating?</div><br />How they're laid out in the ROM doesn't really matter, as long as they're out of the flow. You could have something like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Reset:<br /><br />&nbsp; &nbsp;;- clear RAM, initialize the PPU, APU, sub-systems, etc.<br /><br />&nbsp; &nbsp;jsr InitializeTitle<br /><br />&nbsp; &nbsp;;- clear 'frame ready' flag<br />&nbsp; &nbsp;;- enable NMIs<br /><br />MainLoop:<br /><br />&nbsp; &nbsp;;- do tasks common to all modes<br />&nbsp; &nbsp;;- call the 'UpdateXXXXX' routine for the current mode (or none if in 'TRANSITION')<br />&nbsp; &nbsp;;- set 'frame ready' flag and wait for it to be cleared by the NMI handler<br /><br />&nbsp; &nbsp;jmp MainLoop<br /><br />;----------------------------------------------------------------<br /><br />NMI:<br /><br />&nbsp; &nbsp;;- if the game mode is 'TRANSITION', do absolutely nothing to the PPU<br />&nbsp; &nbsp;;- if the game mode is any other, and the 'frame ready' flag is set,<br />&nbsp; &nbsp;;- process pending VRAM updates, enable rendering and clear the 'frame ready' flag<br />&nbsp; &nbsp;;- update audio<br /><br />&nbsp; &nbsp;rti<br /><br />;----------------------------------------------------------------<br /><br />InitializeTitle:<br /><br />&nbsp; &nbsp;;- set game mode to 'TRANSITION'<br />&nbsp; &nbsp;;- disable rendering and draw background<br />&nbsp; &nbsp;;- initialize title screen variables<br />&nbsp; &nbsp;;- set game mode to 'TITLE'<br /><br />&nbsp; &nbsp;rts<br /><br />UpdateTitle:<br /><br />&nbsp; &nbsp;;- if 'start' is pressed, call 'InitializeGameplay'<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;rts<br /><br />;----------------------------------------------------------------<br /><br />InitializeGameplay:<br /><br />&nbsp; &nbsp;;- set game mode to 'TRANSITION'<br />&nbsp; &nbsp;;- disable rendering and draw background<br />&nbsp; &nbsp;;- initialize gameplay variables<br />&nbsp; &nbsp;;- set game mode to 'GAMEPLAY'<br /><br />&nbsp; &nbsp;rts<br /><br />UpdateGameplay:<br /><br />&nbsp; &nbsp;;- process input<br />&nbsp; &nbsp;;- move game objects<br />&nbsp; &nbsp;;- buffer VRAM updates<br />&nbsp; &nbsp;;- in case of death, call 'InitializeGameOver'<br /><br />&nbsp; &nbsp;rts</div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Just looking for some best practices to work with before I get started.</div><br />The structure above is just a suggestion (I myself don't do it quite like that), you have to create a structure you feel comfortable with, as this can be done a million different ways and each programmer prefers to do things differently. The important thing is that you're consistent in your choices. ASM gives us a lot of freedom, there are no rules on how to implement subroutines, pass parameters, declare variables, initialize stuff, and so on... For this reason, it's important that you consistently follow a set of rules of your liking to do these basic things, so you can easily follow the structure of your program even when it grows to tens of thousands of lines.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p187011"></a>
				<b class="postauthor">hundonostudy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p187011">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=187011&amp;sid=f4a86de245904096cb854f974fda7403#p187011"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 18, 2017 1:39 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jan 14, 2017 8:40 am<br /><b>Posts:</b> 23
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">hundonostudy wrote:</div><div class="quotecontent">Just a quick question before I start. Would you recommend putting these &quot;Reset Routines&quot; Before the Infinite Game Loop so that they're not infinitely repeating?</div><br />How they're laid out in the ROM doesn't really matter, as long as they're out of the flow. You could have something like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Reset:<br /><br />&nbsp; &nbsp;;- clear RAM, initialize the PPU, APU, sub-systems, etc.<br /><br />&nbsp; &nbsp;jsr InitializeTitle<br /><br />&nbsp; &nbsp;;- clear 'frame ready' flag<br />&nbsp; &nbsp;;- enable NMIs<br /><br />MainLoop:<br /><br />&nbsp; &nbsp;;- do tasks common to all modes<br />&nbsp; &nbsp;;- call the 'UpdateXXXXX' routine for the current mode (or none if in 'TRANSITION')<br />&nbsp; &nbsp;;- set 'frame ready' flag and wait for it to be cleared by the NMI handler<br /><br />&nbsp; &nbsp;jmp MainLoop<br /><br />;----------------------------------------------------------------<br /><br />NMI:<br /><br />&nbsp; &nbsp;;- if the game mode is 'TRANSITION', do absolutely nothing to the PPU<br />&nbsp; &nbsp;;- if the game mode is any other, and the 'frame ready' flag is set,<br />&nbsp; &nbsp;;- process pending VRAM updates, enable rendering and clear the 'frame ready' flag<br />&nbsp; &nbsp;;- update audio<br /><br />&nbsp; &nbsp;rti<br /><br />;----------------------------------------------------------------<br /><br />InitializeTitle:<br /><br />&nbsp; &nbsp;;- set game mode to 'TRANSITION'<br />&nbsp; &nbsp;;- disable rendering and draw background<br />&nbsp; &nbsp;;- initialize title screen variables<br />&nbsp; &nbsp;;- set game mode to 'TITLE'<br /><br />&nbsp; &nbsp;rts<br /><br />UpdateTitle:<br /><br />&nbsp; &nbsp;;- if 'start' is pressed, call 'InitializeGameplay'<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;rts<br /><br />;----------------------------------------------------------------<br /><br />InitializeGameplay:<br /><br />&nbsp; &nbsp;;- set game mode to 'TRANSITION'<br />&nbsp; &nbsp;;- disable rendering and draw background<br />&nbsp; &nbsp;;- initialize gameplay variables<br />&nbsp; &nbsp;;- set game mode to 'GAMEPLAY'<br /><br />&nbsp; &nbsp;rts<br /><br />UpdateGameplay:<br /><br />&nbsp; &nbsp;;- process input<br />&nbsp; &nbsp;;- move game objects<br />&nbsp; &nbsp;;- buffer VRAM updates<br />&nbsp; &nbsp;;- in case of death, call 'InitializeGameOver'<br /><br />&nbsp; &nbsp;rts</div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Just looking for some best practices to work with before I get started.</div><br />The structure above is just a suggestion (I myself don't do it quite like that), you have to create a structure you feel comfortable with, as this can be done a million different ways and each programmer prefers to do things differently. The important thing is that you're consistent in your choices. ASM gives us a lot of freedom, there are no rules on how to implement subroutines, pass parameters, declare variables, initialize stuff, and so on... For this reason, it's important that you consistently follow a set of rules of your liking to do these basic things, so you can easily follow the structure of your program even when it grows to tens of thousands of lines.</div><br /><br />Thank you for the suggestion Toku. Can you help me out a little with the frame ready flag? Not sure what you want me to write there. Should I write a piece of code that is Incrementing a variable to use as a wait counter for example, or should I simply create a variable that is set to #$00 when not ready and have the NMI update that flag to #$01 at the beggining of NMI and #$00 at the end of NMI to use as an indicator for when NMI starts and stops?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8203&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p187024"></a>
				<b class="postauthor">Pokun</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p187024">Re: Problems Loading a NameTable to show Game Over Screen</a></div><div style="float: right;"><a href="./viewtopic.php?p=187024&amp;sid=f4a86de245904096cb854f974fda7403#p187024"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 18, 2017 4:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue May 28, 2013 5:49 am<br /><b>Posts:</b> 761<br /><b>Location:</b> Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You could go with either a frame counter (counts NMIs) or a flag. In Tokumaru's example he is using a flag. Setting and then clearing the flag within the NMI is pointless though. Once NMI has happened it won't go back to the main loop until it reaches the rti instruction.<br />You set the flag in the main loop and clear it in the NMI. You also need to wait (by looping) in main until the flag is cleared again (which indicates an NMI has happened). In the NMI handler you clear it at the end of NMI to indicate that an NMI has happened.<br />Waiting like this ensures that there are no more than one iteration of the main loop on one NMI.<br /><br />In the example it looks like the flag also indicates that there are graphic updates to be done in vblank, so you can make graphic updates in the NMI conditional based on the state of the flag (if it's set, you update, else you skip updates that NMI). This ensures that if the NMI happens before the main loop has finished (i.e. has not set the flag) the NMI won't do any graphical updates. So it won't draw partly done screens that are still being processed in the main loop logic.<br /><br /><strong>Edit:</strong> Fixed mixups.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6013&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 22 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=15391&amp;sid=f4a86de245904096cb854f974fda7403&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=f4a86de245904096cb854f974fda7403">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=f4a86de245904096cb854f974fda7403">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10&amp;sid=f4a86de245904096cb854f974fda7403">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 7 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php?sid=f4a86de245904096cb854f974fda7403"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="15391" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="f4a86de245904096cb854f974fda7403" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=f4a86de245904096cb854f974fda7403" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10" selected="selected">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Megaman 2</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Megaman 2</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=23&amp;t=9431">http://forums.nesdev.com/viewtopic.php?f=23&amp;t=9431</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tomaitheous</b> [ Thu Oct 25, 2012 10:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Got megaman 2 up and running. Love this game...<br /><br /><!-- m --><a class="postlink" href="https://www.youtube.com/watch?v=ljtxuk9KDCg">https://www.youtube.com/watch?v=ljtxuk9KDCg</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Thu Oct 25, 2012 10:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Cool. Though the music at the &quot;weapon equip&quot; sequence after the boss fight sounds messed up <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />How do you map the NES RAM and I/O areas to TG16 RAM btw? I'd expect clashes between zeropage RAM, PPU I/O and APU I/O due to the amount of RAM available on the TG16 and how the 6280's paging works. Or do you rely on BRAM or some other kind of expansion RAM (Arcade Card)?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>keropi</b> [ Thu Oct 25, 2012 10:42 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />awesome work!  <img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Thu Oct 25, 2012 10:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />TG16 lets you remap address space. You can move WRAM, I/O, etc. <br /><br />Awesome work. What an amazing game to get running on the PCE.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Thu Oct 25, 2012 10:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That's awesome! Do you have any documentation on the tool you used for the conversion? Or a description of the process?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tomaitheous</b> [ Thu Oct 25, 2012 11:02 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent">Cool. Though the music at the &quot;weapon equip&quot; sequence after the boss fight sounds messed up <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />How do you map the NES RAM and I/O areas to TG16 RAM btw? I'd expect clashes between zeropage RAM, PPU I/O and APU I/O due to the amount of RAM available on the TG16 and how the 6280's paging works. Or do you rely on BRAM or some other kind of expansion RAM (Arcade Card)?</div><br /><br /> I believe that part of the audio is due to sweep emulation not being right. Heh, I was actually gonna look at your source so see how you handled the audio emulation in your nsf TG16 player.<br /><br /> The game doesn't use any additional ram, so I'm safe with with getting by with the 8k scratch pad ram of hucard setup (though this runs on CD 3.0 too, so I have access to more ram if needed by such NES games). Anyway, I map the 8k ram bank to both MPR0 and MPR1. This takes care of ZP and stack access since it's locked to $2000-21fff logic address range (isn't this what you do with your NSF player on the tg16?). I map the hardware bank ($ff) of the PCE to MPR3 (video ports become $6000,$6002/$6003) since the current NES game has open bus there, but for other games that have expanded ram (like Dragon Warrior which I have running on the PCE CD as well) - I use self modifying code and use the ST0/ST1/ST2 opcodes to write directly to vram and VDC regs without having any hardware bank mapped. The only time I map it in on vblank interrupt call, cause I need to read the status port of the VDC to acknowledge the interrupt. Else, I'm good to go. My backend emulation code (APU/PPU/game/internal) is mapped to MPR2/$4000-$5fff range.<br /><br /> As far as port read and writes, I replace them with JSRs to the backend emulation. I wrote a tool that scans the rom for specific opcodes for those I/O port writes. It only took 4 hours to get Megaman 2 up and running with the existing backend emulation and that including playing and beating the game.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Thu Oct 25, 2012 11:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">TG16 lets you remap address space.</div><br />Yes, <a href="http://jiggawatt.org/badc0de/nsfplayer.htm" class="postlink">I'm aware of that</a> <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br />But those three regions all need to be writeable at the same time unless you modify the 6502 code of the NES game, and there's only one physical page of RAM on an unexpanded TG16 regardless of how many logical pages you might've mirrored it to.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Thu Oct 25, 2012 11:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I believe that part of the audio is due to sweep emulation not being right. Heh, I was actually gonna look at your source so see how you handled the audio emulation in your nsf TG16 player.</div><br /><br />I implemented it as it was described on the nesdev wiki. IIRC, something like this (pseudo code):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">wPeriod = &#91;0x4002&#93; &amp; 0x7FF<br />bShift = &#91;0x4001&#93; &amp; 7<br />bNeg = &#91;0x4001&#93; &amp; 8<br />&#91;0x4002&#93; = bNeg ? (wPeriod - (wPeriod&gt;&gt;bShift)) : (wPeriod + (wPeriod&gt;&gt;bShift))<br /></div><br /><br />And similarly for square 2. This is updated twice per frame (120 times/second for NTSC).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tomaitheous</b> [ Thu Oct 25, 2012 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">TG16 lets you remap address space.</div><br />Yes, <a href="http://jiggawatt.org/badc0de/nsfplayer.htm" class="postlink">I'm aware of that</a> <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br />But those three regions all need to be writeable at the same time unless you modify the 6502 code of the NES game, and there's only one physical page of RAM on an unexpanded TG16 regardless of how many logical pages you might've mirrored it to.</div><br /><br /> Mapping ram to MPR0 and MPR1 takes care of all ZP and stack related issues (since ZP and stack will go to $2000 range, but since ram is mirrored to $0000 range - regular access to ram is fine as well). If you replace the port read/writes with JSRs (I've yet to see port access that isn't full 16bit address; i.e. lda 2007 or sta $4000,x), the perfect length for a JSR replacement. But yeah, WRAM presents a problem for hucard projects, unless you use the Populous rom layout which gives you an additional 32k of ram after the 4megabit rom address range or you just limit your project to CD (Tailchao made a new hucard mapper for PCE with expand ram and rom, but no emulator supports it yet that I know of).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tomaitheous</b> [ Thu Oct 25, 2012 11:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I believe that part of the audio is due to sweep emulation not being right. Heh, I was actually gonna look at your source so see how you handled the audio emulation in your nsf TG16 player.</div><br /><br />I implemented it as it was described on the nesdev wiki. IIRC, something like this (pseudo code):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">wPeriod = &#91;0x4002&#93; &amp; 0x7FF<br />bShift = &#91;0x4001&#93; &amp; 7<br />bNeg = &#91;0x4001&#93; &amp; 8<br />&#91;0x4002&#93; = bNeg ? (wPeriod - (wPeriod&gt;&gt;bShift)) : (wPeriod + (wPeriod&gt;&gt;bShift))<br /></div><br /><br />And similarly for square 2. This is updated twice per frame (120 times/second for NTSC).</div><br /><br /> I probably have some $4015 behavior incorrect as well. I need to re-go over my audio emulation code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>TailChao</b> [ Thu Oct 25, 2012 5:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tomaitheous wrote:</div><div class="quotecontent">(Tailchao made a new hucard mapper for PCE with expand ram and rom, but no emulator supports it yet that I know of).</div><br />Actually it's partially supported in newer builds of Mednafen. I didn't even find this out until upgrading to 0.9.26 awhile ago, and my builds stopped working.<br />Reads from any address just return $FF, so if it finds an MCGenjin header in your ROM you're kind of hosed. I think it's just some missing break; statements in ReadTP of mcgenjin.h, but I'll have to test it out later.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Fri Oct 26, 2012 5:53 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br /><br />Damn...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ccovell</b> [ Fri Oct 26, 2012 6:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Interesting... Mic_ I didn't know you made your own PCE NSF player too.<br /><br />I made up one back in 2006 just for fun, but didn't develop it too far because I was working on Tongueman's Logic more earnestly.  You can check out how I did the MPR voodoo in the source code.<br /><br /><!-- m --><a class="postlink" href="http://www.chrismcovell.com/data/PCE_NES_Player.zip">http://www.chrismcovell.com/data/PCE_NES_Player.zip</a><!-- m --><br /><br />Okay, since you posted on your blog about this too, Tomaitheous:  Is there <em>any</em> way to eliminate the nasty popping on real PCE hardware when you write new waveforms into WSG RAM?  The only thing that <span style="text-decoration: underline">doesn't</span> cause popping are waveforms that are 32 bytes of value $10.   Even changing the volume registers on the PCE causes popping.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri Oct 26, 2012 7:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> Is there any way to eliminate the nasty popping on real PCE hardware when you write new waveforms into WSG RAM?</div><br />They don't seem all that noticeable on my TG16. But how about dynamically moving channels around? The TG16 has 6 channels, and the NES only has 4 if you ignore any expansion audio (or 5 if you emulate DMC). So if the duty cycle of Pulse1 or Pulse2 changes, load the waveform that matches the new duty cycle into a currently unused HuC6280 channel (channel 4 or 5), then deactivate the HuC6280 channel currently used and start the new channel. That should at least get rid of any gaps that result from halting the channel while loading the new waveform.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri Oct 26, 2012 11:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Megaman 2</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Will the 50% duty cycle square wave get fixed?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - NES -&gt; SNES ROM convertor?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">NES -&gt; SNES ROM convertor?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=5826">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=5826</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sun Dec 13, 2009 8:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">emu_enthusiast wrote:</div><div class="quotecontent">Why does anybody attempt to make an emulator?<br />And why do people continue to make emulators of consoles that are often already perfect or near perfectly emulated?<br /><br />Is it because it is necessary? </div>
<br />Yes, this allows you to play old games without suffereing the problems of non-working connector, lost saves (due to died out batteries), unconfortable controller and play games translated from japanese, and to homebrew.
<br />
<br />A NES -&gt; SNES "converter" would probably be doable for simple mapper that uses no of few raster effects, but would have completely no point, as Fx3 pointed out.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Sun Dec 13, 2009 10:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't agree that it would be useless.
<br />
<br />It would be very educational for one.  He would become much more familiar with both the NES and SNES, and no doubt give him a boost in whatever programming language he chooses.
<br />
<br />And let's not forget the fun factor.  Isn't that the only reason any of us indie developers code anything?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Dec 13, 2009 3:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Disch wrote:</div><div class="quotecontent">And let's not forget the fun factor.  Isn't that the only reason any of us indie developers code anything?</div>
<br />That and donations. I got enough donations from TOD, my GBA test cases, and my forum.gbadev.org posts to buy a DS and a DS homebrew kit back when homebrew was expensive (early PassMe days). Lockjaw for PC and GBA brought in a couple more donations from the old tetrisconcept.com crowd (which since split into harddrop.com and tetrisconcept.net), which I used toward buying my cousin's PSP-2000 so I could make final verifications on Luminesweeper.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sun Dec 13, 2009 8:40 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Hamtaro126 wrote:</div><div class="quotecontent">What do you mean by ''A little bit of code''? </div><br /><br />Ask Overload, he hasn't released the source code yet. It could in fact be a full-fledged NES emulator for all I really know. I seem to recall hearing that it shared portions of the SNES code is all.<br /><br /><div class="quotetitle">Disch wrote:</div><div class="quotecontent">The problem with this is space. LDA absolute is only 3 bytes, but JSL long is 4 bytes. This can be gotten around by "hijacking" the following instruction and placing it in the new subroutine (a trick I employed in my ROM hacking days).</div>
<br />
<br />Until you run into one of those bastard games that have an RTS after your desired instruction. Or even better, where the entire function is just your opcode + rts (or there's a branch line in each direction), so you can't patch in the opposite direction either. You're pretty much forced to find free space in that bank as a springboard, or somehow hijack a JML (your location) into WRAM, an unused HDMA block, etc.
<br />
<br />I've actually ran into this many times. It's very frustrating. I suspect you'd run into the problem a lot with an automated tool.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Sun Dec 13, 2009 9:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />byuu:
<br />
<br />Good point.  That could also screw up jumps too.  What if a game jumps to the instruction immediately after the STA?  I'd imagine that would be quite common as well.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>emu_enthusiast</b> [ Tue Dec 15, 2009 7:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">And let's not forget the fun factor.  Isn't that the only reason any of us indie developers code anything?</div><br />That and donations. I got enough donations from TOD, my GBA test cases, and my forum.gbadev.org posts to buy a DS and a DS homebrew kit back when homebrew was expensive (early PassMe days). Lockjaw for PC and GBA brought in a couple more donations from the old tetrisconcept.com crowd (which since split into harddrop.com and tetrisconcept.net), which I used toward buying my cousin's PSP-2000 so I could make final verifications on Luminesweeper.</div>
<br />
<br />@tepples
<br />
<br />That's pretty cool that you managed to make some money from doing it. I still think that your case would be the exception, rather than the norm though.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Thu Dec 17, 2009 2:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Regarding the JSL long, I didn't think it was an issue since you could put a table of long JMPs in RAM, starting at $0800 and JSR to there with the normal 3 bytes.  If you support 29 registers (should be all of them except for $4016/$4017) with 4 addressing modes for each register, 4 bytes for each JMP long, that's 464 bytes.
<br />
<br />Though you might have to dork with the stack or something to get it to RTL properly back from a JSR, I haven't used the '816 enough to know if that's much of an issue.
<br />
<br />It might not be fast, but you've just gotta hope they don't write the registers too much.  Regs like $2007 will need to be optimized (I think it would be very appropriate to use static recompilation in that case, to really be safe).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Dec 17, 2009 2:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Memblers wrote:</div><div class="quotecontent">Though you might have to dork with the stack or something to get it to RTL properly back from a JSR</div>
<br />That's called long jumping to a PHK-PLB-RTS in the appropriate bank.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Thu Dec 17, 2009 2:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh ok, I remember using PHK / PLB in my NSF player now that you mention it.  Had been a while.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Parasyte</b> [ Thu Dec 31, 2009 12:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm <em>very</em> surprised this hasn't been mentioned yet! And you were all so close bringing up the idea of code/data separation with FCEU*'s code/data logger; Kent Hansen (Snowbro) wrote NESrev circa 2003 to tackle this problem exactly; a code/data analyzing disassembler for NROM games.
<br />
<br />I, myself, have experimented with a similar approach for SNES <a href="http://www.kodewerx.org/wiki/index.php/Snesrc" class="postlink">[1]</a>.
<br />
<br />I'm not sure if NESrev will be useful to you, emu_enthusiast. But if you want to go the recompiler route, that's the ticket. (At least until something better comes along?)
<br />
<br />It will be difficult writing a generalized tool for conversion, as many have already pointed out. But don't let that distract you! Remember that similar things have been done before. Even if not entirely relevant, one example I can think of off the top of my head is the GBC-Colorizer; it was able to "convert" old monochrome GB games into GBC-color mode by inserting a generic subroutine that could setup the palette as configured by the user. It took advantage of the higher clockrate that GBC games ran, because the palette handler did add some overhead.
<br />
<br />Similarly, SNES also runs "slightly" faster than NES, and this additional horsepower can be used to detect (and "correct") trouble areas like register accesses at runtime. Of course, this requires some serious hacking; this method is a lot like "software watchpoints" which I've explained in some detail on <a href="http://www.kodewerx.org/forum/viewtopic.php?f=11&amp;t=6772" class="postlink">my forums</a>. There are possibly better ways to redirect register accesses and the like (pre-patching the ones that can be easily found and analyzed, for example). But runtime-checking is foolproof when implemented properly, even if it does add a ton of overhead. But hey, it's just an educational proof-of-concept project, right?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Patrick FR</b> [ Thu Jun 21, 2012 11:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi
<br />In 2010 I wanted to work on an sd cartridge but they are working well enough on it, and discovered at that time this CPU compatibility between the snes and the nes.
<br />So I made a program called "uper nes" doing the work described in this post.
<br />The goal is to increase the number of games on the super nes.
<br />It is complex but the disassembling and assembling a snes rom works.
<br />It lacks good register emulation. Actually it converts successfully test roms but not SMB.
<br />It works by recompiling all the code contained in the prg rom and only the code because the prg rom is kept as a data source.
<br />The snes rom runs the code bank on the recompiled code and the data bank on the original prg rom.
<br />The CHR roms are converted when they are inserted into the video ram.
<br />The tricky part is the indirect jump, I used a printf from Neviksti to display each unknow indirect jump address at runtime. Because the indirect jump addresses are not know until runtime. Therefore disassembling does not work on these addresses at first pass. The addresses must be entered by hand in a config file and the the re-assembler started again.
<br />Actually the re-assembler is like finished but it lacks proper asm routines in order to recompile games that work. Like the DMA does not work, sprite 0 is not implemented...
<br />
<br />Memblers has built the apu emulation already so I will use it if he wants but does anyone wants to help for the register emulation routines? I feel bored to always test and retest.
<br />Maybe someone with more experience on the nes could help?
<br />I will work on it in order to allow mapper 0 conversions. But not soon, it is difficult and I must take a full week to do something on it and then I'am exhausted.
<br />I stopped for some month because I have a black screen on SMB and because maybe I can be helped. It will go faster than do it all myself. However even if helped, I keep doing the disassembler side of it.
<br />
<br />It works on linux, uses flex and yak and wla-65816 assembler. I debug using supersleuth on wine.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Patrick FR</b> [ Thu Jun 21, 2012 11:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Some more details:
<br />The register access emulation calls routines from an assembler file.
<br />All the remaining work should be to finish these routines. Some are linked more or less to others but it is possible to finish it by building test roms for the nes that only show one function on one register and then make the conversion work on the snes.
<br />Actually I have the background, the palete, the controller, but problems with sprites and DMA.
<br />And sometimes adding something new breaks old functions so test roms are mandatory.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Thu Jun 21, 2012 9:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Patrick: PM me if you got a chance, We can collaborate and use our skills to do this.
<br />
<br />Also You need to convert to BASS (Byuu's ASSembler) to make things simpler. WLA may not be suitible enough for everyone because of the bad things the linker does, etc. 
<br />
<br />Still... I think this is great what you are doing.
<br />
<br />You may try to ask the user named ''_mic'' for assistance of recreating the APU registers in SPC700 for WLA. and if needed, a BASS conversion may be also appropriate, or use MSU-1, but may be more difficult!
<br />
<br />About the DMA of the Sprites: There are 128 sprites instead of the 64 sprites, You cannot adjust it to the size of 64.
<br />
<br />So in order to do this: You must make a mirror of the SPR-RAM in FreeRAM, Just like in the Arkanoid conversion by P0P:
<br />
<br />To do this, Copy the RAM from the defined position ($200-$2FF, 64 bytes) and copy it to FreeRAM at any place remaining (Arkanoid conversion uses SPR-DMA at $800-$9FF). and make the other 64 sprites turn 8x8 into 8x16 using a if the emulated register's 8x16 bit is activated (optional)
<br />
<br />
<br />EDIT: Difference in Sprites are like this:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Key:<br />s = size<br />x,X = x position<br />y = y position<br />p = palette<br />c = character<br />m = same as c, but adds to the character set &#40;mode&#41;<br />v = vertical flip <br />h = horizontal flip<br />o = object priority &#40;Depends on mode in SNES&#41;<br />- = should be unused<br />&#40;8 = the emulator's switch bit for CHR, shouldn't be used in real NES games&#41;<br /><br />From NES&#40;8x8&#41;: <br />yyyyyyyy,vho---pp,cccccccc,xxxxxxxx<br />From NES&#40;8x16&#41;: <br />yyyyyyyy,vho---pp,cccccccm,xxxxxxxx<br />From SNES:<br />xxxxxxxx,yyyyyyyy,cccccccc,vhoopppm+XsXsXsXs<br /><br />For the SNES NES emulator, I propose a format conversion to this before DMA: <br /><br />xxxxxxxx,yyyyyyyy,cccccccm,vho--pp8<br /><br />in 8x16 mode, the M must set the 8 bit, in any modes, the ''pp &#40;palettes&#41;'' must be converted to comply with the SNES via bit shifting to the left...<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Patrick FR</b> [ Fri Jun 22, 2012 3:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi
<br />
<br />I must take a look at BASS. Sure that WLA is not user friendly sometimes, but it works on linux and has interesting features when it's time to build the rom file.
<br />The APU should just be glued in from Memblers work.
<br />For the sprites I do not have it in mind but converting the format is something tricky. I use a loop to do the conversions before copy in video ram or CGRAM and I may use 64KB of cache wram for it because the DMA must be able to copy it at any time. I have used many strategies, but first it must work then be optimised.
<br />
<br />What is the Pop's Arkanoid version?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Fri Jun 22, 2012 5:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Patrick FR wrote:</div><div class="quotecontent">Hi<br /><br />I must take a look at BASS. Sure that WLA is not user friendly sometimes, but it works on linux and has interesting features when it's time to build the rom file.<br />The APU should just be glued in from Memblers work.<br />For the sprites I do not have it in mind but converting the format is something tricky. I use a loop to do the conversions before copy in video ram or CGRAM and I may use 64KB of cache wram for it because the DMA must be able to copy it at any time. I have used many strategies, but first it must work then be optimised.<br /><br />What is the Pop's Arkanoid version?</div>
<br />
<br />It is a NES to SNES conversion hack made by P0P, A old 1994-1995 SNES Hacker...
<br />
<br />I may give it to you via PM under study purposes upon request, It is part-ROMhack Part-homebrew, so it is not to be distributed any other place!
<br />
<br />Or search via GOOGLE.COM something or other...
<br />
<br />EDIT: I contacted one of the people that had a similar project, Overload had the same thoughts and maybe we can combine code if approved by him (Contacted via PM)
<br />
<br />Byuu said I need to check him out, so I did so...

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
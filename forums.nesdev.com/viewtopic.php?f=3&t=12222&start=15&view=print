<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Bomberman hangs on opening title</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Bomberman hangs on opening title</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=12222">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=12222</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sat Jan 10, 2015 10:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Anes wrote:</div><div class="quotecontent">The thing is that you have reached as experienced developer emu author and/or .rom author.</div><br /><div class="quotetitle">Anes wrote:</div><div class="quotecontent">And no offense to you, but everybody was a begginer at first and needed help (like you) to work around a problem.</div><br />Yep, they are correct.<br /><br /><div class="quotetitle">Anes wrote:</div><div class="quotecontent">I remember when you were a beginner and made question such as &quot;is there not a technical doc othat NES 2C02 reference??&quot; Making note that it was too difficult to you. (i don't wan't to search the link for your old post, but you remember it don't you?)</div><br />Sorry, but you'll have to find the original post.<br /><br /><div class="quotetitle">Anes wrote:</div><div class="quotecontent">So, if you think the question or issue somebody expose here is too &quot;noob&quot; remember your old days when you had the Signature &quot;Wednesday,  the best emulator in the net.... well according to the author&quot; and don't reply the noob question if you think so.</div><br />For crying out loud. The signature was a joke. And I think people knew that. More importantly, I never called anyone a 'noob'. In fact, if you scroll back up you'll see that I made couple of posts that actually helped the guy.<br /><br />I make a fair point that people need to be more descriptive about what they have and haven't implemented part A of the CPU of part D of the PPU. That way we can help diagnose the problem sooner.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Jan 10, 2015 4:59 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">it annoys me so much that people come to this forum with problems like this before they have even implemented even the most basic of CPU accuracy and then ask us why game A or B doesn't work properly.</div><br />Perhaps austere thought it was like DOSBox, where games don't care exactly how many cycles they're given so long as it's roughly comparable to the MIPS of the actual CPU.<br /><br /><div class="quotetitle">austere wrote:</div><div class="quotecontent"> I was actually surprised that most things I've thrown at it worked fairly well, even Shatterhand which has faux parallax scrolling.</div><br />MMC3 games tend to handle parallax scrolling acceptably even with inaccurate cycle counts because the PIT (programmable interrupt timer) frees the engine from having to count cycles or spin on sprite 0.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>austere</b> [ Sat Jan 10, 2015 11:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Perhaps austere thought it was like DOSBox, where games don't care exactly how many cycles they're given so long as it's roughly comparable to the MIPS of the actual CPU.<br /></div><br /><br />I know what you mean but no, I'm *not being ignorant of the timing model of the NES. I'm currently finishing a PhD in electronic engineering (microelectronics) so I do appreciate the importance of timing which is I was quite surprised it worked fine for the most part as my prior post shows:<br /><br /><div class="quotetitle">austere wrote:</div><div class="quotecontent">I never really expected many games to run given that I didn't account for page crossing and branch adjustment cycles</div><br /><br />The current version uses scanline emulation of the PPU so it wouldn't make too big a difference if it was sprite 0 collision detection at fault. More likely something to do with the vertical blanking.<br /><br />I'll improve instruction timing and report if it made any difference. If it didn't, it's probably something else Bomberman is expected that the other games are not... might be a really silly bug I'm missing.<br /><br />* Oops typo.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sun Jan 11, 2015 5:26 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />austere how good is your CPU emulation in terms of opcode accuracy? Have you run nestest.nes? If so, what are the results?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>austere</b> [ Sun Jan 11, 2015 6:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The core passes kevtris's test and the more thorough one for all official opcodes.<br /><br />I just upgraded the core so that it accounted for the extra cycle because of the carry calculation for page crossing. That got it passing blargg's VBL test and sprite hit bottom test. Still no dice on bomberman, will investigate it further tomorrow.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sun Jan 11, 2015 8:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Fixing random things is not the best way to solve a problem like this. The best thing to do would be to compare execution logs against an emulator where the game works, so you know exactly when things go to shit.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sun Jan 11, 2015 9:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Fixing random things is not the best way to solve a problem like this. The best thing to do would be to compare execution logs against an emulator where the game works, so you know exactly when things go to shit.</div><br />How is he fixing random things? Its obviously the CPU and he is going the correct way about it.<br /><br />Any chance that you could post the CPU source? When we have had the chance previously to directly view others we've been able to help out so much quicker.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>austere</b> [ Sun Jan 11, 2015 11:46 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Any chance that you could post the CPU source? When we have had the chance previously to directly view others we've been able to help out so much quicker.</div><br /><br />Sure thing!<br /><br /><!-- m --><a class="postlink" href="https://bitbucket.org/austere/finalnes/src/cda4f12d810c58aa831f47b26687124738a74582/6502_fa/nes.cpp?at=master">https://bitbucket.org/austere/finalnes/ ... ?at=master</a><!-- m --><br /><br />That's the latest committed version. In that directory you'll also find nes.h and cpu6502_info.cpp which contains the table it uses to decode the instructions/get the base timing, but most of what you'll be interested in is under the Cpu:: section. When I wrote the core (mostly over weekend 4 years ago) I planned to use templates for the addressing modes, but at least this way it makes it easier to follow and debug. When it's stable, performance can be improved.<br /><br />... And don't mind the apu/ppu code, it's quite a mess at the moment. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>x0000</b> [ Fri Jan 16, 2015 8:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Make sure you pass CLI latency tests

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Jan 16, 2015 12:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">x0000 wrote:</div><div class="quotecontent">Make sure you pass CLI latency tests</div><br />That has nothing to do with his problem. Old versions of WedNESday ran Bomberman no problem and that was before I emulated CLI/SEI/PLP latency.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>x0000</b> [ Fri Jan 16, 2015 6:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">That has nothing to do with his problem.</div><br />Not sure about that. If I recall correctly there is a typical problem that Bomberman has an active VBlank waiting via reading ppu status with NMI enabled at the same time, and it is clearing VBlank flag in NMI routine. So it could lead to infinte wait for VBlank flag if it was not read before NMI had vectorised.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sat Jan 17, 2015 4:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">x0000 wrote:</div><div class="quotecontent">Not sure about that. If I recall correctly there is a typical problem that Bomberman has an active VBlank waiting via reading ppu status with NMI enabled at the same time, and it is clearing VBlank flag in NMI routine. So it could lead to infinte wait for VBlank flag if it was not read before NMI had vectorised.</div><br />And what does that have to do with CLI latency?<br /><br />Regardless, that would cause it to freeze on real both emulators + real hardware let alone 1 person's emulator.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>x0000</b> [ Sat Jan 17, 2015 8:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Bomberman hangs on opening title</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">And what does that have to do with CLI latency?<br />Regardless, that would cause it to freeze on real both emulators + real hardware let alone 1 person's emulator.</div><br />It is not freezing on a real hardware because ppu status is read just before NMI being invoked. Therefore you need a correct logic to handle interrupt triggering flags for NMI and IRQ, cli latency tests would help with that. NMI rising timing can also be an issue here, but it is harder to get it wrong I think.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
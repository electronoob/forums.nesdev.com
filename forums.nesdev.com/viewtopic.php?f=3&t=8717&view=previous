<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - I give up, I can't find a way to emulate chiptune sound!</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - I give up, I can't find a way to emulate chiptune sound!" href="http://forums.nesdev.com/feed.php?f=3&amp;t=8717" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=7652';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 11:04 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=7652">I give up, I can't find a way to emulate chiptune sound!</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=7652"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 27 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=7652&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=7652&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=7652&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=7652&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=7652&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p76629"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p76629">I give up, I can't find a way to emulate chiptune sound!</a></div><div style="float: right;"><a href="./viewtopic.php?p=76629#p76629"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Apr 13, 2011 1:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ok, I've been able to understand and mostly emulate just about everything in the NES....except the sound. Sound is my absolute weakest link in my Computer Science knowledge(along with networking) and I'm having the hardest time trying to find out how to play this stuff on a modern machine!
<br />
<br />Now I <strong>could</strong> use that one sound emulator that I think blargg created, but I really feel that I should do this on my own as I think I'll have to learn how to deal with sound sooner or later.
<br />
<br />I've been searching for days in how to emulate this stuff using Allegro, with no luck at all. Right now, I'm looking into OpenAl, but I don't think I should get my hopes up.
<br />
<br />Tutorials on Allegro5's audio seems to be non existent except for the documentation, which only lists the functions and structs and very briefly what they do. Even if there was one, it would most likely be about loading sample files and not about manipulating the sound programmaticaly. So maybe I should look to another another library like OpenAl? Or perhaps there's something fundamental that I'm not getting here?
<br />
<br />Now, from my incredibly limited understanding I believe I can produce the sound by producing these simple waves? Like the square wave. It looks pretty simple, but how do I produce this with a sound library? Can I produce a square wave using samples?
<br />
<br />
<br />
<br />What do you guys use for sound emulation?
<br />
<br />Thanks for your time!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p76633"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p76633"></a></div><div style="float: right;"><a href="./viewtopic.php?p=76633#p76633"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Apr 13, 2011 1:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've never used Allegro 5, but in Allegro 4, what you want is AUDIOSTREAM.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p76647"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p76647"></a></div><div style="float: right;"><a href="./viewtopic.php?p=76647#p76647"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Apr 13, 2011 5:46 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Alright, thanks!
<br />
<br />I searched the examples in my allegro folder and found ex_synth.cpp which seems to contain the algorithms to produce a square and triangle wave and I'll check that out for a while.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p76718"></a>
				<b class="postauthor">Undubbed</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p76718"></a></div><div style="float: right;"><a href="./viewtopic.php?p=76718#p76718"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 14, 2011 12:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Aug 09, 2009 7:46 am<br /><b>Posts:</b> 24
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ok, I used a stream object and kind of copied the stream method of ex_synth and I'm glad that I actually got a sound to come out that kind of sounds like a square wave, but testing it against other programs that produce square waves(including ex_synth) it sounds waaaay off. Most likely frequency related.
<br />
<br />Wish I had the code with me, but I don't <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" />
<br />
<br />But basically I have a class called Square Wave that just takes a wavelength(in the same range as the nes's square wave 1). Now, from my understanding you can get the frequency from wavelength from an equation that I can't remember right now... ( wavelength = (C / (16f) )-1; solve for f... I solved it yesterday but I can't do it again today for some reason &gt;_&lt;; oh and C == NES's CPU cycles per second) 
<br />
<br />Anyway, I barely have any idea what I need to do with the frequency. I'm fairly sure that I need to play <em>wavelength<br /></em> samples <em>frequency </em>times in a span of a second, but I don't know how to do the algorithm for that in conjunction with Allegro's stream object and functions.
<br />
<br />EDIT: Before I just had makeshift code from memory. Now it's the real code.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#include &lt;iostream&gt;<br />#include &lt;cstdlib&gt;<br />#include &lt;allegro5/allegro.h&gt;<br />#include &lt;allegro5/allegro_audio.h&gt;<br /><br />using namespace std;<br />const int NES_CPU_CYCLES = 1790000;<br /><br />class SquareWave<br />&#123;<br />public:<br />&nbsp; &nbsp;SquareWave&#40;int wl&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;WaveLength = wl;<br />&nbsp; &nbsp;&nbsp; &nbsp;Frequency = NES_CPU_CYCLES / &#40;16 * &#40;wl + 1&#41;&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;dt = WaveLength * Frequency;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;~SquareWave&#40;&#41;&#123;&#125;<br /><br />&nbsp; &nbsp;void ProduceSamples&#40;float *buffer&#41;<br />&nbsp; &nbsp;&#123; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Am I supposed to cut these periods in half?<br />&nbsp; &nbsp;&nbsp; &nbsp;float half = WaveLength / 2.0;<br />&nbsp; &nbsp;&nbsp; &nbsp;float amplitude = 1.0;<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;&nbsp; &nbsp;for &#40;int index = 0; index &lt; WaveLength; index++&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if &#40;index&nbsp; &lt;= half&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;buffer&#91;index&#93; = amplitude;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;buffer&#91;index&#93; = -amplitude;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&#125;<br /><br /><br />&nbsp; &nbsp;int GetWaveLength&#40;&#41; &#123;return WaveLength;&#125;<br />&nbsp; &nbsp;int GetFrequency&#40;&#41; &#123;return Frequency;&#125;<br />&nbsp; &nbsp;int GetDT&#40;&#41; &#123;return dt;&#125;<br />private:<br />&nbsp; &nbsp;int WaveLength;<br />&nbsp; &nbsp;int Frequency;&nbsp; &nbsp; // Can't find a place to use this with without<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // making it not work at all<br />&nbsp; &nbsp;int dt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// or this<br />&#125;;<br /><br />int main&#40;&#41;<br />&#123;<br />&nbsp; &nbsp;ALLEGRO_AUDIO_STREAM *stream = NULL;<br />&nbsp; &nbsp;SquareWave square&#40;0x7FF&#41;;<br /><br />&nbsp; &nbsp;if &#40;!al_init&#40;&#41;&#41; &#123;<br />&nbsp; &nbsp; &nbsp; fprintf&#40;stderr, &quot;Could not init Allegro.\n&quot;&#41;;<br />&nbsp; &nbsp; &nbsp; return 1;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;if &#40;!al_install_audio&#40;&#41;&#41; &#123;<br />&nbsp; &nbsp; &nbsp; cout &lt;&lt; &quot;Could not init sound!&quot; &lt;&lt; endl;<br />&nbsp; &nbsp; &nbsp; return 1;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;if &#40;!al_reserve_samples&#40;0&#41;&#41; &#123;<br />&nbsp; &nbsp; &nbsp; cout &lt;&lt; &quot;Could not set up voice and mixer.&quot; &lt;&lt; endl;<br />&nbsp; &nbsp; &nbsp; return 1;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;ALLEGRO_AUDIO_DEPTH depth = ALLEGRO_AUDIO_DEPTH_FLOAT32;<br />&nbsp; &nbsp;ALLEGRO_CHANNEL_CONF ch = ALLEGRO_CHANNEL_CONF_1;<br /><br />&nbsp; &nbsp;// Tried to use freq and it doesn't work; using 44100 for now<br />&nbsp; &nbsp;int freq = square.GetFrequency&#40;&#41;;<br />&nbsp; &nbsp;stream = al_create_audio_stream&#40;1, square.GetWaveLength&#40;&#41;, 44100,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;depth, ch&#41;;<br /><br />&nbsp; &nbsp;if &#40;!stream&#41; &#123;<br />&nbsp; &nbsp; &nbsp; cout &lt;&lt; &quot;Could not create stream.&quot; &lt;&lt; endl;<br />&nbsp; &nbsp; &nbsp; return 1;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;ALLEGRO_MIXER *mixer = al_get_default_mixer&#40;&#41;;<br />&nbsp; &nbsp;if &#40;!al_attach_audio_stream_to_mixer&#40;stream, mixer&#41;&#41; &#123;<br />&nbsp; &nbsp; &nbsp; cout &lt;&lt; &quot;Could not attach stream to mixer.&quot; &lt;&lt; endl;<br />&nbsp; &nbsp; &nbsp; return 1;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;void *buf = al_get_audio_stream_fragment&#40;stream&#41;;<br />&nbsp; &nbsp;while &#40;!buf&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // have to wait for some reason....<br />&nbsp; &nbsp;&nbsp; &nbsp;buf = al_get_audio_stream_fragment&#40;stream&#41;;<br />&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;//where the buffer gets loaded<br />&nbsp; &nbsp;square.ProduceSamples&#40;&#40;float *&#41;buf&#41;;<br /><br />&nbsp; &nbsp;if &#40;!al_set_audio_stream_fragment&#40;stream, buf&#41;&#41; &#123;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fprintf&#40;stderr, &quot;Error setting stream fragment.\n&quot;&#41;;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;system&#40;&quot;PAUSE&quot;&#41;;<br /><br />&nbsp; &nbsp;al_destroy_audio_stream&#40;stream&#41;;<br />&nbsp; &nbsp;al_uninstall_audio&#40;&#41;;<br />&nbsp; &nbsp;return 0;<br />&#125;<br /></div>
<br />
<br />
<br />In the main code I make an <em>ALLEGRO_AUDIO_STREAM</em> object that is made with <em>al_create_audio_stream()</em>, with one fragment, samples == the wavelength, frequency is 44100, depth is float32 and channel is CONF_2. Also, before that, allegro init, the audio add-on init and <em>al_reserve_samples()</em> are called...
<br />
<br />then I call<em> al_get_audio_stream_fragment()</em> which is assigned to a pointer to a void called <em>buffer</em> and then it's looped until it doesn't equal zero. Then I call al_set_audio_stream_fragment() and that's basically what I did.
<br />
<br />A sound DOES play and it does sound like a square wave, but at, say, a wavelength of 9, where it's supposed to sound very high....doesn't sound very high at all. and when the wavelength is 0x7FF(the max value accepted for nes's wavelength) it sounds...very little like what other programs produce(including emulators) at that same wavelength.
<br />
<br />So, I'm stuck until I can find a solution to this...
<br />
<br />I'm pretty sure it has to do with the frequency of SquareWave and the frequency that I put into the al_create_audio_stream function and I've experimented, but it just ends with worst results &gt;_&lt;.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4007"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77356"></a>
				<b class="postauthor">miker00lz</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77356"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77356#p77356"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 28, 2011 4:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4572.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Sep 23, 2010 7:28 pm<br /><b>Posts:</b> 145
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">if it helps, this is the APU code from my emulator (FreeBASIC) ... the code is kind of sloppy, but it does work and it shouldn't be too (i hope) difficult to decipher.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Dim Shared As LongInt cpuclock = 1789773, samplerate = 44100, sampleticks = 1789773/44100<br />Dim Shared As Integer buflen, freqmod = 7402, bufpos = 0<br />Dim Shared As Byte cursample = 0, square1sample = 0, square2sample = 0, trianglesample = 0,_<br />&nbsp; &nbsp;noisesample = 0, dmcsample = 0, gain = 1, tester = 0, square1=0, square2=0, triangle=0, noise=0,_<br />&nbsp; &nbsp;tricounter = 0, counterstep = 4, curstep = 1, nosound<br /><br />Dim Shared As Integer square1_duty = 0, square1_dutypos = 0, square1_loopenv = 0, square1_env = 15,_<br />&nbsp; &nbsp;square1_disableenv = 0, square1_envperiod = 0, square1_enablesweep = 0, square1_period = 0,_<br />&nbsp; &nbsp;square1_negative = 0, square1_shift = 0, square1counter = 0, square1_sweep = 0,_<br />&nbsp; &nbsp;square1_length = 0, square1_enable = 0, square1_write = 0<br /><br />Dim Shared As LongInt square1_timer = 1, square1_freq = 100000, s1t = 1<br /><br />Dim Shared As Integer square2_duty = 0, square2_dutypos = 0, square2_loopenv = 0, square2_env = 15,_<br />&nbsp; &nbsp;square2_disableenv = 0, square2_envperiod = 0, square2_enablesweep = 0, square2_period = 0,_<br />&nbsp; &nbsp;square2_negative = 0, square2_shift = 0, square2counter = 0, square2_sweep = 0,_<br />&nbsp; &nbsp;square2_length = 0, square2_enable = 0, square2_write = 0<br /><br />Dim Shared As LongInt square2_timer = 1, square2_freq = 100000, s2t = 1<br /><br />Dim Shared As Integer triangle_control = 0, triangle_counter = 0, triangle_length = 0, triangle_period = 0,_<br />&nbsp; &nbsp;triangle_enable = 0, triangle_write = 0, triangle_halt = 0<br />Dim Shared As LongInt triangle_timer = 1, triangle_freq = 10000000<br /><br />Dim Shared As Integer noise_loopenv = 0, noise_disableenv = 0, noise_envperiod = 0, noise_shortmode = 0,_<br />&nbsp; &nbsp;noise_shift = 1, noise_period = 0, noise_length = 0, noise_write = 0, noise_halt = 0, noise_env = 0,_<br />&nbsp; &nbsp;noise_enable = 0, noise_loop = 0, noise_origenv = 0<br />Dim Shared As LongInt noise_timer = 1<br /><br />Dim Shared As Integer dmc_irqenable = 0, dmc_loop = 1, dmc_freqindex = 0, dmc_dac = 0, dmc_addr = 0,_<br />&nbsp; &nbsp;dmc_length = 0, dmc_enable = 0<br /><br />Dim Shared As Integer lengthcounterenable = 1, dmclen = 1, noiselen = 1, trianglelen = 1, square1len = 1, square2len = 1<br /><br />Dim Shared As Integer frameinterrupt = 0<br /><br />Dim Shared As Integer squarelookup&#40;32&#41;, otherlookup&#40;204&#41;<br /><br />Dim Shared As UByte lengthtable&#40;&amp;h20&#41; =&gt; &#123;_<br />&nbsp; &nbsp;10,254, 20,&nbsp; 2, 40,&nbsp; 4, 80,&nbsp; 6, 160,&nbsp; 8, 60, 10, 14, 12, 26, 14,_<br />&nbsp; &nbsp;12, 16, 24, 18, 48, 20, 96, 22, 192, 24, 72, 26, 16, 28, 32, 30 &#125;<br /><br /><br />Dim Shared As Integer noisefreq&#40;&amp;h10&#41; =&gt; &#123;_<br />&nbsp; &nbsp;4, 8, 16, 32, 64, 96, 128, 160, 202,_<br />&nbsp; &nbsp;254, 380, 508, 762, 1016, 2034, 4068 &#125;<br /><br />Dim Shared As UByte tritable&#40;32&#41; =&gt; &#123;_<br />&nbsp; &nbsp;8, 9, 10, 11, 12, 13, 14, 15, 15, 14, 13, 12, 11, 10, 9 ,8,_<br />&nbsp; &nbsp;7, 6, 5, 4, 3, 2, 1, 0, 0, 1, 2, 3, 4, 5, 6, 7 &#125;<br /><br />Dim Shared As UByte duty0&#40;16&#41; =&gt; &#123; 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 &#125;<br />Dim Shared As UByte duty1&#40;16&#41; =&gt; &#123; 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 &#125;<br />Dim Shared As UByte duty2&#40;16&#41; =&gt; &#123; 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0 &#125;<br />Dim Shared As UByte duty3&#40;16&#41; =&gt; &#123; 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 &#125;<br /><br />Dim Shared buf&#40;11025&#41; As Byte<br /><br />Function APUreadregs&#40;ByVal addr As UShort&#41; As Integer<br />&nbsp; &nbsp; &nbsp;Dim tmpstatus As Integer<br />&nbsp; &nbsp; &nbsp;tmpstatus = dmc_irqenable*128 + frameinterrupt*64<br />&nbsp; &nbsp; &nbsp;if &#40;dmc_length&#41; Then tmpstatus = tmpstatus + 16<br />&nbsp; &nbsp; &nbsp;if &#40;triangle_length&#41; Then tmpstatus = tmpstatus + 4<br />&nbsp; &nbsp; &nbsp;If &#40;square2_length&#41; Then tmpstatus = tmpstatus + 2<br />&nbsp; &nbsp; &nbsp;If &#40;square1_length&#41; then tmpstatus = tmpstatus + 1<br />&nbsp; &nbsp; &nbsp;APUreadregs = tmpstatus<br />End Function<br /><br />Sub APUwriteregs&#40;ByVal addr As UShort, ByVal value As UByte&#41;<br />&nbsp; &nbsp; &nbsp;Select Case As Const &#40;addr&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'START SQUARE 1 HERE<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4000:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_duty = value Shr 6<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 32&#41; Then square1_disableenv = 1 else square1_disableenv = 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_env = value And &amp;hF<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_env = square1_env + &#40;&#40;value Shr 1&#41; And &amp;h10&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4001:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 128&#41; Then square1_enablesweep = 1 else square1_enablesweep = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_sweep = &#40;&#40;value Shr 4&#41; And 7&#41;+1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And &amp;h10&#41; Then square1_negative = 1 else square1_negative = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_shift = value And 7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4002:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_timer = &#40;square1_timer&nbsp; And&nbsp; &amp;hF00&#41; + value<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4003:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_length = lengthtable&#40;value Shr 3&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_timer = &#40;square1_timer And &amp;hFF&#41; + &#40;&#40;value And &amp;h7&#41; Shl 8&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square1_dutypos = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'START SQUARE 2 HERE<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4004:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_duty = value Shr 6<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 32&#41; Then square2_disableenv = 1 else square2_disableenv = 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_env = value And &amp;hF<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_env = square2_env + &#40;&#40;value Shr 1&#41; And &amp;h10&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4005:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 128&#41; Then square2_enablesweep = 1 else square2_enablesweep = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_sweep = &#40;&#40;value Shr 4&#41; And 7&#41;+1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And &amp;h10&#41; Then square2_negative = 1 else square2_negative = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_shift = value And 7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4006:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_timer = &#40;square2_timer&nbsp; And&nbsp; &amp;hF00&#41; + value<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4007:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_length = lengthtable&#40;value Shr 3&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_timer = &#40;square2_timer And &amp;hFF&#41; + &#40;&#40;value And &amp;h7&#41; Shl 8&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_dutypos = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'START TRIANGLE HERE<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4008:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_halt = value And &amp;h80 Shr 7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;triangle_control=0&#41; Then triangle_halt = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_counter = value And &amp;h7F<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h400A:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_timer = &#40;triangle_timer And &amp;hF00&#41; + value<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h400B:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_timer = &#40;triangle_timer And &amp;hFF&#41; + &#40;&#40;value And &amp;h7&#41; Shl 8&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_length = lengthtable&#40;value Shr 3&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_freq = cpuclock / &#40;32*&#40;triangle_timer&#41;+1&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;triangle_halt = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'START NOISE HERE<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h400C:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 32&#41; Then noise_halt = 1 else noise_halt = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noise_env = value And &amp;h1F<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noise_origenv = noise_env<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h400E:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 128&#41; Then noise_loop = 1 else noise_loop = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noise_timer = noisefreq&#40;value And &amp;hF&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h400F:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noise_length = lengthtable&#40;value Shr 3&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;noise_env = noise_origenv<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4015:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 1&#41; Then square1_enable = 1 else square1_enable = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 2&#41; Then square2_enable = 1 else square2_enable = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 4&#41; Then triangle_enable = 1 else triangle_enable = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 8&#41; Then noise_enable = 1 else noise_enable = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And 16&#41; Then dmc_enable = 1 else dmc_enable = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case &amp;h4017:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &#40;value And &amp;h80&#41; Then counterstep = 5 else counterstep = 4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;curstep = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;End Select<br />End Sub<br /><br />Sub putinbuf&#40;&#41;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;buf&#40;bufpos&#41; = cursample<br />&nbsp; &nbsp; &nbsp;bufpos = bufpos + 1<br />End Sub<br /><br />Sub square1_clock&#40;&#41;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;if &#40;&#40;square1_enable=1&#41; And &#40;square1_length&gt;0&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp;if &#40;square1_disableenv=1&#41; Then square1_env = &amp;hF<br />&nbsp; &nbsp; &nbsp; &nbsp;Select case &#40;square1_duty&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 0: if &#40;duty0&#40;square1_dutypos&#41;&#41; Then square1sample = square1_env else square1sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 1: if &#40;duty1&#40;square1_dutypos&#41;&#41; Then square1sample = square1_env else square1sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 2: if &#40;duty2&#40;square1_dutypos&#41;&#41; Then square1sample = square1_env else square1sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 3: if &#40;duty3&#40;square1_dutypos&#41;&#41; Then square1sample = -1*square1_env else square1sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;End Select<br />&nbsp; &nbsp; &nbsp; &nbsp;square1_dutypos = &#40;square1_dutypos + 1&#41; Mod 16<br />&nbsp; &nbsp; &nbsp;Else<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;square1sample = 0<br />&nbsp; &nbsp; &nbsp;End If<br />End Sub<br /><br />Sub square2_clock&#40;&#41; <br />&nbsp; &nbsp; &nbsp;if &#40;&#40;square2_enable=1&#41; and &#40;square2_length&gt;0&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp;if &#40;square2_disableenv=1&#41; Then square2_env = &amp;hF<br />&nbsp; &nbsp; &nbsp; &nbsp;Select Case &#40;square2_duty&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 0: if &#40;duty0&#40;square2_dutypos&#41;&#41; Then square2sample = square2_env else square2sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 1: if &#40;duty1&#40;square2_dutypos&#41;&#41; Then square2sample = square2_env else square2sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 2: if &#40;duty2&#40;square2_dutypos&#41;&#41; Then square2sample = square2_env else square2sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;case 3: if &#40;duty3&#40;square2_dutypos&#41;&#41; Then square2sample = -1*square2_env else square2sample = 0<br />&nbsp; &nbsp; &nbsp; &nbsp;End Select<br />&nbsp; &nbsp; &nbsp; &nbsp;square2_dutypos = &#40;square2_dutypos + 1&#41; Mod 16<br />&nbsp; &nbsp; &nbsp;Else<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;square2sample = 0<br />&nbsp; &nbsp; &nbsp;End If<br />End Sub<br /><br />Sub triangle_clock&#40;&#41;<br />&nbsp; &nbsp; &nbsp;if &#40;&#40;triangle_enable=0&#41; or &#40;triangle_length&lt;=0&#41;&#41; Then Exit Sub<br />&nbsp; &nbsp; &nbsp;trianglesample = tritable&#40;tricounter&#41;<br />&nbsp; &nbsp; &nbsp;if &#40;trianglesample&gt;15&#41; Then trianglesample = 31 - trianglesample<br />&nbsp; &nbsp; &nbsp;tricounter = &#40;tricounter + 1&#41; mod 32<br />End Sub<br /><br />sub noise_clock&#40;&#41;<br />&nbsp; dim feedback, tmpbit As Integer<br />&nbsp; if &#40;noise_loop&#41; Then<br />&nbsp; &nbsp; if &#40;noise_shift And 64&#41; Then tmpbit = 1 else tmpbit = 0<br />&nbsp; &nbsp; feedback = &#40;noise_shift And 1&#41; Xor tmpbit<br />&nbsp; Else<br />&nbsp; &nbsp; if &#40;noise_shift And 2&#41; Then tmpbit = 1 else tmpbit = 0<br />&nbsp; &nbsp; feedback = &#40;noise_shift And 1&#41; Xor tmpbit<br />&nbsp; End If<br />&nbsp; noise_shift = &#40;noise_shift Shr 1&#41; + &#40;feedback Shl 13&#41;<br />&nbsp; if &#40;&#40;noise_enable&#41; and &#40;noise_length&gt;0&#41; and &#40;&#40;noise_shift And 1&#41;=0&#41; and &#40;noise_timer&gt;=8&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;noisesample = noise_env<br />&nbsp; Else<br />&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;noisesample = 0<br />&nbsp; End If<br />End Sub<br /><br />Sub APU_frame_seq_tick&#40;&#41;<br />&nbsp; &nbsp; &nbsp;if &#40;counterstep=4&#41; Then<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;triangle_length&gt;0&#41; Then triangle_length = triangle_length - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;square1_length&gt;0&#41; Then square1_length = square1_length - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;square2_length&gt;0&#41; Then square2_length = square2_length - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;noise_length&gt;0&#41; Then noise_length = noise_length - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;&#40;curstep=4&#41; And &#40;&#40;flag_reg And 4&#41;=0&#41;&#41; Then flag_reg = flag_reg or &amp;h14<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;square1_sweep&gt;0&#41; Then square1_sweep = square1_sweep - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;square2_sweep&gt;0&#41; Then square2_sweep = square2_sweep - 1<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;&#40;square1_negative=1&#41; and &#40;square1_enablesweep=1&#41; and &#40;square1_sweep&gt;0&#41; and &#40;curstep&lt;5&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;square1_timer = square1_timer - &#40;square1_timer Shr square1_shift&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; ElseIf &#40;&#40;curstep&lt;5&#41; And &#40;square1_enablesweep=1&#41; and &#40;square1_sweep&gt;0&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;square1_timer = square1_timer + &#40;square1_timer Shr square1_shift&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; End If<br />&nbsp; &nbsp; &nbsp; &nbsp; if &#40;&#40;square2_negative=1&#41; and &#40;square2_enablesweep=1&#41; and &#40;square2_sweep&gt;0&#41; and &#40;curstep&lt;5&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;square2_timer = square2_timer - &#40;square2_timer Shr square2_shift&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; ElseIf &#40;&#40;curstep&lt;5&#41; and &#40;square2_enablesweep=1&#41; and &#40;square2_sweep&gt;0&#41;&#41; Then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;square2_timer = square2_timer + &#40;square2_timer Shr square2_shift&#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; End If<br />&nbsp; &nbsp; &nbsp;End If<br />&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;curstep = &#40;curstep+1&#41; mod counterstep<br />End Sub<br /><br />Sub fillaudio Cdecl &#40;ByVal userdata As Any Ptr, ByVal audbuffer As UByte Ptr, ByVal audlen As Integer&#41;<br />&nbsp; &nbsp;Dim As UByte Ptr audbyte<br />&nbsp; &nbsp;For n = 0 To buflen-1<br />&nbsp; &nbsp;&nbsp; &nbsp;audbyte = audbuffer + n<br />&nbsp; &nbsp;&nbsp; &nbsp;*audbyte = buf&#40;n&#41;<br />&nbsp; &nbsp;Next n<br />&nbsp; &nbsp;bufpos = 0<br />End Sub<br /></div><br /><br /><br />and then this is at the end of my 6502 opcode execution loop after each instruction:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">If &#40;&#40;triangle_enable&#41; And &#40;triangle_timer&lt;=&#40;totalticks-lasttriangletick&#41;&#41;&#41; Then triangle_clock&#40;&#41;: lasttriangletick = totalticks<br />If &#40;&#40;square1_enable&#41; And &#40;square1_length&gt;0&#41; And &#40;square1_timer&gt;=8&#41; and &#40;square1_timer&lt;=&#40;totalticks-lastsquare1tick&#41;&#41;&#41; Then square1_clock&#40;&#41;: lastsquare1tick = totalticks<br />If &#40;&#40;square2_enable&#41; And &#40;square2_length&gt;0&#41; And &#40;square2_timer&gt;=8&#41; And &#40;square2_timer&lt;=&#40;totalticks-lastsquare2tick&#41;&#41;&#41; Then square2_clock&#40;&#41;: lastsquare2tick = totalticks<br />If &#40;&#40;noise_enable&#41; and &#40;noise_length&gt;0&#41; and &#40;noise_timer&gt;=8&#41; and &#40;noise_timer&lt;=&#40;totalticks-lastnoisetick&#41;&#41;&#41; Then noise_clock&#40;&#41;: lastnoisetick = totalticks<br /><br />If sampleticks&lt;=&#40;totalticks-lastsampletick&#41; Then<br />&nbsp; &nbsp;cursample = square1sample + square2sample + trianglesample + 0.2 * noisesample<br />&nbsp; &nbsp;If &#40;bufpos&lt;buflen&#41; Then putinbuf&#40;&#41;<br />&nbsp; &nbsp;lastsampletick = totalticks<br />End If<br /><br />If &#40;&#40;cpuclock/240&#41;&lt;=&#40;totalticks-lastframeseqtick&#41;&#41; Then<br />&nbsp; &nbsp;APU_frame_seq_tick&#40;&#41;<br />&nbsp; &nbsp;lastframeseqtick = totalticks<br />End If</div>
<br />
<br />my sound emulation is NOT perfect, but i've got it improved to the point where it's pretty damn close (imo anyway)... i don't emulate the DPCM channel yet though.
<br />
<br />here's an MP3 of what it generates from metal man's stage music in megaman 2 - <!-- m --><a class="postlink" href="http://rubbermallet.org/moarnes-metalman.mp3">http://rubbermallet.org/moarnes-metalman.mp3</a><!-- m --></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4572"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p77364"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77364"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77364#p77364"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 28, 2011 7:38 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><img src="http://huntingbusinessmarketing.com/wp-content/uploads/2009/02/Hmm....jpg" alt="Image" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77368"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77368"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77368#p77368"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 29, 2011 3:26 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 1077<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">HMM...</div>
<br />What is the point of posting all these images? I can understand doing it every once in a while to spice things up, but you're doing it quite a lot, and in sometimes inappropriate places (why put down a guy who shares his code?).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p77374"></a>
				<b class="postauthor">miker00lz</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77374"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77374#p77374"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 29, 2011 8:16 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4572.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Sep 23, 2010 7:28 pm<br /><b>Posts:</b> 145
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thefox wrote:</div><div class="quotecontent"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">HMM...</div><br />What is the point of posting all these images? I can understand doing it every once in a while to spice things up, but you're doing it quite a lot, and in sometimes inappropriate places (why put down a guy who shares his code?).</div>
<br />
<br />seriously... i'm trying to help show the guy how i did my sound emulation.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4572"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77380"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77380"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77380#p77380"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 29, 2011 2:57 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It's not quite exactly what he wants. Basically, it's the Allegro sound interface, not the sound emulation side.</div>

					
						<div class="postbody"><br />_________________<br /><strong>Zepper</strong><br /><a href="http://rocknes.web.fc2.com/" class="postlink"><em>RockNES developer</em></a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p77382"></a>
				<b class="postauthor">miker00lz</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77382"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77382#p77382"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 29, 2011 3:01 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4572.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Sep 23, 2010 7:28 pm<br /><b>Posts:</b> 145
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">well, he was asking about allegro yeah but he also said he's not sure how to generate a square wave, etc using samples. he was wondering if allegro or another lib had a way to generate it. i was showing how you have to generate sound when emulating the NES APU, and all the variables involved in the waveform output.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4572"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77402"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77402"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77402#p77402"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 29, 2011 7:38 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Well, basically, I <em>never</em> could interface the Allegro' sound in my emulator "error-free". It's not an easy task and I even couldn't take the "risk" of trying Allegro 5. 
<br />
<br />Regarding the samples, well... as far as I know of it, you would need to generate 1 sample at every CPU clock cycle. That means a resample to the PC frequency. I add all the samples and divide by the number of updates. Using Allegro, the amount of samples is always the same; so, you would feed the buffer with, let's say, 2048 samples per sound sync.</div>

					
						<div class="postbody"><br />_________________<br /><strong>Zepper</strong><br /><a href="http://rocknes.web.fc2.com/" class="postlink"><em>RockNES developer</em></a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p77516"></a>
				<b class="postauthor">miker00lz</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77516"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77516#p77516"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 01, 2011 7:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4572.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Sep 23, 2010 7:28 pm<br /><b>Posts:</b> 145
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">the following may not be 100% accurate, but as i understand it, every APU channel has a countdown timer <em>n</em> and a new sample for that channel is generated every <em>n</em> CPU ticks.
<br />
<br />at the same time the new channel samples are calculated, the variables for the channel are updated/stepped (like the position of the duty cycle step on the squares, and for the triangle it steps where it is in the 32-byte lookup table)
<br />
<br />then every 1789773 divided by 240(on NTSC) clock ticks, it steps another counter. every 4 steps of that, the square sweep counters are decremented and all of the length counters are decremented. every 4 or 5 steps (depending on a value written to register $4017) that counter wraps back to zero.
<br />
<br />every 1789773 divided by <em>samplerate</em> CPU ticks you'll want to mix together all the channels' sample values and there's your output sample to put in your final stream.
<br />
<br />that's oversimplying the process, but that's basically how things would be done in an emulator.
<br />
<br />i can't speak for getting allegro going, as i've always used SDL, and it's great. never had an issue with it.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4572"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77526"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77526"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77526#p77526"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon May 02, 2011 10:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yup. That's the basic idea.</div>

					
						<div class="postbody"><br />_________________<br /><strong>Zepper</strong><br /><a href="http://rocknes.web.fc2.com/" class="postlink"><em>RockNES developer</em></a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p77527"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77527"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77527#p77527"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon May 02, 2011 10:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 1965<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">What is the point of posting all these images?</div>
<br />
<br /><strong>-</strong> Probably the same reason that many of you have criticized a simple dash before my posts<em>!</em></div>

					
						<div class="postbody"><br />_________________<br /><strong>Zepper</strong><br /><a href="http://rocknes.web.fc2.com/" class="postlink"><em>RockNES developer</em></a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p77539"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p77539"></a></div><div style="float: right;"><a href="./viewtopic.php?p=77539#p77539"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon May 02, 2011 5:22 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 697<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">Yup. That's the basic idea.</div>
<br />
<br />What is??</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=7652"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=7652"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 27 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=7652&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=7652&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="7652" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
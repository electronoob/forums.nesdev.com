<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - The Famicom's and the NES's Audio Path</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NES Hardware and Flash Equipment" href="http://forums.nesdev.com/feed.php?f=9" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - The Famicom's and the NES's Audio Path" href="http://forums.nesdev.com/feed.php?f=9&amp;t=56" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '2');
	var per_page = '15';
	var base_url = './viewtopic.php?f=9&amp;t=56';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 12:09 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=9&amp;t=56&amp;start=15">The Famicom's and the NES's Audio Path</a></h2>


	<p class="moderators">Moderators: <a href="./memberlist.php?mode=viewprofile&amp;u=3466">B00daW</a>, <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=56"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 25 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=9&amp;t=56&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=9&amp;t=56">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=9&amp;t=56&amp;start=15&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=9&amp;t=56&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=9&amp;t=56&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p205661"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205661">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205661#p205661"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Oct 07, 2017 11:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I would like to directly attach a 0-5V PWM signal from a microcontroller</div><br />Did some testing of my own because I'm looking to do the same thing!<br /><br />My test is pretty simple.  I've attached it in case anyone else want to try.  The rom only runs from $E000-FFFF so it should be fairly mapper independent assuming the last bank is fixed.  Visually it doesn't display anything worthwhile, just some junk from my CICOp register test.<br /><br />Only SQ1 &amp; SQ2 channels are enabled, SQ1 is set to C4 (middle C) and SQ2 is set to E4.  Both have 50% duty and max volume.<br /><br />I did not find any negative voltage.  I found a max output level of 350mV (note 10x probe used in scope shot) this is when both channels are active (summed).  When only one channel was pulsing high, it's output is 200mV.<br /><br />I can run some other simple tests like this if it's of interest, but this pretty much answered my questions.</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="gensmall"><b>File comment:</b> 10x probe, 2a03 pin 1 scope shot</span><br />
		
			<a href="./download/file.php?id=10383&amp;mode=view"><img src="./download/file.php?id=10383&amp;t=1" alt="APU vol test CPU_pin1 sq1C4 sq2E4 max vol 10xprobe.JPG" /></a><br />
			<span class="gensmall">APU vol test CPU_pin1 sq1C4 sq2E4 max vol 10xprobe.JPG [ 90.2 KiB | Viewed 960 times ]</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row1">
			<span class="gensmall"><b>File comment:</b> test rom</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=10381">inltest.nes</a> [40.02 KiB]
			</span><br />
			<span class="gensmall">Downloaded 29 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p205662"></a>
				<b class="postauthor">uXe</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205662">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205662#p205662"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 12:21 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5768_1353848905.png" width="64" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 25, 2012 5:28 am<br /><b>Posts:</b> 23<br /><b>Location:</b> Adelaide, Australia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">Did some testing of my own because I'm looking to do the same thing!</div><br /><br />Great minds <img src="./images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /><br /><br />...and you plan on adding 313K of resistance to compensate? or you have a better solution in mind?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5768"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p205663"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205663">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205663#p205663"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 1:00 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">uXe wrote:</div><div class="quotecontent">...and you plan on adding 313K of resistance to compensate? or you have a better solution in mind?</div><br /><br />What's your thinking on 313K?  0-5v signal from mcu, trying to get down to 200mV is a factor of 25.  Thus you need 20k * (25 - 1) = 480K..?<br /><br />Being a PWM DAC, it's fairly easy to reduce the synthesized channel to less than 5v.  In an 8bit DAC a simple implementation would be for a square channel to have 4 bits of volume similar to the APU/VRC6/etc.  So the channels max would be a DAC level of 15 out of 255 equates to 5.9% of 5v = 295mV for that channel without tweaking anything.  A little beyond the target 150-200mV per channel to match the APU.<br /><br />Couple ways to tweak things to match.  An added 20K resistor would work, but I kinda like/have to assume many people simply soldered in a 47k for the audio mod.  That's my preferred condition, and then adjust the PWM levels to match.  So 67k divides that channel by 3.35, so 295mV -&gt; 88mV equavalence if I'm understanding everything.  <br /><br />To get to a volume comparable to the APU, the level needs doubled bringing it to ~175mV.  That can be done in the mcu by shifting the final output volume left by 1 bit.  Sort of cuts an 8bit DAC down to 7bits in terms of number of total full volume channels prior to clipping, but that's manageable.  7bits would provide room for quite a few full volume channels at once.  The lower bit really isn't lost either, channels could simply have 5 bits of volume to equal an APU square if they've got a use for the extra resolution.<br /><br />P.S. I'm guessing I've made an error in my math/knowledge somewhere..</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p205667"></a>
				<b class="postauthor">uXe</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205667">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205667#p205667"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 3:48 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5768_1353848905.png" width="64" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Nov 25, 2012 5:28 am<br /><b>Posts:</b> 23<br /><b>Location:</b> Adelaide, Australia
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">What's your thinking on 313K?  0-5v signal from mcu, trying to get down to 200mV is a factor of 25.  Thus you need 20k * (25 - 1) = 480K..?</div><br /><br />Was just going on lidnariq's numbers from earlier in this thread:<br /><br /><!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=56&amp;start#p205492">viewtopic.php?f=9&amp;t=56&amp;start#p205492</a><!-- l --><br /><br />Both CPU pin 1 and Expansion Port pin 3 feed into separate 20K resistors in the audio mixing / amplification circuit, so to match CPU pin 1's 0.3V as I understand it: 5V / 0.3V = 16.666666667 * 20 = 333.333333333 minus the 20K already in place equals 313K?<br /><br />My problem is that I would not be using a DAC with amplitude settings, and be able to just reduce the signal down that way. I'm looking at a PWM pin on an 8-bit AVR, or likely just software PWM on a digital pin, so it's either on or off, 0 or 5V, full stop.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5768"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p205669"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205669">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205669#p205669"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 4:28 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1704<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It may actually be a benefit if an ext audio synth is a bit quieter than the internal APU. <br /><br />This is because the steps between the 15 audio levels are quite coarse. Less full volume = finer steps, leading to smoother envelopes; something the APU can't* offer but a synth with a similar 4-bit interface can. That would enable using slow-moving envelopes  (in a satisfactory/transparent way) more readily.<br /><br />The max volume of the APU squares aren't very useful, IMO. There's many times i've wished for an &quot;x.5&quot; setting but i've never felt the need for maxing the squares. Rather, i avoid it.<br /><br /><br />*There's a workaround for the apu wich is chorusing two square channels and then you can kind of get doubly fine volume steps at the expense of independent movement/having the sound to be slightly detuned. Sometimes, you can even hide the coarse stepping in a second square voice at another interval than unison, but it is circumstantial (dependent on the harmonics of the tone, i presume).</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p205676"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205676">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205676#p205676"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 9:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">uXe wrote:</div><div class="quotecontent">Was just going on lidnariq's numbers from earlier in this thread:</div>313K assumes the  APU channels have a max volume of 300mV.  Take it for what it's worth, but based on my testing a single APU square @ max volume is more like 150-200mV.  300-350mV is both squares summed, I'm guessing that is what your and lidnariq's tests were measuring.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">My problem is that I would not be using a DAC with amplitude settings, and be able to just reduce the signal down that way. I'm looking at a PWM pin on an 8-bit AVR, or likely just software PWM on a digital pin, so it's either on or off, 0 or 5V, full stop.</div> Oh my bad, I read too far into your statement, I thought you were implementing a PWM DAC too.  Your single square channel with invariable volume will be pretty limited..  Why not add a cap to your resistor to unlock your 8bit AVR's PWM DAC ability.?  Give yourself ability to adjust the channel's volume, even allows multiple channels of varying shape if you want to get fancy.  Obviously up to you, but just wanted to make sure you were aware of how simple a PWM DAC is to implement on a 8bit mcu.  Open music labs has a pretty good <a href="http://www.openmusiclabs.com/learning/digital/pwm-dac.1.html" class="postlink">article</a> that showed me the light, along with an arduino sketch <a href="http://wiki.openmusiclabs.com/wiki/PWMDAC" class="postlink">tutorial</a>.<br /><br /><div class="quotetitle">FrankenGraphics wrote:</div><div class="quotecontent">The max volume of the APU squares aren't very useful, IMO. There's many times i've wished for an &quot;x.5&quot; setting but i've never felt the need for maxing the squares. Rather, i avoid it.</div> As always, thanks for the insight, these are the types of things I don't have a good sense for.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p205680"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205680">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205680#p205680"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 10:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">313K assumes the  APU channels have a max volume of 300mV.  Take it for what it's worth, but based on my testing a single APU square @ max volume is more like 150-200mV.  300-350mV is both squares summed, I'm guessing that is what your and lidnariq's tests were measuring.<br /></div>Exactly.<br /><br />If the OEM pulse channels are 150mV each into 20kÎ©, then that's 7.5ÂµA at max; 5V and 7.5ÂµA is 670kÎ©. To match the NES's built-in 20kÎ© and the typical 47kÎ© added, I'd assume you'd want a â‰ˆ600kÎ© resistor out of the PWM DAC ... <em>if</em> it's still only one channel being mixed in.<br /><br />Personally, I'd be tempted to mix multiple channels.<br /><br /><div class="quotetitle">uXe wrote:</div><div class="quotecontent">My problem is that I would not be using a DAC with amplitude settings, and be able to just reduce the signal down that way. I'm looking at a PWM pin on an 8-bit AVR, or likely just software PWM on a digital pin, so it's either on or off, 0 or 5V, full stop.<br /></div>It's completely ridiculous, but you could add an external resistor DAC to add volume control without having to manage the IRQs from a PWM DAC.<br /><br />Something like:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;PWM ---R---+<br />&nbsp;PA0 ---R---+<br />&nbsp;PA1 --2R---+<br />&nbsp;PA2 --4R---+<br />&nbsp;PA3 --8R---+---500k---expansion port<br /></div><br /><br />And you could then toggle bits in DDRA to adjust the volume.<br /><br /><br />I say &quot;ridiculous&quot; because in practice, your microcontroller is probably not too busy to manage updating the PWM value to serve as a DAC.<br /><br /><br /><div class="quotetitle">FrankenGraphics wrote:</div><div class="quotecontent">The max volume of the APU squares aren't very useful, IMO. There's many times i've wished for an &quot;x.5&quot; setting but i've never felt the need for maxing the squares. Rather, i avoid it.<br /></div>In thinking about this, it occurs to me that we could sink current out of the mixing node to add software-controlled master volume control.<br /><br />If we had something like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+--- expansion port --- 20k --- mixing node<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;||<br />&nbsp;PWM ---R-+-+---|&lt; npn&nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |&nbsp; &nbsp; &nbsp;\&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R C&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +-+------+--gnd&nbsp; &nbsp; &nbsp;||<br /></div>although it might be more useful to pull the mixing node up to 5V (instead of pulling it down to ground as in this schematic) for greater dynamic range.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p205681"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205681">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205681#p205681"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 11:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1704<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">master volume control</div> <br /> <img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> Sounds like it could be useful for:<br />-fade in/out<br />-half-mute (for example in a menu).<br />-tri envelope when playing solo<br />-super-exponential decays/swells of squares/noise/samples playing solo or with shared rythm<br />-maybe even improved dynamic range and/or fizz reduction of samples<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">to pull the mixing node up to 5V.</div><br /><br />For one thing, many studio synthesizers use a swing of 5v or even greater for audio prior to the output stage - this to keep the noise floor down relative to the signal on analog audio lines. This becomes increasingly important when mixing a large number of signals; effectively raising the noise floor. <br /><br />Consumer-grade outputs however have a nominal swing of 0.447V peak-to-peak using a single sine, or more importantly 0.316V root mean square (pretty close to the NES?)<br /><br />Studio equipment should have a nominal output of 1.228Vrms.<br /><br />I think Sunsoft 5B audio breaks the consumer-grade nominal levels by quite a bit. It has one benefit, though:<br />using its coarse, loud squares as the reference point, it'll relatively push the full APU dynamic range into useful range and make its steps seem finer by comparison. Use Sunsoft for quick and loud envelopes, and the APU's for &quot;quiet&quot; and more nuanced/slow ones. This has the unfortunate side effect of the hypothetical game/music becoming the loudest in the nes library and will see users reaching for the volume control of their tv/speakers/laptop, but fwiw it almost works like having a finer envelope range.<br /><br />Then the sunsoft synth has that 5-bit internal hardware envelope to mitigate its coarseness, but no game has ever used it...</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=7508">FrankenGraphics</a> on Sun Oct 08, 2017 11:12 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p205682"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205682">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205682#p205682"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 11:12 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"> we could sink current out of the mixing node to add software-controlled master volume control.<br /><br />If we had something like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+--- expansion port --- 20k --- mixing node<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;||<br />&nbsp;PWM ---R-+-+---|&lt; npn&nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |&nbsp; &nbsp; &nbsp;\&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; R C&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | |&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +-+------+--gnd&nbsp; &nbsp; &nbsp;||<br /></div></div><br /><br />This ability would be significantly more limited if operating with the assumption of a fixed 47k EXP port audio mod right?  Gives more reason to include the pot in my EXP port dongle..<br /><br />I'm a little confused how one would integrate expansion audio channels and master volume at the same time in terms of the PWM DAC's output level calculation.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p205685"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p205685">Re: The Famicom's and the NES's Audio Path</a></div><div style="float: right;"><a href="./viewtopic.php?p=205685#p205685"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Oct 08, 2017 12:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Rather than BJT tomfoolery, it's probably better to just pretend we're going to use a digitally controlled potentiometer. Then it's a lot easier to see what's going on:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pin1 -- 20k --+<br />pin2 -- 12k --+-- 1uf -- rest of audio hardware<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; +-- 20k --+<br />&nbsp; &nbsp; |<br />&nbsp; &nbsp;pot<br />&nbsp; &nbsp; |<br />&nbsp; &nbsp;gnd<br /></div><br /><br />Quickly playing around with falstad's circuit simulator, assuming pin1 is a 150mV(max) square wave and pin2 is just 100Î© to ground, adjusting the pot between 0 and âˆž yields 41mVpp to 56mVpp ... that's not very good, only a couple dB<br /><br />That 20k resistor is a pain.<br /><br />Fine, so we add a <a href="https://en.wikipedia.org/wiki/Negative_impedance_converter" class="postlink">negative impedance converter</a> to undo the 20k that we can't get rid of. <s>It&#39;ll require that we synthesize a negative voltage, but this already crazy analogland, so whatever.</s><br /><br />And, yup: that lets us get an arbitrary volume attenuation. Synthesizing a different regulated choice of &quot;ground&quot; for the NIC other than 0V should make it possible to not need sophisticated power circuitry to create a negative voltage:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pin1 -- 20k --+<br />pin2 -- 12k --+-- 1uf -- rest of audio hardware<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; +-- 20k --+<br />&nbsp; &nbsp; |<br />&nbsp; &nbsp; +-- pot --+<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; |&nbsp; |\&nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; +--|+ \&nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &gt;-+<br />&nbsp; &nbsp; +--|- /&nbsp; &nbsp;|<br />&nbsp; &nbsp; |&nbsp; |/&nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; +-- 10k --+<br />&nbsp; &nbsp; |<br />&nbsp; &nbsp; +-- 10k -- Vreg<br /></div> A 20k pot here would become a -20k pot. When set to -20k, we've magically made a 0 ohm resistor and attenuation is â‰ˆinfinite. When set to 0, it's only 3dB (20Â·log<sub>10</sub>(56Ã·41)) quieter than without this add-on hardware.<br /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'm a little confused how one would integrate expansion audio channels and master volume at the same time in terms of the PWM DAC's output level calculation.<br /></div>The math becomes gross but it should still be doable. An electrically super simple and lazy option would be to replace Vreg with the external mixed in audio signal, but the mixing equation becomes a little weird.<br /><br />â€”<br /><br />If we're going to be <em>even more</em> completely ridiculous, a NIC allows us to multiply the complex reactances of three different passives. By changing some of them to have some imaginary component (e.g. a capacitor or inductor) we can instead have a programmatically controlled high-/low- pass audio filter.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=9&amp;t=56&amp;start=15"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=56"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 25 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=9&amp;t=56&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=9&amp;t=56">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="56" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9" selected="selected">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
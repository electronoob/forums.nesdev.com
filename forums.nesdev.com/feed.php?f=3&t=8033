<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=8033" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2011-08-10T18:34:02-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=8033</id>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2011-08-10T18:34:02-07:00</updated>
<published>2011-08-10T18:34:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82688#p82688</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82688#p82688"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82688#p82688"><![CDATA[
<div class="quotetitle">cpow wrote:</div><div class="quotecontent"><br />That's probably from his log.<br /></div><br /><br />Sometimes you make me feel a fool. Anyway, it's from <em>blargg_nes_cpu_test5.zip</em> package. Quote from readme:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />NES CPU Tests<br />-------------<br />These test most of the instruction behavior fairly thoroughly, including unofficial instructions. Failing instructions are listed by their opcode and name. Serious errors in basic opcodes might cause massive erroneous errors.<br /><br />cpu.nesTests all instructions<br />official.nesTests official only<br /><br />Most instructions are tested by setting many combinations of input values for registers, flags, and memory, running the instruction under test, then updating a running checksum with the resulting values. After trying all interesting input combinations, the checksum is compared with the correct one (what a NES gives) to find if the instruction passed.<br /><br />This approach makes it very easy to write the tests, since the instructions don't have to be each coded for separately; instead, only the different addressing modes need separate tests.<br /></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Wed Aug 10, 2011 6:34 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[cpow]]></name></author>
<updated>2011-08-09T19:05:14-07:00</updated>
<published>2011-08-09T19:05:14-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82635#p82635</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82635#p82635"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82635#p82635"><![CDATA[
<div class="quotetitle">tineras wrote:</div><div class="quotecontent"><br /><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">Yeah, I could reproduce your bug in my emulator. It's "cool". <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Anyway, you said that your emu gets a "Passed" in the CPU test ROM. Well, I get the error:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">unknown opcode FF trapped at PC 0200!</div><br /></div><br /><br />Which CPU test rom is that from?</div><br /><br />That's probably from his log.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3705">cpow</a> — Tue Aug 09, 2011 7:05 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-09T18:42:52-07:00</updated>
<published>2011-08-09T18:42:52-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82634#p82634</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82634#p82634"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82634#p82634"><![CDATA[
<div class="quotetitle">Zepper wrote:</div><div class="quotecontent"><br />Yeah, I could reproduce your bug in my emulator. It's "cool". <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Anyway, you said that your emu gets a "Passed" in the CPU test ROM. Well, I get the error:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">unknown opcode FF trapped at PC 0200!</div><br /></div><br /><br />Which CPU test rom is that from?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Tue Aug 09, 2011 6:42 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2011-08-09T18:41:00-07:00</updated>
<published>2011-08-09T18:41:00-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82633#p82633</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82633#p82633"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82633#p82633"><![CDATA[
Yeah, I could reproduce your bug in my emulator. It's "cool". <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Anyway, you said that your emu gets a "Passed" in the CPU test ROM. Well, I get the error:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">unknown opcode FF trapped at PC 0200!</div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Aug 09, 2011 6:41 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-09T07:40:57-07:00</updated>
<published>2011-08-09T07:40:57-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82623#p82623</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82623#p82623"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82623#p82623"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />At first, this is what I thought: SMB1 decodes its maps to a 32x13-metatile sliding window. The left half is at $500-$5CF (which corresponds to PPU $2000-$23FF) and the right half at $5D0-$69F (which corresponds to PPU $2400-$27FF). It might decide which half to start at based on uninitialized memory; the results should be the same no matter which half it starts at. Why it uses $500 and $5D0 as opposed to $500 and $600, with the data between $5D0 and $5FF used for something else, is anybody's guess. It adds a cycle penalty to most accesses of the right side of the window.<br /><br />But now that I've reread the hex editor screenshots and seen the working solution, I realize that they're off by $100, not $D0 as I originally thought when skimming the first posts.<br /></div><br /><br />I can always count on someone here to know WAY too much about how a particular game works!  <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />-----<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Tue Aug 09, 2011 7:40 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2011-08-09T07:14:40-07:00</updated>
<published>2011-08-09T07:14:40-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82618#p82618</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82618#p82618"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82618#p82618"><![CDATA[
At first, this is what I thought: SMB1 decodes its maps to a 32x13-metatile sliding window. The left half is at $500-$5CF (which corresponds to PPU $2000-$23FF) and the right half at $5D0-$69F (which corresponds to PPU $2400-$27FF). It might decide which half to start at based on uninitialized memory; the results should be the same no matter which half it starts at. Why it uses $500 and $5D0 as opposed to $500 and $600, with the data between $5D0 and $5FF used for something else, is anybody's guess. It adds a cycle penalty to most accesses of the right side of the window.<br /><br />But now that I've reread the hex editor screenshots and seen the working solution, I realize that they're off by $100, not $D0 as I originally thought when skimming the first posts.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Tue Aug 09, 2011 7:14 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-08T21:23:41-07:00</updated>
<published>2011-08-08T21:23:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82606#p82606</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82606#p82606"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82606#p82606"><![CDATA[
<div class="quotetitle">3gengames wrote:</div><div class="quotecontent"><br />Maybe there's a typo in you're code where it adds ram offsets or something.<br /></div><br /><br />It's just odd because the other data is in the correct place.  Like what is seen at 0x5B0.<br /><br />Also, my reads and writes are very straight forward.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if &#40;addr &lt; 0x2000&#41;<br />&#123;<br />    // Write<br />    memCPU&#91;addr &amp; 0x07FF&#93; = data;<br />&#125;<br /><br /><br />if &#40;addr &lt; 0x2000&#41;<br />&#123;<br />    // Read<br />    return memCPU&#91;addr &amp; 0x07FF&#93;;<br />&#125;</div><br /><br /><br />Not sure what is happening.  But this gives me more to chew on.<br />-----<br /><br />EDIT: This has been RESOLVED. See first post.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Mon Aug 08, 2011 9:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[3gengames]]></name></author>
<updated>2011-08-08T21:18:09-07:00</updated>
<published>2011-08-08T21:18:09-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82605#p82605</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82605#p82605"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82605#p82605"><![CDATA[
Maybe there's a typo in you're code where it adds ram offsets or something.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4311">3gengames</a> — Mon Aug 08, 2011 9:18 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-08T21:16:26-07:00</updated>
<published>2011-08-08T21:16:26-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82604#p82604</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82604#p82604"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82604#p82604"><![CDATA[
<div class="quotetitle">Dwedit wrote:</div><div class="quotecontent"><br />SMB1 checks if the high score consists of valid digits as its way of detecting a warm start.  If it's a warm start, it keeps the high score, second quest flag, and continue world (A+START world).<br /><br />But I'm far more interested in a trace log starting with an A button press from the ground, than from bootup.  Sure, exact instructions executed will vary depending on time you started (music, etc...).<br />Or maybe just replay the demo, that means you can get something consistent.<br /></div><br /><br />I took a break from logs to look at the RAM dumps from when the level starts.  It is obvious looking at the dumps that the objects (blocks, pipes, etc.) are being written to a different place in RAM.  They are off by 0x100.<br /><br /><img src="https://lh5.googleusercontent.com/-MQi5r6opQXY/TkCzp96J2rI/AAAAAAAAAjQ/bFlyPSWOsRs/s640/dumps.jpg" alt="Image" /><br /><br />The items in the blue squares are the bricks and question blocks at the beginning of the level.  In both cases, I dumped the memory right after starting the game without moving.<br /><br />Now I just need to figure out why they are off?!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Mon Aug 08, 2011 9:16 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dwedit]]></name></author>
<updated>2011-08-08T20:53:43-07:00</updated>
<published>2011-08-08T20:53:43-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82603#p82603</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82603#p82603"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82603#p82603"><![CDATA[
SMB1 checks if the high score consists of valid digits as its way of detecting a warm start.  If it's a warm start, it keeps the high score, second quest flag, and continue world (A+START world).<br /><br />But I'm far more interested in a trace log starting with an A button press from the ground, than from bootup.  Sure, exact instructions executed will vary depending on time you started (music, etc...).<br />Or maybe just replay the demo, that means you can get something consistent.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=53">Dwedit</a> — Mon Aug 08, 2011 8:53 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[3gengames]]></name></author>
<updated>2011-08-08T19:58:46-07:00</updated>
<published>2011-08-08T19:58:46-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82601#p82601</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82601#p82601"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82601#p82601"><![CDATA[
They probably use that as a "warm start" or cold start" flag or something. Doesn't have to be written to during that beginning of the program, you ca always reset it. But considering no matter what that value is the same thing always happens, I don't know what the hell it's doing.  <img src="http://forums.nesdev.com/images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4311">3gengames</a> — Mon Aug 08, 2011 7:58 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[NickMass]]></name></author>
<updated>2011-08-08T19:40:48-07:00</updated>
<published>2011-08-08T19:40:48-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82600#p82600</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82600#p82600"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82600#p82600"><![CDATA[
It appears that FCEXU initializes 0x0000 - 0x0800 to a repeating value of 00, 00, 00, 00, FF, FF, FF, FF. This really shouldn't matter however as I can't think of any games that rely on uninitialized RAM values and Super Mario Bros. should certainly work with everything initialized to 00.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4318">NickMass</a> — Mon Aug 08, 2011 7:40 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-08T19:30:12-07:00</updated>
<published>2011-08-08T19:30:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82599#p82599</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82599#p82599"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82599#p82599"><![CDATA[
<div class="quotetitle">3gengames wrote:</div><div class="quotecontent"><br />In memory, the PRG-ROM is read from 8000-FFFF. This is just reading from RAM. And what it's reading from in that is just RAM. RAM is data exactly like ROM except the program its self changes it.<br /></div><br /><br />I expect that, but there is nowhere before that point that the program has changed the data at that address.  What I pasted is the entire contents of the program up until that point (with the exception of waiting for VBlank).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Mon Aug 08, 2011 7:30 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[3gengames]]></name></author>
<updated>2011-08-08T19:26:34-07:00</updated>
<published>2011-08-08T19:26:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82598#p82598</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82598#p82598"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82598#p82598"><![CDATA[
In memory, the PRG-ROM is read from 8000-FFFF. This is just reading from RAM. And what it's reading from in that is just RAM. RAM is data exactly like ROM except the program its self changes it.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4311">3gengames</a> — Mon Aug 08, 2011 7:26 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tineras]]></name></author>
<updated>2011-08-08T19:21:39-07:00</updated>
<published>2011-08-08T19:21:39-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82597#p82597</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82597#p82597"/>
<title type="html"><![CDATA[Sanity check on my CPU code (resolved)]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=8033&amp;p=82597#p82597"><![CDATA[
<div class="quotetitle">Dwedit wrote:</div><div class="quotecontent"><br />FCEUX does it, it's called the "Trace Logger", under the debug menu.<br /></div><br /><br />I changed my formatting to look similar *enough* to that of FCEUX.  As I follow the logging in SMB, this is what I get:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">$8000:78        SEI                        A:00 X:00 Y:00 S:00 P:nvubdIzc<br />$8001:D8        CLD                        A:00 X:00 Y:00 S:00 P:nvubdIzc<br />$8002:A9 10     LDA #$10                   A:00 X:00 Y:00 S:00 P:nvubdIzc<br />$8004:8D 00 20  STA $2000 = #$00           A:10 X:00 Y:00 S:00 P:nvubdIzc<br />$8007:A2 FF     LDX #$FF                   A:10 X:00 Y:00 S:00 P:nvubdIzc<br />$8009:9A        TXS                        A:10 X:FF Y:00 S:00 P:NvubdIzc<br />$800A:AD 02 20  LDA $2002 = #$10           A:10 X:FF Y:00 S:FF P:NvubdIzc<br />$800D:10 FB     BPL $800A                  A:10 X:FF Y:00 S:FF P:nvubdIzc<br />$800A:AD 02 20  LDA $2002 = #$10           A:10 X:FF Y:00 S:FF P:nvubdIzc<br /><br />~25000 lines of waiting for VBLANK<br /><br />$800F:AD 02 20  LDA $2002 = #$90           A:10 X:FF Y:00 S:FF P:nvubdIzc<br />$8012:10 FB     BPL $800F                  A:90 X:FF Y:00 S:FF P:NvubdIzc<br />$8014:A0 FE     LDY #$FE                   A:90 X:FF Y:00 S:FF P:NvubdIzc<br />$8016:A2 05     LDX #$05                   A:90 X:FF Y:FE S:FF P:NvubdIzc<br />$8018:BD D7 07  LDA $07D7,X @ $07DC = #$FF A:90 X:05 Y:FE S:FF P:nvubdIzc   &lt;-- I read 0x00 here instead of 0xFF...<br />$801B:C9 0A     CMP #$0A                   A:FF X:05 Y:FE S:FF P:NvubdIzc<br />$801D:B0 0C     BCS $802B                  A:FF X:05 Y:FE S:FF P:NvubdIzC<br />$802B:20 CC 90  JSR $90CC                  A:FF X:05 Y:FE S:FF P:NvubdIzC<br />$90CC:A2 07     LDX #$07                   A:FF X:05 Y:FE S:FD P:NvubdIzC</div><br /><br />Why is there data at address $07DC?  I was under the impression that when I read a rom, that the PRG contents are written to 0x8000-0xFFFF and the CHR contents are written into 0x0000-0x1FFF of VRAM (this is oversimplified, I know).  Aside from that, I thought there was no data that was placed into memory.  The readout from the CPU RAM of FCEUX has (0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0xFF) repeating from address 0x0000-0x1FFF.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4449">tineras</a> — Mon Aug 08, 2011 7:21 pm</p><hr />
]]></content>
</entry>
</feed>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=2&amp;t=3958" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2008-03-13T21:03:25-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=2&amp;t=3958</id>
<entry>
<author><name><![CDATA[BMF54123]]></name></author>
<updated>2008-03-13T21:03:25-07:00</updated>
<published>2008-03-13T21:03:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31634#p31634</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31634#p31634"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31634#p31634"><![CDATA[
Mine tends to fail if I don't play it for a long period of time, though this is likely an entirely different issue. <img src="http://forums.nesdev.com/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=935">BMF54123</a> — Thu Mar 13, 2008 9:03 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[dvdmth]]></name></author>
<updated>2008-03-11T11:57:36-07:00</updated>
<published>2008-03-11T11:57:36-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31598#p31598</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31598#p31598"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31598#p31598"><![CDATA[
<div class="quotetitle">Bananmos wrote:</div><div class="quotecontent"><br />Hmm... I wonder if the PowerPak suffers from this as well, since it will often fail at power-up, just showing a single-colored screen.<br /></div><br />No, the PowerPak waits three VBlanks in the reset code.  It also initializes the FPGA before doing anything with the PPU, which adds further delay.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=360">dvdmth</a> — Tue Mar 11, 2008 11:57 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bananmos]]></name></author>
<updated>2008-03-10T14:55:25-07:00</updated>
<published>2008-03-10T14:55:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31592#p31592</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31592#p31592"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31592#p31592"><![CDATA[
Hmm... I wonder if the PowerPak suffers from this as well, since it will often fail at power-up, just showing a single-colored screen.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=106">Bananmos</a> — Mon Mar 10, 2008 2:55 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bregalad]]></name></author>
<updated>2008-03-10T12:39:24-07:00</updated>
<published>2008-03-10T12:39:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31591#p31591</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31591#p31591"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31591#p31591"><![CDATA[
At least Dragon Warrior tries to write to $2006 possibly only one frame after powerup (however, I don't know big the issue is if the write fail). The game seems to write to pattern tables, even tough the game uses CHRROM, which has no effect, since /WR isn't even connected to cartridges with CHRROM. Weird.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=38">Bregalad</a> — Mon Mar 10, 2008 12:39 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[dvdmth]]></name></author>
<updated>2008-03-08T10:32:49-07:00</updated>
<published>2008-03-08T10:32:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31551#p31551</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31551#p31551"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31551#p31551"><![CDATA[
Does the VRAM address start out at $0001 after reset, or just after power?<br /><br />Are any registers besides $2002 and $2007 usable before the end of the first VBlank period?<br /><br />What is the initial state of the other $2002 bits (sprite hit and overflow)?<br /><br />In short, how are all of the PPU registers set at power and/or reset?<br /><br />Incidentally, some commercial games I looked at write zero to $2000 and $2001 repeatedly within the $2002 warmup loop(s).  Also, one of the MMC5 games I examined watied much longer at this time (around 16 VBlanks IIRC).  Writing to $2000 and $2001 is probably more important with the Famicom than with the NES, since its state after reset is more volatile (I'm not sure if the Famicom PPU gets reset at all).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=360">dvdmth</a> — Sat Mar 08, 2008 10:32 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-08T09:31:34-07:00</updated>
<published>2008-03-08T09:31:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31548#p31548</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31548#p31548"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31548#p31548"><![CDATA[
<div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />So much for commercial games that write 0 to $2000 in their init code.<br /></div><br />Initializing these things is a good idea if one wants the code to be more compatible with NES clones (including inaccurate NES emulators). SEI, CLD, writing $00 to $2000, $2001, $4010, and $4015, $40 to $4017, and reading $4015 afterwards are all good ideas along these lines.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Sat Mar 08, 2008 9:31 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2008-03-08T09:11:48-07:00</updated>
<published>2008-03-08T09:11:48-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31546#p31546</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31546#p31546"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31546#p31546"><![CDATA[
<div class="quotetitle">blargg wrote:</div><div class="quotecontent"><br />Writes to $2000 before +29658 are also ignored, so NMI can't be used immediately either.<br /></div><br />So much for commercial games that write 0 to $2000 in their init code. It's a good thing you're discovering this now before I start propagating half-truths in the tutorial that I've been working on. Thanks again for this research.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Mar 08, 2008 9:11 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2008-03-08T08:52:18-07:00</updated>
<published>2008-03-08T08:52:18-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31544#p31544</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31544#p31544"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31544#p31544"><![CDATA[
...or even if you need to (re)blow it. <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Sat Mar 08, 2008 8:52 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bregalad]]></name></author>
<updated>2008-03-08T08:15:57-07:00</updated>
<published>2008-03-08T08:15:57-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31542#p31542</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31542#p31542"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31542#p31542"><![CDATA[
<div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />For whatever reason, the VBL flag was set most of the time at power today. Does the game in question sometimes fail to work on a NES until reset is pressed?<br /></div><br />Anyway, if you have ever played real games with a real nes and an unmodified cartridge connector, you have to reset the system and re-inster the cartridge so many times before getting the game to work that it would be impossible to tell if this is due to hardware or software fault.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=38">Bregalad</a> — Sat Mar 08, 2008 8:15 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-08T07:29:20-07:00</updated>
<published>2008-03-08T07:29:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31540#p31540</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31540#p31540"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31540#p31540"><![CDATA[
This code sometimes allowed an IRQ through at power. It didn't at reset if the APU mode was $80 before reset, so a game with this sort of code at reset that used mode $80 exclusively would reset reliably, even if it failed at power. I used an APU-based timer to find out how long the two VBL loops waited total and it was usually ~27331 clocks, only occasionally ~57113.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">reset:<br />:   bit $2002   ; wait for VBL flag<br />    bpl :-<br />:   bit $2002   ; wait for VBL flag again<br />    bpl :-<br />    lda #$80<br />    sta $4017<br />    cli<br />    sei</div><br />For whatever reason, the VBL flag was set most of the time at power today. Does the game in question sometimes fail to work on a NES until reset is pressed?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Does NMI (lda #$80 sta $2000) work predictably before 30,000 CPU cycles? Or must programs spin on $2002 and potentially miss several vblanks in a row?<br /></div><br />A $2002 spin loop will never wait more than VBL period*2, since it can never suppress two VBL flag settings in a row. Writes to $2000 before +29658 are also ignored, so NMI can't be used immediately either. $2007 works immediately, just $2006 doesn't. So you can begin accessing VRAM $0001 upwards immediately (what PPUADDR powers up with).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Sat Mar 08, 2008 7:29 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2008-03-07T19:55:20-07:00</updated>
<published>2008-03-07T19:55:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31534#p31534</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31534#p31534"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31534#p31534"><![CDATA[
Very interesting. I decided to convert those timings from CPU cycles to NTSC scanlines, and I saw some interesting correlations:<br /><ul><li>If power-on to first true vblank is 27383 cycles, that's close to 241 lines. This would be expected if the PPU starts at the top left pixel, going through all 240 active lines and the post-render line. </li><li>If power-on to first successful VRAM transaction is 29658 cycles, that's close to 261 lines, ending at the pre-render line. </li></ul><br />Another thing you might want to check out: Spinning on $2002 might miss a vblank if the start of vblank and the $2002 read happen on exactly the same CPU cycle. Does NMI (lda #$80 sta $2000) work predictably before 30,000 CPU cycles? Or must programs spin on $2002 and potentially miss several vblanks in a row?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Mar 07, 2008 7:55 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Celius]]></name></author>
<updated>2008-03-07T13:42:51-07:00</updated>
<published>2008-03-07T13:42:51-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31519#p31519</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31519#p31519"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31519#p31519"><![CDATA[
Funny you should mention this, because when I started to really understand most things about NESdev, I decided to wait 3 Vblanks instead of 2 to be safe. So ever since then, I've waited 3 Vblanks, and now I know I should  <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /> .<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=138">Celius</a> — Fri Mar 07, 2008 1:42 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2008-03-07T13:42:10-07:00</updated>
<published>2008-03-07T13:42:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31518#p31518</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31518#p31518"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31518#p31518"><![CDATA[
The game in question is either Ironsword, Time Lord, or something like that.  The reason VBL status at powerup matters in that case is because the game does a warm up loop where it waits for it to be set twice <em>before</em> writing to $4017.  Also it doesn't disable IRQs when it writes to $4017, it simply switches to the 5-step mode -- but since it doesn't disable or acknowledge them, if an IRQ tripped before it switched modes, that IRQ will be pending for the whole game which causes it to muck up.<br /><br />If VBL is clear at powerup, then the game effectively waits two full frames at startup (or at least more than one full frame) which ensures a frame IRQ will trip.  But if VBL is set, then it will only wait for one full frame (or less) making it still possible to slip the mode change in before the IRQ happens.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Fri Mar 07, 2008 1:42 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-07T12:59:25-07:00</updated>
<published>2008-03-07T12:59:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31516#p31516</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31516#p31516"/>
<title type="html"><![CDATA[PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31516#p31516"><![CDATA[
$4017 controls the APU IRQ. That's unrelated to the PPU and the VBL flag.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Fri Mar 07, 2008 12:59 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[dvdmth]]></name></author>
<updated>2008-03-07T12:34:09-07:00</updated>
<published>2008-03-07T12:34:09-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31515#p31515</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31515#p31515"/>
<title type="html"><![CDATA[Re: PPU warmup is real]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3958&amp;p=31515#p31515"><![CDATA[
<div class="quotetitle">blargg wrote:</div><div class="quotecontent"><br />The VBL flag is set about half the time at power, and 11% of the time at reset (when reset is pressed while the flag is set, most likely).<br /></div><br />I thought there was a commercial game that required VBL to be set at power-up to boot, because it wrote $80 to $4017 to prevent frame IRQ's (which won't work if an IRQ is pending).  Are you saying this game will fail to boot 50% of the time at power-up?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=360">dvdmth</a> — Fri Mar 07, 2008 12:34 pm</p><hr />
]]></content>
</entry>
</feed>
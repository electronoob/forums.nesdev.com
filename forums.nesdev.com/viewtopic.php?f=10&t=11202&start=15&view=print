<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Garbled sprites on FDS</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Garbled sprites on FDS</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=11202">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=11202</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zycrow</b> [ Thu May 08, 2014 2:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, that answers some of our questions!  <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" /> <br /><br />To answer yours, I have been powering my FDS with batteries. I believe I have an AC Adaptor that would be usable, based on Famicom World's guide, but I haven't tried it as of yet.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Thu May 08, 2014 2:23 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The FDS AC adapter I have is the official one, with the following information:<br /><br />Input: AC 100V, 50/60Hz, 9VA<br />Output: DC 9V 400mA<br />Polarity: <a href="http://i.stack.imgur.com/zsp7C.png" class="postlink">Negative polarity</a>, i.e. positive outer, negative inner<br /><br />I use this on a standard US AC outlet without any problem (i.e. no 120V--&gt;100V step-down transformer).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Thu May 08, 2014 3:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Given my observation about how only some of the reflected sprites in SMB seem to be damaged ... I'm not convinced it's the disk drive.<br /><br />But if it's not been tickled using ordinary cartridges also... I don't know? Could it be voltage supply sag?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Thu May 08, 2014 3:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is it the same sprites every time, even between full system power-cycles?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zycrow</b> [ Thu May 08, 2014 9:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It is the same sprites every time, yes.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Tue May 13, 2014 5:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />For those following thread: plan of action is to send my working FDS, FDS RAM adapter, FDS AC adapter, and an FDS game (Kid Icarus) to Zycrow so he can mix-and-match working pieces with his own system in attempt to find out which piece is malfunctioning.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>LocalH</b> [ Wed May 14, 2014 9:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If the only thing that's ever corrupted are sprites (which seems to be the case), that would seem to point to an issue with the PPU (possibly some bad logic when reading sprite tile data?). However, the fact that the system works with cart games would seem to rule that out, as I'm not aware that SMB and SMB2 have too many differences in their handling of OAM that would manifest here. I would suggest checking the RAM adapter for a bad address line or similar, but koitsu has already made that moot.<br /><br />Not sure where the tiles are actually stored in CHR RAM for SMB2, but if it helps in deconding the relevant addresses, the incorrect tile in place of Mario's foot looks like the Mushroom Retainers' foot tile (which I'm pretty sure is also mirrored for both feet from the same tile). Perhaps it may be prudent to specifically check cart games that use CHR RAM? Games that use CHR ROM (like many early games) probably wouldn't exhibit the same problem in such a case.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zycrow</b> [ Wed May 14, 2014 10:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I haven't received Koitsu's FDS yet, but when I do, I'll post a report of what configurations I try and how it all looks.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zycrow</b> [ Sat May 17, 2014 9:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />OK, you guys ready for some weirdness? I got Koitsu's hardware in the mail yesterday and this morning I did some tests. <br />Here are the results:<br /><br />- My FDS with my RAM adapter (again): Garbling<br />- Koitsu's RAM adapter with my FDS: No garbling (tried all games)<br />- Koitsu's RAM adapter with his FDS: No garbling<br />- Koitsu's FDS with my RAM adapter: Garbling<br /><br />I haven't done any tests regarding power supplies, but I think the results show something pretty clearly here. The problem lies with my Famicom unit and my RAM adapter, since my RAM worked perfectly on Koitsu's system. Crazy!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>LocalH</b> [ Sat May 17, 2014 11:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />My suggestion is, if you have any of the games on <a href="http://bootgod.dyndns.org:7777/search.php?region_op=%3D%60%40%60&amp;region=Japan&amp;vram_op=%3E%60%40%60&amp;vram=0&amp;field=2&amp;order=asc&amp;rows=400&amp;rfa=1+2+11+3+9+20+41+53" class="postlink">this list</a> (which contains all Famicom carts with CHR RAM) is to test one of those games and see if you also have corruption. The only thing to throw a wrench into that line of reasoning is that your FC worked with koitsu's RAM adapter but not your own. That should rule out the FC itself, except for the fact that your RAM adapter worked on koitsu's FCs but not your own.<br /><br />Maybe it's an issue of dodgy pins on both your FC and your RAM adapter, but the pins aren't dodgy enough to fail when used with other hardware, but when used together you have a pin not making a connection at all. Sort of like how the Guitar Hero 3 guitars with removable necks inevitably get dodgy connector pins, but swapping necks can cause different behavior from the pins being worn differently.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sat May 17, 2014 12:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What if the timing on the RAM in the adapter is really borderline, perhaps due to slight undervoltage, and the extra time taken in the PPU to flip a sprite is enough to get from &quot;data arrived in time&quot; to &quot;didn't&quot; ?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat May 17, 2014 1:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />But does it really take extra time in the PPU to flip a sprite horizontally? I thought it'd be just a mux between the flipped version of the sliver and the not-flipped version, selected by the H bit of the sprite's attribute 2. Vertical flip is just an XOR gate between the line-within-sprite and the V bit.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat May 17, 2014 2:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Dang it -- this makes me wish I had sent you my Famicom AV (and AC adapter) as well.  I thought about doing that just as a &quot;worst-case scenario&quot;.<br /><br />It really sounds like there's something physical going on with the combination of your FDS RAM adapter and your Famicom.  It's probably something pin/edge-connector-related like what LocalH mentioned.<br /><br />Also, did you try your FDS + my FDS AC adapter + your FDS RAM adapter?  Part of me ponders voltage, since you're normally driving your FDS off of C batteries.<br /><br />Another test would involve $$, and that'd be getting yourself another Famicom to see if the problem goes away.<br /><br />This is where I wish all the hardware that's malfunctioning could be shipped to someone like, say, lidnariq or blargg to do all sorts of EE-related tests on it (dudes with oscilloscopes tend to be able to track strange things down, but I don't have the knowledge -- just a simple caveman... :-) )

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sat May 17, 2014 3:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So, if you exchange your RAM adapter with Koitsu's, you'll both end up with fully working FDSes, no ? Although it doesn't answer to why a particular combination doesn't work, honestly this is really crazy.<br /><br />Getting a new Famicom or FDS is expensive, but plain RAM Adapters are very common and cheap on EBay (or at least were last time I checked), so it shouldn't be too hard to have a solid stock of a few adapters if there is a need to.<br /><br />@koitsu : I honestly doubt this kind of problem would be &quot;easy&quot; to trace with an oscilloscope. You'd rather need a logic analyser and look at the timings on the CHR bus, but that equipment is much more expensive and complex to set up than a simple 2-trace analog oscilloscope.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat May 17, 2014 4:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled sprites on FDS</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />@Bregalad -- ahh okay. (See, EE isn't my thing... heh :-) )<br /><br />Yeah, I suppose a worthwhile thing to do would be to buy an FDS RAM adapter off eBay or somewhere and try it out (using Zycrow's Famicom + FDS).<br /><br />Part of me thinks it's got something to do with the edge connector contacts between the FDS RAM adapter and the Famicom, which could explain why Zycrow's FDS RAM adapter worked just fine on my Famicom AV.  I should have tried wiggling it or applying more pressure to it while it was inserted.  Zycrow, you might try that -- just try shifting around or applying a bit of pressure to your FDS RAM adapter while attached to your system (doesn't matter whose FDS from the sound of it).<br /><br />If a replacement FDS RAM adapter fixes the problem, then it might be possible to repair the questionable one by replacing the cartridge connector in it.<br /><br />For an unrelated yet equally bizarre-as-hell issue with someone's FDS RAM adapter, <a href="http://www.famicomworld.com/forum/index.php?topic=8353.0" class="postlink">check out this thread</a> at Famicomworld.  It starts getting interesting (and into specific models of chips in the FDS RAM adapter that are glitchy/buggy in some way?) at the 2nd page.  Ignore the crap on page 3 onward -- just adolescents fighting over nonsense -- although there is an interesting tidbit on page 5 (talking about FDS RAM adapters with two different kinds of CHR RAM chips I think).<br /><br />P.S. -- Zycrow, there was something I noticed about your FDS RAM adapter -- one of the screws in one of the corners looked like it wasn't screwed in all the way.  I didn't touch this/change it at all, but if you didn't open it then someone in the past may have, indicating someone may have tried to repair or fix something previously.  Totally speculative, but thought I'd mention it.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
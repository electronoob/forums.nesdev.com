<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Game Doesn't Run</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Newbie Help Center" href="http://forums.nesdev.com/feed.php?f=10" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Game Doesn't Run" href="http://forums.nesdev.com/feed.php?f=10&amp;t=5975" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '2');
	var per_page = '15';
	var base_url = './viewtopic.php?f=10&amp;t=5975';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun Sep 21, 2014 8:47 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=10&amp;t=5975&amp;start=15">Game Doesn't Run</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=5975"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 22 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=10&amp;t=5975&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=10&amp;t=5975">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=10&amp;t=5975&amp;start=15&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=10&amp;t=5975&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=10&amp;t=5975&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p55703"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55703"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55703#p55703"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 25, 2010 6:13 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 6694<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">After you fix the palette problem, there are a couple of other things you have to do: before enabling rendering, reset the scroll using $2005, or else the tiles you wrote to the name table will not be displayed at the location you want. The other thing is to wait for Vblank before enabling rendering so that this doesn't happen by the middle of the screen (even some commercial games failed to do this sometimes).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p55711"></a>
				<b class="postauthor">WJYkK</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55711"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55711#p55711"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 25, 2010 10:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Dec 24, 2009 12:23 am<br /><b>Posts:</b> 60<br /><b>Location:</b> Igloo and Bear Land (Canada)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Alright, another question: say I want to place a timer that's constantly ticking. I can't simply put it in an infinite loop that will write the tiles to the same spot, right? E.g:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tick:<br />&nbsp; &nbsp;lda $2002<br />&nbsp; &nbsp;lda #$20<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$5f<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$40<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;rts</div>I can't do this to place tile $40 onto spot $5f.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4164"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p55712"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55712"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55712#p55712"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jan 25, 2010 10:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 6694<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A NES game loop usually has the following structure:
<br />
<br />1. read input;
<br />2. update the game world;
<br />3. wait for VBlank;
<br />4. update video and audio;
<br />5. go back to 1;
<br />
<br />The timer has to be maintained as part of the game world. If your timer has seconds and minutes, and the NES runs at 60 frames per second, you have to modify your timer every 60 frames. You need a variable to count to 60, and when it reaches that number you modify the timer and start counting to 60 again. Later, during the video update part you write to the nametables whatever the timer holds.
<br />
<br />Here's an example of a timer that can go up to 59 minutes and 59 seconds (then it wraps back to 00:00). The first part is the initialization, where the timer is cleared:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda #0<br />&nbsp; &nbsp;sta Frames<br />&nbsp; &nbsp;sta SecondsOnes<br />&nbsp; &nbsp;sta SecondsTens<br />&nbsp; &nbsp;sta MinutesOnes<br />&nbsp; &nbsp;sta MinutesTens</div><br />It goes before the game loop. Then, somewhere inside the game loop you have to update the timer:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;inc Frames<br />&nbsp; &nbsp;lda Frames<br />&nbsp; &nbsp;cmp #60<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;ldx #0<br /><br />&nbsp; &nbsp;stx Frames<br />&nbsp; &nbsp;inc SecondsOnes<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondOnes<br />&nbsp; &nbsp;inc SecondTens<br />&nbsp; &nbsp;lda SecondTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondTens<br />&nbsp; &nbsp;inc MinutesOnes<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesOnes<br />&nbsp; &nbsp;inc MinutesTens<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesTens<br />Done:</div><br />The code is somewhat long when the timer is split in individual digits, but this makes it easier to draw the numbers later (the other option would be to convert from binary to decimal, and that's kinda hard/slow on the NES).<br /><br />The last thing to do is draw the numbers to the nametables during VBlank:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda #$20<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$5f<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda #TIME_SEPARATOR<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007</div>
<br />"NUMBERS_BASE" is the index of the tile that holds the number "0", we need to add the values to it so that the numbers are displayed using the correct tiles (of course you must have "1" through "9" following the "0"). If the "0" is at tile number 0 you can skip those ADCs. "TIME_SEPARATOR" is the index of the tile that will stay between the minutes and the seconds.
<br />
<br />Anyway, I don't usually write code to answer questions, but in this case I though it could help you understand a bit of how games work. Almost everything else in the game (such as the main character, the enemies, etc) will work somewhat like this, they'll have to be initialized, updated every frame, and drawn during VBlank.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p55884"></a>
				<b class="postauthor">WJYkK</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55884"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55884#p55884"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 29, 2010 12:54 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Dec 24, 2009 12:23 am<br /><b>Posts:</b> 60<br /><b>Location:</b> Igloo and Bear Land (Canada)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, so I did the following and it doesn't work:
<br />
<br />I placed this code after the second wait for VBLANK and before all of the <em>jsr</em> instructions:<div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;Frames=0<br />&nbsp; &nbsp;SecondsOnes=0<br />&nbsp; &nbsp;SecondsTens=0<br />&nbsp; &nbsp;MinutesOnes=0<br />&nbsp; &nbsp;MinutesTens=0<br />&nbsp; &nbsp;NUMBERS_BASE=48<br />&nbsp; &nbsp;TIME_SEPARATOR=58</div>NUMBERS_BASE and TIME_SEPARATOR relate to 0 and : because I arranged my symbols by ASCII codes.<br /><br />Next, this is my main loop:<div class="codetitle"><b>Code:</b></div><div class="codecontent">loop:<br />&nbsp; &nbsp;inc Frames<br />&nbsp; &nbsp;lda Frames<br />&nbsp; &nbsp;cmp #60<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;ldx #0<br /><br />&nbsp; &nbsp;stx Frames<br />&nbsp; &nbsp;inc SecondsOnes<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondsOnes<br />&nbsp; &nbsp;inc SecondsTens<br />&nbsp; &nbsp;lda SecondsTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondsTens<br />&nbsp; &nbsp;inc MinutesOnes<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesOnes<br />&nbsp; &nbsp;inc MinutesTens<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesTens<br />Done:&nbsp; &nbsp;jmp loop</div><br /><br />And finally, I place this after my HUD and before the attribute table formation:<div class="codetitle"><b>Code:</b></div><div class="codecontent">temp_bg:<br />&nbsp; &nbsp;lda #$20<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$60<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda #TIME_SEPARATOR<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007</div>After compilation, the HUD is still displayed but the timer doesn't work; it's not being displayed at all. Maybe I'm placing the code in the wrong place or missing something obvious?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4164"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p55885"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55885"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55885#p55885"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 29, 2010 1:40 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 6694<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">WJYkK wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;Frames=0<br />&nbsp; &nbsp;SecondsOnes=0<br />&nbsp; &nbsp;SecondsTens=0<br />&nbsp; &nbsp;MinutesOnes=0<br />&nbsp; &nbsp;MinutesTens=0</div></div><br />This is wrong, because what the assembler understands from this is that all of these variables will use memory location $00. You can imagine that the logic will fail completely in this case. Each of them must use a different memory location:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;.enum $0000<br /><br />Frames .dsb 1<br />SecondsOnes .dsb 1<br />SecondsTens .dsb 1<br />MinutesOnes .dsb 1<br />MinutesTens .dsb 1<br /><br />&nbsp; &nbsp;.ende</div><br />I believe you can place this anywhere, but it makes more sense before the actual program, at the top of the source file. This is the best way to declare variables, because it's easy to move them around, remove them or add others as necessary. I suggest you declare all your variables inside ".enum" blocks. Then, before the main loop you clear these variables like <strong>I told you to before</strong>:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda #0<br />&nbsp; &nbsp;sta Frames<br />&nbsp; &nbsp;sta SecondsOnes<br />&nbsp; &nbsp;sta SecondsTens<br />&nbsp; &nbsp;sta MinutesOnes<br />&nbsp; &nbsp;sta MinutesTens</div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;NUMBERS_BASE=48<br />&nbsp; &nbsp;TIME_SEPARATOR=58</div>NUMBERS_BASE and TIME_SEPARATOR relate to 0 and : because I arranged my symbols by ASCII codes.</div><br />This is correct, because these are constants. But it also makes more sense to declare them at the top of the file, so that all your declarations are easy to find and not scattered across the whole program.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Next, this is my main loop:<div class="codetitle"><b>Code:</b></div><div class="codecontent">loop:<br />&nbsp; &nbsp;inc Frames<br />&nbsp; &nbsp;lda Frames<br />&nbsp; &nbsp;cmp #60<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;ldx #0<br /><br />&nbsp; &nbsp;stx Frames<br />&nbsp; &nbsp;inc SecondsOnes<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondsOnes<br />&nbsp; &nbsp;inc SecondsTens<br />&nbsp; &nbsp;lda SecondsTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx SecondsTens<br />&nbsp; &nbsp;inc MinutesOnes<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesOnes<br />&nbsp; &nbsp;inc MinutesTens<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;cmp #6<br />&nbsp; &nbsp;bne Done<br /><br />&nbsp; &nbsp;stx MinutesTens<br />Done:&nbsp; &nbsp;jmp loop</div></div><br />The problem is that you are jumping back right after updating the timer, which means that the timer will update several times in a single frame (it will run MUCH faster than an actual clock), while you have to update it only once. The program will also be stuck in this loop forever, as there is no way of getting out of it. And since you're stuck in this loop you are never going to write the numbers to the screen.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">And finally, I place this after my HUD and before the attribute table formation:<div class="codetitle"><b>Code:</b></div><div class="codecontent">temp_bg:<br />&nbsp; &nbsp;lda #$20<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$60<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;lda MinutesTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda MinutesOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda #TIME_SEPARATOR<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsTens<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;lda SecondsOnes<br />&nbsp; &nbsp;adc #NUMBERS_BASE<br />&nbsp; &nbsp;sta $2007</div></div><br />This part of the code has nothing to do with the inial drawing of the screen. The initial screen will be drawn normally, before the game loop, but the piece of code above must run EVERY VBlank, not only once, so it must be part of your main loop.<br /><br />See, this is what you should have as your main loop:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">loop:<br /><br />&nbsp; &nbsp;;CODE TO UPDATE THE TIMER GOES HERE<br /><br />&nbsp; &nbsp;jsr wait_for_vblank<br /><br />&nbsp; &nbsp;;CODE THAT DRAWS THE TIMER TO THE SCREEN GOES HERE<br /><br />&nbsp; &nbsp;;CODE THAT RESETS THE SCROLL GOES HERE<br /><br />&nbsp; &nbsp;jmp loop</div><br />I omitted the huge blocks of code because they all look correct, there's no reason for me to copy/paste them, so I just marked where they should go.<br /><br />Remember what I told you about the structure of a game loop. First you update the state of the whole game world (this includes your timer), then you wait for VBlank, and then you do your graphical updates.<br /><br />You have to program the "wait_for_vblank" subroutine. A very good example was posted <a href="http://nesdev.com/bbs/viewtopic.php?p=55745#55745" class="postlink">here</a> by tepples. Note that you have to declare the "vblank" variable (you don't have to call it "vblank", you can call it whatever you want) and modify your NMI handler:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">nmi:<br />&nbsp; &nbsp;inc vblank<br />&nbsp; &nbsp;rti</div>
<br />And of course, since you will be using NMIs you must make sure to enable them before the main loop starts (it seems you already are, so don't worry).
<br />
<br />Resetting the scroll is just selecting the visible name table through $2000 and writing the pixel offsets to $2005. I didn't post any code because it's you who decides what part of the name tables you want to show (make sure to show the part where the numbers are written to!).
<br />
<br />I guess this is it. Try to think a little about the order in which you are doing things, think about it logically and you should come to a conclusion about what makes sense. Don't just copy and paste code around hoping for the best, that never works.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p55888"></a>
				<b class="postauthor">WJYkK</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55888"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55888#p55888"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 29, 2010 2:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Dec 24, 2009 12:23 am<br /><b>Posts:</b> 60<br /><b>Location:</b> Igloo and Bear Land (Canada)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ha, I never thought actually putting all these <em>jsr</em>s in the loop. I guess that makes sense, but I thought NES logic was different. Thanks for clarifying that.
<br />
<br />And actually, I didn't directly copy-pasted the code as I previously thought up of other methods that didn't work, but then again, the <em>jsr</em>s were not in the main loop. <img src="./images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4164"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p55894"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p55894"></a></div><div style="float: right;"><a href="./viewtopic.php?p=55894#p55894"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 29, 2010 2:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 6694<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Uh... the JSRs are not supposed to be in the main loop. So far, only the routine that waits for VBlank k is called inside the main loop. The JSRs you had before were used for drawing the screen, and that should be done before the main loop, like it is now.
<br />
<br />Vblank time is very limited, so you only have time to draw what has changed since last frame, which is why the code I wrote only rewrote the timer (the only thing constantly changing). You can't redraw the whole screen every time because there is no time, and if you try you'll get corrupt video.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=10&amp;t=5975&amp;start=15"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=5975"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 22 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=10&amp;t=5975&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=10&amp;t=5975">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="5975" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10" selected="selected">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
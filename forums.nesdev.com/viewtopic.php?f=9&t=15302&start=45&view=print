<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Pirate Kid Dracula reverse engineering</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Pirate Kid Dracula reverse engineering</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=15302">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=15302</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>4</strong> of <strong>5</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Tue Jan 03, 2017 8:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It looks like Nestopia, also, only supports M2- and PPUA12- based IRQs. I have no idea if any existing emulator can support this mapper hack authentically.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Wed Jan 04, 2017 5:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hey, looks like it's emulation is troublesome!!<br /><br />Just a small epilogue... when I bought it, the vendor <a href="http://produto.mercadolivre.com.br/MLB-791691798-dracula-kid-nes-72-pinos-pi-_JM" class="postlink">sold me</a> cheaper because it was &quot;defective&quot;:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> KidDrac defect</span><br />
		
			<a href="./download/file.php?id=7480&amp;mode=view"><img src="./download/file.php?id=7480&amp;t=1" alt="dracula-kid-nes-72-pinos-pi-D_NQ_NP_449405-MLB25022752776_082016-F.png" /></a><br />
			<span class="gensmall">dracula-kid-nes-72-pinos-pi-D_NQ_NP_449405-MLB25022752776_082016-F.png [ 1.16 MiB | Viewed 1969 times ]</span>
		

		<br />
	</div><br />I took the risk and bought it anyway, since it was playable at least.<br />I tested it in a couple of clones and this supposed deffect never showd up.<br />Looks like the defect was on his console, who knows...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Sun Jan 08, 2017 1:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Still can't working.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Mon Jan 09, 2017 7:40 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />joe,can you working fine?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Punch</b> [ Thu Jan 12, 2017 1:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fisher wrote:</div><div class="quotecontent">So it was kind of &quot;Metal Gear&quot; stealth action to hide myself and try to do at least part of the job.<br /></div><br /><br />I think that it's more of a Splinter Cell scenario in your case, <em>Fisher.</em><br /><br /><br /><span style="font-size: 85%; line-height: normal">sorry</span>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Joe</b> [ Thu Jan 12, 2017 2:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">zxbdragon wrote:</div><div class="quotecontent">joe,can you working fine?</div><br />Is there an emulator that can use PPU A13 to generate IRQs? (MMC3 uses PPU A12 to generate IRQs.)<br /><br />Otherwise, you can use a hack to generate one IRQ for every two scanlines (count += 43 on each scanline), but timing won't be correct.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Fri Jan 13, 2017 2:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> I think that it's more of a Splinter Cell scenario in your case, Fisher.</div><br />Oh yeah! <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> <br />People keep saying I should play that series of games, and  I always keep forgotting. <img src="./images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /> <br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">sorry</div><br />Don't feel sorry!<br />It was a joke, intended to someone else to laugh and joke too, like you did. <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> <br /><br />Joe and Zxbdragon, I think proper support for this pirate mapper would need a rewrite of the emulator's core. Would it?<br />For a user's perspective this would not do much difference, since the original game is already playable.<br />But the on the developer's side, it's the challenge of doing it properly that makes all the difference.<br />If I'm understanding properly what I've been reading, this is the fuel that keeps emulation community as a whole active.<br />So I say: Power to you guys! Don't give up.<br />As a old boss I had said: The impossible is only a little bit protracted. (hope I have translated it right)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Joe</b> [ Fri Jan 13, 2017 3:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fisher wrote:</div><div class="quotecontent">Joe and Zxbdragon, I think proper support for this pirate mapper would need a rewrite of the emulator's core. Would it?</div><br />That depends on the emulator. I've only looked at FCEUX, and it doesn't provide any way for the mapper to track PPU A13. The easy hack would be to just trigger the IRQ every other scanline, but timing would be wrong. It may be possible to do it better using a combination of scanline and CPU-cycle counters in FCEUX, but that's more work than I'm willing to put into this (and probably still wouldn't be accurate).<br /><br />If there's an emulator core that has some way for the mapper to track the PPU A13 line, then I'll give it a shot.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Fri Jan 13, 2017 12:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nestopia's code base also seems to have only implemented support for PPU A12 and M2-based IRQs, even though the OO goo makes it look like it should be more useful... (&quot;What do you mean no one ever implemented Nst::Core::Timer::A13 ?&quot;)<br /><br />I strongly suspect the answer is &quot;no one has ever written support for that in an emulator because this is the first board documented to do this&quot;

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jan 13, 2017 1:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I thought MMC5's timer used three consecutive PPU reads with A13 low as the trigger to find the next scanline. What did I miss?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Fri Jan 13, 2017 1:59 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nestopia doesn't implement it that way.<br /><br />It implements the MMC5 IRQ by violating the abstraction around the PPU's H and V counters.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Wed Jan 18, 2017 3:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What is the difference between A13,A12?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jan 18, 2017 8:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />There are 341 dots in each scanline. The PPU reads memory every other dot, or 170 reads per scanline.<br />Normally, the PPU alternates between two nametable reads and two pattern table reads, performing 42 full sets of four reads each scanline.<br />When the PPU is reading the first pattern table, A12 and A13 are both low.<br />When the PPU is reading the second pattern table, A12 is high and and A13 is low.<br />When the PPU is reading nametables, A12 is low and and A13 is high.<br /><br />How an A12-based timer works: (MMC3)<br />The PPU performs 32 sets of reads for background, 8 sets of reads for sprites, and then 2 more sets of reads for the background to set up the next scanline. If a game puts background tiles in the first pattern table and sprite tiles in the second pattern table, then A12 will be low during nametable and background pattern fetches, which represent most of the line, and it will go high several times near the end of the scanline when the PPU is fetching sprite patterns. By watching for several successive reads with A12 low followed by a read with A12 high, the mapper can infer that a new scanline has started.<br /><br />How an A13-based timer might work:<br />Between one scanline and the next, the PPU's state machine pauses, causing it to read nametables four times in a row: the first of a set of four twice (ignored) plus the first two of the next set of four (used). By watching for several successive reads with A13 low, the mapper can infer that a new scanline has started.<br /><br />EDIT: MMC5 relies on the same phenomenon as an A13 spreader but compares the whole address instead of just watching A13.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Wed Jan 18, 2017 4:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This should be titled &quot;How the MMC5's scanline timer works&quot;:<br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Between one scanline and the next, the PPU's state machine pauses, causing it to read nametables four times in a row: two that don't belong to a set of four plus the first two of the next set of four. By watching for several successive reads with A13 low, the mapper can infer that a new scanline has started.</div><br /><br />This pirate port instead just counts falling edges of PPU A13, which happens during at the beginning of each pattern table fetches for both sprites and background tiles.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jan 18, 2017 4:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So I guess this must be the PA13 counterpart of the JY Company mapper (209 and its subsets 90 and 211), whose PA12 counter is followed by a division by 8 instead of a pulse spreader.<br /><br />M2 prescaler: VRC IRQ, JY Company<br />PA12 spreader: MMC3<br />PA12 prescaler: JY Company<br />PA13 spreader: <s>MMC5</s><br />PA13 prescaler: This<br /><br /><br />EDIT: Mistake stricken per Drag's result

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>4</strong> of <strong>5</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
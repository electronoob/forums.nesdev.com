<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Garbled graphics on Glory of Heracles</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Garbled graphics on Glory of Heracles</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9689">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9689</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Thu Jan 10, 2013 7:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">although briefly looking I don't see how to get in contact with DvD.</div><br />There's an email address at the bottom of their main page: dvdtranslations at yahoo dot com

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>getafixx</b> [ Thu Jan 10, 2013 7:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Bingo!!<br /><br />That did the trick. I wired in a 74HC00 I had from an old Genesis cart and the game works perfectly now   <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />Thanks for all your help guys!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>proveaux</b> [ Fri Jan 11, 2013 1:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">getafixx wrote:</div><div class="quotecontent">Bingo!!<br /><br />That did the trick. I wired in a 74HC00 I had from an old Genesis cart and the game works perfectly now   <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />Thanks for all your help guys!</div><br />Could you upload a pic of the board?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>getafixx</b> [ Fri Jan 11, 2013 3:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sure, here it is.<br /><br /><img src="http://retrostage.net/20130111_145139.png" alt="Image" /><br /><br />74'00 pin 3 connected to PRG pin 24<br />74'00 pin 1 connected to Cart connector 14<br />74'00 pin 7 connected to GND<br />74'00 pin 14 connected to VCC

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>proveaux</b> [ Sun Jan 20, 2013 7:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>DvD</b> [ Tue Mar 12, 2013 1:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">I'd rather debug the ROM in an emulator to make sure that all mapper writes are happening to ROM locations that contain the same value that's being written... =)</div><br />Just in case you're not familiar with bus conflicts: mapper commands are often &quot;masked&quot; as writes to PRG-ROM, because since the PRG-ROM obviously can't be written to, the writes are routed to the mapper instead. However, the ROM isn't disabled (in some mappers it is, but not this one), so it thinks it's being read, so it still outputs what's stored at the specific address that was written to. If the value being written is different than the one stored in the ROM, there's a bus conflict: two different values trying to use the same address lines at the same time.<br /><br />To avoid this issue, games had to make sure that mapper commands were sent to ROM locations that had the same value as the one being written, so it was common for them to have tables of consecutive values (i.e. $00, $01, $02, $03 and so on, until the largest value that could be written).<br /><br />The original Herakles no Eikou was only 128KB, so it had 8 PRG-ROM banks, and a bankswitch table with values from $00 to $06 (the last bank, $07, doesn't need to be switched in because it's hardwired to $C000-$FFFF). When they expanded the ROM, they didn't update the table, so whenever the higher banks (which they probably have used only for graphics) are accessed, the bus conflicts cause invalid banks to be selected.<br /><br />Maybe this should be brought to their attention. They need to either expand the bankswitch table or relocate it to a location where it can count up to $0E.<br /></div><br />Thanks for bringing this to my attention.  It may take a while, as I am busy with real life right now, but I will fix it if I can.  Of course, it never came up in any of our testing on any emu or flash cart or we would have dealt with with at the time.  I hate releasing more than one patch for a game...<br /><br />I appreciate your explanation of the issue, but I don't completely understand it.<br />For me to modify this, I need to understand this completely.<br />Could you better explain why it <strong>reads </strong> the ROM even though this is a <strong>write </strong> command?  Do all legitimate writes to RAM areas also do reads?<br /><br />More importantly, what I don't understand for this game is why the address being written to is $8040 not c56c thru c572... why they didn't do what I see done in other games that do this: sta $c56c,y<br />I don't see how the processor knows to view anything at the table at c56c just because it comes directly after the code that accesses it.<br /><br />I don't have the hardware to test it on, so I'd need to work with someone who does.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;--------------------<br />; UNROM_8000 = Y = Block_8000 = A<br />;--------------------<br />lbl_c565: sta $94&nbsp; &nbsp; &nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta $8040&nbsp; &nbsp; &nbsp;; UNROM_8000 = Y = vbl_94 = A<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rts&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Return&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;lbl_c56b:<br />;--------------------<br />; Table UNROM_Bank_0_6: C56C thru C572<br />; 7 bytes<br />;--------------------<br />_c56c:&nbsp; &nbsp; &nbsp; &nbsp;.byte $ 0&nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.byte $ 1&nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.byte $ 2&nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.byte $ 3&nbsp; &nbsp;;<br />C570:&nbsp; &nbsp; &nbsp; &nbsp; .byte $ 4&nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.byte $ 5&nbsp; &nbsp;;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.byte $ 6&nbsp; &nbsp;;<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Tue Mar 12, 2013 2:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">DvD wrote:</div><div class="quotecontent">I appreciate your explanation of the issue, but I don't completely understand it.<br />For me to modify this, I need to understand this completely.<br />Could you better explain why it <strong>reads </strong> the ROM even though this is a <strong>write </strong> command?  Do all legitimate writes to RAM areas also do reads?</div><br />All writes to ROM for UNROM or UOROM games are simultaneously reads. The ROM doesn't know to shut up when the NES is trying to write to it, so the game sees result of the CPU and ROM fighting.<br />This is usually the logical AND of the two bytes. Does <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/Bus_conflict">http://wiki.nesdev.com/w/index.php/Bus_conflict</a><!-- m --> explain to your satisfaction?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">More importantly, what I don't understand for this game is why the address being written to is $8040 not c56c thru c572... why they didn't do what I see done in other games that do this: sta $c56c,y<br />I don't see how the processor knows to view anything at the table at c56c just because it comes directly after the code that accesses it.</div>I'm not certain where you found the version that writes to $8040; the version I found in GoodNES and <a href="http://bootgod.dyndns.org:7777/profile.php?id=1628" class="postlink">NesCartDB</a> are the version that uses the look-up table. (ROM CRC32 = B15653BD) <br /><br />Actually checking the game, the byte at $8040 will change depending on the bank currently mapped, e.g. banks 1 and 2 could switch to any bank, banks 3,5, and 7 can only switch to bank 0, so that really shouldn't work.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I don't have the hardware to test it on, so I'd need to work with someone who does.</div> I believe that the newest versions of FCEUX enforce the bus conflcits.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>DvD</b> [ Tue Sep 02, 2014 6:39 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Garbled graphics on Glory of Heracles</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Since the new versions of FCEUX don't even work with the original un-translated ROM I had, I decided that I would make a new version that will work in all emulators and in the real hardware.  If you start with either version of the ROM, it will convert it to the new version.<br /><br />Of course, now the $c56c table is located somewhere else as it wouldn't fit there.  Here's what I did.<br /><br />I had a 7 byte table that would now not be used and I needed to find a place for a 15 byte table.  I found two 7 byte tables back to back.   The first one could be expanded 1 more byte in front as the previous 2 bytes were both RTS instructions.  I put the new 15 byte table there.  I moved one of the 7 byte tables to $c56c.  Finally, I'm pretty sure a 7 byte piece of code that simply inverts $91.0 does not get used.  $91 is a flag for the text row vs. the dakuten row.  But it is simply assigned 0 or 1 so it doesn't need to be toggled.<br /><br />Problem now is that I need someone to play through the whole game with the new version on the real thing and I really don't have the ability or desire to do that myself.  Anyone interested in beta testing Rev B of Heracles on real NES hardware?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
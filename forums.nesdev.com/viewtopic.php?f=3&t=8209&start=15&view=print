<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - NTSC color palette emulation, with the square wave modulator</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">NTSC color palette emulation, with the square wave modulator</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=8209">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=8209</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>10</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Firebrandx</b> [ Sat Oct 15, 2011 3:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I went a totally different route and simply reviewed over 100 games on the real hardware hooked up via composite to my display. It took several hours, but I eventually got every damn color to look exactly like the real NTSC hardware (and how I always remembered it looking). I've yet to see an emulator default come as close as mine does to looking like the US NES front-loader's color output.
<br />
<br />This is my pal file:
<br />
<br /><a href="http://www.firebrandx.com/downloads/fbx3pal.zip" class="postlink">http://www.firebrandx.com/downloads/fbx3pal.zip</a>
<br />
<br />I even made my own bsnes 83 build with my own palette edited in since byuu refused to consider it based on it being 'hand-coded'. My opinion is if the colors look the closest to what we all remember in the US, then it shouldn't matter how they were arrived at. I've seen games like Castlevania on a dozen different CRTs, and my palette makes it look exactly like the real one did.
<br />
<br />I will state though, that I don't use any filters on my graphics. No scanlines, no filtering, nothing. Filters can of course alter the appearance of the palette, so keep in mind that mine is meant for unfiltered graphics.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bisqwit</b> [ Sat Oct 15, 2011 3:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>tool</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><!-- m --><a class="postlink" href="http://bisqwit.iki.fi/utils/nespalette.php">http://bisqwit.iki.fi/utils/nespalette.php</a><!-- m --> -- create and download tailor made NTSC palette with this tool.
<br />
<br />EDIT: The closest match to mr. Firebrandx's palette that can be generated by my tool is by selecting hue -0.081, saturation level 1.53, contrast 0.94, brightness 1.07 and gamma 1.99. (Brute force searched.)
<br />Which is still not much said; the average squared difference between the color channels in the two palettes is still about 172 (average absolute difference 9.53).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Oct 15, 2011 4:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent">His seem to be: none, blue, blue+red, red, red+green, green, green+blue, all; which is not binary; it's gray code.</div>
<br />I bet this was on purpose, to make the hues in the emphasis channel follow the same color wheel pattern as the hues in the low-order bits.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kasumi</b> [ Sat Oct 15, 2011 5:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Firebrandx wrote:</div><div class="quotecontent">I even made my own bsnes 83 build with my own palette edited in since byuu refused to consider it based on it being 'hand-coded'. My opinion is if the colors look the closest to what we all remember in the US, then it shouldn't matter how they were arrived at.</div>
<br />I agree your palette is totally awesome. I used it on my <a href="http://www.wayofthepixel.net/pixelation/index.php?topic=10784.msg115062#msg115062" class="postlink">pixel artist's guide to NES restrictions</a>, and it beat out many others I found in my search. (Though it was pointed out that the last two columns should be full black. It's quite possible I used a bad version of your palette.)
<br />
<br />But( as I understand it) the goal of BSNES is 100% perfect accuracy. It makes sense to me that your palette was rejected because there's no hard logic behind it. Your method would seem to go against everything I've read about the stated goals of BSNES. There are probably at least a few games that play closest to what we all remember in the US on other SNES emulators. Does that mean Byuu should simplify or compromise his code or goals? How good are you at recognizing color? Can you get a perfect score on <a href="http://www.xrite.com/custom_page.aspx?PageID=77&amp;Lang=en" class="postlink">this test?</a>
<br />
<br />Bisqwit: I am fairly impressed by how this looks, and this tool. It'll help me with picking the right palette colors for the pixel art in my game, for sure.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Oct 15, 2011 5:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I got a 23. Is that good?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kasumi</b> [ Sat Oct 15, 2011 5:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't know what's good (you could have checked your results against others when you finished the test), but I got an 8.  I know someone who has got a perfect score, and another who has got a 4. 
<br />
<br />A perfect score is all that matters for something like a definitive hand made palette for NES. Even if one <em>could</em> perfectly color match, it relies on a specific set of monitors. A logical solution is better than a brute forced one, and can be tweaked to emulate different CRT TVs much easier. 
<br />
<br />tl;dr: My point was I completely understand byuu's reasoning for rejecting firebrandx's palette.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Sat Oct 15, 2011 5:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />vNES moved to a "more accurate palette" and it now looks like shit.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kasumi</b> [ Sat Oct 15, 2011 5:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The NES palette in general is pretty awful. There are a lot of NES palettes I've found over the years that looked great, and I wished were the real one. I like the one from YY-CHR. But that's not how it is. If your goal is accuracy, that's not the kind of thing you care about.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Sat Oct 15, 2011 5:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />But are the colors in the accuracy? I mean why can't it be an option? Default to right palette and then switch to the one that actually looks good. Colors on the screen are the last on the list for "accuracy" IMO.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Oct 16, 2011 5:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Kasumi wrote:</div><div class="quotecontent">I don't know what's good (you could have checked your results against others when you finished the test)</div><br />I looked, but it just gave minimum and maximum scores, not any sort of percentiles. I guess a lot of people click through without even rearranging the swatches.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Even if one <em>could</em> perfectly color match, it relies on a specific set of monitors.</div><br />NES and PC connected to same LCD TV in side-by-side mode perhaps?<br /><br /><div class="quotetitle">3gengames wrote:</div><div class="quotecontent">But are the colors in the accuracy?</div>
<br />If you're trying to draw graphics and check on a PC that they look OK before evaluating them on an NES, yes.
<br />
<br />But for now, Bisqwit's palette is probably the best we have.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Oct 16, 2011 10:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think the Nintendulator palette looks pretty good.  I might even make it the default palette in PocketNES.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bisqwit</b> [ Sun Oct 16, 2011 10:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Where accuracy is concerned, I am not entirely sure whether the overall hue for my palette is correct. I assumed that it begins from 0.000 degrees, but this assumption may be wrong. It just looks neat in code, and authentic on the screen as well. It may also depend on the particular TV/display device. At least it is very, very close.
<br />As written earlier, at least mr. FireBrandX's hand-picked palette matched mine better (mathematically) when all the hues were shifted left by 2.43 degrees (i.e. a value  of -0.081 half-cycles of the master clock was added to the "p" parameter in the sin/cos equation).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>beannaich</b> [ Sun Oct 16, 2011 12:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I wonder when someone will do the same kind of thing for PAL signals, and generate a PAL palette.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bisqwit</b> [ Sun Oct 16, 2011 1:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, I would like to, but I don't have the information about how either the PAL NES or the PAL circuitry works. Well, the latter I can find out.
<br />
<br /><div class="quotetitle">http://wiki.nesdev.com/w/index.php/Overscan wrote:</div><div class="quotecontent">The PAL color subcarrier is exactly 4,433,618.75 Hz. The PAL NES master clock is six times that, and the PPU generates one pixel for every 5 master clock cycles, or 5320342.5 Hz. This makes the width of a scanline 5320342.5*768/14750000 = 277 pixels, and the pixel aspect ratio 7375000/5320342.5 = (59*125000)/(165*64489/2) = 1.3862:1. </div><br /><div class="quotetitle">http://en.wikipedia.org/wiki/PAL wrote:</div><div class="quotecontent">Both the PAL and the NTSC system use a quadrature amplitude modulated subcarrier carrying the chrominance information added to the luminance video signal to form a composite video baseband signal. The frequency of this subcarrier is 4.43361875 MHz for PAL, compared to 3.579545 MHz for NTSC.</div>
<br />This makes it deducable that the color generation on the PAL may be largely the same (12 cycles per pixel). On PAL, however, the phase reverses on each line. According to Wikipedia, this phase reversal system existing on PAL (and not existing in NTSC) is why PAL does not need the manual hue correction setting that NTSC users need.
<br />But then, PAL uses YUV whereas NTSC uses YIQ.
<br />
<br />Just for fun, I tried the simplest change, and changed the YIQ matrix into YUV, reversed the polarity of the neutron flow, err, the signal phase, and adjusted the offset by integer steps until it looked right. The attenuation/voltage levels were not changed at all. Here is the result for the PAL palette. Naturally, this is 99 % nonsense, only posted for curiosity reasons:
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu_palcolor_sa.png" alt="Image" />
<br />I do have a PAL system (an NTDec, which may not actually do the same processing as the front-loading NES), but I do not have a color TV, so I cannot do comparative tests. Nor do I have an oscilloscope for analysing the generated signals, though I do know how to use it if I had one...
<br />
<br />EDIT: <em>Quite</em> fascinatingly, it looks almost <em>identical</em> to the NTSC chart at <a href="http://bisqwit.iki.fi/kala/snap/nesemu_ntsccolor_sa.png" class="postlink">http://bisqwit.iki.fi/kala/snap/nesemu_ntsccolor_sa.png</a>. I guess the YIQ and YUV conversion matrices are just pure 60 degree rotations/mirrors of each others?
<br />For those who want to repeat what I did, change the "color+p+8" into "color+12-p", and the I&amp;Q coefficients into 0, 1.139800, -0.393800, -0.580500, 2.0279 and 0 respectively.
<br />(Careful inspection reveals they are not exactly identical, though.)
<br />
<br />EDIT: The same palette, offset 15 degrees to the left and 15 degrees to the right for the two possible options as per the post by tepples below. Cropped to 13 columns for better clarity in reduced resolution.
<br /><img src="http://bisqwit.iki.fi/kala/snap/nesemu_palcolorm_sa.png" alt="Image" /> <img src="http://bisqwit.iki.fi/kala/snap/nesemu_palcolorp_sa.png" alt="Image" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Oct 16, 2011 1:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent">But then, PAL uses YUV whereas NTSC uses YIQ.</div>
<br />I think the fact that the results are identical comes from the fact that YIQ is pretty much just a phase rotation of YUV. So the "PAL palette" is the same as the NTSC palette at one specific tint and color setting. However, this tint setting might be offset a half a hue unit from the NTSC "neutral" setting. Colorburst on PAL is aligned +/- 45 degrees from the main axis, putting the closest phases at -15 and +15 degrees, while NTSC has a colorburst directly on the main axis. The NTSC colorburst has the same hue as color $x8, but we'll need someone with a PAL NES and a scope to confirm exactly what hue the PAL colorburst is.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>10</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - New emu: SMB status bar flashes when scrolling</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - New emu: SMB status bar flashes when scrolling" href="http://forums.nesdev.com/feed.php?f=3&amp;t=6260" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sat Sep 20, 2014 9:30 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=6260">New emu: SMB status bar flashes when scrolling</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=6260"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 10 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=6260&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=6260&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=6260&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p59622"></a>
				<b class="postauthor">pops</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59622">New emu: SMB status bar flashes when scrolling</a></div><div style="float: right;"><a href="./viewtopic.php?p=59622#p59622"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 4:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 04, 2010 4:28 pm<br /><b>Posts:</b> 81
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've been putting together my first emulator over the past week. So far I have SMB working just about right... except that the status bar flashes on and off when scrolling.
<br />
<br />I know that the status bar is maintained in the $2000 name table, and when scrolling, the game uses $2400 as well, necessitating the sprite0 flag check at scanline 30-31 or so. On VINT, the SMB rom sets the name table address flag (D1-D0 of $2000) to 0, and then sets it back to 1 after sprite0. 
<br />
<br />But half of the time the game almost immediately after setting D1-D0 to 0, sets it to 1 again.
<br />
<br />The difference between setting it to 0 and exiting, and resetting it to 1 (which happens twice(!) sometimes) is a BNE check at $8EE4; this should, I believe, not branch when the code is executing correctly.
<br />
<br />Key:
<br />+1: PC + 1
<br />+2: PC + 2
<br />$0: Mem @ $0000
<br />$1: Mem @ $0001
<br />
<br />Here's what happen's when D0-D1 is set once, to 0:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">PC__&nbsp; OP_____________________&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+1 +2 A_ X_ Y_ SP P_ $0 R1<br />80C3&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DD 8E 03 00 00 FC 09 01 03<br />8EDD&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 02 20 03 00 00 FA 09 01 03<br />8EE0&nbsp; A0&nbsp; LDY_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 B1 03 00 00 FA 0B 01 03<br />8EE2&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 D0 03 00 00 FA 0B 01 03<br />*** SCANLINE 243&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; D0 AC 00 00 00 FA 0B 01 03<br />8EE4&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AC 8D 00 00 00 FA 0B 01 03<br />8EE6&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 05 20 00 00 00 FA 0B 01 03<br />8EE9&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 05 20 00 00 00 FA 0B 01 03<br />8EEC&nbsp; 60&nbsp; RTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8D 00 00 00 00 FA 0B 01 03<br /></div><br /><br />Here's what happens when D0-D1 is set to 1 (erroneously I believe):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">PC__&nbsp; OP_____________________&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+1 +2 A_ X_ Y_ SP P_ $0 R1<br />80C3&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DD 8E 03 00 00 FC 09 01 03&nbsp; ;update screen with buffer contents<br />8EDD&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 02 20 03 00 00 FA 09 01 03&nbsp; ;reset flip-flop<br />8EE0&nbsp; A0&nbsp; LDY_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 B1 03 00 00 FA 0B 01 03&nbsp; ;load first byte from indirect as a pointer<br />8EE2&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 D0 03 00 00 FA 0B 01 03&nbsp; <br />*** SCANLINE 243&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; D0 AC 3F 00 00 FA 09 01 03<br />8EE4&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AC 8D 3F 00 00 FA 09 01 03&nbsp; ;if byte is zero we have no further updates to make here<br />8E92&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 06 20 3F 00 00 FA 09 01 03&nbsp; ;store high byte of vram address<br />8E95&nbsp; C8&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;B1 00 3F 00 00 FA 09 01 03<br />8E96&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 8D 3F 00 01 FA 09 01 03&nbsp; ;load next byte &#40;second&#41;<br />8E98&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 06 20 0C 00 01 FA 09 01 03&nbsp; ;store low byte of vram address<br />8E9B&nbsp; C8&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;B1 00 0C 00 01 FA 09 01 03&nbsp; <br />8E9C&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00 0A 0C 00 02 FA 09 01 03&nbsp; ;load next byte &#40;third&#41;<br />8E9E&nbsp; 0A&nbsp; ASL_Accumulator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;48 AD 04 00 02 FA 09 01 03&nbsp; ;shift to left and save in stack<br />8E9F&nbsp; 48&nbsp; PHA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AD 78 08 00 02 FA 08 01 03<br />8EA0&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 78 07 08 00 02 F9 08 01 03&nbsp; ;load mirror of $2000,<br />8EA3&nbsp; 09&nbsp; ORA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;04 B0 11 00 02 F9 08 01 03&nbsp; ;set ppu to increment by 32 by default<br />8EA5&nbsp; B0&nbsp; BCS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;02 29 15 00 02 F9 08 01 03&nbsp; ;if d7 of third byte was clear, ppu will<br />8EA7&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FB 20 15 00 02 F9 08 01 03&nbsp; ;only increment by 1<br />8EA9&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ED 8E 11 00 02 F9 08 01 03&nbsp; ;write to register<br />8EED&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00 20 11 00 02 F7 08 01 03<br />PPU.4000 : 17&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8D 78 11 00 02 F7 08 01 03<br /></div>
<br />
<br />I've been staring this error down for a couple of hours now - it's the first major stumbling block I've run up against, and I have no idea what's going wrong. Could someone give me a hint as to what I'm doing wrong?</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=4328">pops</a> on Sun Apr 04, 2010 5:14 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4328"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p59625"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59625"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59625#p59625"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 5:04 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">it might help if your tracer  printed what address the CPU was reading/writing instead of just the instruction and addressing mode.  As it is now, the tracer doesn't really do much of a job of illustrating what's going on.
<br />
<br />Where are the $2000 writes in this code?
<br />
<br />I assume those columns on the right are A,X,Y, but which is which?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p59626"></a>
				<b class="postauthor">pops</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59626"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59626#p59626"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 5:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 04, 2010 4:28 pm<br /><b>Posts:</b> 81
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">it might help if your tracer  printed what address the CPU was reading/writing instead of just the instruction and addressing mode.  As it is now, the tracer doesn't really do much of a job of illustrating what's going on.<br /><br />Where are the $2000 writes in this code?<br /><br />I assume those columns on the right are A,X,Y, but which is which?</div>My bad, I forgot a key. The values are +1, +2, A, X, Y, SP, P, $0, $1.
<br />+1: PC + 1 
<br />+2: PC + 2 
<br />$0: Mem @ $0000 
<br />$1: Mem @ $0001 
<br />
<br />So the second instruction, LDX_Absolute   02 20 loads $2002 into X.
<br />
<br />I'll work on better tracer output, but for the moment, this is what I have. :)
<br />
<br />Here's better output. Key is: last mem address accessed, last mem value, a, x, y, sp, p. I've indicated ppu address writes to $2000 with "PPU.4000 : value" (which appear before the instructions in the traced code.
<br />Correct:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">*** SCANLINE 242&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8059 80&nbsp; &nbsp; 91 0D D0 FF 89<br />8082&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 0D D0 FC 09<br />8085&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8086 7F&nbsp; &nbsp; 11 0D D0 FC 09<br />8087&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 0D D0 FC 09<br />808A&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;808B 7E&nbsp; &nbsp; 10 0D D0 FC 09<br />PPU.4000 : 16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2000 10&nbsp; &nbsp; 10 0D D0 FC 09<br />808C&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2000 10&nbsp; &nbsp; 10 0D D0 FC 09<br />808F&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 0D D0 FC 09<br />8092&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8093 E6&nbsp; &nbsp; 06 0D D0 FC 09<br />8094&nbsp; AC&nbsp; LDY_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0774 00&nbsp; &nbsp; 06 0D 00 FC 0B<br />8097&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8097 D0&nbsp; &nbsp; 06 0D 00 FC 0B<br />8099&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 0D 00 FC 09<br />809C&nbsp; 09&nbsp; ORA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;809D 1E&nbsp; &nbsp; 1E 0D 00 FC 09<br />809E&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 0D 00 FC 09<br />80A1&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80A2 E7&nbsp; &nbsp; 06 0D 00 FC 09<br />80A3&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2001 06&nbsp; &nbsp; 06 0D 00 FC 09<br />80A6&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2002 80&nbsp; &nbsp; 06 80 00 FC 89<br />80A9&nbsp; A9&nbsp; LDA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80AA 00&nbsp; &nbsp; 00 80 00 FC 0B<br />80AB&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FB AD&nbsp; &nbsp; 00 80 00 FA 0B<br />8EE6&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 80 00 FA 0B<br />8EE9&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 80 00 FA 0B<br />8EEC&nbsp; 60&nbsp; RTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FC 80&nbsp; &nbsp; 00 80 00 FC 0B<br />80AE&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2003 00&nbsp; &nbsp; 00 80 00 FC 0B<br />80B1&nbsp; A9&nbsp; LDA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80B2 02&nbsp; &nbsp; 02 80 00 FC 09<br />80B3&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4014 02&nbsp; &nbsp; 02 80 00 FC 09<br />80B6&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0773 00&nbsp; &nbsp; 02 00 00 FC 0B<br />80B9&nbsp; BD&nbsp; LDA_AbsoluteX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;805A 01&nbsp; &nbsp; 01 00 00 FC 09<br />80BC&nbsp; 85&nbsp; STA_ZeroPage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0000 01&nbsp; &nbsp; 01 00 00 FC 09<br />80BE&nbsp; BD&nbsp; LDA_AbsoluteX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;806D 03&nbsp; &nbsp; 03 00 00 FC 09<br />80C1&nbsp; 85&nbsp; STA_ZeroPage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0001 03&nbsp; &nbsp; 03 00 00 FC 09<br />80C3&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FB C5&nbsp; &nbsp; 03 00 00 FA 09<br />8EDD&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2002 00&nbsp; &nbsp; 03 00 00 FA 0B<br />8EE0&nbsp; A0&nbsp; LDY_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EE1 00&nbsp; &nbsp; 03 00 00 FA 0B<br />8EE2&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0301 00&nbsp; &nbsp; 00 00 00 FA 0B<br />*** SCANLINE 243&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0301 00&nbsp; &nbsp; 00 00 00 FA 0B<br />8EE4&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EE4 D0&nbsp; &nbsp; 00 00 00 FA 0B<br />8EE6&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 00 00 FA 0B<br />8EE9&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 00 00 FA 0B<br />8EEC&nbsp; 60&nbsp; RTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FC 80&nbsp; &nbsp; 00 00 00 FC 0B</div><br />Incorrect:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">8082&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 05 04 FC 09<br />8085&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8086 7F&nbsp; &nbsp; 11 05 04 FC 09<br />8087&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 05 04 FC 09<br />808A&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;808B 7E&nbsp; &nbsp; 10 05 04 FC 09<br />PPU.4000 : 16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2000 10&nbsp; &nbsp; 10 05 04 FC 09<br />808C&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2000 10&nbsp; &nbsp; 10 05 04 FC 09<br />808F&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 05 04 FC 09<br />8092&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8093 E6&nbsp; &nbsp; 06 05 04 FC 09<br />8094&nbsp; AC&nbsp; LDY_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0774 00&nbsp; &nbsp; 06 05 00 FC 0B<br />8097&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8097 D0&nbsp; &nbsp; 06 05 00 FC 0B<br />8099&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 05 00 FC 09<br />809C&nbsp; 09&nbsp; ORA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;809D 1E&nbsp; &nbsp; 1E 05 00 FC 09<br />809E&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0779 1E&nbsp; &nbsp; 1E 05 00 FC 09<br />80A1&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80A2 E7&nbsp; &nbsp; 06 05 00 FC 09<br />80A3&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2001 06&nbsp; &nbsp; 06 05 00 FC 09<br />80A6&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2002 80&nbsp; &nbsp; 06 80 00 FC 89<br />80A9&nbsp; A9&nbsp; LDA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80AA 00&nbsp; &nbsp; 00 80 00 FC 0B<br />80AB&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FB AD&nbsp; &nbsp; 00 80 00 FA 0B<br />8EE6&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 80 00 FA 0B<br />8EE9&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2005 00&nbsp; &nbsp; 00 80 00 FA 0B<br />8EEC&nbsp; 60&nbsp; RTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FC 80&nbsp; &nbsp; 00 80 00 FC 0B<br />80AE&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2003 00&nbsp; &nbsp; 00 80 00 FC 0B<br />80B1&nbsp; A9&nbsp; LDA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80B2 02&nbsp; &nbsp; 02 80 00 FC 09<br />80B3&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4014 02&nbsp; &nbsp; 02 80 00 FC 09<br />80B6&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0773 00&nbsp; &nbsp; 02 00 00 FC 0B<br />80B9&nbsp; BD&nbsp; LDA_AbsoluteX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;805A 01&nbsp; &nbsp; 01 00 00 FC 09<br />80BC&nbsp; 85&nbsp; STA_ZeroPage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0000 01&nbsp; &nbsp; 01 00 00 FC 09<br />80BE&nbsp; BD&nbsp; LDA_AbsoluteX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;806D 03&nbsp; &nbsp; 03 00 00 FC 09<br />80C1&nbsp; 85&nbsp; STA_ZeroPage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0001 03&nbsp; &nbsp; 03 00 00 FC 09<br />80C3&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FB C5&nbsp; &nbsp; 03 00 00 FA 09<br />8EDD&nbsp; AE&nbsp; LDX_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2002 00&nbsp; &nbsp; 03 00 00 FA 0B<br />8EE0&nbsp; A0&nbsp; LDY_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EE1 00&nbsp; &nbsp; 03 00 00 FA 0B<br />8EE2&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0301 3F&nbsp; &nbsp; 3F 00 00 FA 09<br />*** SCANLINE 243&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0301 3F&nbsp; &nbsp; 3F 00 00 FA 09<br />8EE4&nbsp; D0&nbsp; BNE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EE5 AC&nbsp; &nbsp; 3F 00 00 FA 09<br />8E92&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2006 3F&nbsp; &nbsp; 3F 00 00 FA 09<br />8E95&nbsp; C8&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8E95 C8&nbsp; &nbsp; 3F 00 01 FA 09<br />8E96&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0302 0C&nbsp; &nbsp; 0C 00 01 FA 09<br />8E98&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2006 0C&nbsp; &nbsp; 0C 00 01 FA 09<br />8E9B&nbsp; C8&nbsp; INY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8E9B C8&nbsp; &nbsp; 0C 00 02 FA 09<br />8E9C&nbsp; B1&nbsp; LDA_IndirectY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0303 04&nbsp; &nbsp; 04 00 02 FA 09<br />8E9E&nbsp; 0A&nbsp; ASL_Accumulator&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8E9E 0A&nbsp; &nbsp; 08 00 02 FA 08<br />8E9F&nbsp; 48&nbsp; PHA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01FA 08&nbsp; &nbsp; 08 00 02 F9 08<br />8EA0&nbsp; AD&nbsp; LDA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 00 02 F9 08<br />8EA3&nbsp; 09&nbsp; ORA_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EA4 04&nbsp; &nbsp; 15 00 02 F9 08<br />8EA5&nbsp; B0&nbsp; BCS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EA5 B0&nbsp; &nbsp; 15 00 02 F9 08<br />8EA7&nbsp; 29&nbsp; AND_Immediate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8EA8 FB&nbsp; &nbsp; 11 00 02 F9 08<br />8EA9&nbsp; 20&nbsp; JSR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01F8 AB&nbsp; &nbsp; 11 00 02 F7 08<br />PPU.4000 : 17&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2000 11&nbsp; &nbsp; 11 00 02 F7 08<br />8EED&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2000 11&nbsp; &nbsp; 11 00 02 F7 08<br />8EF0&nbsp; 8D&nbsp; STA_Absolute&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0778 11&nbsp; &nbsp; 11 00 02 F7 08<br />8EF3&nbsp; 60&nbsp; RTS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;01F9 8E&nbsp; &nbsp; 11 00 02 F9 08</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4328"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p59629"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59629"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59629#p59629"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 6:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39_1403452479.jpg" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 2219<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">- This isn't an human-friendly readable disassembled code.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p59630"></a>
				<b class="postauthor">NickMass</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59630"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59630#p59630"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 6:46 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Mar 30, 2010 7:59 pm<br /><b>Posts:</b> 14
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The emulator I've been working on has exactly the same issue with the blinking status bar, and it seems my tracer output is identical but a bit more verbose, here's what mine outputs if it can help diagnose what is going on.
<br />
<br />Correct:
<br /><a href="http://nickmass.com/emu/correct.txt" class="postlink">http://nickmass.com/emu/correct.txt</a>
<br />
<br />Incorrect:
<br /><a href="http://nickmass.com/emu/incorrect.txt" class="postlink">http://nickmass.com/emu/incorrect.txt</a></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4318"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p59631"></a>
				<b class="postauthor">pops</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59631"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59631#p59631"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 6:57 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 04, 2010 4:28 pm<br /><b>Posts:</b> 81
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">- This isn't an human-friendly readable disassembled code.</div>Apologies for that.
<br />
<br />NickMass, your output and mine both have the same problem: instruction $8EE2 reads from $0301, which should be zero. If it is non-zero, then this bug appears (I've noticed values $3F and $26 in $0301, although certainly other values may be possible).
<br />
<br />This value is loaded at $8AF5 ($26) and $89F2 ($3F).
<br />
<br />Per the smb disassembly (at <!-- m --><a class="postlink" href="http://www.romhacking.net/docs/344/">http://www.romhacking.net/docs/344/</a><!-- m -->), the routines at these two addresses are ColorRotation and MushroomIconData
<br />
<br />$89F2
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ColorRotation:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda FrameCounter&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;get frame counter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and #$07&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;mask out all but three LSB<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bne ExitColorRot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;branch if not set to zero to do this every eighth frame<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldx VRAM_Buffer1_Offset&nbsp; ;check vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cpx #$31<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcs ExitColorRot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if offset over 48 bytes, branch to leave<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;otherwise use frame counter's 3 LSB as offset here<br />GetBlankPal:&nbsp; lda BlankPalette,y&nbsp; &nbsp; &nbsp; &nbsp;;get blank palette for palette 3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1,x&nbsp; &nbsp; &nbsp; &nbsp;;store it in the vram buffer *** WRITE TO 0301<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;increment offsets<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iny<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cpy #$08<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcc GetBlankPal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;do this until all bytes are copied<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldx VRAM_Buffer1_Offset&nbsp; ;get current vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$03<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta $00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;set counter here<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda AreaType&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;get area type<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;multiply by 4 to get proper offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;save as offset here<br />GetAreaPal:&nbsp; &nbsp;lda Palette3Data,y&nbsp; &nbsp; &nbsp; &nbsp;;fetch palette to be written based on area type<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1+3,x&nbsp; &nbsp; &nbsp;;store it to overwrite blank palette in vram buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iny<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dec $00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;decrement counter<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bpl GetAreaPal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;do this until the palette is all copied<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldx VRAM_Buffer1_Offset&nbsp; ;get current vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldy ColorRotateOffset&nbsp; &nbsp; ;get color cycling offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda ColorRotatePalette,y<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1+4,x&nbsp; &nbsp; &nbsp;;get and store current color in second slot of palette<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda VRAM_Buffer1_Offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;add seven bytes to vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; adc #$07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1_Offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inc ColorRotateOffset&nbsp; &nbsp; ;increment color cycling offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda ColorRotateOffset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp #$06&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;check to see if it's still in range<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcc ExitColorRot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if so, branch to leave<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta ColorRotateOffset&nbsp; &nbsp; ;otherwise, init to keep it in range<br />ExitColorRot: rts&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;leave<br /></div><br />$8AF5:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">MushroomIconData:<br />&nbsp; &nbsp; &nbsp; .db $07, $22, $49, $83, $ce, $24, $24, $00<br /><br />DrawMushroomIcon:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldy #$07&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;read eight bytes to be read by transfer routine<br />IconDataRead: lda MushroomIconData,y&nbsp; ;note that the default position is set for a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1-1,y&nbsp; &nbsp; ;1-player game *** WRITE TO 0301<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dey<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bpl IconDataRead<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda NumberOfPlayers&nbsp; &nbsp; &nbsp;;check number of players<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beq ExitIcon&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;if set to 1-player game, we're done<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;otherwise, load blank tile in 1-player position<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1+3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$ce&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;then load shroom icon tile in 2-player position<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sta VRAM_Buffer1+5<br />ExitIcon:&nbsp; &nbsp; &nbsp;rts<br /></div>
<br />
<br />[edit]
<br />Memory location 0301 is set to zero again at instruction $80D8... which is after the offending branch. I don't think it's reset anywhere else...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4328"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p59642"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59642"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59642#p59642"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 9:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think I figured it out guys.
<br />
<br />The "incorrect" code is really correct.  What's going on is the game is writing new map data.  I'm guessing the screen is flickering when the screen scrolls, right?   As in new data is being drawn.
<br />
<br />The game may not write to $2000 after drawing, but from looking at the smb disassembly, it <em>DOES</em> zero $2006.  See my notes at the beginning and end of this code snippit:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;;**<br />;; HERE IS THE PROBLEM JSR TO THE CODE THAT WRITES TO $2000<br />;;**<br /><br />SetupWrites:&nbsp; &nbsp;jsr WritePPUReg1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;write to register<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pla&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;pull from stack and shift to left again<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;asl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bcc GetLength&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if d6 of third byte was clear, do not repeat byte<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ora #%00000010&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;otherwise set d1 and increment Y<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny<br />GetLength:&nbsp; &nbsp; &nbsp;lsr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;shift back to the right to get proper length<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lsr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;note that d1 will now be in carry<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tax<br />OutputToVRAM:&nbsp; bcs RepeatByte&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;if carry set, repeat loading the same byte<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;otherwise increment Y to load next byte<br />RepeatByte:&nbsp; &nbsp; lda &#40;$00&#41;,y&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;load more data from buffer and write to vram<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta PPU_DATA<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;done writing?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne OutputToVRAM<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sec&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tya<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;adc $00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;add end length plus one to the indirect at $00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta $00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;to allow this routine to read another set of updates<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;adc $01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta $01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$3f&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;sets vram address to $3f00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta PPU_ADDRESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta PPU_ADDRESS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta PPU_ADDRESS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;then reinitializes it for some reason<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta PPU_ADDRESS<br />;;**<br />;; THE ABOVE STA'S CLEAR $2006<br />;;**</div>
<br />
<br />You guys must not be doing the scrolling properly.  Remember that $2006, $2005, <em>and the low 2 bits of $2000</em> all change the same register ("loopy_t").  So by writing zero to $2006 twice, the low 2 bits of $2000 are effectively zero'd as well.
<br />
<br />
<br />Edit:  wtf @ double line breaks</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p59646"></a>
				<b class="postauthor">pops</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59646"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59646#p59646"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 10:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 04, 2010 4:28 pm<br /><b>Posts:</b> 81
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Your solution worked perfectly Disch. I really appreciate your help.
<br />
<br />I hacked your solution into my emulator so that if VRAM_Address = 0 after $2006 is written to with the latch set, I clear the Name table base address (D1-D0 of $2000)... and while this works perfectly for SMB, I should obviously look into emulating loopy_t. So I'll be diving into <!-- m --><a class="postlink" href="http://h1.ripway.com/blargg/temp/nes_ppu_scrolling.txt">http://h1.ripway.com/blargg/temp/nes_ppu_scrolling.txt</a><!-- m --> tomorrow. :)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4328"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p59647"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59647"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59647#p59647"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 04, 2010 10:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yeah that page you linked outlines exactly what you need to do.
<br />
<br />Glad I could help  =)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p59659"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p59659"></a></div><div style="float: right;"><a href="./viewtopic.php?p=59659#p59659"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Apr 05, 2010 4:36 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 12424<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">Edit:  wtf @ double line breaks</div>
<br />I get this too on GNOME when I copy a Windows-line-ending text file from Gedit to Firefox.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=6260"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=6260"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 10 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="6260" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>

<img src="./cron.php?cron_type=tidy_search" width="1" height="1" alt="cron" />
</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Network connection through expansion port?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Network connection through expansion port?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=2901">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=2901</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Jan 29, 2007 12:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Why are they called PS/2 keyboards if they don't even work in a PS2? (Keyboards for PlayStation 2 are USB.)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Anders_A</b> [ Mon Jan 29, 2007 12:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Because they were intruduced with the <a href="http://en.wikipedia.org/wiki/IBM_PS/2" class="postlink">PS/2</a>.
<br />
<br />(actually the same kind of keyboard used on the AT, but with another connector)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>atarimike</b> [ Mon Jan 29, 2007 4:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't think I'm going to worry about a keyboard until I get the whole network thing going. It's going to be a big enough project without the keyboard.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Jan 30, 2007 10:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I guess it would actually be much easier to get a keyboard working than a network, huh.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>commodorejohn</b> [ Tue Jan 30, 2007 11:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, hold off on the keyboard for now, but if you are going to do a telnet client, it'd be much easier to use than an onscreen keyboard.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Tue Jan 30, 2007 11:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I have keyboard working on Squeedo, that's how you navigate the UI currently, as a matter of fact.
<br />
<br />Goes like:
<br />PC Keyboard -&gt; terminal (XMODEM) -&gt; PIC interrupted, buffers -&gt; NES gets IRQ when enabled, receives buffer.
<br />
<br />There is also the el cheapo way, skipping the PIC and just hooking the serial line to the controller port.  It's a crappy way to go though, because the NES can only receive keys when it keeps polling constantly.
<br />
<br />I've been meaning to write a program that would allow the NES to write to the PIC, then have the PIC relay it to the PC where it could go to any TCP/IP port.  The only prog I'd seen like that costs hundreds of bucks, which seems pretty nuts with how simple it should be..

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Jan 30, 2007 2:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Memblers wrote:</div><div class="quotecontent">I've been meaning to write a program that would allow the NES to write to the PIC, then have the PIC relay it to the PC where it could go to any TCP/IP port.  The only prog I'd seen like that costs hundreds of bucks, which seems pretty nuts with how simple it should be..</div>
<br />What you want to do is <a href="http://www.google.com/search?hl=en&amp;client=firefox-a&amp;rls=org.mozilla:en-US:official&amp;hs=QfK&amp;sa=X&amp;oi=spell&amp;resnum=0&amp;ct=result&amp;cd=1&amp;q=set+up+ppp+server&amp;spell=1" class="postlink">set up a PPP server</a>. What makes you think the PPP server software costs &gt;200 USD? Or are you talking about having to put together a second PC using Linux-friendly hardware?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rbudrick</b> [ Wed Jan 31, 2007 8:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What about just interfacing it with CopyNES?  Is that possible?  Would it take any work out of the problem?
<br />
<br />-Rob

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Wed Jan 31, 2007 2:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle">Memblers wrote:</div><div class="quotecontent">I've been meaning to write a program that would allow the NES to write to the PIC, then have the PIC relay it to the PC where it could go to any TCP/IP port.  The only prog I'd seen like that costs hundreds of bucks, which seems pretty nuts with how simple it should be..</div><br />What you want to do is <a href="http://www.google.com/search?hl=en&amp;client=firefox-a&amp;rls=org.mozilla:en-US:official&amp;hs=QfK&amp;sa=X&amp;oi=spell&amp;resnum=0&amp;ct=result&amp;cd=1&amp;q=set+up+ppp+server&amp;spell=1" class="postlink">set up a PPP server</a>. What makes you think the PPP server software costs &gt;200 USD? Or are you talking about having to put together a second PC using Linux-friendly hardware?</div>
<br />
<br />Here is the prog I was talking about, that does what I was looking for:
<br /><a href="http://www.taltech.com/products/tcpcom.html" class="postlink">http://www.taltech.com/products/tcpcom.html</a>
<br />Seems simple enough.
<br />
<br />Setting up a linux PC isn't really an option, I want to find or make software that would be included with the Squeedo kit and usable by almost anybody.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>offensive_jerk</b> [ Thu Sep 27, 2007 7:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Did anyone ever get a NES Ethernet device working? This is an awesome idea.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>bunnyboy</b> [ Thu Sep 27, 2007 7:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />No one has really started it yet.  Just to review what's needed if a relay computer isn't used:
<br />
<br />Hardware- basic (for me), I could hook up an ISA ethernet card in a couple minutes
<br />
<br />UDP-  somewhat easy, can include stuff like DHCP without too much extra work
<br />
<br />TCP-  INSANELY HARD!  A cut down TCP stack would be barely possible with the amount of ram available.  Stuff like reordering and reconstructing packets gets really messy.  Could be ripped out of ContikiOS.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>drk421</b> [ Thu Oct 04, 2007 6:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm actually working on this project right now,
<br />More later...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Wookie</b> [ Sun Mar 02, 2008 3:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think you guys are missing a much easier solution to the EtherNES idea.  Instead of trying to use one of the ethernet chips with address and data lines, why not use the Microchip ENC28J60.  It is a 10baseT chip with an SPI interface.  
<br />
<br />There are two different designs that I have schematics for, one is just a simple ethernet adapter to get your NES on the net, the other has a PIC uC and the ENC28J60 so that it can do more stuff.
<br />
<br />Simple EtherNES:
<br />The design uses a 74HCT08 to do the 3.3V to 5V level shifting of the SO and INT lines from the ENC28J60.  The ENC28J60 can tolerate the 5V SI and CLK signals from the CPU, but can only output 3.3V SO and INT signals.  The interfacing is then done by bit-banging the SPI protocol using the expansion port pins of the controller registers $4016 and $4017.  The <a href="http://nesdev.com/NinTech.txt" class="postlink">NinTech.txt</a> file shows two pins/bits in each registister that go to the expansion port.  My design uses the two bits in $4016 for the SPI CLK and CS lines and the two bits in the $4017 for the MOSI and MISO lines.  The ENC28J60 pulls down the expansion port /IRQ line when it has received a packet.  Incidentally, this design is so simple and compact that the PCB can be fitted to the expansion port and then the expansion port snap cover can be fitted back over it.  You still have to cut a small hole in the cover for the ethernet port though. 
<br />
<br />The More Complex EtherNES:
<br />This design uses one of PIC uC's to give the adapter more capabilities like audio output by hooking an analog out pin from the PIC uC to the AIN pin in the expansion port.  The uC is also connected to the cart through the expansion port cart pins.  This allows for things like downloading game code/data updates over the network and storing them on the cart, and also reading data from the cart at runtime for things like MP3 decoding and output. The primary 6502 interface works through the controller ports the same way the the simple design above does.  This allows the same SPI protocol library to be used to talk to both devices.
<br />
<br />If I could figure out how to successfully use the data lines on the expansion port, I could do a lot more in fewer clock cycles, since the serial protocols through the controller port registers are much slower.  Maybe there's a way to use a custom mapper chip in the cart that will allow the expansion port cart pins to be used as address lines.  The cpu could set a bit in a mapper register to flip it into "expansion mode".  This would dynamically remap a segment of the cart's memory space into the "expansion port" by routing the address lines from the CPU to the expansion port cart pins allowing the CPU to send an address signal to the expansion port.  The data bus pins work as normal to read/write a byte of data from/to the address specified by the expansion port cart pins.  The only reason I don't like doing this for the primary access to the expansion port is that it (1) breaks possible famicom compatibility, and (2) it means the EtherNES would only be usable with specially built carts with the correct mapper hardware.
<br />
<br />You know, the only thing that is preventing me from building and releasing either of these EtherNES adapters is a lack of a good part to interface with the expansion port.  At this point, I'm talking with a company that may be able to customize their 48-pin card edge connector to fit the unusual dimensions of the expansion port "card" on the NES.  If anybody has a good part for this, let me know and I'll unleash the long dreamed about EtherNES adapter on the world.  I'll also release a software library for implementing the SPI protocol to talk to the device and port one of the embedded stacks to use it.
<br />
<br />Ultimately, if I can get a connector part, I'll probably go with the more complex EtherNES design in the end because I really want to build a cart that has a ton of serial flash memory (256MB) that can be accessed through the expansion port cart pins to allow for code/data updates.  The game would then be able to have short loading screens to pull data from the flash and populate parallel flash memory/ROMs.  I have a completely fleshed out game design that would take advantage of the capability for some true 8-bit awesome.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>bunnyboy</b> [ Sun Mar 02, 2008 6:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Wookie wrote:</div><div class="quotecontent">I think you guys are missing a much easier solution to the EtherNES idea.  Instead of trying to use one of the ethernet chips with address and data lines, why not use the Microchip ENC28J60.  It is a 10baseT chip with an SPI interface.</div><br />The parallel ethernet chips are generally chosen for speed (at least 10x faster than serial) and because they can be interfaced directly to the NES CPU bus with no parts.  An ISA ethernet card can be configured to map its registers directly into the $4200 or $4300 range with no more hardware, just wires.<br /><br />For networking the hardware is incredibly basic, and the software is incredibly hard.  Unless you already have at least a UDP implementation programmed you haven't even started.  No, most libs you can download will not work with the NES, they use far too much RAM and processor time.  Soldering ~15 address/data lines isn't stopping anyone, its the huge programming job.  <br /><br /><div class="quotetitle">Wookie wrote:</div><div class="quotecontent">You know, the only thing that is preventing me from building and releasing either of these EtherNES adapters is a lack of a good part to interface with the expansion port.</div><br />So you have finished network stacks using a prototype hand built version?  What internal resources are left for the game?<br /><br /><div class="quotetitle">Wookie wrote:</div><div class="quotecontent">At this point, I'm talking with a company that may be able to customize their 48-pin card edge connector to fit the unusual dimensions of the expansion port "card" on the NES.  If anybody has a good part for this, let me know and I'll unleash the long dreamed about EtherNES adapter on the world.  I'll also release a software library for implementing the SPI protocol to talk to the device and port one of the embedded stacks to use it.</div>
<br />Unless you plan on making many thousands of parts there is no way injection molding will work (and I guarantee you will not sell thousands of these).  It will cost many thousands of dollars for the mold alone, ~$10k last time I got it quoted.  May be able to find a more direct place to do it for $3-5k, but if you only sell 100 then thats $30-50 for the plug alone.  A far better idea would be to sell systems with the EtherNES board installed, or available as a solder in board like the CopyNES.  If its really that cheap then you could have it inside the cart instead.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Wookie</b> [ Tue Mar 04, 2008 11:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">bunnyboy wrote:</div><div class="quotecontent">The parallel ethernet chips are generally chosen for speed (at least 10x faster than serial) and because they can be interfaced directly to the NES CPU bus with no parts.  An ISA ethernet card can be configured to map its registers directly into the $4200 or $4300 range with no more hardware, just wires.</div>
<br />
<br />Yes, but this solution doesn't work through the expansion port because the CPU's address lines aren't available there.
<br />
<br />The network stack available for free from Microchip runs on embedded systems with much less resources than the NES.  Speed isn't an issue either because the NES is going to be the bottleneck.  You're right about the coding being a big job but I've implemented embedded stacks before.  It really isn't that hard.
<br />
<br />I have 48-pin connectors that almost fit.  They're the right size, but the opening is just barely too skinny to take the thickness of the expansion port "card".

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
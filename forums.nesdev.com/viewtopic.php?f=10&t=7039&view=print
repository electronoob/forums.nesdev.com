<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Fading.</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Fading.</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7039">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7039</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Ian A</b> [ Wed Oct 13, 2010 9:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Fading.</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />An old topic for reference:
<br /><a href="http://nesdev.com/bbs/viewtopic.php?t=5165" class="postlink">http://nesdev.com/bbs/viewtopic.php?t=5165</a>
<br />
<br />I'm trying to make the screen fade in and out for transitions but thought I should ask here to see how other people handle this first.
<br />
<br />Is this commonly done through palette manipulation?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Wed Oct 13, 2010 10:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If by fading you literally mean "fade from colour X to black", literally the only choice you have is changing colour indexes in the palette.  Unlike the SNES, the NES doesn't have a screen brightness register.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Wed Oct 13, 2010 10:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It does have the "darken the screen slightly" feature though.  You can use that inside a palette fade for twice as many levels.  It probably fails on a Playchoice 10.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Oct 13, 2010 10:58 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Since I started that thread, the method I ended up using was this:
<br />
<br />I keep a copy of the unaltered palette in RAM, and I have a table in ROM specifying how the brightness and the hue should be affected for each "virtual screen brightness level". Then whenever the screen brightness changes I calculate a modified palette based on the original one by changing the hue and brightness of each color according to the table, clipping as necessary.
<br />
<br />Of course you could do like most games did and just change the brightness every step, but adding the hue into the mix makes the fading much smoother (i.e. as the screen darkens, make the palette bluer, as it brightens, make it yellower).
<br />
<br />Using this scheme I had a decision to make: I could either modify the colors during the frame and buffer the modified palette to quickly write it to VRAM during VBlank or I could use more VBlank time and modify the colors on the fly. I ended up deciding on modifying them on the fly in VBlank, which was harder to do because the code had to be very optimized and constant-timed. In other projects I could have decided to just buffer the modified palette.
<br />
<br />Either way I think it's a good idea to keep the original palette untouched, because this way you can keep doing palette cycling effects and things like that without screwing up the brightness because you're fading in or out.
<br />
<br />EDIT: At one point I considered doing what Dwedit said, alternating between decreasing a unit of brightness from the colors and activating all the color emphasis bits. Theoretically that would double the smoothness of the fading sequence, but I guess I gave up on the idea because it seems the color emphasis bits don't work as expected on some RGB PPUs or something. Also the fading would probably look weird in case I used the emphasis bits for something else, like water.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Wed Oct 13, 2010 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The cheap way is to subtract $10 until you get to $0x for the entry.  But yeah, every program that I write always keeps the palette in RAM, and always copies it to the PPU on every NMI (because checking to skip it just adds more time overall).  A lot of commercial games seem to do that too, even if they apparently don't do palette cycling.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Oct 13, 2010 11:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Memblers wrote:</div><div class="quotecontent">every program that I write always keeps the palette in RAM, and always copies it to the PPU on every NMI (because checking to skip it just adds more time overall).  A lot of commercial games seem to do that too, even if they apparently don't do palette cycling.</div>
<br />Lately, I tend to use 32-byte uploads in a transfer buffer in $0100-$019F. The NMI handler sees no difference between a palette update and a pair of CHR RAM tiles or a nametable row, except they have different destination VRAM addresses.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Oct 13, 2010 12:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Lately, I tend to use 32-byte uploads in a transfer buffer in $0100-$019F. The NMI handler sees no difference between a palette update and a pair of CHR RAM tiles or a nametable row</div>
<br />The problem with that is that when your horizontal scroll is not perfectly aligned to a tile you need to update at least 33 tiles when scrolling vertically (unless you are masking the leftmost 8 pixels of the screen). And when scrolling horizontally you have to update 30 tiles. So I don't think you can do <em>everything</em> in 32-byte blocks.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Oct 13, 2010 1:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The NMI handler sees no difference between a palette update and a pair of CHR RAM tiles or a nametable row, except they have different destination VRAM addresses.</div><br />At first I used separate buffers, but then I implemented a system like this to simplify/shorten the NMI routine. I still have another separate palette entry in RAM, that is copied to the update buffer whenever an update is needed.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> <br /><br />I keep a copy of the unaltered palette in RAM, and I have a table in ROM specifying how the brightness and the hue should be affected for each "virtual screen brightness level". Then whenever the screen brightness changes I calculate a modified palette based on the original one by changing the hue and brightness of each color according to the table, clipping as necessary.</div>
<br />I can understand your efforts in order to improve the fading, but personally I wouldn't do something like this, because the NES palette is somewhat partially defined / unstable. Many emulators use different palettes, so looking better on one system (be it an emulator or a real NES hooked to a real TV) might make it look worse on another system (another emulator / or another NES hooked to another TV).
<br />Also, people have different sensitives about colors. I'm pretty sure people with blue, brown or dark eyes don't perceive colors the same way, so have hue shifts in some order might look better to your eyes, but look worse to someone with different eyes. There is people who are color-blind too.
<br />All this to say you are guaranteed that just substrating $10 is a stable method. Maybe yours is amazing, but somehow I'm not so sure.
<br />
<br />If this really isn't smooth, maybe you could turn on all color emphasis, then turn it off and substracti $10, then turn it on agan etc... to get a smoother fade. However it might not look good on all color, especially the bright ones...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>clueless</b> [ Wed Oct 13, 2010 2:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">Also, people have different sensitives about colors. I'm pretty sure people with blue, brown or dark eyes don't perceive colors the same way, so have hue shifts in some order might look better to your eyes, but look worse to someone with different eyes.</div>
<br />
<br />What makes you think that the color of one's iris [1] has any effect on the ability of the cones [2] to detect color differences?  If you are aware of any actual research papers, I would find that interesting.
<br />
<br />However, I did find an article [3] (many, actually) stating that eye color affects <strong>light sensitivity</strong>, but nothing about eye color affecting <strong>color sensitivity</strong>.
<br />
<br />
<br />[1] <!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/Eye_color">http://en.wikipedia.org/wiki/Eye_color</a><!-- m -->
<br />[2] <!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/Cone_cell">http://en.wikipedia.org/wiki/Cone_cell</a><!-- m -->
<br />[3] <!-- m --><a class="postlink" href="http://www.nytimes.com/2009/01/20/health/20real.html?_r=1">http://www.nytimes.com/2009/01/20/healt ... .html?_r=1</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Oct 13, 2010 2:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">I'm pretty sure people with blue, brown or dark eyes don't perceive colors the same way, so have hue shifts in some order might look better to your eyes, but look worse to someone with different eyes.</div><br />I'm no doctor, but I'm pretty sure that eye color has nothing to do with how people perceive colors... I do agree that there probably is some variance from people to people, but the iris just surrounds the hole through where light goes into the eye, so its color doesn't matter because no light goes through it. When I had laser eye surgery to fix my sight they cut my cornea open with a circular blade. If I could see anything in that area, I would certainly see a scar, which I don't. Light only enters your eye through the small opening at the center.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">There is people who are color-blind too.</div><br />They have more important things to worry about, like red and green lights when they are driving, than the fading routines of my game. =)<br /><br />But seriously, if a person is color blind, I bet they are less likely to notice slight hue shifts than people with normal sight (seeing as they have <em>less</em> color sensors), so the worst that could happen is that it would look more like a traditional brightness-only fade to them.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Maybe yours is amazing, but somehow I'm not so sure.</div><br />Come on, don't you think the fading in <a href="http://www.youtube.com/watch?v=yIsBHlODbOI" class="postlink">this game</a> looks amazing for a system with only 64 colors? Insanely better than anything on the NES IMO.<br /><br />Several Genesis/MD and SMS games faded like this, and this is somewhat easier to program if the system's palette is RGB (as is the case with these 2 consoles), since you can just modify each of the color components at different rates and times. But it's not so hard on systems like the NES or the Atari 2600, you just have to visualize the palette as a color circle, and move the colors towards blue or yellow at the same time as you make them darker. It looks great IMO.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If this really isn't smooth, maybe you could turn on all color emphasis, then turn it off and substracti $10, then turn it on agan etc... to get a smoother fade.</div>
<br />That's what Dwedit suggested... I haven't tried coding that, but I do believe it would appear to flicker a bit.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Oct 13, 2010 2:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well I don't have any sources  <img src="./images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> 
<br />I just remember that I was told that eye color affected vision. That should be something extremely difficult to test though, as anyone is used to it's own vision and can't test anyone else's eyes. Maybe I see blue the way someone else see red and vice versa, and since we had that since our birth, nobody even knowns this.
<br />Only those extremely rare people that have two eyes of different colors could confirm if they see colors differently with one eye than another. But I'm not one of them.
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">They have more important things to worry about, like red and green lights when they are driving, than the fading routines of my game. =)</div><br />The position of the lights usually defines if they are green or red, with rare exceptions.<br /><br /> <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">But seriously, if a person is color blind, I bet they are less likely to notice slight hue shifts than people with normal sight (seeing as they have less color sensors), so the worst that could happen is that it would look more like a traditional brightness-only fade to them.</div>
<br />You're probably right on this one. Although it's all theorical.
<br />Just to say we usually don't think that some people can be handicapped, but can still play games. (for example a handicaped persone who have no arms isn't going to play your game). But people who has no audition, or that is color blind, are still going to play games, and the developers doesn't always think about them which isn't nice. I'm getting out-of-topic here anyways, as as you said color blind probably plays no role in this.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Oct 13, 2010 2:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">Only those extremely rare people that have two eyes of different colors could confirm if they see colors differently with one eye than another.</div>
<br />I do see a bit differently with each eye... One sees slightly bluer and the other slightly redder, but that's very hard to notice. The lighting has to be right and I must be looking at a white object.
<br />
<br />I don't think it varies so much from people to people to the point of the same color appearing red to a person and blue to the other. Colors have known wavelengths, and I believe it's possible to tell which cones are stimulated by which wavelengths, so it should be possible to predict what kind of information is being sent to the brain.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Wed Oct 13, 2010 2:39 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well to be honest I never understood this wavelenght thing.
<br />
<br />To me, the wavelength model of colors is a total contradiction with the color circle model. There is no way both can exist and be "true", as the wavelength model doesn't loop on himself like the color circle does. This have been a major question I've been asking to myself for years and never got any answer.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>clueless</b> [ Wed Oct 13, 2010 2:40 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/CIE_1931_color_space">http://en.wikipedia.org/wiki/CIE_1931_color_space</a><!-- m -->
<br />
<br />I think the key to understanding why the color "wheel" is a circle, yet why real light is based on wavelength is this paragraph in the above Wikipedia article:
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Two light sources, made up of different mixtures of various wavelengths, may appear to be the same color; this effect is called metamerism. Two light sources have the same apparent color to an observer when they have the same tristimulus values, no matter what spectral distributions of light were used to produce them.</div>
<br />
<br />Additional edit:  This might also be helpful:
<br /><!-- m --><a class="postlink" href="http://en.wikipedia.org/wiki/Line_of_purples">http://en.wikipedia.org/wiki/Line_of_purples</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Oct 13, 2010 2:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">To me, the wavelength model of colors is a total contradiction with the color circle model. There is no way both can exist and be "true", as the wavelength model doesn't loop on himself like the color circle does.</div>
<br />Between the eye and the brain, the signal from the cones is converted to a color space much like <a href="http://en.wikipedia.org/wiki/YUV" class="postlink">YUV</a> through an <a href="http://en.wikipedia.org/wiki/Opponent_process" class="postlink">opponent process</a>. So the eye sees along the lightness axis, the red-green axis (V), and the blue-yellow axis (U). Men with no red cones or no green cones see only blue-yellow distinctions.
<br />
<br />The line of purples from blue to red on the chromaticity diagram represents what happens when U is blue and V is red. Red cones are slightly sensitive to blue light, which is why both a blue+red mixture and the blue at the bottom of a rainbow appear violet.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - A note to all NES-emulator authors: ROM header wishlist</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">A note to all NES-emulator authors: ROM header wishlist</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10183">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10183</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>8</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Thu Jun 20, 2013 12:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">So I've pretty much come to the conclusion that there is no solution to this problem.<br /><br />Support iNES 1.0, support iNES 2.0, support as many external board markups as you can, support an internal database, cross your fingers and hope for the best.</div><br /><br />This pretty much sums it all up. Everyone just needs to live with it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Thu Jun 20, 2013 12:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You'll never have an end-all solution that covers everything. The best you can do is have a dual approach: self-contained format(s) for describing new games, and a database of known games. The former allows a determined person to make a game work. The latter accounts for all the existing files out there to make them work without having to convert them to a &quot;correct&quot; format.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Jun 20, 2013 1:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">etabeta wrote:</div><div class="quotecontent">the problem is that either we establish some sort of 'central authority' which assigns in a meaningful way the mappers and keeps doing this until the firms in Taiwan and HK quit producing new carts</div><br />We've been trying to start a mapper registry. First there's the <a href="http://wiki.nesdev.com/w/index.php/Mapper" class="postlink">grid</a> to document what we have, and then there's a <a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9854" class="postlink">&quot;planes&quot; proposal</a> to segregate new dumps from the Far East into NES 2.0 mappers 512-767.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">just look at the 5-6 known cases of mapper #s which have been assigned to 2 incompatible boards...</div><br />One of them is #34, but that's easy to solve: CHR RAM or 8 KiB CHR ROM = BNROM, and anything bigger = that NINA board. Others are disambiguated with iNES submappers.<br /><br /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Maybe everyone assumes 8KB PRG is enough for Galaxian, and then a 4KB PRG ROM is discovered later on.</div><br />I asked kevtris about this and he said that in these cases, an overdump shall be considered a &quot;good dump&quot; in the iNES or NES 2.0 format. For example, Slappin' (from the 2011 compo) has a 4 KiB CHR ROM repeated twice, and Galaxian has an 8 KiB PRG ROM repeated twice.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Thu Jun 20, 2013 2:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">oRBIT2002 wrote:</div><div class="quotecontent">I have a wish for everyone that's coding a NES-emulator...<br />I know some emulators uses checksums for detecting certain ROMs and to automatically adjust the experience. STOP doing this...</div>I agree completely. Implement NES 2.0, and optionally implement .NES.INI too (the ROM images I have written relased so far, and that I will do so in the future, all include such a file; if different emulators use their own format, a program can be written for conversion in both directions).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>etabeta</b> [ Fri Jun 21, 2013 3:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">But now you have another problem. All the Javascript emulators are going to want to use JSON. MESS is going to want to use its own proprietary XML format. Nestopia has its own XML format. I use BML myself.</div><br /><br />Luckily, in most cases, a simple script (possibly even online) could be written to convert from one format to the other <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">just look at the 5-6 known cases of mapper #s which have been assigned to 2 incompatible boards...</div><br />One of them is #34, but that's easy to solve: CHR RAM or 8 KiB CHR ROM = BNROM, and anything bigger = that NINA board. Others are disambiguated with iNES submappers.</div><br /><br />yeah, but I was using those as an example of what happens when there is no centralized effort to keep consistency as it has happened in the past... and sometimes still happens, with a few chinese dumpers (not all of them, luckily) marking as plain mapper 4 any waixing mapper variant they dump and release, so that it does not work in most emus

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Fri Jun 21, 2013 3:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />&gt; and optionally implement .NES.INI too<br /><br />Ooooh, another new format. And one that doesn't support trees. Don't forget to also include a MESS internal database entry, a Nestopia XML file, and a higan manifest.bml as well. Is anyone using JSON or YAML yet? Gotta be somebody out there.<br /><br />&gt; Luckily, in most cases, a simple script (possibly even online) could be written to convert from one format to the other<br /><br />Tough to say. MESS' SNES DB does not capture any ROM/RAM address mapping/mirroring. You would not be able to convert your entries to mine. Similarly, I don't capture the writing on top of chips, so I couldn't turn my entries into yours (well, they'd probably work anyway, since that info is not used by emulators.)<br /><br />But ... you make an interesting point. Just as a hypothetical, what if we had a community effort to form a massive textual database (in some common extensible format, it doesn't matter which), that each emulator author could derive from? Pull out the info they need, and format it into their preferred markup language with their preferred variable names.<br /><br />The idea would be that absolutely anything and everything would go into it. If anyone finds certain info relevant, we could add it. Peoples' derivations could discard what they consider unimportant. Not only could you generate XML/JSON/YAML/BML, you could also generate iNES 1.0/UNIF/iNES 2.0 headers from the information. Even iNES 2.0 fans should consider it a boon, as it'd be a really fast way to propagate any fixes to bad iNES 2.0 headers.<br /><br />It would be trivial to include unlicensed games as well, by having a flag to differentiate them from licensed games. Any volunteers that try and run some homebrew which doesn't work, could quickly submit a new board definition, and all emulators participating would benefit.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jun 21, 2013 5:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">It would be trivial to include unlicensed games as well, by having a flag to differentiate them from licensed games.</div><br />Distinguishing among original licensed games, original unlicensed games, and original homebrew games could be done with a flag called something like CIC Type. It'd take values such as &quot;3193&quot; (for licensed North American games), &quot;Rabbit&quot; (for Tengen games), &quot;CIClone&quot; (for the majority of homebrew), &quot;passthrough&quot; (for Game Genie, <a href="http://www.consoledatabase.com/companies-organisations/hes/" class="postlink">HES games</a>, and that Noah's Ark game for Super NES), or some designator for a CIC stun circuit. But then that still doesn't solve how to designate ROM hacks of licensed games, which are usually built on donors.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 21, 2013 7:36 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">form a massive textual database...you could also generate iNES 1.0/UNIF/iNES 2.0 headers</div><br />If there's a centralized database, just have a unique ID for every board/tv format/PPU/whatever combination, then use the reserved bits in the iNES 1.0 header to indicate that there's a database entry.  e.g.:<br /><br /><ul>- byte 11 - some unique value to indicate that the rom is described in the database.  Or maybe use 4 bits for that purpose and 4 bits as a checksum/CRC to reduce the chance of some DiskDude! like corruption?<br />- bytes 12-14 - database id.  Lower 16 bits would be primary board type (i.e., existing iNES mapper assignment), upper 8 bits would define variant/different configurations.<br /></ul>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Fri Jun 21, 2013 10:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That's basically what NES2.0 is, except that NES2.0 has less goofy indirection.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 21, 2013 11:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">That's basically what NES2.0 is</div><br />The mapper variant part, yes.  But NES 2.0 attempts to further define the ROM in the header, and there will invariably be something that doesn't fit into the format.  The idea here is to reduce the board definition to a simple ID, where anything can be defined in the database.  Is it the same as using NES 2.0 and ignoring everything except the mapper variant field?  Yeah, I suppose it is.<br /><br /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">except that NES2.0 has less goofy indirection.</div><br />How so?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Fri Jun 21, 2013 11:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">James wrote:</div><div class="quotecontent">there will invariably be something that doesn't fit into the format.</div> Hence why the remaining bits are explicitly marked as 0 in the header for future use, if we figure out what needs doing. It is possible we'll run out, but we've got a significant amount of headroom with no indication we'll need to use it.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">except that NES2.0 has less goofy indirection.</div><br />How so?</div>If the concept that you want to contain is, say, &quot;This a Vs. System game that uses the RP2C04-03 without any additional mapping hardware&quot;, in NES2.0 you set the bits that exactly correspond. Providing a SQL unique column index, or whatever you want to think of it, instead says &quot;Please look up UID 26987&quot;, which in turn tells you that &quot;it's a RP2C04-03 without any additional hardware&quot;. You could sort the UIDs such that they're actually a bitmap, but then that's basically NES2.0.<br /><br />In any case, there's enough information in Nestopia's database (and thus also in the export from nescartdb) to supply everything but the NES2.0 submapper field for a header-fixing tool. It's just no-one's done it, either due to not wanting to touch it with a ten foot pole or not having it occur to them.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 21, 2013 11:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><div class="quotetitle">James wrote:</div><div class="quotecontent">there will invariably be something that doesn't fit into the format.</div> Hence why the remaining bits are explicitly marked as 0 in the header for future use, if we figure out what needs doing. It is possible we'll run out, but we've got a significant amount of headroom with no indication we'll need to use it.<br /></div><br />So would you dedicate some of that space to defining different VRC4 revisions?  How about something like whether or not expansion audio is used and how it's mixed on the cart?<br /><br /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">It's just no-one's done it, either due to not wanting to touch it with a ten foot pole or not having it occur to them.<br /></div><br />That and because iNES is good enough for the vast majority of cases/users.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Fri Jun 21, 2013 11:46 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />IDs are flawed and unnecessary, and you'll have different people defining their own conflicting IDs, just like with mappers.<br /><br />Map database entries to SHA256 hashes. Barring a future intentional exploit that allows SHA256 hash collisions (which we don't have yet, and if there ever is one, we can use stronger hashes), there are more possible ROM combinations than there are atoms in the universe.<br /><br />And now we don't need a header at all, so we can leave it with DISKDUDE or whatever other people insist on keeping there.<br /><br />&gt; Hence why the remaining bits are explicitly marked as 0 in the header for future use, if we figure out what needs doing.<br /><br />I want to know what controllers a game supports, and which ones are the preferred input methods, if applicable. Where can I put that into the iNES 2.0 header? I'd also like to note what the default overscan clipping should be for each game, to avoid showing scrolling artifacts on the edge of the screen. Is there space left for that?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 21, 2013 11:53 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Map database entries to SHA256 hashes.</div><br />What do you do with homebrew and hacks?  Fallback to iNES/other header and hope for the best?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jun 21, 2013 11:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: A note to all NES-emulator authors..</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />@byuu<br />The NES 2.0 file represents the function of everything inside the Game Pak shell. Things like controllers and overscan go in the manual. (Yes, a few NES era manuals mentioned overscan. I can provide references if you want.) So what you need is a machine-readable version of things commonly found in the manual.<br /><br />In most cases, if you stick to the overscan amount that the scaled mode of PocketNES implements (8 left and right, 16 top, 11 bottom), you should end up with 240x213 pixels of clean video. Nesticle used a heuristic that if the game sets the clip bit to cut off the left 8 pixels, the emulator would also cut off the right 8.<br /><br />EDIT: A <a href="http://www.neshq.com/games/j/jeopardy/jeopardy-man01.pdf" class="postlink">scan of the Jeopardy! 25th Anniversary Edition manual</a> shows controller information on page 4 and overscan at the bottom of page 18: &quot;This game has been programmed to utilize the full TV screen. Since some older model TV sets have rounded screens, a portion of the image may be blocked out.&quot; The <a href="http://www.angelfire.com/hi3/NES/manual/smb_duck_hunt.txt" class="postlink">transcription of the Super Mario Bros./Duck Hunt manual</a> has similar language about overscan.<br /><br />@James<br />Homebrew and hacks can fall back to NES 2.0. If they use something not describable in NES 2.0, they can come with a database entry in the same format as the entries associated with hash values.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>8</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
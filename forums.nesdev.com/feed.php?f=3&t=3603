<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=3603" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2007-09-25T19:47:16-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=3603</id>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2007-09-25T19:47:16-07:00</updated>
<published>2007-09-25T19:47:16-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27225#p27225</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27225#p27225"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27225#p27225"><![CDATA[
<div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />Notice that if a particular instruction has failed in the test, it does NOT imply the error relies on THAT instruction.<br /></div><br />You mean the way another failing instruction could cause an "innocent" instruction to get flagged, due to the inherent paradox of testing the CPU with the very instructions that are being tested?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Tue Sep 25, 2007 7:47 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2007-09-25T14:50:39-07:00</updated>
<published>2007-09-25T14:50:39-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27219#p27219</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27219#p27219"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27219#p27219"><![CDATA[
Notice that if a particular instruction has failed in the test, it does NOT imply the error relies on THAT instruction. ^_^;;<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Sep 25, 2007 2:50 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[albailey]]></name></author>
<updated>2007-09-25T11:03:05-07:00</updated>
<published>2007-09-25T11:03:05-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27218#p27218</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27218#p27218"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27218#p27218"><![CDATA[
Thanks.   I havent written an emulator, but I did write a 6502 core as part of a "not very good disassembler", so this'll be useful for me.<br /><br /><br />Edit - I still have a lot of work to do before I can truly use it.<br /><br />Al<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=772">albailey</a> — Tue Sep 25, 2007 11:03 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2007-09-25T09:05:07-07:00</updated>
<published>2007-09-25T09:05:07-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27215#p27215</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27215#p27215"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27215#p27215"><![CDATA[
<!-- m --><a class="postlink" href="http://dischmeister.googlepages.com/nestest.zip">http://dischmeister.googlepages.com/nestest.zip</a><!-- m --><br /><br /><br />I don't have any readmes or anything.  The "automated" ROM is the one that runs through the tests without any display or input (for bare-bones CPU emus to be able to test themselves).  IIRC, it puts the error code or success code in zero page somewhere, but I can't remember.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Tue Sep 25, 2007 9:05 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[albailey]]></name></author>
<updated>2007-09-25T07:29:41-07:00</updated>
<published>2007-09-25T07:29:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27210#p27210</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27210#p27210"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27210#p27210"><![CDATA[
Is nestest  hosted anywhere else?  The link on the wiki doesnt work for me.  Sorry for hijacking the thread.<br /><br />Al<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=772">albailey</a> — Tue Sep 25, 2007 7:29 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2007-09-24T22:47:36-07:00</updated>
<published>2007-09-24T22:47:36-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27206#p27206</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27206#p27206"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27206#p27206"><![CDATA[
<div class="quotetitle">MatthewCallis wrote:</div><div class="quotecontent"><br />(indirect,X) test: 59   STA didn't store the data where it was supposed to<br /></div><br /><br />(Indirect,X) is not (Indirect),X.  The comma inside the parenthesis indicates the addition is performed before the indirection.<br /><br />Inefficient but verbose pseudocode:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">  temp = Read&#40; PC &#41;;  // get pointer address<br />  temp += X;  // add X to it<br />  temp &amp;= 0xFF;  // keep it on zero page<br />  addr = Read&#40; temp &#41;; // get low byte of pointer<br />  temp += 1;<br />  temp &amp;= 0xFF;  // again, keep it on zero page<br />  addr |= Read&#40; temp &#41; &lt;&lt; 8;<br /><br />  // do your STA or whatever to addr<br /></div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />(indirect,Y) test: EC   should've wrapped zeropage address<br /></div><br /><br />Same situation as above.  The pointer is always read from zero page.  So LDA ($FF),Y would get the low byte of the pointer from $00FF and the high byte from $0000 -- NOT $0100.  But note (Indirect),Y has the comma outside the parenthesis -- indicating you add Y <em>after</em> the indirection.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Mon Sep 24, 2007 10:47 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MatthewCallis]]></name></author>
<updated>2007-09-24T22:10:07-07:00</updated>
<published>2007-09-24T22:10:07-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27205#p27205</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27205#p27205"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27205#p27205"><![CDATA[
<div class="quotetitle">mattmatteh wrote:</div><div class="quotecontent"><br />i noticed that you are using macro's for some instructions.  why?  i tried that here once and my emulator went from slow to very slow.  it makes the binary larger and causes more cache misses.<br /></div><br />I'll give that a test and see if it actually does cause a slowdown (I'm on OSX v10.4.10), it's not slow as is though so I have nothing to lose.<br />After reading through the forms and links I found, I also pass NOP, SBX and SLO of the undocumented OP codes.<br />I can't thank you all enough for your help, as it stands I pass everything except:<br />(indirect,X) test: 59   STA didn't store the data where it was supposed to<br />(indirect,Y) test: EC   should've wrapped zeropage address<br /><br />And again I'm not sure what the result location I am looking for from the STA write is; nor do I know where it is refering to for the zeropage address.<br /><br />The code:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#define STORE_IDI&#40;REG, CYCLES&#41;&#123;                           \<br />   addr = memory&#91;program_counter&#93;;                        \<br />   tmp = &#40;&#40;memory&#91;addr + 1&#93; &lt;&lt; 8&#41; | memory&#91;addr&#93;&#41; + x_reg;      \<br />   printf&#40;&quot;Address: %x\n&quot;, addr&#41;;                        \<br />   printf&#40;&quot;Memory : %x\n&quot;, tmp&#41;;                        \<br />   write_memory&#40;tmp, REG&#41;;                              \<br />   program_counter++;                                 \<br />   cycle_count -= CYCLES;                              \<br />   break;                                          \<br />&#125;</div>What I get is <div class="codetitle"><b>Code:</b></div><div class="codecontent">Address: 80<br />Memory : 200<br />Address: 80<br />Memory : 202<br />Address: 80<br />Memory : 203<br />Address: ff<br />Memory : 0<br /></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3407">MatthewCallis</a> — Mon Sep 24, 2007 10:10 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[mattmatteh]]></name></author>
<updated>2007-09-24T21:28:15-07:00</updated>
<published>2007-09-24T21:28:15-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27202#p27202</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27202#p27202"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27202#p27202"><![CDATA[
i agree with that.  seems that alot of people use that and when i tested it, it was slower.  sorry for the off topic commment.<br /><br />matt<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=170">mattmatteh</a> — Mon Sep 24, 2007 9:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2007-09-24T20:19:01-07:00</updated>
<published>2007-09-24T20:19:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27200#p27200</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27200#p27200"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27200#p27200"><![CDATA[
<div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />i tried that here once and my emulator went from slow to very slow. it makes the binary larger and causes more cache misses.<br /></div><br />The effect depends on how the emulator is written. If some other author finds that macros speed it up, then so be it.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Mon Sep 24, 2007 8:19 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[mattmatteh]]></name></author>
<updated>2007-09-24T18:25:49-07:00</updated>
<published>2007-09-24T18:25:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27198#p27198</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27198#p27198"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27198#p27198"><![CDATA[
i noticed that you are using macro's for some instructions.  why?  i tried that here once and my emulator went from slow to very slow.  it makes the binary larger and causes more cache misses.<br /><br />matt<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=170">mattmatteh</a> — Mon Sep 24, 2007 6:25 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2007-09-24T17:43:29-07:00</updated>
<published>2007-09-24T17:43:29-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27196#p27196</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27196#p27196"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27196#p27196"><![CDATA[
Your absolute,X code looks fine.<br /><br />But I'm not sure about your N flag setting...<br /><br />All the N flag means is set according to the high bit of the result (see below).  That is... if the previous instruction resulted in $80 or higher (high bit set), N is also set.  To make your life easier, just deal with everything as unsigned, since most all other behavior acts as if it were signed.<br /><br />CMP is really a glorified subtraction instruction.  The CPU subtracts the given value from a register and sets flags according to the result -- just as SBC does (although CMP doesn't change the register, or V, and it doesn't involve C in the subtraction)<br /><br />So N would be set when (REG-tmp) &amp; 0x80  is nonzero.<br /><br />My CMP macro:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#define CMP&#40;r&#41;                           \<br />   tmp = r - val;                        \<br />   fC = !&#40;tmp &gt;&gt; 8&#41;;                     \<br />   fN = fZ = &#40;u8&#41;tmp<br /></div><br /><br />'tmp' is a 16-bit temp value<br />'r' is register being used (A, X, or Y for CMP, CPX, CPY)<br />'fC' represents the C flag -- nonzero = set<br />'fZ' represents the Z flag -- zero = set<br />'fN' represents the N flag -- fN &amp; 0x80 = set<br /><br /><br />EDIT -- <br /><br />If your x_reg is signed 8-bit... that's a big problem.  Make sure it's unsigned.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Mon Sep 24, 2007 5:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MatthewCallis]]></name></author>
<updated>2007-09-24T17:21:15-07:00</updated>
<published>2007-09-24T17:21:15-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27194#p27194</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27194#p27194"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27194#p27194"><![CDATA[
Okay, I've been playing with nestest some more, and I've got more simple problems.<br /><br />First, I pass absolute,X test, but only with the following code:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">#define COMP_MEM_AIX&#40;REG, CYCLES&#41;&#123;                                       \<br />   addr = &#40;&#40;memory&#91;program_counter+1&#93; &lt;&lt; 8&#41; | memory&#91;program_counter&#93;&#41; + x_reg;   \<br />   tmp2 = &#40;&#40;REG&#41; - &#40;addr&#41;&#41;;                                          \                     \<br />   tmp = memory_read&#40;addr&#41;;                                          \<br />   carry_flag = &#40;REG &gt;= tmp&#41; ? 1 : 0;                                    \<br />   sign_flag = &#40;&#40;REG &lt; tmp&#41; || &#40;tmp == 0&#41;&#41; ? 1 : 0;                        \<br />   zero_flag = &#40;REG == tmp&#41; ? 1 : 0;                                    \<br />   printf&#40;&quot;A   : %i \n&quot;, &#40;signed char&#41;REG&#41;;         \<br />   printf&#40;&quot;M   : %i \n&quot;, &#40;signed char&#41;addr&#41;;         \<br />   printf&#40;&quot;t   : %i \n&quot;, &#40;signed char&#41;tmp2&#41;;         \<br />   printf&#40;&quot;Flag: %x : %x : %x\n&quot;, sign_flag, carry_flag, zero_flag&#41;;\<br />   program_counter += 2;                                             \<br />   cycle_count -= CYCLES;                                             \<br />   break;                                                         \<br />&#125;</div><br />This code just doesn't look right with the '|| (tmp == 0)'  portion, however the method used by the docs on the subject I've read (tmp &amp; 0x80). This and every other of the CMP / CPY functions fail and I just keep going back to it so I can move on and fix some other issues.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3407">MatthewCallis</a> — Mon Sep 24, 2007 5:21 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2007-09-22T16:26:26-07:00</updated>
<published>2007-09-22T16:26:26-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27160#p27160</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27160#p27160"/>
<title type="html"><![CDATA[Re: nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27160#p27160"><![CDATA[
I'm assuming your flags are N, C, Z  ?  Would've been nice if you labelled them  ;P  I thought it was NZC at first<br /><br />anyway I noticed this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">A : 80<br />M : 0<br />Flags: 0 1 0<br /></div><br /><br />should be :  1 1 0  (NCZ)<br /><br />80 - 0 = 80 (negative)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Sat Sep 22, 2007 4:26 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MatthewCallis]]></name></author>
<updated>2007-09-22T15:04:21-07:00</updated>
<published>2007-09-22T15:04:21-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27159#p27159</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27159#p27159"/>
<title type="html"><![CDATA[nestest Error Code Details]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3603&amp;p=27159#p27159"><![CDATA[
Hello all,<br />I am trying to fix several CPU errors in my emulator but I am having trouble actually tracking them down. Using nestest I have found the errors, great, its opcode __, but what facet of opcode __? Are my flags wrong? Program counter error? Overlooked sign issues?<br />Does anyone have an idea as to where I might look to find more information for nestest errors?<br /><br />For example:<br />I'm focusing on testing CMP absolute,X. I get 064h. I change some values around and get the flags seemingly right, I test again and now I get 061h. What happened? I see it testing the code, so I log it to get:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">A : 40<br />M : 40<br />Flags: 0 1 1<br />A : 40<br />M : 3f<br />Flags: 0 1 0<br />A : 40<br />M : 41<br />Flags: 1 0 0<br />A : 80<br />M : 0<br />Flags: 0 1 0<br />A : 80<br />M : 80<br />Flags: 0 1 1<br />A : 80<br />M : 81<br />Flags: 1 0 0<br />A : 80<br />M : 7f<br />Flags: 0 1 0<br /></div><br />based on <a href="http://homepage.ntlworld.com/cyborgsystems/CS_Main/6502/6502.htm#CMP" class="postlink">http://homepage.ntlworld.com/cyborgsystems/CS_Main/6502/6502.htm#CMP</a> it seem more correct, and Super Mario Bros still runs fine.<br />But I have other CPU issues I need to fix and i was hoping there would be a faster way with a more explained error code.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3407">MatthewCallis</a> — Sat Sep 22, 2007 3:04 pm</p><hr />
]]></content>
</entry>
</feed>
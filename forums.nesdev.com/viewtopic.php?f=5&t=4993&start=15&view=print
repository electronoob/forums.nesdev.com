<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Lua scripting support in emulators</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Lua scripting support in emulators</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=5&amp;t=4993">http://forums.nesdev.com/viewtopic.php?f=5&amp;t=4993</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Apr 02, 2009 4:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I believe the idea was to write most of the game in Lua, then port pieces to 6502 assembly one by one.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>strat</b> [ Thu Apr 02, 2009 7:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Exactly.  I was hoping the emulator could run a script without loading an existing rom.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Apr 02, 2009 8:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Then start with an SNROM that just displays a green screen. I'd guess you can have the Lua part of the game communicate with the already-ported part through PRG RAM.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Fri Apr 03, 2009 11:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Just dont call it a nes game......Its a lua script game that only runs in emulators.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Apr 03, 2009 1:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Correct, it's a Lua game, not that there's anything wrong with that. If more parts get ported to NES with each release, at least an intent is clear.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri Apr 03, 2009 9:08 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />[23:57:51] &lt;miau&gt; <!-- m --><a class="postlink" href="http://www.youtube.com/watch?v=LT1eiLiMWkk">http://www.youtube.com/watch?v=LT1eiLiMWkk</a><!-- m -->
<br />[23:58:03] * miau hides in teh corner again
<br />[23:58:03] &lt;B00daW&gt; haahah
<br />[23:58:04] &lt;ui&gt; oh noes, that video again
<br />[23:59:11] &lt;B00daW&gt; mwow <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />
<br />[23:59:13] &lt;B00daW&gt; nice
<br />[23:59:52] &lt;miau&gt; you wanna post that in the lua scripting thread at nesdev this time b00d?
<br />[00:00:04] &lt;miau&gt; it's 6 am and I'm lacking words to write
<br />[00:00:10] &lt;miau&gt; <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Apr 04, 2009 4:16 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Posted to tetrisconcept.com.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sat Apr 04, 2009 8:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Correct, it's a Lua game, not that there's anything wrong with that. If more parts get ported to NES with each release, at least an intent is clear.</div>
<br />Ya dont call it a nes game till you ported it all. (as to avoid flames)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Sat Apr 04, 2009 1:58 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">B00daW wrote:</div><div class="quotecontent">[23:57:51] &lt;miau&gt; <!-- m --><a class="postlink" href="http://www.youtube.com/watch?v=LT1eiLiMWkk">http://www.youtube.com/watch?v=LT1eiLiMWkk</a><!-- m --><br /></div>
<br />
<br />Wow.  I really hope the Lua socket code used there isn't *truly* sending TCP packets with a single byte as payload....  *cringe*

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Xkeeper</b> [ Mon Apr 06, 2009 2:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">koitsu wrote:</div><div class="quotecontent"><div class="quotetitle">B00daW wrote:</div><div class="quotecontent">[23:57:51] &lt;miau&gt; <!-- m --><a class="postlink" href="http://www.youtube.com/watch?v=LT1eiLiMWkk">http://www.youtube.com/watch?v=LT1eiLiMWkk</a><!-- m --><br /></div><br /><br />Wow.  I really hope the Lua socket code used there isn't *truly* sending TCP packets with a single byte as payload....  *cringe*</div>
<br />
<br />Yes, it is. That &lt; 1kB/sec really is slow! <img src="./images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Mednafen</b> [ Mon Apr 06, 2009 9:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is that TCP collation/buffering algorithm(Nagle's?) turned off in that example?  The "ping", however it's calculated, looks way too high.
<br />
<br />Xkeeper:  You're forgetting all the packet overhead.  TCP+IP+others.  And the large number of packets per second could be hard on routers.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Xkeeper</b> [ Mon Apr 06, 2009 1:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Mednafen wrote:</div><div class="quotecontent">Is that TCP collation/buffering algorithm(Nagle's?) turned off in that example?  The "ping", however it's calculated, looks way too high.<br /><br />Xkeeper:  You're forgetting all the packet overhead.  TCP+IP+others.  And the large number of packets per second could be hard on routers.</div>
<br />
<br />The "ping" is off regardless (it's another packet that it just times a response to), and even on localhost it reads "15ms", so yes, it's broken.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>miau</b> [ Wed Apr 08, 2009 11:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ping should be taken with a grain of salt. It will never go below 15ms because the network code runs, as does everything else, only 60 times per second.
<br />
<br />Updates aren't sent every frame, though, and oops! It really seems like LuaSocket does no tcp buffering at all? However, it shouldn't be too hard to manually implement simple buffering for data.
<br />
<br />
<br />Nevertheless, take the whole thing merely as a proof-of-concept. I'm not a networking guru and don't claim to be. Your comments led me to take a more in-depth look at tcp/ip which I'm glad I did. Understanding how things work on a low level = invaluable.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Wed Apr 08, 2009 2:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />miau, let me know if you need any assistance in understanding how TCP works on a networking level.  I cannot help with Lua's socket implementation (I did purchase a Lua book this week though :-) ), and I'm not sure what degree of control it has over the underlying socket implementation the OS (Windows, *IX, etc.) provides, but I can always help with network analysis.
<br />
<br />One tool you might find very useful is Wireshark.  That will give you the best idea of what exactly is going across the wire (on an IP/TCP level) and what's being seen.  Make sure you install WinPcap when prompted.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>miau</b> [ Thu Apr 09, 2009 1:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for the offer, I really appreciate it and will likely get back to it sooner or later. It's always good to know people proficient in a subject like this.
<br />
<br />Oh, I've been using Wireshark before. It's neat, gave me a vague idea of what's going on just from looking closely at its captured packets.
<br />I also remember hating WinPcap for not letting me capture local traffic which, if I remember correctly, actually is a MS Windows limitation of some sort.  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
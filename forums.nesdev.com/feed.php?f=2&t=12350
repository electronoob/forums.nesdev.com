<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=2&amp;t=12350" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2015-02-11T06:39:11-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=2&amp;t=12350</id>
<entry>
<author><name><![CDATA[Eugene.S]]></name></author>
<updated>2015-02-11T06:39:11-07:00</updated>
<published>2015-02-11T06:39:11-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140999#p140999</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140999#p140999"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140999#p140999"><![CDATA[
American Journey to Silius / Japanese RAF World <a href="http://hwm.us.to/famimusic/Forum/Journey_to_Silius_(USA)_Dendy_TA03NP1-6527P.mp3" class="postlink">sounds pretty good</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3884">Eugene.S</a> — Wed Feb 11, 2015 6:39 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2015-02-08T08:10:06-07:00</updated>
<published>2015-02-08T08:10:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140809#p140809</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140809#p140809"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140809#p140809"><![CDATA[
<div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><br />Are the DPCM / noise channel periods the same from the 2C02 to the UA6527P?<br /></div><br />Yes. If they were different, <em>Rough World</em> (our <em>Journey to Silius</em>) and <em>Dynamite Batman</em> (our <em>Batman: Return of the Joker</em>) would sound like crap, and hopefully, someone would have noticed.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sun Feb 08, 2015 8:10 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2015-02-08T03:16:03-07:00</updated>
<published>2015-02-08T03:16:03-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140805#p140805</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140805#p140805"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140805#p140805"><![CDATA[
The pitches of the DPCM are adjusted to be the same between NTSC and PAL. (I don't know about Dendy.)<br /><br />This means that if you have tuned DPCM, you should have separate tuning tables for NTSC and PAL. Otherwise, it's probably fine to just let PAL have a different pitch.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Sun Feb 08, 2015 3:16 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[lidnariq]]></name></author>
<updated>2015-02-08T13:26:48-07:00</updated>
<published>2015-02-08T01:59:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140803#p140803</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140803#p140803"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140803#p140803"><![CDATA[
The real problem, as I can see it, is that Dendy = <span style="color: #80FF00">NTSC DPCM, </span>NTSC prerender time, NTSC raster effects, PAL NMI speed (affecting both music engine and game play), PAL master palette, PAL color emphasis bits. So &quot;just treating it as PAL&quot; is ok if you do no raster effects <span style="color: #80FF00">nor use DPCM</span>, and &quot;just treating it as NTSC&quot; is ok if you're ok with the game slowing down and don't use the color emphasis bits.<br /><br />I was going to say something about the DPCM rates, but I realized that I don't actually know what they are. Are the DPCM / noise channel periods the same from the 2C02 to the UA6527P?<br /><br /><span style="color: #80FF00">edits in green</span><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3512">lidnariq</a> — Sun Feb 08, 2015 1:59 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Drag]]></name></author>
<updated>2015-02-07T21:58:54-07:00</updated>
<published>2015-02-07T21:58:54-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140794#p140794</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140794#p140794"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140794#p140794"><![CDATA[
Thanks a bunch!<br /><br />By the way, yes, I'm doing something like Battletoads where I'm using forced blanking to upload more stuff to the PPU per frame, making it necessary to know what timing is being used for the screen.<br /><br />And yeah, I know I can make accomodations in my NMI, but I still preferred a way to do it without needing the IRQs. It's nice to see everyone's approach to the solution, and that there indeed was something simpler than what I was doing. <img src="http://forums.nesdev.com/images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />I was using the flag I generated as an array index too, instead of just a boolean, so having each bit separated is going to be beneficial in some cases.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=21">Drag</a> — Sat Feb 07, 2015 9:58 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2015-02-07T21:41:49-07:00</updated>
<published>2015-02-07T21:41:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140791#p140791</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140791#p140791"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140791#p140791"><![CDATA[
It only takes a &quot;bit&quot; of code to map those values to $00=NTSC, $C0=PAL NES, $80=Dendy. This way N means correct speeds, and V means correct raster effects and pitches.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Feb 07, 2015 9:41 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2015-02-07T21:36:33-07:00</updated>
<published>2015-02-07T21:36:33-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140790#p140790</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140790#p140790"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140790#p140790"><![CDATA[
<div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><br />I'm not clear why it matters if we lose one or two vblanks?<br /></div><br />Well, you did solve the problem by dividing the cycle count by 2 if it's too big, but I normally prefer the solution that doesn't need workarounds.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />And being able to detect Dendy is handy, even though you gave good reasons to not care.<br /></div><br />I don't know if I'd go out of my way to support the Dendy, but as long as it's just &quot;do like on PAL&quot; or &quot;do like on NTSC&quot;, I'll probably try to keep my programs working properly on that console as well.<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />The 0=NTSC, 1=PAL NES, 2=Dendy scheme admits the following rules:<br /><ul><li>If non-zero, correct speeds. </li><li>If bit 0 is true, correct pitches and raster effects. </li></ul><br /></div><br />Yeah, it's true that if I were to completely separate all aspects I'd need more flags, but like you said, 2 bits are enough. I probably should find better names for my variables, but the reason I have them in separate bytes is that I can just use BIT to test them, while keeping them in the same byte would require the accumulator for testing.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Sat Feb 07, 2015 9:36 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2015-02-07T21:23:28-07:00</updated>
<published>2015-02-07T21:23:28-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140787#p140787</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140787#p140787"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140787#p140787"><![CDATA[
The 0=NTSC, 1=PAL NES, 2=Dendy scheme admits the following rules:<br /><ul><li>If non-zero, correct speeds. </li><li>If bit 0 is true, correct pitches and raster effects. </li></ul><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Feb 07, 2015 9:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2015-02-07T21:17:06-07:00</updated>
<published>2015-02-07T21:17:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140786#p140786</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140786#p140786"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140786#p140786"><![CDATA[
<div class="quotetitle">Drag wrote:</div><div class="quotecontent"><br />Wow, I really like your technique. Do you mind if I use it?<br /></div><br />Not at all... if I did I wouldn't have posted it! <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Sat Feb 07, 2015 9:17 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Drag]]></name></author>
<updated>2015-02-07T21:07:05-07:00</updated>
<published>2015-02-07T21:07:05-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140785#p140785</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140785#p140785"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140785#p140785"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />I use separate flags for the frame rare (60Hz = NTSC; 50Hz = PAL/Dendy) and for the VBlank length (long = PAL; short = NTSC/Dendy) because the Dendy is a mix of PAL and NTSC, so I'd rather make decisions based on these two aspects separately than check for a specific type of console.<br /></div><br />Wow, I really like your technique. Do you mind if I use it?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=21">Drag</a> — Sat Feb 07, 2015 9:07 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[lidnariq]]></name></author>
<updated>2015-02-07T20:49:42-07:00</updated>
<published>2015-02-07T20:49:42-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140780#p140780</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140780#p140780"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140780#p140780"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />This is why I think it's a better idea to wait the number of cycles that are supposed to pass and check the VBlank flag than wait for the VBlank flag and check how many cycles have passed. The hardware oversight becomes irrelevant.<br /></div>I'm not clear why it matters if we lose one or two vblanks? And being able to detect Dendy is handy, even though you gave good reasons to not care.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3512">lidnariq</a> — Sat Feb 07, 2015 8:49 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2015-02-07T20:26:10-07:00</updated>
<published>2015-02-07T20:26:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140779#p140779</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140779#p140779"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140779#p140779"><![CDATA[
<div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><br />BUT because of a hardware oversight, we might have missed a vblank flag.<br /></div><br />This is why I think it's a better idea to wait the number of cycles that are supposed to pass and check the VBlank flag than wait for the VBlank flag and check how many cycles have passed. The hardware oversight becomes irrelevant.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Sat Feb 07, 2015 8:26 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[lidnariq]]></name></author>
<updated>2015-02-07T20:11:10-07:00</updated>
<published>2015-02-07T20:11:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140778#p140778</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140778#p140778"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140778#p140778"><![CDATA[
Here's the detection code I added for the the NROM port of Driar:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;;; the &quot;nice&quot; thing is that I'm using the PPU power-on wait to detect the video system-<br />        ;; A,X,Y are all 0 at entry<br />@vwait1:<br />        bit $2002<br />        bpl @vwait1  ; at this point, about 27384 cycles have passed<br />@vwait2:<br />        inx<br />        bne @noincy<br />        iny<br />@noincy:<br />        bit $2002<br />        bpl @vwait2  ; at this point, about 57165 cycles have passed<br /><br />;;; BUT because of a hardware oversight, we might have missed a vblank flag.<br />;;;  so we need to both check for 1Vbl and 2Vbl<br />;;; NTSC NES: 29780 cycles / 12.005 -&gt; $9B0 or $1361 (Y:X)<br />;;; PAL NES:  33247 cycles / 12.005 -&gt; $AD1 or $15A2<br />;;; Dendy:    35464 cycles / 12.005 -&gt; $B8A or $1714<br /><br />        tya<br />        cmp #16<br />        bcc @nodiv2<br />        lsr<br />@nodiv2:<br />        clc<br />        adc #&lt;-9<br />        cmp #3<br />        bcc @noclip3<br />        lda #3<br />@noclip3:<br />;;; Right now, A contains 0,1,2,3 for NTSC,PAL,Dendy,Bad<br /></div>Modifying Driar's NMI was out of scope, so (like you) I wanted a NMI-less solution.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3512">lidnariq</a> — Sat Feb 07, 2015 8:11 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2015-02-07T17:38:12-07:00</updated>
<published>2015-02-07T17:38:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140771#p140771</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140771#p140771"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140771#p140771"><![CDATA[
Relying on sprites and rendering sounds like overkill to me... I do my region detection right after the mandatory waits for VBlank in the initialization code (i.e. it doesn't involve the NMI at all), when the CPU is reasonably aligned with the PPU:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   ;wait for the PPU to become stable<br />   bit PPUSTATUS<br />-   bit PPUSTATUS<br />   bpl -<br />-   bit PPUSTATUS<br />   bpl -<br /><br />;----------------------------------------------------------------<br />; console detection - start<br />;----------------------------------------------------------------<br /><br />   ;wait for the next NTSC vertical blank (PAL and Dendy would take longer)<br />   ldx #$70<br />-   ldy #$35<br />--   dey<br />   bne --<br />   dex<br />   bne -<br /><br />   ;detect whether the frame rate is 60Hz or 50Hz<br />   lda PPUSTATUS<br />   sta FrameRateIs60<br /><br />   ;wait enough time to reach the PAL vertical blank (Dendy would take longer)<br />   ldx #$70<br />-   ldy #$05<br />--   dey<br />   bne --<br />   dex<br />   bne -<br /><br />   ;detect whether vertical blanks are long or short<br />   lda PPUSTATUS<br />   sta VBlankIsLong<br /><br />;----------------------------------------------------------------<br />; console detection - end<br />;----------------------------------------------------------------</div><br />I use separate flags for the frame rare (60Hz = NTSC; 50Hz = PAL/Dendy) and for the VBlank length (long = PAL; short = NTSC/Dendy) because the Dendy is a mix of PAL and NTSC, so I'd rather make decisions based on these two aspects separately than check for a specific type of console.<br /><br />If you didn't care about telling PAL and Dendy apart, just the first part would be enough to detect NTSC vs. PAL/Dendy, and I think it's a pretty simple way to do it. You know you're in VBlank, so just wait enough cycles to be in VBlank again, if you're not, the console is not NTSC. Can't get any simpler.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Sat Feb 07, 2015 5:38 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2015-02-07T17:10:02-07:00</updated>
<published>2015-02-07T17:10:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140767#p140767</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140767#p140767"/>
<title type="html"><![CDATA[Re: NTSC/PAL detection through sprite 0]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12350&amp;p=140767#p140767"><![CDATA[
I suppose if you had no use for a frame counter or NMI lockout variable, the lightest you could make it is a 5 cycle indirect JMP at the head of your NMI routine, also taking up 2 permanent RAM bytes. (You would need a temporary frame counter during detection, but you can reuse it after startup.) Or if you want to avoid using any extra RAM you could BIT, BMI with your PAL/NTSC detect variable initialized to $80 in 6 cycles (7 if not ZP).<br /><br />5 cycles isn't much (you can barely store a byte to the PPU in this time), and it's certainly not an impediment to timed code.<br /><br />Still, if you don't need it, you don't need it. It's good to have other options, like Drag's.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Sat Feb 07, 2015 5:10 pm</p><hr />
]]></content>
</entry>
</feed>
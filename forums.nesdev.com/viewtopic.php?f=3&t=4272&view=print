<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Kid Dracula, Protection?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Kid Dracula, Protection?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=4272">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=4272</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Sun Aug 03, 2008 9:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Kid Dracula, Protection?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So after adding VRC4 support in my emu I noticed that Kid Dracula has a problem. On level 2, the level is missing all its enemies and moving platforms. Strangely enough this same problem showed up when I was making a mapper hack of the game.
<br />
<br />Anyone have any clue as to what this could be? Clever copy protection?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun Aug 03, 2008 9:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />- There's no copy protection. I would have to play it on my emu to check it out level 2... <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> Anyway, have you tried to disable IRQs? Good dump? CRC32?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Sun Aug 03, 2008 9:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Edit: No surprise, the problem is with the translated ROM, yet it seems the untranslated ROM works fine on my emu. But strangely the translated rom seems to work on Nintendulator.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Aug 04, 2008 7:58 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Both should work fine.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Mon Aug 04, 2008 1:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I would think so too, but I can't think of what the translator would have changed that would cause the game to break like this in my emulator. Guess I'll just have to experiment.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Aug 04, 2008 5:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You're probably having a problem about masking the address written. Try to use my tip.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>BMF54123</b> [ Mon Aug 04, 2008 10:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent">- There's no copy protection.</div>
<br />Maybe not "copy protection" per se, but it most certainly can tell if it's been hacked. The game deliberately removes the sprites in level 2 if you modify the ROM, according to Kitsune Sniper (the guy that translated it). He's also dealt with one other Konami game (Yume Penguin Monogatari) that has oddball protection, except in that case, it makes the game brutally difficult.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Mon Aug 04, 2008 11:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Did he go into detail or am I going to have to try to contact him myself? 
<br />
<br />It think it is copy protection when you consider they were protecting against pirates making the game run on their own mapper and manufacturing illegal copied carts.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue Aug 05, 2008 7:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, no progress on finding out the cause, but I did notice, I can start the unpatched ROM, make a save state, load it on the translated rom, and then the translated ROM runs with no apparent problems, even when you reach level 2.
<br />
<br />Edit:
<br />I have figured out why the translated ROM was not working. Not to be mean, but the person that "cracked" the copy protection for the translation did it in a really crude way. However this way managed to bring a bug in my CPU core to my attention. My BRK instruction was messed up. Anyway, now the translated ROM works and I'm happy.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>BMF54123</b> [ Tue Aug 05, 2008 9:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">I have figured out why the translated ROM was not working. Not to be mean, but the person that "cracked" the copy protection for the translation did it in a really crude way. However this way managed to bring a bug in my CPU core to my attention. My BRK instruction was messed up. Anyway, now the translated ROM works and I'm happy.</div>
<br />Care to explain how the protection works/was cracked, exactly? I've always been curious myself, since Kitsune never went into detail about it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue Aug 05, 2008 10:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In short, the game writes a non-zero to $0021. This is done during a check at bootup. You could NOP the branches to the instruction that is INC $21 (E6 21) or probably just NOP the instruction INC $21. In the translation patch, instead he wrote BRK #$00 over it. The translation fails to pass the check, but obviously the flag is never set so it doesn't matter. From what I saw of the routine, it seems to just check some CHR-ROM to make sure it hasn't been modified.
<br />
<br />I just played from beginning to end on my emulator and everything went just fine. 
<br />
<br />One last thing, there's a CMP #$0E followed by a branch, and then a CPY #$BC followed by a branch. They both goto $FFA5 I think it was, and this is just INC $21, RTS. It would make the most sense to NOP the branches.
<br />
<br />From what I heard, the protection seems to make sure pirates don't alter the title screen or something.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>BMF54123</b> [ Tue Aug 05, 2008 10:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">From what I heard, the protection seems to make sure pirates don't alter the title screen or something.</div>
<br />Huh. You'd think they would check the PRG as well, since a lot of pirates hack out the copyright info there, and leave the CHR untouched (or modify the code to work with their own mapper, as you suggested). <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>_Zaphod_</b> [ Fri Oct 10, 2008 7:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Bucky O Hare is another game to do that trick. if it detects tampering with the title screen, it makes you die in one hit. Normally, you have a life bar!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sat Oct 11, 2008 9:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well that's fun. Gradius II makes you instantly dies if SRAM is disabled.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Kit Sniper</b> [ Sun Nov 02, 2008 11:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Um, hi.
<br />
<br />KingMike just told me about this thread. Sorry for the late reply. According to the readme...
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Special thanks to King Mike for telling me about the ASM routine that was messing up the game when I hacked the title.</div>
<br />
<br />That hack is KingMike's fault, but I can't find the email he sent me ages ago... It's not in my main Parodius email archive, or my Hotmail / Yahoo archives. So I can't prove he helped me, heh.
<br />
<br />... I'm a complete moron when it comes to assembly, or programming in general. I'm an English / Spanish translator, not a programmer. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /> Sorry for all the problems that this caused.
<br />
<br />P.S.
<br />So um, what do I have to do to get things to work right?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=10&amp;t=7218" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2010-12-03T20:28:24-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=10&amp;t=7218</id>
<entry>
<author><name><![CDATA[Tom]]></name></author>
<updated>2010-12-03T20:28:24-07:00</updated>
<published>2010-12-03T20:28:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70994#p70994</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70994#p70994"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70994#p70994"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />Then the shell casing should be a separate sound effect that starts when the animation starts.<br /></div><br />That'll work sometimes, but other times it won't be convenient.  If you had the sound of the gunfire and the shell casing as a single recording, for instance.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=120">Tom</a> — Fri Dec 03, 2010 8:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2010-12-03T20:18:53-07:00</updated>
<published>2010-12-03T20:18:53-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70993#p70993</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70993#p70993"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70993#p70993"><![CDATA[
<div class="quotetitle">Tom wrote:</div><div class="quotecontent"><br />Did you mean something like this?<br /></div><br />Yup, exactly that! =)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />I can't think of any existing game where the sound effects need to be synchronized with the animation.  It still bugs me a little.<br /></div><br />Well, to be fair, stretching them by skipping updates will probably just make them sound wrong, so it's not really a good solution.<br /><br />In every game I can think of, it's important that sound effects begin at the correct time, but if by any chance the video lags that doesn't really result in any weirdness.<br /><br />As for the games tepples listed, I wouldn't expect those kinds of games to drop frames, since they aren't very CPU-intensive. I mean, how complicated is it to move a few graphics around and match input to internal tables?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Fri Dec 03, 2010 8:18 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-12-03T20:08:12-07:00</updated>
<published>2010-12-03T20:08:12-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70992#p70992</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70992#p70992"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70992#p70992"><![CDATA[
<div class="quotetitle">Tom wrote:</div><div class="quotecontent"><br />For instance, consider a FPS, which has a machine gun.  If the animation for firing the gun includes showing shell casings, you'll want to make sure the sound of the shell casing happens in sync with the animation.<br /></div><br />Then the shell casing should be a separate sound effect that starts when the animation starts.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Dec 03, 2010 8:08 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Tom]]></name></author>
<updated>2010-12-03T20:04:28-07:00</updated>
<published>2010-12-03T20:04:28-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70991#p70991</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70991#p70991"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70991#p70991"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br /><div class="quotetitle">Tom wrote:</div><div class="quotecontent">I think the problem is theoretical; I can't think of any existing game where the sound effects need to be synchronized with the animation.<br /></div><br />Parappa. Beatmania. Frequency. Amplitude. Guitar Hero. DJ Hero. D+Pad Hero.</div><br />True, these types of games require synchronization.  But I was thinking more generally.  For instance, consider a FPS, which has a machine gun.  If the animation for firing the gun includes showing shell casings, you'll want to make sure the sound of the shell casing happens in sync with the animation.  But on the NES, both animations and sound effects are lot simpler, so I can't think of existing NES games where this would matter (D+Pad Hero excluded).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=120">Tom</a> — Fri Dec 03, 2010 8:04 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-12-03T19:46:13-07:00</updated>
<published>2010-12-03T19:46:13-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70988#p70988</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70988#p70988"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70988#p70988"><![CDATA[
<div class="quotetitle">Tom wrote:</div><div class="quotecontent"><br />I think the problem is theoretical; I can't think of any existing game where the sound effects need to be synchronized with the animation.<br /></div><br />Parappa. Beatmania. Frequency. Amplitude. Guitar Hero. DJ Hero. D+Pad Hero.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Dec 03, 2010 7:46 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Tom]]></name></author>
<updated>2010-12-03T19:43:45-07:00</updated>
<published>2010-12-03T19:43:45-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70987#p70987</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70987#p70987"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70987#p70987"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />Tom, you might be able to deal with these problems by using a flag system similar to the one used for PPU stuff<br /></div><br />I'm not sure I understood what you meant.  Did you mean something like this?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">start_sound_effect:<br />    ; ProtectionFlag should be 0 here<br />    inc ProtectionFlag<br />    <br />    ; change sound engine memory<br />    <br />    ; check if nmi interrupted us<br />    lda ProtectionFlag<br />    bne skip<br /><br />    ; nmi happened, and skipped update, so do it now<br />    jsr update_sound_engine<br /><br />skip:<br />    lda #0<br />    sta ProtectionFlag<br />    rts<br /><br />nmi:<br />    lda ProtectionFlag<br />    beq nmi_update_music<br /><br />    ; in middle of critical code, delay update until after it's done<br />    lda #0<br />    sta ProtectionFlag<br />    rti<br /><br />nmi_update_music:<br />    jsr update_sound_engine<br />    rti<br /></div><br />That seems pretty workable.  Of course, five minutes after I posted my other message I thought of a decent enough way to queue up commands for the sound engine to run during NMI, but it would require some more ram for the buffer that your method doesn't need.<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />As for the sound effects, remember that the NMI routine has ways to know if a frame was missed or not, so as long as your sound engine knows the difference between music and sound effects it can delay the sound effects in case of lag frames.<br /></div><br />Interesting.  My sound engine doesn't distinguish music and sound effects, so I hadn't thought of that.  Still, I think the problem is theoretical; I can't think of any existing game where the sound effects need to be synchronized with the animation.  It still bugs me a little.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=120">Tom</a> — Fri Dec 03, 2010 7:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2010-12-03T18:07:20-07:00</updated>
<published>2010-12-03T18:07:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70984#p70984</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70984#p70984"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70984#p70984"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br />But PAL's vblank is over three times as long. So if you have the RAM to spare for a bigger transfer buffer, and you have some CPU time to spare, you could design the engine so that the PAL version's camera can move faster.<br /></div><br />Yeah, that's an option, but RAM isn't a very abundant resource on the NES. Also, even though the PAL VBlank is longer, the rendered frame is shorter (in CPU cycles of course, it is the same as the NTSC one visually), so the fact that you'll have to fill more buffers during that time is more likely to cause slowdown.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Fri Dec 03, 2010 6:07 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-12-03T17:27:57-07:00</updated>
<published>2010-12-03T17:27:57-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70983#p70983</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70983#p70983"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70983#p70983"><![CDATA[
<div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><br />If you are working with NTSC and want to convert that to PAL, the camera would have to move faster than 16 pixels per frame in order to have the same apparent maximum speed, and that would screw up your background rendering. So you have to make sure that 16 pixels per frame is the maximum speed on PAL, but 13 1/3 in NTSC.<br /></div><br />But PAL's vblank is over three times as long. So if you have the RAM to spare for a bigger transfer buffer, and you have some CPU time to spare, you could design the engine so that the PAL version's camera can move faster.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Fri Dec 03, 2010 5:27 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2010-12-03T17:07:20-07:00</updated>
<published>2010-12-03T17:07:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70981#p70981</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70981#p70981"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70981#p70981"><![CDATA[
<div class="quotetitle">Memblers wrote:</div><div class="quotecontent"><br />I have been curious, I haven't tried it yet but how well it would work to use fixed-point for everything timing-related, and then have the assembler calculate the timing for PAL/NTSC.  Seems like it should work OK, maybe it could some variations/errors, but probably nothing all that bad.<br /></div><br />I have considered doing that... In theory it should work, but I can't stop thinking that the limited precision of fixed-point numbers could make some things behave visibly different between versions.<br /><br />You also have to be careful about things that could break due to limitations of your engine... Scrolling, for example. If your scrolling engine can update a column of metatiles that's 16-pixels wide every frame, the maximum speed of the camera is 16 pixels per frame. If you are working with NTSC and want to convert that to PAL, the camera would have to move faster than 16 pixels per frame in order to have the same apparent maximum speed, and that would screw up your background rendering. So you have to make sure that 16 pixels per frame is the maximum speed on PAL, but 13 1/3 in NTSC.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Fri Dec 03, 2010 5:07 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Memblers]]></name></author>
<updated>2010-12-03T16:33:08-07:00</updated>
<published>2010-12-03T16:33:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70978#p70978</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70978#p70978"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70978#p70978"><![CDATA[
I have been curious, I haven't tried it yet but how well it would work to use fixed-point for everything timing-related, and then have the assembler calculate the timing for PAL/NTSC.  Seems like it should work OK, maybe it could some variations/errors, but probably nothing all that bad.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=10">Memblers</a> — Fri Dec 03, 2010 4:33 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[cartlemmy]]></name></author>
<updated>2010-12-03T09:31:35-07:00</updated>
<published>2010-12-03T09:31:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70956#p70956</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70956#p70956"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70956#p70956"><![CDATA[
<div class="quotetitle">Memblers wrote:</div><div class="quotecontent"><br />I used to do timing that way, but in most cases it turned out to be really limiting compared to using a fixed-point counter.  With fixed point for example, if you wanted to do something every 2 frames, you would add $80 to the counter every frame, and trigger on carry.  Instead of $80 though you can add any value (zero would stop it) for 256 different speeds.<br /></div><br /><br />True, and I do use such a counter as well... But it's cool to not have to use an extra byte of memory (and some cpu time) if your counter happens to need to fire every 2^(0...7) times.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4574">cartlemmy</a> — Fri Dec 03, 2010 9:31 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2010-12-03T08:16:13-07:00</updated>
<published>2010-12-03T08:16:13-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70949#p70949</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70949#p70949"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70949#p70949"><![CDATA[
Tom, you might be able to deal with these problems by using a flag system similar to the one used for PPU stuff:<br /><br />All sound-related functions could have a protection flag. For example, when you call a function requesting that a new song starts playing, this function will first set this protection flag indicating that critical sound operations are happening. In the NMI, when the time to update the sound comes, check this flag. If a crucial operation was interrupted, meaning that pointers and other variables could be inconsistent, you just clear the flag and return. The CPU will then resume the critical code, and before finishing, it checks the flag. If it is clear, it calls the routine that updates the sound, if not, it just clears it and returns.<br /><br />The good thing about audio is that, unlike the video, you can update it at any time, so the delays will actually be very subtle, instead of whole frames, and will probably go unnoticed.<br /><br />As for the sound effects, remember that the NMI routine has ways to know if a frame was missed or not, so as long as your sound engine knows the difference between music and sound effects it can delay the sound effects in case of lag frames. Most of the time I think you'd not want to do that, but if it's really important that some effects are in sync, you could add a flag to each sound effect indicating whether they should lag along with the video.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Fri Dec 03, 2010 8:16 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Tom]]></name></author>
<updated>2010-12-02T22:20:54-07:00</updated>
<published>2010-12-02T22:20:54-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70941#p70941</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70941#p70941"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70941#p70941"><![CDATA[
<div class="quotetitle">MottZilla wrote:</div><div class="quotecontent"><br />I forget which games do it, but some have bad music distorting/slowdown when the game slows down because they do not update the music engine every 1/60th second if the game is slowing down due to heavy cpu load. You should avoid this.<br /></div><br />I've been thinking about this lately.  There's two potential problems with updating the sound engine in NMI.  The first is it's possible you have a sound effect or something that's synchronized with some graphical animation.  So if there's lag, they'll get desynchronized.  I think this is probably not a huge problem, practically speaking.<br /><br />The bigger problem is if you're updating the sound engine in the main loop (like starting a sound effect), and an NMI triggers in the middle of it, things could go pretty wrong.   With the PPU the solution is to buffer any changes, and set a flag when it's ready for the NMI to use.  But sound engines tend to be more complicated, making such buffering harder (I haven't figured out a good way to do it with my engine yet).<br /><br />One the other hand, if you only update the sound engine in the main loop, you can just buffer the values to write to the sound registers pretty easily for NMI use.  Of course if there's lag, the sound with also slowdown.  Worse, if you're using hardware effects (length counters, sweeps etc), those won't lag, which could sound pretty bad.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=120">Tom</a> — Thu Dec 02, 2010 10:20 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Memblers]]></name></author>
<updated>2010-12-02T21:07:35-07:00</updated>
<published>2010-12-02T21:07:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70940#p70940</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70940#p70940"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70940#p70940"><![CDATA[
<div class="quotetitle">cartlemmy wrote:</div><div class="quotecontent"><br />Ah yes, actually I guess I use a counter. I like using the counter, because you can use it for things like "Do this every <em>n</em> frames":<br /></div><br /><br />I used to do timing that way, but in most cases it turned out to be really limiting compared to using a fixed-point counter.  With fixed point for example, if you wanted to do something every 2 frames, you would add $80 to the counter every frame, and trigger on carry.  Instead of $80 though you can add any value (zero would stop it) for 256 different speeds.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=10">Memblers</a> — Thu Dec 02, 2010 9:07 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MottZilla]]></name></author>
<updated>2010-12-02T20:47:38-07:00</updated>
<published>2010-12-02T20:47:38-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70939#p70939</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70939#p70939"/>
<title type="html"><![CDATA[Controlling Play Speed]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=7218&amp;p=70939#p70939"><![CDATA[
Well it seems you have a clear path of calculations you could cut out. But then you have to manage when to cut them when not to and you'd want to avoid a see-saw effect where it runs normal for a few frames, then lags for a frame or two. That would be worse than a constant slowdown. So you might want to drop unnecessary calculations based on something better than missed frames and either combine it with missed frames and number of active objects relative to a known amount that causes slowdown. So if the player and a few objects are on screen you can use the extra cpu time but when you get alot of objects and are running out of time you can free some up. <br /><br />It's an interesting problem. Slowdown should definitely be avoided but it's acceptable in certain places and even in others it might be disliked but still not ruin the entire game.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1726">MottZilla</a> — Thu Dec 02, 2010 8:47 pm</p><hr />
]]></content>
</entry>
</feed>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=2&amp;t=12233" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2015-01-12T16:53:37-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=2&amp;t=12233</id>
<entry>
<author><name><![CDATA[Pokun]]></name></author>
<updated>2015-01-12T16:53:37-07:00</updated>
<published>2015-01-12T16:53:37-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139165#p139165</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139165#p139165"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139165#p139165"><![CDATA[
I see. Figures it was MMC5.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6013">Pokun</a> — Mon Jan 12, 2015 4:53 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2015-01-12T13:07:06-07:00</updated>
<published>2015-01-12T13:07:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139150#p139150</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139150#p139150"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139150#p139150"><![CDATA[
The &quot;Why Game Paks Never Forget&quot; article in <em>Nintendo Power</em> states that MMC5 contains improved protection circuitry that doesn't require holding Reset.<br /><br />And perhaps MMC6, which has independent write protection for both banks and whose SRAM size is too small to use as work RAM, might be less sensitive to bus noise during power loss.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Mon Jan 12, 2015 1:07 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Pokun]]></name></author>
<updated>2015-01-12T05:41:45-07:00</updated>
<published>2015-01-12T05:41:45-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139141#p139141</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139141#p139141"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139141#p139141"><![CDATA[
That's good to know. On the contrary the Everdrive uses battery backed SRAM which contains the save data until another game is loaded in which case it's copied to the SD card (If you play the same game again the next time you turn on it's never copied though). So I guess holding reset is needed on the Everdrive.<br /><br />What mappers doesn't require holding reset? I remember reading in a Swedish Nintendo magazine that Nintendo worked on a way to protect the save data, but I never heard of a game that used that.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6013">Pokun</a> — Mon Jan 12, 2015 5:41 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[thefox]]></name></author>
<updated>2015-01-12T00:48:49-07:00</updated>
<published>2015-01-12T00:48:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139129#p139129</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139129#p139129"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139129#p139129"><![CDATA[
<div class="quotetitle">Sik wrote:</div><div class="quotecontent"><br />I was talking in general, the reason many NES games tell you to hold down the reset button while turning off is because they have risk of the mapper allowing writes to save RAM during the unstable period while it shuts off, potentially corrupting the data in it.<br /></div><br />This doesn't apply to PowerPak though, because PowerPak has no battery backing for the SRAM (it's saved to the CF card while the system power is on), so the save data never has a chance of getting corrupted due to powering the system off.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=80">thefox</a> — Mon Jan 12, 2015 12:48 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2015-01-11T17:43:15-07:00</updated>
<published>2015-01-11T17:43:15-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139109#p139109</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139109#p139109"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139109#p139109"><![CDATA[
&quot;Hold reset on NES&quot; subject has already been discussed before (2nd thread relates to SNES but see tokumaru's post for relevancy; best guess is same thing as what's stated in previous thread):<br /><br /><!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=10949">viewtopic.php?f=9&amp;t=10949</a><!-- l --><br /><!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?f=5&amp;t=11962">viewtopic.php?f=5&amp;t=11962</a><!-- l --><br /><br />Stay focused!  :-)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Sun Jan 11, 2015 5:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Sik]]></name></author>
<updated>2015-01-11T15:13:09-07:00</updated>
<published>2015-01-11T15:13:09-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139096#p139096</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139096#p139096"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139096#p139096"><![CDATA[
I was talking in general, the reason many NES games tell you to hold down the reset button while turning off is because they have risk of the mapper allowing writes to save RAM during the unstable period while it shuts off, potentially corrupting the data in it.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4526">Sik</a> — Sun Jan 11, 2015 3:13 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[thefox]]></name></author>
<updated>2015-01-11T11:54:24-07:00</updated>
<published>2015-01-11T11:54:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139087#p139087</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139087#p139087"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139087#p139087"><![CDATA[
<div class="quotetitle">Sik wrote:</div><div class="quotecontent"><br />Depends entirely on the mapper I believe. Some mappers pay attention to whether the CPU is writing or not (those are safe) but some (most?) just check if the CPU accesses a given address, regardless of whether it's read or write (those are not safe).<br /></div><br />The bug I was referring to was PowerPak-specific, specifically this: <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?p=89777#p89777">viewtopic.php?p=89777#p89777</a><!-- l --><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=80">thefox</a> — Sun Jan 11, 2015 11:54 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Sik]]></name></author>
<updated>2015-01-11T11:01:55-07:00</updated>
<published>2015-01-11T11:01:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139082#p139082</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139082#p139082"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139082#p139082"><![CDATA[
Depends entirely on the mapper I believe. Some mappers pay attention to whether the CPU is writing or not (those are safe) but some (most?) just check if the CPU accesses a given address, regardless of whether it's read or write (those are not safe).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4526">Sik</a> — Sun Jan 11, 2015 11:01 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[thefox]]></name></author>
<updated>2015-01-11T05:09:13-07:00</updated>
<published>2015-01-11T05:09:13-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139071#p139071</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139071#p139071"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139071#p139071"><![CDATA[
Some older PowerPak mappers may have problems with WRAM corruption, although I'm not sure if that applies here.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=80">thefox</a> — Sun Jan 11, 2015 5:09 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Vectrex2809]]></name></author>
<updated>2015-01-11T05:07:21-07:00</updated>
<published>2015-01-11T05:07:21-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139070#p139070</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139070#p139070"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139070#p139070"><![CDATA[
Also, just wondering. Is there some relation with such data corruption and the infamous &quot;Hold reset while turning off unit&quot; message with the Legend of Zelda and other battery-backed games?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6607">Vectrex2809</a> — Sun Jan 11, 2015 5:07 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Vectrex2809]]></name></author>
<updated>2015-01-11T03:32:05-07:00</updated>
<published>2015-01-11T03:32:05-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139069#p139069</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139069#p139069"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139069#p139069"><![CDATA[
There's not too much save game data in the game indeed. To tell you the truth, I was thinking about using WRAM for the name entry screen and the high scores only. I'll try to implement a checksum, but I was also thinking about dropping the save feature since there's not too much data to be saved...<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6607">Vectrex2809</a> — Sun Jan 11, 2015 3:32 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Sik]]></name></author>
<updated>2015-01-10T17:30:02-07:00</updated>
<published>2015-01-10T17:30:02-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139038#p139038</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139038#p139038"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139038#p139038"><![CDATA[
If I recall correctly that was mentioned in the SNES manual.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4526">Sik</a> — Sat Jan 10, 2015 5:30 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2015-01-10T16:47:43-07:00</updated>
<published>2015-01-10T16:47:43-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139030#p139030</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139030#p139030"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139030#p139030"><![CDATA[
Yeah, a proper CRC check should be used.  What I've seen done in commercial games (SNES/SFC titles, however) is that they use a portion of battery-backed SRAM for the actual data, but write it to multiple locations along with a CRC stored with the data.  E.g. $6000-60FD would be your data, with the CRC of all data in $60FE-60FF, then $6100-61FD would be a copy of the same data in $6000-60FD and CRC in $61FE-61FF, etc...<br /><br />This allowed some redundancy in case some of the areas of SRAM had issues, e.g. if CRC for $6000-60FD didn't match, try the next &quot;section&quot;, yadda yadda.  How much redundancy you want is up to you, but I imagine 3 copies would be enough.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Sat Jan 10, 2015 4:47 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tokumaru]]></name></author>
<updated>2015-01-10T16:23:04-07:00</updated>
<published>2015-01-10T16:23:04-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139029#p139029</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139029#p139029"/>
<title type="html"><![CDATA[Re: Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139029#p139029"><![CDATA[
Only one byte working as a flag to indicate the validity of  WRAM? You shoul implement a chacksum or something stronger.<br /><br />Also, are you only using $6000-$60FF?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=95">tokumaru</a> — Sat Jan 10, 2015 4:23 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Vectrex2809]]></name></author>
<updated>2015-01-10T10:12:40-07:00</updated>
<published>2015-01-10T10:12:40-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139009#p139009</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139009#p139009"/>
<title type="html"><![CDATA[Save data corruption on flashcarts?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=12233&amp;p=139009#p139009"><![CDATA[
Currently, I'm about to finish one of my NES projects and it seems like save game data gets sometimes corrupted when using it on a flashcart according to my gametesters (See pictures on how it looks like and how it's supposed to look like). The save game data that's causing problems is the player name and the arrow positions which are supposed to be kept if the game is turned off. To quote one of my gametesters - &quot;<em>I am seeing another possible issue though. This has happened twice to me now. Not sure if it is the powerpak or not, but I will run the game for hours upon hours at a time and have no problems. I will turn off the game for a day or so, and then when I turn it back on the screen where you make your name, choose the music, and that good stuff trips out. The letter options for the name are shapes, symbols, and what looks like heiroglyphics. The arrows where you choose the music, see high score and stuff, are above the options, and can go all the way to the left and right side of the screen. <br />you can continue off that screen, but the name you chose are the same shapes and symbols. <br /><br />I can remove the file from my powerpak and put the one you gave me back on, and it works fine again until you turn it off for awhile, and then it does it again</em>&quot;.<br />Also, when I play my game on NEStopia for mac, the baterry backed WRAM works flawlessly, however, it doesn't on FCEUX for Windows (Using Parallels Desktop), at least when you close the emulator. The game data just resets...<br /><br /><a href="http://s1074.photobucket.com/user/KilleRotom/media/deal000_zpsf11eb460.png.html" class="postlink"><img src="http://i1074.photobucket.com/albums/w408/KilleRotom/deal000_zpsf11eb460.png" alt="Image" /></a> How it's supposed to look like<br /><br /><a href="http://s603.photobucket.com/user/111492KH/media/IMG_6171_zps92b97789.jpg.html" class="postlink"><img src="http://i603.photobucket.com/albums/tt111/111492KH/IMG_6171_zps92b97789.jpg" alt="Image" /></a><br /><br /><a href="http://s603.photobucket.com/user/111492KH/media/IMG_6172_zpsb3898304.jpg.html" class="postlink"><img src="http://i603.photobucket.com/albums/tt111/111492KH/IMG_6172_zpsb3898304.jpg" alt="Image" /></a><br /><br /><a href="http://s603.photobucket.com/user/111492KH/media/IMG_6173_zpse7ce97e5.jpg.html" class="postlink"><img src="http://i603.photobucket.com/albums/tt111/111492KH/IMG_6173_zpse7ce97e5.jpg" alt="Image" /></a> How it looks like on a PowerPak<br /><br /><br />Here's some of my code. It's from an outdated version of my game but it is essentially the same in later versions (Don't have my src with me, sorry)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">  LDA wramcheck<br />  BNE NoReset<br />  LDX #$00<br /><br />Reset_VRAM:      ;Resets VRAM if needed<br /><br />  LDA #$00         ;Puts zeros on all VRAM vatiables in the $6000 range<br />  STA $6000,x<br />  INX<br />  CPX #$00<br />  BNE Reset_VRAM<br /><br />  LDA #$7F<br />  STA playername<br />  STA playername+1<br />  STA playername+2<br />  STA playername+3<br />  STA playername+4<br />  STA playername+5<br />  STA playername+6<br />  STA playername+7<br /><br />  LDA #$8F<br />  STA music<br />  LDA #$D5<br />  STA scores<br />  LDA #$11<br />  STA ok<br /><br />  INC wramcheck<br /><br />NoReset:</div><br /><br />This is the WRAM reset routine. the wramcheck variable is only supposed to go back to zero when you do a specific task.<br /><br />Don't know if you need more code. I'm sorry but I don't have my SRC with me since I'm on a vacation<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6607">Vectrex2809</a> — Sat Jan 10, 2015 10:12 am</p><hr />
]]></content>
</entry>
</feed>
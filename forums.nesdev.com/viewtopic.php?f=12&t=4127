<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - SPC questions</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - SPC questions" href="http://forums.nesdev.com/feed.php?f=12&amp;t=4127" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sat Sep 20, 2014 5:53 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=4127">SPC questions</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=4127"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=4127&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=4127&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=4127&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p33597"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33597">SPC questions</a></div><div style="float: right;"><a href="./viewtopic.php?p=33597#p33597"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 23, 2008 5:32 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 6040<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I don't know accurate knownledge about the SPC currently is, but I've a couple of questions :
<br />
<br />- What kind of delay there is with key on/key off operations ? I've tried to make test programms, if I key on without ever keying off, I get an annoying slapping sound (I don't know about on the real hardware). If I key off right before I key on, on some SPC players/emulators the key on is ignored. Is the solution to key off a decent time before each key on the only accurate/viable solution ?
<br />
<br />- About the DIV instruction.... It takes 16 bit input and only 8-bit output. What happen if you do 65535/1 ? The result would sure not fit 8-bit quotient+8-bit remainder. I guess you only get low 8 bits of result but the real remainder (that's the only thing that make sense when using shift-and-substract method). What does division by zero output ? I guess result is always $ff and remainder is the original dividend (that would make the most sense again) but no doccument specifies that.
<br />
<br />- Is it possible to change echo delay during playback very quickly to get reverb ?
<br />
<br />- When echo is enabled back on a channel after being disabled, I suppose this only allow output from that channel to go into the echo buffer to be heard again later at lower volume. I've seen some SPC players/emulators emulate it so that as soon as echo is enabled past sound data is heard from that channel even if it was disabled before. As I don't see how the past data could go into the echo buffer (unless each channel has its own individual echo buffer, which isn't the case), I guess this can only be wrong, but again I'm not sure.
<br />
<br />- The processor have DI and EI instruction to enable/disable interrups. But is there any other source of interrupt than reset ? (I doubt reset is maskable). It's said that reset vector is stored at $fffe but I don't see any other interrupt vector mentionned in docs.</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p33600"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33600">Re: SPC questions</a></div><div style="float: right;"><a href="./viewtopic.php?p=33600#p33600"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 23, 2008 8:40 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">- What kind of delay there is with key on/key off operations ?</div><br /><br />Key On / Off are both polled once every 64 cycles (every other sample).<br /><br />With Key Off, the voice switches to Release mode (but envelope is not changed).<br /><br />With Key On, the voice switches to Attack, Envelope is reset to 0, and BRR decoding resets.  Those last two can cause a very ugly pop if done carelessly (this is probably the "slap" you're talking about).<br /><br />If you Key On / Key Off at the same time (or within the same 64 cycle window), iirc Key On takes priority, but the channel will be keyed off 64 cycles later because Key On is automatically cleared, whereas Key Off isn't.  In either case, the end result would be abrupt silence because envelope is reset to 0 on keyon, then switched to Release on keyoff -- and there's not enough time in between them for any samples to become audible (keying on causes about 5 samples of silence to allow for the BRR decoder to get samples ready)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Is the solution to key off a decent time before each key on the only accurate/viable solution ?</div><br /><br />Pretty much, yeah.  Abrupt envelope changes will cause ugly pops, and the best way I can think of to avoid that is to let Release finish its job before restarting.  At full envelope ($7FF) it'll take 256 samples (8192 cycles) for the envelope to release completely.  So:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">mov $F2, #$5C<br />mov $F3, #%00000001&nbsp; &nbsp;; key off voice 0<br /><br />; ~8192 cycles later<br />mov $F2, #$5C<br />mov $F3, #0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; clear keyoff<br />mov $F2, #$4C<br />mov $F3, #%00000001&nbsp; &nbsp;; key on voice 0<br /></div><br /><br />Since keyon is cleared automatically once processed, you don't have to clear it yourself.  However that is not true for keyoff -- you must manually clear it.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">About the DIV instruction.... It takes 16 bit input and only 8-bit output. What happen if you do 65535/1 ?</div><br /><br />Any division that results in a quotient higher than $200 will return more-or-less meaningless results.  Programs can check the V flag after division to make sure such a case didn't happen (V will be set when quotient &gt;= $100).<br /><br />The shift algorithm in Anomie's doc can't be right -- I tried it with some sample numbers and got incorrect results ($1000 / $80 got me $1F) -- unless the SPC's division really is that unreliable?<br /><br />I took the following code from BSNES:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; ya = regs.ya;<br />//overflow set if quotient &gt;= 256<br />&nbsp; regs.p.v = !!&#40;regs.y &gt;= regs.x&#41;;<br />&nbsp; regs.p.h = !!&#40;&#40;regs.y &amp; 15&#41; &gt;= &#40;regs.x &amp; 15&#41;&#41;;<br />&nbsp; if&#40;regs.y &lt; &#40;regs.x &lt;&lt; 1&#41;&#41; &#123;<br />&nbsp; //if quotient is &lt;= 511 &#40;will fit into 9-bit result&#41;<br />&nbsp; &nbsp; regs.a = ya / regs.x;<br />&nbsp; &nbsp; regs.y = ya % regs.x;<br />&nbsp; &#125; else &#123;<br />&nbsp; //otherwise, the quotient won't fit into regs.p.v + regs.a<br />&nbsp; //this emulates the odd behavior of the S-SMP in this case<br />&nbsp; &nbsp; regs.a = 255&nbsp; &nbsp; - &#40;ya - &#40;regs.x &lt;&lt; 9&#41;&#41; / &#40;256 - regs.x&#41;;<br />&nbsp; &nbsp; regs.y = regs.x + &#40;ya - &#40;regs.x &lt;&lt; 9&#41;&#41; % &#40;256 - regs.x&#41;;<br />&nbsp; &#125;<br />//result is set based on a &#40;quotient&#41; only<br />&nbsp; regs.p.n = !!&#40;regs.a &amp; 0x80&#41;;<br />&nbsp; regs.p.z = &#40;regs.a == 0&#41;;<br /></div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">- Is it possible to change echo delay during playback very quickly to get reverb ?<br /></div><br /><br />Not entirely sure what you're trying to accomplish, but probably not.  The Echo delay reg is only used when the echo comes full circle back to the start of the ring buffer.  So if you have an echo size of $1000 samples (EDL=8), and you change EDL to 0 -- it could be up to $1000 samples before the newly written delay takes effect.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">- When echo is enabled back on a channel after being disabled, I suppose this only allow output from that channel to go into the echo buffer to be heard again later at lower volume.</div><br /><br />Correct -- though it doesn't <em>necessarily</em> have to be a lower volume  ;P  (but it probably should for the sake of not damaging your eardrums)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">- The processor have DI and EI instruction to enable/disable interrups. But is there any other source of interrupt than reset ? (I doubt reset is maskable). It's said that reset vector is stored at $fffe but I don't see any other interrupt vector mentionned in docs.</div>
<br />
<br />Not that I know of.  I look at the I flag on the SPC like I look at the D flag on the 2A03.  The only impact it really has is changing the value pushed when status is put on the stack.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p33609"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33609"></a></div><div style="float: right;"><a href="./viewtopic.php?p=33609#p33609"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 23, 2008 4:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The shift algorithm in Anomie's doc can't be right -- I tried it with some sample numbers and got incorrect results ($1000 / $80 got me $1F) -- unless the SPC's division really is that unreliable?</div><br />Anomie's and my division algorithm are both correct, I believe. I'm pretty sure I compared his for every input with mine. My version was compared with hardware for <em>all</em> 16.8 million possible inputs (took about 13 minutes to run on a SNES). bsnes uses mine, which just takes advantage of the host's division operator, rather than doing itcloser to how the SPC-700 probably does it in hardware, as Anomie's does.<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The processor have DI and EI instruction to enable/disable interrups. But is there any other source of interrupt than reset ? (I doubt reset is maskable).</div>
<br />No interrupt pin known, so EI, DI, and SLEEP are almost useless. Presumably SLEEP would halt the processor until an interrupt was received, much like WAI on the 65816.
<br />
<br />Bregalad, bsnes should handle all the things you mention accurately. Are you unable to run it for some reason?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p33614"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33614"></a></div><div style="float: right;"><a href="./viewtopic.php?p=33614#p33614"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 24, 2008 1:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 6040<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Ah, it's a good thing to know BSNES is that accurate. I knew it was accurate when it comes to video, but I wouldn't exept it to mean the SPC is accurate too, becuase as far I know Nintendulator is very very accurate for vido it isn't that accurate for sound.
<br />
<br />Thanks for the usefull replies. BTW using the hosts division wouldn't throw an exeption if divizor is zero, as opposed to the old shift method which would work in all cases ?</div>

					
						<div class="postbody"><br />_________________<br />Life is complex: it has both real and imaginary components.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p33615"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33615"></a></div><div style="float: right;"><a href="./viewtopic.php?p=33615#p33615"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 24, 2008 3:50 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">BTW using the hosts division wouldn't throw an exeption if divizor is zero, as opposed to the old shift method which would work in all cases ?</div>
<br />The denominator can never be zero in the above code. In the first case, for y to be &lt; x*2, x must be non-zero. In the second case, 256-x is always non-zero.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p33618"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33618"></a></div><div style="float: right;"><a href="./viewtopic.php?p=33618#p33618"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 24, 2008 7:52 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Anomie's and my division algorithm are both correct, I believe. I'm pretty sure I compared his for every input with mine.</div>
<br />
<br />Could I have transcribed it wrong or something?
<br />
<br />Here is the algorithm in question:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; uint17 yva=YA<br />&nbsp; uint17 x=X&lt;&lt;9<br />&nbsp; loop 9 times &#123;<br />&nbsp; &nbsp; &nbsp; ROL yva<br />&nbsp; &nbsp; &nbsp; if&#40;yva&gt;x&#41; yva=yva XOR 1<br />&nbsp; &nbsp; &nbsp; if&#40;yva&amp;1&#41; yva-=x&nbsp; &nbsp; &nbsp; &nbsp;// remember, clip to 17 bits<br />&nbsp; &#125;<br /></div><br /><br />A test program I wrote:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;&nbsp; &nbsp;// YA and X gotten from user<br />&nbsp; &nbsp;&nbsp; &nbsp;yva = YA;<br />&nbsp; &nbsp;&nbsp; &nbsp;x = X &lt;&lt; 9;<br />&nbsp; &nbsp;&nbsp; &nbsp;for&#40;i = 0; i &lt; 9; ++i&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;yva &lt;&lt;= 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if&#40;yva &amp; 0x20000&#41;&nbsp; &nbsp;yva ^= 0x20001;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if&#40;yva &gt; x&#41;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;yva ^= 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if&#40;yva &amp; 1&#41;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;yva = &#40;yva - x&#41; &amp; 0x1FFFF;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;printf&#40;&quot;YVA=%02X,%d,%02X&quot;,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;yva &gt;&gt; 9,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#40;yva &gt;&gt; 8&#41; &amp; 1,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;yva &amp; 0xFF&#41;;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;if&#40;X&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;printf&#40;&quot; -- mod=%02X, quo=%02X\n&quot;,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;YA % X,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;YA / X&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;printf&#40;&quot;\n&quot;&#41;;<br /></div>
<br />
<br />output of program when given "1000 80" is:
<br />
<br />YVA=80,0,1F -- mod=00, quo=20
<br />
<br />That would be right if you subtract 80 from Y and add 1 to A (which I just saw, now, actually.  When I ran this test before, somehow I didn't see that).  So I guess you'd have to do an additional "if(Y&gt;=X)" check afterward?
<br />
<br />Also, while I didn't test it, it looks theoretically possible for V to be clear with Anomie's algorithm when the quotient is &gt; $1FF, whereas with your C version, V would always be set in that case.  I'll have to look at that closer and come up with an example for that though -- I could be wrong.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p33619"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p33619"></a></div><div style="float: right;"><a href="./viewtopic.php?p=33619#p33619"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 24, 2008 8:37 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3711<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">How odd, the older version of anomie's algorithm had &gt;= x, not &gt;x. Here's code that I've tested for all 2^24 combinations against mine, and against the output when tested on the SNES:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">int x9 = x &lt;&lt; 9; <br />int yva = y*0x100 + a; <br />for &#40; int i = 0; i &lt; 9; i++ &#41;<br />&#123; <br />&nbsp; &nbsp; yva = yva * 2;<br />&nbsp; &nbsp; if &#40; yva &amp; 0x20000 &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; yva = &#40;yva ^ 1&#41; &amp; 0x1FFFF;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; if &#40; yva &gt;= x9 &#41; // this differs from anomie's doc<br />&nbsp; &nbsp; &nbsp; &nbsp; yva = yva ^ 1;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; if &#40; yva &amp; 1 &#41;<br />&nbsp; &nbsp; &nbsp; &nbsp; yva = &#40;yva - x9&#41; &amp; 0x1FFFF;<br />&#125;<br /><br />v_flag = &#40;yva &amp; 0x100&#41; != 0;<br />y = yva&gt;&gt;9 &amp; 0xFF; <br />a = yva &amp; 0xFF;</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=4127"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=4127"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 7 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="4127" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=2&amp;t=3963" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2008-03-15T20:38:41-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=2&amp;t=3963</id>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2008-03-15T20:38:41-07:00</updated>
<published>2008-03-15T20:38:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31694#p31694</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31694#p31694"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31694#p31694"><![CDATA[
<div class="quotetitle">blargg wrote:</div><div class="quotecontent"><br />Once a test has reported pass/fail, it's done until you power down the (emulated) NES. If you press reset again, it could give erroneous results.<br /></div><br />Could you have the program detect a wrong soft reset?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />The same goes if it tells you to press reset AFTER the message disappears and you instead press it while the message is still displayed (tests that do this must have PPU rendering off while reset is pressed).<br /></div><br />"Press reset after the tone", then turn off rendering and play a tone on square 1.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Mar 15, 2008 8:38 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-15T20:30:41-07:00</updated>
<published>2008-03-15T20:30:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31692#p31692</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31692#p31692"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31692#p31692"><![CDATA[
Once a test has reported pass/fail, it's done until you power down the (emulated) NES. If you press reset again, it could give erroneous results. The same goes if it tells you to press reset AFTER the message disappears and you instead press it while the message is still displayed (tests that do this must have PPU rendering off while reset is pressed).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Sat Mar 15, 2008 8:30 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2008-03-15T19:42:14-07:00</updated>
<published>2008-03-15T19:42:14-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31688#p31688</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31688#p31688"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31688#p31688"><![CDATA[
Some tests fail when I press reset for a second time. Is this "normal"?<br /><br />Example: the VBlank flag. The wiki says "unchanged" on reset. By pressing reset one time, it passes; if I press a second time, it says "should be zero". The 2003h is the same.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Sat Mar 15, 2008 7:42 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Marty]]></name></author>
<updated>2008-03-15T15:22:30-07:00</updated>
<published>2008-03-15T15:22:30-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31680#p31680</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31680#p31680"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31680#p31680"><![CDATA[
<div class="quotetitle">blargg wrote:</div><div class="quotecontent"><br />Hmmm, do you mean these fail if writes are ignored after <em>power</em>, or only after game is powered up normally, then reset is "pressed" in the emulator? Are those all non-US releases?<br /></div><br />They fail only when reset is pressed. On <em>power</em> I'm taking the off-for-more-than-20-secs route, allowing writes go through immediately. The emulator passes your tests in ppu_power_reset3.zip.<br /><br />AFAIK, all of them are (J) releases but I've edited my post to include their CRCs in case anyone wants to double check. The (U) and (E) versions (including Balloon Fight) work fine.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=37">Marty</a> — Sat Mar 15, 2008 3:22 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bregalad]]></name></author>
<updated>2008-03-15T14:15:07-07:00</updated>
<published>2008-03-15T14:15:07-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31678#p31678</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31678#p31678"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31678#p31678"><![CDATA[
Well, that's somewhat fun. Also, all games that have a lda $2002 - bmi loop, the only way this branch can be taken more than once is in Nesticle. I wonder why they waster ROM to put this.<br /><br />Also I've noted the Reset code of many commercial games is somewhat messy. A lot of games does write zero to $2000 and $2001 many times (I now understand that to be sure 2 times are needed, one at reset and one after a couple of frames in cases if the original writes were ignored). However, many games also do stuff like init the stack pointer, set the i flag, clear the d flag up to 3 times (usually each Reset code jumps to a secondary Reset code with redudency tasks, etc...).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=38">Bregalad</a> — Sat Mar 15, 2008 2:15 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-15T13:32:03-07:00</updated>
<published>2008-03-15T13:32:03-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31673#p31673</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31673#p31673"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31673#p31673"><![CDATA[
In my emulator at least, Air Fortress (J) works at power but fails at reset, while Air Fortress (U) works after both. The init code has been changed for the US version, inserting 2 extra VBL wait loops. Since VBL could be set at reset, the first might not wait at all. The second would then wait for the first flag setting, where the registers still wouldn't work. The second two loops are needed, and a read of $2002 before them, which the first loop provides. Their loops also wait until the flag becomes unset, maybe just to be on the safe side, having been bitten by this.<br /><br />Air Fortress (J)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">INC $C000<br />&#91;memory clear loop was here&#93;<br />LDA #$00<br />STA $2001<br />LDA $2002 ; wait for VBL<br />BPL *-3<br />CLD<br />LDX #$FF<br />TXS<br />INX<br />STX $2001<br />...</div><br />Air Fortress (U)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">INC $C000<br />LDA #$00<br />STA $2000<br />STA $2001<br />&#91;MMC1 bank selection&#93;<br />&#91;memory clear loop was here&#93;<br />LDA $2002 ; wait for VBL<br />BPL *-3<br />LDA $2002<br />BMI *-3<br />LDA $2002 ; wait for VBL<br />BPL *-3<br />LDA $2002<br />BMI *-3<br />LDA $2002 ; wait for VBL<br />BPL *-3<br />LDA $2002<br />BMI *-3<br />CLD<br />LDX #$FF<br />TXS<br />INX<br />STX $2001<br />...</div><br />Metal Gear (J) fails after reset, but (U) works. Same for Rollerball and God Slayer (Crystalis).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Sat Mar 15, 2008 1:32 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2008-03-15T11:44:27-07:00</updated>
<published>2008-03-15T11:44:27-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31670#p31670</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31670#p31670"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31670#p31670"><![CDATA[
GoodNES says that at least Balloon Fight is (JU).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Sat Mar 15, 2008 11:44 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-15T11:41:35-07:00</updated>
<published>2008-03-15T11:41:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31668#p31668</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31668#p31668"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31668#p31668"><![CDATA[
Hmmm, do you mean these fail if writes are ignored after <em>power</em>, or only after game is powered up normally, then reset is "pressed" in the emulator? Are those all non-US releases?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Sat Mar 15, 2008 11:41 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Marty]]></name></author>
<updated>2008-03-15T15:09:19-07:00</updated>
<published>2008-03-15T09:28:34-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31667#p31667</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31667#p31667"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31667#p31667"><![CDATA[
Just tested a bunch of Famicom games on an emulator. Following fail to work on it if writes are ignored for a while after reset:<br /><br />3E785DC3 Air Fortress <br />8BCDE59A Athena <br />2B462010 Balloon Fight<br />DC75732F Cosmic Epsilon<br />A5E6BAF9 Dragon Slayer 4 - Drasle Family<br />77DCBBA3 Eggland - Meikyuu no Fukkatsu<br />240C6DE8 Elysion<br />E0604F76 F-1 Race<br />73921674 Family Computer - Othello<br />79698B98 God Slayer - Haruka Tenkuu no Sonata<br />8DCD9486 Jumbo Ozaki no Hole in One Professional<br />D0EB749F Lord of King<br />D8748E0A Magic John<br />805F81BC Metal Gear<br />E2A79A57 Rollerball<br />8E62D229 Sansuu 1 Nen - Keisan Game<br />892CBBC2 Sansuu 2 Nen - Keisan Game<br />98DC1099 Sansuu 3 Nen - Keisan Game <br />8B4A2866 Sansuu 4 Nen - Keisan Game<br /><br />Shouldn't come as a big surprise I guess since it most likely works differently on Famicom consoles. Just tought it I'd list them anyway in case someone finds this useful.<br /><br />Edit: added CRCs<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=37">Marty</a> — Sat Mar 15, 2008 9:28 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-14T10:40:59-07:00</updated>
<published>2008-03-14T10:40:59-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31644#p31644</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31644#p31644"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31644#p31644"><![CDATA[
Yeah, it's too bad I don't have a second US NES, perhaps even a top-loader. I do have a PAL NES and hope to test on it soon. I predict what tepples predicts, that the times will correspond to particular scanlines. Today I'm going to find whether the timing is the same if power is left off for a while between tests, down to a single PPU clock. I'm hoping that the variation was just due to not powering off long enough. If this is the case, it would allow for reliable movie recording and playback between the emulator and NES (either direction), which would be really cool.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Fri Mar 14, 2008 10:40 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bregalad]]></name></author>
<updated>2008-03-14T09:58:14-07:00</updated>
<published>2008-03-14T09:58:14-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31640#p31640</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31640#p31640"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31640#p31640"><![CDATA[
Well, also all those findings are true for NTSC U.S. NES, but they may differ greatly for a Japanese Famicom and European PAL NES.<br /><br />Also, some results may very from unit to unit, for exemple it's well known that the initial palette values are proper to a NES, because they all flashes in different colors.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=38">Bregalad</a> — Fri Mar 14, 2008 9:58 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-13T15:14:08-07:00</updated>
<published>2008-03-13T15:14:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31631#p31631</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31631#p31631"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31631#p31631"><![CDATA[
Oh lovely, if I power the NES off for 20 seconds or so, at power PPUADDR is $0000, SPRADDR is $2F, and most registers work <em>immediately</em>, rather than being ignored until 29658. Time for more test rewriting.. maybe I can hit 40 or 50 test ROMs! Bleah.<br /><br /><strong>EDIT:</strong> OK, got a big rewrite of the PPU power/reset test ROMs done, and covering these new findings ("only" 37 test ROMs). <a href="http://nesdevwiki.org/index.php/Power-up_state_of_PPU" class="postlink">NesDevWiki page</a> is updated as well. Main finding was that if the NES is off for 20 seconds or more, all registers work at power, and $2002, $2003, and $2006 are 0.<br /><br /><a href="http://h1.ripway.com/blargg/temp/ppu_power_reset3.zip" class="postlink">ppu_power_reset3.zip</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Thu Mar 13, 2008 3:14 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[hap]]></name></author>
<updated>2008-03-13T13:43:09-07:00</updated>
<published>2008-03-13T13:43:09-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31628#p31628</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31628#p31628"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31628#p31628"><![CDATA[
yeah, that test rom fails here (for now)<br />Thanks.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=115">hap</a> — Thu Mar 13, 2008 1:43 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2008-03-13T13:20:10-07:00</updated>
<published>2008-03-13T13:20:10-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31627#p31627</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31627#p31627"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31627#p31627"><![CDATA[
I think the dummy read for STA ABS,X addressing mode solves the problem, so no NES tests are needed for Ironsword and Cobra Triangle. I still predict that Tiger-Heli will fail if powered down then up without a long delay between.<br /><br />hap, here's a new test ROM that verifies that $2007 is unchanged during rendering: <a href="http://h1.ripway.com/blargg/temp/Rendering_and_$2007_buf.nes.zip" class="postlink">Rendering_and_$2007_buf.nes.zip</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Thu Mar 13, 2008 1:20 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bregalad]]></name></author>
<updated>2008-03-13T12:16:17-07:00</updated>
<published>2008-03-13T12:16:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31626#p31626</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31626#p31626"/>
<title type="html"><![CDATA[PPU powerup/reset behavior]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=3963&amp;p=31626#p31626"><![CDATA[
I have the PAL Ironsword, but I have trouble to make it working right now, like everyother NES cartridge I have. I have to reset some 60 times or so to get a boot with very corrupted graphics. Seems like a bit of cleaning will be needed.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=38">Bregalad</a> — Thu Mar 13, 2008 12:16 pm</p><hr />
]]></content>
</entry>
</feed>
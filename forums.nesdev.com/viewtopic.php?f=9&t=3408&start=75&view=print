<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - PowerPak now available</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">PowerPak now available</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=3408">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=3408</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>6</strong> of <strong>7</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>bunnyboy</b> [ Wed Jun 20, 2007 11:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Will a mod like this make it into the second production batch?</div>
<br />Yes the next boards will have this fix.  I have not ordered the second batch exactly to find problems like this.  Pretty sure it fixes the background fuzzyness (garbage sprites?) but I will still wait for more people to check it out.  If you do see any problems AFTER the mod you should note the game with mapper of your rom, and type of system (front loader, top loader, famicom, av, etc).  You can find out the mapper num and other header info by running the game through Nintendulator.  It will display (but not fix) all the header info.  The (hopefully) correct mapper/mirroring can be checked at bootgod's site: <a href="http://bootgod.dyndns.org:7777" class="postlink">bootgod.dyndns.org:7777</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Jun 20, 2007 11:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">I prefer having a later power pack that works than a ultra rare prototype that doesn't work.</div><br />Same here.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Resistors doesn't delay anything, they just increase the impedance.</div><br />OK, I admit... I don't know anything about electronics... <img src="./images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Sorry, but it's hard to follow when something is going on in 4 different threads at the same times (it's actually much worse than when more than one thigns goes at the same time in the same thread).</div>
<br />I agree with you. Even if you follow them all, you never know what was said where.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>peppers</b> [ Wed Jun 20, 2007 11:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">What bus conflict ? Sorry, but it's hard to follow when something is going on in 4 different threads at the same times (it's actually much worse than when more than one thigns goes at the same time in the same thread).</div><br /><div class="quotetitle">bunnyboy wrote:</div><div class="quotecontent">(For those technical people, the problem appears to be a bus conflict during sprite DMA.  The PowerPak responds too quickly which corrupts the data headed from the internal RAM to the PPU.  By adding the resistors the cart will always lose the bus conflict and display correctly.  The PRG and CHR rom/ram data are unaffected, which is why none of the supported games would crash.</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>oRBIT2002</b> [ Wed Jun 20, 2007 11:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So bunnyboy, what are the chances that the artifacts can be fixed by a software upgrade?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dvdmth</b> [ Wed Jun 20, 2007 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The PowerPak needs its own forum (or its own section here at nesdev), as it's becoming really awkward even for me (and I have a lot of spare time right now).
<br />
<br />If you read bunnyboy's description of the problem (which he posted in all of the threads), he describes the problem as a bus conflict during sprite DMA.  I suppose the sprite DMA engine isn't quite running in sync with the Phi-2 clock, causing the address lines to be unstable at either the very start or the very end (don't know which) of each memory access cycle.  It appears Nintendo's cartridges had a slow enough reaction time not to notice the out-of-sync nature of the sprite DMA engine.  However, newer and better hardware is sensitive to the problem and will attempt a bogus memory read during sprite DMA operations, causing a bus conflict.  This is my understanding of what the problem is (bunnyboy can correct me if I'm wrong).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>peppers</b> [ Wed Jun 20, 2007 11:52 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />what is a game witch these probelms are paticularley apperint so I can tell if my console is affected soldering 8 resistrs is no real problem for me but a bit of a nusance

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>oRBIT2002</b> [ Wed Jun 20, 2007 11:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">peppers wrote:</div><div class="quotecontent">what is a game witch these probelms are paticularley apperint so I can tell if my console is affected soldering 8 resistrs is no real problem for me but a bit of a nusance</div>
<br />
<br />If you haven't noticed it in any game yet, you probably have got a "good console". This is the way SMB3 (PAL) looks with my machine for example:
<br /><!-- m --><a class="postlink" href="http://www.anes.se/powerpak.mpg">http://www.anes.se/powerpak.mpg</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>slick0</b> [ Wed Jun 20, 2007 12:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />bunnyboy, did the mod, and it seems you fixed it!  My tetris peices don't change when they fall anymore!  (just the graphics, not the actual pieces.)  Free PowerPak for you!... oh wait...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>peppers</b> [ Wed Jun 20, 2007 12:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I do see the problem about 1/3 of the time when loading SMB3 so I guess Ill have to do it

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Wed Jun 20, 2007 12:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If you haven't noticed it in any game yet, you probably have got a "good console". This is the way SMB3 (PAL) looks with my machine for example:<br /><!-- m --><a class="postlink" href="http://www.anes.se/powerpak.mpg">http://www.anes.se/powerpak.mpg</a><!-- m --></div>
<br />
<br />I don't get those lines in SMB3 (I have a NES-PAL-001 model), but I get a similar effect in Mike Tyson's Punch-Out!! (E) (PRG0) [!] (using loopy's MMC2 mapper file)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jun 20, 2007 1:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">dvdmth wrote:</div><div class="quotecontent">The PowerPak needs its own forum (or its own section here at nesdev)</div>
<br />It appears that PowerPak already has one: it's called "NES Hardware / CopyNES".

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Jun 21, 2007 2:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If you read bunnyboy's description of the problem (which he posted in all of the threads), he describes the problem as a bus conflict during sprite DMA. I suppose the sprite DMA engine isn't quite running in sync with the Phi-2 clock, causing the address lines to be unstable at either the very start or the very end (don't know which) of each memory access cycle. It appears Nintendo's cartridges had a slow enough reaction time not to notice the out-of-sync nature of the sprite DMA engine. However, newer and better hardware is sensitive to the problem and will attempt a bogus memory read during sprite DMA operations, causing a bus conflict. This is my understanding of what the problem is (bunnyboy can correct me if I'm wrong).</div>
<br />If I undestand things, during sprite DMA, the adress changes after the low-to-high edge of the phi-2 clock, and if the RAM or ROM present on the cartridges are too fast, they may resond to this quick state, wich correspond to reading the last adress, wich is where the "$40" of "sta $4014" was stored.
<br />Then the on-board PRG-ROM or PRG-RAM is conflicting with the NES internal RAM used for actual sprite DMA. Because the NES internal WRAM is old and slow enough, it doesn't have problem so does the cartridges. Now this would only conflict with the very first DMA fetch, since the adress keeps in the RAM range for the whole DMA. This means that only the sprite  #0 X coordinate is conflicted, wich can of course crash or add serious glitches all games relying on sprite #0 hit. For all other games, that'd just be a sprite glitched. Is this what happens ?
<br />Adding 470 ohms resistors in series on the data bus higer the impedance of the cartridge, making the NES internal RAM winning the bus conflict. A lot of current may drawn in those resistors, tough (about 10mA per bus line) for a short while. Does this mean that adding resistor on the data bus is needed for all new cartridges with fast-responding EPROMs, Flash ROMs or SRAMs ? Or is it better to just pick slow ones ? Or is there a more proper way to fix thigs ?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Thu Jun 21, 2007 8:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">dvdmth wrote:</div><div class="quotecontent">The PowerPak needs its own forum (or its own section here at nesdev), as it's becoming really awkward even for me (and I have a lot of spare time right now).</div>
<br />
<br />Great idea. It should have it's own forum and the three topics about the powerpak should be move into the new forum. <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />  <img src="./images/smilies/icon_idea.gif" alt=":idea:" title="Idea" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dvdmth</b> [ Thu Jun 21, 2007 8:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">If I undestand things, during sprite DMA, the adress changes after the low-to-high edge of the phi-2 clock, and if the RAM or ROM present on the cartridges are too fast, they may resond to this quick state, wich correspond to reading the last adress, wich is where the "$40" of "sta $4014" was stored.<br />Then the on-board PRG-ROM or PRG-RAM is conflicting with the NES internal RAM used for actual sprite DMA. Because the NES internal WRAM is old and slow enough, it doesn't have problem so does the cartridges. Now this would only conflict with the very first DMA fetch, since the adress keeps in the RAM range for the whole DMA. This means that only the sprite  #0 X coordinate is conflicted, wich can of course crash or add serious glitches all games relying on sprite #0 hit. For all other games, that'd just be a sprite glitched. Is this what happens ?<br />Adding 470 ohms resistors in series on the data bus higer the impedance of the cartridge, making the NES internal RAM winning the bus conflict. A lot of current may drawn in those resistors, tough (about 10mA per bus line) for a short while. Does this mean that adding resistor on the data bus is needed for all new cartridges with fast-responding EPROMs, Flash ROMs or SRAMs ? Or is it better to just pick slow ones ? Or is there a more proper way to fix thigs ?</div>
<br />That explanation makes some sense, though it does appear that the conflict is affecting more than just sprite 0's Y coordinate (given the more corrupt nature of the reported symptoms).  Perhaps the DMA is really 256 small DMA's that occur one after another, with the 6502's program counter appearing on the address lines between the transfers (since that would be the next byte needed by the 6502).
<br />
<br />I know I said this before, but what happens when sprite DMA occurs from WRAM?  Will it cause a bus conflict between the WRAM chip and the PRG chip (both of which are on the other side of the resistors in this fix)?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Jun 21, 2007 9:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Then it would make sense to put reistors between the data bus and the PRGROM, but not between data bus and PRGRAM.
<br />This is supposed to work exept :
<br />1 - If the programm does "STA $4014" from the PRGRAM
<br />2 - If the programm attemp to do sprite DMA from PRGROM.
<br />
<br />Also, I don't see why this problem would not be occuring when placing fast EPROMs on a normal Nintendo-made cartridge board.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>6</strong> of <strong>7</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
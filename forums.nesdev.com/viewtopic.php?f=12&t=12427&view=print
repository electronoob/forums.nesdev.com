<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - 2 Player F-Zero Feasibily</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">2 Player F-Zero Feasibily</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=12&amp;t=12427">http://forums.nesdev.com/viewtopic.php?f=12&amp;t=12427</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Tue Feb 24, 2015 10:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, I'm not saying I want to try and make this or anything, but I always enjoyed F-Zero but found its lack of 2 player disappointing. I know how Mario Kart can do it and it seemed like it was purely a design choice, but I realized that the tile map in Mario Kart never appears to get updated, unlike F-Zero. Would this be the reason? I can't really think of a way to have 2 different tile maps given the weird nature of how mode 7 is set up. The only way I can think of it would be to change the data in the tile map mid screen using force blanking, but I don't think you would be able to update it in time without a huge gap between the top and bottom screens. I know that Super Mario Kart has a chip called the DSP-1. What is it for and what does it do? I've heard it helps the game have split screen Mode 7, but this is not very clear. Also, kind of off topic, but do you think that the SNES would be able to expand/shrink about 8 32x32 sprites through software in one frame? I hate the look of the choppy scaling in racing games that use pre rendered scaling sprites.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mikejmoffitt</b> [ Tue Feb 24, 2015 10:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The tilemap is updated sometimes in Mario Kart. The ice blocks in Vanilla Lake are on the plane.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Tue Feb 24, 2015 11:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mikejmoffitt wrote:</div><div class="quotecontent">The tilemap is updated sometimes in Mario Kart. The ice blocks in Vanilla Lake are on the plane.</div><br />But were talking about 2 separate tile maps for each screen.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Tue Feb 24, 2015 11:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Why did you delete your post? I didn't think like that sounded like that bad of an idea. (Although I have no idea as to how you would implement it.)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Feb 24, 2015 11:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You just mean that the map doesn't scroll, so both players can share the same map data at all times.<br /><br />From your description, I'm presuming F-Zero is very different than this, scrolling the map with wrapping. The wrapping makes it really hard to share, since you always need to keep the scrolling seam behind the player. Since there can only be one scrolling seam on a layer, only one player.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>93143</b> [ Tue Feb 24, 2015 11:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">Why did you delete your post? I didn't think like that sounded like that bad of an idea. (Although I have no idea as to how you would implement it.)</div><br />It suddenly started to sound like I hadn't thought it through.  The problem is that you <em>don't</em> actually have two tilemaps.  They don't wrap at the middle; they wrap at the edges, so it gets difficult to prevent players from driving onto one another's maps.  The Mode 7 map is big, but it's not <em>that</em> big...<br /><br />Regarding sprite scaling, I guess I'll repost that <a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=12055" class="postlink">link</a>...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>whicker</b> [ Tue Feb 24, 2015 11:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The DSP-1 is doing the 3D point to 2D projection stuff. The pipes in mario circuit, the players, the bananas on the track, the shells.<br /><br />It's doing polar coordinate stuff to do vector math. (I.e. what angle does the red shell need to travel to hit the nearest player higher in place)<br /><br />It's at least helping out with that skewing effect that gives the illusion of convergence toward the horizon, although with some precalculated tables F-Zero is able to do it without DSP-1.<br /><br /><br /><br /><br />You actually bring up a good point. Since there is no way to change the memory offset of the mode-7 bitmap, it always takes up the bottom 32K of VRAM. So you really can't have two independent maps being rotated/scaled, just different views of the same map data.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Tue Feb 24, 2015 11:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Exactly. 1024x1024 pixels is a bit small for a full fledged race track. You know, if you think about it, F-Zero was really about 20 years ahead of it's time, seeing that it doesn't allow split screen. I guess the only way to do 2 player (on one console <img src="./images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> ) would be to have a 64 pixel black bar. <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" /> About the sprite scaling, is it uncommon to keep switching sprite sizes as the sprite shrinks so you don't run into the sprites per scanline limit? If you were trying to scale a tree in the background that is only 8x16, but its max size is 32x64, you're going to run into problems if there are more than 8. (Which there are going to be because of depth.)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">You actually bring up a good point. Since there is no way to change the memory offset of the mode-7 bitmap, it always takes up the bottom 32K of VRAM. So you really can't have two independent maps being rotated/scaled, just different views of the same map data.</div><br />Honestly, I've never understood why they made the setup for mode 7 so different than the other modes when it didn't need to be. (Unless it's some kind of hardware thing I'm not aware of.)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>whicker</b> [ Tue Feb 24, 2015 11:44 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">Honestly, I've never understood why they made the setup for mode 7 so different than the other modes when it didn't need to be. (Unless it's some kind of hardware thing I'm not aware of.)</div><br /><br />It's totally a hardware thing. If you take a look at the schematics, the two video ram chips are independently addressed. Plus they are Static RAM and they are constantly being read, with no spare cycles to even think about a dram-style refresh. Really this is the best they could come up with at the time and remain affordable.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Tue Feb 24, 2015 11:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">I guess the only way to do 2 player (on one console  )</div><br />Oh yeah, has anyone ever made something like a &quot;link cable&quot; for the SNES? (I think I just beat my personal record of how fast I can derail a conversation here. <img src="./images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> ) (You know, it could almost be like one of those joined arcade cabinets:)<br /><br /><img src="http://www.findarcademachines.com/images2/Daytona-USA-Main.jpg" alt="Image" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">It's totally a hardware thing. If you take a look at the schematics, the two video ram chips are independently addressed. Plus they are Static RAM and they are constantly being read, with no spare cycles to even think about a dram-style refresh. Really this is the best they could come up with at the time and remain affordable.</div><br />Interesting... Well, it works completely fine the way it is, as long as you are &quot;playing by the rules&quot;.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>93143</b> [ Tue Feb 24, 2015 11:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />How much graphics DMA is involved here?  If you're scaling up to 8 32x32 sprites, that's 4 kB, but you shouldn't need to transfer that every frame.  Every two frames, maybe, if not more.  OAM shouldn't be full, and CGRAM doesn't change (much?), so there should be nearly 4 kB left for map updates.  That's about a frame to rewrite a quarter of the Mode 7 tilemap.<br /><br />If you could guarantee 4 kB of tilemap DMA every frame, you could just use two submaps of 4 kB each, and completely rewrite each one every other frame, preventing visible seams while also keeping players from crossing between maps.  Scroll positions and tilemap position offsets could be tabulated based on angle of view to give maximum valid draw distance without garbage creeping in at the edges of the picture; that way you could maximize resolution without having garbage show up near the horizon...<br /><br />It'd still probably look a bit blocky compared to the original, but I don't see why it wouldn't work.  Split-screen squishes the picture anyway, so you get less detail and maybe a nearer horizon (though caution is advised when doing anything to an F-Zero game that might give players less time to react)...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Wed Feb 25, 2015 12:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">93143 wrote:</div><div class="quotecontent">and completely rewrite each one every other frame,</div><br />Wait, how? From what you're describing, it seems like the game would run at 30 fps. Edit: Oh, you mean having two different spaces for each playfield, right? Maybe you could have 2 separate maps and also partially expand the bottom one using force blank. (I guess a 16 pixel black bar wouldn't look <em>too</em> bad? <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" /> )

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>93143</b> [ Wed Feb 25, 2015 12:21 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">From what you're describing, it seems like the game would run at 30 fps.</div><br />No, the scroll position and matrix parameters, and sprite positions, would be updated every frame.  But each player's tilemap and scroll position would be <em>totally refreshed</em> every other frame (alternating between players), to remove the necessity of wrapping.  All you have to do is leave enough leeway for scroll changes during the off frame so that you don't get garbage onscreen.  You might also be able to back a player's position up towards the edge of his tilemap a bit so as to get more data in view, partially mitigating the effect of the smaller map size and letting the tile resolution be closer to the original.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Oh, you mean having two different spaces for each playfield, right?</div><br />No, but now that you mention it, that would allow you to double-buffer, if you couldn't manage 4 kB in one frame for some reason.<br /><br />...this scheme does strike me as a pain to deal with DMA-wise...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Espozo</b> [ Wed Feb 25, 2015 7:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">93143 wrote:</div><div class="quotecontent">Quote:Oh, you mean having two different spaces for each playfield, right?No, but now that you mention it, that would allow you to double-buffer, if you couldn't manage 4 kB in one frame for some reason....this scheme does strike me as a pain to deal with DMA-wise...</div><br />Actually, Unless you have 2 parts of the tilemap being shared, You couldn't just copy all of the graphics for mode 7 because if I'm not mistaken, you cannot change the position of where you look for the information. It always starts at the beginning of vram, and even if you were going to copy the whole thing twice, you would have literally 0 space for anything else because it would take up the whole 64KBs.<br /><br />Edit: Just look at this:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">No, the <strong><span style="text-decoration: underline">scroll position</span></strong> and matrix parameters, and sprite positions, would be updated every frame. But each player's tilemap and <strong><span style="text-decoration: underline">scroll position </span></strong>would be totally refreshed every other frame </div><br />Which one do you mean? I think you could get away with scrolling at 60 fps just fine, as I don't see anything wrong with it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>93143</b> [ Wed Feb 25, 2015 3:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: 2 Player F-Zero Feasibily</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">Actually, Unless you have 2 parts of the tilemap being shared, You couldn't just copy all of the graphics for mode 7 because if I'm not mistaken, you cannot change the position of where you look for the information. It always starts at the beginning of vram, and even if you were going to copy the whole thing twice, you would have literally 0 space for anything else because it would take up the whole 64KBs.</div><br />Each player's tilemap in my scheme is only 4 kB.  One quarter of the Mode 7 tilemap.  This might allow it to update in one frame, or perhaps two if there's no quick way to DMA it.<br /><br />If a player's quarter-tilemap can't be updated in one shot, some method of double-buffering is necessary to avoid visible artifacts.  But hey - there are two free quarters; the player can be switched between the quarter he's on and one of the free ones by altering the scroll parameters.  So you can update the free one instead of the live one, and move the player when it's done.<br /><br /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">No, the <strong><span style="text-decoration: underline">scroll position</span></strong> and matrix parameters, and sprite positions, would be updated every frame. But each player's tilemap and <strong><span style="text-decoration: underline">scroll position </span></strong>would be totally refreshed every other frame </div><br />Which one do you mean? I think you could get away with scrolling at 60 fps just fine, as I don't see anything wrong with it.</div><br />I mean both.<br /><br />Each time the player is put on a fresh tilemap, his scroll position is chosen to maximize the viewable area of the tilemap based on his rotation angle, and the tilemap itself is chosen so that this procedure results in the player looking at the right tiles in the right places.  But this doesn't happen every frame, so the player's position will move within this tilemap, and so there has to be enough margin in the initially-chosen position that the player won't end up seeing the edges of the tilemap before another refresh can be accomplished a few frames later.<br /><br />This gives you 60 fps scroll, on top of a slower scroll update corresponding to the tilemap refresh.<br /><br />In the attached picture, Player 2 (green) has just had his map refreshed and has been placed in an optimal position on it.  Player 1 (red) is using an old map and has thus moved somewhat from his original position.  The game will now proceed to update Player 1's map and position.<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=2746" alt="2pmap_fzero_p2update.png" /><br />
			<span class="gensmall">2pmap_fzero_p2update.png [ 505 Bytes | Viewed 256 times ]</span>
		

		<br />
	</div><br />Of course, the calculated optimal scroll position baseline (where the player is initially going to be put) is needed to define the tilemap, so depending on how fast the DMA happens, the result may be a couple of frames old by the time it's used.  Adding normal scrolling to it every frame keeps it up to date so the player doesn't see any judder or lag, though it requires extra viewable-area margin because the player can now get farther from the baseline position before the next refresh.<br /><br />...<br /><br />Wait a minute; I just thought of something.  What if both players got updated at the same time?  With double buffering, there's no reason not to:<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=2748" alt="2pmap_fzero_halfupdate.png" /><br />
			<span class="gensmall">2pmap_fzero_halfupdate.png [ 520 Bytes | Viewed 256 times ]</span>
		

		<br />
	</div><br />In this pic, both players are on slightly stale maps (one frame old) and have thus both moved a bit from their original positions.  New map data for <em>both</em> players has been properly compiled and interleaved in WRAM (ie: a miracle happens) and can thus be DMAed to VRAM in two big single-channel bursts instead of 128 little ones.  The bright area is a single 4 kB DMA that has just happened.  Next frame, another one will happen, and the players will be moved down onto the new maps.<br /><br />...<br /><br />Am I making any sense here?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
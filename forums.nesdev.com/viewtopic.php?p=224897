<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - VRC7 and 5B amplifier investigation, also VRC7 LFO reset!</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="https://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="https://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="https://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="https://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="https://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - VRC7 and 5B amplifier investigation, also VRC7 LFO reset!" href="https://forums.nesdev.com/feed.php?f=2&amp;t=17745" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=17745';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Wed Mar 20, 2019 5:21 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=17745">VRC7 and 5B amplifier investigation, also VRC7 LFO reset!</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=17745"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 53 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=17745&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=17745&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=17745&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=17745&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p224897"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p224897">VRC7 and 5B amplifier investigation, also VRC7 LFO reset!</a></div><div style="float: right;"><a href="./viewtopic.php?p=224897#p224897"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 03, 2018 12:00 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">So I knew for a long time that both the VRC7 and 5B had some amplifier stuff to be worked out, and it's been on my list to investigate for a long time. I've run a few tests today that had interesting results. I haven't really fully analyzed them, but I thought I should share in case anyone has any good ideas for how to approach testing this stuff.<br /><br />All mentioned test ROMs are <a href="https://github.com/bbbradsmith/nes-audio-tests/tree/1d0ec4638fc9071b428b0760f1fadfa7dfb3180e" class="postlink">here on github</a>.<br /><br /><br />1. VRC7 seems to have flat clipping that begins at slightly less than 2x the full volume of 1 channel. This means if I play 2 channels at the loudest volume, there will be some distortion.<br /><br />The <strong>clip_vrc7</strong> test ROM creates a sine wave instrument, plays it on 1 channel at full volume, then 2 at once, then 3 at once, etc. In this recording we can see clipping begins on the bottom part of the wave only at 2x (an internal bias?), and then clipping on both ends at 3x and higher. Finally a triangle wave is overlaid to demonstrate that this clipping only applies to the VRC7 portion of the sound, the input audio appears to be passed through unharmed.<br /><br />Recording is attached.<br /><br /><br />2. 5B is much stranger. I don't know how to describe what this is doing. I don't think there is clipping, but there seems to be some sort of compression effect?<br /><br />The <strong>clip_5b</strong> test ROM creates 3 squares at 110, 220, 440hz, plays them together at volumes 9,A,B,C where they seem to mix together normally / linearly. Next it starts from 0 and gradually increases volume to 15 for each channel in turn. For the first channel, we see very nice 3db steps like expected, but the very last step to volume 15 isn't quite as wide. As the next two channels fade themselves in, the overall volume does increase a bit, but it seems to be squashed. Finally an APU triangle is overlaid at ~470Hz. This triangle is audible, but when I cut off the 5B squares, suddenly its volume grows? It seems to take about 30ms to reach its full volume after the loud squares have left.<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=13447" alt="triangle_returns.png" /><br />
			<span class="gensmall">triangle_returns.png [ 5.22 KiB | Viewed 5913 times ]</span>
		

		<br />
	</div><br /><br />So, this is a bit bizarre. I guess this is some sort of compressor, but how should I go about trying to test it and properly replicate its behaviour?<br /><br />Kinda mad at myself for not digging into this sooner. I noticed the compressed look of Gimmick's audio when I recorded its soundtrack a while back, and I even adjusted the log tables in NSFPlay's 5B simulation to match the squashed volumes 15 and 14.5 I had seen in testing (yes, a real hack job for sure). Had a note to go back for it later, but my priorities had been elsewhere for a few years...<br /><br />(Also, I made a revision to my <a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=17741" class="postlink">audio survey</a> test for 5B. Since the output seems reliably linear for a single channel below volume 15, I replaced the full volume test with volume 12. This also meant a revision to the new 'mixe' chunk I'd proposed, but hopefully nobody's actually using it yet.)<br /><br />Wanted to stack 3 squares of the same pitch in-phase, but being able to phase reset on the 5B continues to elude me. I thought I could get it by setting the period registers to 0 or 1 to get them in a short loop and then setting the final pitch on all 3 very quickly would do it, but this didn't work like I thought it would (phases still seemed &quot;random&quot;). Kinda curious about how they're actually implemented internally... has there been a decap / analysis of the AY at any point?<br /><br /><br />3. It appears that it's actually possible to reset the VRC7 LFO! <em>Edit: this only applies to tremolo LFO. The vibrato LFO is not reset by this method!</em><br /><br />lidnariq asked on the wiki what the $E000:6 audio disable bit did. I did an initial test and found that it silenced the audio, and setting that bit appeared to &quot;clear&quot; the custom instrument (not sure what the &quot;clear&quot; values are, since I can't read it back) and any playing tones. Clearing that bit makes it operate again.<br /><br />Today I tried playing an instrument with tremolo following such a toggle, though, and discovered that it was reliably playing with the same tremolo phase every time!<br /><br />So, that's not very useful for playing music (since you're basically flipping the whole unit off and on), but I think if I put this into the VRC7 Tuner I might be able to make better <a href="https://forums.nesdev.com/viewtopic.php?f=6&amp;t=9141" class="postlink">progress on the patches</a> that use tremolo/vibratio, since their free-run nature has always made them very difficult to compare with.<br /><br />I'm not sure how long it takes to go into effect. The <strong>lfo_vrc7</strong> test waits about a frame between setting the bit and clearing it, and then another frame before playing the note. (I was being conservative.) My guess is that the delay we use for other VRC7 writes is probably about how long it takes, but at least I've discovered that it can be done.<br /><br /><br />None of this really matters for Lagrange Point or Gimmick!, since they don't use loud volumes like this. Even homebrew doesn't usually use VRC7/5B at their loudest since they overpower it anyway. This is &quot;subtle&quot; stuff in terms of utility, not really a big problem if an emulator is missing it, but we still want to know don't we? ^_^<br /><br />(Also, in case anyone is wondering, I haven't seen an effect like this on the other 4 expansions, so I don't think there's any worry of discovering something like this with any of those.)</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="gensmall"><b>File comment:</b> source code and ROMs for clip_5b, since I will revise the test on github later</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13449">clip_5b_v1.zip</a> [3.1 KiB]
			</span><br />
			<span class="gensmall">Downloaded 236 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row1">
			<span class="gensmall"><b>File comment:</b> full recording of clip_5b test</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13446">clip_5b.zip</a> [3.3 MiB]
			</span><br />
			<span class="gensmall">Downloaded 235 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row2">
			<span class="gensmall"><b>File comment:</b> full recording of clip_vrc7 test</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13445">clip_vrc7.zip</a> [927.69 KiB]
			</span><br />
			<span class="gensmall">Downloaded 238 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> on Tue Mar 19, 2019 2:59 pm, edited 3 times in total.</span>
						

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p224899"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p224899">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=224899#p224899"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 03, 2018 12:27 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 8171<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">2. 5B is much stranger. I don't know how to describe what this is doing. I don't think there is clipping, but there seems to be some sort of compression effect?<br /></div>We do know that there's an amplifier inside the 5B. I'd be a little surprised if it's got a compressor on it, since it has an external resistor, but... your evidence is really pretty inarguable.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So, this is a bit bizarre. I guess this is some sort of compressor, but how should I go about trying to test it and properly replicate its behaviour?<br /></div>Well, the time constant from the recording shows its recovery time, right?<br /><br />You should be able to switch high-volume things on and off at some rate sufficiently faster than that to figure out its minimum gain. And given the minimum gain, you can figure out the maximum gain. And ... what other properties are there to a compressor? Knee, gain, compression ratio, attack and decay times?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">has there been a decap / analysis of the AY at any point?<br /></div>The same Sean Riddle who helped with the M50805 decap took pictures of an AY-3-8910 <a href="http://seanriddledecap.blogspot.com/2017/01/gi-ay-3-8910-ay-3-8910a-gi-8705-cba.html" class="postlink">here</a>.<br /><br />MAME's source mentions some analysis from decaps, as well as links to two more decaps beyond Sean Riddle's above, in <a href="https://github.com/mamedev/mame/blob/master/src/devices/sound/ay8910.cpp" class="postlink">its AY-3-8910 emulation</a>.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">lidnariq asked on the wiki what the $E000:6 audio disable bit did. I did an initial test and found that it silenced the audio, and setting that bit appeared to &quot;clear&quot; the custom instrument (not sure what the &quot;clear&quot; values are, since I can't read it back) and any playing tones. Clearing that bit makes it operate again.<br /></div>If it <em>is</em> the same as the YM2413's /InitialClear input, that part's documentation claims it clears <em>all</em> the registers.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p224904"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p224904">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=224904#p224904"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 03, 2018 3:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7508_1551312938.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1944<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Not understanding anything about die analysis... so this might be redundant, but I think we can safely narrow down the range of possible compressor topologies to one of these.<br /><br />-feedback VCA (voltage controlled amplifier) - very straightforward, cheap, simple, often the goto solution. Seems probable. Self-adjusting based on output rather than input. Ratio, attack and decay is a function of the signal and cannot be strictly defined. An approximation in emulation can still be good enough.<br />-feedforward VCA - also straightforward, not much more complex than the feedback variant. Often applied when you want precise ratio, attack and decay. but this is a relatively cheap consumer product - who cares? but <em>if </em>this topology was used, that's also good news for emulation - it could be potentially very precise. <br />-feedback diode bridge (as simple as it gets, potentially passive) - if badly matched (probably our case), they will produce a DC offset to the signal. If overdriven (not necessarily the case), they can cause distortion on 3rd harmonics. For this reason, simple diode bridges-as-compressors were largely abandoned in studio-grade equipment two decades before the famicom hit the market, but that doesn't necessarily mean it wasn't ever used again where fidelity was of no importance or where audio levels could be predicted, such as in a consumer product. <br /><br />In your waveform snapshot, it looks like we have a dissipating DC offset in the release stage. This might be in favour of the third option, but honestly i know to little about EE to be able to verify/falsify. Is there any other way a dc offset component could be momentarily added to the mix like that?</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p224970"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p224970">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=224970#p224970"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 03, 2018 9:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks for the suggestions and thoughts. Here's day 2's update. (<a href="https://github.com/bbbradsmith/nes-audio-tests/tree/853bbb8625677eef05ae447ef144bf5a7f8a4bed" class="postlink">source code</a>)<br /><br />1. noise_vrc7<br /><br />A recording of APU noise $3 (56kHz) against a high feedback &quot;white noise&quot; patch for VRC7. The lowpass filter for VRC7 is very clear here. A bit of highpass too I think. (Can analyze later.)<br /><br />2. noise_5b<br /><br />A recording of APU noise $3 (56kHz) against equivalent 5B noise (also 56kHz, same 32 CPU cycle count). Both are passing through the same filters here, and compared to the &quot;unaltered&quot; 2A03 noise in the VRC7 noise test above you can see evidence of a highpass, but no significant lowpass I think? (More to analyze later.)<br /><br />3. clip_5v version 2<br /><br />This one's more complicated to describe. I've created a table of 42 volumes, most of them roughly 1dB apart as a theoretical linear sum of the 3 channels. (0-7 apart are 3dB apart, but after that they're close to 1dB apart each, the last few are a little off from that ideal, there's an ODS with the source computing the theoretical linear sum of them all that I'll use to compare against the compressor output later when I analyze this.)<br /><br /><ul><li>Step 1: Set volume of the 3 registers to output each of those 42 levels as DC. Then pop back to 0.</li><li>Step 2: Use a cycle counted square wave at each of those 42 levels.</li><li>Step 3: Step 1 with APU triangle throughout. (Shows compression release.)</li><li>Step 4: Step 2 with APU triangle throughout. (Shows compression release.)</li><li>Step 5: Full volume cycle counted tone on and off.</li><li>Step 6: Step 5 with APU triangle throughout.</li></ul><br />A few notes on the compressor so far:<br /><br />- The triangle indicates that compression is not affected by the slow DC offset. Assuming it applies after the highpass filter. (Step 3)<br />- The onset of compression seems to apply very immediately, judying by the effect on the triangle. (Final pop in step 3.)<br />- When the tones start to be compressed, they get extra compression at the offset, then widen out as the highpass brings them closer to 0. I theorize that the compressor is based on the peak signal after the highpass filter applies. (Later half of step 2.)<br />- Negative magnitude seems as effective as positive magnitude for triggering compression. (Final pop in step 3 as a positive step, step 4 onsets as negative, saw other onsets from negative in other revisions of this test I didn't publish too.)<br /><br />Later I'm going to measure all the tones in step 2 and chart them against the theoretical linear mix. That should help find a suitable compression curve. We can measure the triangle's return to full volume to understand the release timing of the compressor (especially from step 6).<br /><br />I think that might actually be enough to adequately describe this? Anyone have any thoughts?<br /><br />I've never studied or tried to build an analog compressor, so I'm a little out of my element on my usual goal of trying to imagine what the simplest possible implementation looks like, but the stuff I mentioned above seems like it should be plausible from a relatively simple circuit? The  compressor seems to roughly turning that exponential 1dB progression into a linear one just above volume 14 (31th volume in the progression), though I haven't yet charted it thoroughly. Is an approximate log to linear adjustment like that reasonable to implement?<br /><br /><br />One followup, I was asking about AY decap just because I didn't understand why I couldn't reset phase, but the MAME implementation I think makes it clear where my understanding of the results was wrong. I  was trying to put them at a high frequency with the hope that when I switched to low frequency they'd restart the next wave slowly. However, the timer counter inside the AY is just a count of when to flip the bit, not a timer for the whole waveform. So, and given change could happen on either bit, so the phase wasn't random, it was randomly inverted. (This was borne out to be true by reviewing my earlier attempt.) MAME also answers my question about what period 0 does (i.e. same as period 1), which I'd assumed but was nice to have a confirmation. (This is wrong in NSFPlay's inheritend YM2149 emulation too.)</div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="gensmall"><b>File comment:</b> recording of clip_5b version 2 (mp3 for file size constraints, sorry)</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13452">clip_5b_v2.zip</a> [1.5 MiB]
			</span><br />
			<span class="gensmall">Downloaded 236 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row1">
			<span class="gensmall"><b>File comment:</b> recording of noise_5b</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13451">noise_5b.zip</a> [1.06 MiB]
			</span><br />
			<span class="gensmall">Downloaded 235 times</span>
		

		<br />
	</td>
							</tr>
						
							<tr>
								<td class="row2">
			<span class="gensmall"><b>File comment:</b> recording of noise_vrc7</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=13450">noise_vrc7.zip</a> [1.04 MiB]
			</span><br />
			<span class="gensmall">Downloaded 236 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> on Tue Sep 04, 2018 10:03 am, edited 1 time in total.</span>
						

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p224979"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p224979">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=224979#p224979"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 04, 2018 2:04 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7508_1551312938.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1944<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Negative magnitude seems as effective as positive magnitude for triggering compression.</div><br /><br />A typical compressor will pick up the signal as a so-called side-chain, rectify it so that all peaks have the same polarity, so the amplifier can act correctly on both poles.  And it is common that it is then smoothed out with at least one slew limiting circuit to create an even control voltage to be used to diminish the amplification. It also sort of counteracts any DC offset here by averaging the peaks, if any plausible DC offset wasn't already counteracted/avoided altogether. Anyway, the slew limiter is responsible for  attack and decay. A more elaborated compressor will have two different slew limiters for rising and falling signals (so you can set attack and decay separately) The capacitor will have some effect on the slew.<br /><br />This article illustrates it:<br /><!-- m --><a class="postlink" href="http://www.audiotechnology.com.au/wp/index.php/on-the-bench-compressors-part-2-the-side-chain/">http://www.audiotechnology.com.au/wp/in ... ide-chain/</a><!-- m --></div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p225012"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225012">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225012#p225012"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 04, 2018 4:57 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Here's some measured results from yesterday's test.<br /><br />A graph of the predicted linear mix levels vs measured:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=13454&amp;mode=view"><img src="./download/file.php?id=13454&amp;t=1" alt="clip_5b_lin.png" /></a><br />
			<span class="gensmall">clip_5b_lin.png [ 19.92 KiB | Viewed 5744 times ]</span>
		

		<br />
	</div><br />The same graph with logarithmic scale on both axes, cropping out some of the lower left to show the more interesting part where it diverges:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=13455&amp;mode=view"><img src="./download/file.php?id=13455&amp;t=1" alt="clip_5b_log.png" /></a><br />
			<span class="gensmall">clip_5b_log.png [ 24.82 KiB | Viewed 5744 times ]</span>
		

		<br />
	</div><br />The linear mix prediction seems to match extremely well up to and including volume 14. Anything higher than that appears to be affected by compression. The measured levels were taken after the onset/highpass had settled into a symmetrical wave, so from the compressor's perspective I think it's should represent a map from a negative or positive peak that's 50% of the peak to peak difference. (As mentioned before, the onsets are more compressed, and widen back out as the highpass shifts it back to centre.)<br /><br />On the logarithmic graph I threw an exponential trend line on the data points from (14,0,0) to (15,15,15). That seems to be a roughly 2.6:1 compressor if we assume a hard knee? I think the actual dB curve might be a little less straight, with the dB compression radio gradually increasing past the threshold.<br /><br />As for my question about compressors, thanks for the link FrankenGraphics, though for the most part it doesn't really address the parts of this I don't understand. Like I understand that a compressor normally has an attack/release, a compression ratio, a hard or soft knee. What I don't understand is what are the analog components needed to build one, and which variation of that is most sensible to embed in an ASIC like the 5B. I can find several articles mentioning that there's variations like tube / optical / solid state / VCA / feed-back / feed-forward / etc. but I'm having a harder time finding information about the actual compression characteristics that belong to each of these.<br /><br />I know it's normal for a compressor to work with both positive and negative peaks, I only mentioned the polarity because I didn't think it should be assumed as a given in this particular case, because the pre-filtered output of the 5B <em>only</em> lies on one side of 0. I don't know who designed this, or why they wanted a compressor in it, but skipping a rectifier seemed like a plausible possibility, so I wanted to explicitly rule it out.<br /><br />Here's a digital model that these results seems to be conjuring for me:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">1. A = PCM input signal<br />2. H = highpass(A)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; will be used as pre-gain output, and input to the compressor sidechain<br />3. S = clamp(abs(H) - threshold) ; rectify H and cut off signal below threshold<br />4. C = lowpass(S)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; lowpass S to generate the gradual release (will try to estimate this curve from recording later)<br />5. O = H * (1 - func(C))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; output attenuates H based on strength of C, func() here is a placeholder for some approriate curve</div><br />I'm assuming there isn't a separate highpass for the compressor's control sidechain because the attack seems to be instant and match the output so closely, for similar reason I'd want to assume the lowpass is probably a very simple 1st order filter? (I'll probably need so spend some time thinking about this / experimenting, not sure if my intuition is correct here.) The remaining question is what kind of curve goes into &quot;func&quot; there, presumably some &lt;1 constant raised to the power of the sample from C.<br /><br />The biggest open question for me is the hard/soft knee thing. I'm assuming that there is a &quot;typical&quot; kind of soft knee curve that results naturally from a simple analog circuit. Is a hard knee easier or harder to make, or is there a simple/common wait to implement one? I can measure stuff as best I can and try to replicate it, but it would be nice to have a sound theory for what kind of curve I <em>should</em> be looking for here. (I'll try to find myself a suitable reference on compressor design... I found <a href="http://eecs.qmul.ac.uk/~josh/documents/2012/GiannoulisMassbergReiss-dynamicrangecompression-JAES2012.pdf" class="postlink">this one</a> which seems pretty good so far. <a href="https://www.uaudio.com/blog/digital-emulation-of-distinctive-compressors/" class="postlink">This article</a> doesn't have much detail but there are some tantalizing graphs of a real analog compressor.)<br /><br />...though, given the amount of data I have to work with and the amount of error there seems to be due to probably a bunch of intervening factors (in particular the assumption that all 3 channels mix equally and linearly) maybe it's splitting a little bit too fine a hair trying to determine the difference between a soft and hard knee here.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p225027"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225027">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225027#p225027"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 04, 2018 7:55 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Was trying to find information and ran across <a href="http://www.alicat.com/documents/application_notes/Filter-Characterization.pdf" class="postlink">this PDF</a> and I had to laugh.<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=13456&amp;mode=view"><img src="./download/file.php?id=13456&amp;t=1" alt="compressor_filter_characterization.jpg" /></a><br />
			<span class="gensmall">compressor_filter_characterization.jpg [ 100.66 KiB | Viewed 5720 times ]</span>
		

		<br />
	</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p225054"></a>
				<b class="postauthor">TmEE</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225054">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225054#p225054"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 2:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3483.jpg" width="94" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Feb 13, 2008 9:10 am<br /><b>Posts:</b> 685<br /><b>Location:</b> Estonia, Rapla city (50 and 60Hz compatible :P)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A similar effect is present in SMS2, where one resistor value on the chip output is not quite right and cause flattening out of the highest levels due to way output mixing and buffering works inside the chip.<br /><br />Stock : <!-- m --><a class="postlink" href="http://www.tmeeco.eu/SMS/PSGbadLevels.jpg">http://www.tmeeco.eu/SMS/PSGbadLevels.jpg</a><!-- m --><br />Ideal/with corrected resistor value : <!-- m --><a class="postlink" href="http://www.tmeeco.eu/SMS/PSGgoodLevels.jpg">http://www.tmeeco.eu/SMS/PSGgoodLevels.jpg</a><!-- m --></div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.tmeeco.eu">http://www.tmeeco.eu</a><!-- m --></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3483"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p225064"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225064">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225064#p225064"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 7:07 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7508_1551312938.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1944<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> What I don't understand is what are the analog components needed to build one</div><br /><br />I hope i'm not wasting your time with this. I don't think you don't need to know the intricacies to make a &quot;lazy&quot; emulation that basically yields the same result to your ear. <br /><br />Exactly what components, and in what configuration, really depends on what topology we're looking at, and i'm not too well read on all of them. So the following goes for what i do know. I'll just list some building blocks that are common. <br /><br />A few concepts first that informs the rest. <br />-An amplifier consists at least of one or two transistors. <br />-A so-called operational amplifier is really a whole block of more specific amplifiers with different tasks.<br />-A diode and a transistor is based on the same technology (semi conduction), except diodes consist only of a passive channel and your sole mode of definition is in what direction you put it and exactly what semi-conductive material you're using, while a transistor will have an extra lead which can modify the operation of said channel. <br /><br />To build a gain reducer:<br />At the very core, to reduce gain you need an &quot;inverting amplifier&quot;. It will subtract one signal from the other and output the difference. This is where the (negative) feedback comes in (which you will sum with the input, while the other input is tied to ground). If both input and feedback are 1:1, gain is *0. If no feedback is provided, gain is *1. The balance is done with two resistors, one on the direct input and one on the feedback. They are joined post-resistors. The formula is -feedbackresistor/inputresistor. Again the amp will, as the name implies, invert the polarity of the signal (hence the -), so is common to place two amplifiers in a daisychain to revert it if phase is important. <br /><br />Typically the job of the second amp is just to pass the input to the output with unmodified gain and just revert the phase, but since you already have two amps in place... maybe the first is used for setting the volume and the second is used for some compression, since it is there anyway. <br /><br />Now, i've only built this kind of circuit with whole OpAmp IC:s (operational amplifiers). Doing a differential amplification with these looks like this:<br /><img src="http://www.doepfer.de/DIY/amp_inv.gif" alt="Image" /><br /><br />...but iirc you can build one discretely with just two &quot;common emitter&quot; transistors and three resistors, not counting any output buffer measures taken or such. You can look up &quot;differential amplifier&quot; if you want to look into it. Depending on case, you might not need extra buffer amplifiers. <br /><br />A super simple/hacky way to create a threshold for gain reduction/compression (and i don't know if it was used here) is to pass the feedback through a diode. The diode must reach over a certain voltage to &quot;break down&quot; and start conducting. It also introduces a voltage drop, which means gain can't really be reduced to 0, but that's not what we are doing here anyway. IF this method was used, note that there'd be *some* variance on exactly what voltage the diode will conduct, from die to die. It probably also needs to be a diode with a low breakdown voltage since, i assume, audio voltage levels are quite small even within the cartridge synth? (it is generally good to keep them high. studio audio has a pvp of 1.7, consumer audio outputs 0.45, modular synthesizers anything between 5 and 12 haha. the typical silicon diode breaks at 0.7 and the typical germanium diode breaks at 0.3 - these aren't as common in consumer electronics and are more or less extinct today. You can make your audio level match the breakdown voltage by adding a &quot;voltage divider&quot; circuit).  <br /><br />About building the simplest possible compressor in the world:<br />For a fully passive diode bridge compressor, all you need is really 7 resistors, 4 diodes and 2 capacitors, just to point out how simple it can get. That is a little academical - you still need an active buffer stage for the signal to keep the intended volume and impedance. I'm not sure of its applicability here since i don't know how you'd add a threshold to this passive scheme, but those resistors would at least let you define ratio, attack and decay. There probably is a way to introduce a threshold, and i just don't know about it. <br /><br />About building a full VCA compressor and why it probably isn't what we want:<br />A full-sized VCA circuit will first use two inverting amps (= 4 transistors and some resistors) to produce a control voltage (which you can easily bias or gain control in itself via the specifics of the VCA block), which can then be used to in turn to gain-control another OpAmp pair that is solely responsible for the end volume (how much goes to audio out, and how much goes down the drain). This volume is fed back into the VCA block for partial self correction in a compressing circuit. <br /><br />Note that the purpose of a full-blown VCA is to be able to provide easy means to control the amount of gain reduction. You might not need all its bells and whistles. A lot of the hobbyist schematics you'll find are unnecessarily feature-heavy for our purposes even when they're labeled simple, because they're designed by someone who wanted some specific interface in the first place. Like being able to voltage control the ratio, threshold, knee or whatever. All we want to do is voltage control the volume and that's it. <br /><br />Rectifiers: <br />All a rectifier does is nullify the negative swing. And all it takes is a diode. This is more elaborately called half wave rectification. <br />But if you add together two rectified signals (one for each pole), you get both polar peaks on the same 0-maxV pole.  This is called full wave rectification. <br />It looks like <a href="https://www.electronics-tutorials.ws/diode/diode_6.html" class="postlink">this</a>. <br /><br />Partly because of the choppyness introduced by the diodes' breakdown voltage, a smoothing capacitor is used. and/or you can use germanium diodes, which have a lower breakdown voltage. <br /><br />A VCA block will need this for producing a control voltage out of the rectified, smoothed signal. <br /><br />I've mentioned diode bridges twice in this post. Note that their applications are different. One is to be a compressor in itself, the other is to precondition a source material for the VCA.<br /><br /><br /><br />I'm just wondering why they might've intentionally wanted a compressor. Maybe they were worried about overdrive or just general loudness? On the other hand, the APU squares can get too loud compared to the rest as it already is. Maybe it's just a fluke effect or a hacky &quot;well, we might aswell&quot;.</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=7508">FrankenGraphics</a> on Wed Sep 05, 2018 7:38 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p225065"></a>
				<b class="postauthor">toggle switch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225065">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225065#p225065"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 7:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7848_1549834212.gif" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Sep 30, 2016 8:57 pm<br /><b>Posts:</b> 106
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">well, i came to post the paper that i've used in the past when making compressors for DSP projects and it looks like you've already found it. <br /><br />i don't think you should be worrying too much about the actual analog components, that's an incredibly difficult question when compared to the relatively simple question of how to create a black-box effect that gives similar results.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7848"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p225080"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225080">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225080#p225080"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 10:16 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">FrankenGraphics, I'm sorry to say but I don't need an explanation of what the difference between a diode and a transitor is, or how a standard op-amp circuit works, what a rectifier is, etc. I tried to say this, but maybe I didn't make it clear I'm not asking for a primer in circuits from the ground up, I'm asking only about <em>compressors</em> specifically. You went into great detail on things that I do know, and then very little detail on the things that I actually am having trouble finding good explanations of. (Despite it not really being what I was asking there was still some information in your post that was helpful to hear, so thank you for that anyway.)<br /><br />Though also, my question is only indirectly how to build one, but more directly what the <em>characteristics</em> are of an analog compressor, i.e. what kind of response should I be looking to model. What I really want to know:<br /><br />1. Is it practical to build an analog compressor in a mapper IC with an infinitely hard knee?<br />2. Is it practical to build an analog compressor in a mapper IC with a soft knee? What kind of response curve results from this?<br /><br />I linked <a href="http://eecs.qmul.ac.uk/~josh/documents/2012/GiannoulisMassbergReiss-dynamicrangecompression-JAES2012.pdf" class="postlink">a PDF above</a> that was a good article on DSP compressor design, but it's really about building practical digital compressors; it deliberately backs off from trying to model analog compressors. The one thing I'm most interested in knowing is how the compression curve is created in an analog sense, and that article instead just glues 3 segments together for the two log-linear portions and the soft knee portion. Yeah that's easy to do in a DSP but I want to know about the real curves that are used. I already know how to build a spline.<br /><br />That <a href="https://www.uaudio.com/blog/digital-emulation-of-distinctive-compressors/" class="postlink">second article</a> I linked has some very interesting graphs of one particular type of analog compressor, and those curves are the closest thing to what I actually want to know most about it, but the graph is all this article has to tell me. Its last paragraph might be summarized as &quot;<em>there is no cookie-cutter approach to modeling of analog compressors</em>&quot;, which seems fair enough. Maybe the reason I'm finding it hard to get information about this is because the resulting curves are actually the result of complicated interactions that are hard to model succinctly.<br /><br /><div class="quotetitle">toggle switch wrote:</div><div class="quotecontent">i don't think you should be worrying too much about the actual analog components, that's an incredibly difficult question when compared to the relatively simple question of how to create a black-box effect that gives similar results.</div>Well, what I was asking is whether there's some kind of standarad characteristics of compressors. Maybe there really isn't, or maybe there is but it's an advanced topic that's hard to find info about. What FrankenGraphics was answering about analog components isn't really what I was after; I just want to have some idea of what to model. It's not so much that I want to know the parts here, I want reference on their curves... like I'm not going to build 10 varieties of compressor to analyze their curves to understand this. Digital simulations might be easier, but like that first article I linked the approach seems to be more or less &quot;build the curve you want&quot; and not replicating the analog stuff.<br /><br /><div class="quotetitle">FrankenGraphics wrote:</div><div class="quotecontent">I'm just wondering why they might've intentionally wanted a compressor. Maybe they were worried about overdrive or just general loudness? On the other hand, the APU squares can get too loud compared to the rest as it already is. Maybe it's just a fluke effect or a hacky &quot;well, we might aswell&quot;.</div> I find it pretty baffling, myself. The thing TmEE posted about a bad mix in an SMS2 looks like the kind of thing that would happen by accident. This compression effect feels more deliberate to me.<br /><br /><br />...anyhow, all of that is maybe kinda moot because I'd come to the conclusion (like toggle switch was suggesting) that a simpler model is probably good <em>enough</em> to get uncannily close anyway. We can put a pin in the my question about compressors, which might have been summarized as &quot;is there a standard response curve for analog compressors that I should be looking for?&quot; and the answer seems to be &quot;no&quot; on the fine details level, but &quot;yes&quot; on the very coarse detail level I already knew going in.<br /><br />So, yesterday I came up with a rough hard knee approximation. I'm still working on the release characteristics so I wasn't going to post again until I had more on that too but here:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=13464&amp;mode=view"><img src="./download/file.php?id=13464&amp;t=1" alt="clip_5b_hard.png" /></a><br />
			<span class="gensmall">clip_5b_hard.png [ 25.89 KiB | Viewed 5643 times ]</span>
		

		<br />
	</div><br />Here's a threshold set 1dB above volume 14 (or 7dB above volume 12), with a compression ratio of 2.7:1 dB. (The graph units are in dB, theoretical input on X, measured output on Y.)<br /><br />That's probably a better model than whatever I'd have to do to simulate the real analog curve, and probably close enough that we would never be able to tell the difference by ear anyway.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> on Wed Sep 05, 2018 10:53 am, edited 2 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p225081"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225081">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225081#p225081"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 10:27 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 8171<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">1. Is it practical to build an analog compressor in a mapper IC with an infinitely hard knee?<br /></div>I suspect the answer is no, because there are basically no parts with a V-I curve that has a sharp corner without having a complete discontinuity (e.g. DIAC)<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">2. Is it practical to build an analog compressor in a mapper IC with a soft knee? What kind of response curve results from this?<br /></div>I don't know enough to really be able to answer the question of whether a VCA can be given a nice transfer curve like this. I kinda suspect the answer is that analog compressors weren't usually defined in this piecewise linear way.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p225084"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225084">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225084#p225084"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 10:51 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yeah, that was more or less my intuition about it. No graph I could find of a vintage compressor response looked like 2 straight lines, or 2 straight lines with a circular curve, like all the basic compressor theory stuff seems to teach.<br /><br />What I saw in some <a href="https://varietyofsound.wordpress.com/2009/11/18/the-beauty-of-opto-electrical-compression/" class="postlink">graphs that I could find</a> were two mostly-linear regions (in dB scale), a knee that is not really very symmetrical, and then eventually on the extreme high end the curve takes off again. I can see how this would be idealized as a 3 piece spline for a theoretical model, and in practical terms it's probably a very usable model... but there's some big simplifications being made here.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p225086"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225086">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225086#p225086"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 11:13 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7508_1551312938.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1944<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry to have missed the point of your inquiry so badly! No, i think you made it clear - i should just have taken the time to read it twice. <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> Is it practical to build an analog compressor in a mapper IC with an infinitely hard [my edit: or soft] knee?</div><br />Maybe. It's an anachronism, but THATcorp (which specialize in compressor-on-a-chip:s) mention and show super-hard knees and soft knees in their freely available design note PDF:s (which differ from ordinary spec sheets in that they actually want people with varied EE experiences to use their IC:s by explaining stuff in layman terms). I haven't read much of it, but it might be worth a look. <br />From a quick glance, <a href="http://www.thatcorp.com/datashts/dn125.pdf" class="postlink">this</a> document seems to explain the schematic differences between soft-knee and hard-knee. There are more design note PDF:s like this from THATcorp.<br /><br />For the &quot;on an IC&quot; part, you could probably make the whole thing out of standard MOSFETs for transistors which had been widely available for a long time by then (the 6502 itself being obvious proof). Since they're not current driven, but rather voltage potential driven, they have very little load on the supply while being turned on, which we want on a cartridge device especially. Switching on and off rapidly is wasteful, but that's not what we do here. I don't remember all the characteristics of the MOSFET, but iirc the forward drop is insignificant which should mean you potentially need less buffering which could equal a simpler schematic. The &quot;coloured character&quot; of FET compressors in studios shouldn't apply. We're not dealing with the vast dynamic range of a natural recording, nor the subtle quality of a physical instrument.<br /><br />(Beyond that, i don't really know what differs in a VCA vs a  FET studio compressor/limiter on a schematic level, other than FETs being the specific transistors in use. But i suspect not a lot/the specifics of each compressor product being more different? Studio equipment companies have always been keen on blowing things like these out of proportion for the sake of branding/product presentation, and in the end - for the studio engineer, unlike the game PCB engineer - it's the musical applications that matter).<br /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I find it pretty baffling, myself. The thing TmEE posted about a bad mix in an SMS2 looks like the kind of thing that would happen by accident. This compression effect feels more deliberate to me.</div><br />Had the threshold been a bit lower, it could maybe have been used for a pleasant kick+bass ducking effect. But this feels like an anachronism too. <br /><br />Or wait - maybe it is supposed to make SFX:s punch through better and music resume more nicely? If transients for music and rythm is just below, but transients for SFX above, this should leave some space and make the music fade in a bit, rather than resume abruptly, as per normal. The threshold still seems a little too high set for my <em>personal </em>taste, but i could see that being the feature request that motivated the inclusion of a compressor with a bit of a release.</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=7508">FrankenGraphics</a> on Wed Sep 05, 2018 12:19 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p225095"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p225095">Re: VRC7 and 5B amplifier investigation, also VRC7 LFO reset</a></div><div style="float: right;"><a href="./viewtopic.php?p=225095#p225095"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 05, 2018 12:18 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 7320<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">That's a neat document. I must admit though, I get to page 6 with Figure 8 having a really nice graph of its &quot;soft knee&quot;, but then I try to find how this curve is defined and... &quot;Figure 8 shows the result of a SPICE simulation&quot;. Ha ha. Still it is nice to verify what I'd gathered that an analog soft knee will have its compression gradually tend to infinity, even if it's got a more-or-less flat ratio for a little while, and seems like it might be a usable enough model of the circuit. (...in contrast to the link I posted to a graph of an optical compressor; those seem to blow out at the high end instead?)<br /><br />I posted a more easily defined hard knee model above though, and in practice I think that's probably what I'm going to want to implement anyway... once I get the release worked out the next step is to write a compressor implementation for NSFPlay. If I can think of a practical way to do the more &quot;analog&quot; style I might go for it.<br /><br /><div class="quotetitle">FrankenGraphics wrote:</div><div class="quotecontent">Or wait - maybe it is supposed to make SFX:s punch through better and music resume more nicely?</div><br />Well, it could be used to increase the contrast of a loud SFX against the music without increasing the overall volume... but in the actual case of  Gimmick!, no I don't think it is doing this. The SFX volumes are really no louder than those used for the music anyway.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=17745"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=17745"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 53 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=17745&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=17745&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Google [Bot]</span> and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="17745" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>

<img src="./cron.php?cron_type=tidy_sessions" width="1" height="1" alt="cron" />
</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
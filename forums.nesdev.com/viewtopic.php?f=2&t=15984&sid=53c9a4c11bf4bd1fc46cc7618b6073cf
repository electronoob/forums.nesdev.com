<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Implementing a (pseudo) random number generator</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Implementing a (pseudo) random number generator" href="http://forums.nesdev.com/feed.php?f=2&amp;t=15984" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sat Oct 28, 2017 11:39 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">Implementing a (pseudo) random number generator</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 23 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=15984&amp;view=previous&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=15984&amp;view=next&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196555"></a>
				<b class="postauthor">Zutano</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196555">Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196555&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196555"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 8:05 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=8358_1491349652.png" width="98" height="98" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 04, 2017 1:22 pm<br /><b>Posts:</b> 12<br /><b>Location:</b> Ohio
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">For my latest project, I needed a way to generate random numbers on the NES. I figured I'd share my method here.<br />I use a 32-bit Galois Linear Feedback Shift Register (LFSR: <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register#Galois_LFSRs" class="postlink">https://en.wikipedia.org/wiki/Linear-feedback_shift_register#Galois_LFSRs</a>), which is decently quick and can generate a sequence of pretty unpredictable values.<br /><br />The code is written for NESASM3, but can be easily rewritten for any assembler.<br />It takes &lt;30 cycles per output bit (assuming the lfsr variable is zero page), and has an internal period of 2^32 - 1 values. Just remember to seed the lfsr variable with a non-zero value.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lfsr&nbsp; &nbsp;.rs 4<br /><br />; Pass the number of bits to output in X<br />; The result is returned in the lower X bits of A<br />RollRandom:<br />&nbsp; &nbsp;LDA &lt;lfsr<br />.roll<br />&nbsp; &nbsp;LSR A<br />&nbsp; &nbsp;ROR &lt;lfsr+1<br />&nbsp; &nbsp;ROR &lt;lfsr+2<br />&nbsp; &nbsp;ROR &lt;lfsr+3<br />&nbsp; &nbsp;BCC .done<br />&nbsp; &nbsp;EOR #$A3<br />.done:<br />&nbsp; &nbsp;DEX<br />&nbsp; &nbsp;BNE .roll<br />&nbsp; &nbsp;STA &lt;lfsr<br />&nbsp; &nbsp;RTS<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=8358&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196556"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196556">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196556&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196556"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 8:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 5754<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Maybe not surprising because it's the same algorithm, but it's nearly identical to the 32-bit LFSR PRNG example I wrote for the wiki a while ago:<br /><a href="https://wiki.nesdev.com/w/index.php/Random_number_generator/Linear_feedback_shift_register_(advanced)" class="postlink">https://wiki.nesdev.com/w/index.php/Random_number_generator/Linear_feedback_shift_register_(advanced)</a><br /><br />The base article is at:<br /><a href="https://wiki.nesdev.com/w/index.php/Random_number_generator" class="postlink">https://wiki.nesdev.com/w/index.php/Random_number_generator</a><br /><br />There are some other interesting approaches to PRNG generators in the external links</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196557"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196557">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196557&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196557"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 8:40 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3944
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Dragon Warrior 2 &amp; 3 used a LFSR (linear feedback shift register) for the RNG.  They also happened to use the same bytes of memory to store the saved game checksum.  Some save checksums will freeze the RNG.</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196558"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196558">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196558&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196558"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 8:55 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">Dragon Warrior 2 &amp; 3 used a LFSR (linear feedback shift register) for the RNG.  They also happened to use the same bytes of memory to store the saved game checksum.  Some save checksums will freeze the RNG.</div><br /><br />It's more accurate to say that they use the same <em>code</em> both as a PRNG and as a CRC16 calculator. When using it as a PRNG, they feed it a constant $FFFF in place of the data word to be CRCed.<br /><br />Dragon Quest/Warrior 4 and 5 (on the SNES) use the same code, but they constantly twiddle the CRC16 state when the CPU is otherwise idle to avoid the vulnerability.<br /><br />Dragon Quest 6 uses a 32-bit LFSR and has a different vulnerability: both the main thread and the NMI thread generate random numbers, and if the NMI interrupts the main thread at just the right time in the middle of the LFSR routine it can knock the LFSR into a frozen state. The odds of this happening are extremely low, but if you play the game as obsessively as many people play their JRPGs you will eventually see it happen (folk wisdom seems to be that it's caused by the cartridge &quot;overheating&quot; due to playing too long without a break). This vulnerability was also patched in the next game in the series, the SNES version of DQ3 (they patched it by adding a mutex/semaphore/whateveryouwannacallit so that the NMI thread will just read the current state and not try to shift the LFSR if it's in the middle of being shifted)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196559"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196559">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196559&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196559"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 9:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 19142<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Lately I've been a fan of the <a href="https://github.com/cc65/cc65/blob/master/libsrc/common/rand.s" class="postlink">linear congruential generator in cc65's standard library</a> (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">seed = seed * 0x01010101 + 0x31415927</tt>) now that <a href="https://forums.nesdev.com/viewtopic.php?f=2&amp;t=14499" class="postlink">it's been fixed</a>.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196561"></a>
				<b class="postauthor">pubby</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196561">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196561&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196561"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 9:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7486_1460669286.png" width="50" height="50" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Mar 31, 2016 11:15 am<br /><b>Posts:</b> 203
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Maybe a KISS RNG would be worth using for high quality numbers. Some variants don't use multiplication.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/* Implementation of a 32-bit KISS generator which uses no multiply instructions */<br />static unsigned int x=123456789,y=234567891,z=345678912,w=456789123,c=0;<br />unsigned int JKISS32()<br />{<br />&nbsp;int t;<br />&nbsp;y ^= (y&lt;&lt;5); y ^= (y&gt;&gt;7); y ^= (y&lt;&lt;22);<br />&nbsp;t = z+w+c; z = w; c = t &lt; 0; w = t&amp;2147483647;<br />&nbsp;x += 1411392427;<br />&nbsp;return x + y + w;<br />}</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7486&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196562"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196562">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196562&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196562"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 9:43 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">From that thread:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">why you don't usually want to use an LCG for generating X,Y pairs</div><br /><br />The Dragon Ball/Dragon Ball Z RPGs programmed by TOSE on the NES use an 8-bit LCG. Which they cripple further by always using the low-order bits, the least random ones in any LCG. And the main use of those random numbers is to generate X,Y,Z tuples--the attack power, defence power and &quot;suit&quot; of the cards that movement and battle are based on. Needless to say, the cards you get aren't very random at all.<br /><br />The Game Boy Dragon Quest Monsters games (also programmed by TOSE) also do terrible things with their RNGs, but I forget most of the details. IIRC at least one of them just loops through a static sequence of 128 numbers stored in the ROM (even FF1 used 256).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196563"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196563">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196563&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196563"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 9:44 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">pubby wrote:</div><div class="quotecontent">Maybe a KISS RNG would be worth using for high quality numbers. Some variants don't use multiplication.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/* Implementation of a 32-bit KISS generator which uses no multiply instructions */<br />static unsigned int x=123456789,y=234567891,z=345678912,w=456789123,c=0;<br />unsigned int JKISS32()<br />{<br />&nbsp;int t;<br />&nbsp;y ^= (y&lt;&lt;5); y ^= (y&gt;&gt;7); y ^= (y&lt;&lt;22);<br />&nbsp;t = z+w+c; z = w; c = t &lt; 0; w = t&amp;2147483647;<br />&nbsp;x += 1411392427;<br />&nbsp;return x + y + w;<br />}</div></div><br /><br />Bit shifts by anything other than 1 or 8 are very expensive on the 6502. You might as well be multiplying as doing all those shifts.<br /><br />The KISS family of generators essentially consists of combinations of the output of several generators whose periods have a large lowest-common-multiple. On the 6502, you could XOR or add the output of a LFSR (period 2^bits - 1) and the output of a LCG (period 2^bits) to achieve such a result. In fact that's almost what the Dragon Quest games do; they add the output of an 8-bit counter (period 256) to the output of the CRC16 (period 65536 - 2).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196565"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196565">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196565&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196565"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 10:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3944
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I wrote this down in the Goomba Color source code somewhere:<br />DW3 GBC:<br />seed = ((seed &lt;&lt; 17) &gt;&gt; 15) + ((seed &amp; 0xFF000000) &lt;&lt; 1) + ((seed &amp; 0xFF0000) + ((seed &lt;&lt; 1) &amp; 0xFF0000));</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196567"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196567">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196567&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196567"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 10:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 5754<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">pubby wrote:</div><div class="quotecontent">Maybe a KISS RNG would be worth using for high quality numbers. Some variants don't use multiplication.</div><br />I think that PRNG is written for a system that has 32 bit words, lacks an efficient multiply instruction, but has an efficient multi-shift. Maybe some earlier 32-bit x86? I'm not sure. <br /><br />Do you have a source for that code? When was it written? Why is it called &quot;KISS&quot;... it doesn't seem simple to me.)<br /><br />On the 6502 though, all those 32-bit adds, and especially those 32-bit multi-shifts are really going to hurt!<br /><br />The CC65 PRNG tepples linked is a simple multiply-and-add LCG at heart, but its multiply is <em>very</em> efficient (via a carefully chosen multiplicand), there's no need to avoid multiplication here for its own sake.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196568"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196568">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196568&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196568"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 10:45 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 431
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">In an action game where cycles are precious, an advantage of a LFSR over a LCG is that all the bits in a LFSR are equally random. If you only ever need one or two bits at a time, you can get many random numbers out of each clocking of a LFSR.<br /><br />Super Mario Bros. and Kung Fu Heroes use a 64-bit LFSR which is clocked once per frame, and every piece of code that needs random numbers (e.g. every enemy type that has a random behaviour) samples a different bit or range of bits from the LFSR. If two of the same enemy are in the same RNG-tapping state on the same frame then they'll always both choose the same behaviour, but that doesn't happen often enough to be particularly noticeable to the player.<br /><br />(Interestingly, the two games use quite different code, but functionally both are the same LFSR with the same taps)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196569"></a>
				<b class="postauthor">JRoatch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196569">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196569&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196569"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 10:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly 43110</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6385_1495860775.png" width="82" height="82" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Feb 05, 2014 7:01 am<br /><b>Posts:</b> 311<br /><b>Location:</b> us-east
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">In regards to the original post:<br /><br />Interestingly I also used the $a3/$c5 polynomial for <a href="https://forums.nesdev.com/viewtopic.php?p=138552#p138552" class="postlink">my RNG</a> a couple years back. That post also has a 8 bit shifted version as well.<br /><br />Currently I use the right shifted version, so that the least significant byte is automatically in accumulator, just like in the wiki page rainwarrior linked.<br /><br />This is my 8 bit shifted routine of that:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">rng_step_byte:<br />&nbsp; lda rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; Dealing with the low byte.<br />&nbsp; lsr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; start with x^30 term.<br />&nbsp; lsr<br />&nbsp; lsr<br />&nbsp; lsr<br />&nbsp; eor rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; x^26 term<br />&nbsp; lsr<br />&nbsp; eor rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; x^25 term<br />&nbsp; lsr<br />&nbsp; eor rng_seed+0&nbsp; &nbsp; &nbsp; &nbsp; ; XOR with original low byte.<br />&nbsp; sta rng_seed+0<br />&nbsp; lda rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; Again for the high byte.<br />&nbsp; asl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Start with x^25 term<br />&nbsp; eor rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; x^26 term<br />&nbsp; asl<br />&nbsp; asl<br />&nbsp; asl<br />&nbsp; asl<br />&nbsp; eor rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; x^30 term<br />&nbsp; asl<br />&nbsp; asl<br />&nbsp; eor rng_seed+3&nbsp; &nbsp; &nbsp; &nbsp; ; x^32 term (or original high byte)<br />&nbsp; ldy rng_seed+2&nbsp; &nbsp; &nbsp; &nbsp; ; finaly, rotate the bytes.<br />&nbsp; sty rng_seed+3<br />&nbsp; ldy rng_seed+1<br />&nbsp; sty rng_seed+2<br />&nbsp; ldy rng_seed+0<br />&nbsp; sty rng_seed+1<br />&nbsp; sta rng_seed+0<br />rts</div></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=6385&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">JRoatch</a> on Wed May 24, 2017 11:07 pm, edited 2 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6385&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196570"></a>
				<b class="postauthor">pubby</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196570">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196570&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196570"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 11:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7486_1460669286.png" width="50" height="50" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Mar 31, 2016 11:15 am<br /><b>Posts:</b> 203
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">Do you have a source for that code? When was it written? Why is it called &quot;KISS&quot;... it doesn't seem simple to me.)<br /><br />On the 6502 though, all those 32-bit adds, and especially those 32-bit multi-shifts are really going to hurt!</div><br />Source: <!-- m --><a class="postlink" href="http://www0.cs.ucl.ac.uk/staff/d.jones/GoodPracticeRNG.pdf">http://www0.cs.ucl.ac.uk/staff/d.jones/ ... iceRNG.pdf</a><!-- m --><br />Wikipedia: <!-- m --><a class="postlink" href="https://en.wikipedia.org/wiki/KISS_(algorithm">https://en.wikipedia.org/wiki/KISS_(algorithm</a><!-- m -->)<br /><br />It's a combination of LCG and LFSR engines to improve the randomness/period. I don't understand it beyond that.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7486&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196573"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196573">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196573&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196573"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 24, 2017 11:27 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 5754<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">AWJ wrote:</div><div class="quotecontent">In an action game where cycles are precious, an advantage of a LFSR over a LCG is that all the bits in a LFSR are equally random. If you only ever need one or two bits at a time, you can get many random numbers out of each clocking of a LFSR.<br />...<br />clocked once per frame</div><br />While individual bits of an LFSR are equally random, they're not very independent of each other. If you sampled &amp; 1 for one enemy and &amp; 2 for another enemy, you may see correlated behaviours on successive frames as a &quot;1&quot; bit passes through one then the other. A lot of LFSR implementations are going to do the XOR only on one byte too, so the upper bytes become <em>very</em> correlated.<br /><br />Similarly, if you're doing &amp; 3 (two bits) you should clock it <em>twice</em>, or if &amp; 7 (three bits) you should clock it <em>three times</em>. Failing to do so leads to very strong *2, *4, etc. correlations on successive tests.<br /><br />For complete entropy you should clock it as many times as you read bits, but its somewhat asymptotic, 2 clocks is a lot better than 1 clock, but 7 clocks isn't that much better than 6. You can save time by doing less, if the quality isn't critical. (Also, there's no reason to clock it more times than bits read. It's as random as it's going to get at that point.)<br /><br />Similarly, if you don't do PRNG tests every frame and try to vary their timing (and still clock it every frame), it breaks up a lot of the correlations that would otherwise appear. That can help too. If it's been 8 frames since you last did a PRNG test but you clocked it every frame, you've got a nice quality 8-bit number ready to use.<br /><br /><div class="quotetitle">AWJ wrote:</div><div class="quotecontent">If two of the same enemy are in the same RNG-tapping state on the same frame then they'll always both choose the same behaviour</div><br />I've seen that in several games, and I've always thought of it as a serious flaw, not something people hardly notice. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /> I've often been annoyed at how unintentionally predictable RPG battles can become.<br /><br />Anyhow, in a lot of cases, very poor quality PRNGs will seem sufficient. Clocking an LSFR once per frame may indeed be good enough sometimes, but it's often not immediately obvious how a poorly used PRNG is hurting things. Sometimes it takes a while to discover that in testing, but once discovered it becomes an easy to use exploit. Sometimes you don't realize why something plays out kinda crummy, and it's really just from poor PRNG use, but you can't tell because you're not comparing against a good PRNG.<br /><br /><br />I do like the LFSR generators, but my recommendation is to clock it once for every bit you need to read from it. Don't &quot;optimize&quot; before you begin by starting from the poorest entropy. Start with the good stuff, and optimize it only IF you need the extra cycles. Usually games do not need to make PRNG tests very frequently, and in such cases you'll gain almost nothing by using a poorer PRNG but there's a lot to lose. It's very likely efficient enough just to do it properly! You don't have to use some super slow cryptographically secure PRNG, there are plenty of simple ones that are reasonably fast and good quality.<br /><br />In Zutano's example (OP) the entropy is controlled directly by the input parameter in X. If reading 3 bits, call it with X=3 and use the result &amp; 7. That's basically perfect usage. Only use the lowest bits, and don't &quot;share&quot; the LFSR. Don't think about doing less work until PRNGs <em>are</em> your performance problem.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196576"></a>
				<b class="postauthor">zzo38</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196576">Re: Implementing a (pseudo) random number generator</a></div><div style="float: right;"><a href="./viewtopic.php?p=196576&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c#p196576"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 25, 2017 12:08 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://forums.nesdev.com/styles/prosilver/theme/images/no_avatar.gif" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Feb 07, 2011 12:46 pm<br /><b>Posts:</b> 930
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">A few additional sources of entropy which may be available (but cannot be relied on, and may not be suitable with all algorithms) can be the microphone input and uninitialized RAM.<br /><br />Assuming the algorithm produces uniform output, what you can do if you need a uniform range that isn't in a power of 2: Discard all bits that are too high (using AND), and then if the number is too high, try again until it isn't too high.<br /><br />You can execute the random number generator a lot during the title screen, and maybe even during play if possible, even if discarding the results in that case, in order to not get the same numbers each time. (In the cases where you do want same numbers each time, you can avoid this things.)<br /><br />Another algorithm (I have used) is ARCFOUR. However, it requires 258 bytes of RAM.</div>

					
						<div class="postbody"><br />_________________<br /><a href="gopher://zzo38computer.org/" class="postlink">.</a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4734&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 23 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=15984&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c">Board index</a> &#187; <a href="./viewforum.php?f=24&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2&amp;sid=0739ebba3e2cd58adf41e8158c8e6b0c">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <span style="color: #9E8DA7;" class="username-coloured">Bing [Bot]</span> and 8 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="15984" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="0739ebba3e2cd58adf41e8158c8e6b0c" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=0739ebba3e2cd58adf41e8158c8e6b0c" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
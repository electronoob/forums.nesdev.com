<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - What is WRONG with my PPU???</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - What is WRONG with my PPU???" href="http://forums.nesdev.com/feed.php?f=3&amp;t=3585" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=3585';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun Sep 21, 2014 10:34 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=3585">What is WRONG with my PPU???</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=3585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=3585&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=3585&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=3585&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=3585&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p26991"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p26991">What is WRONG with my PPU???</a></div><div style="float: right;"><a href="./viewtopic.php?p=26991#p26991"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 10:49 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm the guy working on NES.app, a Nintendo emulator for iPhone.  I've recently adopted the old InfoNES core, which I've spent considerable time fixing up and have forked into a new project called NESCore, which I hope will eventually become a viable multi-platform NES core.
<br />
<br />Anyway, I've gotten a lot working so far, but am struggling to figure out the PPU. I must say I'm confused, even after reading all the docs I could find on the subject. Rad Racer is still mangled, and mid-frame scrolling appears to be completely hosed. I've posted the code here:
<br />
<br /><!-- m --><a class="postlink" href="http://svn.natetrue.com/nesapp/">http://svn.natetrue.com/nesapp/</a><!-- m -->
<br />
<br />If anyone would like to have a look at it, I would be glad to share some of the cash that my users have donated toward working on the project. I'll gladly send $250 to anyone who can help me get the PPU working the way it's supposed to. I've included relevant portions of my code below, but feel free to look in NESCore/M6502_rw.h for read/write functions and NESCore/NESCore.c for rendering (NESCore_DrawScanline).
<br />
<br />Any help you guys can offer would be appreciated. I've been taking a crash course in emulation to try and make this useful for my users, would love to be able to fix this.
<br />
<br />NG
<br />
<br />Read Functions:
<br />    case 0x2000:  /* PPU */
<br />        switch( wAddr )
<br />        {
<br />            case (0x2007): /* VRAM Read */
<br />                if (S.vAddr &lt;0x3F00) {
<br />                    wScratch = S.vAddr;
<br />                    wScratch &amp;= 0x3FFF;
<br />                    bScratch = S.PPU_R7;
<br />                    S.PPU_R7 = W.PPUBANK[ wScratch &gt;&gt; 10 ][ wScratch &amp; 0x3FF ];
<br />                } else {
<br />                    bScratch = W.PPUBANK[ wScratch &gt;&gt; 10 ] [ wScratch &amp; 0x3FF ];
<br />                }
<br />
<br />                S.vAddr += (S.PPU_R0 &amp; R0_INC_ADDR) ? 0x20 : 0x01;
<br />                S.vAddr &amp;= 0x3FFF;
<br />
<br />
<br />                /* Mid-HBlank Update. If an address is written into $2006
<br />                   followed by reads of $2007 during refresh, then the
<br />                   address is loaded into the PPU and used as the start address
<br />                   of the next scanline. This is used to scroll the background
<br />                   vertically on a portion of the screen. This code converts
<br />                   the scanline address into X/Y offsets. */
<br />
<br />               if (!(S.PPU_R2 &amp; 0x80) &amp;&amp; (S.PPU_R1 &amp; 0x08)!=0) {
<br />                    S.PPU_SCROLL_X = (S.PPU_SCROLL_X &amp; 0xFF)
<br />                                   | ((S.vAddr &amp; 0x400) &gt;&gt; 2);
<br />                    S.PPU_SCROLL_Y = ( 480 + 480
<br />                        + (((S.vAddr &amp; 0x800) &gt;&gt; 11) * 240)
<br />                        + ((S.vAddr &amp; 0x3e0) &gt;&gt; 2)
<br />                        - (S.PPU_Scanline + 1) ) % 480;
<br />
<br />                    if (S.PPU_SCROLL_Y &gt; 240)
<br />                        S.PPU_SCROLL_Y -= 240;
<br />                    NESCore_Develop_Scroll_Values();
<br />                }
<br />
<br />                return bScratch;
<br />                break;
<br />
<br />            case (0x2004): /* SPR-RAM Read */
<br />                return S.SPRRAM[ S.PPU_R3 ];
<br />                break;
<br />
<br />            case (0x2002):
<br />                S.PPU_Latch_Flag = 0;
<br />
<br />                if ((S.PPU_R0 &amp; 0x80) &amp;&amp; (S.PPU_R2 &amp; 0x80)) {
<br />                    S.PPU_R0 &amp;= 0xFE;
<br />                    S.PPU_SCROLL_X = S.PPU_SCROLL_X &amp; 255;
<br />                }
<br />
<br />                return S.PPU_R2;
<br />                break;
<br />
<br />            default: /* $2000, $2001, $2003, $2005, $2006 */
<br />                return S.PPU_R7;
<br />                break;
<br />        }
<br />        break;
<br />
<br />
<br />Write Functions:
<br />    case 0x2000:  /* PPU */
<br />      switch ( wAddr )
<br />      {
<br />        case 0x2000: /* PPU Control Register 1 */
<br />          S.PPU_R0 = byData;
<br />          S.PPU_SP_Height     = (S.PPU_R0 &amp; R0_SP_SIZE) ? 0x10 : 0x08;
<br />          W.PPU_BG = (S.PPU_R0 &amp; R0_BG_ADDR) ? S.ChrBuf + 0x4000 : S.ChrBuf;
<br />          W.PPU_SP = (S.PPU_R0 &amp; R0_SP_ADDR) ? S.ChrBuf + 0x4000 : S.ChrBuf;
<br />          break;
<br />
<br />        case 0x2001: /* PPU Control Register 2 */
<br />          S.PPU_R1 = byData;
<br />          break;
<br />
<br />        case 0x2002: /* PPU Status - NOT WRITABLE */
<br />          break;
<br />
<br />        case 0x2003: /* Sprite RAM ADDR */
<br />          S.PPU_R3 = byData;
<br />          break;
<br />
<br />        case 0x2004: /* Sprite RAM DATA */
<br />          S.SPRRAM[ S.PPU_R3++ ] = byData;
<br />          break;
<br />
<br />        case 0x2005: /* Scroll Register */
<br />          if (S.PPU_Latch_Flag ^= 1) {
<br />            S.PPU_R5A = byData;
<br />            S.PPU_SCROLL_X = S.PPU_R5A;
<br />          } else {
<br />            S.PPU_R5B = byData;
<br />            S.PPU_SCROLL_Y = S.PPU_R5B;
<br />            if (S.PPU_SCROLL_Y &gt; 240)
<br />                S.PPU_SCROLL_Y -= 240;
<br />          }
<br />          break;
<br />
<br />        case 0x2006: /* VRAM Address Register */
<br />          if (S.PPU_Latch_Flag ^= 1) {
<br />             S.PPU_R6A = byData;
<br />
<br />             if ( S.PPU_Scanline &lt; 240 &amp;&amp; (S.PPU_R1 &amp; R1_SHOW_SCR) )
<br />
<br />             {
<br />                 BITCOPY(S.PPU_R6RA, 0x01, S.PPU_R5B, 0x40)
<br />                 BITCOPY(S.PPU_R6RA, 0x02, S.PPU_R5B, 0x80)
<br />                 BITCOPY(S.PPU_R6RA, 0x08, S.PPU_R0,  0x01)
<br />                 BITCOPY(S.PPU_R6RA, 0x10, S.PPU_R5B, 0x01)
<br />                 BITCOPY(S.PPU_R6RA, 0x20, S.PPU_R5B, 0x02)
<br />                 BITCOPY(S.PPU_R6RA, 0x40, S.PPU_R5B, 0x04)
<br />                 BITCOPY(S.PPU_R6RB, 0x20, S.PPU_R5B, 0x08)
<br />                 BITCOPY(S.PPU_R6RB, 0x40, S.PPU_R5B, 0x10)
<br />                 BITCOPY(S.PPU_R6RB, 0x80, S.PPU_R5B, 0x20)
<br />                 S.PPU_SCROLL_Y = S.PPU_R5B;
<br />                 if (S.PPU_SCROLL_Y &gt; 240)
<br />                     S.PPU_SCROLL_Y -= 240;
<br />             }
<br />
<br />             S.vAddr_Latch = (S.vAddr_Latch &amp; 0xFF)
<br />                           | ((word) (byData &amp; 0xFF) &lt;&lt; <img src="./images/smilies/icon_cool.gif" alt="8)" title="Cool" />;
<br />          }
<br />          else {
<br />             S.PPU_R6B = byData;
<br />
<br />             if ( S.PPU_Scanline &lt; 240 &amp;&amp; (S.PPU_R1 &amp; R1_SHOW_SCR) )
<br />             {
<br />                 BITCOPY(S.PPU_R6RA, 0x01, S.PPU_R5B, 0x40)
<br />                 BITCOPY(S.PPU_R6RA, 0x02, S.PPU_R5B, 0x80)
<br />                 BITCOPY(S.PPU_R6RA, 0x08, S.PPU_R0,  0x01)
<br />                 BITCOPY(S.PPU_R6RA, 0x10, S.PPU_R5B, 0x01)
<br />                 BITCOPY(S.PPU_R6RA, 0x20, S.PPU_R5B, 0x02)
<br />                 BITCOPY(S.PPU_R6RA, 0x40, S.PPU_R5B, 0x04)
<br />                 BITCOPY(S.PPU_R6RB, 0x20, S.PPU_R5B, 0x08)
<br />                 BITCOPY(S.PPU_R6RB, 0x40, S.PPU_R5B, 0x10)
<br />                 BITCOPY(S.PPU_R6RB, 0x80, S.PPU_R5B, 0x20)
<br />                 S.PPU_SCROLL_X = S.PPU_R5A;
<br />             }
<br />
<br />             S.vAddr_Latch = (S.vAddr_Latch &amp; 0xFF00)
<br />                           | ((word) byData &amp; 0xFF);
<br />          }
<br />          S.vAddr = S.vAddr_Latch &amp; 0x3FFF;
<br />          break;
<br />
<br />
<br />        case 0x2007: /* VRAM Data */
<br />        {
<br />            wScratch = S.vAddr;
<br />            wScratch &amp;= 0x3FFF;
<br />
<br />            S.vAddr += (S.PPU_R0 &amp; R0_INC_ADDR) ? 0x20 : 0x01;
<br />            if (S.vAddr &gt; 0x3FFF)
<br />                S.vAddr &amp;= 0x3FFF;
<br />
<br />            if (wScratch &lt; 0x2000 &amp;&amp; S.VRAMWriteEnable)
<br />            {
<br />              /* Pattern Data */
<br />              S.ChrBufUpdate |= ( 1 &lt;&lt; ( wScratch &gt;&gt; 10 ) );
<br />              W.PPUBANK[ wScratch &gt;&gt; 10 ][ wScratch &amp; 0x3FF ] = byData;
<br />            }
<br />            else if (wScratch &lt; 0x3F00 )  /* 0x2000 - 0x3EFF */
<br />            {
<br />              /* Name Table and Mirror */
<br />              W.PPUBANK[ (wScratch) &gt;&gt; 10 ][ wScratch &amp; 0x3ff ] = byData;
<br />              W.PPUBANK[ (wScratch ^ 0x1000) &gt;&gt; 10][ wScratch &amp; 0x3FF ] = byData;
<br />            }
<br />            else if (!(wScratch &amp; 0xF))  /* 0x3F00 or 0x3F10 */
<br />            {
<br />                /* Palette Mirror */
<br />                S.PPURAM[ 0x3f10 ] = S.PPURAM[ 0x3f14 ] = S.PPURAM[ 0x3f18 ]
<br />              = S.PPURAM[ 0x3f1c ] = S.PPURAM[ 0x3f00 ] = S.PPURAM[ 0x3f04 ]
<br />              = S.PPURAM[ 0x3f08 ] = S.PPURAM[ 0x3f0c ] = byData;
<br />
<br />                S.PalTable[ 0x00 ] = S.PalTable[ 0x04 ] = S.PalTable[ 0x08 ]
<br />              = S.PalTable[ 0x0c ] = S.PalTable[ 0x10 ] = S.PalTable[ 0x14 ]
<br />              = S.PalTable[ 0x18 ] = S.PalTable[ 0x1c ]
<br />              = NesPalette[ byData ] | 0x8000;
<br />            }
<br />            else if (wScratch &amp; 0x03)
<br />            {
<br />              /* Palette */
<br />              S.PPURAM[ wScratch ] = byData;
<br />              S.PalTable[ wScratch &amp; 0x1f ] = NesPalette[ byData ];
<br />            }
<br />        }
<br />        break;
<br />    }
<br />    break;
<br />
<br />Relevant portions of DrawScanline:
<br />
<br />  Exec6502(&amp;S.m6502_state, STEP_PER_HBLANK);
<br />
<br />  /* Reload horizontal scroll bits at beginning of each scanline */
<br />
<br />  if ( S.PPU_Scanline &lt; 240 )
<br />  {
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x04, S.PPU_R0,  0x01)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x01, S.PPU_R5A, 0x08)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x02, S.PPU_R5A, 0x10)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x04, S.PPU_R5A, 0x20)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x08, S.PPU_R5A, 0x40)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x10, S.PPU_R5A, 0x80)
<br />  }
<br />
<br />  /* Reload vertical scroll bits at end of VBLANK */
<br />
<br />  if ( S.PPU_Scanline == 0 )
<br />  {
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x01, S.PPU_R5B, 0x40)
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x02, S.PPU_R5B, 0x80)
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x08, S.PPU_R0,  0x01)
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x10, S.PPU_R5B, 0x01)
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x20, S.PPU_R5B, 0x02)
<br />      BITCOPY_BACK(S.PPU_R6RA, 0x40, S.PPU_R5B, 0x04)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x20, S.PPU_R5B, 0x08)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x40, S.PPU_R5B, 0x10)
<br />      BITCOPY_BACK(S.PPU_R6RB, 0x80, S.PPU_R5B, 0x20)
<br />  }
<br />
<br />  NESCore_Develop_Scroll_Values();
<br />
<br />  /* Render Background */
<br />  /* ================= */
<br />
<br />  /* MMC5 VROM Switch */
<br />  MapperRenderScreen(1);
<br />
<br />  pPoint = &amp;S.WorkFrame[ S.PPU_Scanline * NES_DISP_WIDTH ];
<br />
<br />  if (!( S.PPU_R1 &amp; R1_SHOW_SCR ))
<br />  {
<br />    /* Clear scanline if display is off */
<br />    memset( pPoint, 0, NES_DISP_WIDTH &lt;&lt; 1 ); /* Assumes 16-Bit buffer! */
<br />  }
<br />  else
<br />  {
<br />    nY =  S.PPU_SCROLL_Y_BYTE + (S.PPU_Scanline &gt;&gt; 3);
<br />    nYBit = S.PPU_SCROLL_Y_BIT + (S.PPU_Scanline &amp; 7);
<br />
<br />    if ( nYBit &gt; 7 )
<br />    {
<br />      nYBit &amp;= 7;
<br />      nY++;
<br />    }
<br />    nYBit &lt;&lt;= 3;
<br />
<br />    nNameTable = NAME_TABLE0 + (S.PPU_R0 &amp; 0x03);
<br />
<br />    /* Determine which Vertical Name Table we're in */
<br />    if (nY &gt; 29)
<br />    {
<br />        nY -= 30;
<br />        nNameTable ^= NAME_TABLE_V_MASK;
<br />    }
<br />
<br />    nX = S.PPU_SCROLL_X_BYTE;
<br />    nY4 = ( ( nY &amp; 0x02 ) &lt;&lt; 1 );</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27006"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27006">Re: What is WRONG with my PPU???</a></div><div style="float: right;"><a href="./viewtopic.php?p=27006#p27006"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 4:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You shouldn't be keeping "Scroll X" and "Scroll Y" registers. All rendering should be done using the VRAM address, and the VRAM address should be updated from the latch as described in Loopy's document at the appropriate times. The only pure "scroll" value in the actual NES is the 3-bit fine X scroll offset.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27007"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27007">Re: What is WRONG with my PPU???</a></div><div style="float: right;"><a href="./viewtopic.php?p=27007#p27007"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 4:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Do you have a version of this software that compiles on Win32 (2k/XP) with free software? If so, I can probably fix it for you. That's the only platform I have access to, however.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27009"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27009"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27009#p27009"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 5:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hey Josh
<br />
<br />You could change up the InfoNES win32 code pretty easily to work with it - that's all I can think of.... if you wanted to have a whack at fixing it  blindly, I'll gladly test it and send appropriate notes. I'll look into loopy's notes again, but I didn't get a whole lot out of that. I'm pretty new to NES emulation, I'm more interested in just making the iphone parts of it work well (e.g. the multitouch, directional sensor, etc) But please, feel free to send some patches and I'll give 'em a try. The complete code for the core can be downloaded from here:
<br />
<br />svn co <!-- m --><a class="postlink" href="http://svn.natetrue.com/nesapp/src/NESCore">http://svn.natetrue.com/nesapp/src/NESCore</a><!-- m --></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27011"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27011"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27011#p27011"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 5:09 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've seen several different formulas for computing X/Y from the vAddr - have you got a definitive one?
<br />
<br />This is the one i'm using now (after putting loopy's stuff in)
<br />   SX = ((S.vAddr &amp; 0x001F) &lt;&lt; 3 )
<br />      | ((S.vAddr &amp; 0x0400) &gt;&gt; 2 )
<br />      | (S.PPU_R5A &amp; 0x7);
<br />   SY = ((S.vAddr &amp; 0x03E0) &gt;&gt; 2 )
<br />      | ((S.vAddr &amp; 0x0800) &gt;&gt; 3 )
<br />      | ((S.vAddr &amp; 0x7000) &gt;&gt; 12 );
<br />
<br />Not quite there yet, however</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27012"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27012"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27012#p27012"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 5:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">(addr &gt;&gt; 12) &amp; 7    &lt;---  fine Y scroll
<br />(addr &gt;&gt; 5) &amp; 0x1F   &lt;---  coarse Y
<br />addr &amp; 0x1F   &lt;--- coarse X
<br />(addr &gt;&gt; 10) &amp; 1  &lt;---  NT X
<br />(addr &gt;&gt; 11) &amp; 1  &lt;---  NT Y
<br />
<br />or imagine the PPU address as a 15-bit value:
<br />
<br />[.yyy VHYY YYYX XXXX]
<br />y = fine Y
<br />V = NT Y
<br />H = NT X
<br />Y = coarse Y
<br />X = coarse X
<br />
<br />
<br />fine X scroll is stored seperately and is never changed or updated except on the first $2005 write.
<br />
<br />EDIT - really though, you shouldn't need this except for converting $2005 writes.
<br />
<br />If you keep the PPU address updated properly (increment by 1 every 8 cycles, etc), then all you have to do to fetch the proper tile is:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tile = NameTableRead&#40; 0x2000 | &#40; ppu_addr &amp; 0x0FFF&#41; &#41;;<br />chraddr = pattern_page | &#40;tile &lt;&lt; 4&#41; | &#40;&#40;ppu_addr &gt;&gt; 12&#41; &amp; 7&#41;;<br /><br />lo_chrbitplane = CHRRead&#40; chraddr &#41;;<br />hi_chrbitplane = CHRRead&#40; chraddr | 8 &#41;;<br /></div>
<br />
<br />where 'pattern_page' is either 0x0000 or 0x1000 depending on which pattern table you're reading from.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27014"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27014"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27014#p27014"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 5:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think that's part of his problem - he seems to cycle all scanline cycles before drawing the scanline. I don't see an increment of vAddr here either, although I could add it. He's doing a lot of this in the code it looks like. Here's what he had with loopy's stuff:
<br />READ:
<br />
<br />            case (0x2007): /* VRAM Read */
<br />                if (S.vAddr &lt;0x3F00) {
<br />                    wScratch = S.vAddr;
<br />                    wScratch &amp;= 0x3FFF;
<br />                    bScratch = S.PPU_R7;
<br />                    S.PPU_R7 = W.PPUBANK[ wScratch &gt;&gt; 10 ][ wScratch &amp; 0x3FF ];
<br />                } else {
<br />                    bScratch = W.PPUBANK[ wScratch &gt;&gt; 10 ] [ wScratch &amp; 0x3FF ];
<br />                }
<br />
<br />                S.vAddr += (S.PPU_R0 &amp; R0_INC_ADDR) ? 0x20 : 0x01;
<br />                S.vAddr &amp;= 0x3FFF;
<br />
<br />                return bScratch;
<br />                break;
<br />
<br />            case (0x2004): /* SPR-RAM Read */
<br />                return S.SPRRAM[ S.PPU_R3 ];
<br />                break;
<br />
<br />            case (0x2002):
<br />                S.PPU_Latch_Flag = 0;
<br />
<br />                if (S.PPU_Scanline &gt;= SCAN_VBLANK_START
<br />                  &amp;&amp; (!(S.PPU_R0 &amp; R0_NMI_VB)))
<br />                {
<br />                    S.PPU_R0 &amp;= ~R0_NAME_ADDR;
<br />                    S.PPU_NameTable = NAME_TABLE0;
<br />                }
<br />
<br />                return S.PPU_R2;
<br />                break;
<br />
<br />            default: /* $2000, $2001, $2003, $2005, $2006 */
<br />                return S.PPU_R7;
<br />                break;
<br />        }
<br />
<br />
<br />WRITE:
<br />
<br />        case 0x2000: /* PPU Control Register 1 */
<br />          S.PPU_R0 = byData;
<br />          S.PPU_SP_Height     = (S.PPU_R0 &amp; R0_SP_SIZE) ? 0x10 : 0x08;
<br />          S.PPU_NameTable = NAME_TABLE0 + (S.PPU_R0 &amp; R0_NAME_ADDR);
<br />          W.PPU_BG = (S.PPU_R0 &amp; R0_BG_ADDR) ? S.ChrBuf + 0x4000 : S.ChrBuf;
<br />          W.PPU_SP = (S.PPU_R0 &amp; R0_SP_ADDR) ? S.ChrBuf + 0x4000 : S.ChrBuf;
<br />
<br />          S.vAddr_Latch = (S.vAddr_Latch &amp; 0xF3FF )
<br />                        | (( ((word) byData) &amp; 0x0003 ) &lt;&lt; 10);
<br />
<br />          break;
<br />
<br />        case 0x2001: /* PPU Control Register 2 */
<br />          S.PPU_R1 = byData;
<br />          break;
<br />
<br />        case 0x2002: /* PPU Status - NOT WRITABLE */
<br />          break;
<br />
<br />        case 0x2003: /* Sprite RAM ADDR */
<br />          S.PPU_R3 = byData;
<br />          break;
<br />
<br />        case 0x2004: /* Sprite RAM DATA */
<br />          S.SPRRAM[ S.PPU_R3++ ] = byData;
<br />          break;
<br />
<br />        case 0x2005: /* Scroll Register */
<br />          if (S.PPU_Latch_Flag ^= 1) {
<br />            S.PPU_R5A = byData;
<br />
<br />            S.vAddr_Latch = ( S.vAddr_Latch &amp; 0xFFE0 )
<br />                          | ((( (word) byData ) &amp; 0xF8) &gt;&gt; 3);
<br />
<br />          } else {
<br />            S.PPU_R5B = byData;
<br />            if (S.PPU_R5B &gt; 239)
<br />                S.PPU_NameTable ^= NAME_TABLE_V_MASK;
<br />
<br />            S.vAddr_Latch = (S.vAddr_Latch &amp; 0xFC1F)
<br />                        | ( ( ((word) byData ) &amp; 0xF8 ) &lt;&lt; 2);
<br />            S.vAddr_Latch = (S.vAddr_Latch &amp; 0x8FFF)
<br />                        | ( ( ((word) byData ) &amp; 0x07 ) &lt;&lt; 12);
<br />          }
<br />          break;
<br />
<br />        case 0x2006: /* VRAM Address Register */
<br />          if (S.PPU_Latch_Flag ^= 1) {
<br />             S.PPU_R6A = byData;
<br />
<br />          S.vAddr_Latch = (S.vAddr_Latch &amp; 0x00FF )
<br />                           | (( ((word) byData) &amp; 0x003F) &lt;&lt; <img src="./images/smilies/icon_cool.gif" alt="8)" title="Cool" />;
<br />          }
<br />          else {
<br />             S.PPU_R6B = byData;
<br />        }
<br />
<br />          S.vAddr_Latch = (S.vAddr_Latch  &amp; 0xFF00)
<br />                        | ( ((word) byData) &amp; 0x00FF);
<br />          S.vAddr = S.vAddr_Latch;
<br />
<br />          if (!( S.PPU_R2 &amp; R2_IN_VBLANK))
<br />              NESCore_Develop_Character_Data();
<br />          break;
<br />
<br />
<br />So based on that, I've no idea what the X/Y values are... it looks like he also computes nY and nX from inside the drawing routine, based on X/Y... I'm wondering if that's right.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27017"></a>
				<b class="postauthor">Josh</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27017">Re: What is WRONG with my PPU???</a></div><div style="float: right;"><a href="./viewtopic.php?p=27017#p27017"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 6:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 19, 2005 11:18 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">When I have some free time this week, I'll take a closer look at the code. It doesn't look all that complicated, so I can probably get it working on Windows with SDL (not the best platform, but very simple to get something up and running without writing too much extra wrapper code).
<br />
<br />By the way, you really should replace Marat's 6502 core, as it's not compatible with the GPL. Besides, there are much better cores out there. I think blargg has one written in C that works well (and is probably faster).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=110"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27018"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27018"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27018#p27018"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 16, 2007 6:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hmm Marat said taht the LGPL would be compatible (which is what I've got the core licensed as) but I'm all up for replacing it with something faster - send me a link if you've got one.
<br />
<br />The latest is committed to SVN - any help you can offer would be appreciated, and I'm serious about throwing a few hundred bucks at someone who can fix this mess (I've got other things to worry about).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27032"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27032"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27032#p27032"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 2:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">(addr &gt;&gt; 12) &amp; 7    &lt;---  fine Y scroll<br />(addr &gt;&gt; 5) &amp; 0x1F   &lt;---  coarse Y<br />addr &amp; 0x1F   &lt;--- coarse X<br />(addr &gt;&gt; 10) &amp; 1  &lt;---  NT X<br />(addr &gt;&gt; 11) &amp; 1  &lt;---  NT Y<br /><br />or imagine the PPU address as a 15-bit value:<br /><br />[.yyy VHYY YYYX XXXX]<br />y = fine Y<br />V = NT Y<br />H = NT X<br />Y = coarse Y<br />X = coarse X<br /><br /><br />fine X scroll is stored seperately and is never changed or updated except on the first $2005 write.<br /><br />EDIT - really though, you shouldn't need this except for converting $2005 writes.<br /><br />If you keep the PPU address updated properly (increment by 1 every 8 cycles, etc), then all you have to do to fetch the proper tile is:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tile = NameTableRead&#40; 0x2000 | &#40; ppu_addr &amp; 0x0FFF&#41; &#41;;<br />chraddr = pattern_page | &#40;tile &lt;&lt; 4&#41; | &#40;&#40;ppu_addr &gt;&gt; 12&#41; &amp; 7&#41;;<br /><br />lo_chrbitplane = CHRRead&#40; chraddr &#41;;<br />hi_chrbitplane = CHRRead&#40; chraddr | 8 &#41;;<br /></div><br /><br />where 'pattern_page' is either 0x0000 or 0x1000 depending on which pattern table you're reading from.</div>
<br />
<br />OK Put this in engrish for someone who doesn't speak much NES-geek. I understand from this how to calculate the scroll values, but it sounds like i'm not supposed to calculate them every scanline... so where do I do it? Just in $2005 writes? What's the difference between fine/coarse X/Y? I have an X/Y _BYTE and _BIT in my code which get calculated - is this what you're referring to? Right now it's calculating the bit off the byte.
<br />
<br />And where does this fine x come from?
<br />
<br />I'm doing my best to make sense of the PPU - I'm just not getting it apparently. I had no problem fixing all the broken stuff in the pAPU.
<br />
<br />Finally, where should i be loading the name table? At the beginning of each scanline, and then flipping it? I tried grabbing it every clock cycle but that seemed to cause more problems. I 'm not clocking within the PPU rendering, so 84/85 clocks per scanline + 29 for hblank. That's around 1 clock every 3 pixels.
<br />
<br />Making progress at least. I think my biggest issue is figuring out how to do the scroll values.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27034"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27034"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27034#p27034"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 3:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1694
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">This link may help:
<br />
<br /><!-- m --><a class="postlink" href="http://nesdev.com/bbs/viewtopic.php?p=5578">http://nesdev.com/bbs/viewtopic.php?p=5578</a><!-- m -->
<br />
<br />There are no scroll registers in the NES.  Instead, the PPU automatically adjust the PPU address as tiles are rendered (increments it by 1 after every tile fetch... wraps around nametable boundaries -- that kind of thing).  From the sound of it, your problem isn't that you doing something at the wrong time, it's that you're doing the wrong thing overall (though the way you're doing it may be unavoidable due to you targetting lower performance systems -- in which case I doubt I'll be of any help)
<br />
<br />Each scanline is 341 'dots' (or PPU cycles).  On NTSC, there are 3 dots to every CPU cycle.  Dots 0-255 each render 1 pixel.  Every set of 8 dots (0-7, 8-15, etc) perform a tile fetch and during BG tile fetches, the PPU address is adjusted so that it points to the next tile.
<br />
<br />I could probably do a better job explaining if I really examined the code you pasted -- but admittedly I didn't  =x</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27036"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27036"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27036#p27036"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 3:31 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3090
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Rad Racer is a little tricky because it writes new values to the 'scroll registers' while the screen is rendering, before pixel clock 256.  So the 'Y scroll value' will increase at pixel clock 256 and that applies to the next scanline.
<br />
<br />(Is it pixel clock 256 when the 'Y-value' increments?  Someone clarify this for me)</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27038"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27038"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27038#p27038"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 4:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3090
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">All scrolling related values should be updated at the same time as the PPU address and ppu temp address.
<br />
<br />If I make any mistakes in the explanation, please correct me.  I'm pretty sure there are some mistakes in this.  This is basically the result of looking at Loopy's scrolling document.
<br />
<br />So we got these variables (my names)
<br />Xscroll - this is what you see on the screen
<br />Next_Xscroll - writes to 2000, 2005, 2006 affect this.  The top 5 bits get copied to Xscroll's top 5 bits at the end of the scanline*.
<br />Yscroll - This counts up after the end of a scanline*, and is set by the second write to 2006, and set at the first scanline.
<br />Reset_Yscroll - At scanline 0, write this to yscroll*.  Writes to 2000, Second write to 2005, Second write to 2006 affects this.
<br />
<br />Writes to 2000 affect PPU temp address, Next_Xscroll and Reset_Yscroll
<br />First write to 2005 affects the PPU temp address, Next_Xscroll, and the three lowest bits of Xscroll (Fine X Scroll)
<br />Second write to 2005 affects the PPU temp address, and Reset_Yscroll
<br />First write to 2006 affects the PPU temp address and Reset_Yscroll
<br />Second write to 2006 affects the PPU temp address, PPU Address, Next_Xscroll, Xscroll, Yscroll, and Reset_Yscroll.
<br />
<br />At pixel clock 256 (?), if the PPU is rendering (scanline is in visible range, and sprites or BG is enabled), Yscroll increments by 1.  Top 5 bits of Next_Xscroll get copied to Xscroll.
<br />At the start of the first scanline, if screen rendering is enabled, set PPU address to PPU temp address, write 5 the bits from next_xscroll, and set yscroll to reset_yscroll.
<br />
<br />So yeah, this is basically sticking a different label on the exact same thing.
<br />
<br />*Changes to the visible scrolling values only happen if the screen is rendering, or it's the second write to 2006.</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p27039"></a>
				<b class="postauthor">NerveGas</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27039"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27039#p27039"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 4:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 16, 2007 10:41 am<br /><b>Posts:</b> 29
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Lets do this the right way - forget I've got scroll variables... let me trash everything pertaining to scroll readers/writers... what's the best way to design this overall? I'm updating vAddr like this:
<br />
<br />$2006(A)
<br />             S.vAddr_Latch = (S.vAddr_Latch &amp; 0xFF)
<br />                           | ((word) (byData &amp; 0xFF) &lt;&lt; <img src="./images/smilies/icon_cool.gif" alt="8)" title="Cool" />;
<br />
<br />$2006(B)
<br />             S.vAddr_Latch = (S.vAddr_Latch &amp; 0xFF00)
<br />                           | ((word) byData &amp; 0xFF);
<br />             S.vAddr = S.vAddr_Latch &amp; 0x3FFF;
<br />
<br />So first off, have I got the correct vAddr setup? Also, it is incrementing it by 1 or 32 on a $2007 read or write.
<br />
<br />Is this all correct? Am I missing any vAddr updates? 
<br />
<br />Once this is correct, moving onto the scrolling, lets say I'm writing $2005 writes directly to PPU_R5A and PPU_R5B registers, as well as 2006 writes (for posterity). When and how should I be calculating X/Y offsets based off this? The current DrawScanline routine uses a X_BYTE, X_BIT, Y_BYTE, and Y_BIT. I am assuming that's the course/fine settings - does that sound reasonable? It also calculated nY and nX based off of these values. I presume these are the tile numbers, as nY &gt; 30 triggers a name table flip and -= 30. I can change any of this, just let me know what.
<br />
<br />If all the above is correct, what values should I be computing, when, and how?
<br />
<br />As for clocking, I am clocking 84/85 cycles + an additional 29 at HBLANK. This is being done at the time of rendering about every 3 pixels or so, so it should be timed correctly. Let me know if this is wrong... also which frames should be 84 and 85? even and odd? and is that based off of a zero-indexed scanline #?
<br />
<br />Thanks so much for the help - I really want to do this right. Off to read more docs. I have a feeling it's just a matter of "doing the right thing" but I need to understand what the right thing is. Sorry to sound like such a dumb-ass. I'm normally a very proficient coder, but I'm failing to understand wtf is going on here.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3402"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p27041"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p27041"></a></div><div style="float: right;"><a href="./viewtopic.php?p=27041#p27041"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 17, 2007 4:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 3090
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">S.vAddr gets updated at pixel clock 256 (?) of a scanline if rendering is enabled, copies lowest 5 bits and bit 11.
<br />S.vAddr = S.vAddr &amp; 0x41F | (S.vAddr_Latch &amp; 0x41F);
<br />
<br />S.vAddr also gets completely updated at the start of line 0 if rendering is enabled (first visible scanline)  (not completely sure of the timing!)
<br />S.vAddr = S.vAddr_Latch &amp; 0x3FFF;</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=3585"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=3585"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 34 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=3585&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=3585&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="3585" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Some help with VBL..</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Some help with VBL.." href="http://forums.nesdev.com/feed.php?f=3&amp;t=1892" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '2');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=1892';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 9:54 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=1892&amp;start=15">Some help with VBL..</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=1892"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 38 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=1892&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=1892">1</a><span class="page-sep">, </span><strong>2</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=1892&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=1892&amp;start=30">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=1892&amp;start=15&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=1892&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=1892&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p16399"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16399"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16399#p16399"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 6:34 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I get exactly the same. Using the 'wrong' scheme, I get,
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CPUCycles =&nbsp; 89289 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89298/ 89342<br />CPUCycles =&nbsp; 89310 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89319/ 89342<br />CPUCycles =&nbsp; 89331 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89340/ 89342<br />CPUCycles =&nbsp; &nbsp; &nbsp;10 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342<br />CPUCycles =&nbsp; 89330 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89339/ 89342<br />CPUCycles =&nbsp; 89331 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89340/ 89342<br />CPUCycles =&nbsp; 89332 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89341/ 89342<br />CPUCycles =&nbsp; 89333 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89342/ 89342<br />CPUCycles =&nbsp; 89334 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89343/ 89342<br />CPUCycles =&nbsp; 89335 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89344/ 89342<br />CPUCycles =&nbsp; 89336 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89345/ 89342<br />CPUCycles =&nbsp; 89337 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89346/ 89342<br />CPUCycles =&nbsp; 89338 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89347/ 89342<br />CPUCycles =&nbsp; 89339 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89348/ 89342<br />CPUCycles =&nbsp; 89340 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89349/ 89342<br />CPUCycles =&nbsp; 89341 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89350/ 89342 &lt;-- DISABLED HERE!<br />CPUCycles =&nbsp; &nbsp; &nbsp; 0 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342<br />CPUCycles =&nbsp; 89341 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89350/ 89342 &lt;-- DISABLED HERE!<br />CPUCycles =&nbsp; &nbsp; &nbsp;59 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342</div><br /><br />while using the 'right' one I get,<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CPUCycles =&nbsp; 89289 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89298/ 89342<br />CPUCycles =&nbsp; 89310 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89319/ 89342<br />CPUCycles =&nbsp; 89331 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89340/ 89342<br />CPUCycles =&nbsp; &nbsp; &nbsp;10 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342<br />CPUCycles =&nbsp; 89330 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89339/ 89342<br />CPUCycles =&nbsp; 89331 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89340/ 89342<br />CPUCycles =&nbsp; 89332 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89341/ 89342 &lt;-- DISABLED HERE!<br />CPUCycles =&nbsp; 89333 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89342/ 89342<br />CPUCycles =&nbsp; 89334 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89343/ 89342<br />CPUCycles =&nbsp; 89335 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89344/ 89342<br />CPUCycles =&nbsp; 89336 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89345/ 89342<br />CPUCycles =&nbsp; 89337 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89346/ 89342<br />CPUCycles =&nbsp; 89338 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89347/ 89342<br />CPUCycles =&nbsp; 89339 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89348/ 89342<br />CPUCycles =&nbsp; 89340 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89349/ 89342<br />CPUCycles =&nbsp; 89341 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89350/ 89342<br />CPUCycles =&nbsp; &nbsp; &nbsp; 0 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342<br />CPUCycles =&nbsp; 89341 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89350/ 89342<br />CPUCycles =&nbsp; &nbsp; &nbsp;59 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; &nbsp;6820/ 89342</div>
<br />
<br />Note that I'm running the PPU for CPUCycles + miniCycles. Could you tell me if you get that double suppression?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p16406"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16406"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16406#p16406"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 9:37 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Sorry, I'm not making much sense of your data or explanation.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p16410"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16410"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16410#p16410"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 11:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">To me, it looks like the timestamps are way off... like the test ROM is just syncing improperly.  I'd guess you're "wrong" method is working because it's offsetting the timestamp of the read by the same number of cycles the ROM is off in its sync (coincidence?  or maybe you made a similar mistake twice and only corrected one of them?)
<br />
<br />Here's a quick log I made... maybe it'll help.  My timestamps are a little different -- I start my frame with the idle scanline (scanline after rendering, before VBL), so VBL starts at PPU cycle 341.  Additionally -- the timestamp in this log is 1 more than you'd expect (suppresses on 341 not on 340)... as for why, don't ask  ;P
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;-- frame $7E and earlier read $2002 every 21<br />&nbsp; &nbsp; ppu cycles -- presumably to sync --<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 226 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 247 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 268 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 289 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 310 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 331 --- VBL supress: No<br />frame:&nbsp; 0000007E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 352 --- VBL supress: No<br /><br />-- by this frame, it's synced and reads once per frame<br />&nbsp; &nbsp; for so many frames until it hits the time right before VBl raises --<br /><br />frame:&nbsp; 00000080 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 330 --- VBL supress: No<br />frame:&nbsp; 00000081 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 331 --- VBL supress: No<br />frame:&nbsp; 00000082 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 332 --- VBL supress: No<br />frame:&nbsp; 00000083 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 333 --- VBL supress: No<br />frame:&nbsp; 00000084 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 334 --- VBL supress: No<br />frame:&nbsp; 00000085 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 335 --- VBL supress: No<br />frame:&nbsp; 00000086 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 336 --- VBL supress: No<br />frame:&nbsp; 00000087 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 337 --- VBL supress: No<br />frame:&nbsp; 00000088 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 338 --- VBL supress: No<br />frame:&nbsp; 00000089 --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 339 --- VBL supress: No<br />frame:&nbsp; 0000008A --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 340 --- VBL supress: No<br />frame:&nbsp; 0000008B --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 341 --- VBL supress: Yes<br />frame:&nbsp; 0000008C --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 342 --- VBL supress: No<br />frame:&nbsp; 0000008E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 341 --- VBL supress: Yes<br />frame:&nbsp; 0000008E --&nbsp; cyc:&nbsp; &nbsp; &nbsp; 401 --- VBL supress: No<br /></div><br /><br />these times are the time of the $2002 read (last cycle in the LDA $2002 instruction).  I didn't see any point in logging the PPU timestamp since my emu syncs up on $2002 reads anyway, so it'd be redundant.<br /><br /><br />EDIT<br /><br />yeah, see?  after comparing our logs, it looks to me like your timestamp is always off by 3 CPU cycles.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CPUCycles =&nbsp; 89330 - miniCycles=&nbsp; 9 - PPUCycles =&nbsp; 89339/ 89342<br /></div>
<br />
<br />This is the first 'once-per-frame' read performed.  If you notice, the read SHOULD be happening on cycle 89330, but it's happening 9 cycles later.
<br />
<br />So the ROM seems to be synced up improperly and is off by 3 cpu cycles somehow.
<br />
<br />
<br />EDIT AGAIN
<br />
<br />To be honest... I'm baffled as to how it's making it to test 8... since if it's off by 3 cycles it should be failing some of the earlier tests.
<br />
<br />Only thing I can think of is you're not syncing up your PPU to the right time on $2002 reads.  Like if you were syncing up to 'CPUCycles' and not 'CPUCycles + (minicycles * 15)' -- that would probably explain all the behavior you're getting.
<br />
<br />
<br />
<br />
<br />Last edit, I swear:
<br />
<br />Now that I think of it... that's a very distinct possibility.  Considering what you said before:
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Of course, I call PPU-&gt;Run( CPUCycles + cycles ); before doing that check..</div>
<br />
<br />if 'cycles' is 3 or some other low value there (like if you didn't multiply it by 15 or 16 depending on NTSC/PAL mode)... you're effectively adding 0, since 3 isn't even enough to push it to the next PPU cycle (which would need at least 5)
<br />
<br />so if you ARE doing PPU-&gt;Run( CPUCycles + cycles );... you <strong>want</strong> to be doing PPU-&gt;Run( CPUCycles + (cycles * CPUCycleBase) );
<br />
<br />Hopefully that's the problem</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p16413"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16413"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16413#p16413"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 12:16 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Aggh.. I'm getting mad  <img src="./images/smilies/icon_cry.gif" alt=":cry:" title="Crying or Very sad" /> Let's see.. just to clear this. On 0x2002 reads, I should update the PPU to CPUCycles+miniCycles and then check if CPUCycles+miniCycles equals the length of a frame minus one cycle.. is that right?
<br />
<br />The 3 cycles difference between CPU and PPU you see in my log is my fault. You should add miniCycles to CPUCycles to get the real number, you know..</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p16415"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16415"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16415#p16415"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 12:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Muchaserres wrote:</div><div class="quotecontent">On 0x2002 reads, I should update the PPU to CPUCycles+miniCycles</div><br /><br />yes.<br /><br />I'm just wondering if you have your bases right.<br /><br />You said before you have 1 PPU cycle equal 5 'master' cycles, and 1 CPU cycle equal 15 master cycles.  Since the minicycle reflects CPU cycles, it should have the same 15 master cycle base.<br /><br />If you're just adding 3 when you <em>mean</em> to be adding 45, you'll have problems like the stuff you're experiencing now.  Could this be what is happening?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The 3 cycles difference between CPU and PPU you see in my log is my fault. You should add miniCycles to CPUCycles to get the real number, you know..</div>
<br />
<br />I figured as much... but that's not the 3 cycle difference I was talking about.
<br />
<br />The read from your log I pasted in my previous post happens on cycle 89339.  It <strong>should</strong> be happening on 89330 (that's the time it's happening in my log).
<br />
<br />Whether or not your timestamp being off by 3 cycles and minicycles always being 3 cpu cycles are at all related or whether they're just a coincidence I couldn't tell you.  All I can say is somewhere, somehow, the ROM is syncing up improperly causing it to be off by 3 CPU cycles by the time it checks for the VBl supression.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p16419"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16419"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16419#p16419"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 21, 2006 1:18 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The NESdevWiki page covers the behavior in detail: <a href="http://nesdevwiki.ath.cx/index.php/PPU_Frame_Timing" class="postlink">PPU Frame Timing</a>
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Reading $2002 within a few PPU clocks of when VBL is set results in special-case behavior. Reading one PPU clock before reads it as clear and never sets the flag or generates NMI for that frame. Reading on the same PPU clock or one later reads it as set, clears it, and suppresses the NMI for that frame. Reading two or more PPU clocks before/after it's set behaves normally (reads flag's value, clears it, and doesn't affect NMI operation).</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p16562"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16562"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16562#p16562"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Aug 25, 2006 4:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">If you're just adding 3 when you mean to be adding 45, you'll have problems like the stuff you're experiencing now. Could this be what is happening?</div>
<br />
<br />I've checked this several times, I'm adding 45 cycles.
<br />
<br />Just an idea. For every frame, I do,
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">FRMCycles = ...;&nbsp; &nbsp; &nbsp; &nbsp;// Frame master cycles calculation.<br />CPU-&gt;Run&#40; FRMCycles &#41;; // Runs for FRMCycles, calling PPU-&gt;Run&#40;&#41; whenever something interesting happens.<br />PPU-&gt;Run&#40; CPUCycles &#41;; // Runs for the remaining cycles.<br />NMIStuff&#40;&#41;;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // You know..</div>
<br />
<br />But as CPUCycles may sometimes be a little greater than FRMCycles, NMIStuff() accuracy can be compromissed. Should this be my problem? How do you handle this?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p16566"></a>
				<b class="postauthor">Disch</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p16566"></a></div><div style="float: right;"><a href="./viewtopic.php?p=16566#p16566"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Aug 25, 2006 6:42 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=33.png" width="65" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Nov 10, 2004 6:47 pm<br /><b>Posts:</b> 1670
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Muchaserres wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">FRMCycles = ...;&nbsp; &nbsp; &nbsp; &nbsp;// Frame master cycles calculation.<br />CPU-&gt;Run&#40; FRMCycles &#41;; // Runs for FRMCycles, calling PPU-&gt;Run&#40;&#41; whenever something interesting happens.<br />PPU-&gt;Run&#40; CPUCycles &#41;; // Runs for the remaining cycles.<br />NMIStuff&#40;&#41;;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // You know..</div></div><br /><br />If 'NMIStuff();' includes setting the VBlank flag... then yes, this is a problem, and quite possibly <em>the</em> problem.  If the VBlank flag is being raised by PPU-&gt;Run then you should be fine.<br /><br />As for why that would be a problem... consider the following:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />; Imagine LDA $2002 is executed 1 CPU cycle before the VBl flag raises:<br /><br /><br />cycle 0 -- fetch opcode &#40;vbl next cycle&#41;<br />cycle 1 -- fetch low adr &#40;vbl set!&#41;<br />cycle 2 -- fetch high adr &#40;vbl still set&#41;<br />cycle 3 -- read $2002 &#40;bit 7 should be set&#41;<br /></div>
<br />
<br />If the vblank flag is being set only BETWEEN cpu instructions, the timing of it gets rounded off.  This very well could be why your emu is desyncing (assuming this is the problem).
<br />
<br />
<br />My Frame function started out on a similar process but has since become a bit more complex (had to as I added other stuff, like sprite overflow prediction, mapper notification on end of vblank, and other crap).  Pretty much, the premise is exactly the same, but I treat NMIs more or less the same as IRQs... in that I just keep a timestamp of the 'nextNMI', and when the CPU timestamp reaches that time, I trigger an NMI.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=33"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p17274"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17274"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17274#p17274"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 12, 2006 6:34 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK! So, I finally got it working properly. Now my emu passes all errors from test roms #1 to #5, with no hacks, nor any other strange mechanisms. At last, I get precise timing stamps on my logs. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> First of all, I'd like to thank you all for being so patient with my posts. Thanks dudes!
<br />
<br />Now, for the remaining tests. In "6.nmi_disable" I get error #3. The problem here is that I really dunno what this rom is testing at all. I mean, I'm doing exactly what the wiki says about "VBL Flag Timing". What does "NMI should occur when disabled 3 PPU clocks after VBL" exactly mean? Is the wiki right on this?
<br />
<br />In "7.nmi_timing" I get error #7 ("NMI occurred 1 PPU clock too late"), but well.. I suppose I'd better work on test rom #6 before dealing with this one. Anyway, does anybody know the exact time delay (in cycles) between NMI triggering and NMI execution? I mean, how do you determine the exact time for "nextNMI"?
<br />
<br />And last, does anybody know the exact behaviour of "s0.nes" on the real thing? Maybe a photo or something.. I'm just curious.
<br />
<br />Thanks!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p17299"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17299"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17299#p17299"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 12, 2006 7:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">In "6.nmi_disable" I get error #3. The problem here is that I really dunno what this rom is testing at all.</div><br />My fault. It's testing what happens when NMI is disabled (via $2000) within a few PPU clocks of when it would normally occur. In light of recent testing, the error descriptions are off by one PPU clock, but the tests are still valid (since they pass on a NES). At some point I'll be improving the documentation of this kind of behavior.<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">In "7.nmi_timing" I get error #7 ("NMI occurred 1 PPU clock too late"), but well.. I suppose I'd better work on test rom #6 before dealing with this one.</div><br />In this case, failing 6.nmi_disable isn't a problem.<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Anyway, does anybody know the exact time delay (in cycles) between NMI triggering and NMI execution? I mean, how do you determine the exact time for "nextNMI"?</div>
<br />Based on recent testing, the earliest the NMI can occur is two CPU clocks after the VBL flag is set. So if VBL is set on the next to last clock of an instruction, the NMI will occur after the instruction finishes. If it's set earlier than that clock, the NMI will still occur after that instruction finishes. If it's set later than that clock, it will occur after the next instruction finishes.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p17370"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17370"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17370#p17370"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 13, 2006 3:13 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">blargg wrote:</div><div class="quotecontent">So if VBL is set on the next to last clock of an instruction</div>
<br />
<br />I don't get this at all.. I imagine you mean VBL being set on the last CPU clock of an instruction or earlier makes the NMI to occur at the end of that instruction, while VBL being set later makes it to occur at the end of the next instruction.
<br />
<br />Just in case, could you describe "7.nmi_timing"'s operation, please? Thx.
<br />
<br />&lt;EDIT&gt;
<br />
<br />I'm confused. So..
<br />
<br />1.- If VBL occurs before the last two CPU cycles of an instruction NMI occurs immediately after that instruction. If VBL occurs later, there's a one cycle delay. This option gives me "NMI occurred 1 PPU clock too late" (error #7). Here's how I implement that..
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40; Nes-&gt;CPUCycles &gt;= Nes-&gt;NMITime &#41;<br />&#123;<br />&nbsp; &nbsp;if&#40; Nes-&gt;Ppu-&gt;Regs&#91; 0 &#93; &amp; 0x80 &#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;NMI&#40; 2 &#41;; // NMI now!<br />&nbsp; &nbsp;&nbsp; &nbsp;if&#40; &#40; Nes-&gt;CPUCycles - Nes-&gt;NMITime &#41; &lt;= 30 &#41; NMI&#40; 1 &#41;; // Wait for 1 instruction &#40;30 comes from 2 cycles * 15 base&#41;.<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;Nes-&gt;NMITime = 0x7FFFFFFF;<br />&#125;</div><br /><br />2.- If we reduce the margin to one CPU cycle, I get "NMI occurred 1 PPU clock too early" (error #4). We would only change the 30 by a 15 (1 CPU cycle).<br /><br />3.- But, according to what dvdmth said in another post, "fast NMI" occurs always except when VBL occurs during the last cycle of an instruction. So the condition would look like this, giving me "NMI occurred 3 or more PPU clocks too early" (error #2),<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40; &#40; Nes-&gt;CPUCycles - Nes-&gt;NMITime &#41; == 15 &#41; NMI&#40; 1 &#41;;</div>
<br />
<br />Sorry if I'm being a pain, but I'd like to get this clear.
<br />
<br />&lt;/EDIT&gt;</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p17567"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17567"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17567#p17567"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Sep 16, 2006 2:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Uhm.. it works fine if I set the margin to 20 (so, 4 PPU cycles). It would somehow make sense it the latency were 1 CPU cycle (setting the margin to 15). The remaining PPU cycle could be some bug in my even/odd frame scheme. Anyone familiar with this issue?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p17631"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17631"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17631#p17631"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 17, 2006 3:14 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">After reading "Which clock is IRQ/NMI checked on?" at "NES Hardware / CopyNES", I think I finally understand how this stuff works. Look..
<br />
<br /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Apparently /NMI and /IRQ are checked approximately two cycles before the next opcode fetch, and if they are set, that next opcode fetch will be the first cycle of an interrupt vectoring sequence.</div><br /><br />OK, so if NMITime holds the time at which /NMI is set and CPUCycles the number of cycles the CPU has executed so far, then we do something like this,<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40; CPUCycles &gt;= NMITitme &#41;<br />&nbsp; &nbsp;if&#40; &#40; CPUCycles - NMITitme &#41; &lt; TwoCPUCycles &#41; SlowNMI&#40;&#41;; else FastNMI&#40;&#41;;</div><br /><br />But then this comes,<br /><br /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Since the memory read latches data near the end of a cycle, my conclusion is that /NMI and /IRQ are checked near the middle of second from the last cycle of an instruction. For LDA absolute, this means the third cycle (1: opcode fetch, 2: low byte of address, 3: high byte of address, 4: read, 5: set flags). For NOP, this means the first cycle (1: opcode fetch, 2: dummy fetch, 3: nothing).</div><br /><br />So LDA absolute takes 4 "visible" cycles, while NOP takes 2 of those. This time we do something like this,<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40; CPUCycles &gt;= NMITitme &#41;<br />&nbsp; &nbsp;if&#40; &#40; CPUCycles - NMITitme &#41; &lt; OneCPUCycles &#41; SlowNMI&#40;&#41;; else FastNMI&#40;&#41;;</div>
<br />
<br />Now, here it comes the reason why I think my code passes the test. Taking NOP as an example, the check happens in the middle of the first cycle (opcode fetch). In my emu, 1 CPU cycle equals 15 master cycles, while 1 PPU cycle equals 5 of them. In the code above, I use 20 master cycles as the limit, so 20/15=1.33 ~ 1.17 CPU cycles. As it is "impossible" to get the exact time I must use "&lt;=" instead of "&lt;". And that's it!
<br />
<br />Is this reasoning correct?
<br />
<br />Thx.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p17653"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17653"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17653#p17653"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 17, 2006 6:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 2802
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">At beginning of execution of an instruction in emulator:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if &#40; cpu_time &gt;= nmi_asserted_time + 2 &#41;<br />&nbsp; &nbsp; clear nmi<br />&nbsp; &nbsp; begin interrupt vectoring<br />else<br />&nbsp; &nbsp; execute current instruction</div><br />Or, in the catch up model,<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">earliest_interrupt_time = nmi_asserted_time + 2</div>
<br />
<br />I'm not following your descriptions in your posts because I don't know what you're talking about. I don't know how your emulator works or where exactly the code examples you're posting are being executed.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p17821"></a>
				<b class="postauthor">Muchaserres</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p17821"></a></div><div style="float: right;"><a href="./viewtopic.php?p=17821#p17821"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 20, 2006 4:04 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Nov 13, 2004 6:25 am<br /><b>Posts:</b> 96
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK, let's see. In terms of PPU cycles, the earliest a NMI can occur is the time a NMI is asserted plus 6 PPU cycles (2 CPU cycles). What I'm saying is that the only way my emu passes the test is by adding 5 PPU cycles (1.67 CPU cycles).
<br />
<br />I'm doing what you say, using a catch up model, on my CPU core run() function, just before the execution of every opcode.
<br />
<br />By comparing both NMI logs I can see that the first difference occurs the second frame, and then every 11 frames or so. What bugs me the most is that I pass every other PPU test, and all versions of your CPU timing test, so I don't really know how to tackle the problem.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=41"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=1892&amp;start=15"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=1892"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>3</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 38 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=1892&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=1892">1</a><span class="page-sep">, </span><strong>2</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=1892&amp;start=30">3</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=1892&amp;start=30">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="1892" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
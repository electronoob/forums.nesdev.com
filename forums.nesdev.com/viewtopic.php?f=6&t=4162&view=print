<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Live playback</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Live playback</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=4162">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=4162</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>OBE</b> [ Fri Jun 13, 2008 8:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Live playback</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hey NESDev,
<br />
<br />I'm a NSF composer and I'm looking into playing live shows. I have a problem though. As most of you know, the Powerpack is unavailable and I'm still looking for one in outside sources. I wanted to know if one can get NSF playback with the Powepack Lite? I don't use any chip extensions in my NSFs.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Fri Jun 13, 2008 11:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I am in the process of installing my copyNES. I was planning on making an NSF cart with my power pack lite as soon as it's installed. I'll let you know how it turns out! 
<br />
<br />However, there is NO REASON I can see why the playback code wouldn't work on the powerpack lite! It's a flash cart that is supposed to contain a rom image. The NSF playback code is a rom like all others. Note that powerpack lite will NOT work outside of copyNES.
<br />
<br />Good luck with your endeavors, I would like to hear your music.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Fri Jun 13, 2008 1:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Don't.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Fri Jun 13, 2008 2:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Don't what, and why not?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Jun 13, 2008 2:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You must be new here. Familiarize yourself with <a href="http://nesdev.com/bbs/search.php?search_author=NotTheCommonDose" class="postlink">NotTheCommonDose's posts</a> first.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Fri Jun 13, 2008 2:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">NotTheCommonDose wrote:</div><div class="quotecontent">Don't.</div>
<br />
<br />I'm thinking it means "Don't attempt this" or "Don't even try" or something like that. I don't know, it could mean anything. It might mean "Don't eat bananas".

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Sun Jun 15, 2008 8:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So I have USB copyNES installed, and have created a simple ROM to playback an NSF (using Nullsleep's x816 nsf cart guide). 
<br />I need to make the rom I made a standard iNES rom, however, so I've got to add the header. Should I add assembly to create a header to my rom, build it, and then rename it to .NES?
<br />
<br />Edit: Also, to the author of the thread: Power Pak Lite with copyNES might not work for your live playback. After you copy your data to Power Pak Lite, you cannot turn off the NES or you lose your data. 
<br />It would still work if you flash the cart at your shows with a laptop, and then just leave the NES on. 
<br />
<br />The solution that I'm going to use is to develop a track select routine into Nullsleep's cartridge playback code and then just burn Eprom carts for live playback (burning eprom carts is no more complicated than installing copyNES). I want to avoid having a laptop at my shows at all costs (though there's certainly nothing wrong with having one, I have done it before).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Mon Jun 16, 2008 12:16 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sure, an iNES file is just the ROM binary with a header prepended. So unless your assembler can generate the header automatically you'll have to slap one on yourself.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Mon Jun 16, 2008 7:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks Mic - I am going to try that as a sanity check. 
<br />
<br />I am working on NESASM (w/ Nbasic) NSF playback code containing a track select routine.
<br /> I think this will be a simple ROM, but one that is totally essential for NES musicians. If we can do this it will have HUGE reverberations in nes music the world over. 
<br />We can't get new powerpaks right now, so we need a DIY solution!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Mon Jun 16, 2008 8:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />NESASM automatically generates the header for you.
<br />
<br />For example, these are the directives you'd use for a 40kB NROM:
<br />
<br /> .inesprg    2			
<br /> .ineschr    1			
<br /> .inesmir    1			
<br /> .inesmap   0

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NotTheCommonDose</b> [ Mon Jun 16, 2008 12:58 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nevermind. I had a thought but I forgot it sorry. Please disregard "Don't"

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Jun 16, 2008 1:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />And for another assembler, it might look like this:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.segment &quot;INESHDR&quot;<br />.byt 'N', 'E', 'S', 26&nbsp; ; header<br />.byt 2&nbsp; ; PRG size in 16384 byte units<br />.byt 1&nbsp; ; CHR size in 8192 byte units<br />.byt 0&nbsp; ; flags 6<br />.byt 0&nbsp; ; flags 7<br />.res 8&nbsp; ; pad to 16 bytes<br /><br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Mon Jun 16, 2008 2:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok, here's my first pass: it's a mashup of Nullsleep's cart code and Bob Rost's startup code, written for NESASM. I want to nail playing back a single track before adding the track select routine to the main loop.
<br />
<br />I'm new at NES programming. Really new. Sorry for suckness.
<br /> This compiles, but it doesn't play back or doanything in NESTOPIA. Any ideas of what I am doing wrong?
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Edited with Celius's changes:<br />*************<br /><br />.inesprg 1 ;//one PRG bank<br />&nbsp; &nbsp;.ineschr 1 ;//one CHR bank<br />&nbsp; &nbsp;.inesmir 0 ;//mirroring type 0<br />&nbsp; &nbsp;.inesmap 0 ;//memory mapper 0 &#40;none&#41;&nbsp; &nbsp;<br />&nbsp; &nbsp;.org $A93F ; replace dashes with load address MINUS $80<br />&nbsp; &nbsp;.bank 0&nbsp; &nbsp;<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;.incbin &quot;guitthing2.nsf&quot;<br />start:<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp;cld ;<br />&nbsp; &nbsp;sei ;//disable interrupts<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $2000 <br />&nbsp; &nbsp;sta $2001<br /><br />&nbsp; &nbsp;jsr vwait<br />&nbsp; &nbsp;jsr vwait<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;ldx #$00<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;Clear_Sound:<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; sta $4000,x &nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; inx<br />&nbsp; &nbsp;&nbsp; cpx #$0F<br />&nbsp; &nbsp; &nbsp; bne Clear_Sound<br /><br />&nbsp; &nbsp;lda #$10&nbsp; &nbsp;&nbsp; &nbsp;; load accumulator with $10<br />&nbsp; &nbsp;sta $4010&nbsp; &nbsp;; store accumulator in $4010<br />&nbsp; &nbsp;lda #$00&nbsp; &nbsp;&nbsp; &nbsp;; load accumulator with 0<br />&nbsp; &nbsp;sta $4011&nbsp; &nbsp;; clear these 3 registers that are <br />&nbsp; &nbsp;sta $4012&nbsp; &nbsp;; associated with the delta modulation<br />&nbsp; &nbsp;sta $4013&nbsp; &nbsp;; channel of the NES<br /><br />&nbsp; &nbsp;ldx #$ff<br />&nbsp; &nbsp;txs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;//reset the stack<br />&nbsp; &nbsp;lda #%00001111&nbsp; &nbsp;&nbsp; &nbsp;; enable all sound channels except<br />&nbsp; &nbsp;sta $4015&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;; the delta modulation channel&nbsp; &nbsp;&nbsp; &nbsp; <br />&nbsp; &nbsp;lda #$C0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ; synchronize the sound playback routine <br />&nbsp; &nbsp;sta $4017&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;; to the internal timing of the NES<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;lda #$01&nbsp; &nbsp;&nbsp; &nbsp;; replace dashes with song number<br />&nbsp; &nbsp;ldx #$00&nbsp; &nbsp;&nbsp; &nbsp;; replace with $00 for NTSC or $01 for PAL<br />&nbsp; &nbsp;jsr $B200&nbsp; &nbsp;&nbsp; &nbsp;; replace dashes with init address<br /><br />&nbsp; &nbsp; <br />&nbsp; &nbsp;lda #%10000000&nbsp; &nbsp;; enable vblank interrupts by setting the <br />&nbsp; &nbsp;sta $2000&nbsp; &nbsp;&nbsp; &nbsp;; most significant bit of $2000<br />&nbsp; &nbsp;<br /><br />mainloop:<br />&nbsp; &nbsp;jmp mainloop<br /><br />nmi:<br />&nbsp; &nbsp;&nbsp; &nbsp;lda $2002&nbsp; &nbsp;&nbsp; &nbsp;; read $2002 to reset the vblank flag<br />&nbsp; &nbsp;&nbsp; &nbsp;lda #%00000000&nbsp; &nbsp;; clear the first PPU control register&nbsp; <br />&nbsp; &nbsp;&nbsp; &nbsp;sta $2000&nbsp; &nbsp;&nbsp; &nbsp;; writing 0 to it<br />&nbsp; &nbsp;&nbsp; &nbsp;lda #%10000000&nbsp; &nbsp;; reenable vblank interrupts by setting<br />&nbsp; &nbsp;&nbsp; &nbsp;sta $2000&nbsp; &nbsp;&nbsp; &nbsp;; the most significant bit of $2000<br />&nbsp; &nbsp;&nbsp; &nbsp;jsr $B203&nbsp; &nbsp;&nbsp; &nbsp;; replace dashes with play address<br />&nbsp; &nbsp;&nbsp; &nbsp;rti&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ; return from interrupt routine<br />&nbsp; &nbsp;<br />irq:<br />&nbsp; &nbsp;rti<br />&nbsp; &nbsp;<br />vwait:<br />&nbsp; &nbsp;lda $2002<br />&nbsp; &nbsp; bpl vwait<br />&nbsp; &nbsp;rts<br /><br /><br /><br />;//jump table points to NMI, Reset, and IRQ start points<br />&nbsp; &nbsp;.bank 1<br />&nbsp; &nbsp;.org $fffa<br />&nbsp; &nbsp;.dw nmi, start, irq</div>
<br />
<br /><!-- m --><a class="postlink" href="http://rapidshare.com/files/122933198/guitthing2.nsf.html">http://rapidshare.com/files/122933198/g ... 2.nsf.html</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Mon Jun 16, 2008 3:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You do JMP vwait, and then RTI. Change JMP to JSR, and RTI to RTS. If you really care to know why, RTI is ReTurn from Interrupt, and when you do that, it won't do what you want since you're in the reset area of your code. JSR (Jump to SubRoutine) allows you to jump from one area of your code to another and you can just do RTS (ReTurn from Subroutine) to go back to where you jumped from with a simple instruction. JMP just goes from one area of your code to another without remembering where you jumped from.
<br />
<br />Edit:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">*************<br />&nbsp; ....<br /><br />&nbsp; &nbsp;jsr vwait<br />&nbsp; &nbsp;jsr vwait<br /><br />&nbsp;.....<br />vwait:<br />&nbsp; &nbsp;lda $2002<br />&nbsp; &nbsp; bpl vwait<br />&nbsp; &nbsp;rts<br />...<br /></div>
<br />
<br />That's what you should change, in case I was unclear about anything.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>yatagarasu</b> [ Mon Jun 16, 2008 8:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks Celius, that's great. 
<br />With your change, the generated rom is deffinitely busting through
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;ldx #$00 <br /><br />Clear_Sound:<br />&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;sta $4000,x&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp;inx<br />&nbsp; &nbsp; &nbsp;cpx #$0F<br />&nbsp; &nbsp; &nbsp; bne Clear_Sound </div>
<br />
<br />And beyond. 
<br />However, right now it just makes a single square beep. If I change that initial "ldx #$00" to "ldx #$01", it changes the duty of that single square beep. But that's all I can do with this code, hah, it's not playing back my nsf code for some reason. I successfully flashed it with copyNES and tried stepping through it with MICROBUG. I think I am not using the ".org" correctly, and that the assembler is missing the bulk of my NSF code. If I change the ".org" to $8000, it repeats the single square pulse infinitely!  
<br />
<br />I'm working on it constantly - but any more help would still rock and shock the casbah!
<br />
<br />Also, Obe, do you use Famitracker? It has an export to .PRG function. CopyNES (and some other programs) can easily turn a .PRG file into an NES file (removing some of the work described in this thread). The NES file can then be flashed onto copyNES. It only works for one song at a time, though. Yep - the regular Power Pak is so much easier. But me, I need to playback NSFs live now, I've got to get on the road in August!

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
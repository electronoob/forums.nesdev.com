<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Game project help and progress thread</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Homebrew Projects" href="http://forums.nesdev.com/feed.php?f=22" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Game project help and progress thread" href="http://forums.nesdev.com/feed.php?f=22&amp;t=12538" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '4');
	var per_page = '15';
	var base_url = './viewtopic.php?f=22&amp;t=12538';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 2:10 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=22">Homebrew Projects</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=22&amp;t=12538&amp;start=45">Game project help and progress thread</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=22"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=22&amp;t=12538"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>4</strong> of <strong>8</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 106 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=22&amp;t=12538&amp;start=30">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=22&amp;t=12538">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=30">3</a><span class="page-sep">, </span><strong>4</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=105">8</a> &nbsp;<a href="./viewtopic.php?f=22&amp;t=12538&amp;start=60">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=22&amp;t=12538&amp;start=45&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=22&amp;t=12538&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=22&amp;t=12538&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p144909"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p144909">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=144909#p144909"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 10, 2015 11:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">What would be a good way of decompressing this? I probably need to have some kind of pointers in RAM that keeps track of things like current stage, current screen, etc. so the game knows where to look for the metatiles.</div><br />I'd do it on the fly... breaking down the coordinates (as I'll explain below) you can tell which screen to load from the level map. Then, using another part of the coordinate, you can tell which column of metatiles in that screen you have to read from. Then you can use the final part of the coordinate to know how many pixels into the metatile that coordinate is, and you can use this information for collision tests and such.<br /><br />Accessing a level, be it for scrolling/rendering or for collision detection, is about using coordinates and interpreting the &quot;fields&quot; in those coordinates in order to know where to read your data from. You don't need specific variables for &quot;current screen&quot; and such, that information can be deduced from the coordinates you're using to access the map.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I will probably update VRAM (when scrolling) so that I update  2 metatiles every frame the VRAM needs to be updated. So, it takes 4 frames to update one vertical row of metatiles. The player movement speed is around the same speed than what castlevania has, so I guess the updating speed is not too slow.</div><br />If it takes you 4 frame to update a 32-pixel wide column, that's equivalent to 8 pixels per frame, which should be enough for most games. Even Sonic, without speed shoes, runs slower than 8 pixels per frame, so you should be safe. Just be sure to have an area with valid graphics wider than the screen, so you don't scroll into incomplete columns. For example, here's a 2-screen section of the map, with the camera hovering over it:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CAMERA/SCREEN<br />&nbsp; &nbsp; &nbsp; &nbsp; |-------------------------------|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</div><br />The metatiles marked &quot;V&quot; are visible, and once the screen starts scrolling, left or right, the metatiles marked &quot;P&quot; would become partially visible, so they should be properly loaded before that happens. And when it does happen, the metatiles marked &quot;U&quot; should start being updated, so that they're ready when the camera reaches it.<br /><br />One good way to go about this would be to update two metatiles every time the camera crosses an 8-pixel boundary (look for changes in bit 3 of the camera's coordinate - whenever it changes from 1 to 0, or vice-versa, an 8-pixel boundary was crossed), that way you wouldn't occupy the majority of you VRAM bandwidth with metatiles for 4 consecutive frames (unless the player was running at 8 pixels per frame), giving other updates more opportunities to run (such as pattern table updates, if you ever do that).<br /><br />I'd use the camera position not only to decide WHEN to load new metatiles, but also to find out WHICH metatiles to update. If you break down the camera position, the bits have the following meanings:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SSSSSSSS MMMPPPPP<br />SSSSSSSS: Index of the screen within the stage;<br />MMM: Index of the column of metatiles within the screen;<br />PPPPP: Index of the column of pixels within the metatile;</div><br />Like I said before, you can detect changes in bit 3 to know when to draw a new pair of metatiles. Now consider that the camera is moving right, and this value is increasing: Since metatiles are 32 pixels wide, the camera will go through 4 8-pixel boundaries before crossing a metatile boundary. This means you can consider bits 3 and 4 of the camera's coordinate as the index of the pair of metatiles to update. For example:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda CameraX+0 ;compare the current position...<br />&nbsp; &nbsp;eor OldCameraX+0 ;...against the old position<br />&nbsp; &nbsp;and #%00001000 ;keep only the bit of interest<br />&nbsp; &nbsp;beq NoMetatileUpdate ;skip if it didn't change<br />&nbsp; &nbsp;lda CameraX+0 ;get the position again<br />&nbsp; &nbsp;and #%00011000 ;find out how close the camera is to the next metatile boundary<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;;OMITTED: USE THIS VALUE TO KNOW WHICH OF THE 4 PAIRS OF METATILES IN A COLUMN TO UPDATE;<br />&nbsp; &nbsp;;OMITTED: DECODE THE METATILES AND FILL THE UPDATE BUFFER;<br />NoMetatileUpdate:</div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">For now I can probably pretty safely say that I can allocate $0700 - $07FF for map RAM (overkill?). I'm assuming that I need to decompress the data to the map RAM and then push it to the &quot;buffer stack&quot;.</div><br />Unless you want to compress screens or stages even further in the ROM using something like RLE, I don't think you need any RAM at all for maps. This format is friendly enough to be read straight from the ROM.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p144917"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p144917">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=144917#p144917"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 10, 2015 12:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just noticed something in your proposed level format:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.db Metatile00</div><br />You can't do it exactly like this because Metatile00 is not a byte, but a 16-bit address.<br /><br />You could use .dw instead, but if you have 256 metatiles or less that would be a waste of space. So one possible solution is to use a list of metatile addresses that you can look up using their indices:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">MetatileAddressLo:<br />&nbsp; &nbsp;.db &lt;Metatile00, &lt;Metatile01, (...)<br /><br />MetatileAddressHi:<br />&nbsp; &nbsp;.db &gt;Metatile00, &gt;Metatile01, (...)</div><br />Then you could read the top right tile of metatile 25 like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;ldy #25<br />&nbsp; &nbsp;lda MetatileAddressLo, y<br />&nbsp; &nbsp;sta Pointer+0<br />&nbsp; &nbsp;lda MetatileAddressHi, y<br />&nbsp; &nbsp;sta Pointer+1<br />&nbsp; &nbsp;ldy #03 ;the top right tile is the 4th byte in the metatile data<br />&nbsp; &nbsp;lda (Pointer), y</div><br />Another option is to make sure that the size of the data is always a power of 2 (i.e. each screen is always 64 bytes/metatiles) and properly aligned in memory, so that you can quickly calculate the address based on the index, without needing a table:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta Pointer+0<br />&nbsp; &nbsp;lda #17 ;screen 17<br />&nbsp; &nbsp;lsr ;multiply by 64<br />&nbsp; &nbsp;rol Pointer+0<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;rol Pointer+0<br />&nbsp; &nbsp;adc #&gt;Screen00 ;add the base address<br />&nbsp; &nbsp;sta Pointer+1</div><br />Making sure that the size of the data is a power of 2 might not be easy in the case of metatiles, since you plan to add collision and palette info to the 16 bytes you already have. Padding that to 32 bytes would be a monumental waste of space, so you might want to go with the table approach, at lest for the metatiles, and go with the calculated address for screens.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145018"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145018">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145018#p145018"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Apr 11, 2015 8:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hey, I was just checking a few Capcom games (Mega Man, Duck Tales and The Little Mermaid, specifically) and they all use 32x32-pixel metatiles, like you're planning to, and they appear to update the background similarly to how we were discussing. Take a look at these games in FCEUX's name table viewer for some inspiration.<br /><br />These games update only 1 metatile each frame, but every 4 scrolled pixels, not 8, so the final result is the same (with the disadvantage that the maximum scroll speed is reduced to 4 pixels per frame - but none of these games are particularly fast anyway). If you divide 32 (the width of a metatile) by 4 (the distance between boundaries that trigger updates), the result is 8, meaning that there will be 8 updates in the space of 32 scrolled pixels, and there are 8 metatiles per column, so there's a direct relationship between which of the 8 4-pixel boundaries is crossed and which of the 8 metatiles of a column is updated, like I suggested. This is evidenced by columns being drawn from top to bottom when scrolling right, and bottom to top when scrolling left.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145030"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145030">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145030#p145030"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 12, 2015 3:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Right now I'm trying to get the game to load the background for the first stage's first screen. I was thinking loading the data to the buffer 120 bytes (one vertical metatile row per frame) at a time (of course when the screen is faded to black) and then load the attributes (+64 bytes) at the end, which means that the update takes 9 frames, which doesn't seem like too long time for a transition. Or should I disable rendering and load the whole background as fast as possible? Which one do you think would be easier (speed doesn't really matter here as long as it doesn't take too long, since there are still other stuff that needs to be set up during the same transition)? I still want the subroutine to be usable elsewhere. Not just for the one update.<br /><br />Here is the way I have packed the data (the thing you noted earlier should be fixed now):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Stg1Screen1Lo:<br />&nbsp;.db LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F)<br />&nbsp;.db LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F)<br />&nbsp;.db LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F)<br />&nbsp;.db LOW(MT0F),LOW(MT0A),LOW(MT0D),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F),LOW(MT0F)<br />&nbsp;.db LOW(MT0F),LOW(MT08),LOW(MT0C),LOW(MT0F),LOW(MT13),LOW(MT11),LOW(MT0F),LOW(MT12)<br />&nbsp;.db LOW(MT13),LOW(MT07),LOW(MT10),LOW(MT05),LOW(MT04),LOW(MT04),LOW(MT04),LOW(MT04)<br />&nbsp;.db LOW(MT04),LOW(MT04),LOW(MT04),LOW(MT06),LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00)<br />&nbsp;.db LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00),LOW(MT00)<br /><br />Stg1Screen1Hi:<br />&nbsp;.db HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F)<br />&nbsp;.db HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F)<br />&nbsp;.db HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F)<br />&nbsp;.db HIGH(MT0F),HIGH(MT0A),HIGH(MT0D),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F),HIGH(MT0F)<br />&nbsp;.db HIGH(MT0F),HIGH(MT08),HIGH(MT0C),HIGH(MT0F),HIGH(MT13),HIGH(MT11),HIGH(MT0F),HIGH(MT12)<br />&nbsp;.db HIGH(MT13),HIGH(MT07),HIGH(MT10),HIGH(MT05),HIGH(MT04),HIGH(MT04),HIGH(MT04),HIGH(MT04)<br />&nbsp;.db HIGH(MT04),HIGH(MT04),HIGH(MT04),HIGH(MT06),HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00)<br />&nbsp;.db HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00),HIGH(MT00)</div><br /><br />The metatiles are as an attachment to save space:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=3035">MetatileData.asm</a> [2.34 KiB]
			</span><br />
			<span class="gensmall">Downloaded 67 times</span>
		

		<br />
	</div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145044"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145044">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145044#p145044"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Apr 12, 2015 8:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">So you decided to go with pointers instead of indexing? That's fine, it's simpler to decode, just keep in mind that this will consume more ROM, so pay attention to how much space you can spare for maps.<br /><br />I think it's a waste to write code to decode the first screen. Since you'll have to write the code that renders columns for the purpose of scrolling, you can simply write a loop that calls this very same code, in order to draw all the columns of the first screen.<br /><br />By now you know that I'm strongly against redundancy, and having 2 different routines to render the map would be very redundant, wasting ROM and making the code more difficult to maintain (e.g. if you change anything about how the level is encoded, you'll have to modify 2 routines instead of 1).<br /><br />I think you should focus on rendering columns right from the start, even if you haven't implemented any scrolling yet. Make this simple, just give the routine the position of the column to render, and have the routine use that to read data from the map and fill the BG uldate buffers with the data.<br /><br />Then you can use this routine for both purposes: when drawing the first screen, increment the column position in a loop until the whole screen is done. When scrolling, calculate the position of the column based on the position of the camera and direction of the movement.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145248"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145248">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145248#p145248"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Apr 13, 2015 10:43 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Next thing I should know is that how do I make the update routine to recognize that the background is updated far enough (updated until 'U' area is reached). In the case of updating first screen and in case the updating leaves behind for some reason. If I only use camera's position, the routine probably only updates the 'U' column without checking that the columns before it are updated correctly.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CAMERA/SCREEN<br />&nbsp; &nbsp; &nbsp; &nbsp; |-------------------------------|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br />| U | P | V | V | V | V | V | V | V | V | P | U |&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|&nbsp; &nbsp;|<br />+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+<br /></div><br /><br />I probably need to feed the metatile to the buffer in four parts of four individual tile rows.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;; This is just a example I came up with. I don't know if this actually works.<br /><br />&nbsp;LDY #$04<br />Loop:<br />&nbsp;LDX bg_update_requests<br />&nbsp;INX<br />&nbsp;LDA #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 4 tiles to update<br />&nbsp;STA bg_update_count-1, x<br />&nbsp;LDA pre_calculated_address_lo, y&nbsp; &nbsp; &nbsp; ; pre-calculated from camera position<br />&nbsp;STA bg_update_address_lo-1, x<br />&nbsp;LDA pre_calculated_address_hi, y&nbsp; &nbsp; &nbsp; ; pre-calculated from camera position<br />&nbsp;STA bg_update_address_hi-1, x<br />&nbsp;STX<br /><br />&nbsp;; push four individual tiles to the stack<br /><br />&nbsp;DEY<br />&nbsp;BNE Loop<br /></div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145271"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145271">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145271#p145271"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Apr 14, 2015 6:50 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">Next thing I should know is that how do I make the update routine to recognize that the background is updated far enough (updated until 'U' area is reached). In the case of updating first screen and in case the updating leaves behind for some reason. If I only use camera's position, the routine probably only updates the 'U' column without checking that the columns before it are updated correctly.</div><br />For the first screen you can just use a loop. Start from CameraX - 32 and go all the way up to CameraX + 255 + 32, incrementing 8 and updating 2 metatiles each step. When scrolling, check if the camera moved left or right (CameraX - OldCameraX &lt; 0 = left, CameraX - OldCameraX &gt; 0 = right), and calculate ColumnX based on that: If left, ColumnX = CameraX - 32, if right, ColumnX = CameraX + 255 + 32.<br /><br />In the function that decodes columns, you should check whether ColumnX is out of bounds (if ColumnX &gt;= LevelLength, the column is outside the level - remember that -1 is $FFFF, which would also be considered larger in an unsigned comparison), in which case you can simply return and not do anything.<br /><br />If you do have to draw metatiles, you have to decode the individual bits of ColumnX to know what to render and where. Here's a breakdown of what the individual bits of ColumnX mean:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SSSSSSSS CCCPPPPP<br />SSSSSSSS: screen within the level;<br />CCC: column of metatiles within the screen;<br />PPPPP: column of pixels within the metatile;</div><br />With this information you can do everything you need, like calculating the destination address for the tiles in VRAM, or locating the correct pointers necessary to decode the compressed data from PRG-ROM. For example, to know the name table where the metatiles must be written to, you can look at the lowest bit of SSSSSSSS (since name tables are 256 pixels wide, just like level screens).<br /><br />You have to decide whether you're going to update 8 metatiles every 32 scrolled pixels (at the rate of 2 per frame) or 2 metatiles every 8 scrolled pixels. I'd go with the latter, so as to not hog VRAM bandwidth for 4 consecutive frames. It's not such a big difference, but it will affect how you use the bits of ColumnX to calculate the source and destination addresses for the metatiles.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDY #$04<br />Loop:<br />&nbsp;LDX bg_update_requests<br />&nbsp;INX<br />&nbsp;LDA #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; 4 tiles to update<br />&nbsp;STA bg_update_count-1, x<br />&nbsp;LDA pre_calculated_address_lo, y&nbsp; &nbsp; &nbsp; ; pre-calculated from camera position<br />&nbsp;STA bg_update_address_lo-1, x<br />&nbsp;LDA pre_calculated_address_hi, y&nbsp; &nbsp; &nbsp; ; pre-calculated from camera position<br />&nbsp;STA bg_update_address_hi-1, x<br />&nbsp;STX<br /><br />&nbsp;; push four individual tiles to the stack<br /><br />&nbsp;DEY<br />&nbsp;BNE Loop</div></div><br />Yeah, pushing the tiles to the buffer could be something like this. You probably won't have the luxury of using Y like this though, since it will most likely be necessary for reading the tile indices from the metatile definitions. So I'd probably calculate the address of the first row of 4 tiles, and add 32 to it each iteration of this loop before pushing it to the update list.<br /><br />I'd probably do the whole scrolling process like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">- skip to the end if no 8-pixel boundary was crossed;<br />- calculate column position from camera position based on the direction of the movement;<br />(steps below could be a subroutine, so you can use the same code for the first screen and for scrolling)<br />- skip to the end if the column is out of bounds;<br />- calculate the first name table address based the column position;<br />- calculate the first attribute table address based the column position;<br />- use the column position to read a screen from the map;<br />- repeat the following twice:<br />&nbsp; - use the column position and iteration count to read a metatile from the screen;<br />&nbsp; - push AT update to update list;<br />&nbsp; - repeat the following 4 times:<br />&nbsp; &nbsp; - push new update to update list;<br />&nbsp; &nbsp;- read 4 tiles from the metatile and push to buffer;<br />&nbsp; &nbsp;- move one tile down (increment NT address by 32);<br />&nbsp; - move one metatile down (increment AT address by 8);</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145449"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145449">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145449#p145449"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 16, 2015 2:30 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I made the scrolling update code until the point the buffer needs to be filled. Does this look alright so far?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDA scroll_x<br />&nbsp;EOR scroll_x_prev<br />&nbsp;AND #%00000100<br />&nbsp;BEQ NoMetatileUpdate<br />&nbsp;LDA scroll_x<br />&nbsp;AND #%00011100<br />&nbsp;STA column_inc<br />&nbsp;LSR<br />&nbsp;LSR<br />&nbsp;LSR<br />&nbsp;STA row_inc<br />&nbsp;LDA screen<br />&nbsp;AND #%00000001<br />&nbsp;BNE SecondNT<br /><br />FirstNT:<br />&nbsp;LDA #$00<br />&nbsp;STA ppu_addr_lo<br />&nbsp;LDA #$20<br />&nbsp;STA ppu_addr_hi<br />JMP CheckScrollDir<br /><br />SecondNT:<br />&nbsp;LDA #$00<br />&nbsp;STA ppu_addr_lo<br />&nbsp;LDA #$24<br />&nbsp;STA ppu_addr_hi<br /><br />CheckScrollDir:<br />&nbsp;LDA scroll_x<br />&nbsp;CMP scroll_x_prev<br />&nbsp;BCC ScrollingLeft<br /><br />ScrollingRight:<br />&nbsp;LDA ppu_addr_lo<br />&nbsp;CLC<br />&nbsp;ADC column_inc<br />&nbsp;BCS ScrollCarry<br />&nbsp;JMP FillBuffer<br /><br />ScrollingLeft:<br />&nbsp;LDA ppu_addr_lo<br />&nbsp;SEC<br />&nbsp;SBC column_inc<br />&nbsp;BCC ScrollCarry<br />&nbsp;JMP FillBuffer<br /><br />ScrollCarry:<br />&nbsp;LDA ppu_addr_hi<br />&nbsp;ADC #$04<br />&nbsp;STA ppu_addr_hi<br /><br />FillBuffer:<br /><br />( ... )<br /><br />NoMetatileUpdate:<br /></div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145455"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145455">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145455#p145455"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 16, 2015 5:27 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDA scroll_x<br />&nbsp;EOR scroll_x_prev<br />&nbsp;AND #%00000100<br />&nbsp;BEQ NoMetatileUpdate</div></div><br />So you decided to update 1 metatile every 4 scrolled pixels? That's probably simpler, but you can't scroll more than 4 pixels per frame or you might miss some metatiles.<br /><br />I'm in a bit of a hurry now so I haven't been able to debug the rest of the code in my head, but I did see one thing that doesn't make sense: scroll_x is an 8-bit variable, and you can't possibly make all the decisions you need with that.<br /><br />An 8-bit value can only track the pixel position within the screen, so you can't possibly select a name table based on that. You also can't detect the direction of the movement using 8-bit coordinates, because when it wraps from 255 to 0 you'll missinterpret that as a movement to the left.<br /><br />The PPU may treat the scroll as an 8 bit value (or 9, if you count the NT bits in $2000, which you should), but your levels are larger than that, so you absolutely need to keep track of the scroll/camera. Even if you only write 9 bits worth of scroll info to the PPU, the rest is necessary for detecting the direction of the movement and to locate the correct metatiles to draw, since they come from the level and the level is larger than 2 screens.<br /><br />Another important thing is that the camera/scroll position represents the top left corner of the screen, and when calculating addresses of updates at the right side I don't see you compensating for the width of the screen. When scrolling to the right, updates must be offset from the right edge of the camera, so you have to add 255 to the camera's position in order to find that edge, and then you add a few columns to find the actual update position. As an optimization, you can merge the 2 additions into 1, but it's important that you understand what is hapenning underneath.<br /><br />There are quite a lot of things you have to do before you can fill the buffer. You are calculating the output addresses, but you haven't located any of the source addresses.<br /><br />I might be able to write some example code later if you think that's going to help.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145463"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145463">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145463#p145463"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 16, 2015 6:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">An 8-bit value can only track the pixel position within the screen, so you can't possibly select a name table based on that. You also can't detect the direction of the movement using 8-bit coordinates, because when it wraps from 255 to 0 you'll missinterpret that as a movement to the left.</div><br /><br />I'm using the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">screen</tt> variable for that. AND-ing off all other bits than the bit 0 should let me see which nametable I'm on at the moment (to know which nametables' start address to use ($2000 or $2400)).<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">I might be able to write some example code later if you think that's going to help.</div><br /><br />I'm sure that'll help. You probably don't need to make example code out of the whole process, just the stuff that I may have forgotten or done incorrectly.</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145475"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145475">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145475#p145475"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 16, 2015 9:58 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">You probably don't need to make example code out of the whole process</div><br />Oops, too late! Long ass post ahead! I started coding the important parts but ended up doing the whole thing because I wanted to see it everything fit together. It's all untested though, so follow with caution. You don't have to follow everything I did step by step, this is just an example of how I'd do things considering the compression format you've chosen. You might want to do things differently in some places, but it's important that you understand what's going on. I also separated the actual metatile decoding to its own subroutine, so it can be used for rendering the initial screen too.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;;decide whether to render a metatile<br />&nbsp; &nbsp;lda OldCameraX+0<br />&nbsp; &nbsp;eor CameraX+0<br />&nbsp; &nbsp;and #%00000100<br />&nbsp; &nbsp;beq Done<br /><br />&nbsp; &nbsp;;detect the direction of the movement<br />&nbsp; &nbsp;lda OldCameraX+0<br />&nbsp; &nbsp;cmp CameraX+0<br />&nbsp; &nbsp;lda OldCameraX+1<br />&nbsp; &nbsp;sbc CameraX+1<br />&nbsp; &nbsp;bcc MovedRight<br /><br />MovedLeft:<br /><br />&nbsp; &nbsp;;calculate the position of the column to the left of the camera<br />&nbsp; &nbsp;;sec (omitted because the carry is always set by this point)<br />&nbsp; &nbsp;lda CameraX+0 ;subtract 32 ($0020)<br />&nbsp; &nbsp;sbc #$20<br />&nbsp; &nbsp;sta ColumnX+0<br />&nbsp; &nbsp;lda CameraX+1<br />&nbsp; &nbsp;sbc #$00<br />&nbsp; &nbsp;sta ColumnX+1<br />&nbsp; &nbsp;jmp ColumnReady<br /><br />MovedRight:<br /><br />&nbsp; &nbsp;;calculate the position of the column to the right of the camera<br />&nbsp; &nbsp;;clc (omitted because the carry is always clear by this point)<br />&nbsp; &nbsp;lda CameraX+0 ;add 255 + 32 = 287 ($011F)<br />&nbsp; &nbsp;adc #$1F<br />&nbsp; &nbsp;sta ColumnX+0<br />&nbsp; &nbsp;lda CameraX+1<br />&nbsp; &nbsp;adc #$01<br />&nbsp; &nbsp;sta ColumnX+1<br /><br />ColumnReady:<br /><br />&nbsp; &nbsp;;go decode the metatile<br />&nbsp; &nbsp;jsr DecodeMetatile<br /><br />Done:</div><br />And here's the subroutine:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">DecodeMetatile:<br /><br />&nbsp; &nbsp;;return if the column is out of bounds<br />&nbsp; &nbsp;lda ColumnX+1<br />&nbsp; &nbsp;cmp LevelLength<br />&nbsp; &nbsp;bcc Continue<br />&nbsp; &nbsp;rts<br /><br />Continue:<br /><br />&nbsp; &nbsp;;use the screen index to set up a pointer to the screen we'll read from<br />&nbsp; &nbsp;asl<br />&nbsp; &nbsp;tay<br />&nbsp; &nbsp;lda (LevelPointer), y<br />&nbsp; &nbsp;sta ScreenPointer+0<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;lda (LevelPointer), y<br />&nbsp; &nbsp;sta ScreenPointer+1<br /><br />&nbsp; &nbsp;;set up the indices needed to access pre-calculated values<br />&nbsp; &nbsp;lda ColumnX+0<br />&nbsp; &nbsp;and #%11111100<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;tay ;index for tables of words<br />&nbsp; &nbsp;lsr<br />&nbsp; &nbsp;tax ;index for tables of bytes<br /><br />&nbsp; &nbsp;;prepare the bit that will be used for name table selection<br />&nbsp; &nbsp;lda ColumnX+1<br />&nbsp; &nbsp;and #%00000001 ;keep only the bit that selects 1 of the 2 name tables<br />&nbsp; &nbsp;asl<br />&nbsp; &nbsp;asl<br />&nbsp; &nbsp;sta Temp<br /><br />&nbsp; &nbsp;;prepare the name table address<br />&nbsp; &nbsp;lda NameTableAddresses+0, y<br />&nbsp; &nbsp;sta NameTableAddress+0<br />&nbsp; &nbsp;lda NameTableAddresses+1, y<br />&nbsp; &nbsp;ora Temp<br />&nbsp; &nbsp;sta NameTableAddress+1<br /><br />&nbsp; &nbsp;;prepare the attribute table address<br />&nbsp; &nbsp;lda AttributeTableAddresses, x<br />&nbsp; &nbsp;sta AttributeTableAddress+0<br />&nbsp; &nbsp;lda #%00100011<br />&nbsp; &nbsp;ora Temp<br />&nbsp; &nbsp;sta AttributeTableAddress+1<br /><br />&nbsp; &nbsp;;get the index of the metatile within the screen<br />&nbsp; &nbsp;ldy MetatileIndices, x<br /><br />&nbsp; &nbsp;;set up a pointer to the metatile<br />&nbsp; &nbsp;lda (ScreenPointer), y<br />&nbsp; &nbsp;sta MetatilePointer+0<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;lda (ScreenPointer), y<br />&nbsp; &nbsp;sta MetatilePointer+1<br /><br />&nbsp; &nbsp;;OMITTED: SWITCH TO BUFFER STACK;<br /><br />&nbsp; &nbsp;;OMITTED: SET UP VRAM UPDATE USING THE ATTRIBUTE TABLE ADDRESS;<br /><br />&nbsp; &nbsp;;put the attribute byte in the buffer<br />&nbsp; &nbsp;ldy #ATTRIBUTE_OFFSET<br />&nbsp; &nbsp;lda (MetatilePointer), y<br />&nbsp; &nbsp;pha<br /><br />&nbsp; &nbsp;;prepare to read the first tile of the metatile<br />&nbsp; &nbsp;ldy #$00<br /><br />BufferRow:<br /><br />&nbsp; &nbsp;;OMITTED: SET UP VRAM UPDATE USING THE NAME TABLE ADDRESS;<br /><br />&nbsp; &nbsp;;put 4 tiles in the buffer<br />&nbsp; &nbsp;lda (MetatilePointer), y<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;lda (MetatilePointer), y<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;lda (MetatilePointer), y<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;lda (MetatilePointer), y<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;iny<br /><br />&nbsp; &nbsp;;check if all 16 tiles have already been processed<br />&nbsp; &nbsp;cpy #$10<br />&nbsp; &nbsp;beq Done<br /><br />&nbsp; &nbsp;;move the output position one row down<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;lda NameTableAddress+0<br />&nbsp; &nbsp;adc #$20<br />&nbsp; &nbsp;sta NameTableAddress+0<br />&nbsp; &nbsp;lda NameTableAddress+1<br />&nbsp; &nbsp;adc #$00<br />&nbsp; &nbsp;sta NameTableAddress+1<br /><br />&nbsp; &nbsp;;process another row if we didn't invade the attribute tables (happens with the last metatile)<br />&nbsp; &nbsp;lda NameTableAddress+0<br />&nbsp; &nbsp;and #%11000000<br />&nbsp; &nbsp;cmp #%11000000<br />&nbsp; &nbsp;bne BufferRow<br />&nbsp; &nbsp;lda NameTableAddress+1<br />&nbsp; &nbsp;and #%00000011<br />&nbsp; &nbsp;cmp #%00000011<br />&nbsp; &nbsp;bne BufferRow<br /><br />Done:<br /><br />&nbsp; &nbsp;;OMITTED: SWITCH TO THE NORMAL STACK;<br /><br />&nbsp; &nbsp;;return<br />&nbsp; &nbsp;rts</div><br />Note that this is reading pointers stored as words, not split into bytes like you originally intended. This means you can define levels like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Level0:<br />&nbsp; &nbsp;.dw Screen00, Screen01, Screen00, Screen03, Screen03, Screen01</div><br />And screens like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Screen00:<br />&nbsp; &nbsp;.dw Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00<br />&nbsp; &nbsp;.dw Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00<br />&nbsp; &nbsp;.dw Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00<br />&nbsp; &nbsp;.dw Metatile00, Metatile00, Metatile00, Metatile00, Metatile03, Metatile03, Metatile00, Metatile03<br />&nbsp; &nbsp;.dw Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00, Metatile00<br />&nbsp; &nbsp;.dw Metatile03, Metatile03, Metatile03, Metatile00, Metatile03, Metatile03, Metatile03, Metatile03<br />&nbsp; &nbsp;.dw Metatile02, Metatile02, Metatile02, Metatile00, Metatile02, Metatile02, Metatile02, Metatile02<br />&nbsp; &nbsp;.dw Metatile02, Metatile02, Metatile02, Metatile00, Metatile02, Metatile02, Metatile02, Metatile02</div><br />Which is much easier to write by hand than splitting the high and low bytes of each pointer. You'd probably go crazy trying to design levels the split way!<br /><br />Also, I owe you some explanations about how the addresses are set up, since I used tables to solve this part. First I'm gonna tell you how we're finding the position of the metatile that will be updated, and then how all the addresses and indices are calculated from that position.<br /><br />There are only 8 columns of metatiles per screen, but since updating all 8 metatiles of a column would take much more time than available during VBlank, we'll only update 1 metatile at a time. This means we need 8 updates to complete a column, and since each column is 32 pixels wide, we'll have to update one metatile every 32 / 8 = 4 pixels.<br /><br />We could use a separate counter to keep track of how many metatiles we've already updated, but we already have this info implied in the column coordinate. You can think of the bits in the column coordinate like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SSSSSSSS MMM444PP<br />SSSSSSSS: index of the screen within the level (0 to 255);<br />MMM: index of the metatile column (0 to 7);<br />444: index of the 4-pixel column within the metatile column (0 to 7);<br />PP: index of the pixel column within the 4-pixel column (0 to 3);</div><br />OK, so we already know the column where the metatile we'll be processing is, but we still need to figure out its row. We have absolutely no use for the pixel index, but the 4-pixel column index can be REPURPOSED as the row of the metatile, since it will count from 0 to 7 during the course of one metatile column, which is exactly what we need. We'll be using this to count rows instead of a separate variable, so we'll treat the coordinate like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SSSSSSSS CCCRRR**<br />SSSSSSSS: index of the screen within the level (0 to 255);<br />CCC: column of the metatile within the screen;<br />RRR: row of the metatile within the screen;<br />**: not used;</div><br />Since we now know the column and the row of the metatile being processed, we can use that information to generate all the pointers and indices necessary to access it, we just need to move the bits around. This could be done with bit shifting and bitwise operations, but that could be slow and difficult to understand. To avoid that, I decided to use tables. To index these tables I used the position of the metatile exactly like it's arranged in the low byte of the column index, but shifted according to the size of the entries of each table (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">0CCCRRR0</tt> for words, <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">00CCCRRR</tt> for bytes).<br /><br />To read from the screens, you have to think of the format in which they're stored: a grid of 8x8 words. This means that indices to read screens are in the following format:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0RRRCCC0</div><br />The formula used to find this format is <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">&#40;y * 8 + x&#41; * 2</tt>. This is the good old formula used to convert 2D to 1D, and the multiplication by 2 is there because each entry is 2 bytes (a pointer). So there's one table (MetatileIndices) that converts <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">00CCCRRR</tt> into <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">0RRRCCC0</tt>.<br /><br />Another thing we need to find out is the target address for the metatile in the name tables. Name table addresses are in the following format (this was defined by Nintendo):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0010YXYY YYYXXXXX</div><br />This is a bit more complicated because we have a base address (name tables start at $2000, not $0000), and because the top X and Y bits are separated from the rest and given more relevance, for name table selection. We can ignore that when creating the tables (to keep their size down) and assume that all addresses are in the first name table ($2000), and change the name table bit after reading the address from the table. Anyway, the conversion goes like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0CCCRRR0 (index)<br />001000RR R00CCC00 (NT address)</div><br />The last table we need converts the index into an attribute table address. AT addresses are in the folowing format (again, defined by Nintendo):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0010YX11 11YYYXXX</div><br />Which means that the conversion goes like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0CCCRRR0 (index)<br />00100011 11RRRCCC (AT address)</div><br />Like I said before, you could do these conversions in real time instead of using tables, but I wanted to keep the routine fast, and didn't want to confuse you with all the bit shifting. But you can decide to go that route if you don't want to waste space with these tables. The important thing is that the bits end up where they have to be.<br /><br />I'll give you all the tables, but there might be errors since I wrote them manually instead of writing a script to generate them. Each table has 64 entries, but one uses words while the other 2 use bytes, for a total of 256 btes worth of tables.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">NameTableAddresses:<br /><br />&nbsp; &nbsp;.dw %0010000000000000, %0010000010000000, %0010000100000000, %0010000110000000, %0010001000000000, %0010001010000000, %0010001100000000, %0010001110000000<br />&nbsp; &nbsp;.dw %0010000000000100, %0010000010000100, %0010000100000100, %0010000110000100, %0010001000000100, %0010001010000100, %0010001100000100, %0010001110000100<br />&nbsp; &nbsp;.dw %0010000000001000, %0010000010001000, %0010000100001000, %0010000110001000, %0010001000001000, %0010001010001000, %0010001100001000, %0010001110001000<br />&nbsp; &nbsp;.dw %0010000000001100, %0010000010001100, %0010000100001100, %0010000110001100, %0010001000001100, %0010001010001100, %0010001100001100, %0010001110001100<br />&nbsp; &nbsp;.dw %0010000000010000, %0010000010010000, %0010000100010000, %0010000110010000, %0010001000010000, %0010001010010000, %0010001100010000, %0010001110010000<br />&nbsp; &nbsp;.dw %0010000000010100, %0010000010010100, %0010000100010100, %0010000110010100, %0010001000010100, %0010001010010100, %0010001100010100, %0010001110010100<br />&nbsp; &nbsp;.dw %0010000000011000, %0010000010011000, %0010000100011000, %0010000110011000, %0010001000011000, %0010001010011000, %0010001100011000, %0010001110011000<br />&nbsp; &nbsp;.dw %0010000000011100, %0010000010011100, %0010000100011100, %0010000110011100, %0010001000011100, %0010001010011100, %0010001100011100, %0010001110011100<br /><br />AttributeTableAddresses:<br /><br />&nbsp; &nbsp;.db %11000000, %11001000, %11010000, %11011000, %11100000, %11101000, %11110000, %11111000<br />&nbsp; &nbsp;.db %11000001, %11001001, %11010001, %11011001, %11100001, %11101001, %11110001, %11111001<br />&nbsp; &nbsp;.db %11000010, %11001010, %11010010, %11011010, %11100010, %11101010, %11110010, %11111010<br />&nbsp; &nbsp;.db %11000011, %11001011, %11010011, %11011011, %11100011, %11101011, %11110011, %11111011<br />&nbsp; &nbsp;.db %11000100, %11001100, %11010100, %11011100, %11100100, %11101100, %11110100, %11111100<br />&nbsp; &nbsp;.db %11000101, %11001101, %11010101, %11011101, %11100101, %11101101, %11110101, %11111101<br />&nbsp; &nbsp;.db %11000110, %11001110, %11010110, %11011110, %11100110, %11101110, %11110110, %11111110<br />&nbsp; &nbsp;.db %11000111, %11001111, %11010111, %11011111, %11100111, %11101111, %11110111, %11111111<br /><br />MetatileIndices:<br /><br />&nbsp; &nbsp;.db %00000000, %00010000, %00100000, %00110000, %01000000, %01010000, %01100000, %01110000<br />&nbsp; &nbsp;.db %00000010, %00010010, %00100010, %00110010, %01000010, %01010010, %01100010, %01110010<br />&nbsp; &nbsp;.db %00000100, %00010100, %00100100, %00110100, %01000100, %01010100, %01100100, %01110100<br />&nbsp; &nbsp;.db %00000110, %00010110, %00100110, %00110110, %01000110, %01010110, %01100110, %01110110<br />&nbsp; &nbsp;.db %00001000, %00011000, %00101000, %00111000, %01001000, %01011000, %01101000, %01111000<br />&nbsp; &nbsp;.db %00001010, %00011010, %00101010, %00111010, %01001010, %01011010, %01101010, %01111010<br />&nbsp; &nbsp;.db %00001100, %00011100, %00101100, %00111100, %01001100, %01011100, %01101100, %01111100<br />&nbsp; &nbsp;.db %00001110, %00011110, %00101110, %00111110, %01001110, %01011110, %01101110, %01111110</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145476"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145476">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145476#p145476"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 16, 2015 10:23 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">I'm using the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">screen</tt> variable for that. AND-ing off all other bits than the bit 0 should let me see which nametable I'm on at the moment (to know which nametables' start address to use ($2000 or $2400)).</div><br />Right, but that's not the only situation where you need the screen index. You need it when calculating the scroll direction, when calculating the position of the column you need to render, when generating the target NT and AT addresses, and so on. And the position of the column also needs to be a 16-bit number, since levels are larger than 1 screen.<br /><br />I really think you should consider implementing a &quot;camera&quot; object, and giving it its own position. The low byte of the camera's position is the scroll value you'll write to $2005, without any modifications, and the lowest bit of the high byte will go to $2000, so there are no added complications. Having a camera entity will allow for advanced scrolling later down the road if you decide to. You can apply physics to the camera, so it moves with a bit of inertia, like real cameras do. You can move it more to the right or to the left of the player depending on which side he's facing. You can easily move the camera around in cutscenes while the player is stopped, to reveal things that are farther away. The camera is a real thing that moves around the stage, like the other game objects do. Pretending it doesn't exist and manipulating the scroll directly is a poor way to treat such an important dynamic entity, IMO.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145512"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145512">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145512#p145512"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 17, 2015 7:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, here are some of the things I don't understand:<br /><br />Here you are comparing OldCameraX against CameraX, but you are not doing anything with the result. Does this set one of the processor flags or something?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;;detect the direction of the movement<br />&nbsp; &nbsp;lda OldCameraX+0<br />&nbsp; &nbsp;cmp CameraX+0<br />&nbsp; &nbsp;lda OldCameraX+1<br />&nbsp; &nbsp;sbc CameraX+1<br />&nbsp; &nbsp;bcc MovedRight<br /></div><br /><br />What's the point of having SBC here if you are subtracting #$00? Again, does this set a processor flag?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda CameraX+1<br />&nbsp; &nbsp;sbc #$00<br />&nbsp; &nbsp;sta ColumnX+1<br /></div><br /><br />Are these pointers supposed to be memory addresses or do they point to a table? The way you are writing the variable names and labels makes them sometimes hard to distinguish which one you mean. (I use different style for both, <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">example_variable</tt> for variables and <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">ExampleTable</tt> for lookup tables and labels)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;lda (LevelPointer), y<br /><br />( ... )<br /><br />&nbsp;lda (ScreenPointer), y<br /></div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p145514"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145514">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145514#p145514"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 17, 2015 8:44 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Nice to see you trying to figure out the code!<br /><br /><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">Here you are comparing OldCameraX against CameraX, but you are not doing anything with the result. Does this set one of the processor flags or something?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;;detect the direction of the movement<br />&nbsp; &nbsp;lda OldCameraX+0<br />&nbsp; &nbsp;cmp CameraX+0<br />&nbsp; &nbsp;lda OldCameraX+1<br />&nbsp; &nbsp;sbc CameraX+1<br />&nbsp; &nbsp;bcc MovedRight<br /></div></div><br />I'm using the result (look at the branch instruction), but since the camera position is unsigned I'm using the C flag instead of the N flag to check the result. After a comparison/subtraction, the CPU indicates a borrow by clearing the C flag. So, if there was a borrow when subtracting CameraX from OldCameraX, that means CameraX is larger than OldCameraX, meaning the camera moved right.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">What's the point of having SBC here if you are subtracting #$00? Again, does this set a processor flag?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;lda CameraX+1<br />&nbsp; &nbsp;sbc #$00<br />&nbsp; &nbsp;sta ColumnX+1<br /></div></div><br />That's how 16-bit math works. This part propagates the borrow onto the next byte. For example, let's subtract $0014 from $0a12. First we do $12 - $14, which is -$02 ($fe). since the result was smaller than 0, there was a borrow. If you don't do anything with that information, you'll end up with $0afe as your result, which is wrong. You have to do the other half of the subtraction, which is $0a - $00 = $0a, which looks pointless at first, but since there was a borrow, an extra unit is subtracted from $0a and you end up with $09, forming $09fe, which is the correct result.<br /><br />It's very important that you understand this. Since the 6502 is an 8-bit CPU, it's very convenient to work with 8-bit numbers, but a lot of things in a game need numbers larger than that, so you absolutely must understand how 16-bit math works.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Are these pointers supposed to be memory addresses or do they point to a table?</div><br />These are ZP variables that point to the current level map, a screen definition and a metatile definition, so you can read the data that composes the level.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p145516"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p145516">Re: Game project help and progress thread</a></div><div style="float: right;"><a href="./viewtopic.php?p=145516#p145516"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Apr 17, 2015 10:11 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 123<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">That's how 16-bit math works. This part propagates the borrow onto the next byte. For example, let's subtract $0014 from $0a12. First we do $12 - $14, which is -$02 ($fe). since the result was smaller than 0, there was a borrow. If you don't do anything with that information, you'll end up with $0afe as your result, which is wrong. You have to do the other half of the subtraction, which is $0a - $00 = $0a, which looks pointless at first, but since there was a borrow, an extra unit is subtracted from $0a and you end up with $09, forming $09fe, which is the correct result.<br /></div><br /><br />So, when the carry flag is set, SBC #$00 subtracts nothing, but if it's cleared, it will subtract #$01 instead? If this is right, does this work with ADC too?<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">These are ZP variables that point to the current level map, a screen definition and a metatile definition, so you can read the data that composes the level.</div><br /><br />So, they point the locations of the tables in ROM?<br />LevelPointer points to [1.], ScreenPointer points to [2.] and MetatilePointer points to [3.]<br /><br /><span style="font-size: 150%; line-height: normal">[1.]</span><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Stage1:<br />&nbsp;.dw Stg1Screen1,Stg1Screen2,Stg1Screen3,Stg1Screen4,Stg1Screen5<br /></div><br /><br /><span style="font-size: 150%; line-height: normal">[2.]</span><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Stg1Screen1:<br />&nbsp;.dw MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F<br />&nbsp;.dw MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F<br />&nbsp;.dw MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F,MT0F<br />&nbsp;.dw MT0F,MT0A,MT0D,MT0F,MT0F,MT0F,MT0F,MT0F<br />&nbsp;.dw MT0F,MT08,MT0C,MT0F,MT13,MT11,MT0F,MT12<br />&nbsp;.dw MT13,MT07,MT10,MT05,MT04,MT04,MT04,MT04<br />&nbsp;.dw MT04,MT04,MT04,MT06,MT00,MT00,MT00,MT00<br />&nbsp;.dw MT00,MT00,MT00,MT00,MT00,MT00,MT00,MT00<br /></div><br /><br /><span style="font-size: 150%; line-height: normal">[3.]</span><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">MT00:<br />&nbsp;.db $29,$2A,$29,$2A<br />&nbsp;.db $39,$3A,$39,$3A<br />&nbsp;.db $29,$2A,$29,$2A<br />&nbsp;.db $39,$3A,$39,$3A<br />&nbsp;.db %01010101<br /></div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=22&amp;t=12538&amp;start=45"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=22"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=22&amp;t=12538"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>4</strong> of <strong>8</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 106 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=22&amp;t=12538&amp;start=30">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=22&amp;t=12538">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=30">3</a><span class="page-sep">, </span><strong>4</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=22&amp;t=12538&amp;start=105">8</a> &nbsp;<a href="./viewtopic.php?f=22&amp;t=12538&amp;start=60">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=22">Homebrew Projects</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="12538" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22" selected="selected">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
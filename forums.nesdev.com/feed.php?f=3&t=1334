<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=1334" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2010-06-03T17:18:55-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=1334</id>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2010-06-03T17:18:55-07:00</updated>
<published>2010-06-03T17:18:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62345#p62345</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62345#p62345"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62345#p62345"><![CDATA[
cool page -- thanks.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Thu Jun 03, 2010 5:18 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-06-03T12:28:25-07:00</updated>
<published>2010-06-03T12:28:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62334#p62334</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62334#p62334"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62334#p62334"><![CDATA[
<div class="quotetitle">James wrote:</div><div class="quotecontent"><br /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">SMB2 was originally MMC1<br /></div><br />Interesting -- what's the story there?  Was this just in development or something?  I'm unaware of any non-MMC3 version of SMB2.</div><br />Dwedit is trying to say that <a href="http://themushroomkingdom.net/smb2_proto.shtml" class="postlink">early prototypes of SMB2 were SNROM</a>, just like the other popular FDS ports (Metroid, Kid Icarus, The Legend of Zelda). It was mapper hacked to MMC3 before release, with new features such as animated background tiles and an expanded ending.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Thu Jun 03, 2010 12:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2010-06-03T12:22:06-07:00</updated>
<published>2010-06-03T12:22:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62333#p62333</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62333#p62333"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62333#p62333"><![CDATA[
<div class="quotetitle">Dwedit wrote:</div><div class="quotecontent"><br />SMB2 was originally MMC1<br /></div><br /><br />Interesting -- what's the story there?  Was this just in development or something?  I'm unaware of any non-MMC3 version of SMB2.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Thu Jun 03, 2010 12:22 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dwedit]]></name></author>
<updated>2010-06-03T08:33:20-07:00</updated>
<published>2010-06-03T08:33:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62323#p62323</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62323#p62323"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62323#p62323"><![CDATA[
SMB2 was originally MMC1 with CHR-RAM before it became MMC3 with CHR-ROM.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=53">Dwedit</a> — Thu Jun 03, 2010 8:33 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Disch]]></name></author>
<updated>2010-06-03T08:31:07-07:00</updated>
<published>2010-06-03T08:31:07-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62322#p62322</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62322#p62322"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62322#p62322"><![CDATA[
There's no way SMB2 uses DMC interrupts, and I'm very doubtful it uses MMC3 interrupts.<br /><br />(at least I doubt it uses MMC3 interrupts during the main game.  It might use them for some subscreen or something)<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=33">Disch</a> — Thu Jun 03, 2010 8:31 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2010-06-03T05:39:59-07:00</updated>
<published>2010-06-03T05:39:59-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62317#p62317</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62317#p62317"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62317#p62317"><![CDATA[
Don't recall if it uses DMC interrupts, but it definitely does not use MMC3 interrupts.<br /><br />jwdonal - are you triggering interrupts only if they're enabled (i.e. by writes to $e001)?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Thu Jun 03, 2010 5:39 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-06-03T05:12:52-07:00</updated>
<published>2010-06-03T05:12:52-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62316#p62316</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62316#p62316"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62316#p62316"><![CDATA[
<div class="quotetitle">jwdonal wrote:</div><div class="quotecontent"><br />I didn't think that SMB2 even used the MMC3 interrupt at all. But apparently it does, otherwise why would they clear the interrupt flag (i.e. CLI)?<br /></div><br />I forget: Does SMB2 use DMC IRQ?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Thu Jun 03, 2010 5:12 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-02T20:28:16-07:00</updated>
<published>2010-06-02T20:28:16-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62306#p62306</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62306#p62306"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62306#p62306"><![CDATA[
Well this stinks.  Now that I have _enabled_ the IRQ output by default Super Mario Bros 2, which used to work, is no longer working.  And I can see that the game keeps jumping to FFFE-FFFF over and over again.  I don't get.  I didn't think that SMB2 even used the MMC3 interrupt at all. But apparently it does, otherwise why would they clear the interrupt flag (i.e. CLI)?<br /><br />So if I make my MMC3 disable interrupts at system reset then I won't pass Blargg's tests but SMB2 will work.<br /><br />If I make my MMC3 enable interrupts at system reset then Blargg's tests pass, but SMB2 no longer works.<br /><br />Wha??<br /><br />Any help?<br /><br />Thanks!<br /><br />Jonathon<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Wed Jun 02, 2010 8:28 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-02T19:03:01-07:00</updated>
<published>2010-06-02T19:03:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62301#p62301</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62301#p62301"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62301#p62301"><![CDATA[
Okay, so that fixed it.  I am now passing _all_ of Blargg's MMC3 IRQ test ROMs.  But unfortunately, when I say all I really mean _all_ of them - including _both_ Rev A and Rev B tests (#5 and #6).  I don't think that's supposed to happen - in fact, I didn't even think it was possible.  Well...more debugging.  If anyone has any ideas let me know.<br /><br />But hey, I'm passing all of Blargg's tests! Progress!! <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Pz!<br /><br />Jonathon<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Wed Jun 02, 2010 7:03 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-02T17:39:41-07:00</updated>
<published>2010-06-02T17:39:41-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62295#p62295</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62295#p62295"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62295#p62295"><![CDATA[
That's right.  Okay, so that tells me that I should have the interrupt output of the mapper enabled upon reset. And even though the IRQ line will be asserted from the MMC3, the CPU is not going to recognize it until the user calls the CLI instruction. Makes sense. Thanks!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Wed Jun 02, 2010 5:39 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2010-06-02T17:21:19-07:00</updated>
<published>2010-06-02T17:21:19-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62293#p62293</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62293#p62293"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62293#p62293"><![CDATA[
Upon reset, IRQ, or NMI, the 6502 CPU turns on the IRQ ignore flag in the processor status register, as if it had executed the SEI instruction. It is the responsibility of the program to set up all registers of the mapper before turning off this flag (with the CLI instruction).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Wed Jun 02, 2010 5:21 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-02T17:02:30-07:00</updated>
<published>2010-06-02T17:02:30-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62290#p62290</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62290#p62290"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62290#p62290"><![CDATA[
Should interrupts be enabled to the CPU upon system reset?  Or does the software first have to write to $E001 to enable them?  If they are enabled at reset then in my case an MMC3 interrupt would occur immediately upon reset since my IRQ counter is initialized to 0 at reset.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Wed Jun 02, 2010 5:02 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-01T21:40:21-07:00</updated>
<published>2010-06-01T21:40:21-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62267#p62267</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62267#p62267"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62267#p62267"><![CDATA[
<div class="quotetitle">ReaperSMS wrote:</div><div class="quotecontent"><br />Verilog would probably look something like so:<br /></div><br />Agreed! Now that I understand how $C001 works that is.  lol<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Tue Jun 01, 2010 9:40 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[ReaperSMS]]></name></author>
<updated>2010-06-01T21:38:14-07:00</updated>
<published>2010-06-01T21:38:14-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62266#p62266</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62266#p62266"/>
<title type="html"><![CDATA[MMC3 (again) -- and/or general IRQ timing issues?]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62266#p62266"><![CDATA[
Verilog would probably look something like so:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">wire irq;<br /><br />assign irq = irq_en &amp; ~|counter;<br />assign reset_count = reset_latch | ~|counter;<br /><br />// reset_latch should be set on C001 writes, cleared on irq_check<br />always @&#40;posedge clk&#41;<br />   if &#40;irq_check&#41;<br />      if &#40;reset_count&#41;<br />        counter &lt;= latch;<br />      else<br />        counter &lt;= counter - 1'b1;<br /></div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=8">ReaperSMS</a> — Tue Jun 01, 2010 9:38 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[jwdonal]]></name></author>
<updated>2010-06-01T22:00:17-07:00</updated>
<published>2010-06-01T21:34:56-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62265#p62265</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62265#p62265"/>
<title type="html"><![CDATA[EXCELLENT!!]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=1334&amp;p=62265#p62265"><![CDATA[
AWESOME! Now I'm certain I've got it figured out! =D<br /><br />May I make one suggestion though? <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  I would change the "clear" term that you use in your mapper 4 MMC3 doc to "reset".  It was really confusing me - when I think "clear" I think clear vs. set (as in bits) - so "clear" would mean value goes to 0.  But that's not really what happens.  The counter is really "reset" to the last value written to $C000.  Now that I understand this all three docs (yours, Blargg's, and the Wiki's) match up!  This is just my opinion...but I really think it would help. <img src="http://forums.nesdev.com/images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />It would also be awesome if you added this "reset flag" method.  That really helped me as well.<br /><br />Haha, I would even add the last part of your post to the doc as well - straightened me out good!<br /><br />THANKS FOR ALL YOUR HELP DISCH!!! <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":-D" title="Very Happy" /><br /><br />Oh...and if you do make any of those changes can you send me your new 004.txt file?? Pretty please? <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" />  You can send it to "webmaster" at my website's domain name.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3962">jwdonal</a> — Tue Jun 01, 2010 9:34 pm</p><hr />
]]></content>
</entry>
</feed>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Square Wave Notes</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Square Wave Notes</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=3728">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=3728</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Thu Nov 22, 2007 8:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Square Wave Notes</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't know if something like this has already been written, but I looked around and didn't find anything. So I made my own table that lists all the appropriate 11-bit to store into the sound registers for the Square Waves to get the desired note. I don't know if this is needed, but I thought I'd release it anyway: <!-- m --><a class="postlink" href="http://www.freewebs.com/the_bott/NotesTable.txt">http://www.freewebs.com/the_bott/NotesTable.txt</a><!-- m --> .
<br />
<br />EDIT: The first hex value is incorrect. I'll fix that. It should be $7F1, and not $7FF.
<br />
<br />EDIT 2: PAL and NTSC versions released/revised:
<br />
<br /><!-- m --><a class="postlink" href="http://www.freewebs.com/the_bott/NotesTableNTSC.txt">http://www.freewebs.com/the_bott/NotesTableNTSC.txt</a><!-- m -->
<br /><!-- m --><a class="postlink" href="http://www.freewebs.com/the_bott/NotesTablePAL.txt">http://www.freewebs.com/the_bott/NotesTablePAL.txt</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Drag</b> [ Thu Nov 22, 2007 10:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah! Very nice! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />
<br />This is better than the note table I'm using.
<br />
<br />I calculated mine from just knowing that 2047 is an A on the NES, and using (2 ^ (x / 12)) to get the rest of the notes, which are correct notes, but sound slightly too low by just a few cents. :S
<br />
<br />Thank you! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>No Carrier</b> [ Thu Nov 22, 2007 10:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nice, thanks!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Fri Nov 23, 2007 10:31 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, I'm glad you all like it. I'll be releasing one for the Triangle Wave today, and I'll fix that first byte on the Square Wave.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Nov 23, 2007 11:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I did mine all with theory calculations. Since I wanted to do linear vibratoes and glissandoes as well, I did a table where you get much more values than notes (31 pitch values between each note exactly) to get precise periods. (doing only a 12-tone table does allow for pitch bends, but they most likely won't be linear). I did it on the lowest octave available (and even lower than this in fact) and you just shift the values for higher octaves. The triangle plays one octave lower than any channel for the same frequency, but the same table is usable. You can have the software shift the values right one more time, or (I'd recommand this) just take this in account when coding music for the NES.
<br />
<br />Here you are WLA code that will generate the table, but it won't work because 2 power a real number results in an integer for some reason. I told the author and he said he fixed it, but this still didn't work as it should have. I eventually did the table by hand, wich was annoying but it's just a bad time to have once and you have a great table forever.
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.define BaseTune 32.7&nbsp; &nbsp;&nbsp; &nbsp;;The lowsest C is 32.7 Hz <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;even if the NES can't output that frequence, all calculation are based on this one<br /><br />PeriodTbl<br /><br />.define Note 0<br />.rept 12<br />&nbsp; &nbsp;.redefine FineTune 0<br />&nbsp; &nbsp;&nbsp; &nbsp;.rept 32&nbsp; &nbsp;&nbsp; &nbsp;;Setup period for all possible 32 fine tunes and all possible 12 notes &#40;384 periods in total&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;.dw CPUSpeed/&#40;2^&#40;&#40;Note/12&#41;+&#40;FineTune/32&#41;&#41;*BaseTune*16&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;.redef FineTune FineTune+1<br />&nbsp; &nbsp;&nbsp; &nbsp;.endr<br />&nbsp; &nbsp;.redef Note Note+1<br />.endr<br /></div>
<br />BTW I should fix my sound code to have a better enveloppe handling, to add "note enveloppe" (aka arpeggio) while I'm not a fan of this effect it's always a good feature (especially on noise), and to correct a few bugs in other special effects.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Nov 23, 2007 11:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I wrote <a href="http://nesdev.com/bbs/viewtopic.php?p=3860#3860" class="postlink">my period table generator</a> in C.
<br />
<br />But in practice, isn't a piecewise linear pitch table (using software linear interpolation between semitones) good enough, or is it on the wrong side of a time/space tradeoff?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Nov 23, 2007 11:46 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You mean software which would calculate the difference between two semitones, and then compute the fractional finetune of it ? Seems much more complicated that just have a table that include the finetunes as well. Of course it would be less a pain to make the table, but in revenche it seems much more a pain to write a routine doing the linar approximation like you said.
<br />
<br />It's like when I had to write some code to shot oriented bullets at constant speed, I had to deal with trigonomerty and this was a pain, and I considered using approximate trigonometry by making piece of segments, but this was even more a pain, so I just used a big tangeant table eventually.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Sivak</b> [ Mon Dec 24, 2007 10:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Neat.  I may use this when I attempt to make music for my game.  For some reason I think that's going to be a serious chore...
<br />
<br />Is that triangle wave guide anywhere?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MetalSlime</b> [ Tue Feb 10, 2009 2:04 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Square Wave Notes</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Celius wrote:</div><div class="quotecontent">I don't know if something like this has already been written, but I looked around and didn't find anything. So I made my own table that lists all the appropriate 11-bit to store into the sound registers for the Square Waves to get the desired note. I don't know if this is needed, but I thought I'd release it anyway: <!-- m --><a class="postlink" href="http://www.freewebs.com/the_bott/NotesTable.txt">http://www.freewebs.com/the_bott/NotesTable.txt</a><!-- m --> .<br /><br />EDIT: The first hex value is incorrect. I'll fix that. It should be $7F1, and not $7FF.</div>
<br />
<br />This is awesome.  Do you have the values for the Triangle channel?? I'd love to have it if you do!!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Feb 10, 2009 2:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It's the same values, but the resulting sound will be one octave lower.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Tue Feb 10, 2009 11:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Glad you could find it useful <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> .
<br />
<br />But like Bregalad said, they are the same values, but only an octave lower. I should have mentioned that in the document. I'll make that fix.
<br />
<br />Also, this only applies to NTSC systems, I'm assuming. What's the formula for calculating the values for a PAL NES?
<br />
<br />EDIT: Fixed  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> .

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Feb 10, 2009 11:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />For PAL, you can usually get away with using the same lookup table and skipping the first entry.
<br />
<br />Here's why: The NTSC NES CPU runs at 1789772 Hz. The PAL NES CPU runs at 1662607 Hz. The ratio between these is 1.0764853, which is very close to the 1.0594631 ratio between frequencies of tones one semitone apart in 12edo.
<br />
<br />To be more exact, replace the "1790000" in the formula with "1662607".

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Feb 10, 2009 1:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The PAL CPU is 15/16 slower than it's NTSC counterpart, so multiplying the values by 16/15 worked fine for me, but I don't know how exact this is. It seemed more exact that doing it one semitone higher as tepples mentionned.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Celius</b> [ Tue Feb 10, 2009 1:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah, thank you tepples  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> . Though I'd like to make a legitimate table for PAL, because it does sound slightly flat when you take a NTSC game and run it on PAL in an emulator. And I feel bad because sometimes I feel like I have the mentality that NTSC is "normal" or standard so I don't need to care about PAL when that's just ridiculous, because a very large chunk of people live in PAL areas.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Feb 10, 2009 1:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It's fun because in NES-dev scene NTSC is considered normal while PAL is non-standard, but in C64-dev scene it's the other way arround, PAL is considered normal and NTSC is only for those who really cares about it. Anyway I'd be caring about all regions, it's not hard to change the tempo and to adjust the pitch table. Multiply values by 15/16 will do, but you probably want to change the clock by PAL clock frequency to get exact results.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
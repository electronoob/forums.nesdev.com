<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - DMA operation in APU</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - DMA operation in APU" href="http://forums.nesdev.com/feed.php?f=3&amp;t=6100" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '3');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=6100';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 1:53 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=6100&amp;start=30">DMA operation in APU</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=6100"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>5</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 61 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=6100&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=6100">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=60">5</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=6100&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=6100&amp;start=30&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=6100&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=6100&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p64438"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p64438"></a></div><div style="float: right;"><a href="./viewtopic.php?p=64438#p64438"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jul 18, 2010 7:56 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39_1487294131.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 3139<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">- How did you manage to get this test to pass? I mean, do you control the number of "eaten" CPU cycles by the DMC DMA?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p64451"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p64451"></a></div><div style="float: right;"><a href="./viewtopic.php?p=64451#p64451"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 19, 2010 2:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 1060<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent">- How did you manage to get this test to pass? I mean, do you control the number of "eaten" CPU cycles by the DMC DMA?</div>
<br />
<br />Yes.  My PPU/CPU/APU are all cycle driven.  Most emulators (Nestopia 1.40, for one) do the sprite DMA all in one big chunk (a quick for loop) on any write to $4014 and just let the cycle accounting mechanisms take care of the held-off CPU time.  My PPU does the sprite DMA inline with its cycle emulation, one cycle at a time, for 513 or 514 cycles.  A write to $4014 simply sets up the internal state, the cycle-by-cycle emulate method does the rest.
<br />
<br />Thus, whenever a DMC DMA occurs, I know whether or not I'm in the middle of a sprite DMA or not.  And, because the PPU actually does the 513/514 cycle DMA one cycle at a time, I know exactly where in the sprite DMA I am when the DMC DMA occurs.  My CPU also provides the necessary "read/fetch, or write" information about the most recent cycle (useful, of course, only if the PPU isn't in the middle of a sprite DMA).  From there it's just a few easy checks to see whether to have 3, 2, or 1 wait state cycles before the DMC DMA cycle.
<br />
<br />I now pass both of the sprdma_and_dmc_dma test ROMs and have shifted attention over to trying to pass the $4016/DMC effect test ROMs.
<br />
<br />My code is all up on <a href="http://www.gitorious.org/nesicide/nesicide2-master/trees/master" class="postlink">Gitorious</a> if you're curious.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p64453"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p64453"></a></div><div style="float: right;"><a href="./viewtopic.php?p=64453#p64453"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 19, 2010 6:16 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"> And, because the PPU actually does the 513/514 cycle DMA one cycle at a time, I know exactly where in the sprite DMA I am when the DMC DMA occurs.</div>
<br />The 2A03 does the DMA, not the PPU, as far as I know. I'm pretty sure the PPU just sees it as a series of $2004 writes every other CPU cycle.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p64468"></a>
				<b class="postauthor">Zepper</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p64468"></a></div><div style="float: right;"><a href="./viewtopic.php?p=64468#p64468"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 19, 2010 3:08 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly Fx3</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=39_1487294131.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 4:59 pm<br /><b>Posts:</b> 3139<br /><b>Location:</b> Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">NESICIDE wrote:</div><div class="quotecontent"> From there it's just a few easy checks to see whether to have 3, 2, or 1 wait state cycles before the DMC DMA cycle.</div>
<br />
<br />- That's my question, what checks do you do? I couldn't locate anything in your code. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=39"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p64485"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p64485"></a></div><div style="float: right;"><a href="./viewtopic.php?p=64485#p64485"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 19, 2010 7:14 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 1060<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Zepper wrote:</div><div class="quotecontent"><div class="quotetitle">NESICIDE wrote:</div><div class="quotecontent"> From there it's just a few easy checks to see whether to have 3, 2, or 1 wait state cycles before the DMC DMA cycle.</div><br /><br />- That's my question, what checks do you do? I couldn't locate anything in your code. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>
<br />
<br />@Zepper:  Look for calls to C6502::STEALCYCLES and calls to C6502::DMA.  Also look at CPPU::PPU(unsigned short addr, unsigned char data) for IOSPRITEDMA (where $4014 is written and the transfer is set up).
<br />
<br />@blargg:  I agree the DMA cycles originate from the 6502...I just left the implementation in the PPU because I originally just did the quick 256-byte for-loop copy there.  I only do a DMA or STEALCYCLES call once every 3 or 3.2 PPU cycles.  I'll look into moving it to be more correct.
<br />
<br />EDIT: files are emulator/cnes6502.h and .cpp, emulator/cnesppu.h and .cpp, and emulator/cnesapu.h and .cpp.
<br />
<br />I'm struggling with an APU/SDL sync problem at the moment tho so even though the APU is "flawless" according to blargg's tests it sounds like poop warmed over.  I really hate the SDL callback interface.  Not flexible *at all*!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p71789"></a>
				<b class="postauthor">jwdonal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p71789"></a></div><div style="float: right;"><a href="./viewtopic.php?p=71789#p71789"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Dec 22, 2010 6:04 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3962.gif" width="50" height="50" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jun 27, 2009 11:05 pm<br /><b>Posts:</b> 719<br /><b>Location:</b> New Mexico, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hey all, this is a bit of a bump but I think it's worth it.  I recently posed my question #1 (from wayyyyy back in the original post that created this thread) to Kevtris over PM.  We had a few back and forths, but this is the ultimate answer that he provided:
<br />
<br /><div class="quotetitle">kevtris wrote:</div><div class="quotecontent">In my implementation, the sprite DMA takes precidence as it must, to prevent graphics corruption. The sample DMA is not stalled though and it will attempt to fetch a sample if it needs one, which happens to be sprite data at the time.<br /><br />Be that as it may, I have not heard any audible artifacts from this happening even when it plays a byte of sprite data as sample data; probably because the samples are really noisy as-is, and 8 samples doesn't make much difference because the rest of the waveform is noisy as hell.<br /><br />A test would be to play a continuous DPCM stream of 00 or ff to peg the DAC counter at one of the ends, then sprite DMA the opposite.<br /><br />like if you DPCM 00h's sprite DMA ff's and watch the output. if it blips then I am doing it right. if not, either sprite fetches are getting screwed, or DPCM is being deferred or injecting extra reads (doubtful).</div>
<br />I think this is incredibly interesting.  Essentially what Kevtris' is saying is that a DMC DMA operation will never be stalled when an OAM DMA operation is in progress - nor will an OAM DMA operation be stalled as a result of an in-progress DMC DMA operation.  The DMC DMA (at least in his design) will just receive corrupted data (which will actually be sprite data) whenever an OAM DMA xfer needs to occur.  Given how accurate Kevtris' emulator has been touted to be, especially for the most bizarre and picky games, I would expect that this is the correct implementation.  Not only that but for some reason it just seems to me like the kind of thing Nintendo would do to save engineering time and money.
<br />
<br />So it's pretty funny because the short, one-word answer to my original question #1 is: Neither.  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />Anyway, I just wanted to share that bit of info and make sure that it got out into the community.  Kevtris said he was cool with me sharing his answer.  I'm curious if anyone has any additional thoughts on it.
<br />
<br />Pz!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3962"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95228"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95228"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95228#p95228"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 08, 2012 11:27 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 4066
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Bump, has the behavior (corrupted DMC samples during sprite DMA) been confirmed?</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95395"></a>
				<b class="postauthor">jwdonal</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95395"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95395#p95395"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jun 12, 2012 1:11 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3962.gif" width="50" height="50" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jun 27, 2009 11:05 pm<br /><b>Posts:</b> 719<br /><b>Location:</b> New Mexico, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hiya dwedit,
<br />
<br />I'm pretty positive that Kevtris' implementation is correct. I tested the following three different implementations using Duck Hunt:
<br />
<br />Method 1: Stop OAM DMA while DMC DMA is occurring
<br />Result: duck/dog sprites visually corrupted on screen whenever "Quack!/Arff!" sounds occurred
<br />
<br />Method 2: Stop DMC DMA while OAM DMA is occurring
<br />Result: heard audible distortion in "Quack!/Arff!" sounds
<br />
<br />Method 3: Do not pause DMC DMA if OAM DMA occurs, but DMC receives sprite data while OAM DMA is occurring (this is kevtris' method)
<br />Result: no audible or visual distortion whatsoever
<br />
<br />I also tested it with Kung Fu and received similar (and worse) results. Kung Fu will eventually freeze if you use method 1. Likely because it uses the DMC channel much more frequently than Duck Hunt.
<br />
<br />Hope that helps!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3962"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p95396"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95396"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95396#p95396"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jun 12, 2012 1:15 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 4066
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">After re-reading the thread, Blargg mentioned that DMC used two cycles if it happened during a 4014 sprite dma transfer.  So does it interrupt the sprite DMA to perform the DMC read?  What's it doing during those two cycles?
<br />
<br />Why would stopping Sprite DMA to do a DMC read corrupt the sprites?
<br />
<br />Also wondering because Nintendulator doesn't pass the timing tests for DMC reads during sprite DMA.</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p95586"></a>
				<b class="postauthor">cpow</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p95586"></a></div><div style="float: right;"><a href="./viewtopic.php?p=95586#p95586"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jun 17, 2012 5:36 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">NESICIDE developer</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3705.png" width="100" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Oct 13, 2008 7:55 pm<br /><b>Posts:</b> 1060<br /><b>Location:</b> Minneapolis, MN
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">After re-reading the thread, Blargg mentioned that DMC used two cycles if it happened during a 4014 sprite dma transfer.  So does it interrupt the sprite DMA to perform the DMC read?  What's it doing during those two cycles?<br /><br />Why would stopping Sprite DMA to do a DMC read corrupt the sprites?<br /><br />Also wondering because Nintendulator doesn't pass the timing tests for DMC reads during sprite DMA.</div>
<br />I finally found the post I wanted to reply to with <a href="http://nesdev.com/bbs/viewtopic.php?t=9009&amp;highlight=" class="postlink">this topic post</a>.  I plan to implement what I'm observing from my Visual2A03 trials in my emulator.  As you said, it does indeed interrupt the sprite DMA to perform the DMC read...for two cycles.  The read/write/read beat of the sprite DMA is kept such that the DMC read occurs where the sprite read from the sprite memory page would otherwise occur.  Then in the cycle that should be a write to 2004 there's just a CPU read from the PC value before the sprite DMA started.  Then the sprite DMA picks up where it left off.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3705"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p117097"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p117097">Re: DMA operation in APU</a></div><div style="float: right;"><a href="./viewtopic.php?p=117097#p117097"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 26, 2013 6:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> LinkÃ¶ping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Is source code available for the sprdma_and_dmc_dma test roms?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p117103"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p117103">Re: DMA operation in APU</a></div><div style="float: right;"><a href="./viewtopic.php?p=117103#p117103"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 26, 2013 11:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Looks like it was an off-the-cuff test. I've located the source and will package it the next time I'm on my old Mac.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p117106"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p117106">Re: DMA operation in APU</a></div><div style="float: right;"><a href="./viewtopic.php?p=117106#p117106"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 26, 2013 11:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> LinkÃ¶ping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Looks like it was an off-the-cuff test. I've located the source and will package it the next time I'm on my old Mac.</div><br /><br />Would be appreciated. Could PM it too if you have it and feel like it - off-the-cuff state if better than nothing. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p117127"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p117127">Re: DMA operation in APU</a></div><div style="float: right;"><a href="./viewtopic.php?p=117127#p117127"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 27, 2013 12:51 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> LinkÃ¶ping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Haven't traced through the code to figure out what's going on yet, but for some reason the output ends up way off. I pass all the apu_test, apu_reset, and cpu_interrupts_v2 tests (and all the ppu_vbl_nmi tests except 07-nmi_on_timing.nes (off by 1-2 ticks - might be some analog thing going on there)).<br /><br />I end up with<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tests/sprdma_and_dmc_dma/sprdma_and_dmc_dma.nes FAILED<br />T+ Clocks (decimal)<br />00 3768<br />01 3767<br />02 3768<br />03 3767<br />04 3768<br />05 3767<br />06 3766<br />07 3765<br />08 3766<br />09 3765<br />0A 3766<br />0B 3765<br />0C 3766<br />0D 3765<br />0E 3766<br />0F 3765<br /><br />7461977F<br />SPRDMA and DMC DMA<br /><br />Failed<br /><br />tests/sprdma_and_dmc_dma/sprdma_and_dmc_dma_512.nes FAILED<br />T+ Clocks (decimal)<br />00 3766<br />01 3765<br />02 3766<br />03 3765<br />04 3766<br />05 3765<br />06 3766<br />07 3767<br />08 3768<br />09 3767<br />0A 3768<br />0B 3767<br />0C 3768<br />0D 3767<br />0E 3768<br />0F 3767<br /><br />2EA11D4D<br />SPRDMA and DMC DMA<br /><br />Failed</div><br /><br />Here's the DMC code in case anyone can spot any obvious bugs/misunderstandings. The sample loading timing is ballparked at the moment and misses some corner cases, though I don't think by enough to warrant the huge error. <strong>channel_updated</strong> is for sample generation and can be ignored.<br /><br /><strong>Registers:</strong><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// $4010<br />void write_dmc_reg_0(uint8_t value) {<br />&nbsp; &nbsp; static uint16_t const dmc_ntsc_periods&#91;&#93; =<br />&nbsp; &nbsp; &nbsp; { 428, 380, 340, 320, 286, 254, 226, 214, 190, 160, 142, 128, 106, 84, 72, 54 };<br /><br />&nbsp; &nbsp; if (!(dmc_irq_enabled = value &amp; 0x80)) {<br />&nbsp; &nbsp; &nbsp; &nbsp; dmc_irq = false;<br />&nbsp; &nbsp; &nbsp; &nbsp; update_irq_status();<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; dmc_loop_sample = value &amp; 0x40;<br />&nbsp; &nbsp; dmc_period&nbsp; &nbsp; &nbsp; = dmc_ntsc_periods&#91;value &amp; 0x0F&#93;;<br />}<br /><br />// $4011<br />void write_dmc_reg_1(uint8_t value) {<br />&nbsp; &nbsp; unsigned const old_dmc_counter = dmc_counter;<br /><br />&nbsp; &nbsp; dmc_counter = value &amp; 0x7F;<br /><br />&nbsp; &nbsp; if (dmc_counter != old_dmc_counter)<br />&nbsp; &nbsp; &nbsp; &nbsp; channel_updated = true;<br />}<br /><br />// $4012<br />void write_dmc_reg_2(uint8_t value) {<br />&nbsp; &nbsp; dmc_sample_start_addr = 0x4000 | (value &lt;&lt; 6);<br />}<br /><br />// $4013<br />void write_dmc_reg_3(uint8_t value) {<br />&nbsp; &nbsp; dmc_sample_len = (value &lt;&lt; 4) + 1;<br />}</div><br /><br /><strong>Clocking:</strong><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void tick_apu() {<br />&nbsp; &nbsp; ...<br />&nbsp; &nbsp; if (--dmc_period_cnt == 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; dmc_period_cnt = dmc_period;<br />&nbsp; &nbsp; &nbsp; &nbsp; clock_dmc();<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; ...<br />}<br /><br />static void clock_dmc() {<br />&nbsp; &nbsp; if (dmc_bits_remaining &gt; 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (dmc_sample_buffer &amp; 1) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dmc_counter &lt; 126) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_counter += 2;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; channel_updated = true;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dmc_counter &gt; 1) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_counter -= 2;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; channel_updated = true;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; dmc_sample_buffer &gt;&gt;= 1;<br />&nbsp; &nbsp; &nbsp; &nbsp; if (--dmc_bits_remaining == 0 &amp;&amp; dmc_bytes_remaining &gt; 0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; load_dmc_sample_byte();<br />&nbsp; &nbsp; }<br />}</div><br /><br /><strong>Status:</strong><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">// $4015<br />uint8_t read_apu_status() {<br />&nbsp; &nbsp; uint8_t const res =<br />&nbsp; &nbsp; &nbsp; (dmc_irq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; 7) |<br />&nbsp; &nbsp; &nbsp; (frame_irq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; 6) |<br />&nbsp; &nbsp; &nbsp; (cpu_data_bus&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; 0x20) | // Open bus<br />&nbsp; &nbsp; &nbsp; ((dmc_bytes_remaining &gt; 0) &lt;&lt; 4) |<br />&nbsp; &nbsp; &nbsp; ((noise_len_cnt&nbsp; &nbsp; &nbsp; &nbsp;&gt; 0) &lt;&lt; 3) |<br />&nbsp; &nbsp; &nbsp; ((tri_len_cnt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&gt; 0) &lt;&lt; 2) |<br />&nbsp; &nbsp; &nbsp; ((pulse&#91;1&#93;.len_cnt&nbsp; &nbsp; &gt; 0) &lt;&lt; 1) |<br />&nbsp; &nbsp; &nbsp; &nbsp;(pulse&#91;0&#93;.len_cnt&nbsp; &nbsp; &gt; 0);<br />&nbsp; &nbsp; frame_irq = false;<br />&nbsp; &nbsp; update_irq_status();<br />&nbsp; &nbsp; return res;<br />}<br /><br />// $4015<br />void write_apu_status(uint8_t value) {<br />&nbsp; &nbsp; ...<br /><br />&nbsp; &nbsp; // We need to clear the DMC IRQ before handling the DMC enable/disable in<br />&nbsp; &nbsp; // case a one-byte sample is loaded below, which will immediately fire a<br />&nbsp; &nbsp; // DMC IRQ<br />&nbsp; &nbsp; dmc_irq = false;<br />&nbsp; &nbsp; update_irq_status();<br /><br />&nbsp; &nbsp; // DMC enable bit. We model DMC enabled/disabled through the number of<br />&nbsp; &nbsp; // sample bytes that remain (greater than zero =&gt; enabled).<br />&nbsp; &nbsp; if (!(value &amp; 0x10))<br />&nbsp; &nbsp; &nbsp; &nbsp; dmc_bytes_remaining = 0;<br />&nbsp; &nbsp; else {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (dmc_bytes_remaining == 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_sample_cur_addr = dmc_sample_start_addr;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_bytes_remaining = dmc_sample_len;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If a sample byte is currently being played, the sample is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // restarted only after it has finished<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dmc_bits_remaining == 0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; load_dmc_sample_byte();<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; ...<br />}</div><br /><br /><strong>Sample loading:</strong><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">static void load_dmc_sample_byte() {<br />&nbsp; &nbsp; // Timing: http://forums.nesdev.com/viewtopic.php?p=62690#p62690<br />&nbsp; &nbsp; // TODO: Open bus?<br />&nbsp; &nbsp; assert(dmc_bytes_remaining &gt; 0);<br />&nbsp; &nbsp; assert(dmc_bits_remaining == 0);<br /><br />&nbsp; &nbsp; dmc_sample_buffer = prg(dmc_sample_cur_addr);<br /><br />&nbsp; &nbsp; // We use tick() since the PPU as as well as the rest of the APU should<br />&nbsp; &nbsp; // keep ticking during the fetch.<br />&nbsp; &nbsp; // TODO: Is this done before or after the IRQ is generated? (Should be<br />&nbsp; &nbsp; // invisible though.)<br />&nbsp; &nbsp; unsigned const delay = doing_oam_dma ? 2 : doing_read ? 4 : 3;<br />&nbsp; &nbsp; for (unsigned i = 0; i &lt; delay; ++i) tick();<br /><br />&nbsp; &nbsp; dmc_sample_cur_addr = (dmc_sample_cur_addr + 1) &amp; 0x7FFF;<br /><br />&nbsp; &nbsp; // Putting this after the delay ensures that we can't get a recursive<br />&nbsp; &nbsp; // invocation of load_dmc_sample_byte(), since it can only called be called<br />&nbsp; &nbsp; // through dmc_bits_remaining going from 1 to 0 while the CPU is stalled<br />&nbsp; &nbsp; dmc_bits_remaining = 8;<br /><br />&nbsp; &nbsp; if (--dmc_bytes_remaining == 0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (dmc_loop_sample) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_sample_cur_addr = dmc_sample_start_addr;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_bytes_remaining = dmc_sample_len;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dmc_irq_enabled) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dmc_irq = true;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; update_irq_status();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />}</div></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5911">ulfalizer</a> on Sat Aug 31, 2013 12:39 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p117148"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p117148">Re: DMA operation in APU</a></div><div style="float: right;"><a href="./viewtopic.php?p=117148#p117148"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 27, 2013 2:21 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Full sources + rom: <a href="http://blargg.8bitalley.com/nes-tests/sprdma_and_dmc_dma.zip" class="postlink">sprdma_and_dmc_dma.zip</a></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=6100&amp;start=30"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=6100"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>5</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 61 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=6100&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=6100">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=6100&amp;start=60">5</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=6100&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 3 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="6100" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Viable game sound and music solution</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Viable game sound and music solution</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=495">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=495</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Fri Aug 26, 2005 2:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Sounds good.  <br /></div><br /><br />Thanks. You're the first human besides me to hear it.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I don't know which emu is most accurate, but on the real system writing to $4003/$4007 will reset the duty cycle and envelope (likewise for $400B and $400F too).</div>
<br />
<br />Well, for my vibrato effect I do so. How else could I update the current period. I see other games do the same thing in gnsf but they don't reset the waveform. I must be missing something...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Roth</b> [ Fri Aug 26, 2005 2:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Wow man, yeah, that does sound really good.  I like the bass line alot <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  The whole song has a nice groove to it.  Good job!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Fri Aug 26, 2005 2:41 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Looks fairly good, actually it even is more advanced than the write I wrote on myself that is only focused on volume and that doesn't allow pitch effects at all for now (I'll surely do a second version someday). <br />The music is cool, in Bubbleman style  <br /></div><br /><br />Yea, when I was a kid, I really loved the megaman series music. So you can see I've been watching those tunes in gnsf and kinda adapting the style.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">About the period resed, I think you should avoid re-writing to $4003/$4007 during a note, exept if you want do this to have a grumble effect like Just Breed does. This cause problems for some vibratoes, where the period *should* be resetted anyway because the high 3 bits of frequencey are affected. This cause no problem on the triangle channel, however. (actually, all that stuff make me stay away of vibratoes/slides exept by sweeping hardware for now). <br /></div><br /><br />So should I use the sweep unit to do my pitch changes?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Wow man, yeah, that does sound really good. I like the bass line alot  The whole song has a nice groove to it. Good job!</div>
<br />
<br />Thank you very much. And thank you Bregalad.
<br />
<br />Also, I included two songs, if anyone might not have noticed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Roth</b> [ Fri Aug 26, 2005 3:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ha, no, I didn't notice that... I missed the whole .nsf itself actually, went straight for the .nes <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />  I noticed there are some sounds that happen when pushing A and B in the .nes file.  Are these sounds going to be part of your game?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Fri Aug 26, 2005 4:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Ha, no, I didn't notice that... I missed the whole .nsf itself actually, went straight for the .nes  I noticed there are some sounds that happen when pushing A and B in the .nes file. Are these sounds going to be part of your game?</div>
<br />
<br />Kinda, the nes file is a test program for the sound stuff. Pressing A or B makes a test sound, Start resets the music, and Select stops it. The code is setup to play sound effects but only for one channel. That's why I made the test rom to make sure everything worked right, though those specific sounds might not be in my game.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Aug 26, 2005 5:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mbrenaman wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">About the period resed, I think you should avoid re-writing to $4003/$4007 during a note, exept if you want do this to have a grumble effect like Just Breed does. This cause problems for some vibratoes</div><br />So should I use the sweep unit to do my pitch changes?</div>
<br />If you write to $4002/$4006 every frame and then write to $4003/$4007 only when necessary, you'll get clicks only around a few pitches, those called A-0, B-0, D-1, F-1, A-1, D-2, A-2, and A-3 in NT2. If you want to make your pitch slides [i]really[i] smooth, try turning on the slide unit only when the period is about to cross a multiple of 256, so that you don't have to write to $4003 except on a new note. It's tricky, but it's probably doable.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Aug 26, 2005 6:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">If you want to make your pitch slides [i]really[i] smooth, try turning on the slide unit only when the period is about to cross a multiple of 256, so that you don't have to write to $4003 except on a new note. It's tricky, but it's probably doable.</div>
<br />
<br />See the thread <a href="http://nesdev.com/bbs/viewtopic.php?t=231" class="postlink">"Vibrato on square without phase reset"</a> for demo code and a ROM that show exactly how to do this. I might look into modifying Soundy to do this if nobody else does.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Aug 26, 2005 11:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">See the thread <a href="http://nesdev.com/bbs/viewtopic.php?t=231" class="postlink">"Vibrato on square without phase reset"</a> for demo code and a ROM that show exactly how to do this. I might look into modifying Soundy to do this if nobody else does.</div><br />Yeah, I just remembered that he's got one solution. However, it would work only if you don't use decay unit, sweep units and timelenght counters *at all* in your sound code. This should be okay since you're handling that stuff with software.<br />The common way to do this is effectively to write to $4002/6 anyway, but to be carefull to write only to $4003/7 if the value is different from the previous ones. This needs more variable, but this can be skipped for triangle and noise channels.<br />Else, the pitch slides would be okay because you'd write only once to the high frequencey register, and the clicks wouldn't be really noticable, but for vibratoes arround A, the period will *regulary* be reseted, and you'll have very noticable clicks. You can do as blargg says, or else, another fine method is just to xor the frequencey with 1 regulary. You'll be holding only little vibrato dephts, but the period will never be resseted, even with the infamous A2 note, that is $0fe (%000 - %1111'1110) on NTSC, and it definitely can't have depht more than one single step, else it would crunckle.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Yea, when I was a kid, I really loved the megaman series music. So you can see I've been watching those tunes in gnsf and kinda adapting the style.</div>
<br />When you was a kid ? I love it right now, personally  <img src="./images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> 
<br />Actually, after comparing the two song more seriousely, I think if you would hack Megaman 2 to put your music insted of the original one in Bubbleman stage, nobody would notice it until the final part of the song that is a bit different, exept diehard megaman fans like probably a lot of people in there.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Sun Aug 28, 2005 8:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Welp blargg, it seems to work. I've done some more work and added your solution and have uploaded a new version <a href="http://mbrenaman.com/soundy_1_1_0.zip" class="postlink">http://mbrenaman.com/soundy_1_1_0.zip</a>. Works in Nintendulator, hope it'll work on the real thing.
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">When you was a kid ? I love it right now, personally  <br />Actually, after comparing the two song more seriousely, I think if you would hack Megaman 2 to put your music insted of the original one in Bubbleman stage, nobody would notice it until the final part of the song that is a bit different, exept diehard megaman fans like probably a lot of people in there.</div>
<br />
<br />I meant that as that was the first time I heard it. I have my own NSF collection that I listen to at my computer. Of course, if anyone here found out I would be the subject of much reticule &gt;ha ha&lt;.
<br />
<br />The tunes sound quite similiar indeed though. The difference's are mainly the key (mine - Ab, megaman 2 Bubbleman tune - Eb) and the format of part C. Did I do it on purpose, yes... But it came out more similiar then I expected &gt;hehe&lt;..
<br />
<br />Anyways, thanks everyone.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sun Aug 28, 2005 10:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I realized that the new sweep code will prevent sound effects from using the sweep unit. The other limitations aren't a problem for the music driver, but I think this might be since sweeps are very useful for sound effects.
<br />
<br />I also found a problem with the NSF, due apparently to the assembler generating bad code (nasty!). I've reported the details privately.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sun Aug 28, 2005 12:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Cool ! This is great if that method was successfull ! I'm gonna to use it someday, and I've now no reason to stay away from vibratoes/slides in the next sound code I'll write. However...
<br />I ask myself why you said #$0f would be written in the sweep units when not wrapping around freq for vibratoes. I understand that the bit 7 should be clear, but scince it's clear the sweep units are totally disabled and have no effect, exept for limited frequency below very small periods (that would be dog whistle or somthing), and bit 3 should be set (down2up sweep) if a frequencey period above $3ff is used (if the 11th bit is set), else the sweep unit will disable the channel when a high period is deteced in up2down mode, even if disabled.
<br />However, writing $08 or $0f shouldn't make any difference, or does it ?
<br />Also, does writing $40 or $c0 to $4017 while clocking the sweep units manyally make any difference ? And when not clocking them, what should it be written to ?
<br />
<br />About the sound effects, it's sure the big flaw of this method. All hardware stuff is used to :
<br />- Timelengt conter : Only few games uses it, and it can be done very easily with software, and it can be 100% replaced by software, scince it has a one-frame precision, and scince one APU frame is more or less the same than one PPU frame, it'll have the exact same precision.
<br />- Triangle timer : This timer feathures more precision, (1/4 of an APU frame or am I wrong ?), so it can't be 100% replaced by software. I think a programm that would write every frame a timing value between $1 and $3 in the timer register, the result will be 1/4, 1/2 and 3/4 of a frame (from now I'll cale frame both PPU frame and APU frames, scince I'll consider them to be equivalent), so it can be shorter and make special "buzzy" sound effects. However, I'm not very sure of this.
<br />- Decay unit : This one has sure few precision and I'm sure the software can 100% replace all it's features, with one-frame precision.
<br />- Sweep unit : Here you are where the big problem is. I think the sweep units in slow rates can be easily replaced with software, that allow more precision while sweeping so it's definitely better. But, with very fast value, it's able to refresh the frequencey at 1/2 frame percision, which isn't negligable while doing gruble sound effects and this is probably pretty much needed for a game that would have better SFX than just beeps and bleeps. This allow very fast frequencey variations, and eventually make dynamic and cool effects. I'm very unsure on what would be the best results without using them. Maybe the same precision could be reached if the sound code would be triggered twice per frame : One time with the PPU's NMI, and one time with a frame IRQ. However, scince $4017 is manually clocked, the frame IRQ couldn't work as we wan't it to, so scanline IRQ would be needed.
<br />Any comment/corrections/ideas, blargg ?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sun Aug 28, 2005 3:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've posted my reply to the thread <a href="http://nesdev.com/bbs/viewtopic.php?p=4120#4120" class="postlink">"Vibrato on square without phase reset"</a>, since your questions are about the technique rather than the Soundy driver.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Mon Aug 29, 2005 1:19 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, thanks to blargg, Soundy's been tested on the real NES. I fixed two small bugs and viola <a href="http://mbrenaman.com/soundy_1_1_2.zip" class="postlink">http://mbrenaman.com/soundy_1_1_2.zip</a>
<br />
<br />And I suppose that's it. Thank you everyone and I'll thank blargg just one more time.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dXtr</b> [ Mon Aug 29, 2005 3:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />mbrenaman &gt; don't know if this is an bugg or not.. but if you push the A and B buttons repeatedly really fast you can make the sounds get stuck. it's easiest to do it when the music is off.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mbrenaman</b> [ Mon Aug 29, 2005 8:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">mbrenaman &gt; don't know if this is an bugg or not.. but if you push the A and B buttons repeatedly really fast you can make the sounds get stuck. it's easiest to do it when the music is off.</div>
<br />
<br />Oh man... Sorry about that. Thanks for trying it out. I thought I had fixed it. It should be fixed now plus sounds should also not hang during the transition from music on to music off.
<br />
<br />The fixed version is at the same link as above.
<br />
<br />EDIT : Darn it, nevermind. I just remembered to try during the transition from music off to on and it screwed up abit.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - comprehensive SMB1 disassembly</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">comprehensive SMB1 disassembly</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=2987">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=2987</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>5</strong> of <strong>10</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Apr 18, 2007 2:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: short answer</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">It only "makes sense" because "armário" rhymes with "Mario"</div><br />This joke works in Spanish too, where "closet" is also <em>armario</em>. A variation might work in English:<br /><br />-Do you know Hubbard?<br />-What Hubbard?<br />-The one that banged you behind the cupboard!<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I think people should understand exactly what goes on with a piece of code that was copied and pasted. If they don't, there might just be a case where this code misbehaves (when compared to their expectations) and they are just buying themselves some nasty bugs, while they could have coded something specifically tailored to their needs, and have no nasty surprises.</div>
<br />Code designed to be copied and pasted is called a <a href="http://en.wikipedia.org/wiki/Library_%28computing%29" class="postlink">library</a>, and the ability of a piece of code to act as a library is called <a href="http://en.wikipedia.org/wiki/Modularity_%28programming%29" class="postlink">modularity</a>. Yes, people who write libraries should state the pre- and post-conditions of each function (whether defined, implementation-defined, unspecified, or undefined), and people who use libraries should understand the pre- and post-conditions of each function and should not depend on any behavior that isn't defined. Otherwise, you get DLL hell when people depend on undocumented behaviors of the library.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Apr 18, 2007 2:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: short answer</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">-Do you know Hubbard?</div><br />But I don't really know any Hubbard... Mario is famous! =) That, in fact, makes it hard for people to answer "What Mario?"... ¬¬! "Luigi's brother?" is a more common answer, I guess! =)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Yes, people who write libraries should state the pre- and post-conditions of each function (whether defined, implementation-defined, unspecified, or undefined), and people who use libraries should understand the pre- and post-conditions of each function and should not depend on any behavior that isn't defined.</div>
<br />I get it. This makes a lot more sense in today's complicated architectures though... Which is one of the reasons I don't like to program for the PC anymore. It used to be really fun to program in DOS, but windows ruined it all.
<br />
<br />Yeah, I'm a control freak, I want to know everything that goes on with my programs. I admit this is a personal issue, and I can acknowledge libraries (even for the NES) as useful things for people that don't want to (or can't) program the whole thing.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>commodorejohn</b> [ Wed Apr 18, 2007 3:04 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: short answer</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">commodorejohn wrote:</div><div class="quotecontent">Mind repeating it in Portuguese? I'm just curious.</div><br />It's too stupid... so, I ask that any other brazilian members around forgive me for propagating something so stupid...<br /><br />It goes something like:<br />-Conhece o Mario?<br />-Que Mario?<br />-Aquele que te comeu atrás do armário!<br /><br />Which translates to:<br />-Do you know Mario? (kids used to ask other kids this question)<br />-What Mario? (this was the most likely answer)<br />-The one that banged you behind the closet! (the first kid, feeling so smart, replied with this)<br /><br />It only "makes sense" because "armário" rhymes with "Mario"...</div>
<br />That's okay, English has loads of jokes like that =)
<br />Although I find it a little odd that "comeu" is used as slang for that...I'm pretty sure that whatever the connection is, I don't want to know it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Wed Apr 18, 2007 7:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">beneficii wrote:</div><div class="quotecontent">Actually, I'm curious, what did you do to add the labels?  Did you just work them in manually, or did you have a program that added as you disassembled the code?<br /><br />Additionally, what do you think of using a code data logger to help disassemble?</div>
<br />
<br />I worked them in manually.  The only things I used were a text editor and a lot of cut and paste, and find and replace.  My method was probably very slow and inefficient, but it was simple enough for my purposes.  I wasn't trying to re-invent SMB, only figure out what made it tick.
<br />
<br />A code data logger would probably only help as far as the actual reverse-engineering phase is concerned.  But that can only speed up the process, so I'd be for it, I guess.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Apr 20, 2007 8:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What exactly is a closet ? (just because I'm frustrated making no sense of this). So that I could build up a french version of the joke.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Apr 20, 2007 10:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">What exactly is a closet ?</div>
<br />Oh boy, I knew I shouldn't have said anything about the joke! &gt;_&lt;
<br />
<br />Take a look at what the <a href="http://dictionary.reference.com/browse/closet" class="postlink">dictionary</a> has to say. "Closet" seems to be more of a small room where you store clothes, but "armário" is more of a standalone, tall piece of furniture for the same purpose. I don't know, maybe "wardrobe" would be a better translation for "armário"?
<br />
<br />I'm really really sorry for these latest messages about famous characters having sex behind furniture, it's just that when I saw the question "You know MARIO?" I couldn't avoid thinking about the joke. And I just realized that someone <a href="http://img109.exs.cx/img109/6569/2768.jpg" class="postlink">tried to do this in english</a> already...
<br />
<br />Sorry, sorry! Is it possible for the joke part of this thread to be split and moved to general stuff? We shouldn't be ruining the discussion about this great disassembly job...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Apr 20, 2007 11:31 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It's difficult to split a topic that talks about subject A and digression B when almost every post that mentions B also mentions A.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Apr 20, 2007 12:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'll go ahead and post a french version of the joke (repacing Mario by Luigi so that it rhymes).
<br />
<br />- Tu connais Luigi ?
<br />- Quel Luigi ?
<br />- Celui qui te frappe derriere l'armoire à habits.
<br />
<br />
<br />... I still don't get much fun from it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Fri Apr 20, 2007 2:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That's all well and good, except in the middle of digression B I think you guys forgot what subject A is. :-P

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Apr 20, 2007 4:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So will the RAM use of this SMB1 disassembly be modularized (e.g. to ".res" statements in segment BSS), or not?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Apr 20, 2007 6:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm not doing it. Too busy right now. And probably for the next few months. Why don't you do it?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Apr 20, 2007 7:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'll take a look at it.
<br />
<br />EDIT: Now that I look at <a href="http://datacrystal.org/wiki/Super_Mario_Bros.:RAM_map" class="postlink">the RAM map on datacrystal</a>, it doesn't appear as complete as <a href="http://www.geocities.com/deethefigurine/smbmem.txt" class="postlink">this one</a>.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CKY-2K/Clay Man</b> [ Sat Apr 21, 2007 1:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />k nevermind.  You could at least say "no".

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Sat Apr 21, 2007 7:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I get the feeling we missed something.
<br />
<br />&lt;goes over thread again&gt;
<br />
<br />Are you referring to this:
<br />
<br /><div class="quotetitle">CKY-2K/Clay Man wrote:</div><div class="quotecontent">How would I edit it so that the fireflower doesn't use h-flipping for the right half of the sprite?<br /><br />I really want to know this and I think an example of how to change something would help me a little.</div>
<br />
<br />or something else?
<br />
<br />re: that, the only thing you really have to do is change the branch the game uses when it finds a fire flower to go elsewhere, like so...
<br />
<br />This is the way it looks normally:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; ldx $00<br />&nbsp; &nbsp; &nbsp; &nbsp; dex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;check power-up type for fire flower<br />&nbsp; &nbsp; &nbsp; &nbsp; beq FlipPUpRightSide&nbsp; &nbsp; &nbsp; &nbsp;;if found, skip this part<br />&nbsp; &nbsp; &nbsp; &nbsp; sta Sprite_Attributes+8,y&nbsp; ;otherwise set new palette bits&nbsp; for bottom left<br />&nbsp; &nbsp; &nbsp; &nbsp; sta Sprite_Attributes+12,y ;and bottom right sprites as well for star only<br /></div><br />This is what you would do if you wanted to stop the fire flower from horizontally flipping on the right side:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />&nbsp; &nbsp; &nbsp; &nbsp; ldx $00<br />&nbsp; &nbsp; &nbsp; &nbsp; dex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;check power-up type for fire flower<br />&nbsp; &nbsp; &nbsp; &nbsp; beq PUpOfs&nbsp; &nbsp; &nbsp; &nbsp;&lt;--- change third line to this<br />&nbsp; &nbsp; &nbsp; &nbsp; sta Sprite_Attributes+8,y&nbsp; ;otherwise set new palette bits&nbsp; for bottom left<br />&nbsp; &nbsp; &nbsp; &nbsp; sta Sprite_Attributes+12,y ;and bottom right sprites as well for star only<br /></div>
<br />
<br />Doing this will cause the game to skip the horizontal flip part of the power-up graphics handler used to flip fire flowers and stars and go straight to offscreen handling instead.  It will still flip star power-ups, due to the condition checking.
<br />
<br />You should bear in mind, though, that the fire flower will probably look messed up unless you change the graphics.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CKY-2K/Clay Man</b> [ Sat Apr 21, 2007 11:37 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, thanks man!
<br />
<br />Thanks to your asm I could make these neat pipes for my project.
<br />
<br /><img src="http://img222.imageshack.us/img222/5156/49903852wy5.png" alt="Image" />

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>5</strong> of <strong>10</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=11379" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2014-07-04T00:03:19-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=11379</id>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-04T00:03:19-07:00</updated>
<published>2014-07-04T00:03:19-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130620#p130620</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130620#p130620"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130620#p130620"><![CDATA[
It would appear that it was a problem with my SBC implementation, it looks like it wasn't setting the carry flag correctly. Using blargg's explanation on the thread that was linked on the previous post I took my ADC code and copied that into SBC, I then added a line in front of that to invert the bits in the operand. This seems to have fixed my problem and I can now get into the game. <br /><br />Thanks again!<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Fri Jul 04, 2014 12:03 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[koitsu]]></name></author>
<updated>2014-07-02T21:44:40-07:00</updated>
<published>2014-07-02T21:44:40-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130590#p130590</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130590#p130590"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130590#p130590"><![CDATA[
I took a look at this in FCEUX version 2.2.3-interim svn3071, since the debugger there provides enough insights into what PRG page/offset is used and what memory contents are that I figured it'd be helpful.<br /><br />The ROM I'm using is Zelda II - The Adventure of Link (U).nes, MD5 checksum 764d36fa8a2450834da5e8194281035a.  All this matters.<br /><br />I set a breakpoint on execute for address CECD -- this is the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bne</tt>, because I wanted to see the code that lead up to that point -- and also added a breakpoint conditional for A==#6B (don't ask about the syntax; that's how FCEUX does it), since that value was taken from your own code log dump.  I then powered off the emulator, then powered it on.  I was able to get past the title screen + registered a new save game entry + chose it.  Upon pressing Start (to select a character/save game), the breakpoint hit.  I'm going to assume that's the situation/condition where this happens for you -- if not, please state so.  I did this multiple times to ensure the register values, code, etc. were always consistent.<br /><br />The code leading up to the first time that <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bne</tt> was about to be executed:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"> 07:CEA9:85 00     STA $0000 = #$36<br /> 07:CEAB:A5 01     LDA $0001 = #$94<br /> 07:CEAD:69 00     ADC #$00<br /> 07:CEAF:85 01     STA $0001 = #$94<br /> 07:CEB1:A5 02     LDA $0002 = #$36<br /> 07:CEB3:18        CLC<br /> 07:CEB4:69 01     ADC #$01<br /> 07:CEB6:85 02     STA $0002 = #$36<br /> 07:CEB8:A5 03     LDA $0003 = #$6D<br /> 07:CEBA:69 00     ADC #$00<br /> 07:CEBC:85 03     STA $0003 = #$6D<br /> 07:CEBE:A5 04     LDA $0004 = #$6B<br /> 07:CEC0:38        SEC<br /> 07:CEC1:E9 01     SBC #$01<br /> 07:CEC3:85 04     STA $0004 = #$6B<br /> 07:CEC5:A5 05     LDA $0005 = #$02<br /> 07:CEC7:E9 00     SBC #$00<br /> 07:CEC9:85 05     STA $0005 = #$02<br /> 07:CECB:05 04     ORA $0004 = #$6B<br />&gt;07:CECD:D0 D1     BNE $CEA0<br /></div><br />The &quot;07&quot; shown on the left indicates that the code being executed is in PRG bank/page $07.  I believe this refers to the actual PRG bank offset according to static 16KB bank sizes (per .NES header definition).<br /><br />Register contents at this point were as follows (these are what the values are BEFORE the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bne</tt> happened):<br /><br />A=$6B X=$00 Y=$00 S=$01F9 P={unused, B, I, and C set; all others unset}<br /><br />Stack contents: $A7 C1 00 A4 17 C0<br /><br />I also dumped the values of ZP locations $00 through $05 (keep reading for why).  FCEUX shows this to you (see the code log I pasted), but I wanted to know what they were right before the moment the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bne</tt> was to be run.  Here are the contents:<br /><br />$00 = $36<br />$01 = $94<br />$02 = $36<br />$03 = $6D<br />$04 = $6B<br />$05 = $02<br /><br />I then stepped through the code (&quot;Step Into&quot;), which let the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bne</tt> execute (as it should since Z is unset) and then looked at what happened:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&gt;07:CEA0:B1 00     LDA ($00),Y @ $9436 = #$0C<br /> 07:CEA2:91 02     STA ($02),Y @ $6D36 = #$0C<br /></div><br />After the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">lda/sta</tt> executed, these were the relevant registers:<br /><br />A=$0C X=$00 Y=$00 S=$01F9 P={unused, B, I, and C set; all others unset}<br /><br />The PRG bank did not change (it remained $07), which is correct behaviour because the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta</tt> is not touching MMC1 register space.  This routine looks like it's just screwing with the PRG-RAM (SRAM) contents within the $6000-7FFF region.  There should not be any bank switching happening at this time.  The <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta</tt> is not changing anything within the MMC1 register space to cause a bankswitch.<br /><br />If the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta &#40;$02&#41;,y</tt> in your emulator is actually touching MMC1 bankswitching registers, then what that indicates to me is the values in ZP locations $02 and $03 are incorrect.  This would go along with what Quietust said about something happening earlier that may be causing this problem.  Rephrased: the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sta &#40;$02&#41;,y</tt> may be writing to MMC1 register space when on a good/proper emulator it doesn't appear to (at least not through the first loop iteration / when A == $6B like in the code you posted).<br /><br />The loop all of this is in, for your information, is constantly tinkering with ZP locations $00 through $05, so that said: my gut feeling is that you may have some mathematical/twos-complement problems with your <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">adc/sbc</tt> instructions, as those are the absolute top #1-incorrectly-implemented opcodes when it comes to people doing their own 6502 emulators.  I mention this because in the above code, I see <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">adc</tt> being used without a preceding <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">clc</tt> (which is perfectly fine, but you need to understand how <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">adc</tt> works for it to be emulated correctly), and I see <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sbc</tt> being used without a preceding <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">sec</tt> (also perfectly fine).  If you need reference material for the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">adc/sbc</tt> implementation (the topic has come up many times on the forums over the years and example code given many times), <a href="http://forums.nesdev.com/viewtopic.php?p=19080#19080" class="postlink">here you go</a>; the implementation/code from blargg is correct (the rest of the thread is educational material, so if you read that, read the entire thing and don't be hasty).<br /><br />Second-most-common that I see are people getting the addressing modes wrong, specifically incorrectly implementing <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">&#40;$xx,x&#41;</tt> vs. <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">&#40;$xx&#41;,y</tt> (the former is pre-indexed, the latter is post-indexed).   The pre/post-indexed addressing modes should be very easy to implement (and don't forget about page wrapping, i.e. <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">ldx #$02 / lda &#40;$ff,x&#41;</tt> would read from $01 and $02 to get the effective 16-bit address, not from $0101 and $0102.  Same goes for things like <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">lda &#40;$ff&#41;,y</tt> which would read the effective 16-bit address from $ff and $00, not $ff and $0100).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3">koitsu</a> — Wed Jul 02, 2014 9:44 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[mkwong98]]></name></author>
<updated>2014-07-02T18:40:30-07:00</updated>
<published>2014-07-02T18:40:30-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130584#p130584</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130584#p130584"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130584#p130584"><![CDATA[
The content of reg A starts with 0xA2 writing to 0x6D00 and decrements every loop until it reaches 0x00.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4883">mkwong98</a> — Wed Jul 02, 2014 6:40 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MottZilla]]></name></author>
<updated>2014-07-02T14:33:35-07:00</updated>
<published>2014-07-02T14:33:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130568#p130568</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130568#p130568"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130568#p130568"><![CDATA[
<div class="codetitle"><b>Code:</b></div><div class="codecontent">CEC5  A5 05        LDA $05                           A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC7  E9 00        SBC #00                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC9  85 05        STA $05                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CECB  05 04        ORA $04                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CECD  D0 D1        BNE #D1                           A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142</div><br /><br />Somewhere in here might be your problem. Basically there are just a couple pointers and a counter for a memory copy as Quietust mentioned. For some reason, your CPU is not exiting this loop when it should and so it proceeds on forever, eventually crashing itself when it writes to the MMC1 registers. <br /><br />Since it exits based on the Zero Status flag, you should make sure that it's being set appropriately. Are you setting the Z flag properly when the ORA operation happens? That would be the last operation to affect the flag.  If it isn't the Zero Flag, then it might be related to your ADC or SBC opcodes not behaving properly. I just thought I'd give you some ideas of where to look for the problem.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1726">MottZilla</a> — Wed Jul 02, 2014 2:33 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-02T08:48:06-07:00</updated>
<published>2014-07-02T08:48:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130534#p130534</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130534#p130534"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130534#p130534"><![CDATA[
Thanks for your help, you're right those instructions should have shown indirect Y addressing mode - just a typo in my logging code.<br /><br />I have noticed that when I register a new save account on the game the count shown under the name on the select screen is set to 256 instead of 000. I think that this points to something going wrong at or before the point of registering a new save file. I will keep investigating and report back if I solve the problem.<br /><br />Once again thanks to all who replied.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Wed Jul 02, 2014 8:48 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Quietust]]></name></author>
<updated>2014-07-02T08:34:55-07:00</updated>
<published>2014-07-02T08:34:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130532#p130532</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130532#p130532"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130532#p130532"><![CDATA[
For the record, that particular block of code is only supposed to copy $9400-$96A0 to $6D00-$6FA0, so something went wrong a <strong>long</strong> time before your crash happened.<br /><br />Also, you're displaying some of those instructions incorrectly - the instructions at $CEA0 and $CEA2 are &quot;LDA ($00),Y&quot; and &quot;STA ($02),Y&quot;, not &quot;LDA ($00,X)&quot; and &quot;STA ($02,X)&quot;.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=7">Quietust</a> — Wed Jul 02, 2014 8:34 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-02T02:47:24-07:00</updated>
<published>2014-07-02T02:47:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130526#p130526</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130526#p130526"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130526#p130526"><![CDATA[
Here are the last few iterations of the loop before the crash with (what I hope is) the execution log info you asked for:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CEA0  B1 00        LDA ($00, X) = $A775 @ A775 = 69  A:6D X:00 Y:00 P:25 SP:F9 CYC:0 SL:141<br />CEA2  91 02        STA ($02, X) = $8075 @ 8075 = 0F  A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:141<br />CEA4  A5 00        LDA $00                           A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:141<br />CEA6  18           CLC                               A:75 X:00 Y:00 P:25 SP:F9 CYC:0 SL:141<br />CEA7  69 01        ADC #01                           A:75 X:00 Y:00 P:24 SP:F9 CYC:0 SL:141<br />CEA9  85 00        STA $00                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEAB  A5 01        LDA $01                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEAD  69 00        ADC #00                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEAF  85 01        STA $01                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEB1  A5 02        LDA $02                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEB3  18           CLC                               A:75 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB4  69 01        ADC #01                           A:75 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB6  85 02        STA $02                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB8  A5 03        LDA $03                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEBA  69 00        ADC #00                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEBC  85 03        STA $03                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEBE  A5 04        LDA $04                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEC0  38           SEC                               A:2C X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEC1  E9 01        SBC #01                           A:2C X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC3  85 04        STA $04                           A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC5  A5 05        LDA $05                           A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC7  E9 00        SBC #00                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC9  85 05        STA $05                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CECB  05 04        ORA $04                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CECD  D0 D1        BNE #D1                           A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEA0  B1 00        LDA ($00, X) = $A776 @ A776 = 2B  A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEA2  91 02        STA ($02, X) = $8076 @ 8076 = 03  A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEA4  A5 00        LDA $00                           A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEA6  18           CLC                               A:76 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEA7  69 01        ADC #01                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEA9  85 00        STA $00                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEAB  A5 01        LDA $01                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEAD  69 00        ADC #00                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEAF  85 01        STA $01                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEB1  A5 02        LDA $02                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEB3  18           CLC                               A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB4  69 01        ADC #01                           A:76 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB6  85 02        STA $02                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEB8  A5 03        LDA $03                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEBA  69 00        ADC #00                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEBC  85 03        STA $03                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEBE  A5 04        LDA $04                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:142<br />CEC0  38           SEC                               A:2B X:00 Y:00 P:24 SP:F9 CYC:0 SL:142<br />CEC1  E9 01        SBC #01                           A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC3  85 04        STA $04                           A:2A X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC5  A5 05        LDA $05                           A:2A X:00 Y:00 P:25 SP:F9 CYC:0 SL:142<br />CEC7  E9 00        SBC #00                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEC9  85 05        STA $05                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CECB  05 04        ORA $04                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CECD  D0 D1        BNE #D1                           A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA0  B1 00        LDA ($00, X) = $A777 @ A777 = 2C  A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA2  91 02        STA ($02, X) = $8077 @ 8077 = 27  A:2C X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA4  A5 00        LDA $00                           A:2C X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA6  18           CLC                               A:77 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA7  69 01        ADC #01                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEA9  85 00        STA $00                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEAB  A5 01        LDA $01                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEAD  69 00        ADC #00                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEAF  85 01        STA $01                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEB1  A5 02        LDA $02                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEB3  18           CLC                               A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEB4  69 01        ADC #01                           A:77 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEB6  85 02        STA $02                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEB8  A5 03        LDA $03                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEBA  69 00        ADC #00                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEBC  85 03        STA $03                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEBE  A5 04        LDA $04                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEC0  38           SEC                               A:2A X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEC1  E9 01        SBC #01                           A:2A X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEC3  85 04        STA $04                           A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEC5  A5 05        LDA $05                           A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEC7  E9 00        SBC #00                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEC9  85 05        STA $05                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CECB  05 04        ORA $04                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CECD  D0 D1        BNE #D1                           A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA0  B1 00        LDA ($00, X) = $A778 @ A778 = 29  A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA2  91 02        STA ($02, X) = $8078 @ 8078 = 16  A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA4  A5 00        LDA $00                           A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA6  18           CLC                               A:78 X:00 Y:00 P:25 SP:F9 CYC:0 SL:143<br />CEA7  69 01        ADC #01                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEA9  85 00        STA $00                           A:79 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEAB  A5 01        LDA $01                           A:79 X:00 Y:00 P:24 SP:F9 CYC:0 SL:143<br />CEAD  69 00        ADC #00                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEAF  85 01        STA $01                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:143<br />CEB1  A5 02        LDA $02                           A:A7 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:144<br />CEB3  18           CLC                               A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:144<br />CEB4  69 01        ADC #01                           A:78 X:00 Y:00 P:24 SP:F9 CYC:0 SL:144<br />CEB6  85 02        STA $02                           A:79 X:00 Y:00 P:24 SP:F9 CYC:0 SL:144<br />CEB8  A5 03        LDA $03                           A:79 X:00 Y:00 P:24 SP:F9 CYC:0 SL:144<br />CEBA  69 00        ADC #00                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:144<br />CEBC  85 03        STA $03                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:144<br />CEBE  A5 04        LDA $04                           A:80 X:00 Y:00 P:A4 SP:F9 CYC:0 SL:144<br />CEC0  38           SEC                               A:29 X:00 Y:00 P:24 SP:F9 CYC:0 SL:144<br />CEC1  E9 01        SBC #01                           A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEC3  85 04        STA $04                           A:28 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEC5  A5 05        LDA $05                           A:28 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEC7  E9 00        SBC #00                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEC9  85 05        STA $05                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CECB  05 04        ORA $04                           A:61 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CECD  D0 D1        BNE #D1                           A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEA0  B1 00        LDA ($00, X) = $A779 @ A779 = 2B  A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144<br />CEA2  91 02        STA ($02, X) = $8079 @ 8079 = 0F  A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:144</div><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Wed Jul 02, 2014 2:47 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-02T00:47:36-07:00</updated>
<published>2014-07-02T00:47:36-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130524#p130524</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130524#p130524"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130524#p130524"><![CDATA[
OK thanks I will improve my execution logging as you suggest. My CPU passes all the nestest.nes tests, could anyone recommend a test rom that might show up the problem?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Wed Jul 02, 2014 12:47 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MottZilla]]></name></author>
<updated>2014-07-01T21:29:55-07:00</updated>
<published>2014-07-01T21:29:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130518#p130518</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130518#p130518"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130518#p130518"><![CDATA[
You may have a CPU bug if the game is looping and writing into the $8000 and up area. It would not be unusual for a game to copy something into the $6000-$7FFF range. But it shouldn't be reaching the upper area as that will be writing the various mapper registers and eventually is probably what causes your crash. So maybe you need to examine your execution or test your CPU.<br /><br />Quietust is correct about what I meant about CPU logging. You should be able to see your CPU log and see exactly what the CPU is doing. It helps anyone reading it figure out what is going on and perhaps what is going wrong.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1726">MottZilla</a> — Tue Jul 01, 2014 9:29 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Quietust]]></name></author>
<updated>2014-07-01T19:05:14-07:00</updated>
<published>2014-07-01T19:05:14-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130513#p130513</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130513#p130513"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130513#p130513"><![CDATA[
I think what MottZilla was asking for was to report the actual instruction and addressing mode - that is, those particular instructions should look something more like &quot;STA ($00),Y&quot; (or, if you want to include all of the details of the addressing going on, &quot;STA ($00),Y = 0700 @ 07F6 = 00&quot;).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=7">Quietust</a> — Tue Jul 01, 2014 7:05 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-01T15:57:42-07:00</updated>
<published>2014-07-01T15:57:42-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130501#p130501</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130501#p130501"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130501#p130501"><![CDATA[
I've enhanced the logging slightly to include a bit more info and then I've filtered the results to include only the STA operations that are for $8000 and above.<br /><br />There seems to be some kind of loop in the program that starts from address $6D00 and continues like this: <br /><br />CEA2  91 STA  $6d00              A:39 X:00 Y:00 P:24 SP:F9 CYC:0 SL:177 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $6d01              A:96 X:00 Y:00 P:A5 SP:F9 CYC:0 SL:177 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $6d02              A:47 X:00 Y:00 P:25 SP:F9 CYC:0 SL:178 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />.<br />.<br />.<br />.<br />.<br />.<br />CEA2  91 STA  $7fff              A:09 X:00 Y:00 P:24 SP:F9 CYC:0 SL:65 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8000              A:5B X:00 Y:00 P:24 SP:F9 CYC:0 SL:65 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8001              A:3C X:00 Y:00 P:24 SP:F9 CYC:0 SL:66 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:01100<br />CEA2  91 STA  $8002              A:4B X:00 Y:00 P:24 SP:F9 CYC:0 SL:66 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10110<br />CEA2  91 STA  $8003              A:01 X:00 Y:00 P:65 SP:F9 CYC:0 SL:67 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11011<br />CEA2  91 STA  $8004              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:68 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8005              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:69 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8006              A:3B X:00 Y:00 P:25 SP:F9 CYC:0 SL:69 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8007              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:70 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8008              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:71 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8009              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:71 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $800a              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:72 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $800b              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:73 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $800c              A:EC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:73 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $800d              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:74 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $800e              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:75 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $800f              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:75 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8010              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:76 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8011              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:77 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8012              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:78 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8013              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:78 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8014              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:79 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8015              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:80 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8016              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:80 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8017              A:5B X:00 Y:00 P:25 SP:F9 CYC:0 SL:81 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8018              A:3C X:00 Y:00 P:25 SP:F9 CYC:0 SL:82 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:01100<br />CEA2  91 STA  $8019              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:82 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10110<br />CEA2  91 STA  $801a              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:83 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11011<br />CEA2  91 STA  $801b              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:84 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $801c              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:84 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $801d              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:85 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $801e              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:86 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $801f              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:86 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8020              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:87 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8021              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:88 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8022              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:88 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8023              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:89 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8024              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:90 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8025              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:90 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8026              A:DC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:91 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8027              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:92 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8028              A:49 X:00 Y:00 P:25 SP:F9 CYC:0 SL:93 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8029              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:93 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $802a              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:94 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $802b              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:95 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $802c              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:95 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $802d              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:96 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $802e              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:97 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $802f              A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:97 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8030              A:2C X:00 Y:00 P:25 SP:F9 CYC:0 SL:98 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8031              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:99 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8032              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:99 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8033              A:7B X:00 Y:00 P:25 SP:F9 CYC:0 SL:100 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8034              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:101 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8035              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:102 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8036              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:102 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8037              A:3B X:00 Y:00 P:25 SP:F9 CYC:0 SL:103 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8038              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:103 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8039              A:CC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:104 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $803a              A:AB X:00 Y:00 P:A5 SP:F9 CYC:0 SL:105 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $803b              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:105 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $803c              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:106 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $803d              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:107 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $803e              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:108 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $803f              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:108 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8040              A:7B X:00 Y:00 P:25 SP:F9 CYC:0 SL:109 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8041              A:1C X:00 Y:00 P:25 SP:F9 CYC:0 SL:110 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:01100<br />CEA2  91 STA  $8042              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:110 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10110<br />CEA2  91 STA  $8043              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:111 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11011<br />CEA2  91 STA  $8044              A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:112 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8045              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:112 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8046              A:5B X:00 Y:00 P:25 SP:F9 CYC:0 SL:113 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8047              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:114 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8048              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:114 Control:11101 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8049              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:115 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $804a              A:BC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:116 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $804b              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:116 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $804c              A:89 X:00 Y:00 P:A5 SP:F9 CYC:0 SL:117 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $804d              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:118 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $804e              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:118 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $804f              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:119 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8050              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:120 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8051              A:7B X:00 Y:00 P:25 SP:F9 CYC:0 SL:120 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8052              A:1C X:00 Y:00 P:25 SP:F9 CYC:0 SL:121 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:01000<br />CEA2  91 STA  $8053              A:39 X:00 Y:00 P:25 SP:F9 CYC:0 SL:122 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10100<br />CEA2  91 STA  $8054              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:122 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11010<br />CEA2  91 STA  $8055              A:4B X:00 Y:00 P:25 SP:F9 CYC:0 SL:123 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11101<br />CEA2  91 STA  $8056              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:124 Control:11110 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8057              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:125 Control:11110 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8058              A:5B X:00 Y:00 P:25 SP:F9 CYC:0 SL:125 Control:11110 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8059              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:126 Control:11110 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $805a              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:127 Control:11110 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $805b              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:127 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $805c              A:BC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:128 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $805d              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:129 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $805e              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:129 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $805f              A:6B X:00 Y:00 P:25 SP:F9 CYC:0 SL:130 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8060              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:131 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8061              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:132 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8062              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:132 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8063              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:133 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8064              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:134 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8065              A:7B X:00 Y:00 P:25 SP:F9 CYC:0 SL:134 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8066              A:1C X:00 Y:00 P:25 SP:F9 CYC:0 SL:135 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8067              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:136 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8068              A:4B X:00 Y:00 P:25 SP:F9 CYC:0 SL:136 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8069              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:137 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $806a              A:AB X:00 Y:00 P:A5 SP:F9 CYC:0 SL:138 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $806b              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:138 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $806c              A:01 X:00 Y:00 P:25 SP:F9 CYC:0 SL:139 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $806d              A:1B X:00 Y:00 P:25 SP:F9 CYC:0 SL:140 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $806e              A:19 X:00 Y:00 P:25 SP:F9 CYC:0 SL:140 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $806f              A:AC X:00 Y:00 P:A5 SP:F9 CYC:0 SL:141 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8070              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:142 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8071              A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:142 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8072              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:143 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11110<br />CEA2  91 STA  $8073              A:09 X:00 Y:00 P:25 SP:F9 CYC:0 SL:144 Control:01111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11111<br />CEA2  91 STA  $8074              A:0B X:00 Y:00 P:25 SP:F9 CYC:0 SL:144 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br />CEA2  91 STA  $8075              A:69 X:00 Y:00 P:25 SP:F9 CYC:0 SL:145 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11000<br />CEA2  91 STA  $8076              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:146 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:11100<br />CEA2  91 STA  $8077              A:2C X:00 Y:00 P:25 SP:F9 CYC:0 SL:146 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:01110<br />CEA2  91 STA  $8078              A:29 X:00 Y:00 P:25 SP:F9 CYC:0 SL:147 Control:11111 Prg:00001 Chr0:00000 Chr1:00000 Shift:10111<br />CEA2  91 STA  $8079              A:2B X:00 Y:00 P:25 SP:F9 CYC:0 SL:148 Control:11011 Prg:00001 Chr0:00000 Chr1:00000 Shift:10000<br /><br />Once the address gets above $8000 it starts having an effect on the control register and eventually things go wrong. I'm not sure whether this loop is the correct behaviour of the program or not.<br /><br />I'm guessing this is supposed to be setting up some values in the $6000-$7FFF range (the battery backed section) - I would imagine that it's not supposed to &quot;spill over&quot; into the PRG Rom address space above $7FFF<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Tue Jul 01, 2014 3:57 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MottZilla]]></name></author>
<updated>2014-07-01T10:08:43-07:00</updated>
<published>2014-07-01T10:08:43-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130497#p130497</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130497#p130497"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130497#p130497"><![CDATA[
If possible you should add to your log the full opcode. It would make debugging much easier since you wouldn't need the ROM and a different debugger to see what is really going on.<br /><br />At the point your emulator crashes, it suggests you are bankswitching when you shouldn't be. There is no bankswitch that should occur at that time. The game is writing the PRG-RAM at that time. Check your MMC1 register writing code. <br /><br />Anytime $8000-$FFFF is written it affects the LOAD register. Once the load register is full with 5 bits written to it, then you check where the last write occurred ($8000-$9FFF,$A000-$BFFF,$C000-$DFFF,$E000-$FFFF) to see which register gets updated. Be sure that if at any time the LOAD register has the reset bit set that you reset the LOAD Counter and it should also return to 16K/16K mode.<br /><br />You could always post your MMC1 code to see if anyone can spot anything that might be wrong.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1726">MottZilla</a> — Tue Jul 01, 2014 10:08 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[mkwong98]]></name></author>
<updated>2014-07-01T00:55:20-07:00</updated>
<published>2014-07-01T00:55:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130485#p130485</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130485#p130485"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130485#p130485"><![CDATA[
In my emulator at this point, bank 0 is pointing to 0x4000 and bank 1 is pointing to 0x1C000 and the read return 0xA5<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4883">mkwong98</a> — Tue Jul 01, 2014 12:55 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[matthewtatum]]></name></author>
<updated>2014-07-01T00:37:07-07:00</updated>
<published>2014-07-01T00:37:07-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130483#p130483</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130483#p130483"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130483#p130483"><![CDATA[
Here is a trace of what is going on just before the crash:<br /><br />CEAB  A5 LDA                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:0 SL:127<br />CEAD  69 ADC                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:9 SL:128<br />CEAF  85 STA                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:15 SL:128<br />CEB1  A5 LDA                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:24 SL:128<br />CEB3  18 CLC                                    A:6D X:00 Y:00 P:24 SP:F9 CYC:33 SL:128<br />CEB4  69 ADC                                    A:6D X:00 Y:00 P:24 SP:F9 CYC:39 SL:128<br />CEB6  85 STA                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:45 SL:128<br />CEB8  A5 LDA                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:54 SL:128<br />CEBA  69 ADC                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:63 SL:128<br />CEBC  85 STA                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:69 SL:128<br />CEBE  A5 LDA                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:78 SL:128<br />CEC0  38 SEC                                    A:34 X:00 Y:00 P:24 SP:F9 CYC:87 SL:128<br />CEC1  E9 SBC                                    A:34 X:00 Y:00 P:25 SP:F9 CYC:93 SL:128<br />CEC3  85 STA                                    A:33 X:00 Y:00 P:25 SP:F9 CYC:99 SL:128<br />CEC5  A5 LDA                                    A:33 X:00 Y:00 P:25 SP:F9 CYC:108 SL:128<br />CEC7  E9 SBC                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:117 SL:128<br />CEC9  85 STA                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:123 SL:128<br />CECB  05 ORA                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:132 SL:128<br />CECD  D0 BNE                                    A:73 X:00 Y:00 P:25 SP:F9 CYC:141 SL:128<br />CEA0  B1 LDA                                    A:73 X:00 Y:00 P:25 SP:F9 CYC:150 SL:128<br />CEA2  91 STA                                    A:19 X:00 Y:00 P:25 SP:F9 CYC:168 SL:128<br />CEA4  A5 LDA                                    A:19 X:00 Y:00 P:25 SP:F9 CYC:186 SL:128<br />CEA6  18 CLC                                    A:6E X:00 Y:00 P:25 SP:F9 CYC:195 SL:128<br />CEA7  69 ADC                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:201 SL:128<br />CEA9  85 STA                                    A:6F X:00 Y:00 P:24 SP:F9 CYC:207 SL:128<br />CEAB  A5 LDA                                    A:6F X:00 Y:00 P:24 SP:F9 CYC:216 SL:128<br />CEAD  69 ADC                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:225 SL:128<br />CEAF  85 STA                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:231 SL:128<br />CEB1  A5 LDA                                    A:A7 X:00 Y:00 P:A4 SP:F9 CYC:240 SL:128<br />CEB3  18 CLC                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:249 SL:128<br />CEB4  69 ADC                                    A:6E X:00 Y:00 P:24 SP:F9 CYC:255 SL:128<br />CEB6  85 STA                                    A:6F X:00 Y:00 P:24 SP:F9 CYC:261 SL:128<br />CEB8  A5 LDA                                    A:6F X:00 Y:00 P:24 SP:F9 CYC:270 SL:128<br />CEBA  69 ADC                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:279 SL:128<br />CEBC  85 STA                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:285 SL:128<br />CEBE  A5 LDA                                    A:80 X:00 Y:00 P:A4 SP:F9 CYC:294 SL:128<br />CEC0  38 SEC                                    A:33 X:00 Y:00 P:24 SP:F9 CYC:303 SL:128<br />CEC1  E9 SBC                                    A:33 X:00 Y:00 P:25 SP:F9 CYC:309 SL:128<br />CEC3  85 STA                                    A:32 X:00 Y:00 P:25 SP:F9 CYC:315 SL:128<br />CEC5  A5 LDA                                    A:32 X:00 Y:00 P:25 SP:F9 CYC:324 SL:128<br />CEC7  E9 SBC                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:333 SL:128<br />CEC9  85 STA                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:339 SL:128<br />CECB  05 ORA                                    A:61 X:00 Y:00 P:25 SP:F9 CYC:7 SL:129<br />CECD  D0 BNE                                    A:73 X:00 Y:00 P:25 SP:F9 CYC:16 SL:129<br />CEA0  B1 LDA                                    A:73 X:00 Y:00 P:25 SP:F9 CYC:25 SL:129<br />CEA2  91 STA                                    A:AC X:00 Y:00 P:A5 SP:F9 CYC:43 SL:129<br />CEA4  D2 Unknown                             A:AC X:00 Y:00 P:A5 SP:F9 CYC:61 SL:129<br /><br />The STA at CEA2 is the last of 5 writes to memory that causes $10 to be loaded into the control register. Through some debugging I can see that at that point the PRG Bank register has a value of 1 (00001).<br /><br />Based on what I know about MMC1 and the help given to me about 32K mode I believe this address should therefore map to the second 16k bank in the mapper (values 0 or 1 = banks 0 and 1 and this address is &gt; $BFFF so bank 1 is selected)<br /><br />Looking at the zelda 2 rom through a hex editor it would appear that the value at the address in question is indeed $D2 so I'm guessing that something has gone wrong before this point.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6555">matthewtatum</a> — Tue Jul 01, 2014 12:37 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[MottZilla]]></name></author>
<updated>2014-06-30T23:38:26-07:00</updated>
<published>2014-06-30T23:38:26-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130481#p130481</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130481#p130481"/>
<title type="html"><![CDATA[Re: MMC1 32k PRG mode]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11379&amp;p=130481#p130481"><![CDATA[
MMC1 can be confusing to deal with at first. You may need to recheck your work, or write a test ROM to be sure things are operating correctly. You also didn't mention, did you have a trace log of what happens leading up to the crash? Only knowing the last opcode and address attempted to be executed can make it hard to identify where things crashed. <br /><br />If you have an execution log that will help, or even if you maintained a moving log of the last 50 instructions executed and the addresses of those instructions could be helpful in figuring out where things went wrong. <br /><br />You may still be mapping memory wrong when it comes to the 32KB mode, or maybe it's a problem when things switch between 16KB and 32KB modes.<br /><br />If you update PRG pointers on MMC1 writes, you may have forgotten to update those pointers when the mode changes or when the MMC1 gets reset. If the mode changes you need to take the value that was last written to the PRG register and figure out what banks need to be mapped.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=1726">MottZilla</a> — Mon Jun 30, 2014 11:38 pm</p><hr />
]]></content>
</entry>
</feed>
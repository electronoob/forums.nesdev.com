<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Scripted mapper plugins</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Scripted mapper plugins" href="http://forums.nesdev.com/feed.php?f=3&amp;t=7757" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 11:24 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=7763">Scripted mapper plugins</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=7763"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 12 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=7763&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=7763&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=7763&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78299"></a>
				<b class="postauthor">Drag</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78299">Scripted mapper plugins</a></div><div style="float: right;"><a href="./viewtopic.php?p=78299#p78299"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 18, 2011 3:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:57 pm<br /><b>Posts:</b> 584
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The idea is that the functionality of any mapper can be implemented in the form of a script, used by the emulator. Of course, you'd be able to come up with some wildly unrealistic mappers, but that's aside the point.
<br />
<br />Anyway, we should play around with this idea to see if anything might come of it. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />
<br />
<br />I had the idea to set up breakpoint-like behavior. It seemed like it was efficient enough for code, but modular enough to not be hardcoded into the emulator (which is the whole point of this in the first place <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> ).
<br />
<br />For NROM,
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">on CPU_Read:8000,FFFF &#123;<br />&nbsp; PRG_Data = PRG_Space&#91;CPU_Addr&#93;;<br />&#125;<br /><br />on PPU_Read:0000,1FFF &#123;<br />&nbsp; CHR_Data = CHR_Space&#91;PPU_Addr&#93;;<br />&#125;<br />on PPU_Write:0000,1FFF &#123;<br />&nbsp; CHR_Space&#91;PPU_Addr&#93; = CHR_Data; // This does nothing if it's ROM.<br />&#125;<br /></div><br />PRG_Space is just the collection of bytes the CPU can have access to at any time, from any collection of ROMs on the cart. Basically, it's just a way to access the PRG section of the iNES rom.<br />CHR_Space is the same thing, but in this case, it can either be a ROM or RAM.<br />I didn't specify what happens for PPU accesses to 2000-2FFF. In that case, the emulator should just assume everything is completely hardwired and determine the behavior based on the appropriate iNES header flags. Additionally, the same could be done if you don't specify CPU 8000-FFFF accesses, and PPU 0000-1FFF accesses.<br /><br />Let's try CNROM:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">var bank &#91;= initial value on reset&#93;;<br /><br />on CPU_Write:8000,FFFF &#123;<br />&nbsp; bank = PRG_Data &lt;&lt; 13; // %bb..... ........<br />&#125;<br /><br />on CPU_Read:8000,FFFF &#123;<br />&nbsp; PRG_Data = PRG_Space&#91;CPU_Addr&#93;;<br />&#125;<br /><br />on PPU_Read:0000,1FFF &#123;<br />&nbsp; CHR_Data = CHR_Space&#91;bank | PPU_Addr&#93;; // bbppppp ppppppp<br />&#125;<br /></div><br />Now let's try AxROM, which has mapper-controlled mirroring, and PRG bankswitching.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">var bank;<br />var nametable;<br /><br />on CPU_Write:8000,FFFF &#123;<br />&nbsp; bank = &#40;PRG_Data &amp; 7&#41; &lt;&lt; 15; // %bb b....... ........<br />&nbsp; nametable = &#40;PRG_Data &amp; 0x10&#41; &lt;&lt; 6; // %n.. ........<br />&#125;<br /><br />on CPU_Read:8000,FFFF &#123;<br />&nbsp; PRG_Data = PRG_Space&#91;bank | CPU_Addr&#93;; // %bb bccccccc cccccccc<br />&#125;<br /><br />on PPU_Read:0000,1FFF &#123;<br />&nbsp; PPU_Data = PPU_Space&#91;PPU_Addr&#93;;<br />&#125;<br />on PPU_Write:0000,1FFF &#123;<br />&nbsp; PPU_Space&#91;PPU_Addr&#93; = PPU_Data;<br />&#125;<br />on PPU_Read:2000,2FFF &#123;<br />&nbsp; PPU_Data = CIRAM&#91;nametable | &#40;PPU_Addr % 0x3FF&#41;&#93;;<br />&#125;<br />on PPU_Write:2000,2FFF &#123;<br />&nbsp; CIRAM&#91;nametable | &#40;PPU_Addr % 0x3FF&#41;&#93; = PPU_Data;<br />&#125;<br /></div>
<br />
<br />There's a couple of kinks that would need to be ironed out, but I think this would be usable for describing mappers. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=21"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78300"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78300"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78300#p78300"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 18, 2011 3:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Could a mapper description like this be compiled into code that runs in the emulator using LLVM?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78301"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78301"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78301#p78301"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 18, 2011 3:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 517
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Of course, if someone wrote the compiler.
<br />
<br />I've always felt it'd be best to write the mapper emulation in 6502 code. Any NES emulator will already have a 6502 core ready, anyway. Just make a new CPU context, map all the cartridge pins to MMIO addresses, add some custom MMIO to it for common functionality, and have at it.
<br />
<br />For timing, easiest way would be to run at 'infinite' frequency, having an MMIO reg you can write to in order to 'tick' one cycle, clocked at the same rate as the NES CPU.
<br />
<br />Writing the code will be a bit harder, but will only ever need to be done once. Emulators can dynarec it to run faster if they want, but I doubt it would be all that demanding even on today's cell phones.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78308"></a>
				<b class="postauthor">Zelex</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78308"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78308#p78308"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 18, 2011 10:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Apr 29, 2011 9:44 pm<br /><b>Posts:</b> 97
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">try coding it in javascript <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4854"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78310"></a>
				<b class="postauthor">6T4</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78310"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78310#p78310"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 12:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 19, 2011 8:56 pm<br /><b>Posts:</b> 48
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent"> I've always felt it'd be best to write the mapper emulation in 6502 code. Any NES emulator will already have a 6502 core ready, anyway. Just make a new CPU context, map all the cartridge pins to MMIO addresses, add some custom MMIO to it for common functionality, and have at it. </div>
<br />Interesting idea, but I'll believe it when I see it. It's more work than current methods to time the CPUs correctly, and the emulator won't be able to run as fast since you'd have to run two CPUs at once. The only advantage I see is that any NES emulator could easily incorporate it if desired. But I don't really see any reason any NES emulator would want to. I respect your opinions as you are the author of a very good snes emulator, but I have questions to pose... did you code the snes coprocessor chips in bsnes using 65c816 assembly? If not, why not and are you considering doing this then?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4768"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78311"></a>
				<b class="postauthor">6T4</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78311">Put the code in the games</a></div><div style="float: right;"><a href="./viewtopic.php?p=78311#p78311"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 12:48 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 19, 2011 8:56 pm<br /><b>Posts:</b> 48
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">If we are going to make universal mapper scripts like this and use byuu's idea of writing them using 6502 assembly, why not put the scripts in the actual rom files. This is sort of my idea for a change in the header format. I mean, the real mappers exist on the game cartridges, not the NES itself, so doesn't it seem reasonable to design the emulation system like that as well? This would also do away with the need to CRC games to figure out which board of which mapper to use because the right script will be in the right game. We could also just write the scripts and have users put them into the games themselves. They'd just need to check a list to see which one to use.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4768"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78317"></a>
				<b class="postauthor">Hamburgler</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78317"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78317#p78317"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 5:20 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Jul 04, 2007 8:40 am<br /><b>Posts:</b> 36
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">LUA is a good choice for this kind of functionality.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3370"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78319"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78319"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78319#p78319"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 7:03 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I was going to rant about how Lua is interpreted, and an interpreter run once for each of the nearly 4.5 million fetches a second has to be slow. But then I discovered that a <a href="http://code.google.com/p/llvm-lua/" class="postlink">JIT engine for Lua based on LLVM</a> existed.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78330"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78330"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78330#p78330"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 11:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 517
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">6T4 wrote:</div><div class="quotecontent">the emulator won't be able to run as fast since you'd have to run two CPUs at once</div><br /><br />True, instead of a 100MHz machine, you'll need at least 150MHz. That may be a stretch for time travelers from 1989 :)<br /><br /><div class="quotetitle">6T4 wrote:</div><div class="quotecontent">did you code the snes coprocessor chips in bsnes using 65c816 assembly? If not, why not and are you considering doing this then?</div>
<br />
<br />SNES coprocessors are not mappers, they are actual processors that execute instructions given to them.
<br />
<br />Example: the NEC uPD772x family has four opcodes. Load, Jump, Op, and Op+Return. Op can do 10 math functions. Total code size? 10KB. That code emulates the DSP-1, DSP-1B, DSP-2, DSP-3, DSP-4, ST-0010, ST-0011. Count them all as one processor with different programs.
<br />
<br />SuperFX and SA-1 are similarly processors that execute instructions. S-DD1 and SPC7110 are decompression codecs, much like an MPEG decoder. S-RTC is a real-time clock. Cx4 and ST-0018 are just like the NEC uPD (the latter may even be an enhanced uPD): we are waiting on the chip PROM dumps. That only leaves the OBC1, which is indeed a simple mapper.
<br />
<br />So in total we have (four or) five unique processors, two codecs, one clock, one mapper. The SuperFX and SA-1 even accept external programs, meaning they are not fixed-function. The rest benefit greatly from executing internal PROMs to get proper timing. Since these PROMs exist, and we have them, why simulate when we can emulate?
<br />
<br />Now compare to the NES, where we have 100-200 mappers, and not a single emulator supports all of them. Also plenty of pirate carts that some emulators will rightly refuse to ever support. Almost all of the NES mappers are extremely simplistic, like GameBoy MBCs.
<br />
<br />Look at my processor core for the NEC uPD: I support seven unique special chips with one interpreter that loads separate PROMs. That is the analogue I am making to NES mappers.
<br />
<br />There are of course problematic NES mappers, like the MMC5 and VRC6/7. The most complicated may be best to implement on a per-emulator basis.
<br />
<br />The important part is that emulators already support a 6502 virtual machine. If you want a scripting language, they will have to support that language as well. Even if you use one with a nice OSS C library, that will rule out non-C/C++ NES emulators from using it. Scripting will be just as slow (possibly slower), than doing the same in 6502.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78337"></a>
				<b class="postauthor">Drag</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78337"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78337#p78337"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 1:05 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:57 pm<br /><b>Posts:</b> 584
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just as a test, here's my attempt to describe MMC1 in this notation:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">var shiftValue = 0; // Holds the shift register value<br />var bitCount = 0; // Counts how many bits have been written<br />var latch = 0; // Is set to shiftValue when it has 5 bits<br />var latchFull = 0; // Flag determining if the latch has just been loaded<br />var mirroring = 0; // mirroring behavior<br />var prgMode = 0; // PRG bank behavior<br />var chrMode = 0; // CHR bank behavior &#40;flag&#41;<br />var chrBankA = 0; // PPU $0000-0FFF or $0000-1FFF bank<br />var chrBankB = 0; // PPU $1000-1FFF bank<br />var prgBank = 0; // PRG bank<br />var ramDisabled = 0; // Flag determining if cart RAM is disabled<br /><br />// Evaluate the shift register behavior first.<br />on CPU_Write:8000,FFFF &#123;<br />&nbsp; if !&#40;PRG_Data &amp; 0x80&#41; &#123;<br />&nbsp; &nbsp; shiftValue = shiftValue &lt;&lt; 1;<br />&nbsp; &nbsp; shiftValue |= PRG_Data &amp; 1;<br />&nbsp; &nbsp; bitCount++;<br />&nbsp; &nbsp; if &#40;bitCount == 5&#41; &#123;<br />&nbsp; &nbsp; &nbsp; latch = shiftValue &amp; 0x1F;<br />&nbsp; &nbsp; &nbsp; bitCount = 0;<br />&nbsp; &nbsp; &nbsp; latchFull = 1;<br />&nbsp; &nbsp; &#125;<br />&nbsp; &#125; else &#123;<br />&nbsp; &nbsp; bitCount = 0;<br />&nbsp; &#125;<br />&#125;<br /><br />// Afterwards, check which address range was written to.<br />// The appropriate code only runs when the latch has been freshly loaded from<br />// the previous routine.<br /><br />on CPU_Write:8000,9FFF &#123; // Control register<br />&nbsp; if &#40;latchFull&#41; &#123;<br />&nbsp; &nbsp; latchFull = 0;<br />&nbsp; &nbsp; mirroring = latch &amp; 3;<br />&nbsp; &nbsp; prgMode = &#40;latch &gt;&gt; 2&#41; &amp; 3;<br />&nbsp; &nbsp; chrMode = latch &amp; 0x10; // Only need to know if this is zero or nonzero<br />&nbsp; &#125;<br />&#125;<br /><br />on CPU_Write:A000,BFFF &#123; // CHR Bank A &#40;0000-0FFF or 0000-1FFF&#41;<br />&nbsp; if &#40;latchFull&#41; &#123;<br />&nbsp; &nbsp; latchFull = 0;<br />&nbsp; &nbsp; chrBankA = latch &lt;&lt; 12; // %b bbbb.... ........<br />&nbsp; &#125;<br />&#125;<br /><br />on CPU_Write:C000,DFFF &#123; // CHR Bank B &#40;1000-1FFF&#41;<br />&nbsp; if &#40;latchFull&#41; &#123;<br />&nbsp; &nbsp; latchFull = 0;<br />&nbsp; &nbsp; chrBankB = latch &lt;&lt; 12; // %b bbbb.... ........<br />&nbsp; &#125;<br />&#125;<br /><br />on CPU_Write:E000,FFFF &#123; // PRG Bank &#40;8000-FFFF or 8000-BFFF or C000-FFFF&#41;<br />&nbsp; if &#40;latchFull&#41; &#123;<br />&nbsp; &nbsp; latchFull = 0;<br />&nbsp; &nbsp; prgBank = &#40;latch &amp; 0xF&#41; &lt;&lt; 14; // %bb bb...... ........<br />&nbsp; &nbsp; ramDisabled = latch &amp; 0x10; // Only need to know if this is zero or nonzero<br />&nbsp; &#125;<br />&#125;<br /><br />// Cart RAM<br />on CPU_Read:6000,7FFF &#123;<br />&nbsp; if !&#40;ramDisabled&#41; &#123;<br />&nbsp; &nbsp; PRG_Data = PRG_RAM_Space&#91;CPU_Addr &amp; 0x1FFF&#93;;<br />&nbsp; &#125;<br />&nbsp; // Assume open bus if PRG_Data isn't set during a read operation.<br />&#125;<br /><br /><br />// PRG Banks<br />on CPU_Read:8000,BFFF &#123;<br />&nbsp; switch &#40;prgMode&#41; &#123;<br />&nbsp; case 0: // PRG Bank 8000-FFFF, ignore lowest bit<br />&nbsp; case 1: // CPU_Addr will fill that in, actually<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;&#40;prgBank &amp; 0x38000&#41; | CPU_Addr&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 2: // PRG Bank 8000-BFFF<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;prgBank | &#40;CPU_Addr &amp; 0x3FFF&#41;&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 3: // 8000-BFFF fixed to first bank<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;CPU_Addr &amp; 0x3FFF&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on CPU_Read:C000,FFFF &#123;<br />&nbsp; switch &#40;prgMode&#41; &#123;<br />&nbsp; case 0: // PRG Bank 8000-FFFF, ignore lowest bit<br />&nbsp; case 1: // CPU_Addr will fill that in, actually<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;&#40;prgBank &amp; 0x38000&#41; | CPU_Addr&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 2: // C000-FFFF fixed to last bank<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;CPU_Addr | 0x3C000&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 3: // PRG Bank C000-FFFF<br />&nbsp; &nbsp; PRG_Data = PRG_Space&#91;prgBank | &#40;CPU_Addr &amp; 0x3FFF&#41;&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br /><br />// CHR Banks<br />on PPU_Read:0000,0FFF &#123;<br />&nbsp; if &#40;chrMode&#41; &#123; // nonzero == low bit considered<br />&nbsp; &nbsp; PPU_Data = PPU_Space&#91;chrBankA | &#40;PPU_Addr &amp; 0x0FFF&#41;&#93;;<br />&nbsp; &#125; else &#123; // zero == low bit ignored &#40;let PPU_Addr fill it in&#41;<br />&nbsp; &nbsp; PPU_Data = PPU_Space&#91;&#40;chrBankA &amp; 0x1E000&#41; | PPU_Addr&#93;;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:0000,0FFF &#123;<br />&nbsp; if &#40;chrMode&#41; &#123; // nonzero == low bit considered<br />&nbsp; &nbsp; PPU_Space&#91;chrBankA | &#40;PPU_Addr &amp; 0x0FFF&#41;&#93; = PPU_Data;<br />&nbsp; &#125; else &#123; // zero == low bit ignored &#40;let PPU_Addr fill it in&#41;<br />&nbsp; &nbsp; PPU_Space&#91;&#40;chrBankA &amp; 0x1E000&#41; | PPU_Addr&#93; = PPU_Data;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Read:1000,1FFF &#123;<br />&nbsp; if &#40;chrMode&#41; &#123; // nonzero == use chrBankB<br />&nbsp; &nbsp; PPU_Data = PPU_Space&#91;chrBankB | &#40;PPU_Addr &amp; 0x0FFF&#41;&#93;;<br />&nbsp; &#125; else &#123; // zero == use chrBankA and let PPU_Addr fill in low bit<br />&nbsp; &nbsp; PPU_Data = PPU_Space&#91;&#40;chrBankA &amp; 0x1E000&#41; | PPU_Addr&#93;;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:1000,1FFF &#123;<br />&nbsp; if &#40;chrMode&#41; &#123; // nonzero == use chrBankB<br />&nbsp; &nbsp; PPU_Space&#91;chrBankB | &#40;PPU_Addr &amp; 0x0FFF&#41;&#93; = PPU_Data;<br />&nbsp; &#125; else &#123; // zero == use chrBankA and let PPU_Addr fill in low bit<br />&nbsp; &nbsp; PPU_Space&#91;&#40;chrBankA &amp; 0x1E000&#41; | PPU_Addr&#93; = PPU_Data;<br />&nbsp; &#125;<br />&#125;<br /><br />// Nametable mirroring<br />on PPU_Read:2000,23FF &#123; // Upper Left<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 2: // Vertical<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;PPU_Addr &amp; 0x3FF&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:2000,23FF &#123; // Upper Left<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 2: // Vertical<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; CIRAM&#91;PPU_Addr &amp; 0x3FF&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; &nbsp; CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Read:2400,27FF &#123; // Upper Right<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;PPU_Addr &amp; 0x3FF&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 2: // Vertical<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:2400,27FF &#123; // Upper Right<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; CIRAM&#91;PPU_Addr &amp; 0x3FF&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 2: // Vertical<br />&nbsp; &nbsp; CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Read:2800,2BFF &#123; // Lower Left<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 2: // Vertical<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;PPU_Addr &amp; 0x3FF&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:2800,2BFF &#123; // Lower Left<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; case 2: // Vertical<br />&nbsp; &nbsp; CIRAM&#91;PPU_Addr &amp; 0x3FF&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Read:2C00,2FFF &#123; // Lower Right<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;PPU_Addr &amp; 0x3FF&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 2: // Vertical<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; PPU_Data = CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93;;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br />on PPU_Write:2C00,2FFF &#123; // Lower Right<br />&nbsp; switch &#40;mirroring&#41; &#123;<br />&nbsp; case 0: // 1 Screen A<br />&nbsp; &nbsp; CIRAM&#91;PPU_Addr &amp; 0x3FF&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; case 1: // 1 Screen B<br />&nbsp; case 2: // Vertical<br />&nbsp; case 3: // Horizontal<br />&nbsp; &nbsp; CIRAM&#91;&#40;PPU_Addr &amp; 0x3FF&#41; | 0x400&#93; = PPU_Data;<br />&nbsp; &nbsp; break;<br />&nbsp; &#125;<br />&#125;<br /></div>
<br />There may be a better way to handle the mirroring than to duplicate the routines for both reads and writes...
<br />
<br />Maybe a PPU_Access event which triggers on both reads and writes (with PPU_Data being ignored) can be used to set up an address variable, and then seperate PPU_Read and PPU_Write routines can commit data.
<br />
<br />Also, it's worth noting that PRG_Addr only describes A0-A14, since the cart edge doesn't get A15. Though, if that's too much of a problem, PRG_Addr can represent all 16 bits of the address.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=21"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p78347"></a>
				<b class="postauthor">kyuusaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78347"></a></div><div style="float: right;"><a href="./viewtopic.php?p=78347#p78347"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 4:01 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=20.png" width="75" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:13 pm<br /><b>Posts:</b> 1625<br /><b>Location:</b> .ma.us
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Any way this can be merged with all the other times it was talked about?
<br />
<br />I think it's another thing where everyone has their own implementation like the iNES successor.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=20"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p78348"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p78348">How about a ฿ounty?</a></div><div style="float: right;"><a href="./viewtopic.php?p=78348#p78348"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu May 19, 2011 4:18 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9046<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><strong>฿฿฿ MAKE MONEY FAST ฿฿฿</strong>
<br />
<br />The first to implement practical scriptable mapper support in a Free emulator that runs at real time on an Atom subnotebook PC will earn some Bitcoins.
<br />
<br />Anyway:
<br />Of course the cart edge gets A15; it's just delayed by a fraction of a cycle.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=7763"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=7763"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 12 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="7763" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
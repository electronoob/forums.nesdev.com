<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - SMB corrupted nametable at 0x2400</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">SMB corrupted nametable at 0x2400</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9625">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9625</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>caiiio</b> [ Wed Dec 19, 2012 5:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi All,<br /><br />I am trying to make SMB work, but I am having difficulties with the background. The nametable at 0x2400 seems to hold incorrect data. Please, take a look at the attached images - from the game start and the demo run. Any suggestions would be helpful.<br /><br />Thanks!

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="gensmall"><b>File comment:</b> demo run</span><br />
		
			<a href="./download/file.php?id=235&amp;mode=view"><img src="./download/file.php?id=235&amp;t=1" alt="demorunning.png" /></a><br />
			<span class="gensmall">demorunning.png [ 25.23 KiB | Viewed 597 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<span class="gensmall"><b>File comment:</b> game start</span><br />
		
			<a href="./download/file.php?id=234&amp;mode=view"><img src="./download/file.php?id=234&amp;t=1" alt="initial.png" /></a><br />
			<span class="gensmall">initial.png [ 27.14 KiB | Viewed 597 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Alegend45</b> [ Wed Dec 19, 2012 5:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Does your emulator fail any CPU tests? List which ones fail.<br /><br />EDIT: Just thought of something. Do you have correct mirroring for the nametables?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Thu Dec 20, 2012 4:01 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Alegend45 wrote:</div><div class="quotecontent">Do you have correct mirroring for the nametables?</div><br /><br />This.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>caiiio</b> [ Thu Dec 20, 2012 5:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The CPU seems to be fine. It passes the nestest tests (with cycle precision).<br /><br />The mirroring logic also seems fine to me. Here is a snippet<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">public class NameTableMirroring {<br />&nbsp; &nbsp;public enum NameTableIndex {<br />&nbsp; &nbsp;&nbsp; &nbsp;A,<br />&nbsp; &nbsp;&nbsp; &nbsp;B,<br />&nbsp; &nbsp;&nbsp; &nbsp;C,<br />&nbsp; &nbsp;&nbsp; &nbsp;D<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;public enum NameTableMirroringType {<br />&nbsp; &nbsp;&nbsp; &nbsp;HORIZONTAL,<br />&nbsp; &nbsp;&nbsp; &nbsp;VERTICAL,<br />&nbsp; &nbsp;&nbsp; &nbsp;ONE_SCREEN_A,<br />&nbsp; &nbsp;&nbsp; &nbsp;ONE_SCREEN_B,<br />&nbsp; &nbsp;&nbsp; &nbsp;FOUR_SCREEN<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;public static int getNameTableOffset(int address) {<br />&nbsp; &nbsp;&nbsp; &nbsp;if (0x2000 &lt;= address &amp;&amp; address &lt; 0x2400) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return address - 0x2000;<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2400 &lt;= address &amp;&amp; address &lt; 0x2800) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return address - 0x2400;<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2800 &lt;= address &amp;&amp; address &lt; 0x2C00) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return address - 0x2800;<br />&nbsp; &nbsp;&nbsp; &nbsp;} else { <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;assert (0x2C00 &lt;= address &amp;&amp; address &lt; 0x3000);<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return address - 0x2C00;<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;public static NameTableIndex getNameTableIndex(int address, NameTableMirroringType mirroringType) {<br />&nbsp; &nbsp;&nbsp; &nbsp;if (mirroringType == NameTableMirroringType.HORIZONTAL) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// Horizontal Mirroring: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2000, 0x23FF&#93; -&gt; NTA, &#91;0x2400, 0x27FF&#93; -&gt; NTA <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2800, 0x2BFF&#93; -&gt; NTB, &#91;0x2C00, 0x2FFF&#93; -&gt; NTB<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (0x2000 &lt;= address &amp;&amp; address &lt; 0x2400) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2400 &lt;= address &amp;&amp; address &lt; 0x2800) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2800 &lt;= address &amp;&amp; address &lt; 0x2C00) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else { <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;assert(0x2C00 &lt;= address &amp;&amp; address &lt; 0x3000);<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (mirroringType == NameTableMirroringType.VERTICAL) { <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// Vertical Mirroring: <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2000, 0x23FF&#93; -&gt; NTA, &#91;0x2400, 0x27FF&#93; -&gt; NTB <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2800, 0x2BFF&#93; -&gt; NTA, &#91;0x2C00, 0x2FFF&#93; -&gt; NTB<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (0x2000 &lt;= address &amp;&amp; address &lt; 0x2400) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2400 &lt;= address &amp;&amp; address &lt; 0x2800) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2800 &lt;= address &amp;&amp; address &lt; 0x2C00) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else { <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;assert(0x2C00 &lt;= address &amp;&amp; address &lt; 0x3000);<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (mirroringType == NameTableMirroringType.ONE_SCREEN_A) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// One Screen Mirroring: All address points to the same data.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2000, 0x23FF&#93; -&gt; NTA, &#91;0x2400, 0x27FF&#93; -&gt; NTA <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2800, 0x2BFF&#93; -&gt; NTA, &#91;0x2C00, 0x2FFF&#93; -&gt; NTA<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// Enabled by a mapper usually.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (mirroringType == NameTableMirroringType.ONE_SCREEN_B) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// One Screen Mirroring: All address points to the same data.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2000, 0x23FF&#93; -&gt; NTB, &#91;0x2400, 0x27FF&#93; -&gt; NTB <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2800, 0x2BFF&#93; -&gt; NTB, &#91;0x2C00, 0x2FFF&#93; -&gt; NTB<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// Enabled by a mapper usually.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;} else if (mirroringType == NameTableMirroringType.FOUR_SCREEN) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// 4 screen Mirroring: Each addresses have their own memory space.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// Enable by a mapper usually.<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2000, 0x23FF&#93; -&gt; NTA, &#91;0x2400, 0x27FF&#93; -&gt; NTB <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;// &#91;0x2800, 0x2BFF&#93; -&gt; NTC, &#91;0x2C00, 0x2FFF&#93; -&gt; NTD<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (0x2000 &lt;= address &amp;&amp; address &lt; 0x2400) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2400 &lt;= address &amp;&amp; address &lt; 0x2800) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.B;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else if (0x2800 &lt;= address &amp;&amp; address &lt; 0x2C00) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.C;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} else { <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;assert(0x2C00 &lt;= address &amp;&amp; address &lt; 0x3000);<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.D;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;// Keep compiler silent<br />&nbsp; &nbsp;&nbsp; &nbsp;return NameTableIndex.A;<br />&nbsp; &nbsp;}<br />}<br /></div><br /><br />ant the actual read and write to the name tables:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">@Override<br />&nbsp; &nbsp;public int readNameTable(int address, int&#91;&#93;&#91;&#93; extNTRAM) {<br />&nbsp; &nbsp;&nbsp; &nbsp;NameTableIndex nameTableIndex = NameTableMirroring.getNameTableIndex(<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;address, getNameTableMirroringType());<br />&nbsp; &nbsp;&nbsp; &nbsp;int nameTableOffset = NameTableMirroring.getNameTableOffset(address);<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;return readNameTable(nameTableIndex, nameTableOffset, extNTRAM);<br />&nbsp; &nbsp;}<br /><br />&nbsp; &nbsp;@Override<br />&nbsp; &nbsp;public void writeNameTable(int address, int value, int&#91;&#93;&#91;&#93; extNTRAM) {<br />&nbsp; &nbsp;&nbsp; &nbsp;NameTableIndex nameTableIndex = NameTableMirroring.getNameTableIndex(<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;address, getNameTableMirroringType());<br />&nbsp; &nbsp;&nbsp; &nbsp;int nameTableOffset = NameTableMirroring.getNameTableOffset(address);<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;writeNameTable(nameTableIndex, nameTableOffset, value, extNTRAM);<br />&nbsp; &nbsp;}<br /><br />&nbsp; &nbsp;protected NameTableMirroringType getNameTableMirroringType() {<br />&nbsp; &nbsp;&nbsp; &nbsp;return _cartridgeMirroringType;<br />&nbsp; &nbsp;}<br /><br />&nbsp; &nbsp;protected int readNameTable(NameTableIndex nameTableIndex,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nameTableOffset, int&#91;&#93;&#91;&#93; extNTRAM) {<br />&nbsp; &nbsp;&nbsp; &nbsp;switch (nameTableIndex) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case A: return extNTRAM&#91;0&#93;&#91;nameTableOffset&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case B: return extNTRAM&#91;1&#93;&#91;nameTableOffset&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case C: assert false; break; //TODO<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case D: assert false; break; //TODO<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;return 0;<br />&nbsp; &nbsp;}<br /><br />&nbsp; &nbsp;protected void writeNameTable(NameTableIndex nameTableIndex,<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;int nameTableOffset, int value, int&#91;&#93;&#91;&#93; extNTRAM) {<br />&nbsp; &nbsp;&nbsp; &nbsp;switch (nameTableIndex) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case A: extNTRAM&#91;0&#93;&#91;nameTableOffset&#93; = value;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case B: extNTRAM&#91;1&#93;&#91;nameTableOffset&#93; = value;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case C: assert false; break; //TODO<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case D: assert false; break; //TODO<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;}<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Alegend45</b> [ Thu Dec 20, 2012 6:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That looks relatively OK, but since the most bugs happen in scrolling, check your scrolling logic.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Quietust</b> [ Thu Dec 20, 2012 9:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />My first guess would be that you aren't properly delaying CHR/nametable reads through $2007, but that would have resulted in the titlescreen also being corrupted...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>crudelios</b> [ Thu Dec 20, 2012 11:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You seem to have a problem in your nametable mirrorring code. The game seems to be writing or reading to the same memory zone. <br /><br />Other than that, I don't really see anything wrong with your code, but I think you really should revise it. You go to China and back just to write/read a single byte! Right now, not only it is very hard to follow, but it will hurt your performance, and if you want some level of accuracy, you will need all the speed you can get...<br /><br />As an example, your    public static int getNameTableOffset(int address) could be rewritten as:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;public static int getNameTableOffset(int address) {<br />&nbsp; &nbsp; &nbsp; &nbsp; return (address &amp; 0x3FF);<br />&nbsp; &nbsp;}</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>caiiio</b> [ Thu Dec 20, 2012 12:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB corrupted nametable at 0x2400 [Solved]</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="codetitle"><b>Code:</b></div><div class="codecontent">protected void writeNameTable(NameTableIndex nameTableIndex,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int nameTableOffset, int value, int&#91;&#93;&#91;&#93; extNTRAM) {<br />&nbsp; &nbsp; &nbsp; switch (nameTableIndex) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case A: extNTRAM&#91;0&#93;&#91;nameTableOffset&#93; = value;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case B: extNTRAM&#91;1&#93;&#91;nameTableOffset&#93; = value;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case C: assert false; break; //TODO<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case D: assert false; break; //TODO<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp;}<br /></div><br /><br />Missing &quot;break;&quot; in the above routine ate my head (and caused NT overwrite). Damn. Thanks for the help.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
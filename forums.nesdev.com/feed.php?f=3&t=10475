<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=10475" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2013-10-11T04:02:49-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=10475</id>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2013-10-11T04:02:49-07:00</updated>
<published>2013-10-11T04:02:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=119203#p119203</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=119203#p119203"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=119203#p119203"><![CDATA[
To be honest this is a total waste of time blargg (respectfully).<br /><br />1. Hardly any games use illegal opcodes so coming across them is not only rare but also easy to cater for as they are nothing more than combinations of normal opcodes.<br />2. All illegal opcodes should already be emulated anyway as they exist on a real NES and <em>some</em> games do rely upon them.<br />3. They are well documented and as someone has already pointed out, there are many test ROMs in existence to assist with their testing.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Fri Oct 11, 2013 4:02 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dartht33bagger]]></name></author>
<updated>2013-09-12T00:22:54-07:00</updated>
<published>2013-09-12T00:22:54-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117949#p117949</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117949#p117949"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117949#p117949"><![CDATA[
This thread gave me the kick in the butt I needed to finally sit down and make a lookup table for instruction lengths and cycle numbers  <img src="http://forums.nesdev.com/images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3779">Dartht33bagger</a> — Thu Sep 12, 2013 12:22 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2013-09-11T13:58:17-07:00</updated>
<published>2013-09-11T13:58:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117923#p117923</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117923#p117923"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117923#p117923"><![CDATA[
For my page about the more useful instructions, I used the names in ca65's 6502X mode.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Wed Sep 11, 2013 1:58 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[ulfalizer]]></name></author>
<updated>2013-09-10T23:18:08-07:00</updated>
<published>2013-09-10T23:18:08-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117900#p117900</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117900#p117900"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117900#p117900"><![CDATA[
Yeah, agreed-upon names would've been nice. I have a mix of them from different sources in my implementation. <img src="http://forums.nesdev.com/images/smilies/icon_neutral.gif" alt=":|" title="Neutral" /><br /><br />TIck-by-tick execution is determined by the addressing mode for the unofficial instructions as well, so nothing complicated there. Some instructions have bus conflicts though: <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=3831&amp;start=30">viewtopic.php?f=3&amp;t=3831&amp;start=30</a><!-- l --> .<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5911">ulfalizer</a> — Tue Sep 10, 2013 11:18 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2013-09-10T20:15:42-07:00</updated>
<published>2013-09-10T20:15:42-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117889#p117889</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117889#p117889"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117889#p117889"><![CDATA[
I think their behavior differs on different implementations, since some have analog elements and are thus hard to pin down. People already use various names in assemblers and code, and each platform has its own distinct culture, so no chance at all of unifying names.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Tue Sep 10, 2013 8:15 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[byuu]]></name></author>
<updated>2013-09-10T19:50:06-07:00</updated>
<published>2013-09-10T19:50:06-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117888#p117888</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117888#p117888"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117888#p117888"><![CDATA[
This is definitely cool, thanks for making this.<br /><br />But what I'd really, <em>really</em> like to see is a truly comprehensive explanation of all unofficial instructions, and C code for how to implement them (at the cycle level), and <em>one name</em> for each of them.<br /><br />Every document is missing important information, and has different names for them. It would be great if we could all agree on a unified set of names and behavior details.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=375">byuu</a> — Tue Sep 10, 2013 7:50 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2013-09-09T09:23:17-07:00</updated>
<published>2013-09-09T09:23:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117777#p117777</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117777#p117777"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117777#p117777"><![CDATA[
I copied the table from my instruction timer, which apparently used 4 as a flag that it needed special handling (change-of-flow instruction).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Mon Sep 09, 2013 9:23 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[ulfalizer]]></name></author>
<updated>2013-09-09T07:34:47-07:00</updated>
<published>2013-09-09T07:34:47-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117775#p117775</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117775#p117775"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117775#p117775"><![CDATA[
Why are the instruction lengths for JSR and JMP Absolute set to 4 in that table by the way?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5911">ulfalizer</a> — Mon Sep 09, 2013 7:34 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[ulfalizer]]></name></author>
<updated>2013-09-09T07:19:26-07:00</updated>
<published>2013-09-09T07:19:26-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117774#p117774</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117774#p117774"/>
<title type="html"><![CDATA[Re: Unofficial opcodes are hard, let's go shopping]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117774#p117774"><![CDATA[
<div class="quotetitle">tepples wrote:</div><div class="quotecontent"><br /><div class="quotetitle">ulfalizer wrote:</div><div class="quotecontent">If an emulator encounters an unofficial instruction it's likely that it's either executing bad code or that the instruction is crucial for the code to work though, so not sure how helpful it would be to just skip over it.<br /></div><br />I was under the impression that <a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10473" class="postlink">the use case was procrastination</a>. Unofficial opcodes are hard, so one might choose not to implement any until all the official ones are perfect. Yet a lot of existing CPU test ROMs test the <a href="http://wiki.nesdev.com/w/index.php/Programming_with_unofficial_opcodes" class="postlink">useful unofficial opcodes</a> in addition to the official ones.<br /><br />It might also help with emulating systems using a 65C02, which I'm told does just skip unofficial opcodes according to their length. Platforms using 65C02 include Apple IIc and enhanced IIe as well as Atari Lynx. The HuC6280 in a TG16 is an extended 65C02 if I remember correctly.</div><br /><br />Yeah, sounds reasonable enough. Might've been a bit dismissive. <img src="http://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />The test ROMs I've come across allow you to test official instructions only, but could still be useful for implementing and testing only a subset of unofficial ones I guess.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5911">ulfalizer</a> — Mon Sep 09, 2013 7:19 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2013-09-09T07:01:27-07:00</updated>
<published>2013-09-09T07:01:27-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117772#p117772</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117772#p117772"/>
<title type="html"><![CDATA[Unofficial opcodes are hard, let's go shopping]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117772#p117772"><![CDATA[
<div class="quotetitle">ulfalizer wrote:</div><div class="quotecontent"><br />If an emulator encounters an unofficial instruction it's likely that it's either executing bad code or that the instruction is crucial for the code to work though, so not sure how helpful it would be to just skip over it.<br /></div><br />I was under the impression that <a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10473" class="postlink">the use case was procrastination</a>. Unofficial opcodes are hard, so one might choose not to implement any until all the official ones are perfect. Yet a lot of existing CPU test ROMs test the <a href="http://wiki.nesdev.com/w/index.php/Programming_with_unofficial_opcodes" class="postlink">useful unofficial opcodes</a> in addition to the official ones.<br /><br />It might also help with emulating systems using a 65C02, which I'm told does just skip unofficial opcodes according to their length. Platforms using 65C02 include Apple IIc and enhanced IIe as well as Atari Lynx. The HuC6280 in a TG16 is an extended 65C02 if I remember correctly.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Mon Sep 09, 2013 7:01 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[ulfalizer]]></name></author>
<updated>2013-09-09T05:09:49-07:00</updated>
<published>2013-09-09T05:09:49-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117770#p117770</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117770#p117770"/>
<title type="html"><![CDATA[Re: Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117770#p117770"><![CDATA[
I've seen GCC generate that lookup-table-in-integer approach for some switches. It's pretty neat.<br /><br />If an emulator encounters an unofficial instruction it's likely that it's either executing bad code or that the instruction is crucial for the code to work though, so not sure how helpful it would be to just skip over it.<br /><br />Lookup table would be fastest. Could make the entries uint8_t too to save some cache. Byte lookups should be as fast on x86 at least.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5911">ulfalizer</a> — Mon Sep 09, 2013 5:09 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[blargg]]></name></author>
<updated>2013-09-09T09:22:35-07:00</updated>
<published>2013-09-09T01:20:01-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117766#p117766</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117766#p117766"/>
<title type="html"><![CDATA[Techniques for skipping unofficial instructions]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=10475&amp;p=117766#p117766"><![CDATA[
It's useful for an emulator to at minimum skip the correct number of bytes when encountering unofficial instructions. Perhaps people could share some approaches. I'll start with the shortest code I could come up with. It assumes you've already read the opcode and advanced pc to the next byte.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pc += (0xA280414082444141 &gt;&gt; ((opcode &amp; 0x1F) * 2) &amp; 3) + ((opcode &amp; 0x9F) == 0x82);</div><br />There's also the table approach<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">static int const instr_lens &#91;256&#93; = { // lengths including opcode<br />   2,2,1,2,2,2,2,2,1,2,1,2,3,3,3,3,// 0<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// 1<br />   3,2,1,2,2,2,2,2,1,2,1,2,3,3,3,3,// 2<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// 3<br />   2,2,1,2,2,2,2,2,1,2,1,2,3,3,3,3,// 4<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// 5<br />   3,2,1,2,2,2,2,2,1,2,1,2,3,3,3,3,// 6<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// 7<br />   2,2,2,2,2,2,2,2,1,2,1,2,3,3,3,3,// 8<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// 9<br />   2,2,2,2,2,2,2,2,1,2,1,2,3,3,3,3,// A<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// B<br />   2,2,2,2,2,2,2,2,1,2,1,2,3,3,3,3,// C<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// D<br />   2,2,2,2,2,2,2,2,1,2,1,2,3,3,3,3,// E<br />   2,2,1,2,2,2,2,2,1,3,1,3,3,3,3,3,// F<br />};<br /><br />pc += instr_lens &#91;opcode&#93; - 1;</div><br /><br />EDIT: fixed JSR/JMP lens<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=17">blargg</a> — Mon Sep 09, 2013 1:20 am</p><hr />
]]></content>
</entry>
</feed>
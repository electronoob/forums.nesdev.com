<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - SMB1 + SMB2J SRAM Plus (FDS hack)</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">SMB1 + SMB2J SRAM Plus (FDS hack)</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=11576">http://forums.nesdev.com/viewtopic.php?f=22&amp;t=11576</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>10</strong> of <strong>12</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>8bitMicroGuy</b> [ Thu Apr 02, 2015 9:23 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The checksum utility doesn't support CRC16 anymore! What now?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Thu Apr 02, 2015 9:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">8bitMicroGuy wrote:</div><div class="quotecontent">The checksum utility doesn't support CRC16 anymore! What now?</div><br /><br /><br />Would you like an older build of it from my library which contains CRC16? I can upload it if you'd like. It seems that the newer builds remove it in place of CRC64, as well as other features.  --ShaneM, the Master of ASM<br /><br />EDIT: If you prefer not to use an earlier build, I recommend using my hex editor of choice, <a href="http://www.hhdsoftware.com/hex-editor/compare" class="postlink">Hex Editor Neo</a>. It has a powerful disassembler/assembler as well as checksum algorithms. It's not free, but the Ultimate edition (the one I use) has a checksum utility. <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Checksum Calculation<br /><br />Hex Editor Neo supports more than 20 checksum calculation algorithms, including MD5, SHA-1, CRC-16, CRC-32 and others. Custom CRC algorithm is also provided. You can compute the checksum for the whole file or for the current (multiple) selection. Several checksums may be computed at the same time in parallel. Results are easily exportable and copyable to the Clipboard.<br /></div><br /><br />It can also be used to edit video files that are 4GB etc. Something I've used it for in the past. The Ultimate edition can also be paid for with lifetime upgrades for only $120 USD.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>8bitMicroGuy</b> [ Thu Apr 02, 2015 11:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nevermind, it worked for me. But for some reason, I don't see the color changes of the levels like on the pictures. I came on both games to 2-1 and still no flying leaves or whatever it is or pallette changes other than of the original SMB. Except for Mario's new pallette and lava in underground.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Thu Apr 02, 2015 12:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">8bitMicroGuy wrote:</div><div class="quotecontent">Nevermind, it worked for me. But for some reason, I don't see the color changes of the levels like on the pictures. I came on both games to 2-1 and still no flying leaves or whatever it is or pallette changes other than of the original SMB. Except for Mario's new pallette and lava in underground.</div><br /><br /><br />Did you patch it to the right SMB2J headerless ROM of CRC16 BA55? The wind first appears on 5-3 of SMB1 and 5-1 of SMB2J. The stage with the palette change is 8-2, if I understand you correctly. If I misunderstood what you mean, can you please clarify? Thank you for responding and taking the time to try my game. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  --ShaneM, the Master of ASM<br /><br />EDIT: Do you mean that you'd like the wind to have the red texture of SMAS?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Fri Apr 03, 2015 6:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">ShaneM wrote:</div><div class="quotecontent"><br />EDIT: Do you mean that you'd like the wind to have the red texture of SMAS?</div><br /><br />I was inspired to try it....What do you all think? I ripped the leaves straight from the SNES SMAS version and recolored it accordingly. Thoughts?  --ShaneM, the Master of ASM

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2967" alt="Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_011.png" /><br />
			<span class="gensmall">Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_011.png [ 3.77 KiB | Viewed 4735 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2966" alt="Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_010.png" /><br />
			<span class="gensmall">Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_010.png [ 3.85 KiB | Viewed 4735 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Fri Apr 03, 2015 9:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I had the leaves upside down before. Turns out that the SMAS does this for some odd reason. I'm not sure if the routine in that version uses more frames or not. But here it is NESized to it's fullest potential. I'm also attaching an SMAS shot to be compared. This build will be v1.2 and released along with the game manual and custom Nestopia build, soon.  --Shanem, the Master of ASM<br /><br /><br />EDIT: Here's one of 5-1, in case A-3 is hard to see.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2970" alt="Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_012.png" /><br />
			<span class="gensmall">Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_012.png [ 3.95 KiB | Viewed 4706 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2969" alt="Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy - Copy_002.png" /><br />
			<span class="gensmall">Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy - Copy_002.png [ 3.65 KiB | Viewed 4712 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<a href="./download/file.php?id=2968&amp;mode=view"><img src="./download/file.php?id=2968&amp;t=1" alt="hqdefault.jpg" /></a><br />
			<span class="gensmall">hqdefault.jpg [ 13.67 KiB | Viewed 4712 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Fri Apr 03, 2015 9:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm doing one more post for now comparing the pics of the original with the SMAS revamp. I'm doing this rather than editing my last post because I can only have 3 pictures per post and it wouldn't let me do more (I don't feel like signing into Photobucket and logging on using FB and all that now, since this would be quicker).  Also, I know that my blue is lighter because I assigned snowy stages a lighter blue and white on the ground to represent snow.<br /><br />Sorry for posting a few minutes after the last one.  --ShaneM, the Master of ASM

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2972" alt="Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_013.png" /><br />
			<span class="gensmall">Super Mario Bros. 1&amp;2 SRAM Plus (Japan) - Copy_013.png [ 4.15 KiB | Viewed 4703 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2971" alt="Original color.png" /><br />
			<span class="gensmall">Original color.png [ 3.49 KiB | Viewed 4703 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Sun Apr 05, 2015 7:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've done something pretty cool. I was able to attribute both water and lava underground. It took me many hours to optimize some code to make room and I created a hardcoded routine to do this. Now, there's both! The way I see it is, the developers first wanted water underground, but then during the SNES era they decided to change it to lava. But they wanted to keep the water at the beginning but weren't able to keep both due to limitations by the coders, so they just left it blank at the beginning. I've fixed this for the first time.<br /><br />Below are pics of my fix (to be released in the next build).  --ShaneM, the Master of ASM

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2985" alt="testeres - Copy (3)_001.png" /><br />
			<span class="gensmall">testeres - Copy (3)_001.png [ 2.43 KiB | Viewed 4656 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<img src="./download/file.php?id=2984" alt="testeres - Copy (3)_002.png" /><br />
			<span class="gensmall">testeres - Copy (3)_002.png [ 2.88 KiB | Viewed 4656 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Apr 05, 2015 7:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It looks like polluted water to me, but that's equally useful.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Drew Sebastino</b> [ Sun Apr 05, 2015 7:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Looks like blood to me. Lava produces its own light, so even if it were in a dark place, it would still be bright.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Sun Apr 05, 2015 7:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">It looks like polluted water to me, but that's equally useful.</div><br /><br /><div class="quotetitle">Espozo wrote:</div><div class="quotecontent">Looks like blood to me. Lava produces its own light, so even if it were in a dark place, it would still be bright.</div><br /><br />I'm not sure if these are complements or not; point is, I used the Accumulator to load the palettes so that can easily be changed. Though I used the original underground water palette ($22) as well as the lava palette used in castles ($06). So I'm not sure what to say. The lava has been the same color as all previous builds.  --ShaneM, the Master of ASM

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Mon Apr 06, 2015 9:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm uploading images of both the original FDS and SNES versions so that people can compare them. --ShaneM, the Master of ASM

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<a href="./download/file.php?id=2988&amp;mode=view"><img src="./download/file.php?id=2988&amp;t=1" alt="SuperMarioBros2jMap1-2.png" /></a><br />
			<span class="gensmall">SuperMarioBros2jMap1-2.png [ 28.73 KiB | Viewed 4597 times ]</span>
		

		<br />
	</td>
				</tr>
			
				<tr>
					<td>
			<a href="./download/file.php?id=2987&amp;mode=view"><img src="./download/file.php?id=2987&amp;t=1" alt="1-2.png" /></a><br />
			<span class="gensmall">1-2.png [ 65.15 KiB | Viewed 4597 times ]</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Mon Apr 06, 2015 1:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here's my code for creating both lava and water underground. I figured there are some hackers here who would appreciate this but may be lacking in ASM knowledge. Since I did all the work for you, if you want to use it, simply credit me. The 16 bit addresses would need to be changed depending on where they are found in your PRG.  --ShaneM, the Master of ASM<br /><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SetBGColor:&nbsp; &nbsp; lda BackgroundColors,y&nbsp; &nbsp;;to background color instead<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+3,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$3f&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;set for sprite palette address<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1,x&nbsp; &nbsp; &nbsp; &nbsp;;save to buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$10<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+1,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;write length byte to buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+2,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;now the null terminator<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+7,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;txa&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;move the buffer pointer ahead 7 bytes<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;in case we want to write anything else later<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;adc #$07<br />SetVRAMOffset: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1_Offset&nbsp; ;store as new vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda $0750&nbsp; &nbsp; &nbsp; ;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp #$c1&nbsp; &nbsp; &nbsp; &nbsp; ;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beq newlabel&nbsp; &nbsp; ;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmp #$21&nbsp; &nbsp; &nbsp; ;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beq label3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$22&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bne label&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;SHANEM CODE<br />newlabel: lda #$06&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;;;;SHANEM CODE<br />label:&nbsp; &nbsp; &nbsp; &nbsp;sta $6be2&nbsp; &nbsp; &nbsp; &nbsp; ;;;;;SHANEM CODE you'll need to change this address<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beq label4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;;SHANEM CODE<br />label3:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;;;;;;;;;;;;;;;SHANEM CODE<br />label4: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta $84e2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;;;;SHANEM CODE you'll need to change this address<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rts</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Hamtaro126</b> [ Mon Apr 06, 2015 10:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Can you add this fix:<br /><br />May need more adjustments for your hack<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">WriteGameText:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pha&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;save text number to stack<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;asl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;multiply by 2 and use as offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cpy #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if set to do top status bar or world/lives display,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bcc LdGameText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;branch to use current offset as-is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cpy #$08&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if set to do time-up or game over,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bcc Chk2Players&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;branch to check players<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldy #$08&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;otherwise warp zone, therefore set offset<br />Chk2Players:&nbsp; &nbsp;lda NumberOfPlayers&nbsp; &nbsp; &nbsp; ;check for number of players<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne LdGameText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;if there are two, use current offset to also print name<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;otherwise increment offset by one to not print name<br />LdGameText:&nbsp; &nbsp; ldx GameTextOffsets,y&nbsp; &nbsp; ;get offset to message we want to print<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldy #$00<br />GameTextLoop:&nbsp; lda GameText,x&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;load message data<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp #$ff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;check for terminator<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;beq EndGameText&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;branch to end text if found<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1,y&nbsp; &nbsp; &nbsp; &nbsp;;otherwise write data to buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inx&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;and increment increment<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne GameTextLoop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;do this for 256 bytes if no terminator found<br />EndGameText:&nbsp; &nbsp;lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;put null terminator at end<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1,y<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pla&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;pull original text number from stack<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;are we printing warp zone?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bcs PrintWarpZoneNumbers<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dex&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;are we printing the world/lives display?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne CheckPlayerName&nbsp; &nbsp; &nbsp; ;if not, branch to check player's name<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;H126 Fix (Credit: Southbird) - Jump to Lives Fix<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jsr PutLives&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;otherwise, check number of lives<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldy WorldNumber&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;write world and level numbers (incremented for display)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;to the buffer in the spaces surrounding the dash<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sty VRAM_Buffer1+19<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldy LevelNumber<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iny<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sty VRAM_Buffer1+21&nbsp; &nbsp; &nbsp; ;we're done here<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rts<br /><br />;H126 Fix (Extra Credit: Southbird) - Lives Fix<br />;Original thanks to Southbird, Based off the SMB3 disassembly!<br /><br />PutLives:<br />&nbsp; &nbsp;ldy #$00&nbsp; &nbsp;&nbsp; ; init Y to 0<br />&nbsp; &nbsp;lda NumberofLives ; lives counter<br />&nbsp; &nbsp;cmp #$ff&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;bne ChkLivesCap&nbsp; &nbsp;; branch to check lives cap<br /><br />&nbsp; &nbsp;; if lives counter is not -1 (255), then:<br />&nbsp; &nbsp;lda #$24&nbsp; &nbsp;&nbsp; ; blank tile<br />&nbsp; &nbsp;jmp StoreLo&nbsp; &nbsp;&nbsp; ; branch<br /><br />ChkLivesCap:<br />&nbsp; &nbsp;cmp #100<br />&nbsp; &nbsp;bmi Under100&nbsp; &nbsp;&nbsp; ; If Player's lives are under 100, jump<br /><br />&nbsp; &nbsp;lda #99<br />&nbsp; &nbsp;sta NumberofLives ; else, cap at 99 lives<br /><br />Under100:<br />&nbsp; &nbsp;; now loop while A is more than 10!<br />&nbsp; &nbsp;cmp #10<br />&nbsp; &nbsp;bmi StoreLo<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc #10&nbsp; &nbsp;&nbsp; &nbsp; ; A -= 10<br />&nbsp; &nbsp;iny&nbsp; &nbsp;&nbsp; &nbsp; ; Y++<br />&nbsp; &nbsp;jmp Under100&nbsp; &nbsp; ; loop!<br /><br />StoreLo:<br />&nbsp; &nbsp;sta VRAM_Buffer1+8&nbsp; &nbsp;; store into low byte<br />&nbsp; &nbsp;tya&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;; most significant digit is now transferred to A<br />&nbsp; &nbsp;bne StoreHi&nbsp; &nbsp;&nbsp; &nbsp;; if it's anything but zero, jump<br />&nbsp; &nbsp;lda #$24&nbsp; &nbsp; &nbsp; &nbsp;; else use blank tile<br />StoreHi:<br />&nbsp; &nbsp;sta VRAM_Buffer1+7&nbsp; &nbsp;; store into high byte<br />&nbsp; &nbsp;rts&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; ; return<br /></div><br /><br />Also requires removal of the Golden Crown attributes, because it should be unused!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ShaneM</b> [ Tue Apr 07, 2015 7:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: SMB1 + SMB2J SRAM Plus (FDS hack)</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Hamtaro126 wrote:</div><div class="quotecontent">Can you add this fix:<br /><br />May need more adjustments for your hack<br /></div><br /><br />While I appreciate the suggestion, I must point out that I've already corrected this issue around September of last year: <a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=11576&amp;start=15&amp;sid=7b70b81290a88db6e267b9ebef19c6eb&amp;sid=7b70b81290a88db6e267b9ebef19c6eb#p133981" class="postlink">Here</a><br /><br />It's obvious that the game designers intended the crown to be used after attaining 9 lives rather than setting it up that way. Crown9 lives, or simply 19 was the implied max until I officially corrected it. A game like SMB1/SMB2J would never even need more lives than that to complete the game let alone in the 100. While I appreciate the gesture I must kindly decline from this. But if you think of anymore ideas be sure to share them. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />@Everyone<br />There was a slight oversight in my code yesterday as I overlooked the fact that one of the byte locations I changed yesterday was not always-loaded. I had to fix that and it required 5 additional bytes...bytes I didn't have. So what I'm going to do is share the fix, as well as a new method I found for optimizing code on SMBTLL/SMB1. First, my fixed code:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">SetBGColor:&nbsp; &nbsp; lda BackgroundColors,y&nbsp; &nbsp;;to background color instead<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+3,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$3f&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;set for sprite palette address<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1,x&nbsp; &nbsp; &nbsp; &nbsp;;save to buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$10<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+1,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;write length byte to buffer<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+2,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;now the null terminator<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1+7,x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;txa&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;move the buffer pointer ahead 7 bytes<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;in case we want to write anything else later<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;adc #$07<br />SetVRAMOffset: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta VRAM_Buffer1_Offset&nbsp; ;store as new vram buffer offset<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda SecondaryHardMode&nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne label5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda areapointer&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmp #$b9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;beq label3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bmi newlabel&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$06&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bne label&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />newlabel: lda #$22&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;SHANEM CODE<br />label:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta $6be2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;SHANEM CODE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;beq label4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;SHANEM CODE<br />label3:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lda #$04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;SHANEM CODE<br />label4: <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sta $d032&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;;;;;;;;;;;;;SHANEM CODE<br />label5: rts</div><br /><br />I'll share what I changed as well as how I attained the 5 bytes. I changed the &quot;CMP #$C1, BEQ newlabel&quot; to simply &quot;bmi newlabel&quot;. This saved me 2 bytes and has the same function. I then moved the &quot;cmp #$21, beq label3&quot; before the bmi and changed it to &quot;cmp #$B9, beq label3&quot;. I know that this would set flag N, too, but I specifically needed to do this. The &quot;lda SecondaryHardMode, bne label5&quot; is what fixed the always-loaded issue. Since this routine is always-loaded, it affects ROM when Worlds greater than 4 are loaded. Secondary Hard Mode is only set after World 4-4, so this fixes that issue and simply RTSs if on a later World thereby solving the issue. I did a BNE because if it's over World 4-4, then the flag is set to 1.<br /><br />Now, how I optimized code to attain the other three bytes (and this method can be used to save me many more bytes if I need them in the future; you have to be extremely careful when doing this and really trace the routines to make sure it's safe):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;codes in the ares of what I was working with<br />SetupIntermediate:<br />&nbsp; &nbsp; &nbsp; lda BackgroundColorCtrl&nbsp; ;save current background color control<br />&nbsp; &nbsp; &nbsp; pha&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;and player status to stack<br />&nbsp; &nbsp; &nbsp; lda PlayerStatus<br />&nbsp; &nbsp; &nbsp; pha<br />&nbsp; &nbsp; &nbsp; lda #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;set background color to black<br />&nbsp; &nbsp; &nbsp; sta PlayerStatus&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;and player status to not fiery<br />&nbsp; &nbsp; &nbsp; lda #$02&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;this is the ONLY time background color control<br />&nbsp; &nbsp; &nbsp; sta BackgroundColorCtrl&nbsp; ;is set to less than 4<br />&nbsp; &nbsp; &nbsp; jsr GetPlayerColors<br />&nbsp; &nbsp; &nbsp; pla&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;set up colors for intermediate lives display<br />&nbsp; &nbsp; &nbsp; sta PlayerStatus<br />&nbsp; &nbsp; &nbsp; pla&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;return bg color control and player status<br />&nbsp; &nbsp; &nbsp; sta BackgroundColorCtrl<br />&nbsp; &nbsp; &nbsp; jmp IncSubtask&nbsp; &nbsp; ;x bne&nbsp; &nbsp; &nbsp; &nbsp;;then move onto the next task<br /><br />GetAreaPalette:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldy AreaType&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;select appropriate palette to load<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ldx AreaPalette,y&nbsp; &nbsp; &nbsp; &nbsp; ;based on area type<br />SetVRAMAddr_A: stx VRAM_Buffer_AddrCtrl ;store offset into buffer control<br />NextSubtask:&nbsp; &nbsp;jmp IncSubtask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;move onto next task<br /></div><br /><br />See the two &quot;jmp IncSubtask&quot; right after each routine? For the one in &quot;SetupIntermediate:&quot; Change that to BNE NextSubtask to the &quot;jmp IncSubTask&quot; in the following routine &quot;GetAreaPalette:&quot;. See that? saved me another byte. I was able to do this for 3 bytes in the area, including the SetVRAMAddr_A above (something JMP'd to it earlier locally within Memory). It works because we see that &quot;BackgroundColorCtrl&quot; will always be greater than 0 (says so in the note, too that #$02 is as low as it gets), so this will always be an unconditional branch. In the 6502, whatever was last pushed onto the stack will be pulled first, hence this will be pulled afterwards. Branching is similar to a JMP except it's local (meaning that it can jump anywhere within Memory locally if the right condition is met...it can jump up to $7F signed or unsigned in Memory from its location). In cases like this, you can do that but you have to be careful that it will <em>always</em> be unconditional if you are replacing a JMP.  --ShaneM, the Master of ASM<br /><br />EDIT: I wish I had STZ to work with. (Also be sure to take advantage of LSR and ASL when you can as axe code calls for #$01 in A followed by an #$02, many many cases where these two can work.)

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>10</strong> of <strong>12</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Fixing ROMs for EMS 64 GB Smart Card USB</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Fixing ROMs for EMS 64 GB Smart Card USB</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=20&amp;t=5804">http://forums.nesdev.com/viewtopic.php?f=20&amp;t=5804</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>7</strong> of <strong>19</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>scannerboy1</b> [ Tue Feb 21, 2012 5:23 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />yep other are fine. Didnt bother to contact you directly because it isnt a game breaker. Just thought it would be a good idea to mention it

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>arromdee</b> [ Fri May 04, 2012 9:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Was there ever a fix for Oracle of Ages?  (And if so, would it apply to all versions?)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Fri May 04, 2012 10:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I didn't know it was broken. I don't think anyone posted a fix. I may fix it sometime in the future as I may want to play through the game myself. But if you can give any details on when it crashes or how that would help.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>arromdee</b> [ Sun Sep 09, 2012 5:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />pradeo mentioned Oracle of Ages as broken on page 5 of this thread.  I haven't yet played it myself.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>nitro2k01</b> [ Mon Sep 17, 2012 4:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re:</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">I can't imagine why they didn't give the &quot;master registers&quot; a protection control so that once a game is launched the game can't effectively kill itself.</div><br />That would have killed the feature that many of these flash cards had, at least in the GBA era, to patch a game to reset to the menu upon a specific key combination.</div>I'm looking at the code MottZilla posted, and it what it seems to do is write some value into a 256 byte area. Which value and which area, I don't know since I don't have the DKL3 ROM, and that part of the code isn't included in the post.<br /><br />However, that's a fairly simplistic strategy which probably only targets a specific brand of flash cartridge. I believe the EMS cartridges, (both 32M and 64M) and others as well, are using a more intricate sequence, that you won't be able to enter &quot;by accident&quot;. <br /><br />EMS carts in particular, don't offer a &quot;lockout mode&quot; as far as I'm aware, but do offer good MBC1-3 emulation, if I remember what I saw last time I looked at this, correctly. However, this needs to e set up. Trying writing multiple ROMs to the cartridge, so the program flashes the menu ROM which will hopefully do this.<br /><br />A &quot;return to menu&quot; function would be fully possible on an EMS cart or another cart with multi ROM functionality, given that the ROMs are patched before they're flashed to the cartridge. I've done a proof of concept of this myself, but I don't know any examples of this in the wild.<br /><br />I need to look at these things again!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>reprep</b> [ Mon Oct 22, 2012 6:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi <br /><br />First of all thanks for the patches. They are the reason why i registered on this site. It is great to see that people are still hacking/developing things on gameboy. <br /><br />I found a new buggy game (i assume it is something to do with emulating mappers). The game is &quot;Pok√©mon Card GB2: Here Comes Team GR!&quot;. It was released only in japanese. Lately a fully working english translation patch is out. Unfortunately neither the vanilla rom or the patched rom works on EMS 64 MB usb cart. You can see the intro select your gender etc. But at the map scene where team rocket steals the carts from various places the screen flashes and stays white with a buzzing sound. After the reset the game sees the save but crashes at the same place regardless. Patched or non-patched it crashes at the exact place (3rd place on the map where team rocket steals carts)<br /><br />Is there a spesific way that i understand this problem is because of the mappers? I have tried various roms and the ones which are goodgba and confirmed but always the same result.<br /><br />thanks

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue Oct 23, 2012 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The game probably purposefully (or maybe not) writes to the Master Bank registers and causes the game to crash. It may be fixable.<br /><br />Clarify when it crashes for me, does the game crash after the intro sequence where a blimp does some beam thing on 3 or 4 points on a map screen? Because after that I detected a write that may crash the GB SmartCard. Looks fixable.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>reprep</b> [ Tue Oct 23, 2012 1:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">The game probably purposefully (or maybe not) writes to the Master Bank registers and causes the game to crash. It may be fixable.<br /><br />Clarify when it crashes for me, does the game crash after the intro sequence where a blimp does some beam thing on 3 or 4 points on a map screen? Because after that I detected a write that may crash the GB SmartCard. Looks fixable.</div><br /><br />yes that is exactly the place where it crashes, the 3rd place on the map where that thing beams the places. thanks for the concern.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue Oct 23, 2012 6:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It looks like it may be on purpose. Try this IPS patch. I don't know if just patching it out to remove it will work. It may require a more complex fix. But it might work with just this. I attached an IPS file. I think the GBC Donkey Kong Land 3 similarly has just an opcode to purposefully try to crash these kinds of carts that once removed made everything work fine. I can't recall though.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=100">Pokemon Card GB2 fix.zip</a> [174 Bytes]
			</span><br />
			<span class="gensmall">Downloaded 33 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>reprep</b> [ Wed Oct 24, 2012 2:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">MottZilla wrote:</div><div class="quotecontent">It looks like it may be on purpose. Try this IPS patch. I don't know if just patching it out to remove it will work. It may require a more complex fix. But it might work with just this. I attached an IPS file. I think the GBC Donkey Kong Land 3 similarly has just an opcode to purposefully try to crash these kinds of carts that once removed made everything work fine. I can't recall though.</div><br /><br />Thanks for the patch. it works (but partially unfortunately). The game didn't crash at the 3 rd place on the map like before. A guy begins to talk says he is from team rocket etc. After a few line of text, the game crashes again just like before with a white screen and buzzing sound. so i guess the game makes multiple checks, i hope it is just through the beginning not through the whole game.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Oct 24, 2012 9:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well like I said, I just removed the writes that seemed to always trash the MBR. It's possible the writes *sometimes* trash the MBR and other times actually write somewhere meaningful to prevent just patching out the write. The next step would be to patch the program to verify that the write is going somewhere other than the MBR area and allow the write if it won't trash the MBR. Some of my other fixes work like this. <br /><br />Basically in this game register DE determines an address to be written to which often targets the MBR (Master Bank Registers) area for the SmartCard and writing there will trash the correct settings and cause the program to crash. So what needs to happen is before writing to the address specified by DE, it should be compared to see if it is in the MBR area and if so, ignore the write. If it is not in the MBR area then let the write occur. <br /><br />Doing that should fix the game unless another point in the game is writing to the MBR area. When I get a chance I'll see about writing a patch for it unless someone else does it first.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>reprep</b> [ Thu Oct 25, 2012 12:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />thanks for the explanatory post. As i am not able to code, i will have to wait for it. I am in no hurry. Thanks in advance.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Mon Oct 29, 2012 6:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Try this one out. I didn't test it much but it seems to work better.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=112">Pokemon Card GB2 fix.zip</a> [188 Bytes]
			</span><br />
			<span class="gensmall">Downloaded 30 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>reprep</b> [ Tue Oct 30, 2012 10:23 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />thanks for the patch. i played the game for about half an hour (a few duels) and no problem so far. i will post back if i find an issue in the later stages of the game.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Oct 31, 2012 11:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How to Fix ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm glad it's working so far. Hopefully it holds up. If it does, if you can complete the game, I'll add it to my set of fixes.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>7</strong> of <strong>19</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
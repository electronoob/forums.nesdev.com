<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - I made a DTE text compressor!</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">I made a DTE text compressor!</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=5677">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=5677</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CartCollector</b> [ Mon Oct 26, 2009 10:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>I made a DTE text compressor!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />EDIT: Version 1.5 released! Click the download link in this post to get it.
<br />
<br />Here's the <a href="http://www.mediafire.com/?z5iyjlhkuoq" class="postlink">download link.</a> Instructions on how to use it are in the download.
<br />
<br />I've done some tests with it (15 books in US-ASCII format from <!-- w --><a class="postlink" href="http://www.gutenberg.org">www.gutenberg.org</a><!-- w -->), and the average compressed file / original file ratio is about 54.3%. So that means you should be able to store about 1.84 times the amount of text that you would be able to store uncompressed for a given file size. For instance, if you have 8k available for text, this compressor would make it so that you could compress about 14-15k of text into that 8k.
<br />
<br />An NES-based decompressor has now been made! It's DTE only though for the moment.
<br />
<br />Also, if you have uncompressed files of game text in the range of 5k to 750k per game (like for Final Fantasy, Chrono Trigger, probably most other RPGs), let me know, I'd like to test them and see how well this works on them. I'd prefer files that use the game's native text format.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CartCollector</b> [ Mon Oct 26, 2009 11:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you downloaded the file before I made this post, redownload it from the above link. The file I first uploaded had a bug that wouldn't allow you to compress or decompress to a file unless a file already existed with its name. It's fixed now.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Mon Oct 26, 2009 11:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Looks pretty good!  Here soon I may take a shot at using it Garage Cart #2, if I have enough text.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Rid</b> [ Tue Oct 27, 2009 12:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm always glad when someone share its compressor tool source. I hope that it will help me one day coding my own one <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />Thanks for sharing. I didn't have the time to analyse it yet, but I surely will tonight

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Tue Oct 27, 2009 7:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In addition to DTE for compression, games also sometimes use Dictionary Compression.  A programmer of Secret of Evermore mentioned using it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Tue Oct 27, 2009 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ninja Gaiden 3 also uses a dictionary for compression if I remember right. Pretty smart thing to do if you have alot of text and seems well worth any effort put into making such a feature. Even better if someone shares their own and you don't have to do anything other than put it to use.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Oct 27, 2009 1:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In other words: "tepples, hurry up and make huffword already!"

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Oct 27, 2009 1:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Great work Cart Collector. Can I use it in my project ? I was thinking text has to be compressed even if there isn't much text, because using 8-bits per letter when only about 30 combinations exists (counting ' ', '!', '?' and '.') is a waste.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Tue Oct 27, 2009 3:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I was wondering why the file was so big! now I see it's becaue of all the books.
<br />
<br />Anyway, nice work. The NES community is in need of more compression schemes, for text and for graphics.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CartCollector</b> [ Tue Oct 27, 2009 6:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for all the compliments! If you want to, go ahead and use the compressor to compress text files for your programs. Be sure to give me credit for the text compressor though. But I have to ask, how many of you have actually used it? It'll work with any file that only has bytes in the range of $00-$7F (that is, bit 7 for each byte = 0). So Bregalad you could test it out on the text that you have.
<br />
<br />Here's how it works, for those of you who don't know Java (or are too lazy to read it <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />)
<br />
<br />The compressor loads the entire text file into RAM, and then searches through each pair of bytes in the file (the 1st and the 2nd, the 2nd and the 3rd, the 3rd and the 4th, so on and so on) until it finds the most common pair of bytes. It then adds the most common pair of bytes to a dictionary that says $80 = most common pair, and then replaces the most common pair of bytes in the file stored in RAM with $80. Then it goes through with this process, using the partially compressed text file in memory, 127 more times, so that $80 through $FF all have pairs of bytes associated with them. If you run the compressor, you can see this happening. Then the compressor outputs a .dte file by adding the 256-byte dictionary of dual tiles to the front of the file and then adding the compressed text after the dictionary.
<br />
<br />The decompressor is much simpler. First it loads the dictionary. Then it goes through the file, byte by byte. If it finds a plaintext byte ($00-$7F) it just adds that to the output text file. If it finds a compressed byte ($80-$FF) it calls a routine which returns a variable length of bytes. And yes, the length of the bytes returned has to be variable. Why? Let's say the text file in question has a lot of instances of "the ". On the first round of compression, the most common pair of bytes is "e" and " " (space). The next round's most common pair is "t" and "h". Third round's most common pair is $81 (second round) and $80 (first). So let's say the file contains a byte equal to $82, the third round. It can't add $81 and $80 to the decompressed file! It has to call itself (recursion) until it returns only plaintext bytes.
<br />
<br />So yeah, dual tile encoding is actually a dictionary compression scheme. So Secret of Evermore and Ninja Gaiden 3 might use a form of DTE.
<br />
<br />I will continue working on this by the way. The next thing I'm going to add to the program is the ability to have a variable dictionary size depending on the file and not just a fixed 128-compressed-byte dictionary. It will allow you to set the maximum size of your dictionary, so if you have, say, 192 characters from $00-$BF, you can set it so that it only has 64 compressed bytes from $C0-$FF, or if you have 30 characters, you can have 226 compressed bytes. It will also stop adding compressed bytes if the most common pair of bytes in the file occurs &lt;=2 times. Why &lt;=2?  
<br />
<br />2 pairs of uncompressed bytes: $21 $20 $21 $20, 4 bytes total
<br />Compressed: $21 $20 (in dictionary), $AB $AB (in compressed file), 4 bytes total
<br />
<br />So there's no benefit to adding that to the dictionary.
<br />
<br />After that, I might add the ability to Huffman encode the file after it's been dual tile encoded. Doing so should compress the average text file down to 35-40%, around ZIP compression, but it'll make decompression slower and more complicated.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>bogax</b> [ Thu Oct 29, 2009 2:19 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sounds like BPE (Byte Pair Encoding)
<br />What does DTE stand for?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Rid</b> [ Thu Oct 29, 2009 6:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />DTE = <a href="http://en.wikipedia.org/wiki/ROM_hacking#Hex_editing" class="postlink">Dual Tile Encoding</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>CartCollector</b> [ Tue Jan 26, 2010 10:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />New version released (v1.5)!
<br />
<br />New features:
<br />-The minimum and maximum dictionary bytes can be set by the user instead of being fixed at $80-$FF
<br />-The compressor can skip compressing certain bytes that you want to omit
<br />-You can set the maximum recursive depth you want your decompressor to use (read on for more info)
<br />-The compressor can generate a table of pointers to the beginning of each message you have based on an end of string byte and an offset value
<br />-Contains ASM code for a 6502 DTE decompressor
<br />
<br />Download <a href="http://www.mediafire.com/?z5iyjlhkuoq" class="postlink">here.</a>
<br />
<br />How the maxDepth setting works:
<br />In Byte Pair Encoding, dictionary bytes might have to recursively call previous entries. Doing so takes up space on the stack, not to mention time if your chosen processor is slow at going to subroutines and returning from them. 
<br />For this reason you might want to put a limit on how deep each dictionary byte can call subroutines.
<br />IMPORTANT NOTE: Setting this value to 0 makes the encoder encode only plaintext bytes into the dictionary. A file compressed this way can be decompressed with a DTE (dual tile encoder) decoder. The advantages of DTE are that it's faster and requires less memory and stack space to decompress, however, it doesn't compress as well as BPE does.
<br />
<br />How do different maxDepth settings affect compression? I did tests with the included readme file using different maxDepth settings and recorded how well it compressed. Here's what I got (maxDepth setting - compression):
<br />
<br />0 - 64.5%
<br />1 - 55.3%
<br />2 - 53.1%
<br />3 - 52.8%
<br />4+- 52.7%
<br />
<br />Also, if anyone here has a project that you could use this with, let me know.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
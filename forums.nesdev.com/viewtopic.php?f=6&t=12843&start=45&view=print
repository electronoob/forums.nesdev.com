<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Hardware Recordings with S5B Chip</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Hardware Recordings with S5B Chip</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=12843">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=12843</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>4</strong> of <strong>6</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Sun May 31, 2015 3:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">ImATrackMan wrote:</div><div class="quotecontent">Your problem seems worse than mine. I use a Youkai Dochuuki cart for my N163, and I get a similar nasty hum, however it goes away permanently upon playing any N163 NSF. </div><br />I don't think the cartridge is an issue concerning the low 55Hz A, because I made an 8-channel N163 NSF that works fine without that buzzy pitch.<br /><br />Here's what I mean by 'buzzy' <a href="https://drive.google.com/file/d/0B8pvOPXnioiyYTZJMmNfaEFRekk/view?usp=sharing" class="postlink">King of Kings NSF - TNS (Buzzy)</a> <br />Sorry the volume's kind of loud b/c I think it normalized when I exported these. (Also it's not PCM but you can hear the frequencies fine.)<br />And here is the quick test NSF that I made using all 8 channels simultaneously <a href="https://drive.google.com/file/d/0B8pvOPXnioiyaFI2REtjM190dHc/view?usp=sharing" class="postlink">8CH N163 NSF TNS</a><br /><br />Edit: Hey, do you think you can make a recording of the NSF I attached? It's the same one that I recorded. I want to hear if there is a difference in cartridges. I have an AV Famicom, but I don't think that should make too big of a difference, right?<br /><br /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">I seem to recall that both the NSFs for the 8 channel N163 games King of Kings and Erika to Satoru no Yumebouken are broken. The problem seems subtle on emulators (e.g.  muted channels) but it might be worse in a hardware situation?</div><br /><br />I think you're probably right.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./images/upload_icons/mid.gif" alt="" /> 
				<a href="./download/file.php?id=3328">N163 8-Ch Test.nsf</a> [8 KiB]
			</span><br />
			<span class="gensmall">Downloaded 71 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Wed Jun 10, 2015 1:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">ImATrackMan wrote:</div><div class="quotecontent">I might have bumped the volume of the YMZ just a tad (for preference, it's still way under what it would sound like on an AV Famicom) </div><br />Hey TrackMan, I think your settings on the YMZ294 is based on how FamiTracker and NSFPlay mixes SS-5B. I just wrote a piece for the 5B and noticed that the balance of the 5B used in Gimmick! is proportionally much higher than how Famitracker/NSFPlay mixes it. When I turned it down to about your mixing level in the image (bumped down a tad), it matched what Famitracker was outputting.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Wed Jun 10, 2015 1:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />NSFPlay matches measurements I made from my own Gimmick cartridge. 2A03 output levels vary, and on top of that in-cart mixing varies from cart to cart, so it's not easy to get an authoritative &quot;correct&quot; mixing. We might be talking about a 10% resistor tolerance, but the variation is compounded at each stage of the mixing, so it can accumulate to much more than that.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Wed Jun 10, 2015 3:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ah I see, so there really isn't a set standard  <img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /><br />What is FT's mixing based off of?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jun 10, 2015 3:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Use the source, Luke! Here are relevant snippets from <a href="https://github.com/christopherpow/nesicide/blob/master/libs/famitracker/Source/APU/Mixer.cpp" class="postlink">Mixer.cpp</a>:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">/*<br />&nbsp;Mixing of internal audio relies on Blargg's findings<br /><br />&nbsp;&#91;Mixing levels of&#93;<br />&nbsp;N163 &amp; 5B are still unknown<br />*/<br /><br />inline double CMixer::CalcPin1(double Val1, double Val2) {<br />&nbsp; if ((Val1 + Val2) &gt; 0) {<br />&nbsp; &nbsp; return 95.88 / ((8128.0 / (Val1 + Val2)) + 100.0);<br />&nbsp; }<br />&nbsp; return 0;<br />}<br /><br />inline double CMixer::CalcPin2(double Val1, double Val2, double Val3) {<br />&nbsp; if ((Val1 + Val2 + Val3) &gt; 0) {<br />&nbsp; &nbsp; return 159.79 / ((1.0 / ((Val1 / 8227.0) + (Val2 / 12241.0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + (Val3 / 22638.0))) + 100.0);<br />&nbsp; }<br />&nbsp; return 0;<br />}<br /></div><br />And from Mitsutaka Okazaki's <a href="https://github.com/christopherpow/nesicide/blob/master/libs/famitracker/Source/APU/emu2149.c" class="postlink">emu2149.c</a>, the volume levels are thus:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">{0x00, 0x01, 0x01, 0x02, 0x02, 0x03, 0x03, 0x04, 0x05, 0x06, 0x07, 0x09,<br />&nbsp; &nbsp;0x0B, 0x0D, 0x0F, 0x12,<br />&nbsp; &nbsp;0x16, 0x1A, 0x1F, 0x25, 0x2D, 0x35, 0x3F, 0x4C, 0x5A, 0x6A, 0x7F, 0x97,<br />&nbsp; &nbsp;0xB4, 0xD6, 0xFF, 0xFF}<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Wed Jun 10, 2015 4:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That doesn't answer tadashibashi's question. The question is what the relative level of 5B to 2A03 in Famitracker is based on. This was some decision made by jsr, so you'd have to ask him (unless there is a comment about it in the source). You might try the <a href="http://forums.famitracker.com/viewforum.php?f=7" class="postlink">Famitracker Forums</a>, as I don't know if he'll see this thread.<br /><br />What you posted, tepples, is part of the nonlinear mix for each of those chips separately. The 2A03's is following Blarrg's nonlinearity formula (which is a rough approximation), and the 5B's is an 8-bit approximation of the log output of the YM2149, which is described in the <a href="http://pdf1.alldatasheet.com/datasheet-pdf/view/103366/ETC/YM2149.html" class="postlink">YM2149 datasheet</a>. Neither of these describes the relative level of their output, or more importantly <em>why</em> that relative level was chosen.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ImATrackMan</b> [ Thu Jun 11, 2015 1:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I based my 5B mixing on Rainwarrior's Gimmick! cart and bumped the volume a tad (maybe .4 dB) for preference, but besides that, all expansions are based on the NSFs vs. actual gameplay on games that I physically own. Every cartridge and FC has its own mixing variance. For example, any expansion game when used on an AV Famicom will have its expansion mixed much louder than on any RF Famicom.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Thu Jun 11, 2015 1:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">ImATrackMan wrote:</div><div class="quotecontent">I based my 5B mixing on Rainwarrior's Gimmick! cart and bumped the volume a tad (maybe .4 dB) for preference </div> <br /><br />Yeah I had to bring mine to the same level since I had been playing back my FTM in FT and NSF in NSFPlay. Both levels seem pretty similar.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">For example, any expansion game when used on an AV Famicom will have its expansion mixed much louder than on any RF Famicom.</div><br /><br />Then wouldn't the pots of HFX4 on both AV and RF need to be about the same position (comparing our levels) to produce the levels of cartridge recordings produced by each respective system? Or is it b/c the TNS outputs audio on its own and doesn't come out of the Famicom? Or could it be that each TNS-HFC/HFX has its own variances in mixing levels? haha.. argh

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Thu Jun 11, 2015 1:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tadashibashi wrote:</div><div class="quotecontent">Or is it b/c the TNS outputs audio on its own and doesn't come out of the Famicom?<br /></div>That one.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jsr</b> [ Sun Jun 14, 2015 3:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tadashibashi wrote:</div><div class="quotecontent">Ah I see, so there really isn't a set standard  <img src="./images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /><br />What is FT's mixing based off of?</div><br />The mixing in FT is based on rainwarrior's NSFplay at the moment since I haven't done my own measurements yet.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sun Jun 14, 2015 3:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tadashibashi wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">For example, any expansion game when used on an AV Famicom will have its expansion mixed much louder than on any RF Famicom.</div><br />Or is it b/c...</div><br /><br />The situation is even worse that you might hope. Because each of the two channels coming from the 2A03 has its own resistor adding variance, not only does the overall 2A03 mix level vary between machines, but so does the mix between the squares channel and the tri/noise/dpcm channel.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun Jun 14, 2015 4:05 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">Because each of the two channels coming from the 2A03 has its own resistor adding variance [...] the mix between the squares channel and the tri/noise/dpcm channel [varies between machines]<br /></div>But that should only be a decibel or so...<br /><br />12kΩ×1.05 ÷ (12kΩ×1.05 + 20kΩ×0.95) ≈ .399<br />12kΩ×0.95 ÷ (12kΩ×0.95 + 20kΩ×1.05) ≈ .352<br />.399 ÷ .352 ≈ 1.13 ; 20×log₁₀(1.13) ≈ 1.09dB<br /><br />Which ... I guess, given that ImATrackMan mentioned fiddling with a volume adjustment of 0.4dB, I guess that's comparatively huge.<br /><br />But that's &quot;absolute highest possible error&quot; to &quot;absolute lowest possible error&quot;; in practice 5% carbon-film resistors like those used in the NES have the correct value within a gaussian distribution with 3σ ≈ ±5%.<br /><br /><span style="font-size: 67%; line-height: normal">(Unlike 10% or worse resistors, 5% resistors are approximately &quot;as good as it gets&quot; for the technology, so it actually is gaussian (<a href="http://www.kerrywong.com/2013/02/01/100k-5-carbon-film-resistor-value-distribution/" class="postlink">q.v.</a>) while it's moderately-well-accepted that lower-precision resistors have the sweet spot cut out in the middle from a measure-and-bin stage.</span>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Sun Jun 14, 2015 7:22 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sorry to sway the conversation, but I just used a breadboard to connect Gimmick! to the YMZ294 port and my set up didn't work. I put D0-D7 in the right places, the Gimmick Audio to RF (pin46) to YMZ Sound Out (pin5), Gimmick M2 to YMZ Master Clock (pin7), the ROMSEL to CS  and WR to R/W. I also put the 5v to 5v but removed it when nothing changed.  There was a loud hum with static happening in rhythm so it seems like the data from D0-D7 was doing something? But I just gave up since have no clue what else I could do. Would the A0-A14 pins need something inputted to them? As a side note, my cartridge connector is stuck inside my Gimmick cartridge : P

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun Jun 14, 2015 8:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, you need to tie Gimmick's CPU A14 (pin 35) input high and connect Gimmick CPU A13 (pin 34) to YMZ294 A0.<br /><br />You &quot;should&quot; tie the other input pins high or low, but that might not be necessary.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tadashibashi</b> [ Sun Jun 14, 2015 10:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Hardware Recordings with S5B Chip</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Yeah, you need to tie Gimmick's CPU A14 (pin 35) input high and connect Gimmick CPU A13 (pin 34) to YMZ294 A0.<br /><br />You &quot;should&quot; tie the other input pins high or low, but that might not be necessary.</div><br /><br />Sorry, what does 'high' and 'low' mean?<br /><br />Edit: and 'tie'? Just want to make sure I understand accurately.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>4</strong> of <strong>6</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="https://forums.nesdev.com/feed.php?f=3&amp;t=8757" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="https://forums.nesdev.com/index.php" />
<updated>2012-05-08T02:54:16-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>https://forums.nesdev.com/feed.php?f=3&amp;t=8757</id>
<entry>
<author><name><![CDATA[Bisqwit]]></name></author>
<updated>2012-05-08T02:54:16-07:00</updated>
<published>2012-05-08T02:54:16-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93505#p93505</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93505#p93505"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93505#p93505"><![CDATA[
<div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent"><br />I'm guessing you didn't see this: <a href="http://nesdev.com/bbs/viewtopic.php?t=8688" class="postlink">http://nesdev.com/bbs/viewtopic.php?t=8688</a> based on your attempts to find out how this actually works on the 6502.  They actually discuss why the BRK/IRQ concurrency issue exists, as a hardware design.  Just thought I'd make sure you saw that, sorry if you already had.<br /><br />EDIT:  The whole thing's worth watching but it's specifically discussed around 19:30<br /></div><br />I have seen it in its entirety.<br />And I still don't know exact means to do the test. And yes, a moderator do please notice the spamming account &amp; posts of "lanshan75".<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> — Tue May 08, 2012 2:54 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[infiniteneslives]]></name></author>
<updated>2012-05-08T01:14:24-07:00</updated>
<published>2012-05-08T01:14:24-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93502#p93502</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93502#p93502"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=93502#p93502"><![CDATA[
Well thanks to the spam I didn't completely miss this post.  I'm guessing you didn't see this: <a href="http://nesdev.com/bbs/viewtopic.php?t=8688" class="postlink">http://nesdev.com/bbs/viewtopic.php?t=8688</a> based on your attempts to find out how this actually works on the 6502.  They actually discuss why the BRK/IRQ concurrency issue exists, as a hardware design.  Just thought I'd make sure you saw that, sorry if you already had.<br /><br />EDIT:  The whole thing's worth watching but it's specifically discussed around 19:30<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4832">infiniteneslives</a> — Tue May 08, 2012 1:14 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2012-04-03T08:35:17-07:00</updated>
<published>2012-04-03T08:35:17-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=92106#p92106</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=92106#p92106"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=92106#p92106"><![CDATA[
It's all about how welcome/magnificent the test ROMs are here... <img src="https://forums.nesdev.com/images/smilies/icon_smile.gif" alt=":)" title="Smile" /><p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Apr 03, 2012 8:35 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[crudelios]]></name></author>
<updated>2012-03-29T03:41:12-07:00</updated>
<published>2012-03-29T03:41:12-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91952#p91952</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91952#p91952"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91952#p91952"><![CDATA[
Oh ok, I was simply comparing to the expected NES output, which is different. Thanks!<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5192">crudelios</a> — Thu Mar 29, 2012 3:41 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bisqwit]]></name></author>
<updated>2012-03-29T03:38:15-07:00</updated>
<published>2012-03-29T03:38:15-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91951#p91951</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91951#p91951"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91951#p91951"><![CDATA[
Just to repeat for clarity, this is not a pass/fail test (aside from the flags bit in the beginning).<br /><br />This was an attempt to collect information to make a BRK-IRQ overriding test.<br />The actual pass/fail test will be coming later when/if the means to implement the test are devised and proven reliable.<br /><br />I suggest everyone disregard these test results for now.<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> — Thu Mar 29, 2012 3:38 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[crudelios]]></name></author>
<updated>2012-03-29T03:28:47-07:00</updated>
<published>2012-03-29T03:28:47-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91949#p91949</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91949#p91949"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91949#p91949"><![CDATA[
My result:<br /><br /><img src="http://dl.dropbox.com/u/15465721/nes_irq_brk.png" alt="Image" /><br /><br />It's off by one instruction at the end it seems, now I need to understand what all these numbers mean so I can get it to pass <img src="https://forums.nesdev.com/images/smilies/icon_razz.gif" alt=":P" title="Razz" /><p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5192">crudelios</a> — Thu Mar 29, 2012 3:28 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2012-03-27T15:32:13-07:00</updated>
<published>2012-03-27T15:32:13-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91893#p91893</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91893#p91893"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91893#p91893"><![CDATA[
Sorry. I was drifting your focus... <img src="https://forums.nesdev.com/images/smilies/icon_sad.gif" alt=":(" title="Sad" /><p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Mar 27, 2012 3:32 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bisqwit]]></name></author>
<updated>2012-03-27T16:30:47-07:00</updated>
<published>2012-03-27T14:26:21-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91891#p91891</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91891#p91891"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91891#p91891"><![CDATA[
Unrelated to previous questions:<br /><br />Hmm, I tried to make the test automatically find the proper timings for the APU IRQ timing, so it works not only on both NTSC and PAL, but on any broken emulator that might not have its timings right (since the focus of the test is not at accurate timings, but in the BRK-IRQ overriding effect that I have dubbed Higgs boson for its observation evading nature).<br /><br />But turns out that blargg's sync_apu function actually relies on hard-coded NTSC timings, which makes the whole synchronization loop ("IRQ timing") pointless. If the emulator does not have accurate NTSC timings, the loop may yield random values.<br /><br />I tried discarding the sync_apu function and instead, making my own synchronization code (still relying on the binary search), but it does not work nicely. I tried for example, delay N cycles, read IRQ status (clearing it), delay N cycles again, read IRQ status, and see if IRQ status was set on both times. (Two times necessary to overcome the unknown jitter factor.) I tried looping ten times and checking if IRQ status was set each time. Or ANDing the statuses of individual loops together.<br />None of these produced anything that would not produce completely random results (that were right sometimes, but often off by 1 or off by 40).<br /><br />Any ideas? Here is the (partial) source code of one of these attempts.<div class="codetitle"><b>Code:</b></div><div class="codecontent">        sei<br /><br />        ; Disable IRQ<br />        delay 8<br />        setb SNDMODE, $40<br />        delay 8<br />        lda SNDCHN<br />        delay 8   <br /><br />        ; Run one IRQ.<br />        setb SNDMODE, 0 ; Enable IRQ &#40;but the CPU will still block them&#41;<br /><br />        ; Wait<br />        lda num_cycles_plan+0      ; 3 cycles<br />        sec                        ; 2 cycles<br />        sbc #40                    ; 2 cycles<br />        tax                        ; 2 cycles<br />        lda num_cycles_plan+1      ; 3 cycles<br />        sbc #0                     ; 2 cycles<br />        jsr delay_256a_x_26_clocks ; OVERHEAD: 3+2+2+2+3+2+26<br /><br />        ; Check whether APU is ready to trigger an IRQ<br />        lda SNDCHN      ; 4 cycles<br />        sta somewhere   ; 3 cycles<br /><br />        ; Do it again to counteract the odd/even frames effect. Subtract those 7  cycles.<br />        lda num_cycles_plan+0      ; 3 cycles<br />        sec                        ; 2 cycles<br />        sbc #&#40;40-7&#41;                ; 2 cycles<br />        tax                        ; 2 cycles<br />        lda num_cycles_plan+1      ; 3 cycles<br />        sbc #0                     ; 2 cycles<br />        jsr delay_256a_x_26_clocks ; OVERHEAD: 3+2+2+2+3+2+26<br /><br />        lda SNDCHN<br />        and somewhere<br />        ; The bits now tell if the IRQ happened on both times.<br /><br />        and #$40<br />        ; Binary search condition: A = nonzero.</div><br /><br />The code below gets 29820 cycles in Nintendulator, 29813 cycles in Nestopia.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">   sei<br />   <br />   ; Disable IRQ<br />   delay 8<br />   setb SNDMODE, $40<br />   delay 8<br />   lda SNDCHN<br />   delay 8<br /><br />   ; Run one IRQ.<br />   setb SNDMODE, 0 ; Enable IRQ &#40;but block them at CPU&#41;<br /><br />   ; Wait<br />   lda num_cycles_plan+0      ; 3 cycles<br />   sec            ; 2 cycles<br />   sbc #40            ; 2 cycles<br />   tax            ; 2 cycles<br />   lda num_cycles_plan+1      ; 3 cycles<br />   sbc #0            ; 2 cycles<br />   jsr delay_256a_x_26_clocks ; OVERHEAD: 3+2+2+2+3+2+26<br />   <br />   ldx SNDCHN      ; 4 cycles<br />   lda SNDCHN      ; 4 cycles<br />   ; X should be #$00, A should be #$40.<br />   and #$40      ; 2 cycles<br />   sta timing_temp_1   ; 3 cycles<br />   txa         ; 2 cycles<br />   and #$40      ; 2 cycles<br />   sec         ; 2 cycles<br />   sbc timing_temp_1   ; 3 cycles<br />   sta timing_temp_1   ; 3 cycles --total: 4+4+2+3+2+2+2+3+3 =  25 cycles<br />   ; X=$00, A=$00 &#40;too early&#41;   result: $00<br />   ; X=$00, A=$40 &#40;right time&#41;  result: $C0<br />   ; X=$40, A=$00 &#40;too late&#41;    result: $40<br />   ; X=$40, A=$40 &#40;impossible&#41;  result: $00<br />   ; Do it again to counteract the odd/even frames effect. Subtract those 25 cycles.<br />   lda num_cycles_plan+0      ; 3 cycles<br />   sec            ; 2 cycles<br />   sbc #&#40;40-25&#41;         ; 2 cycles<br />   tax            ; 2 cycles<br />   lda num_cycles_plan+1      ; 3 cycles<br />   sbc #0            ; 2 cycles<br />   jsr delay_256a_x_26_clocks ; OVERHEAD: 3+2+2+2+3+2+26<br /><br />   ldx SNDCHN<br />   lda SNDCHN<br />   and #$40      ; 2 cycles<br />   sta timing_temp_2   ; 3 cycles<br />   txa         ; 2 cycles<br />   and #$40      ; 2 cycles<br />   sec         ; 2 cycles<br />   sbc timing_temp_2   ; 3 cycles<br />   sta timing_temp_2   ; 3 cycles<br />   <br />   ; Now:<br />   ;   timing_temp_1 timing_temp_2<br />   ;             $00           $00 too early  &#40;1&#41;<br />   ;             $00           $40 too early  &#40;1&#41;<br />   ;             $00           $C0 too early  &#40;1&#41;<br />   ;             $40           $00 too late   &#40;0&#41;<br />   ;             $40           $40 too late   &#40;0&#41;<br />   ;             $40           $C0 too late   &#40;0&#41;<br />   ;             $C0           $00 too early  &#40;1&#41;<br />   ;             $C0           $40 too late   &#40;0&#41;<br />   ;             $C0           $C0 RIGHT TIME &#40;0&#41;<br />   ldx #0<br />   lda timing_temp_1<br />   beq @make_1<br />   cmp #$40<br />   beq @make_0<br />   lda timing_temp_2<br />   beq @make_1<br />@make_0:<br />   .byte $A9 ; lda #imm<br />@make_1:<br />   inx<br /><br />   ; Translate the 0/1 value into carry flag for function return.<br />   cpx #$01<br />   rts</div><br />I'll have to doublecheck whether my delay function works as intended, too.<br />EDIT: Yeah, I had a bug in the delay code. (Which means that all previous test results may have been bogus!) But I'm still getting differences of 0/1 cycles in this loop.<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> — Tue Mar 27, 2012 2:26 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2012-03-27T14:17:24-07:00</updated>
<published>2012-03-27T14:17:24-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91890#p91890</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91890#p91890"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91890#p91890"><![CDATA[
<div class="quotetitle">Bisqwit wrote:</div><div class="quotecontent"><br />At no point do I write to $4015 in this test, not even in Blargg's library code (except in the end thereof).<br /></div><br /><br />My bad, I mean read from $4015.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br />I do write to $4017 whenever I want to toggle IRQ enable / disable, and/or to force IRQ to be happen at a certain time. I may read $4015 even when IRQ is not being triggered.<br /></div><br /><br />Hmm... but you could count how many cycles were elapsed since $4017 write and right before $4015 read (I remember of blargg counting cycles this way), so I can search for timing errors here.<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Mar 27, 2012 2:17 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[FHorse]]></name></author>
<updated>2012-03-27T13:49:07-07:00</updated>
<published>2012-03-27T13:49:07-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91889#p91889</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91889#p91889"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91889#p91889"><![CDATA[
<div class="codetitle"><b>Code:</b></div><div class="codecontent">Offs #INTs Flags   4015 B n<br />035  1     $30,$30 $20  1 36<br />047  2     $20,$30 $60  0 12<br />126  2     $20,$30 $60  1 79<br />142  1     $30,$30 $60  1 16<br />249  2     $30,$30 $20  1 107<br />- IRQ trigger timing: 29823</div><br />and after a debug session I've the same result with puNES. Thx Bisqwit for the test.<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4369">FHorse</a> — Tue Mar 27, 2012 1:49 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[tepples]]></name></author>
<updated>2012-03-27T12:17:46-07:00</updated>
<published>2012-03-27T12:17:46-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91882#p91882</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91882#p91882"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91882#p91882"><![CDATA[
Results from updated test on NTSC NES + PowerPak:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Offs #INTs Flags   4015 B n<br />035  1     $30,$30 $20  1 36<br />047  2     $20,$30 $60  0 12<br />126  2     $20,$30 $60  1 79<br />142  1     $30,$30 $60  1 16<br />249  2     $30,$30 $20  1 107<br />- IRQ trigger timing: 29823</div><p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=9">tepples</a> — Tue Mar 27, 2012 12:17 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bisqwit]]></name></author>
<updated>2012-03-27T09:44:16-07:00</updated>
<published>2012-03-27T09:44:16-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91877#p91877</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91877#p91877"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91877#p91877"><![CDATA[
<div class="quotetitle">Zepper wrote:</div><div class="quotecontent"><br />Do you know if the IRQ is acknowledged <em>only</em> in the last cycle of the current instruction? Do you write to $4017 before writing to $4015? How many cycles should be elapsed?<br /></div><br />At no point do I write to $4015 in this test, not even in Blargg's library code (except in the end thereof).<br />I do write to $4017 whenever I want to toggle IRQ enable / disable, and/or to force IRQ to be happen at a certain time. I may read $4015 even when IRQ is not being triggered.<br />I can't answer the other questions.<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> — Tue Mar 27, 2012 9:44 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Zepper]]></name></author>
<updated>2012-03-27T09:24:56-07:00</updated>
<published>2012-03-27T09:24:56-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91875#p91875</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91875#p91875"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91875#p91875"><![CDATA[
Do you know if the IRQ is acknowledged <em>only</em> in the last cycle of the current instruction? Do you write to $4017 before writing to $4015? How many cycles should be elapsed?<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=39">Zepper</a> — Tue Mar 27, 2012 9:24 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Bisqwit]]></name></author>
<updated>2012-03-27T07:18:59-07:00</updated>
<published>2012-03-27T07:18:59-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91873#p91873</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91873#p91873"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91873#p91873"><![CDATA[
From my emulator:<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><br /><span style="color: #FFFFFF">TEST:test_cpu_flag_concurrency</span><br /><span style="color: #FF8800">Verifying that basic CPU flag operations work properly</span><br /><span style="color: #FFFFFF">DFL:</span><span style="color: #8888FF">30</span><span style="color: #FFFFFF">; </span><span style="color: #8888FF">30   </span><span style="color: #FFFFFF">OK   </span><br /><span style="color: #FFFFFF">NMI:</span><span style="color: #8888FF">20</span><span style="color: #FFFFFF">-&gt;</span><span style="color: #8888FF">30   </span><span style="color: #FFFFFF">OK   </span><br /><span style="color: #FFFFFF">IRQ:</span><span style="color: #8888FF">20</span><span style="color: #FFFFFF">-&gt;</span><span style="color: #8888FF">30   </span><span style="color: #FFFFFF">OK   </span><br /><span style="color: #FFFFFF">BRK:</span><span style="color: #8888FF">30</span><span style="color: #FFFFFF">-&gt;</span><span style="color: #8888FF">30   </span><span style="color: #FFFFFF">OK   </span><br /><span style="color: #FF8800">Finding APU IRQ timings</span><br /><span style="color: #FFFFFF">OK, </span><span style="color: #8888FF">29823&lt;=</span><span style="color: #FFFFFF">29823</span><span style="color: #8888FF">&lt;29823</span><br /><span style="color: #FF8800">Invoking a BRK-IRQ collision</span><br /><span style="color: #FFFFFF">Offs #INTs Flags   4015 B n</span><br /><span style="color: #8888FF">033  1     $30,$30 $00  1 34</span><span style="color: #AAAAAA"> &lt;- Only BRK happened (IRQ was not asserted before test was over)</span><br /><span style="color: #8888FF">043  2     $20,$30 $40  0 10</span><span style="color: #AAAAAA"> &lt;- BRK occurring, followed by IRQ before SEI has caught effect </span><br /><span style="color: #8888FF">124  2     $20,$30 $40  1 81</span><span style="color: #AAAAAA"> &lt;- BRK occurring, reads $4015 BEFORE the IRQ is asserted, immediately followed by IRQ before the next instruction in mainline </span><br /><span style="color: #8888FF">136  1     $30,$30 $40  1 12</span><span style="color: #AAAAAA"> &lt;- BRK occurring, reads $4015 AFTER IRQ is asserted, IRQ never occurs</span><br /><span style="color: #8888FF">138  1     $20,$30 $40  1 2</span><span style="color: #AAAAAA"> &lt;- BRK superseded by IRQ (BRK-style return address, IRQ-style flags)</span><br /><span style="color: #8888FF">249  2     $30,$30 $00  1 111</span><span style="color: #AAAAAA"> &lt;- IRQ occurs, followed by BRK occurring</span><br /></div><br />This is obviously wrong in more than one aspect.<br />Also, I do not get $20 at $4015, even though I implemented the open bus feature in there. What could be causing it to happen on NES and Famicom?<br /><br /><br /><div class="quotetitle">FHorse wrote:</div><div class="quotecontent"><br />And this with puNES:<br /></div><br />You have a one-cycle difference between IRQ occurring and a read from $4015 preventing that happening compared to the real NES. Are you possibly fetching the contents of the register at wrong cycle relative to the instruction? Or do you have an extra buffer somewhere for IRQs?<p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5043">Bisqwit</a> — Tue Mar 27, 2012 7:18 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[FHorse]]></name></author>
<updated>2012-03-27T07:08:48-07:00</updated>
<published>2012-03-27T07:08:48-07:00</published>
<id>https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91872#p91872</id>
<link href="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91872#p91872"/>
<title type="html"><![CDATA[Planning a test for BRK and IRQ concurrency glitch]]></title>

<content type="html" xml:base="https://forums.nesdev.com/viewtopic.php?t=8757&amp;p=91872#p91872"><![CDATA[
And this with puNES:<br /><img src="http://img18.imageshack.us/img18/7779/schermata2md.png" alt="Image" /><p>Statistics: Posted by <a href="https://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=4369">FHorse</a> — Tue Mar 27, 2012 7:08 am</p><hr />
]]></content>
</entry>
</feed>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - 8x16 and whatever else unreg wants to know</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">8x16 and whatever else unreg wants to know</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7451">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7451</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>10</strong> of <strong>83</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 22, 2011 10:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Is it good to set up the controller reading part with a system that checks each button-part to see if it has already been pressed and so then it should be ignored until it's released?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Wed Jun 22, 2011 11:54 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You don't need any complex logic for that. With just a few bitwise operations you can detect all kinds of keypresses. Read <a href="http://nesdev.com/bbs/viewtopic.php?p=62142#62142" class="postlink">this post</a> and the ones after it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Thu Jun 23, 2011 2:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I have the controller reading code a subroutine, then I put my movement and actions based off the computer in my main engine, I think that'd the standard way of doing things.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 9:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sweet! Thank you tokumaru! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />  I can move our sprite reguarly now!!!
<br />
<br />Thank you 3gengames for those two sentences, they helped me alot <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> once I finally spent time to understand it.
<br />
<br />So far only half of my controller works... the controlpad part works; A B Select Start don't do anything.  Do you have an idea of what coould be wrong?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Wed Jun 29, 2011 10:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, can't tell without the code...  <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 10:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lookatController:<br />&nbsp; lda ControllerButtons<br />&nbsp; sta lastControllerButtons<br /><br />&nbsp; &nbsp;LDX #$01 <br />STX $4016 <br />DEX <br />STX $4016 <br />LDX #$08 <br />-Loop: <br />LDA $4016 <br />LSR A <br />ROr ControllerButtons <br />DEX <br />BNE -Loop <br /><br />&nbsp; lda lastControllerButtons<br />&nbsp; eor #$ff ;invert<br />&nbsp; and ControllerButtons ;AND result with the new state<br />&nbsp; sta pressedControllerButtons<br /><br />RTS ;Controller value in the variable ControllerButtons. <br /><br />...<br /><br />react_to_input:<br />&nbsp; &nbsp; <br />&nbsp; &nbsp;jsr lookatController<br /><br />&nbsp; &nbsp;lda pressedControllerButtons&nbsp; &nbsp; ; Is the A button down?<br />&nbsp; &nbsp; &nbsp; &nbsp; and BUTTON_A ;#00000001b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @b<br />&nbsp; &nbsp;&nbsp; &nbsp;inc aFrame&nbsp; &nbsp; &nbsp; &nbsp; ;run only once per press.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;<br />@b:&nbsp; &nbsp;&nbsp; &nbsp;lda pressedControllerButtons&nbsp; &nbsp;&nbsp; &nbsp;;Is the B button down?<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_B ;#00000010b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @select<br />&nbsp; &nbsp;&nbsp; &nbsp;lda #0<br />&nbsp; &nbsp;&nbsp; &nbsp;sta aFrame<br />&nbsp; &nbsp;&nbsp; &nbsp;jsr low_c&nbsp; &nbsp; ;low_c is just small code that plays a note <br />&nbsp; &nbsp;&nbsp; &nbsp;<br />@select lda pressedControllerButtons&nbsp; ; Select does something&#40;music no working&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_SELECT ;#00000100b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @start<br />&nbsp; &nbsp;&nbsp; &nbsp;ldx &lt;musicA_module ;also songA<br />&nbsp; &nbsp;&nbsp; &nbsp;ldy &gt;musicA_module&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;jsr FamiToneMusicStart<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />@start&nbsp; &nbsp;lda pressedControllerButtons&nbsp; ; Start does nothing<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_START ;#00001000b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @up<br />&nbsp; &nbsp;&nbsp; &nbsp;jsr FamiToneMusicStop<br />&nbsp; &nbsp;&nbsp; &nbsp;<br />@up&nbsp; &nbsp;&nbsp; &nbsp;lda pressedControllerButtons&nbsp; &nbsp;;Is Up&nbsp; down?<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_UP ;#00010000b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @down<br />&nbsp; &nbsp;&nbsp; &nbsp;dec oY<br />@down&nbsp; &nbsp;lda pressedControllerButtons ;is Down down?<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_DOWN ;#00100000b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @left<br />&nbsp; &nbsp;&nbsp; &nbsp;inc oY<br />@left&nbsp; &nbsp;lda pressedControllerButtons&nbsp; ;is Left down?<br />&nbsp; &nbsp;&nbsp; &nbsp;and BUTTON_LEFT ;#01000000b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq @right<br />&nbsp; &nbsp;&nbsp; &nbsp;dec oX<br />@right&nbsp; lda pressedControllerButtons&nbsp; ;Is Right down?<br />&nbsp; &nbsp; &nbsp; &nbsp; and BUTTON_RIGHT ;#10000000b<br />&nbsp; &nbsp;&nbsp; &nbsp;beq not_dn<br />&nbsp; &nbsp;&nbsp; &nbsp;inc oX<br />not_dn:&nbsp; &nbsp;rts&nbsp; </div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Wed Jun 29, 2011 10:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hmm, not sure what it's doing here and I don't know if I can find out. Is it doing anything at all? What isn't happening?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 11:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">unregistered wrote:</div><div class="quotecontent">So far only half of my controller works... the controlpad part works; A B Select Start don't do anything.</div>
<br />
<br />A &amp; B aren't working at all, they are susposed to advance and reset the sprite frame.  Select and start arent working at alll, they are susposed to start and stop a famitone song.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Wed Jun 29, 2011 11:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Are you ROLing them the right way in your routine? You ROR, I dunno if you ment to do a ROL instead.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jun 29, 2011 11:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Have you tried swapping around which button does what?
<br />
<br />What are the definitions of BUTTON_A, BUTTON_B, BUTTON_SELECT, and BUTTON_START? They appear not to be present in this page of the discussion or on the previous page.
<br />
<br />Have you made sure that A, B, Select, and Start are correctly mapped in the emulator on which you're testing, such as by playing someone else's homebrew game?
<br />
<br />Have you tried getting on a PC running Windows and stepping through react_to_input using FCEUX or Nintendulator?
<br />
<br />
<br />EDIT:
<br />@3gengames: ROR is fine if you prefer little-endian bit order of the buttons in the byte, not unlike how the Game Boy Advance buttons are ordered.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 11:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Have you tried swapping around which button does what?</div><br /><br />No...  well, I did a long time ago, I remember.  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">What are the definitions of BUTTON_A, BUTTON_B, BUTTON_SELECT, and BUTTON_START? They appear not to be present in this page of the discussion or on the previous page.</div><br /><br />next to each one of these i commented out the value (in the last code up there)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">BUTTON_RIGHT .equ #10000000b<br />BUTTON_LEFT&nbsp; .equ #01000000b<br />BUTTON_DOWN&nbsp; .equ #00100000b<br />BUTTON_UP&nbsp; &nbsp; .equ #00010000b<br />BUTTON_START .equ #00001000b<br />BUTTON_SELECT .equ #00000100b<br />BUTTON_B&nbsp; &nbsp; &nbsp;.equ #00000010b<br />BUTTON_A&nbsp; &nbsp; &nbsp;.equ #00000001b</div><br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Have you made sure that A, B, Select, and Start are correctly mapped in the emulator on which you're testing, such as by playing someone else's homebrew game?</div><br /><br />No, that is a good idea, thank you... now, yes they are working<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Have you tried getting on a PC running Windows and stepping through react_to_input using FCEUX or Nintendulator?</div>
<br />
<br />I've never stepped through anything.  Do you have any tips/suggestions? I'm going to use Nintendulator.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jun 29, 2011 11:49 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In Nintendulator 0.970, open your ROM and under Debug, choose Disassembly. In the Controls pane of the debugger window, click "Step" to stop your program. Click "Step" a few more times to execute an instruction at a time. In the Trace pane, scroll up and down to see instructions around the program counter. You can double-click an instruction to set a breakpoint. Once you've set a breakpoint on an instruction; the "Run" button in the will run the program until a breakpoint is executed. So if you put a breakpoint just before jsr react_to_input, you can run the program and then step through the subroutine.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 1:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">In Nintendulator 0.970, open your ROM and under Debug, choose Disassembly. In the Controls pane of the debugger window, click "Step" to stop your program. Click "Step" a few more times to execute an instruction at a time. In the Trace pane, scroll up and down to see instructions around the program counter. You can double-click an instruction to set a breakpoint. Once you've set a breakpoint on an instruction; the "Run" button in the will run the program until a breakpoint is executed. So if you put a breakpoint just before jsr react_to_input, you can run the program and then step through the subroutine.</div>
<br />
<br />tepples, thanks for these instructions! <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />
<br />How can i find out what the line number address is just before <span style="color: violet">jsr react_to_input</span>?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed Jun 29, 2011 2:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That depends on how your assembler outputs listing or map files.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Wed Jun 29, 2011 4:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />What I usually do is put in a dummy instruction and set a breakpoint on that. In Nintendulator you can tell it to break when a certain address is read or written to.
<br />
<br />I usually do a bit $0100 to read from the last byte of the stack, something that does not normally happen in my programs. I stick that instruction in wherever I want a break, then set the break point to Read $0100.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>10</strong> of <strong>83</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
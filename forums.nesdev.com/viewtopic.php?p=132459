<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - BGMODE or parameter changes during scanline</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - BGMODE or parameter changes during scanline" href="http://forums.nesdev.com/feed.php?f=12&amp;t=11404" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '6');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=11404';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Mon May 11, 2015 7:40 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=11404&amp;start=75">BGMODE or parameter changes during scanline</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=11404"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>6</strong> of <strong>8</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 111 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=11404&amp;start=60">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=11404">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=60">5</a><span class="page-sep">, </span><strong>6</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=105">8</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=11404&amp;start=90">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=11404&amp;start=75&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=11404&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=11404&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132029"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132029">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132029#p132029"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Aug 04, 2014 8:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Great!  When my SD2SNES arrives I'll record stuff and put it up here.  Thanks for reviewing stuff + putting up with my delays.  (Edit: It's been shipped, so I imagine it'll be here within a week or two.  The way Retrogate does their package tracking is bizarre as hell though -- through some third-party site in Ukraine despite them being in Germany.  Very weird)<br /><br />I figured out how to alleviate the audio frequency ramping problem too -- just had to check a couple boxes in VirtualDub (specifically Capture / Timing / Automatically disable resync when integrated audio/video capture is detected).  Since the Happauge capture device is doing both audio and video capturing, they're actually always in sync.  I figured this out by reading the manual a bit, but also by looking at Capture / Timing graph when doing a test video capture.  Now things look great and with very few frame drops (76 for a 1:30 video.  90 seconds * 29.97 fps = 2697.3 frames, 76 / 2697.3 = <s>0.282</s> 0.0282 frames dropped (0.0282 * 100 = 2.82%), totally acceptable).<br /><br />I had a bunch else to say about audio stuff (like how apparently <a href="http://www.assemblergames.com/forums/showthread.php?48548-Audio-Comparison-of-different-SNES-revisions" class="postlink">some models of SNES units output a high pitch noise</a> (like mine -- I have the original SNES, not a SNES Jr.), but I realised it's not really relevant since we're focused on the video aspect.<br /><br />Edit: Me doing math wrong (was done right in GNU bc, but I don't tend to copy-paste very much, I type things manually, forgot a zero.  :-)  Thanks Sik!)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132048"></a>
				<b class="postauthor">Sik</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132048">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132048#p132048"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 05, 2014 12:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_online.gif" alt="Online" title="Online" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Aug 12, 2010 3:43 am<br /><b>Posts:</b> 850
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I think you forgot a 0 there (0.0282, or 2.82%).<br /><br />But yeah, so the problem was just bad settings in the end? Go figure. This is probably the most annoying part of video recording, there are just too many settings that can go wrong =P</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4526"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132459"></a>
				<b class="postauthor">93143</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132459">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132459#p132459"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 12, 2014 1:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Jul 04, 2014 9:31 pm<br /><b>Posts:</b> 214
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">While we're waiting...<br /><br />Is there a preferred method of extending VBlank while the IRQ is otherwise occupied?<br /><br />I was thinking of using a couple of HDMA channels; one to toggle the display and one to hijack the interrupt (which would probably have to be in RAM).  This would allow the mode change interrupt code to be as lean as possible, which I imagine is very important for something that runs ~200 times per frame.  But if there's a less hacky way to do the same thing, great.<br /><br />You can't trigger NMI manually, can you?  I gather it doesn't trigger on force blank...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6595"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132462"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132462">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132462#p132462"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 12, 2014 4:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">There's no way I know of to trigger NMI through software -- it's tied to a pin on the CPU, connected to a particular device (PPU VBlank in this case, or some latch chip that connects to that (I'm talking out my ass here, I don't do EE)).  The NMI itself is induced by the hardware it's tied to, e.g. the PPU.<br /><br />You are correct that forced blank will not trigger NMI.<br /><br />About my SD2SNES: still waiting.  <a href="http://shop.retrogate.com/termsandconditions.sc" class="postlink">Estimated delivery time from Germany is 15-20 days</a>, and for whatever reason (intentionally) the product goes through cities in Ukraine before going to the US.  I can read some Cyrillic, but right now it looks like in Ukraine still on its way here.  Last update was on 2014/08/09 and it was originally shipped on 08/05.  So another week or so...</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132463"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132463">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132463#p132463"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 12, 2014 5:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=9_1426464006.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 13842<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">On the NES, if the NMI hasn't been acknowledged (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">BIT $2002</tt>), disabling and reenabling NMI (<tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LDA #$00 STA $2000 LDA #$80 STA $2000</tt>) before vertical blanking has finished will cause an immediate falling edge on /NMI. Does the same thing work on the Super NES?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132464"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132464">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132464#p132464"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 12, 2014 5:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I don't know what &quot;falling edge&quot; means.  This is again more hardware talk and doesn't really shed any light on what actually happens at a software level (read: does the CPU notice hardware NMI and thus run code at NMI vector or not?).  What is it going to take for folks to actually comprehend this point?  :P<br /><br />Likewise, descriptions <a href="http://www.dforce3000.de/pub/doc/anomie_timing.txt" class="postlink">like the below</a> (&quot;forced high&quot;, &quot;output low&quot;, &quot;output high&quot;, etc.) are a little more helpful but not by much.  The below seems to imply that &quot;NMI output low&quot; means &quot;NMI is firing / code at NMI vector will be executed&quot;.  Whether or not that's &quot;falling edge&quot; is unknown to me.<br /><br />A forced blank is accomplished by setting bit 7 of $2100 to 1.  It essentially &quot;turns the screen off&quot; (meaning you get a black screen, or black for whatever duration you set it + unset it), but the electron gun and video synchronisation stuff keep working during this time.<br /><br />Some of the below is irrelevant to the discussion topic.  The important stuff is at the top.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">INTERRUPTS<br />----------<br /><br />The internal timer will set its NMI output low at H=0.5 at the beginning of<br />V-Blank. The CPU's /NMI input is forced high by clearing bit 7 of register<br />$4200, so the CPU may not actually see the NMI transition. The CPU will jump to<br />the NMI routine at the end of the instruction during which /NMI transitions.<br /><br />The internal timer sets its NMI output high at H=0 V=0, or when register<br />$4210 is read. Possibly also when $4200 is written?<br /><br />If the CPU is halted (i.e. for DMA) while /NMI goes low, the NMI will trigger<br />after the DMA completes (even if /NMI goes high again before the DMA<br />completes). In this case, there is a 24-30 cycle delay between the end of DMA<br />and the NMI handler, time enough for an instruction or two.<br /><br /><br />The internal timer will set its IRQ output low under the following conditions<br />('x' and 'y' are bits 4 and 5 of $4200, HTIME is registers $4207-8, and VTIME<br />is $4209-a):<br />&nbsp; yx&nbsp; &nbsp; trigger point<br />&nbsp; 00 =&gt; Never<br />&nbsp; 01 =&gt; H-IRQ:&nbsp; every scanline, H=HTIME+~3.5<br />&nbsp; 10 =&gt; V-IRQ:&nbsp; V=VTIME, H=~2.5<br />&nbsp; 11 =&gt; HV-IRQ: V=VTIME, H=HTIME+~3.5<br /><br />The actual formula for the trigger point is as follows. V-IRQ is just like<br />HV-IRQ with H=0. If H=0, $4211 bit 7 gets set 1374 master cycles after dot 0.0<br />of the previous scanline. Otherwise, it gets set 14+H*4 master cycles after<br />dot 0.0 of the current scanline. Note that the 'dot offset' will change due to<br />the two long dots per scanline. Also, no IRQ will trigger for dot 153 on the<br />short scanline in non-interlace mode, and no IRQ will trigger for dot 153 on<br />the last scanline of any frame.<br /><br />The internal timer will set its IRQ output high when $4211 is read, or when<br />IRQs are disabled by a write to $4200. Note that the expansion port and the<br />cart connector both have access to the /IRQ line, and may be able to trigger<br />IRQs on their own. When enabling IRQs, the IRQ output will go low even if the<br />enable write occurs at the exact cycle when the IRQ is scheduled to trigger<br />For example, if HV-IRQ is set for (0,1) and the last cycle of the STA $4200 is<br />at (0,0)+1372 master cycles, the IRQ line will still go low.<br /><br /><br />The CPU will jump to the NMI or IRQ handler at the end of the instruction when<br />/NMI transitions or when /IRQ is low and the I flag is clear. The actual check<br />occurs just before the final CPU cycle of the instruction, which means that the<br />jump will begin at the earliest 6 to 12 master cycles after /NMI or /IRQ. Also<br />note that PLP, CLI, SEI, SEP #$04, and REP #$04 update the flags during their<br />final CPU cycle, so the IRQ check will use the old value of I rather than the<br />new one set by the current instruction. RTI, BRK, and COP on the other hand do<br />not have this issue.<br /><br />So for the following code:<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;; set up IRQ<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;SEI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;WAI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STZ $00<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;LDA #$01<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;CLI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;LDA #$42<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STP<br />&nbsp;&gt; <br />&nbsp;&gt; IRQHandler:<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STA $00<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;RTI<br />Memory location $00 will end up set to 0x42, not 0 or 1, because the I flag<br />isn't clear before the final cycle of CLI. And for the following code:<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;; set up IRQ<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;SEI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;WAI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;CLI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;SEI<br />The IRQ will actually trigger following the SEI instruction, not before it (but<br />the flags pushed during the IRQ handler will have the I flag set). OTOH, the<br />following code will not allow an IRQ to trigger at all if the RTI sets the I<br />flag:<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;; set up IRQ<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;SEI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;WAI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;CLI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;RTI<br />And the following code (with RTI clearing I):<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;; set up IRQ<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;SEI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;WAI<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STZ $00<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;LDA #$01<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;RTI<br />&nbsp;&gt;<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;; -&gt; RTI returns here<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;LDA #$42<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STP<br />&nbsp;&gt; <br />&nbsp;&gt; IRQHandler:<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;STA $00<br />&nbsp;&gt;&nbsp; &nbsp; &nbsp;RTI<br />Will result in memory location $00 being set to 1, not 0x42.<br /><br />If /NMI and /IRQ are both pending, NMI takes precedence.<br /><br />And the datasheet is inaccurate regarding that first cycle of the IRQ/NMI<br />pseudo-opcode. It's an opcode fetch cycle from PB:PC (typically 6 or 8 master<br />cycles), not an IO cycle (always 6 master cycles) as the datasheet claims.</div><br /><br />There is <a href="http://wiki.superfamicom.org/snes/show/Registers" class="postlink">also this</a>, but it says nothing about NMI:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Note that force blank CAN be disabled mid-scanline. However, this can result in glitched graphics on that scanline, as the internal rendering buffers will not have been updated during force blank. Current theory is that BGs will be glitched for a few tiles (depending on how far in advance the PPU operates), and OBJ will be glitched for the entire scanline. Also, writing this register on the first line of V-Blank (225 or 240, depending on overscan) when force blank is currently active causes the OAM Address Reset to occur.</div><br /><br />And <a href="http://problemkaputt.de/fullsnes.txt" class="postlink">then this</a>:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Forced Blank Color<br />In Forced Blank, the whole screen is Black (no matter of CGRAM settings, Sub<br />Screen Backdrop Color, and Master Brightness settings). Vsync/Hsync are kept<br />generated (sending a black picture with valid Sync signals to the TV set)<br /><br />...<br /><br />2100h - INIDISP - Display Control 1 (W)<br />&nbsp; 7&nbsp; &nbsp; &nbsp;Forced Blanking (0=Normal, 1=Screen Black)<br />&nbsp; 6-4&nbsp; &nbsp;Not used<br />&nbsp; 3-0&nbsp; &nbsp;Master Brightness (0=Screen Black, or N=1..15: Brightness*(N+1)/16)<br />In Forced Blank, VRAM, OAM and CGRAM can be freely accessed (otherwise it's<br />accessible only during Vblank). Even when in forced blank, the TV Set keeps<br />receiving Vsync/Hsync signals (thus producing a stable black picture). And, the<br />CPU keeps receiving Hblank/Vblank signals (so any enabled video NMIs, IRQs,<br />HDMAs are kept generated).<br />&nbsp; Forced blank doesn't apply immediately... so one must wait whatever<br />&nbsp; (maybe a scanline) before VRAM can be freely accessed... or is it only<br />&nbsp; vice-versa: disabling forced blank doesn't apply immediately/shows garbage<br />&nbsp; pixels?</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132466"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132466">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132466#p132466"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Aug 12, 2014 6:14 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=9_1426464006.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 13842<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The 6502 treats NMI differently from IRQ, and I assume that the 65816 behaves the same way.<br /><ul><li>/IRQ is level sensitive. If /IRQ is held low, the CPU will repeatedly call the IRQ vector every time CLI (or PHP with bit 2 clear) is executed. </li><li>/NMI is edge sensitive. A transition from high to low causes a flip-flop to get set in the CPU, and the CPU will call the NMI vector only once and not call it again until the signal goes high and low again. </li></ul>So let me state it from a purely software perspective: On the NES, changing the PPU's NMI enable bit from off to on during vblank causes an immediate call to the NMI vector if the NMI for that frame hasn't already been acknowledged.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132493"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132493">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132493#p132493"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 13, 2014 2:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 871
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; You can't trigger NMI manually, can you?<br /><br />Sure you can.<br /><br />Push P and your return address onto the stack, and then JML to your NMI vector routine =)<br /><br />&gt;  I can read some Cyrillic, but right now it looks like in Ukraine still on its way here.<br /><br />Hopefully it's not being transported on a Malaysia Airlines cargo plane :/</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132494"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132494">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132494#p132494"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 13, 2014 3:26 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7356<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">The way Retrogate does their package tracking is bizarre as hell though -- through some third-party site in Ukraine despite them being in Germany.</div><br />AFAIK, Krikzz, the guy responsible for the Everdrives, lives in Ukraine. For some reason the guy who created the SD2SNES has Krikzz manufacture it. Anyway, I've found retrogate's shipping methods to be pretty reliable, fast and cheap, more so than from any other country I've bought products from (and I never had to pay import taxes for any of my Everdrives or SD2SNES), and the tracking page has an English language option.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132522"></a>
				<b class="postauthor">mikejmoffitt</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132522">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132522#p132522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 13, 2014 1:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://mikejmoffitt.com/img/moft.png" width="96" height="96" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun May 27, 2012 8:43 pm<br /><b>Posts:</b> 731
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">The way Retrogate does their package tracking is bizarre as hell though -- through some third-party site in Ukraine despite them being in Germany.</div><br />AFAIK, Krikzz, the guy responsible for the Everdrives, lives in Ukraine. For some reason the guy who created the SD2SNES has Krikzz manufacture it. Anyway, I've found retrogate's shipping methods to be pretty reliable, fast and cheap, more so than from any other country I've bought products from (and I never had to pay import taxes for any of my Everdrives or SD2SNES), and the tracking page has an English language option.</div><br />I've found it to be all of those things but fast. But still, the items were in stock and I did receive them.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5314"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132538"></a>
				<b class="postauthor">93143</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132538">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132538#p132538"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 13, 2014 4:26 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Jul 04, 2014 9:31 pm<br /><b>Posts:</b> 214
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">&gt; You can't trigger NMI manually, can you?<br /><br />Sure you can.<br /><br />Push P and your return address onto the stack, and then JML to your NMI vector routine =)</div><br />Well, yeah, it sounds silly when you put it like <em>that</em>...<br /><br />I guess what I was hoping for with that question was something I could poke with HDMA, since as far as I'm aware it's the only thing left that auto-triggers on a timer (the IRQ is busy with the mode change and needs to be lean, and the NMI fires too late).  Like tepples' method, but more flexible.  It would be even better if there were a way to freely move the NMI trigger point itself...<br /><br />I suppose I'm not doing too badly as it stands, though.  It seems to me that I could even get away with just using one HDMA channel instead of two, by simply writing a branch into the IRQ code before the last scanline and letting the resulting pseudo-NMI handle the screen blanking.  If the IRQ code ends up having to be in ROM for some reason, I could just have it check a memory location, and have the HDMA write to that location - but that's, what, at least two extra instructions every scanline?  Still faster than checking OPVCT...<br /><br />Since I have almost no experience at SNES coding, I was trying to find out if there's a standard procedure or something that people follow in this situation.  If there isn't, that's okay; I'm sure there's a way to make it work.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6595"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132546"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132546">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132546#p132546"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Aug 13, 2014 6:32 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 871
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Given the extremeness of raster effects, I would recommend writing a very specialized, static loop for the active display area. No IRQs, no checking counters. Each line consumes exactly 1324 cycles. Then run your NMI routine (doesn't even have to be a real NMI since you know you're in Vblank now) to do your game logic, then sync up to V=0,H=0 and start the next frame.<br /><br />That will require some learning on your part in how to calculate exact cycle times and penalties. But set an IRQ for V=261,H=~330 or so and then use WAI. Have that bail out so that you're now within 6 clocks of V=0,H=0. You can actually sync perfectly to V=0,H=0 but it's complicated, so you'll have to learn that on your own.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132609"></a>
				<b class="postauthor">93143</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132609">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132609#p132609"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Aug 15, 2014 1:37 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Jul 04, 2014 9:31 pm<br /><b>Posts:</b> 214
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">How narrow do you think I can get the garbage area?  Or should we wait for better video?<br /><br />I don't know if running the game logic in VBlank is a good idea in this case.  Even with a 144x192 playfield, after accounting for all the stuff that needs to happen via DMA, plus related maneuvering, I figure I'd be lucky to have 20 scanlines of actual compute time left before the mode change loop had to restart.  Anything that didn't fit would have to be offloaded onto the GSU, which is already pretty busy.<br /><br />On the other hand, if I understand correctly, running non-timed game code during active display could produce a variance in the position of the mode switch of up to W*(N-1) pixels, where W is the number of pixels per cycle and N is the number of cycles taken by the longest instruction that could conceivably be executing when the interrupt fires.  If this is the case, it seems to me that minimizing the width of the sprite mask would require this section of the code to be written exclusively with instructions of four cycles or less, which could be very restrictive...  or I could use FastROM in the CPU-only area, which should allow at least five cycles per instruction, maybe six...  unless the interrupt timing itself has jitter, as implied by the use of &quot;~&quot; in the timing docs, which would have to be added to the variance...<br /><br />A cycle-timed game engine (or part of it) could be the best of both worlds.<br /><br />...or I could give up and run most of the game on the GSU, and hope it can handle it...<br /><br /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Given the extremeness of raster effects</div><br />I'm not sure I get this.  To me, using that much mission-critical cycle-timed code in the middle of an active game environment seems more extreme than changing a register in an IRQ, especially if the timed loop eats most of the available CPU power without doing any actual computing...<br /><br />I mean, the IRQ <em>works</em>; it's just a question of how much extra glitch masking it forces me to do.  Am I missing something?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6595"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p132622"></a>
				<b class="postauthor">Augustus Blackheart</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132622">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132622#p132622"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Aug 15, 2014 5:37 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jul 26, 2014 9:50 am<br /><b>Posts:</b> 22
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Here's some video;<br /><br /><a href="http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest.mp4" class="postlink">http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest.mp4</a><br /><a href="http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest-reverse.mp4" class="postlink">http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest-reverse.mp4</a><br /><a href="http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest-scroll.mp4" class="postlink">http://www.morganleahrecords.com/augustus/blackheart/tmp/mtest-scroll.mp4</a></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6621"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p132643"></a>
				<b class="postauthor">93143</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p132643">Re: BGMODE or parameter changes during scanline</a></div><div style="float: right;"><a href="./viewtopic.php?p=132643#p132643"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Aug 16, 2014 3:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Jul 04, 2014 9:31 pm<br /><b>Posts:</b> 214
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">...okay, so it looks like Sik called it.  Apparently you can change <em>from</em> Mode 7, but not <em>to</em> Mode 7, at least if the line doesn't start in Mode 7.  Unless there's a bug in my code that doesn't trigger in higan...<br /><br />Also, something funny is going on with the timing; it doesn't look quite the same as in higan v094.  It looks like there's more jitter on the real system, and the garbage starts sooner.<br /><br />But it looks like the scroll changes work more or less as expected, except that they seem to be widening the garbage area...  Maybe zeroing the scroll, rather than bumping it positive, would have a different effect...<br /><br />It strikes me that a lot of cases may have to be tested for confidence in describing the behaviour.  Then again, I haven't spent a decade writing an obsessively accurate emulator for this system, so maybe it's more clear what's going on to someone who has...<br /><br />...<br /><br />...call me paranoid, but can you confirm that you're using an original SNES, and not a SNES Jr.?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6595"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=11404&amp;start=75"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=11404"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>6</strong> of <strong>8</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 111 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=11404&amp;start=60">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=11404">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=60">5</a><span class="page-sep">, </span><strong>6</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=11404&amp;start=105">8</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=11404&amp;start=90">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=3572">KungFuFurby</a> and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="11404" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;Reproduction</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
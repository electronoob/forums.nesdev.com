<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Wario's Woods EU/AUS (PAL) NSF rip request</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Wario's Woods EU/AUS (PAL) NSF rip request</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=6&amp;t=8887">http://forums.nesdev.com/viewtopic.php?f=6&amp;t=8887</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Milkomeda</b> [ Thu May 10, 2012 3:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Wario's Woods EU/AUS (PAL) NSF rip request</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />One of my favourite childhood games was Wario's Woods and being from Australia I had the PAL version of Wario's Woods which strangely enough featured different BGM from the U.S. version for most of the game. (I distinctively remember the boss battle theme on the PAL version which I loved so so much)
<br />
<br />Would someone be able to kindly enough make a NSF rip of the PAL version for Wario's Woods please then my NES nostalgia would be complete.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>prostkxy</b> [ Fri May 11, 2012 4:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />hi there
<br />
<br />i in australia and have the pal version of this game. let me know step by step what you  need done and i will try and do it for you.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Milkomeda</b> [ Fri May 11, 2012 11:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for offering however I've been incredibly busy the past couple of months so I haven't had the time to learn how to rip NSFs myself otherwise I would've done so already (Which is why I'm asking for a request here)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Fri May 11, 2012 11:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Gil-Galad wrote a guide: <a href="http://gilgalad.arc-nova.org/intro.html" class="postlink">http://gilgalad.arc-nova.org/intro.html</a>
<br />
<br />It's a bit of an adventure though.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri May 11, 2012 11:13 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I didn't know how to rip NSFs, but I managed to change the Dragon Quest 3 NSF into a Dragon Warrior 3 NSF.
<br />
<br />You look at the NSF file specifications, it tells you where to find the Init and Play addresses.
<br />For an NSF, usually the init code is slightly changed (rippers often add in a song selection table).
<br />But the idea is that you know you have two different versions of the same game.  Look at the Init code with a disassembler or hex editor.  Then look at the Play code with a disassembler or hex editor.
<br />Search for the matching code in the other rom.
<br />Then make an NSF from there.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gil-Galad</b> [ Fri May 11, 2012 2:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Also I might add that some do not have an initialization call. You have to build one yourself. Sometimes it's easy to do, sometimes not.
<br />
<br />If you guys don't get it ripped, let me know and I can try it as well.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Milkomeda</b> [ Fri May 11, 2012 3:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Im making an attempt to rip this myself but im not getting very far at all.
<br />
<br />Is it normal to be getting 1 dump file with NES2NSF?
<br />
<br />PAL version of Warios Woods is giving me one dump file
<br />NTSC version is giving me 3 dump files
<br />
<br />I couldn't follow this guide if my life depended on it (But I want to at least try before I give up on it)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gil-Galad</b> [ Fri May 11, 2012 5:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Milkomeda wrote:</div><div class="quotecontent">Im making an attempt to rip this myself but im not getting very far at all.<br /><br />Is it normal to be getting 1 dump file with NES2NSF?<br /><br />PAL version of Warios Woods is giving me one dump file<br />NTSC version is giving me 3 dump files<br /></div>
<br />
<br />Question 1: NES2NSF utility is just a glorified bank splitter. There are some settings in the config file where you can adjust the output size of the file. Default is 16K.
<br />
<br />The utility also scans the ROM and detects any bytes that resemble writing to $4015 and then outputs only those banks.
<br />
<br />STA $4015 - 8D1540
<br />STX $4015 - 8E1540
<br />STY $4015 - 8C1540
<br />
<br />So, yes, it is possible to output more than one bank. Sometimes the utility will pick up on data not associated with the audio driver because three specific bytes were found.
<br />
<br />Each bank, you have to figure out the load address for the start of the bank as well. Sometimes you can figure that out by disassembling the bank.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat May 12, 2012 6:02 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Gil-Galad wrote:</div><div class="quotecontent">The utility also scans the ROM and detects any bytes that resemble writing to $4015 and then outputs only those banks.<br /><br />STA $4015 - 8D1540<br />STX $4015 - 8E1540<br />STY $4015 - 8C1540<br /><br />So, yes, it is possible to output more than one bank. Sometimes the utility will pick up on data not associated with the audio driver because three specific bytes were found.</div>
<br />And if the game never uses the DMC, like mine, it might write #$0F to $4015 at reset and then never touch it in the actual music player, causing the utility not to find the music code at all.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gil-Galad</b> [ Sat May 12, 2012 9:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">And if the game never uses the DMC, like mine, it might write #$0F to $4015 at reset and then never touch it in the actual music player, causing the utility not to find the music code at all.</div>
<br />
<br />That's absolutely right and I've ran into a few situations like that until I stopped using that utility.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Thu May 17, 2012 3:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />B00daW and I ended up ripping it:
<br />
<br /><a href="http://dl.dropbox.com/u/883356/Wario%27s%20Woods%20%28Europe%29.NSF" class="postlink">http://dl.dropbox.com/u/883356/Wario%27s%20Woods%20%28Europe%29.NSF</a>
<br />
<br />What's the process for submitting new NSF rips? Is there an optimizer program they should be run through? (This is only 16k anyway...)
<br />
<br />
<br />As for how we did this, B00daW found the music code/data block in the ROM (I don't know what his process was for this), then copied the INIT code from the NTSC rip. This by itself doesn't work yet, but it's a good starting point, after which the following was done:
<br />
<br />1. Discovered that the game triggers a new song by writing a song number to $F0 (it was $F3 in the NTSC version). I think B00daW did this by poking values in an emulator until he found the one that changes the song.
<br />
<br />2. Traced through the NMI code in the ROM to find where the PLAY routine should point, turned out to be at $8003. (It was $8000 in the NTSC version.)
<br />
<br />3. Still didn't work; eventually we discovered that the PAL version has an initialization subroutine at $8000 that sets up some necessary RAM variables. Called this from INIT, and we had a working NSF.
<br />
<br />4. Tested all 256 possible values for $F0 to find which ones actually made sound. 0-55 all worked. Most were silent above this range, but a few made some broken sounding noises; I didn't include these, I think they were just random data kind of stuff, except 110 (NSF track 57), which sounds similar to 6 (NSF track 7) but without the square channels active. (Feel free to remove it if this was inappropriate. Just edit byte 6 of the NSF from $39 to $38 to get rid of it.)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Thu May 17, 2012 6:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you want to "optimize" an NSF file, there's a way.  FCEUX's code-data logger has a feature to create a "stripped" NES rom, removing any code or data that wasn't used when running the rom.  Fast forward to the max, let each song loop several times, and you have an "optimized" NSF.
<br />
<br />But FCEUX deliberately disables the code-data logger and stripped ROM creator if you loaded an NSF file.  They were concerned about needing to fix an NSF later, which becomes hard to do when the code and data for the rom block is gutted away.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gil-Galad</b> [ Thu May 17, 2012 7:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't use those automatic optimizers anymore. They can cause a lot of problems and eliminates code that could be necessary if used in a ROM. Anything that wasn't included in the rip index would be wiped out as well.
<br />
<br />The information was correct about ripping the game. I made some really simple code. I did rip this game just incase you guys didn't get it. This one is fairly easy to rip. There just isn't hardly any this easy anymore. 
<br />
<br />07:FF80:48        PHA
<br />07:FF81:A9 80     LDA #$80
<br />07:FF83:8D 17 40  STA $4017 = #$FF
<br />07:FF86:A9 0F     LDA #$0F
<br />07:FF88:8D 15 40  STA $4015 = #$FF
<br />07:FF8B:20 00 80  JSR $8000
<br />07:FF8E:68        PLA
<br />07:FF8F:85 F0     STA $00F0 = #$FE
<br />07:FF91:60        RTS
<br />
<br />Writing to $4015 wasn't really necessary in this rip. I almost always start the code off that way so I just left it there after adding the JSR to $8000.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Gil-Galad</b> [ Thu May 17, 2012 7:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Just one more thing.
<br />
<br />At the beginning of the play routine is where you would find that address to switch the tune. A great deal of Nintendo drivers are similar to the same way. This game's audio driver is a little different than a lot of Nintendo drivers though. Some of the older games clear the tune index addresses at the very end of the play code. So, it's easier to find than debugging the code.
<br />
<br />00:8003:A5 F0     LDA $00F0 = #$00
<br />00:8005:C9 FE     CMP #$FE
<br />00:8007:F0 0D     BEQ $8016
<br />00:8009:A2 FE     LDX #$FE

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Thu May 17, 2012 9:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />We both went into this knowing practically no idea what we were doing. I learned much of what I know from watching Gil's YouTube tutorial and applying my own spins. rainwarrior is a beast and stayed up past 5am sorting those tracks. Once you go through the motions of the ripping process things make a lot more sense. It's even fun making your own init code.  Makes me feel like investigating some MuseTracker and SuperNSF NSFs to see what they did to get around playing PCM without frame IRQs.
<br />
<br />Again this was good fun and I hope to do it again.
<br />
<br />...Another thing off my list of things I wanted to do. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
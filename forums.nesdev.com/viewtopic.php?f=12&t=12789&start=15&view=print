<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Now you're playing with gauss!</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Now you're playing with gauss!</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=12&amp;t=12789">http://forums.nesdev.com/viewtopic.php?f=12&amp;t=12789</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Drag</b> [ Wed May 20, 2015 12:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Zoop sounds glitched, like the melody is dropping notes. I know the sound engine in Zoop is a really crazy MIDI-style round-robin allocator, so that means the channels are allocated and initialized as notes are needed, meaning each channel is frequently switching samples and envelopes and properties, versus other engines that have channels organized by instrument or sequence.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Wed May 20, 2015 12:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Okay, so I _definitely_ did not get an email notification for Drag's post. Wtf? I unsubscribed and re-subscribed to this thread. Maybe that will help...<br /><br /><div class="quotetitle">Drag wrote:</div><div class="quotecontent">Zoop sounds glitched</div>If it actually is then it's most likely due to one of the features I'm missing. Either way, Blargg's SPC emulator output wave file for the same SPC sounds identical to mine (I've modified his emulator to have the same missing features as mine). In either case if it is glitchy it'll all be fixed in the near future.<br /><br /><div class="quotetitle">Drag wrote:</div><div class="quotecontent">I know the sound engine in Zoop is a really crazy MIDI-style round-robin allocator</div>This is almost certainly irrelevant as far as the hardware is concerned. The hardware doesn't become more/less complicated just because some developer made the SPC-700 software driver &quot;really crazy&quot;. The hardware is always the same regardless of the sound engine driving it. The sound engine could be trying to determine if P=NP for all I care. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Wed May 20, 2015 1:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">jwdonal wrote:</div><div class="quotecontent">Okay, so I _definitely_ did not get an email notification for Drag's post. Wtf? I unsubscribed and re-subscribed to this thread. Maybe that will help...<br /></div>(off topic) I stopped getting email notifications of PM arrivals about 30 hours ago (last one that arrived was at 19h29 EDT). And I know I'm not running any kind of filtering at all.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>KungFuFurby</b> [ Wed May 20, 2015 6:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Try these SPC sets on for size (I consider these a real challenge):<br />- <a href="http://snesmusic.jukor.net/viewtopic.php?f=26&amp;t=59" class="postlink">Clay Fighter 2 - Judgement Clay</a><br />- <a href="http://snesmusic.jukor.net/viewtopic.php?f=26&amp;t=60" class="postlink">Mickey's Playtown Adventure - A Day of Discovery!</a><br />- <a href="http://snesmusic.jukor.net/viewtopic.php?f=26&amp;t=61" class="postlink">We're Back! A Dinosaur's Story</a><br />- <a href="http://snesmusic.jukor.net/viewtopic.php?f=26&amp;t=957" class="postlink">Shin Togenkyo</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Wed May 20, 2015 10:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sure. I'd be happy to make some recordings. But I don't have time to record all the tracks from all of those sets. (At least not until I get some automation set up.) If you want to suggest 1 particular track from each set I can do that.<br /><br />And I definitely appreciate suggestions for &quot;challenging&quot; SPCs! Any other suggestions are welcome.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>KungFuFurby</b> [ Wed May 20, 2015 10:21 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here's my selection for each one...<br /><br />Clay Fighter 2 ~ Main Menu<br /><br />Mickeys Playtown Adventure ~ Title Screen<br /><br />Shin Togenkyo ~ Main Menu<br /><br />We're Back! A Dinosaur's Story ~ Title Screen

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Drag</b> [ Wed May 20, 2015 12:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If Zoop dropping notes is caused by a missing feature, let me know which feature it is since I have no idea what would cause it. Claymates has a similar round-robin allocator for its music engine, so if that's dropping notes too then it's the same glitch.<br /><br />I only mention it because round-robin allocators are quite different from what most SNES soundtracks use. For instance, if you solo a channel in SMW, you get a single instrument playing a single sequence. If you solo a channel from Zoop or Claymates, you get a bunch of random notes from all instruments.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Wed May 20, 2015 3:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Drag wrote:</div><div class="quotecontent">Zoop sounds glitched, like the melody is dropping notes. I know the sound engine in Zoop is a really crazy MIDI-style round-robin allocator</div><br /><em>Aladdin</em> is glitched as well, but it's always the bass because <em>Aladdin</em> doesn't use round-robin allocation. Your mixer might be missing a channel. Try finding which channel <em>Aladdin</em> plays the bass on, then mute that channel in <em>Zoop</em> and see if it produces the same pattern of missing notes.<br /><br />The comparison to <em>Claymates</em> is apt because one of the unused samples buried in <em>Zoop</em> sings &quot;Clay Fighter&quot;. (This sample isn't even used in the <a href="https://tcrf.net/Zoop_%28SNES%29" class="postlink">hidden track in <em>Zoop</em></a> that sounds vaguely like &quot;Blister in the Sun&quot;.) This leads me to believe it uses an engine similar to Interplay's ARDI (Advanced Realtime Dynamic Interplay) engine, and a <em>Nintendo Power</em> story heavily implied that ARDI is MIDI-based. (The article might have used the name ARDISS for ARDI Sound System.) So did <a href="https://archive.org/stream/snes-nforce-magazine-08/SNESForce_08_Jan_1994_djvu.txt" class="postlink">an article in <em>SNES Force</em></a>.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Wed May 20, 2015 10:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Welp, attempting to play  KungFuFurby's track selections was...umm...far less than what one would call &quot;successful&quot;. LOL. Each of the tracks (except for Togenkyo) played for a few seconds each and then died a very horrible death. Togenkyo didn't even play a single note. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Haha.<br /><br />Ironically, I am incredibly excited about this! It's fantastic to have these difficult tracks available to test with. I will keep working on my player and adding the rest of the features and squashing more bugs and will keep trying these (and Aladdin and Zoop) until they work flawlessly.<br /><br />I love this community. Thanks all!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>KungFuFurby</b> [ Thu May 21, 2015 7:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You've run into the same killer that SNESAmp ran into. Shin Togenkyo is especially noteworthy for me, because it also failed in some of my more current SPC players (an older version of Audio Overload was successful in playing this song), although it usually fails after a few seconds rather than right off the bat (or after a single note). I didn't expect Shin Togenkyo to fail so horribly, though.<br /><br />My instincts are as following...<br /><br />- ENDX may be used for individual samples. Failure to emulate this might be what is causing channel allocation to fail on the Visual Concept games. Plus, these might not even keyed off, meaning allocation is really dependent on those samples stopping.<br /><br />- For Shin Togenkyo, make sure you're emulating both memory wraparound and register wraparound correctly. Memory should be 16 bits, not 32+ bits (and thus should wrap around to zero rather than overflow), and registers should be 8 bits (and thus should also wrap around). There may also be an opcode that you failed to implement (almost all opcodes don't outright crash the SPC700... unless it's SLEEP or HALT).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Thu May 21, 2015 12:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok, so I spent all of 5 seconds looking at the CPU execution debug output of the Togenkyo track (before I had to run to work) and found something very strange... (Again, I haven't delved into this yet, this is just my cursory 5 second assessment of this one track.)<br /><br />The thing I noticed is that the SPC file's restore state value for the SPC-700's stack pointer register is 0x00. And almost immediately after starting execution the code executes the CALL instruction which pushes the high and low program counters to the stack. So the reason that it didn't play a single note on my emulator was because the program is pushing to a full stack which causes my emulator to report and error message and lock up permanently (by design).<br /><br />Any thoughts on this?<br /><br />Also, thank you for your thoughts on what you think the issues were with these tracks I'm sure they will be very helpful in my debugging efforts.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu May 21, 2015 12:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />SPC700 is largely a 65C02 clone. Does it work if you let the stack pointer wrap around from $00 to $FF, as it does on the 65C02?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Thu May 21, 2015 12:58 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I will definitely test that out once I get home.<br /><br />But...am I wrong or isn't the more important question why the program is pushing to a full stack in the first place? That would seem like either a coding error or possibly a dumping error (i.e. incorrect restore state)? I'm just throwing out ideas.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu May 21, 2015 1:26 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The stack on a 6502 processor is empty descending, meaning a push decrements the stack pointer (&quot;descending&quot;) and the stack pointer points to the first address past the valid data (&quot;empty&quot;). Apparently the stack pointer on the SPC700 behaves the same way as that of the 6502. If the SPC700 stack were full descending instead of empty descending, $00 would mean an empty stack.<br /><br />Perhaps it was just sloppy programming by someone who came from a platform with a full descending stack, in which the stack pointer is decremented before the pushed value is written. Both major 8080 descendant families, including <a href="http://www.smspower.org/Development/Stack#TheZ80Stack" class="postlink">Z80</a> and <a href="https://en.wikibooks.org/wiki/X86_Disassembly/The_Stack" class="postlink">x86</a>, use a full descending stack. The vaguely x86-like Sony syntax used by &quot;standard&quot; SPC700 assembly language might have helped with this confusion, which I guess is part of why I prefer 65C02 syntax. <a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0283b/Babefbce.html" class="postlink">ARM also uses a full descending stack</a>, where PUSH is a synonym for STMDB (STore Multiple, Decrease Before) or STMFD (STore Multiple to Full Descending stack), and POP is a synonym for LDMIA (LoaD Multiple, Increase After) or LDMFD (LoaD Multiple from Full Descending stack). This is merely by convention in ARM, but Thumb is hardwired to full descending.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>KungFuFurby</b> [ Thu May 21, 2015 2:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Now you're playing with gauss!</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Native SPC700 syntax is Z80-like to my eyes, actually.<br /><br />The IPL boot routine by default initializes the stack pointer to $EF. I also think the stack pointer should have wraparound implemented.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
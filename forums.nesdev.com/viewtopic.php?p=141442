<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Nametable =&gt; Attribute table address conversion?</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Newbie Help Center" href="http://forums.nesdev.com/feed.php?f=10" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Nametable =&gt; Attribute table address conversion?" href="http://forums.nesdev.com/feed.php?f=10&amp;t=12398" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sat May 09, 2015 9:57 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=10&amp;t=12398">Nametable =&gt; Attribute table address conversion?</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=12398"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 14 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=10&amp;t=12398&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=10&amp;t=12398&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=10&amp;t=12398&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141407"></a>
				<b class="postauthor">Myask</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141407">Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141407#p141407"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 4:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jul 12, 2014 3:04 pm<br /><b>Posts:</b> 169
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Is there an efficient way that the community's already coded to efficiently perform this conversion? I'm pretty sure this na√Øf-approach amalgamation of shifts and carrysets is not the best way.<br />0010 TTYY YyyX XXxx (nametable byte)<br />to<br />0010 TT11 11YY YXXX (attr. table byte) <br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;$palettedex already has the desired palette in low two bits, from figuring out what we're putting there<br />LDA $highaddressin<br />ORA #$0C<br />ASL $lowaddressin ;Y yyXX Xxx0<br />ROL A ;* ***1 1YYY<br />ASL $lowaddressin ;y yXXX xx00<br />ROL $palettedex ;* 0000 0ppy<br />ASL $lowaddressin ;y XXXx x000 (LSB discard)<br />ASL $lowaddressin ;X XXxx 0000<br />ROL A ;* **11 YYYX<br />ASL $lowaddressin ;X Xxx0 0000<br />ROL A ;* *11Y YYXX<br />ASL $lowaddressin ;X xx00 0000<br />ROL A ;* 11YY YXXX<br />STA $lowaddressout<br />ASL $lowaddressin ;x x000 0000<br />ROL $palettedex ;* 0000 ppyx<br />LDA $highaddressin<br />ORA #3 ;0010 TT11<br />STA $highaddressout<br /></div><br />Also, the lookup from the a1,a6 bits for which bit-pair of the attribute byte? It seems like for this, a 16-entry LUT (with the two palette bits also in the index) for speed would be best...<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.db $00, $00, $00, $00, $01, $04, $10, $40, $02, $08, $20, $80, $03, $0C, $30, $C0</div><br />Though, on thinking, one could replace the &quot;ROL $patterndex&quot;es with<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">BCC +&nbsp; ;y1<br />ASL $palettedex ASL $palettedex ASL $palettedex ASL $palettedex<br />+: <br />;and<br />BCC + ;x1<br />&nbsp;ASL $palettedex ASL $palettedex<br />&nbsp;+:</div><br /> in the address conversion routine, for slower/smaller way to accomplish the same thing.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=6603">Myask</a> on Tue Feb 17, 2015 8:53 pm, edited 2 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6603"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141408"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141408">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141408#p141408"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 5:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 2998<br /><b>Location:</b> zurich for this week
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Only thought: for speed, at least, think about restructuring things to avoid the RMW-on-memory instructions; they're enough slower that you may find the overhead of temporarily loading and storing A to be preferable.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141410"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141410">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141410#p141410"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 7:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I just don't do this conversion, ever. What I do is convert a set of coordinates (9-bit X, 9-bit Y) into NT and AT addresses, but I really don't see the point in converting one address to another.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141415"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141415">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141415#p141415"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 8:33 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I don't have 6502 code to convert, but a bitwise conversion is outlined at the <a href="http://wiki.nesdev.com/w/index.php/The_skinny_on_NES_scrolling" class="postlink">skinny scrolling</a> wiki article.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;tile address&nbsp; &nbsp; &nbsp; = 0x2000 | (v &amp; 0x0FFF)<br />&nbsp;attribute address = 0x23C0 | (v &amp; 0x0C00) | ((v &gt;&gt; 4) &amp; 0x38) | ((v &gt;&gt; 2) &amp; 0x07)</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141416"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141416">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141416#p141416"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 8:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">So... this would be my naive approach:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">; tile address in:<br />; v0 = H7 H6 H5 H4 H3 H2 H1 H0<br />; v1 = L7 L6 L5 L4 L3 L2 L1 L0<br /><br />; attribute address out:<br />; a0 = 0&nbsp; 0&nbsp; 1&nbsp; 0&nbsp; H3 H2 1&nbsp; 1&nbsp; &nbsp;($23 | calculations)<br />; a1 = 1&nbsp; 1&nbsp; H1 H0 L7 L4 L3 L2&nbsp; ($C0 | calculations)<br /><br />lda v0<br />ror<br />ror<br />ror<br />ror<br />ror<br />and #$30<br />sta a1&nbsp; &nbsp; &nbsp;; a1 = 0&nbsp; 0&nbsp; H1 H0 0&nbsp; 0&nbsp; 0&nbsp; 0<br />lda v1<br />lsr<br />lsr<br />pha<br />and #$07<br />ora a1<br />sta a1&nbsp; &nbsp; &nbsp;; a1 = 0&nbsp; 0&nbsp; H1 H0 0&nbsp; L4 L3 L2<br />pla<br />lsr<br />lsr<br />and #$08<br />ora a1&nbsp; &nbsp; &nbsp;; A&nbsp; = 0&nbsp; 0&nbsp; H1 H0 L7 L4 L3 L2<br />ora #$C0<br />sta a1&nbsp; &nbsp; &nbsp;; a1 = 1&nbsp; 1&nbsp; H1 H0 L7 L4 L3 L2<br />lda v0<br />and #$0C<br />ora #$23<br />sta a0&nbsp; &nbsp; &nbsp;; a0 = 0&nbsp; 0&nbsp; 1&nbsp; 0&nbsp; H3 H2 1&nbsp; 1&nbsp; <br /></div><br />61 cycles.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> on Tue Feb 17, 2015 9:34 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141424"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141424">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141424#p141424"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 9:12 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Or, yeah, if I just modify the address in-place, I think the following would be 53 cycles.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">; v0:v1 = address in<br />; t&nbsp; &nbsp; &nbsp;= temporary<br /><br />lda v0&nbsp; &nbsp; ; A:v1 = v<br />lsr<br />ror v1<br />lsr<br />ror v1&nbsp; &nbsp; ; A:v1 = v &gt;&gt; 2<br />lda v1<br />and #$07<br />sta t&nbsp; &nbsp; &nbsp;; t&nbsp; = (v &gt;&gt; 2) &amp; $07<br />lda v1&nbsp; &nbsp; ; v1 = (v &gt;&gt; 2) &amp; $FF<br />lsr<br />lsr<br />and #$38&nbsp; ; A&nbsp; = (v &gt;&gt; 4) &amp; $38<br />ora t<br />ora #$C0<br />sta v1&nbsp; &nbsp; ; v1 = ((v &gt;&gt; 2) &amp; $07) | ((v &gt;&gt; 4) &amp; $38) | #$C0<br />lda v0<br />and #$0C<br />ora #$23<br />sta v0&nbsp; &nbsp; ; v0 = ((v &amp; $0C00) | $2300) &gt;&gt; 8</div><br /><br />Do you need to do this more than once per frame? What is use case that your original post wasn't efficient enough for?<br /><br />Another alternative: (49 cycles)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda v1<br />rol&nbsp; &nbsp; &nbsp; &nbsp;; C = L7<br />lda v0<br />pha<br />and #$0C<br />ora #$23<br />sta v0&nbsp; &nbsp; ; A = 0&nbsp; 0&nbsp; 1&nbsp; 0&nbsp; H3 H2 1&nbsp; 1&nbsp; <br />pla<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H1, C = H0<br />ror<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = H1 H0 L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .<br />ror<br />ror<br />and #$38<br />sta t&nbsp; &nbsp; &nbsp;; t = .&nbsp; .&nbsp; H1 H0 L7 .&nbsp; .&nbsp; .<br />lda v1<br />lsr<br />lsr<br />and #$07&nbsp; ; A = .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H4 H3 H2<br />ora t<br />sta v1</div><br /><br />Pardon me coding out loud. I'm just enjoying the exercise.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141427"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141427">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141427#p141427"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 9:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Oh, sorry, I totally missed that you needed the palette index too. Modified that last routine, which is now 63 cycles.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda v1<br />rol<br />rol&nbsp; &nbsp; &nbsp; &nbsp;; A = .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; L7, C = L6<br />rol p&nbsp; &nbsp; &nbsp;; p = 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; P1 P0 L6<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; C = L7<br />lda v0<br />pha<br />and #$0C<br />ora #$23<br />sta v0&nbsp; &nbsp; ; A = 0&nbsp; 0&nbsp; 1&nbsp; 0&nbsp; H3 H2 1&nbsp; 1<br />pla<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H1, C = H0<br />ror<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = H1 H0 L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .<br />ror<br />ror<br />and #$38<br />sta t&nbsp; &nbsp; &nbsp;; t = .&nbsp; .&nbsp; H1 H0 L7 .&nbsp; .&nbsp; .<br />lda v1<br />lsr&nbsp; &nbsp; &nbsp; &nbsp;; C = L0<br />rol p&nbsp; &nbsp; &nbsp;; p = 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; P1 P0 L6 L0<br />lsr<br />and #$07&nbsp; ; A = .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H4 H3 H2<br />ora t<br />sta v1</div><br /><br />I think your original was 68 cycles, so this isn't much of an improvement anyway. Sorry.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141428"></a>
				<b class="postauthor">Myask</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141428">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141428#p141428"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 10:04 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jul 12, 2014 3:04 pm<br /><b>Posts:</b> 169
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="codetitle"><b>Code:</b></div><div class="codecontent">my first<br />LDA/STA zp&nbsp; &nbsp;: 3c x 4 = 12c&nbsp; &nbsp;&nbsp; &nbsp;2b x 4 =&nbsp; 8<br />ORA #&nbsp; &nbsp;&nbsp; &nbsp;: 2c x 2 =&nbsp; 4c&nbsp; &nbsp;&nbsp; &nbsp;2b x 2 =&nbsp; 4<br />ROL A&nbsp; &nbsp;&nbsp; &nbsp;: 2c x 4 =&nbsp; 8c&nbsp; &nbsp;&nbsp; &nbsp;1b x 4 =&nbsp; 4<br />ASL/ROL zp&nbsp; &nbsp;: 5c x 9 = 45c&nbsp; &nbsp;&nbsp; &nbsp;2b x 9 = 18<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 69 cycles, 34 bytes<br />vs (your first)<br />lda/sta zp&nbsp; &nbsp;: 4 x 6 = 24&nbsp; &nbsp;&nbsp; &nbsp;2b x 6 = 12<br />pha/pla&nbsp; &nbsp;&nbsp; &nbsp;: 2 x 4 =&nbsp; 8&nbsp; &nbsp;&nbsp; &nbsp;1b x 4 =&nbsp; 4<br />ROR/LSR A &nbsp; &nbsp;: 2 x 9 = 18&nbsp; &nbsp;&nbsp; &nbsp;1b x 9 =&nbsp; 9<br />AND/ORA #i&nbsp; &nbsp;: 2 x 6 = 12&nbsp; &nbsp;&nbsp; &nbsp;2b x 6 = 12<br />AND/ORA zp&nbsp; &nbsp;: 3 x 2 =&nbsp; 6&nbsp; &nbsp;&nbsp; &nbsp;2b x 2 =&nbsp; 4<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 68 cycles, 41 bytes (66/40 rotating faster)<br />vs (your second)<br />LDA/STA zp: 4c x 7 = 28c&nbsp; &nbsp;2b x 7 = 14b<br />LSR/ROR A :&nbsp; &nbsp;2c x 4 =&nbsp; 8c&nbsp; &nbsp;1b x 4 =&nbsp; 4b<br />ROR/LSR zp: 5c x 2 = 10c&nbsp; &nbsp;2b x 2 =&nbsp; 4b<br />AND/OR #i : 2c x 5 = 10c&nbsp; &nbsp;2b x 5 = 10b<br />ORA zp&nbsp; &nbsp;&nbsp; : 3c x 1 =&nbsp; 3c&nbsp; &nbsp;2b x 1 =&nbsp; 2b<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;59 cycles, &nbsp; &nbsp;&nbsp; &nbsp;34 bytes<br /></div><br />Absolute commands are a byte and cycle bigger than zp: (47b,82c) vs (48b,74c) vs (44b,69c) <s>making</s> your [first] code better in both metrics.<br />(pre-post edit:)<br />(34b 52c) -&gt; 42b 62c for non-zp<br />(32b 49c) -&gt; 37b 54c if our address is not zp. (like t wouldn't be.)<br /><br /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">Pardon me coding out loud. I'm just enjoying the exercise.</div><br />Certainly.<br /><br />(Simple optimization to your first: ASL A x 4 instead of ROL A x 5 ,since you're already ANDing off unused bits, and you don't have to put everything through the carry.)<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">What I do is convert a set of coordinates (9-bit X, 9-bit Y) into NT and AT addresses</div><strong>An efficient way to do that would be just as pertinent here.</strong>..though one wonders why 9-bit and not 6 if we're dealing with tiles. (self-reply: Sprites vs BG, duh.) Of course, that makes the NT address 0010 YXyy yyyx xxxx, a bit annoying... (that is, Y8, X8, Y7-3, X7-3)<br /><br /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">Do you need to do this more than once per frame? What is use case that your original post wasn't efficient enough for?</div>I was mainly curious if people had code-golfed it down to a gold-standard, since it seemed like a thing that every program ever needed to do. (Though on reflection I suppose one only needs to do it once per strip pushed to the PPU, breaking strips on nametable boundaries...)<br /><br />My code is still in the theory stage. &gt;&gt;; I suspect going further would be prudent before we get too engaged in Virtua Code Golf.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">convert-coord-to-NT:<br />LDA $obj-hiY<br />ASL A<br />ORA $obj-hiX ;maybe store hiXY together and use BCC+XOR to change each<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ; to avoid carry issues?<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; ;Nah, makes collision sizes other than 'equality' hard.<br />ORA #$08<br />STA $high-addr<br />LDA $obj-loY<br />ASL A<br />ROL $high-addr<br />ASL A<br />ROL $high-addr<br />AND $E0<br />STA $low-addr<br />LDA $obj-loX<br />LSR LSR LSR<br />ORA $low-addr<br />STA $low-addr<br /><br />convert-coord-to-AT:<br />LDA $obj-hiY ;though I suspect these might get ,x<br />ASL A<br />ORA $obj-hiX<br />ASL A&nbsp; ASL A<br />ORA #$23<br />STA $high-addr<br />LDA $obj-loX<br />ASL A<br />ROL $low-addr<br />ASL A<br />ROL $low-addr<br />ASL A<br />ROL $low-addr<br />LDA #7<br />AND $low-addr<br />STA $low-addr<br />LDA $obj-loY<br />AND #$E0<br />LSR LSR<br />ORA #$C0<br />ORA $low-addr<br />STA $low-addr<br /></div><br /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">(palette-index too)</div><br />But shouldn't p be getting L7 L1? The LSB of X/Y (L6, L0) for tiles is ignored within the same 16x16 palette block. L7/L1 select which pair of bits you need to set for that 16x16.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6603"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141431"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141431">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141431#p141431"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 10:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">As for your palette lookup conversion, comparing size and speed for what you originally posted:<br /><br />inline version: +12 bytes<br />cycles added: -4, 5, 15, 17 (8.25 average case)<br /><br />lookup version: +19 bytes (16 byte table, LDA ABS X)<br />cycles added: 4<br /><br />This is presuming LDA ZP (if inline) vs LDX ZP, LDA ABS X (lookup) when you go to use the thing.<br /><br />If you were using my last version of the code, the inline version is incompatible, I think.<br /><br /><br />However, if your goal is to do this many times per frame, optimizing these routines probably doesn't help much unless you need kinda random access to the tiles. If you're trying to update a contiguous row of tiles, you only need to do the calculation once at the start of the row, and then the thing to optimize is probably the continuation loop afterwards?</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> on Tue Feb 17, 2015 10:30 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141432"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141432">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141432#p141432"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 10:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Oops! Yes, I misread what was going on with the palette bits. A quick revision, no change in speed.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda v1<br />rol<br />php<br />rol p&nbsp; &nbsp; &nbsp;; p = 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; P1 P0 L7<br />plp&nbsp; &nbsp; &nbsp; &nbsp;; C = L7<br />lda v0<br />pha<br />and #$0C<br />ora #$23<br />sta v0&nbsp; &nbsp; ; A = 0&nbsp; 0&nbsp; 1&nbsp; 0&nbsp; H3 H2 1&nbsp; 1<br />pla<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H1, C = H0<br />ror<br />ror&nbsp; &nbsp; &nbsp; &nbsp;; A = H1 H0 L7 .&nbsp; .&nbsp; .&nbsp; .&nbsp; .<br />ror<br />ror<br />and #$38<br />sta t&nbsp; &nbsp; &nbsp;; t = .&nbsp; .&nbsp; H1 H0 L7 .&nbsp; .&nbsp; .<br />lda v1<br />lsr<br />lsr&nbsp; &nbsp; &nbsp; &nbsp;; C = L1<br />rol p&nbsp; &nbsp; &nbsp;; p = 0&nbsp; 0&nbsp; 0&nbsp; 0&nbsp; P1 P0 L7 L1<br />and #$07&nbsp; ; A = .&nbsp; .&nbsp; .&nbsp; .&nbsp; .&nbsp; H4 H3 H2<br />ora t<br />sta v1</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141435"></a>
				<b class="postauthor">Myask</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141435">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141435#p141435"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Feb 17, 2015 10:51 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Jul 12, 2014 3:04 pm<br /><b>Posts:</b> 169
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Use of X0/Y0 (your L0/L6) [technically, X3, Y3 as fine discard etc. etc.] in palettes for ExGrafx is possible but presently beyond me. Though, that would remove the need for the shift-table as they appear to always be in the uppermost two bits in ExGrafx anyway...and...one writes it DURING rendering? Weird.<br /><br />And yes, we don't need to recalculate along a line; so long as we've broken it between tables, one can just perform simple additions to the attribute address of whatever we're loading up before we send to PPU...which increments by 1 per four horizontal tiles or 8 per four vertical.<br /><br />Is it common practice to store a copy of attribute tables in CPU address space, so one doesn't have to re-read them to mask off/on palette bitpairs?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6603"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141441"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141441">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141441#p141441"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 18, 2015 12:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1384529626.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 2176<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yes, it's extremely common to keep attributes in RAM for updating. Reading back through $2007 probably isn't a good approach unless you're just trying to update one or two tiles in a frame.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p141442"></a>
				<b class="postauthor">Bregalad</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141442">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141442#p141442"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 18, 2015 1:09 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=38.jpg" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 12, 2004 2:49 pm<br /><b>Posts:</b> 6321<br /><b>Location:</b> Jongny, VD, Switzerland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Personally what I do is that I use index by 4x4 or 2x2 metatiles, and &quot;converts&quot; them to AT or NT indexes using lookup tables. Converting them using shifts is always possible but so annoying and unpractical with the 6502 instruction set.<br /><br />For example in the case of vertical mirroring it'd look like that :<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">NTLookupH_LSB<br />&nbsp; &nbsp; .db $00, $04, $08, $10, $18, ....<br /><br />NTLookupH_MSB<br />&nbsp; &nbsp; .db $20, $20, $20, $20, ....., $24, $24, $24, $24, .....<br /><br />NTLookupV_LSB<br />&nbsp; &nbsp; .db $00, $40, $80, $c0, $00, .......<br /><br />NTLookupV_MSB<br />&nbsp; &nbsp; &nbsp;.db $20, $20, $20, $20, $21, ....<br /><br />ATLookupH_LSB<br />&nbsp; &nbsp; &nbsp;.db $00, $01, $02, $03, $04, ....&nbsp; ; This table can be optimized out<br /><br />ATLookupH_MSB<br />&nbsp; &nbsp; &nbsp;.db $23, $23 ,$23, $23, $23, $23, ....., $27, $27, $27&nbsp; &nbsp;; This table can be optimized out (re-using NTLookupH_MSB and OR with #$03)<br /><br />ATLookupV_LSB<br />&nbsp; &nbsp; &nbsp; .db $00, $08, $10, $18, $20, ...<br /><br />ATLookupV_MSB<br />&nbsp; &nbsp; &nbsp; &nbsp;.db $23 ,$23, $23, $23, $23&nbsp; &nbsp; &nbsp; &nbsp; ; This table should be optimized out (i.e. constant byte)<br /></div><br /><br />In the end since I optimize out half of the table it becomes a mixing of &quot;traditional&quot; shifting/compare and lookup tables, using the best of both.<br /><br />To compute a NT or AT adress, just OR the values from the horizontal and vertical tables with the corresponding horizontal and vertical address.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=38"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p141461"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p141461">Re: Nametable =&gt; Attribute table address conversion?</a></div><div style="float: right;"><a href="./viewtopic.php?p=141461#p141461"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Feb 18, 2015 10:03 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Myask wrote:</div><div class="quotecontent"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">What I do is convert a set of coordinates (9-bit X, 9-bit Y) into NT and AT addresses</div><strong>An efficient way to do that would be just as pertinent here.</strong>..though one wonders why 9-bit and not 6 if we're dealing with tiles. (self-reply: Sprites vs BG, duh.)</div><br />I don't have my code with me right now, but I don't think it does anything particularly clever.<br /><br />I use 9-bit coordinates because of the camera, since most of the time tiles are drawn around the edges of the camera as it scrolls through the level.<br /><br />Now that I think of it, I don't think I ever needed to calculate the address of a &quot;random&quot; AT byte, because I always buffered the attribute tables in RAM and updated entire rows or columns of them at a time (it was actually faster than updating only the part that was on screen).<br /><br />I would eventually need it when I implemented removable background objects (although some games, such as Somari, just draw blank tiles when items are collected, so there's no need to modify the attributes), but I didn't get that far.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=10&amp;t=12398"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=12398"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 14 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 0 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="12398" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10" selected="selected">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;Reproduction</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
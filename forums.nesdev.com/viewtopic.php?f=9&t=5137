<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Emulating MMC1 in VHDL: HELP</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NES Hardware and Flash Equipment" href="http://forums.nesdev.com/feed.php?f=9" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Emulating MMC1 in VHDL: HELP" href="http://forums.nesdev.com/feed.php?f=9&amp;t=5137" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=9&amp;t=5137';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sat Sep 20, 2014 10:24 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=9&amp;t=5137">Emulating MMC1 in VHDL: HELP</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=5137"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 28 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=5137&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=9&amp;t=5137&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=9&amp;t=5137&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=9&amp;t=5137&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=9&amp;t=5137&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46425"></a>
				<b class="postauthor">kathaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46425">Emulating MMC1 in VHDL: HELP</a></div><div style="float: right;"><a href="./viewtopic.php?p=46425#p46425"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 01, 2009 9:54 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3875.png" width="54" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 07, 2009 9:20 am<br /><b>Posts:</b> 20
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">This is an edited version of the MMC1 portion of the CPLD code in the UNES.  Hypothetically it is connected to 256k PRG ROM and 128k CHR ROM, with no RAM.  Unfortunately all I can achieve is a black screen on powerup.  Can anyone see anything here that is incorrect?
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">--**************************************************************************************************<br />--&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;SHIFT REGISTER PROCESS<br />--**************************************************************************************************<br />PROCESS &#40;prgcein&#41;<br />&nbsp; &nbsp;VARIABLE count: INTEGER RANGE 0 TO 5;&nbsp; &nbsp;--THIS IS THE PLACEHOLDER SHIFT THING<br />&nbsp; &nbsp;BEGIN<br />&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;prgcein = '0' AND prgcein'EVENT&#41; THEN&nbsp; &nbsp;--CLOCK IN WHEN PRG /CE GOES LOW<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;prgrw = '0'&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--PUT PRG R/W MUST BE LOW AS WELL<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;prg_data&#40;7&#41; = '1'&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--IF THE RESET BIT IS SET<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := 0;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--THEN RESET THE COUNTER<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R0 &lt;= R0 OR &quot;01100&quot;;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--init reg0 at 0x0c<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R1 &lt;= &quot;00000&quot;;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--reset the rest to 0x00<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R2 &lt;= &quot;00000&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R3 &lt;= &quot;00000&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ELSE&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--OTHERWISE THIS IS A NORMAL CLOCK IN OF DATA<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;q_s&#40;count&#41; &lt;= s_in;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--PLACE THE DATA INTO THE NEXT MSB<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := count + 1;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--INCREMENT THE COUNTER<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;count = 5&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--IF WE'VE CLOCKED IN 5 BITS<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := 0;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--RESET THE COUNTER<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CASE prg_addr_in&#40;14 DOWNTO 13&#41; IS&nbsp; &nbsp;&nbsp; &nbsp;--OUTPUT THE REGISTER BASED ON THE ADDRESS<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;00&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R0 &lt;= q_s;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;01&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R1 &lt;= q_s;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;10&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R2 &lt;= q_s;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;11&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;R3 &lt;= q_s;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END CASE;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />END PROCESS;<br />--**************************************************************************************************<br />--&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;MIRRORING PROCESS<br />--**************************************************************************************************<br />PROCESS &#40;chr_addr_in, R0&#41;<br />&nbsp; &nbsp;--IF R0&#40;1&#41; = 1, THEN R0&#40;0&#41; DEFINES HORIZONTAL OR VERTICAL MIRRORING &#40;0-&gt;vert 1-&gt;horiz&#41;<br />&nbsp; &nbsp;IF&#40;R0&#40;1&#41; = '1'&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;cirama10 &lt;= &#40;chr_addr_in&#40;10&#41; AND &#40;R0&#40;0&#41;&#41;&#41; OR &#40;chr_addr_in&#40;11&#41; AND NOT R0&#40;0&#41;&#41;;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;ELSE<br />&nbsp; &nbsp;--IF R0&#40;1&#41; = 0, THEN R0&#40;0&#41; DEFINES WHICH NAMETABLE IS BEING ACCESSED<br />&nbsp; &nbsp;--I.E. SINGLE SCREEN MIRRORING&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;cirama10 &lt;= R0&#40;0&#41;;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;END IF;<br />END PROCESS;<br />--**************************************************************************************************<br />--&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;MAPPING PROCESS<br />--**************************************************************************************************<br />PROCESS&#40;R0, R1, R2, R3, prg_addr_in, chr_addr_in&#41;<br />&nbsp; &nbsp;BEGIN<br />&nbsp; &nbsp;--PRG BUS ADDRESS SWITCHING<br />&nbsp; &nbsp;IF&#40;R0&#40;3&#41; = '1'&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;--when we're doing 16k bankswitching<br />&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;R0&#40;2&#41; = '1'&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;--when we're swapping the lower bank<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;17&#41; &lt;= R3&#40;3&#41; OR prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;16&#41; &lt;= R3&#40;2&#41; OR prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;15&#41; &lt;= R3&#40;1&#41; OR prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;14&#41; &lt;= R3&#40;0&#41; OR prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ELSE&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--when we're swapping the upper bank<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;17&#41; &lt;= R3&#40;3&#41; AND prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;16&#41; &lt;= R3&#40;2&#41; AND prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;15&#41; &lt;= R3&#40;1&#41; AND prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;14&#41; &lt;= R3&#40;0&#41; AND prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;ELSE&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--when we're doing 32k bankswitching<br />&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;17&#41; &lt;= R3&#40;3&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;16&#41; &lt;= R3&#40;2&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;15&#41; &lt;= R3&#40;1&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;prg_addr_out&#40;14&#41; &lt;= prg_addr_in&#40;14&#41;;<br />&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;--PRG ROM CONTROL LINES&nbsp; &nbsp;<br />&nbsp; &nbsp;prgceout &lt;= STD_LOGIC&#40;prgcein OR NOT&#40;prgrw&#41;&#41;;<br />&nbsp; &nbsp;--CHR BUS ADDRESS SWITCHING<br />&nbsp; &nbsp;IF&#40;R0&#40;4&#41; = '1'&#41; THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;chr_addr_in&#40;12&#41; = '1'&#41; THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;chr_addr_out&#40;16 DOWNTO 12&#41; &lt;= R2&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ELSE<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;chr_addr_out&#40;16 DOWNTO 12&#41; &lt;= R1&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;ELSE<br />&nbsp; &nbsp;&nbsp; &nbsp;chr_addr_out&#40;16 DOWNTO 13&#41; &lt;= R1&#40;4 DOWNTO 1&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;chr_addr_out&#40;12&#41; &lt;= chr_addr_in&#40;12&#41;;<br />&nbsp; &nbsp;END IF;<br />END PROCESS;<br /></div>
<br />If it's not too much to look at XD any input would be greatly appreciated.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3875"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46438"></a>
				<b class="postauthor">loopy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46438">Re: Emulating MMC1 in VHDL: HELP</a></div><div style="float: right;"><a href="./viewtopic.php?p=46438#p46438"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 02, 2009 4:33 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:52 pm<br /><b>Posts:</b> 253<br /><b>Location:</b> UT
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Tried simulating?
<br />
<br />My VHDL is rusty, but I'll give it a shot.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">q_s&#40;count&#41; &lt;= s_in;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--PLACE THE DATA INTO THE NEXT MSB <br />count := count + 1;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--INCREMENT THE COUNTER <br />IF&#40;count = 5&#41; THEN&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--IF WE'VE CLOCKED IN 5 BITS <br />&nbsp; count := 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--RESET THE COUNTER <br />&nbsp; CASE prg_addr_in&#40;14 DOWNTO 13&#41; IS&nbsp; &nbsp; &nbsp; --OUTPUT THE REGISTER BASED ON THE ADDRESS <br />&nbsp; &nbsp; &nbsp;WHEN &quot;00&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R0 &lt;= q_s; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;01&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R1 &lt;= q_s; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;10&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R2 &lt;= q_s; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;11&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R3 &lt;= q_s; <br />&nbsp; END CASE;<br /></div><br /><br />I don't think Rx is catching the latest bit in q_s.  Instead, try:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">q_s&#40;count&#41; &lt;= s_in;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--PLACE THE DATA INTO THE NEXT MSB <br />count := count + 1;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--INCREMENT THE COUNTER <br />IF&#40;count = 5&#41; THEN&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--IF WE'VE CLOCKED IN 5 BITS <br />&nbsp; count := 0;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--RESET THE COUNTER <br />&nbsp; CASE prg_addr_in&#40;14 DOWNTO 13&#41; IS&nbsp; &nbsp; &nbsp; --OUTPUT THE REGISTER BASED ON THE ADDRESS <br />&nbsp; &nbsp; &nbsp;WHEN &quot;00&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R0 &lt;= s_in &amp; q_s&#40;3 DOWNTO 0&#41;; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;01&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R1 &lt;= s_in &amp; q_s&#40;3 DOWNTO 0&#41;; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;10&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R2 &lt;= s_in &amp; q_s&#40;3 DOWNTO 0&#41;; <br />&nbsp; &nbsp; &nbsp;WHEN &quot;11&quot; =&gt; <br />&nbsp; &nbsp; &nbsp; &nbsp; R3 &lt;= s_in &amp; q_s&#40;3 DOWNTO 0&#41;; <br />&nbsp; END CASE;<br /></div>
<br />Oh, and you might want to try using M2 instead of /CE for your clock.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46442"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46442"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46442#p46442"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 02, 2009 9:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've got Z80 on the brain, but I'd double check when is the data valid from the 2A03.  From a quick glance, I don't think you have it correct.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46454"></a>
				<b class="postauthor">kathaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46454"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46454#p46454"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat May 02, 2009 9:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3875.png" width="54" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 07, 2009 9:20 am<br /><b>Posts:</b> 20
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Alright  I'm trying to figure this out but nothing seems to work.  Can anyone show me what a typical write to an MMC1 looks like in terms of logic levels?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3875"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46459"></a>
				<b class="postauthor">kyuusaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46459"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46459#p46459"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 12:05 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=20.png" width="75" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:13 pm<br /><b>Posts:</b> 1667<br /><b>Location:</b> .ma.us
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Maybe you shouldn't clock the parallel registers asynchronously. I don't think they're reset on D7 either.
<br />
<br />I believe this is right (from memory and sorry for the pseudo-HDL, I stay away from VHDL):
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">on &#40;!romsel&#41; // neg edge<br />&#123;<br />&nbsp; &nbsp;if &#40;!rw &amp;&amp; d&#91;7&#93;&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;count = 0; // async reset<br />&nbsp; &nbsp;&nbsp; &nbsp;data = 0;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;elseif &#40;!rw &amp;&amp; !count&#91;2&#93;&#41;<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;count &lt;= count + 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;data &lt;= &#123;d&#91;0&#93;,data&#91;3:1&#93;&#125;;<br />&nbsp; &nbsp;&#125;<br />&nbsp; &nbsp;elseif &#40;!rw &amp;&amp; count&#91;2&#93;&#41; // making it the 5th clock<br />&nbsp; &nbsp;&#123;<br />&nbsp; &nbsp;&nbsp; &nbsp;count = 0; // async<br />&nbsp; &nbsp;&nbsp; &nbsp;reg&#91;a&#91;14:13&#93;&#93; &lt;= &#123;d&#91;0&#93;,data&#125;;<br />&nbsp; &nbsp;&#125;<br />&#125;</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=20"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46472"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46472"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46472#p46472"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 11:00 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just looked at a 6502 datasheet.  It still doesn't look like you are reading the data off the bus at the correct time.  
<br />
<br />I'd use on the falling edge of M2 when RW is low.  You may be able to get by on the rising edge of RW, but falling edge of RW is definitely wrong.
<br />
<br />Let us know if you get it working.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46473"></a>
				<b class="postauthor">loopy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46473"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46473#p46473"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 11:13 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:52 pm<br /><b>Posts:</b> 253<br /><b>Location:</b> UT
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I do everything on rising M2 in my powerpak  mappers.  My MMC1 code:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">always@&#40;posedge m2&#41; begin<br />&nbsp; &nbsp;if&#40;~rw &amp;&amp; ain&#91;15&#93;&#41; begin<br />&nbsp; &nbsp;&nbsp; &nbsp;latch &lt;= &#123;din&#91;0&#93;,latch&#91;3:1&#93;&#125;;<br />&nbsp; &nbsp;&nbsp; &nbsp;if&#40;din&#91;7&#93;&#41; begin<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg0 &lt;= 'b01100;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&#123;reg1, reg2, reg3, count&#125; &lt;= 0;<br />&nbsp; &nbsp;&nbsp; &nbsp;end else begin<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if&#40;~count&#91;2&#93;&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count &lt;= count+1;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else begin<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count&lt;=0;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;case&#40;ain&#91;14:13&#93;&#41;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;0:reg0&lt;=&#123;din&#91;0&#93;,latch&#125;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;1:reg1&lt;=&#123;din&#91;0&#93;,latch&#125;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;2:reg2&lt;=&#123;din&#91;0&#93;,latch&#125;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;3:reg3&lt;=&#123;din&#91;0&#93;,latch&#125;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;endcase<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;end<br />&nbsp; &nbsp;&nbsp; &nbsp;end<br />&nbsp; &nbsp;end<br />end<br /></div>
<br />
<br />(edit)
<br />Oh, something else I just thought of... what does your R0 reset to? (hard reset, not D7 write)</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=4">loopy</a> on Sun May 03, 2009 11:55 am, edited 3 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46474"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46474"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46474#p46474"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 11:37 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">loopy wrote:</div><div class="quotecontent">I do everything on rising M2 in my powerpak  mappers.</div>
<br />
<br />Wouldn't be the first time I'm wrong.  I looked at another 6502 datasheet and came to the same conclusion,but like I said I've got Z80 on the brain.  Do you have any documentation that you can point me to that would say rising_edge of M2?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46475"></a>
				<b class="postauthor">loopy</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46475"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46475#p46475"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 11:41 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:52 pm<br /><b>Posts:</b> 253<br /><b>Location:</b> UT
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">2600 wrote:</div><div class="quotecontent">Do you have any documentation that you can point me to that would say rising_edge of M2?</div>
<br />No docs. That's what bunnyboy's example mapper did, so I followed suit.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46477"></a>
				<b class="postauthor">kyuusaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46477"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46477#p46477"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 1:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=20.png" width="75" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 2:13 pm<br /><b>Posts:</b> 1667<br /><b>Location:</b> .ma.us
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Data is latched inside the 6502 on the falling edge, but output data seems to be valid on the rising edge.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=20"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46480"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46480"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46480#p46480"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 2:27 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">kyuusaku wrote:</div><div class="quotecontent">Data is latched inside the 6502 on the falling edge, but output data seems to be valid on the rising edge.</div>
<br />
<br />Which data sheet are you looking at?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46484"></a>
				<b class="postauthor">kathaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46484"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46484#p46484"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 4:05 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3875.png" width="54" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 07, 2009 9:20 am<br /><b>Posts:</b> 20
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Alright well I've tried almost everything, always with the same black screen.  I'm starting to think this is maybe a hardware problem.  I have reg0 to init to 0x0C on startup and on every reset of the PLD, but I haven't verified that it's working.
<br />
<br />This is my most recent code, which is still not working:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;PROCESS &#40;m2_in, reset&#41;<br />&nbsp; &nbsp;VARIABLE count: INTEGER RANGE 0 TO 5;<br />&nbsp; &nbsp;BEGIN<br />&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;reset = '0'&#41;THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg0 &lt;= &quot;01100&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ELSIF&#40;m2_in = '1' AND clk_in'EVENT&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;--on positive edge of M2&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;&#40;prgrw_in OR prgce_in&#41; = '0'&#41; THEN&nbsp; &nbsp;--when R/W is low and /CE is low<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;q_s&#40;count&#41; &lt;= s_in;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;r_in = '1'&#41; THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg0 &lt;= &quot;01100&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg1 &lt;= &quot;00000&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg2 &lt;= &quot;00000&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg3 &lt;= &quot;00000&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := 0;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ELSE<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;count = 5&#41; THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := 0;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CASE dest_in IS<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;00&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg0 &lt;= q_s&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;01&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg1 &lt;= q_s&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;10&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg2 &lt;= q_s&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;WHEN &quot;11&quot; =&gt;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg3 &lt;= q_s&#40;4 DOWNTO 0&#41;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END CASE;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ELSE&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;count := count + 1;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;&nbsp; &nbsp;END IF;<br />&nbsp; &nbsp;END PROCESS;<br />&nbsp; &nbsp;reg0out &lt;= reg0;<br />&nbsp; &nbsp;reg1out &lt;= reg1;<br />&nbsp; &nbsp;reg2out &lt;= reg2;<br />&nbsp; &nbsp;reg3out &lt;= reg3;<br /></div>
<br />
<br />I've been playing with an MMC1 cart and I can write data into <em>it</em>, using some dip switches, I think next I'm gonna pull my UNES apart and see if I can write to it the same way.
<br />
<br />And also, the reset in the code is just a signal sent to the PLC from the MCU when the NES is OFF (low = off).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3875"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46487"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46487"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46487#p46487"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 5:20 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">kathaku wrote:</div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;PROCESS &#40;m2_in, reset&#41;<br />&nbsp; &nbsp;VARIABLE count: INTEGER RANGE 0 TO 5;<br />&nbsp; &nbsp;BEGIN<br />&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;reset = '0'&#41;THEN<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;reg0 &lt;= &quot;01100&quot;;<br />&nbsp; &nbsp;&nbsp; &nbsp;ELSIF&#40;m2_in = '1' AND clk_in'EVENT&#41; THEN&nbsp; &nbsp;&nbsp; &nbsp;--on positive edge of M2&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;IF&#40;&#40;prgrw_in OR prgce_in&#41; = '0'&#41; THEN&nbsp; &nbsp;--when R/W is low and /CE is low<br /><br /></div><br /><br />.</div>
<br />
<br />1. I don't write my VHDL like this, and don't recall if it is valid.  Specifically, 
<br />m2_in = '1' AND clk_in'EVENT
<br />
<br />I'd either say rising_edge(m2_in)  or m2_in = '1' AND m2_in'EVENT
<br />
<br />2. You have prgrw_in OR prgce_in  shouldn't that be an AND instead of OR
<br />
<br />3. If it was me, I'd probably put the IF prgrw_in part before the rising_edge(M2_in).  
<br />
<br />4. I'd also add prgrw_in and prgce_in to the Process statement.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p46496"></a>
				<b class="postauthor">kathaku</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46496"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46496#p46496"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 03, 2009 10:39 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3875.png" width="54" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 07, 2009 9:20 am<br /><b>Posts:</b> 20
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">My bad, that clk_in'EVENT is a typo.  It is actually m2_in'EVENT.  I would put the IF prgrw_in = '0' first but my compiler can't accept any conditions above an edge condition.
<br />
<br />Now, IF((prgrw_in OR prgce_in) = '0') logically equates to true if they are both low.  Something like IF((prgrw_in AND prgce_in) = '0') would be true if one or the other, or both, were zero.  In that case, reads or writes would be considered a write to the MMC1, but correct me if I'm wrong - I've been staring at this code so long  it's all blurring together.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3875"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p46501"></a>
				<b class="postauthor">2600</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p46501"></a></div><div style="float: right;"><a href="./viewtopic.php?p=46501#p46501"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon May 04, 2009 4:12 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 07, 2007 10:28 am<br /><b>Posts:</b> 74
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">kathaku wrote:</div><div class="quotecontent"><br />Now, IF((prgrw_in OR prgce_in) = '0') logically equates to true if they are both low.  Something like IF((prgrw_in AND prgce_in) = '0') would be true if one or the other, or both, were zero.  In that case, reads or writes would be considered a write to the MMC1, but correct me if I'm wrong - I've been staring at this code so long  it's all blurring together.</div>
<br />
<br />I see what you are saying, but try to avoid writing like that as I'll get it confused.  Now I have to go back and think about what you wrote.
<br />You could write
<br />
<br /> if ((prgrw_in  = '0') AND (prgce_in ='0')) then
<br />
<br />to avoid confusion.  I think we both will agree that is correct.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3385"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=9&amp;t=5137"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=5137"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 28 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=5137&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=9&amp;t=5137&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="5137" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9" selected="selected">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
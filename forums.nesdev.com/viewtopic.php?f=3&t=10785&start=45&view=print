<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - How hard is it to write an emulator ?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">How hard is it to write an emulator ?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10785">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=10785</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>4</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Sun Dec 15, 2013 10:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />&gt; So what would you do when you emulate a 4 GB CF-like or SD-like card, such as the 3DS or PS Vita Game Card?<br /><br />My understanding is that mmap will page in and out sections of the card as needed, so you'd be hit with a lot of swapping penalties. If you don't even have the space for the mmap() section, then you'd have to roll your own solution to try and cache what you could, but mostly load from disk.<br /><br />NDS tends to be more stream-based anyway. It's a serial bus, after all. No fully random access like on the GBA.<br /><br />Probably better to ask someone like Exophase who has emulated the NDS on low-power phones.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sun Dec 15, 2013 1:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">byuu wrote:</div><div class="quotecontent">If you don't even have the space for the mmap() section</div><br />Which would be the case for, say, a 2 GB or larger ROM image on a 32-bit emulator. It'd have to fall back to CD-style emulation, letting the OS do the disk caching.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Sun Dec 15, 2013 1:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The benefit of language features is rapid development, so that Microsoft or Mozilla or Google can finish a web browser that lets you post on forums.nesdev.com before you die.<br /></div><br />Man, that statement is beyond awesome. <img src="./images/smilies/Mfr_icon_homebrew.png" alt=":beer:" title="Beer" />  <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />In regard to disk emulation, how is the FDS handled ? I suppose that since disk capacity is very small anyways, the emu caches the entire file, and copy the contents of it to the emulated RAM when something is loaded from the disk, and simulate a delay of 6 seconds ? That's the approach that makes the most sense, and until a game that uses 100+ disk is released, it'd be no problems.<br /><br />How comes no emu simulates the sound click generated by the disk drive ? I think that makes a difference as opposed to the real hardware, it makes the loading more &quot;tolerable&quot;.<br />On the other hand I like the instant disk switching of emus without having to get up from your sofa...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Programming with a type system allows compile-time checking of certain program correctness axioms associated with each type.</div><br />Objects and types are two distinct concepts.<br />A &quot;purely oriented language&quot; means<br />1) Everything is an object<br />2) All methods (including the main program) should be method related to an object.<br /><br />This makes no sense in my opinion. Methods being functions with are closely related to a particular data structure. How can Main be related to a data structure ? And why should simple things such as &quot;int&quot; or &quot;bool&quot; be objects ? Nonsense. In my honest opinion, no more than ~10-20% of stuff should be object oriented in a program. Of course it depends on the situation overall. Any more than that, and you enter in the field of &quot;computer science of clouds and arrows&quot; which I find particularly annoying.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zelex</b> [ Tue Dec 17, 2013 11:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok, yeah I can see how programming a NES is similar to writing a NES emulator. You learn memory mapped IO (that it exists at all). These things also exist on PC, but these days you never interact with them directly. But knowing whats going on underneath the hood is very valuable.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Thu Dec 19, 2013 11:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">...resampling... I don't get the insistence on doing it themselves.</div><br />Because it's fun?<br /><br />Besides, the max sample rate that DirectSound supports, on my system at least, is 200kHz.  So some sort of resampling needs to happen before handing it off to the OS.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Grapeshot</b> [ Fri Dec 20, 2013 1:37 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't think any console with ROM cartridges larger than 128mb supports direct code execution from that memory, mainly because mask ROMs larger than that are generally built on the pattern of NAND Flash instead of NOR Flash. In such cases you're generally loading certain pages of the ROM into memory via DMA as the game requests it (which works just fine with a mmap()ed file). <br /><br />You might have to adjust the copying speed to match the actual console, though. Several NDS games would crash or fail to show FMVs if data couldn't be loaded from a slow SD card in a flash cart fast enough, and some PlayStation anti-piracy methods depended on the precise transfer speed of the CD-ROM as the anti-piracy checks would load new data over the currently executing code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Dec 20, 2013 6:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Grapeshot wrote:</div><div class="quotecontent">I don't think any console with ROM cartridges larger than 128mb supports direct code execution from that memory, mainly because mask ROMs larger than that are generally built on the pattern of NAND Flash instead of NOR Flash. In such cases you're generally loading certain pages of the ROM into memory via DMA as the game requests it (which works just fine with a mmap()ed file).</div><br />Nintendo 64 uses XIP and has plenty of 256 Mbit games and a couple 512 Mbit games (Conker and Resident Evil 2), but because of Rambus latency, the CPU requests a &quot;page&quot; at a time and caches it. Does that count?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">and some PlayStation anti-piracy methods depended on the precise transfer speed of the CD-ROM as the anti-piracy checks would load new data over the currently executing code.</div><br />So that's why PS2's fast CD-ROM mode defaulted off.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Joe</b> [ Fri Dec 20, 2013 11:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Nintendo 64 uses XIP and has plenty of 256 Mbit games and a couple 512 Mbit games (Conker and Resident Evil 2), but because of Rambus latency, the CPU requests a &quot;page&quot; at a time and caches it. Does that count?</div>I think the N64 hardware is capable of XIP (ROM is mapped to the CPU address space), but no games ever use it. You're probably thinking of how some games use demand paging, where the page fault handler loads data from ROM to RAM.<br /><br />Even the boot code that initializes the RAM controller doesn't execute from ROM: it gets copied from the cartridge ROM to the RSP's internal RAM (which is also mapped to the CPU address space) and executes from there!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Fri Dec 20, 2013 5:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Grapeshot wrote:</div><div class="quotecontent">and some PlayStation anti-piracy methods depended on the precise transfer speed of the CD-ROM as the anti-piracy checks would load new data over the currently executing code.</div><br /><br />Please cite an example of this. I've never ever heard of any PS1 game having anything like this. There is the normal copy protection on every disc, and then I've heard of Anti-Mod software protections that detect a working classic modchip, plus the LibCrypt on some PAL games. The transfer speed on the PS1 certainly isn't precise, and that makes no sense as a copy protection measure either. Whatever you can elaborate on this would be appreciated.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Fri Dec 20, 2013 5:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've definitely heard of it, but as unsafe programming practice, not copy protection. (After all, it wouldn't help at all given a copy of the disk).<br /><br />As I understand it, it takes effort and code size to poll for when the data you want is ready, so they instead just figured &quot;it'll take N seconds to load this much data off a 2x CDROM, so we'll just time the executing code to match&quot; and then the data arrives too early and overwrites something before the other loop is ready for it to...<br /><br />Another possibility is dropping sectors because the game's CDROM read handler isn't fast enough to deal with a higher throughput.<br /><br />Then again, maybe that's myth; I can't find a modern-day citation of this.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Grapeshot</b> [ Fri Dec 20, 2013 8:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />All right, I went back and looked at <a href="http://www.gamasutra.com/view/feature/131439/keeping_the_pirates_at_bay.php" class="postlink">the Gamasutra article on Spyro 3 copy protection</a>, which I thought had mentioned dynamically overlaying code over the protection routines, but that isn't mentioned. What this game did instead was use several different checksum routines in different code overlays that would calculate checksums of both chunks of game data and the other checksum routines, then use some of those checksums as decryption keys for other data. <br /><br />The systems where I know disk drive speed and timing are absolutely critical are the Apple II and the Amiga, though those are of course using floppy disks not CDs. I did find a mention on Wikipedia of the Xbox 360 calculating angular distances between sectors to check the legitimacy of a game DVD, but whoever is trying to build an Xbox 360 emulator will have many more problems than that to contend with.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Dec 21, 2013 6:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: How hard is it to write an emulator ?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So Spyro 3's copy protection is along some of the same lines as <a href="http://blog.kevtris.org/blogfiles/EWJ2PROT.TXT" class="postlink">Earthworm Jim 2</a>. You might have been thinking of <a href="https://en.wikipedia.org/wiki/Data_position_measurement" class="postlink">data position measurement</a>, used to an extent by both <a href="https://en.wikipedia.org/wiki/CD-Cops" class="postlink">CD-Cops</a> and <a href="https://en.wikipedia.org/wiki/SecuROM" class="postlink">SecuROM</a>.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>4</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
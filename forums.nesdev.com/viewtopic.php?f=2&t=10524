<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Questions about code details in the Nerdy Nights tutorial</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Questions about code details in the Nerdy Nights tutorial" href="http://forums.nesdev.com/feed.php?f=2&amp;t=10524" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=10524';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun May 10, 2015 1:59 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=10524">Questions about code details in the Nerdy Nights tutorial</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=10524"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 20 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=10524&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=10524&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=10524&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=10524&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=10524&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118487"></a>
				<b class="postauthor">DRW</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118487">Questions about code details in the Nerdy Nights tutorial</a></div><div style="float: right;"><a href="./viewtopic.php?p=118487#p118487"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 12:15 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 07, 2013 2:59 pm<br /><b>Posts:</b> 180
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'd like to clear up some things in the Nerdy Nights tutorial that I didn't understand.<br /><br />As an example, I use the code in this file:<br /><!-- w --><a class="postlink" href="http://www.nespowerpak.com/nesasm/background2.zip">www.nespowerpak.com/nesasm/background2.zip</a><!-- w --><br /><br /><br />1. There is vblankwait1 to make sure that the PPU is ready. But in the next step, all he does is resetting the RAM values. Before he actually accesses the PPU, he does a second vblankwait. So, is the first one even necessary? And if yes, why?<br /><br />1.1. The guy who converted the source code to CC65 even included a third vblankwait between the end of LoadPalettes and the start of LoadSprites. Is that necessary?<br /><br />2. In clrmem, when the sprites are put outside the screen, why are the sprite data ($0200-$02FF) set to value #$FE instead of #$FF?<br /><br />3. In the initialization, right before the Forever loop, the following line is written:<div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #%00011110&nbsp; &nbsp;; enable sprites, enable background, no clipping on left side<br />&nbsp; STA $2001</div><br />But later, in the PPU clean up section, this is done anyway. So, why is it done right before the infinite loop? Manipulating the values there (like disabling sprites) doesn't seem to have any influence on the program anyway. The only time the manipulation of these values shows any effect is in the PPU cleanup section.<br /><br />4. In one of the first chapters he said that the initialization is not enough for a real NES, but good enough for an emulator. Does that still apply to this chapter or is the initialization complete now?<br /><br />5. As far as I see it, the first color in the sprite palette (which is rendered transparent for the sprite anyway) will be the global background color of the screen, is this correct? Why did they choose to do it like that? Why not the first color of the background palette?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6156"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118488"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118488">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118488#p118488"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 12:25 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=9_1426464006.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 13836<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">2. In clrmem, when the sprites are put outside the screen, why are the sprite data ($0200-$02FF) set to value #$FE instead of #$FF?</div><br />Probably someone afraid that $FF would cause sprites to appear on line 0. (It doesn't.) Any value from $F0 to $FF works.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">3. In the initialization, right before the Forever loop, [rendering is turned on.] But later, in the PPU clean up section, this is done anyway. So, why is it done right before the infinite loop?</div><br />I don't know if this particular example uses a scroll split. But if you are using a scroll split, as in a status bar, you need to have rendering turned on before waiting for the split point. Sprite 0 (common in discrete and MMC1 games) and MMC3 scanline IRQs will not trigger if rendering is off. Turning on rendering first avoids an infinite loop while waiting for a split point that never triggers.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">5. As far as I see it, the first color in the sprite palette (which is rendered transparent for the sprite anyway) will be the global background color of the screen, is this correct? Why did they choose to do it like that? Why not the first color of the background palette?</div><br />PPU $3F00 and $3F10 point to the same actual location inside the PPU. Whatever is written to last will control the backdrop color. And if you just copy in 32 bytes, as a lot of programs do, $3F10 will end up controlling.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118491"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118491">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118491#p118491"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 12:48 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 2049<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Probably someone afraid that $FF would cause sprites to appear on line 0. (It doesn't.) Any value from $F0 to $FF works.</div><br />As does $EF, because of the one scanline delay in sprite rendering.</div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">Download STREEMERZ for NES from <a href="http://www.fauxgame.com" class="postlink">www.fauxgame.com</a>!</span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118492"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118492">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118492#p118492"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 12:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">1. There is vblankwait1 to make sure that the PPU is ready. But in the next step, all he does is resetting the RAM values. Before he actually accesses the PPU, he does a second vblankwait. So, is the first one even necessary? And if yes, why?</div><br />Yes, because you have to wait 2 frames (actually it's only 1 frame, but 1 wait loop does not guarantee a 1 frame delay) before the PPU is ready to be used, and each loop only waits 1 frame. Don't be deceived by the comments, the PPU is NOT ready after the first wait. Notice how the PPU is not used between the loops, only the CPU is used.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">1.1. The guy who converted the source code to CC65 even included a third vblankwait between the end of LoadPalettes and the start of LoadSprites. Is that necessary?</div><br />Maybe. In <a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9465" class="postlink">this thread</a> we discussed how much time is actually necessary. Tests have proven that the PPU needs nearly a frame (~29658 CPU cycles) to be ready, but since you have to account for resets and such, you might need more wait loops to be absolute sure that this much has passed before the PPU is used. In that thread, we concluded that 2 wait loops are fine (you may clear the RAM between them if you wish) as long as you read $2002 first, to make sure the first loop doesn't end prematurely. Without the $2002 read, 3 wait loops would be necessary, which might be the case of the sources you're talking about.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">2. In clrmem, when the sprites are put outside the screen, why are the sprite data ($0200-$02FF) set to value #$FE instead of #$FF?</div><br />Anything between $EF and $FF will be outside the screen, although $EF will still be found by the sprite rendering logic - if you don't want that for some reason, stick to $F0-$FF for hiding sprites.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">3. In the initialization, right before the Forever loop, the following line is written:<div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #%00011110&nbsp; &nbsp;; enable sprites, enable background, no clipping on left side<br />&nbsp; STA $2001</div><br />But later, in the PPU clean up section, this is done anyway. So, why is it done right before the infinite loop? Manipulating the values there (like disabling sprites) doesn't seem to have any influence on the program anyway. The only time the manipulation of these values shows any effect is in the PPU cleanup section.</div><br />That might indeed be redundant. If it's done every frame during VBlank, there's no need to do it before the game loop. Might be a left over from a program that doesn't setup the PPU every frame.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">4. In one of the first chapters he said that the initialization is not enough for a real NES, but good enough for an emulator. Does that still apply to this chapter or is the initialization complete now?</div><br />Except for reading $2002 before the first wait for VBlank, everything appears to be initialized properly.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">5. As far as I see it, the first color in the sprite palette (which is rendered transparent for the sprite anyway) will be the global background color of the screen, is this correct? Why did they choose to do it like that? Why not the first color of the background palette?</div><br />There's some memory mirroring involved. The PPU has enough memory to hold 28 colors: 4 x 4 background colors (yes, it can store different colors in the first slot of each background palette, but only the one in the first palette is actually displayed) and 4 x 3 sprite colors, but the first slot in each sprite palettes is a mirror of the first slot in the corresponding background palette, so if you write the sprites colors last they'll overwrite the mirrored background colors.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118521"></a>
				<b class="postauthor">DRW</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118521">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118521#p118521"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 3:39 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 07, 2013 2:59 pm<br /><b>Posts:</b> 180
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">About 2 and 5:<br />O.k., I understand that now.<br /><br /><br />About 1:<br /><div class="quotetitle">tkumaru wrote:</div><div class="quotecontent">In <a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9465" class="postlink">this thread</a> we discussed how much time is actually necessary. Tests have proven that the PPU needs nearly a frame (~29658 CPU cycles) to be ready, but since you have to account for resets and such, you might need more wait loops to be absolute sure that this much has passed before the PPU is used.</div><br />Why is this implemented in the following way?<br /><em>Do something<br />waitvblank<br />Do something<br />waitvblank<br />Do something<br />waitvblank</em><br /><br />Why not just:<br /><em>waitvblank 10 times (should be more than enough)<br />Do everything</em><br />?<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">In that thread, we concluded that 2 wait loops are fine (you may clear the RAM between them if you wish) as long as you read $2002 first, to make sure the first loop doesn't end prematurely. Without the $2002 read, 3 wait loops would be necessary, which might be the case of the sources you're talking about.</div><br />O.k., I can't really follow you anymore. Sorry, that's all too technical.<br />If I post my own program code of my sample program based on that tutorial, could you please check if everything is correct, what can be removed and what is wrong?<br /><br /><br />About 3:<br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">That might indeed be redundant. If it's done every frame during VBlank, there's no need to do it before the game loop. Might be a left over from a program that doesn't setup the PPU every frame.</div><br />Is it even good to do this every frame? How about this: If I write this code right before the forever loop:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #%10010000<br />&nbsp; STA $2000<br />&nbsp; LDA #%00011110<br />&nbsp; STA $2001<br />&nbsp; LDA #$00<br />&nbsp; STA $2005<br />&nbsp; STA $2005</div>and don't do anything as PPU cleanup before returning from the NMI interrupt, wouldn't that be fine as well? Why should I do the above code after every frame if doing it once in the beginning works without problems?<br /><br /><br />Besides, when is the NMI called? Before the current frame or after the current frame? For example if I don't use the above code before everything else, but only in every NMI call, does that mean the first frame isn't influenced by that code (because the NMI is called after each frame, so the first time the code is called is between the first and the second frame)? Or is the NMI code the preparation for the frame output, meaning that whatever is written in the NMI function is applied to every frame because it comes before the output?<br /><br /><br />About 4:<br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Except for reading $2002 before the first wait for VBlank, everything appears to be initialized properly.</div><br />What do you mean? The first time $2002 is read is during the waitvblank function. O.k., technically it is before the first vblank, but how else should he check if the vblank has occured?<br />So, what should be changed in the code?<br /><br /><br />Isn't there a program to disassemble NES games? This way we could see the source code of some very simple, yet official Nintendo game, like &quot;Donkey Kong&quot;, and see how this one is initialized. Wouldn't that be more effective than discussing how many frames the PPU might need etc.? This way you would have a definite way, demonstrated by the inventors of the NES.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6156"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118522"></a>
				<b class="postauthor">3gengames</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118522">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118522#p118522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 3:46 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly 65024U</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 27, 2010 12:57 pm<br /><b>Posts:</b> 2174
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">1: Because, why make your game inefficient and crap? Wait for the 1st one, do everything that needs done setting up your engines an such, wait 2nd, set up your engine the rest of the way and start rendering video/get ready to, 3rd+ run whatever...loading code, menus, etc. It taks maybe 8-9 frames total, after the 2 waited, to load a screen and get the menu running if you're lucky.<br /><br />3: It's example code, NN is actually very....not shit, but not great written code, it's average...lots of places for improvement in it.<br /><br />4: You set the NMI and time everything off that. The NMI shown above will not work 100% of the time, it's only good for booting. NMI program to run the vblank code and run the main engine is how it works, you get to set NMI enable by the PPU register $2000, and start running it like:<br /><br />(Main process)<br />-ends, and waits for an flag to change that means NMI has run-<br />(NMI)<br />-tells main process NMI has happened.<br /><br />My main code is:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Frame is a incrementing counter. Each NMI, it goes up 1.<br />Main engine:<br />-vblank code-<br />-main engine-<br />&nbsp; LDA Frame<br />.WaitForNMI:<br />&nbsp; CMP Frame<br />&nbsp; BEQ .WaitForNMI<br />&nbsp; JMP -to vblank code-<br /><br />NMI:<br />&nbsp; INC Frame<br />&nbsp; RTI<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4311"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118525"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118525">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118525#p118525"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Sep 22, 2013 4:37 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">Why is this implemented in the following way?</div><br />That's up to the programmer. I like to do the basic initialization stuff (SEI, CLD, stack, etc.), then this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;bit $2002<br />-&nbsp; &nbsp;bit $2002<br />&nbsp; &nbsp;bpl -<br />-&nbsp; &nbsp;bit $2002<br />&nbsp; &nbsp;bpl -</div><br />Then I consider the system &quot;initialized&quot;. I choose not to clear the RAM like many tutorials suggest, because IMO that tends to hide bugs that would normally arise from you forgetting to initialize specific variables (which you should always do, you shouldn't expect any variables to start out as 0).<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">If I post my own program code of my sample program based on that tutorial, could you please check if everything is correct, what can be removed and what is wrong?</div><br />Most of us don't mind reviewing small sections of code, but when someone posts their entire 1 mile long ASM file, that tends to drive people away.<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Is it even good to do this every frame?</div><br />For games that change these parameters during gameplay, it makes sense. For example, games that use a status bar might enable/disable sprites at the split point so that they don't appear in front of the status bar, and that's a setting they'll have to reset every frame.<br /><br />Another reason to have this in the VBlank handler is to make sure that rendering will not be enabled in the middle of the screen, causing a quick but possibly annoying glitched frame before the gameplay starts. Some people let it run every frame even though it's only necessary for the first frame because it's easier that way.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">How about this: If I write this code right before the forever loop:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #%10010000<br />&nbsp; STA $2000<br />&nbsp; LDA #%00011110<br />&nbsp; STA $2001<br />&nbsp; LDA #$00<br />&nbsp; STA $2005<br />&nbsp; STA $2005</div>and don't do anything as PPU cleanup before returning from the NMI interrupt, wouldn't that be fine as well?</div><br />Yes, as long as you wait for VBlank before doing this, otherwise you'll get that glitched frame I talked about above.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Besides, when is the NMI called?</div><br />As soon as VBlank starts, so you can make use of that time for VRAM/PPU updates.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Before the current frame or after the current frame?</div><br />I guess it makes sense to say that the NMI happens before the frame, because it's in the NMI that you'll set up everything (background updates, sprites, scroll, etc.) for the following frame.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The first time $2002 is read is during the waitvblank function. O.k., technically it is before the first vblank, but how else should he check if the vblank has occured?<br />So, what should be changed in the code?</div><br />The problem with this loop is that if it starts in the middle of VBlank, there will be no waiting at all, the loop will immediately end. Reading $2002 beforehand (outside of the loop) will clear the VBlank flag, making sure that the loop that follows will wait for the NEXT Vblank, regardless of whether it's VBlank now or not.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Isn't there a program to disassemble NES games? This way we could see the source code of some very simple, yet official Nintendo game, like &quot;Donkey Kong&quot;, and see how this one is initialized.</div><br />We have seen how many official games work, and they all differ greatly.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Wouldn't that be more effective than discussing how many frames the PPU might need etc.?</div><br />We know for a fact how much time is needed for the PPU to be ready, what we discuss is the most effective way of waiting that time. Official games didn't always do things the best possible way. If all you want is to be safe and not bother with the hardware details, just do 3 typical VBlank wait loops in a row and you're good to go.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">This way you would have a definite way, demonstrated by the inventors of the NES.</div><br />Don't assume that programmers back then knew more about the system than we do today. The early games were often programmed while the system was still being developed, so the hardware could still be going through changes, meaning that there could be left over code in these games from when the console was not yet final. Also, from what we know, the programmers weren't given particularly good documentation, and didn't have much time to study the system, because of deadlines and such. I know it may sound surprising, but looking at what official games do isn't always be the best way to learn, because programmers back then were often in a hurry and would go with go through a good deal of trial and error to achieve what they wanted.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118573"></a>
				<b class="postauthor">DRW</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118573">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118573#p118573"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 23, 2013 3:44 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 07, 2013 2:59 pm<br /><b>Posts:</b> 180
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Most of us don't mind reviewing small sections of code, but when someone posts their entire 1 mile long ASM file, that tends to drive people away.</div><br />Yeah, I understand that of course. I will post the parts that are there for hardware-dependent initialization stuff. Please tell me if anything is missing, anything is unnecessary or whatever remarks you have. For example, is the whole &quot;disable this, disable that&quot; necessary? Isn' t it disabled by default?<br />All in all, I understood the general things that you all told me. So, if you could tell me what's wrong with the following code (like the waitvblank stuff: Where and how should I read the value again to be sure everything is fine? And with LDA or again with BIT?), that would be great. Passages with question marks are stuff where I don't really get what is done there from a logical perspective or what it is good for.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.segment &quot;CODE&quot;<br /><br />Reset:<br />&nbsp; SEI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable IRQ???<br />&nbsp; CLD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable decimal mode.<br />&nbsp; LDA #$40<br />&nbsp; STA $4017&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable APU frame IRQ???<br />&nbsp; LDX #$FF<br />&nbsp; TXS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Put stack pointer at $FF. Does this reset the stack status?<br />&nbsp; LDA #$00<br />&nbsp; STA $2000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable NMI???<br />&nbsp; STA $2001&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable rendering???<br />&nbsp; STA $4010&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable DMC IRQ???<br /><br />WaitVBlank:<br />&nbsp; BIT $2002<br />&nbsp; BPL WaitVBlank<br /><br />&nbsp; LDX #$00<br /><br />ClearRam:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Set the RAM at 0, except for the sprites that go outside the screen.<br />&nbsp; LDA #$00<br />&nbsp; STA $0000, X<br />&nbsp; STA $0100, X<br />&nbsp; STA $0300, X<br />&nbsp; STA $0400, X<br />&nbsp; STA $0500, X<br />&nbsp; STA $0600, X<br />&nbsp; STA $0700, X<br />&nbsp; LDA #$F0<br />&nbsp; STA $0200, X<br />&nbsp; INX<br />&nbsp; BNE ClearRam<br /><br />WaitVBlank2:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PPU is ready after this.<br />&nbsp; BIT $2002<br />&nbsp; BPL WaitVBlank2<br /><br />; SKIPPED CODE: Load palettes into PPU<br />; SKIPPED CODE: Load sprites to $0200<br />; SKIPPED CODE: Load background into PPU<br />; SKIPPED CODE: Load attributes into PPU<br /><br />FinalInitialization:<br />&nbsp; LDA #%10010000&nbsp; &nbsp; &nbsp; &nbsp; ; Enable NMI??? Enable sprites from Pattern Table 0, background from Pattern Table 1.<br />&nbsp; STA $2000<br />&nbsp; LDA #%00011110&nbsp; &nbsp; &nbsp; &nbsp; ; Enable sprites, enable background, no clipping on left side<br />&nbsp; STA $2001<br />&nbsp; LDA #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Tell the ppu there is no background scrolling???<br />&nbsp; STA $2005<br />&nbsp; STA $2005<br /><br />@Loop:<br />&nbsp; JMP @Loop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Wait until the interrupt puts the program at Nmi.<br /><br />Nmi:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Jumped to once per frame.<br /><br />Dma:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; DMA for sprite copying.<br />&nbsp; LDA #$00<br />&nbsp; STA $2003&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Set low byte ($00) of the RAM address.<br />&nbsp; LDA #$02<br />&nbsp; STA $4014&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Set high byte ($02) of the RAM address and start sprite transfer.<br /><br />; SKIPPED CODE: Read controller<br />; SKIPPED CODE: Check for each button<br /><br />; Should the controller be read before or after the sprite copy function?<br /><br />&nbsp; RTI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; NMI is finished.<br /><br /><br />.segment &quot;VECTORS&quot;&nbsp; &nbsp; &nbsp; ; The interrupts.<br />&nbsp; .word Nmi<br />&nbsp; .word Reset<br />&nbsp; .word $0000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; IRQ isn't used.</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6156"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118575"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118575">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118575#p118575"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 23, 2013 4:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=9_1426464006.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 13836<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">is the whole &quot;disable this, disable that&quot; necessary? Isn' t it disabled by default?</div><br />If the program enabled these things, and the player pressed the Reset button on the Control Deck, then these things will remain enabled. The Reset button doesn't do much except modify the stack pointer, disable interrupts, and cause the CPU to JMP ($FFFC). (On the front-loading NES, it also resets the PPU, but not on any top-loading console.)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">.segment &quot;CODE&quot;<br /><br />Reset:<br />&nbsp; SEI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable IRQ???</div></div><br />IRQ is disabled whenever the CPU is reset. However, disabling them explicitly allows JMP ($FFFC) to work like the reset button.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #$40<br />&nbsp; STA $4017&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable APU frame IRQ???</div></div><br />APU frame IRQ is a feature of the 2A03 that generates a 60 Hz time base even when no PPU is connected. It's rarely used on the NES; it may be used more often in arcade games that use the 2A03 as a sound processor.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDX #$FF<br />&nbsp; TXS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Put stack pointer at $FF. Does this reset the stack status?</div></div><br />What do you think you mean by &quot;stack status&quot;?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #$00<br />&nbsp; STA $2000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable NMI???</div></div><br />NMI (non-maskable interrupt) is how the PPU tells the CPU that it has completed rendering one frame. Copying the new sprite display list to OAM takes 520 cycles. After NMI, the CPU has about 2200 cycles to send changes to the background and sprites to the PPU. Disabling NMI allows the CPU to complete the init code without being bothered by these notifications.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; STA $2001&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable rendering???</div></div><br />This blanks the screen so that the CPU can load in a new background.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; STA $4010&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable DMC IRQ???</div></div><br />The 2A03 contains hardware to play back compressed sampled sound. DMC IRQ (delta modulation channel interrupt request) is how it tells the CPU that a sound has finished playing.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">FinalInitialization:<br />&nbsp; LDA #%10010000&nbsp; &nbsp; &nbsp; &nbsp; ; Enable NMI??? Enable sprites from Pattern Table 0, background from Pattern Table 1.</div></div><br />Now that most of the init code is finished, the CPU is ready to receive notifications that each frame has finished. When the CPU receives this notification, it calls the NMI handler. Some programs are designed to run all the code inside the NMI handler; others just set a flag stating that the notification has been received.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Tell the ppu there is no background scrolling???<br />&nbsp; STA $2005<br />&nbsp; STA $2005</div></div><br />Writes to $2005 set the scroll position of the background. The first sets the horizontal position, and the second the vertical.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">; Should the controller be read before or after the sprite copy function?</div></div><br />The first thing the NMI handler should do is write all needed background and sprite changes to the PPU, as there are only 2200 cycles to do so before the next frame begins. After that, the program should start preparing the next frame, and the first thing to do when preparing the next frame is read the controller. So because it belongs to the following frame the controller should be read after the sprite copy.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118583"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118583">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118583#p118583"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Sep 23, 2013 6:12 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">Isn' t it disabled by default?</div><br />Even if it is, sometimes the hardware goes through small revisions and things change... some mappers for example have shown different power on status across different revisions (MMC1A vs. MMC1B, etc.). The PPU and the CPU have gone through a few revisions too, and although we're not sure whether something relevant changed, it doesn't hut to initialize everything to the specific state we want. Also, like tepples said, there's the reset button to consider.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">like the waitvblank stuff: Where and how should I read the value again to be sure everything is fine? And with LDA or again with BIT?</div><br />BIT or LDA (or also LDX, LDY, CMP, and many other instructions) will work just fine for reading $2002, the only advantage of using BIT is that the contents of A remain untouched. Might not seem like a big deal in the initialization code, but if you ever have to read flags in the middle of the game logic, preserving A might be an advantage, so many people make a habit of using BIT for this.<br /><br />I don't think you need another $2002 read. The code you have will work fine after power on. On the Famicom and on the top loading NES there could be a situation when those two loops don't wait enough time for the PPU to warm up, but since the PPU isn't reset in that case, it's already warmed up, so it's all good I think.<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #$00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Tell the ppu there is no background scrolling???<br />&nbsp; STA $2005<br />&nbsp; STA $2005</div></div><br />That comment is a bit misleading... Writing to $2005 tells the PPU which part of the name tables you want to be visible. Writing $00 twice means that the top left corner of the name table will be at the top left corner of the screen. It doesn not mean that &quot;there's no scrolling&quot;, because on the next NMI you might decide to write another value to $2005 and then there will be background scrolling.<br /><br />What I mean is that $00 is just one of the possible values you can write to $2005, and it doesn't necessarily mean the absense of scrolling, becouse you could very well write $80, $00 to $2005 and as long as you never touched that register again there would be no scrolling either, you'd just permanently see another part of the name tables.<br /><br />Scrolling is not something the PPU does automatically, it's the programmer who creates the illusion of scrolling by changing what parts of the name tables are visible a little every frame. If you don't modify anything, there's no scrolling.<br /><br />Anyway, resetting the scroll is something that should be done every frame, after you're done with all PPU updates. That's because writing to the PPU messes up its internal address register, which is also used for rendering the picture. If you don't reset the scroll, you'll get a messed up picture in the following frame. The reason you're getting away with resetting the scroll just once is because you're not doing any PPU updates (the OAM DMA doesn't count, because sprites go to a different memory that doesn't need the PPU address register) in your NMI, but that's not typical. Most games will often rewrite tiles, change the palette, etc., and all of that requires the scroll to be reset afterwards.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #$00<br />&nbsp; STA $2003&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Set low byte ($00) of the RAM address.<br />&nbsp; LDA #$02<br />&nbsp; STA $4014&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Set high byte ($02) of the RAM address and start sprite transfer.</div></div><br />The comment here is wrong. $2003 doesn't &quot;set the low byte of the RAM address&quot;, it sets the destination address for the sprites in the OAM, which is 256 bytes long. Sprites can only be copied from addresses that are multiple of 256 ($0000, $0100, $0200, $0300, $0400, and so on, depending on the value written to $4014), it's not possible to change the low byte.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118595"></a>
				<b class="postauthor">DRW</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118595">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118595#p118595"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 24, 2013 3:08 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 07, 2013 2:59 pm<br /><b>Posts:</b> 180
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">IRQ is disabled whenever the CPU is reset. However, disabling them explicitly allows JMP ($FFFC) to work like the reset button.</div><br />What do you mean? In how far does JMP working like the reset button and JMP not working like the reset button differ? Isn't JMP just the Assembly equivalent of goto?<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDX #$FF<br />&nbsp; TXS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Put stack pointer at $FF. Does this reset the stack status?</div></div><br />What do you think you mean by &quot;stack status&quot;?</div><br />What I mean is this:<br /><em>Sets the stack pointer to #$FF, its original starting address. Every values that were pushed to the stack until now are ignored. The stack behaves as if it's totally empty, so that new variables can be added and the old ones aren't in the way anymore.</em><br />That's how I understood it. Instead of popping every remaining stuff from the stack, just set the stack pointer to the starting address.<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Disabling NMI allows the CPU to complete the init code without being bothered by these notifications.</div><br />So, would it be wise to disable NMI before every game level, so that we can load all the level data into memory? And then we enable it again to start the level?<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent"><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; STA $2001&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Disable rendering???</div></div><br />This blanks the screen so that the CPU can load in a new background.</div><br />Same as above: Should we do this before any level?<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">The first thing the NMI handler should do is write all needed background and sprite changes to the PPU, as there are only 2200 cycles to do so before the next frame begins.</div><br />What happens when, for some reason, my program takes more time for each frame than usual? Does that mean that the program is simply slowed down (so that for example it only runs at 30 FPS instead of 60 FPS) or does the program immediately jump to the NMI label again, disrupting my program flow because I was just in the middle of the previous NMI call?<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">I don't think you need another $2002 read. The code you have will work fine after power on. On the Famicom and on the top loading NES there could be a situation when those two loops don't wait enough time for the PPU to warm up, but since the PPU isn't reset in that case, it's already warmed up, so it's all good I think.</div><br />I'd still rather play it safe. So, where do I put another <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">BIT $2002</tt>? Right before the first waitvblank function?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; BIT $2002<br />WaitVBlank:<br />&nbsp; BIT $2002<br />&nbsp; BPL WaitVBlank</div><br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Anyway, resetting the scroll is something that should be done every frame, after you're done with all PPU updates.</div><br />O.k., I'll do. What about the other stuff?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; LDA #%10010000<br />&nbsp; STA $2000<br />&nbsp; LDA #%00011110<br />&nbsp; STA $2001</div><br />Does this need to be updated at every frame as well or is it enough to do it once in the beginning (and whenever I might want to change these values)?<br /><br />Apart from the additional reading of $2002 and the relocation of the scrolling data after every frame, are any other changes necessary? (The game is supposed to be a mapper 0, non scrolling game, so anything that refers to specific mappers can be ignored.)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6156"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118611"></a>
				<b class="postauthor">3gengames</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118611">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118611#p118611"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 24, 2013 8:07 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly 65024U</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Mar 27, 2010 12:57 pm<br /><b>Posts:</b> 2174
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">For registers, use the Wiki. Heck, read over the wiki now so you understand the registers real meaning sooner. That's one gripe with the nerdy nights is the comments and some of the descriptions of how the registers work is off, or just flat out suck.<br /><br /><!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/PPU_registers">http://wiki.nesdev.com/w/index.php/PPU_registers</a><!-- m --><br /><br />And when you see assembly code LDX #$FF and TXS when TXS assigned the stack a new value, yes it's pretty certain to change the stacks status, that's what it's supposed to do.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4311"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118614"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118614">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118614#p118614"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 24, 2013 8:23 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">What do you mean? In how far does JMP working like the reset button and JMP not working like the reset button differ? Isn't JMP just the Assembly equivalent of goto?</div><br />Jumping to the &quot;Reset&quot; label will only work like a hardware reset if you fully initialize everything. For example, if you don't disable interrupts in the reset code counting on the fact that IRQs are disabled on power on, and then simulate a reset by JMP'ing to the &quot;Reset&quot; label after a point in the program where you have used IRQs, IRQs will be enabled after the &quot;reset&quot;.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Every values that were pushed to the stack until now are ignored.</div><br />That's not so. They are written to whatever location the stack pointer is pointing to, you just don't know what that location is for sure unless you initialize the SP.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">That's how I understood it. Instead of popping every remaining stuff from the stack, just set the stack pointer to the starting address.</div><br />Yes, you can &quot;empty&quot; (the values will remain in RAM though, nothing will be actually erased until the old values are overwritten) the stack just by resetting the SP.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So, would it be wise to disable NMI before every game level, so that we can load all the level data into memory? And then we enable it again to start the level?</div><br />Yes.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Same as above: Should we do this before any level?</div><br />Yes.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">What happens when, for some reason, my program takes more time for each frame than usual?</div><br />That depends on whether you are prepared for that situation, because the NES doesn't handle this automatically. If PPU updates take too long, the screen glitches (you can't write to the PPU and display a picture at the same time).<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Does that mean that the program is simply slowed down (so that for example it only runs at 30 FPS instead of 60 FPS) or does the program immediately jump to the NMI label again, disrupting my program flow because I was just in the middle of the previous NMI call?</div><br />It's not automatically slowed down. It's common practice to have a &quot;FrameReady&quot; flag, which you set whenever the frame calculations are ready. You should check this flag at the beginning of your NMI handler (taking care to not trash any registers that might be in use by a possible unfinished frame) to make sure that the previous frame is done before processing a new frame. If the frame isn't done, you just return from the NMI (some like to at least call the music playback routine here, so that music doesn't slow down), which effectively slows down the gameplay.<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">I'd still rather play it safe. So, where do I put another <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">BIT $2002</tt>? Right before the first waitvblank function?</div><br />Yup.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">O.k., I'll do. What about the other stuff?</div><br />$2000 should be updated every frame as well, because it contains part of the scroll information (the name table selection bits), but $2001 only needs to be changed if you actually need to modify the rendering parameters it affects.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Apart from the additional reading of $2002 and the relocation of the scrolling data after every frame, are any other changes necessary? (The game is supposed to be a mapper 0, non scrolling game, so anything that refers to specific mappers can be ignored.)</div><br />As far as I can see, everything is fine.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p118618"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118618">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118618#p118618"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Sep 24, 2013 11:20 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 2998<br /><b>Location:</b> zurich for this week
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">DRW wrote:</div><div class="quotecontent">What happens when, for some reason, my program takes more time for each frame than usual? Does that mean that the program is simply slowed down (so that for example it only runs at 30 FPS instead of 60 FPS) or does the program immediately jump to the NMI label again, disrupting my program flow because I was just in the middle of the previous NMI call?<br /></div>Your code has approximately 2200 cycles to tell the PPU all the changes to make from the previous time to drew anything. If you haven't finished my then, the display will be incorrect.<br />For example, if you haven't written the correct value to 2005/2006 to specify where the viewport is before this, it will start rendering at the wrong place. If you subsequently read or write from 2007, the display will warp. If you haven't finished uploading sprites, they may all disappear. Even writes to 2000 and 2001 require care, either in timing or the value written.<br />Your code then has another 27000 cycles to do whatever it wantsâ€”physics, controller input, play music, preparing for the next screen, &amp;c.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p118690"></a>
				<b class="postauthor">DRW</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p118690">Re: Questions about code details in the Nerdy Nights tutoria</a></div><div style="float: right;"><a href="./viewtopic.php?p=118690#p118690"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 26, 2013 2:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Sep 07, 2013 2:59 pm<br /><b>Posts:</b> 180
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">3gengames wrote:</div><div class="quotecontent">http://wiki.nesdev.com/w/index.php/PPU_registers</div><br />Thanks. Pretty interesting stuff.<br /><br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">It's common practice to have a &quot;FrameReady&quot; flag, which you set whenever the frame calculations are ready. You should check this flag at the beginning of your NMI handler (taking care to not trash any registers that might be in use by a possible unfinished frame) to make sure that the previous frame is done before processing a new frame. If the frame isn't done, you just return from the NMI (some like to at least call the music playback routine here, so that music doesn't slow down), which effectively slows down the gameplay.</div><br />What I don't understand here: Let's say my game logic is implemented inside NMI and it takes too long. So, the next NMI interrupt is called. Does that mean that there are now basically two instances of NMI running in parallel? One where I'm right inside my game logic and one that just started? How is this possible?<br /><br />Let's show it with pseudo code (I use a C-like syntax for better understanding):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void Nmi()<br />{<br />&nbsp; &nbsp; WriteToPpu();<br />&nbsp; &nbsp; ReadController();<br />&nbsp; &nbsp; GameLogicStep1();<br />&nbsp; &nbsp; GameLogicStep2();<br />&nbsp; &nbsp; GameLogicStep3();<br />&nbsp; &nbsp; GameLogicStep4();<br />&nbsp; &nbsp; GameLogicStep5();<br />&nbsp; &nbsp; GameLogicStep6();<br />&nbsp; &nbsp; GameLogicStep7();<br />&nbsp; &nbsp; GameLogicStep8();<br />&nbsp; &nbsp; GameLogicStep9();<br />&nbsp; &nbsp; GameLogicStep10();<br />}</div><br /><br />Now, let's say we're in GameLogicStep5 and it's time for the next NMI. Originally, I thought that the program flow simply jumps from GameLogicStep5 to the function entry, leaving GameLogic6-10 unexecuted for this time.<br />But if you say that the NMI should set a flag, does this mean that two &quot;instances&quot; of NMI are able to execute simulatenously?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">void Nmi()<br />{<br />&nbsp; &nbsp; if (NextNmiCanBeProcessed)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; NextNmiCanBeProcessed = false;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; WriteToPpu();<br />&nbsp; &nbsp; &nbsp; &nbsp; ReadController();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep1();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep2();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep3();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep4();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep5();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep6();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep7();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep8();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep9();<br />&nbsp; &nbsp; &nbsp; &nbsp; GameLogicStep10();<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; NextNmiCanBeProcessed = true;<br />&nbsp; &nbsp; }<br />}</div><br />In this case, the NMI is at GameLogic5. Suddenly, the next NMI happens. While the first NMI is now at GameLogic6, the second NMI is at the if check. While the first NMI is at GameLogic7, the second NMI is at the &quot;don't jump into the conditional code&quot; area. While the first NMI is then at GameLogic8, the second NMI is at the &quot;leave function&quot; location.<br /><br />Is this how the NMI interrupts are implemented? Because this looks almost like some kind of multithreading or multitasking.<br /><br />If it is not as I described and the NMI simply rips the &quot;program pointer&quot; from its current location and places it at the start of NMI, then how does a flag guarantee that the current NMI just quits itself and the program continues from the right location where it has been before the new NMI jumped in?<br /><br /><br />Another question about reading the $2002 variable: The tutorial uses LDA $2002 before copying background, palette and attribute data to the PPU. Is this necessary even though waitvblank is not included here? And would BIT $2002 serve the same purpose in this case again?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6156"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=10524"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=10524"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 20 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=10524&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=10524&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="10524" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;Reproduction</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
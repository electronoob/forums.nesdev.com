<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - IF macro for ca65</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">IF macro for ca65</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9272">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=9272</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bananmos</b> [ Sat Oct 20, 2012 6:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for the tip about .macro &quot;functions&quot;... they really help making my code look nicer as testing various state flags in the AI code is just an if CUSTOM_CONDITION <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />The and/or support you talked about in another thread sure sounded interesting, even though this is already very useful as it stands.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Sat Oct 20, 2012 9:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I feel I kind of rushed things a bit before, so I'm trying to get things polished up a bit more this time but I'm almost ready to release some more stuff after I write up some decent documentation too.<br /><br />I'm using dopple's smbdis.asm to test the macros, so maybe I can share that as well.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Mon Oct 22, 2012 11:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Still working on the documentation but I wanted to share this..<br /><br />I'll document it better later, time to head to work..<br /><br /><!-- m --><a class="postlink" href="http://mynesdev.blogspot.ca/2012/10/ca65-hl-macros-updated-again.html">http://mynesdev.blogspot.ca/2012/10/ca6 ... again.html</a><!-- m --><br /><br /><!-- m --><a class="postlink" href="http://pastebin.com/azMMvh4r">http://pastebin.com/azMMvh4r</a><!-- m --> .. updated 1 times.<br /><br />Documentation updated! I will add more but it explains most things well.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Sun Oct 28, 2012 11:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Another post on this topic, I tried to explain a bit about how it is working, sort of in between technical and more explanative, I hope this proves useful to others: <!-- m --><a class="postlink" href="http://mynesdev.blogspot.ca/2012/10/hl-macros-technical.html">http://mynesdev.blogspot.ca/2012/10/hl- ... nical.html</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Sun Dec 30, 2012 5:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I've decided to keep this code updated here: <!-- m --><a class="postlink" href="https://www.assembla.com/code/ca65hl/git/nodes">https://www.assembla.com/code/ca65hl/git/nodes</a><!-- m --><br />I'm also going to use the wiki on that page to document it's use, though there is not much there yet. <br /><br />This version also includes integrated &lt;, &gt;, &lt;&gt;, &gt;= &lt;= operators (unsigned) as well as the assignment macro and <a href="http://forums.nesdev.com/viewtopic.php?p=103744#p103744" class="postlink">assignment macro</a> supported operators &amp;, |, ^ ( bitwise) +, - (clear/set carry) --, ++ (with carry), &gt;&gt;, &lt;&lt;, *, / (times and divide also shift left or right with powers of two.)<br /><br />It will also default to behaving as if any non zero result is true if no cpu flags are specified and (hopefully) it makes sense to do so.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Mon Oct 14, 2013 1:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Announcing a new feature addition. Now featuring support for parentheses in expressions! Although I am confident I have everything working, please let me know if you find any mistakes. I would consider this untested, beta code.<br /><br /><!-- m --><a class="postlink" href="https://www.assembla.com/code/ca65hl/git/nodes/devel">https://www.assembla.com/code/ca65hl/git/nodes/devel</a><!-- m --><br /><br />Following the same rules as the previous version, you can test 'expressions' that represent or result in a CPU flag being set/clear and branch appropriately. The latest code allows parentheses to create more complex logical conditions, as well as a negate operator that can distribute across parenthesis. The code generated aims to be efficient and will short circuit as soon as the outcome can be determined.<br /><br />The only limitation is that all OR logic must be before all AND logic in the same parentheses set. ( Add parentheses to work around this.)<br /><br />Example:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />&nbsp; &nbsp; ; branch to label:<br />&nbsp; &nbsp; * = 8000<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; foo = $00<br />&nbsp; &nbsp; bar = $01<br />&nbsp; &nbsp; baz = $03<br />&nbsp; &nbsp; myLabel = * + $50<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; if ( ( foo &gt;= #$03 &amp;&amp; ! bar ) || ((zero &amp;&amp; negative) || baz = #1)) goto myLabel<br /><br />&nbsp; &nbsp; ; code output:&nbsp; &nbsp; <br />&nbsp; &nbsp; 8000&nbsp; &nbsp;A5 00&nbsp; &nbsp; &nbsp; LDA $00<br />&nbsp; &nbsp; 8002&nbsp; &nbsp;C9 03&nbsp; &nbsp; &nbsp; CMP #$03<br />&nbsp; &nbsp; 8004&nbsp; &nbsp;90 04&nbsp; &nbsp; &nbsp; BCC $800A<br />&nbsp; &nbsp; 8006&nbsp; &nbsp;A5 01&nbsp; &nbsp; &nbsp; LDA $01<br />&nbsp; &nbsp; 8008&nbsp; &nbsp;F0 46&nbsp; &nbsp; &nbsp; BEQ $8050<br />&nbsp; &nbsp; 800A&nbsp; &nbsp;D0 02&nbsp; &nbsp; &nbsp; BNE $800E<br />&nbsp; &nbsp; 800C&nbsp; &nbsp;30 42&nbsp; &nbsp; &nbsp; BMI $8050<br />&nbsp; &nbsp; 800E&nbsp; &nbsp;A5 03&nbsp; &nbsp; &nbsp; LDA $03<br />&nbsp; &nbsp; 8010&nbsp; &nbsp;C9 01&nbsp; &nbsp; &nbsp; CMP #$01<br />&nbsp; &nbsp; 8012&nbsp; &nbsp;F0 3C&nbsp; &nbsp; &nbsp; BEQ $8050<br /><br />; if-endif ( else supported )<br /><br />&nbsp; &nbsp; * = 8000&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />&nbsp; &nbsp; foo = $00<br />&nbsp; &nbsp; bar = $01<br />&nbsp; &nbsp; baz = $03<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; if (&nbsp; !( bar &amp; #$03 &amp;&amp; baz == N set ) || (( V set || baz &lt; #$10 ) || foo = #1) )<br />&nbsp; &nbsp; &nbsp; &nbsp; nop<br />&nbsp; &nbsp; endif<br /><br />&nbsp; &nbsp; ; code output:<br />&nbsp; &nbsp; 8000&nbsp; &nbsp;A5 01&nbsp; &nbsp; &nbsp; LDA $01<br />&nbsp; &nbsp; 8002&nbsp; &nbsp;29 03&nbsp; &nbsp; &nbsp; AND #$03<br />&nbsp; &nbsp; 8004&nbsp; &nbsp;F0 12&nbsp; &nbsp; &nbsp; BEQ $8018<br />&nbsp; &nbsp; 8006&nbsp; &nbsp;A5 03&nbsp; &nbsp; &nbsp; LDA $03<br />&nbsp; &nbsp; 8008&nbsp; &nbsp;10 0E&nbsp; &nbsp; &nbsp; BPL $8018<br />&nbsp; &nbsp; 800A&nbsp; &nbsp;70 0C&nbsp; &nbsp; &nbsp; BVS $8018<br />&nbsp; &nbsp; 800C&nbsp; &nbsp;A5 03&nbsp; &nbsp; &nbsp; LDA $03<br />&nbsp; &nbsp; 800E&nbsp; &nbsp;C9 10&nbsp; &nbsp; &nbsp; CMP #$10<br />&nbsp; &nbsp; 8010&nbsp; &nbsp;90 06&nbsp; &nbsp; &nbsp; BCC $8018<br />&nbsp; &nbsp; 8012&nbsp; &nbsp;A5 00&nbsp; &nbsp; &nbsp; LDA $00<br />&nbsp; &nbsp; 8014&nbsp; &nbsp;C9 01&nbsp; &nbsp; &nbsp; CMP #$01<br />&nbsp; &nbsp; 8016&nbsp; &nbsp;D0 01&nbsp; &nbsp; &nbsp; BNE $8019<br />&nbsp; &nbsp; 8018&nbsp; &nbsp;EA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NOP<br />&nbsp; &nbsp; 8019<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Tue Oct 22, 2013 5:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Quick note: Added for-next style loop. Nestable.<br /><br />1)C-style of loop:<br /> for ( &lt;thing to do 1st&gt;, &lt;Flag to test - continue while true &gt;, &lt;stuff to do at end of loop&gt; )<br /><br />Example:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">for ( x := #$3, not negative, dex )<br />; code<br />next<br /><br />; more complex:<br /><br />for ( x := foo, (x &gt; #10) &amp;&amp; (foo &lt;&gt; #1), dex:dex)<br />&nbsp; &nbsp; ; some code<br />next<br /></div><br /><br />2) BASIC-style syntax:<br /><br />This actually tries to optimize some, and will break if you mess with your counter register or variable without thinking:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">for x := #$AA to #$10 step -3<br />&nbsp; &nbsp; ;some code<br />next<br /></div><br /><br />It will loop until your counter hits the first invalid (for the loop) value. If possible it will skip CMP and use BPL/BMI or a lone BNE. 'step' can be omitted and a step of -1 or 1 decided on if possible. You can use variables rather than immediate values, but no optimizations are possible.<br /><br /><!-- m --><a class="postlink" href="https://www.assembla.com/code/ca65hl/git/nodes/devel">https://www.assembla.com/code/ca65hl/git/nodes/devel</a><!-- m --><br /><br />Next is to fix 'elseif'.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Thu Oct 24, 2013 11:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nested 'elseif' seems to be working properly: (random nonsense code)<br /><br /><img src="http://i.imgur.com/a0ZgQLF.png" alt="Image" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>teremochek</b> [ Fri Oct 25, 2013 11:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Looks interestingly. Will be great to watch video as everything works.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Sat Oct 26, 2013 6:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Please Help me Understand This Schematic Portion</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Are you saying you would like to see a video? What specifically would you like to see in a video on this topic?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>teremochek</b> [ Mon Oct 28, 2013 8:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Movax12 wrote:</div><div class="quotecontent">What specifically would you like to see in a video on this topic?</div><br />Nothing specifically, just want to understand<br />How macro operators work. And how you can use operators in disassembler. This only works in Mario Disasm, or it can be used with any disassembler?<br />Anyway thanks.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Mon Oct 28, 2013 9:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This works with the assembler (ca65). I'm really not sure where I would start with a video, or if this topic really lends itself well to a video. Perhaps someday I'll make a video of something. The wiki <a href="https://www.assembla.com/spaces/ca65hl/wiki" class="postlink">here</a> explains how the macros work, but the latest information in this thread is not documented in the wiki just yet.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>slobu</b> [ Mon Oct 28, 2013 11:58 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I still harbor fantasies of this becoming more like batari BASIC. I think &quot;all&quot; it would take is a canned kernel to update the screen and some functions for tiles, sprites, input and sound.<br /><br />End users would still have to make sure not to use up too many cycles but that's life.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Mon Oct 28, 2013 12:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />But Atari, despite being harder to make stuff for, is sumpler in what it is needed to do and such. I don't think you'd be able to make anything scrolling/map-updating+sound+sprites with a little basic thingy. Maybe if you made it work on modules, that'd be cool to try out.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>slobu</b> [ Mon Oct 28, 2013 12:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: IF macro for ca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">3gengames wrote:</div><div class="quotecontent">But Atari, despite being harder to make stuff for, is sumpler in what it is needed to do and such. I don't think you'd be able to make anything scrolling/map-updating+sound+sprites with a little basic thingy. Maybe if you made it work on modules, that'd be cool to try out.</div><br /><br />Yeah.  batari BASIC does work in the way you just described.  It has different canned kernels for a specific set of needs.<br /><br /> set kernel_options pfheights pfcolors<br /> (use the canned kernel that has adjustable playfield heights &amp; colors)<br /><br />would give you a different game engine than<br /><br /> set kernel_options pfheights playercolors<br /> (use kernel that allows adjustable playfield height and the first sprite can have multiple colors)<br /><br /><br />Likewise  I'd imagine an NES version would have different kernels whether you want single screen games using no MMC or side-scrolling using MMC1.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
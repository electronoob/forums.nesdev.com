<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Adding features to discrete mapper with multipurposed CIC</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="https://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="https://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="https://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="https://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="https://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NES Hardware and Flash Equipment" href="https://forums.nesdev.com/feed.php?f=9" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Adding features to discrete mapper with multipurposed CIC" href="https://forums.nesdev.com/feed.php?f=9&amp;t=15633" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '3');
	var per_page = '15';
	var base_url = './viewtopic.php?f=9&amp;t=15633';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 1:09 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=9&amp;t=15633&amp;start=30">Adding features to discrete mapper with multipurposed CIC</a></h2>


	<p class="moderators">Moderators: <a href="./memberlist.php?mode=viewprofile&amp;u=3466">B00daW</a>, <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=15633"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>7</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 97 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=9&amp;t=15633&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=9&amp;t=15633">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=90">7</a> &nbsp;<a href="./viewtopic.php?f=9&amp;t=15633&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=9&amp;t=15633&amp;start=30&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=9&amp;t=15633&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=9&amp;t=15633&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p196204"></a>
				<b class="postauthor" style="color: #FF3300">Memblers</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196204">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=196204#p196204"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri May 19, 2017 6:57 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=10.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 20, 2004 6:04 am<br /><b>Posts:</b> 3541<br /><b>Location:</b> Indianapolis
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Oh, that is nice, I didn't know about these.  I rarely peeked into Digikeys &quot;multi-purpose logic&quot; category, assuming it would be oddball stuff.  But that definitely is handy.  I was about to use a 1G32 OR gate in something, seems kind of foolish now since the 1G97 will do the same and more for the same price.  The only cost is connecting one extra pin to VCC/GND, and that's nothing.  Looks like there is also 1G57, 58, 96, 98, 99 with other assorted functions.  Cool find.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=10"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p196830"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p196830">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=196830#p196830"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun May 28, 2017 3:12 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Been making some progress on my CIC implementation this week.  I've got a fully functioning multi-region CIC implementation running on the STM8, fully tested in with all 4 region CICs.  The current implementation has the mcu core being clocked by 4Mhz CIC clock, so the core is synchronous and uses cycle counting to ensure timing.  Code changes became much simpler once I realized that pipeline placement/timing of code that followed my new changes wouldn't be affected if my changes were always in multiples of 4 bytes.<br /><br />Learned a few things I was asking myself earlier in this thread, so I wanted to share that info.  Perhaps at some point I'll make my investigation more complete and post differences between 6113 and 3193 CIC versions on the RE thread.<br /><br />Segher's disassembly of the NES CIC seems to be a 'cartridge CIC' KEY only 6113 version.  When looking through his disassembly I was confused as to how it could all be working if that code was running on the console's LOCK.  In his disassembly, the LOCK set's it output high shortly after resetting the KEY.  And if you read the disassembly from the key perspective, that Dout pulse after reset, sends the KEY to go perform the 'magic' code that has an unknown opcode.  If the key were to go perform that code, it's timing will end up being off (behind) reguardless of what that unknown instruction performs.<br /><br />As discussed in my earlier post in this thread, I wasn't seeing the LOCK take it's Dout high after reset with the logic analyzer.  Which means segher's disassembly doesn't go off and perform that magic code, so it's timing is fine and everything works.  At the time I wondered why Dout wasn't getting set high after resetting the Key as the disassembly showed.  Just recently I socketed the CIC on my console, and replaced the 3195 CIC (always in consoles as LOCK), with a 6113 which is only found in cartridges.  When watching signals with logic analyzer, low and behold the LOCK was setting Dout high after resetting the KEY just as segher's disassembly shows.  And the stream ID is delayed as one would expect due to the magic code being ran.  If I put the 3195 in the cartridge, nothing works just as kevtris found.  <br /><br />Knowing all this, it now makes sense as to why the only combo of 6113-3195 that doesn't work is 6113-LOCK, 3195-KEY.  This also explains why the KEY's Dout can't be too early, even though segher's disassembly suggests that it can be.  The 3195 panics if KEY's Dout is high more than a couple cycles before the bit is supposed to be transferred.  The 6113 doesn't make this check, but the 3195 must be. <br /><br />Beyond that, I tested out my idea of dual purposing an mcu pin with the reset and KEY Din signals.  Wired together for ORing worked for the most part.  Everything looked good on the logic analyzer, and my implementation was able to pick up on the reset signal embedded into the KEY Din stream.  But for some reason it wasn't the most stable, as pressing reset multiple times would cause problems.  If I kept tapping reset it would come back again and start working, but eventually fall out again as I kept tapping reset.  I'm really not sure what the problem was.  Everything looked good in the LA captures, but for some reason it was falling out after a few bit transfers at times.  I should probably have connected up to the oscope to get a better visual of the signals, but my first guess is that there is too much tension between the ORed output drivers on the console CIC.  I wondered if using a proper logic OR gate would resolve the issue, but then came up with a better idea.  I ended up wire ORing the KEY Dout and reset signals together.  This ended up working great, so the mcu just changes it's DDR for the pin after the reset signal is latched.  With this trick to cut down mcu i/o to 3 pins was every bit as stable as my 4 pin version.<br /><br />So next step is to give an asynchronous implementation a try, ditching the 4Mhz CIC clock and letting the mcu run off it's internal 16Mhz oscillator.  I suppose it would be best to ensure there aren't any issues with the whole idea of having the NES CPU read and write directly from the mcu's pins as a mapper register.  Without that working, there isn't much value in an asynchronous SMT8 CIC being dual purposed as a discrete mapper 'co-processor'.<br /><br />Even without the asynchronous solution, the current implementation will be of good use for my non-discrete mapper designs.  Having a mcu at my disposal for boot time tasks can be rather useful effectively providing NVM to a CPLD which doesn't have any internal flash memory available.  This will be helpful for things like my VRC board to work for all variants without needing to reconfigure the CPLD.  Will also allow an MMC1 board to work as multiple different configurations that are normally incompatible with each other such as SEROM, SXROM, SNROM, SKROM etc.<br /><br />Although I've been eyeing the stm32f030 as a dual purpose CIC as of late too, and there's quite a few reasons it's a better choice than the STM8 depending on one's goals.  The STM8 still looks to be the better choice for expanding a discrete mapper.  But when looking to expand the abilities of an ASIC mapper, the features STM32 starts to shine.  <br /><ul><li>First reason is that the STM32 has more 5v tolerant i/o than the STM8 when powered by 3v.  And powering the dual purposed CIC by 3v becomes desirable when the CPLD isn't 5v tolerant itself.  Rather not need to worry about level shifting signals between the mcu and CPLD.<br /></li><li>The other nice feature of the STM32 is that the PLL is able to multiply the external clock input.  The PLL can multiply the external clock from 4Mhz to the max core freq of 48Mhz, this can't be done with the STM8.  So the STM32 can be fed with 4Mhz CIC clock, and have a synchronous timer ensuring proper CIC transaction timing.  This avoids timing drift issues between the mcu and console CIC.  <br /></li><li>Lastly, the STM32 just has a lot more horsepower with it's 48Mhz 32bit cortex M0 core, compared to the 16Mhz 8bit STM8.  Implementing semi-complex synths, high speed external interfaces (SDcard, USB, Bluetooth, Wifi, etc), are all more possible with the STM32.  Additionally the stm32 has better tool chains available to it in terms of free C compilers and libraries.</li></ul><br />So I'm not sure where I'll take this next.  But that's where I'm currently at.  I'll probably have to shelve this project for a bit while I focus on some other high priority projects.  Now that I've got a basic CIC STM8 CIC working I can convert all my designs away from the attiny13 which was my original and initial goal.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p197164"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p197164">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=197164#p197164"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 01, 2017 5:27 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Having a hard time putting down this whole idea of a discrete mapper with CIC mapper expansion..  The infinite number of possibilities that could be unlocked without increasing the BOM cost by a single cent is hard to keep myself from day dreaming about.  I've came up with what I think is a fairly clean way to handle mcu mapper register reads and writes.  But until someone comes to me and wants to write software targeting this idea, I have a hard time motivating myself to devote the time to fully developing this idea.  On top of that, the idea of implementing this in an emulator on anything but a highly abstracted level sounds like living hell.  So for now, I'll just document my idea here in public as best I can.  Good chance I'll use it as reference in the future if there is outside interest in the event this idea does become a reality.  Or perhaps someone else would like to take my idea and run with it which I'm perfectly fine with.<br /><br /><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">My proposed pin assignments would allow for 4bit nibble wide read/writes at a minimum.  If one wasn't looking to utilize the UART then the entirety of PORT D could be used for 6bit wide accesses.<br /><br />There is a problem though as we can't be certain the mcu is always able to listen to writes to $6000.  The mcu could be currently interrupted by CIC comms which must have a higher priority.  I can't think of a very clean way to get around this without adding dedicated logic.  </div><br /><br />Now that I'm more familiar with the STM8 and the CIC's requirements, I've got a better idea of how to handle R/W accesses from the NES CPU.  The key comes from making the mcu register r/w interrupt higher priority than the CIC comm timer.  This is possible because of the relatively large <a href="https://forums.nesdev.com/viewtopic.php?f=9&amp;t=15633&amp;start=15#p192080" class="postlink">6.7usec window</a> we have to output CIC stream bit, lets just call it a 5usec window to be conservative.  With that large of a window, there is time to service the potential for a CIC transfer inside the mcu mapper register r/w isr *if* there's an explicit definition of how to r/w to the mcu mapper reg.<br /><br />My hardware proposal is still similar to my original idea of dedicating one of the discrete mapper flipflop bits to interrupt the mcu.  Let's say $8000.7 for discussion's sake.  The NES CPU must set this bit, then r/w from the mcu register, and clear $8000.7 in rapid succession.  If we explicitly state how this instruction sequence is to be performed, it also provides the benefit of simplifying address decoding.  We can actually create a large number of mcu registers effectively decoded by NES CPU address, while only utilizing CPU R/W, and CPU D0-4 as mcu inputs.  But how??<br /><br />This is my NES CPU instruction sequence proposal on how to write a byte to the mcu:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pseudo code as preparation for write is not timing sensitive, just trying to illustrate idea:<br />-load A with byte that would like to write to mcu <br />-transfer A to Y register (Y will contain the lower nibble to write to mcu reg)<br />-shift A register to the right 4 times (places upper nibble of mcu reg value in bits 3-0)<br />-transfer A to X register (X will contain the upper nibble that'll be written to mcu reg, but it's placed in bits 3-0 as that's all the mcu sees)<br />-load A with current bank of discrete mapper register<br />-set bit 7 of A (this bit being set @ $8000.7 will interrupt the CIC mcu for mapper r/w)<br /><br />;now that everything's prepared, perform the mapper write:<br />STA $8000&nbsp; &nbsp;;write to discrete mapper with bit 7 set<br />STY $5000&nbsp; &nbsp;;write lower nibble to mcu<br />STX $5000&nbsp; &nbsp;;write upper nibble to mcu<br />AND #$7F&nbsp; &nbsp; ;clear bit 7 so we can disable mcu's interrupt<br />STA $8000&nbsp; &nbsp;;write to discrete mapper with bit 7 clear, CIC mcu interrupt complete<br /></div><br /><br />So we're defining the exact sequence of what must be done whenever $8000.7 is set.  We know a STY and STX instruction will follow immediately after $8000.7 is set.  And the NES CPU won't waste any time clearing $8000.7 once write is complete.  This creates a very specific timing constraints from the CIC mcu's perspective.  <br /><br />And since we know exactly what NES CPU instructions are being used, we can simplify address decoding by sniffing the CPU data bus alone.  The mcu doesn't need to decode any CPU address lines with this trick, but it has visibility of whichever CPU data pins it's connected to.  For this implementation, I've chosen to only connect the STM8 to the lower nibble CPU D0-3.  The tssop-20 STM8 doesn't have a full 8bit wide GPIO port pinned out, the most it gives is 6 pins with PORT D1-6.<br /><br />By sniffing D0-3 during the STX/STY instructions, we can glean CPU A11-8, and CPU A3-0 for the upcoming write cycle.  We can afford to cut out CPU A13/14 for mcu decoding purposes, as the mcu is no longer listening for $6000-7FFF as in my original idea.  Here the mcu can only decode CPU A11-8 &amp; A3-0.  But that's pretty legit as it gives us a potential for 256 mcu mapper registers to work with.  To be clear, CPU A15-A12 aren't actually being decoded with this implementation.  Selection of $5000-5FFF for the location of the mcu register is arbitrary, that's simply an a convenient address space which doesn't conflict with anything else in the NES CPU memory map.<br /><br />Since the mcu can sniff D3-0 during the STX/STY opcode fetch, it can differentiate between STY/STX with the lower nibble of opcodes $8E/$8C.  So we don't have to require both the upper and lower nibble always be written, nor in a specific order.  We just have to pick a convention of X/Y being Hi/Lo nibbles and stick with it.<br /><br />The requirement to clear $8000.7 asap comes from the fact we can't tie up too much of the mcu's time, as the $8000.7 interrupt is getting set as the mcu's highest priority interrupt.  So we have to free it so i can get back to CIC mangle calculations and such in it's main thread.  While there's an abundant amount of time that could allow for more than 1 byte to be written at once, things get complex quick trying to define a larger r/w routine with explicitly defined timing to provide the mcu.<br /><br />If one had an application where larger transfers were desired, my idea about requesting the CIC mcu to interrupt the NES CPU when there's a sufficiently large period of time that CIC comms can be ignored is the better solution and would be relatively easy to implement.  We need a means to transfer a single byte before we can solve the KByte transfer solution.<br /><br />Before we get too far, I want to come up with a definition of our convention for mapper register reads.  I'm expecting that this can be pulled off somehow.  Although details on the best way to do this didn't start to come to me until I started thinking about how the mcu ISR would work.  The CIC mcu ISR for register r/w gets tricky quick.  There's a lot of things it needs to ensure and they're all timing sensitive.  One of the biggest issues becomes accounting for the 5 cycle jitter for when the ISR starts executing.  Putting more burden on the ISR with tasks like determining if the 6502 is reading or writing really starts to become a challenge.  We don't have much option with this hardware definition to use a separate ISR for both reads and writes.  The only good way to have separate R/W ISRs would be to devote another discrete mapper flipflop bit, one for reads, one for writes.  I don't much like that idea though, we may not have bits to spare.  <br /><br />Here's my KISS solution that combines the NES CPU mcu register reads into the same routine with writes:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">pseudo code as preparation for write is not timing sensitive, just trying to illustrate idea:<br />1) load A with byte that would like to write to mcu (can skip to step 5 if only care about reading from mcu)<br />2) transfer A to Y register (Y will contain the lower nibble to write to mcu reg)<br />3) shift A register to the right 4 times (places upper nibble of mcu reg value in bits 3-0)<br />4) transfer A to X register (X will contain the upper nibble that'll be written to mcu reg, but it's placed in bits 3-0 as that's all the mcu sees)<br />5) load A with current bank of discrete mapper register<br />6) set bit 7 of A (this bit being set @ $8000.7 will interrupt the CIC mcu for mapper r/w)<br /><br />;now that everything's prepared, perform the mapper write:<br />STA $8000&nbsp; &nbsp;;write to discrete mapper with bit 7 set<br />STY $5x0x&nbsp; &nbsp;;write lower nibble to mcu<br />STX $5x0x&nbsp; &nbsp;;write upper nibble to mcu<br />;write complete, now read back the old value that was in the mcu register<br />LDY $5x0x&nbsp; &nbsp;;read old value from mcu register (lower nibble)<br />LDX $5x0x&nbsp; &nbsp;;read old value from mcu register (upper nibble)<br />AND #$7F&nbsp; &nbsp; ;clear bit 7 so we can disable mcu's interrupt<br />STA $8000&nbsp; &nbsp;;write to discrete mapper with bit 7 clear, CIC mcu interrupt complete<br /><br />;At this point we've effectively completed a SWAP operation between X/Y registers lower nibbles and mcu mapper register $5x0x<br /></div><br /><br />This may seems a little confusing as to why we're writing, and then reading.  And what if you didn't want to overwrite the value of a register, and you only wanted to read it?  My thought is that the mcu register definitions would overcome this issue.  We've got up to 256 registers to work with, so just define them as read only, or write only as needed.  So the NES CPU code you're writting probably only cares about read or write, but by using a swap operation, we can tackle two birds (read &amp; write) with one stone (mcu ISR).<br /><br />Additionally I'm going to discard my earlier idea that the mcu will decode STY/STX by sniffing the opcode.  As I get into the details of the ISR, the more that we can simplify with convention of the 6502's r/w routine, the easier life is for the STM8.  So for discussion's sake we'll require the sequence of STY-STX-LDY-LDX as lined out by the routine above.  Additionally, we'll effectively require that routine to be copy pasted into 6502 assembly code, with only possible changes to be the mcu register address.  The x's in $5x0x denote address nibbles that can be modified.  But the address for all four load/store's addresses must match.  The mcu ISR isn't going to have time to decode each and every one and adapt on the fly.  If the 6502's read/write routine is running in rom, this definition would require a separate routine for each register.  That may not be an issue if only using a few registers.  A more versatile way would be to execute the routine from SRAM and use self modifying code to change the absolute address of the STY-STX-LDY-LDX instructions prior to executing the read/write routine.<br /><br />Now to try and explain how all this would work from the CIC mcu's perspective...  So now we've got an explicitly defined timing of bus operations from the time that the mcu receives it's $8000.7 interrupt, we can utilize cycle counting within the mcu mapper r/w ISR to latch address and data from the NES CPU.  But since this ISR is designed to be of higher priority than the dedicated CIC comm ISR, the mapper r/w ISR must also handle necessary CIC comms should they be needed while it's running.<br /><br />I've gotten into the details of how the STM8 CIC KEY would run asynchronous from the console's LOCK in previous posts in this thread.  The basic idea is that there's an mcu timer which is used for counting down to when the next CIC transfer needs to occur.  My plan is to use TIM2 for this purpose which in reality can only count up, but math can turn that around.  The timer's ISR will account for drift of the clocks by polling LOCK's Dout when expected to be high.  That ISR will also set/clear KEY Dout as necessary, but it's a lower priority routine than this mcu register r/w ISR I'm about to discuss.<br /><br />The CIC mcu is running at 16Mhz with 62.5nsec period, and the NES is running at 1.79Mhz with a period of 559nsec (assuming worst case NTSC).  So there are ~8.9 STM8 cycles per 6502 cycle.  And we've got a window of 5usec that a CIC bit must be output when needed.  That CIC window equates to ~8.9 cycles on the 6502, and  80 cycles on STM8.  So it looks as though we've got plenty of time to get everything done if our ISR is smart enough.<br /><br />Here's some psuedo code and STM8 assembly to give timeline of how I picture the ISR to work, cycle numbers on left are STM8 cycles.  I'm sure there are some errors on exact timing of everything, but this gets the idea accross.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">0: NES CPU sets $8000.7 to trigger ISR (6502 end of STA $8000 cycle T3)<br /><br />1-6: complete instruction in execute cycle (1-6 cycles)&nbsp; -Ooof!&nbsp; we'll have to account for that potential jitter...<br /><br />2/7-11/16: push registers to stack (9 cycles)<br /><br />8-17: jump to ISR (docs not explicit on # of cycles, assuming it's 1 cycle like the JMP instruction)<br /><br />9-18: start executing ISR <br />&nbsp; &nbsp; &nbsp; &nbsp;Oops!&nbsp; The 6502 has executed ~1-2 cycles by this point..&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;We don't have a good way to ensure we can sniff T0 &amp; T1 of the first STX/STY, which means we don't know if it's STX/STY<br />&nbsp; &nbsp; &nbsp; &nbsp;One possible solution would be to define that a NOP is required between STA $8000 and STX/STY.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -No one likes wasting time!&nbsp; And this still doesn't solve the jitter issue.<br />&nbsp; &nbsp; &nbsp; &nbsp;Another would be to just make it convention that STY is first, however ADL in T1 (our ability to sniff CPU A3-0) may have passed us by.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -This is the reason I made the decision to nix the ability to handle different orders of STX/STY, and require all addresses to match.<br />&nbsp; &nbsp; &nbsp; &nbsp;We also have to account for the 5 cycle ISR latency jitter, and get aligned with the 6502.<br />&nbsp; &nbsp; &nbsp; &nbsp;We could let the ISR spin polling CPU R/W and align itself when it goes low.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -This is half of the reason why STore is first, and LoaD is second.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -Other half of reason is logically this is only way X/Y registers can be preserved during a SWAP.<br />&nbsp; &nbsp; &nbsp; &nbsp;Perhaps it's for the best that STY T0 &amp; T1 have passed us by as we didn't yet have a way to account for ISR jitter anyway<br /><br />So at this point we know PRG R/W will go low around cycle 27, but we're somewhere between cycle 9-18 and don't know where..<br />Additionally every ~80 STM8 (or ~8 6502) cycles we need to check the CIC comm timer and output a bit if necessary.<br /><br />;spin until R/W low for STY T3<br />rw_still_high:<br />BTJT&nbsp; &nbsp; rw_port, #rw_bit, rw_still_high&nbsp; &nbsp; ;2/3 cyc<br /><br />STY cycle T3 starts around STM8 cycle 27<br />Now we've accounted for jitter and we're ~29 STM8 cycles since 6502 set $8000.7<br /><br />;Delay a few cycles until CPU D3-0 should be valid for STY T3<br />30:&nbsp; &nbsp;NOP, NOP...<br /><br />;Latch CPU D0-3 for STY T3<br />33:&nbsp; &nbsp;MOV&nbsp; low_wr_data, data_port<br /><br />6502 is about to go from STY T3 to STX T0 (occurs at STM8 cycle ~36) , this is a good time to handle a CIC comm if needed.<br /><br />;STM8 assembly rough idea of how check if time to output CIC comm (total 4 STM8 cycles)<br />LDW&nbsp; &nbsp; X, TIM2_CNTR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;2cyc<br />SUBW&nbsp; X, #$FFF0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;2cyc<br />JRMI&nbsp; &nbsp; no_comm_needed&nbsp; &nbsp; ;1/2cyc<br />MOV&nbsp; &nbsp; &nbsp;Dout_port, out_val&nbsp; ;1cyc<br />no_comm_needed:<br /><br />&quot;reset&quot; count for CIC comm window.<br /><br />We're in the middle of STX T0 currently.&nbsp; Delay until can sniff ADL from STX T1<br />NOP, NOP...<br /><br />;Latch CPU D0-3 for STX T1 to sniff CPU A3-0<br />50:&nbsp; &nbsp;MOV&nbsp; low_addr, data_port<br /><br />;Delay till STX T2 to sniff CPU A11-8<br />NOP, NOP...<br />59:&nbsp; &nbsp;MOV&nbsp; high_addr, data_port<br /><br />;Delay till STX T3 to latch upper nibble of mcu register write<br />NOP, NOP...<br />68:&nbsp; &nbsp;MOV&nbsp; high_wr_data, data_port<br /><br />69-99:<br />All data has been latched for mcu register write, we also know CPU A11-8 &amp; A3-0 for upcoming register read.<br />We'll assume that the register address can be mapped to a fixed block of STM8 SRAM.<br />During this time we'll consume a few STM8 cycles to piece together latched high_addr:low_addr<br />and map that to an STM8 address we can set the X register to point to.<br />Copy, shift, and mask that the lower nibble of data into data_output_port for upcoming LDY T3<br />Copy, shift, and mask that the upper nibble of data into SRAM for quick access when time for LDX T3.<br /><br />Perhaps 30 cycles isn't enough time to handle all that, but it should be for simple tasks.<br />Worst case require a NOP inserted between STX-LDY if needed.<br />Even better idea: move AND #$7F instruction between STores and LoaD instructions!<br /><br />100:<br />register read lower nibble already stored in data port output register.<br />Set port register DDR to enable register data to drive 6502 data bus D3-0<br />Delay while 6502 is latching read for LDY T3<br />107:<br />disable data port output drivers with mcu DDR<br /><br />108:<br />It's been ~72 cycles since we checked if a CIC comm was needed.&nbsp; Perfect time to check again.<br /><br />Copy prepared SRAM byte back in cycles 69-99 from SRAM to data port output register<br /><br />Delay till LDX T3<br /><br />136:<br />enable data port output DDR<br />Delay while 6502 is latching read for LDX T3<br />142:<br />disable data port output drivers with mcu DDR<br /><br />Need to wait for NES CPU to clear $8000.7<br />This will take 6 cycles on 6502, STM8 can't return from interrupt until complete to prevent re-entry.<br />Should perform some more CIC comm timer checks during this time.<br />STM8 IRET takes a whopping 11 cycles, worst case a CIC comm timer interrupt occurs during that IRET.<br />Need to ensure adequate time for CIC comm timer interrupt to handle a comm that's needed as this ISR returns.<br />Additionally this routine left KEY Data high if a comm was needed.<br />Need to ensure the CIC comm timer ISR will clean up after this routine and clear Dout when no longer needed.<br /><br />;return back to main thread where CIC mangle operations can continue.<br />;or whatever request made by the 6502 via this routine can be performed.<br />IRET<br /></div><br /><br />Phew, There you have it!  So this mcu register r/w routine could hold a higher interrupt priority for the STM8 mcu compared to the CIC comm timer which would have second priority.  Any other interrupts would have to have a lower priority than these two, and the STM8 must be set to nested interrupt management mode.  That way higher level interrupts are able to interrupt lower priority ones ensuring mcu register r/w are always serviced, and no CIC comms are missed.  Beyond all this one just needs to ensure the mcu isn't over worked and that it has adequate time to complete CIC mangle calculations.  <br /><br />The biggest risk for this would be if the NES programmer were to perform multiple mcu register r/w operations back to back.  Would have to do some worst case analysis on the time required for mangle calculations.  This entire ISR is ~200 STM8 cycles, which is only ~13usec, that's a relatively small amount of time on the scale of the CIC timing and calculations.  <br /><br /><s>My current mangle table routine is ~100 STM8 instructions, isn&#39;t well optimized, and takes ~42usec to perform mangle, and spins for ~30usec waiting for the console CIC to perform it&#39;s calculations.  So that&#39;s some where ~60% cpu utilization during the most intensive calculations.  During bit transfers, the CIC timer xfr ISR should only need ~5-10% cpu utilization tops.  A conservative estimate would be that 70% of CIC time is mangle calc, and 30% is bit transfers.  That weighted average STM8 cpu utilization comes out to ~50% which I consider a rather conservative estimate.<br /><br />A practical rule that would keep from over utilization would be to require ~20usec &#40;~35 NES CPU cycles&#41; between mcu register accesses.</s><br /><br />EDIT: My original estimate was flawed in that it neglected to calculate the fact that an asynchronous STM8 CIC would be running at 16Mhz, not 4Mhz.  Here's a better cpu utilization estimate:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Mangle calculation: <br />STM8: 100 instructions = 10.5usec<br />CIC average mangle 80usec = 13% CPU utilization during mangle calculations<br /><br />Bit transfers:<br />Estimate timer ISR to run for ~5usec average maximum (time that pulse is high plus drift trimming)<br />CIC period of bit transfers 79usec = 6% utilization during bit transfers<br /><br />Average number of bit transfers = 8 * 79usec = 632usec<br />Average number of mangle calcs = 16 * 80usec = 1280usec<br />% time bit transfers = 632 / 1912 = 33%<br />% time mangle calc&nbsp; = 1280 / 1912 = 67%<br /><br />Weighted utilization:<br />bit transfers 6% * 33 = 1.98%<br />mangle calc 13% * 67 = 8.71%<br />total utilization 1.98% + 8.71% = 10.7%<br /></div><br /><br />So in reality the CIC operations only utilize ~10% of the STM8's processing time.  The register read/write ISR is ~12.5usec, with the time the 6502 is going to have to spend processing data coming in and out it's going to have a hard time overloading the STM8 with r/w accesses alone.  In practice one might set a rule to not let that 12.5usec exceed 75% of the STM8's utilization.  That would equate to providing the STM8 with a 4usec (~8 NES CPU cycles) between mcu register accesses.  That's only a couple of instructions which isn't really enough to do anything worthwhile between accesses.  In practice I wouldn't expect the STM8 cpu utilization to become an issue until it started being tasked with compute intensive tasks such as sound synthesis, or large UART data transfers perhaps?  Those tasks would be make a lesser priority than register accesses, and CIC comms, so at least they wouldn't risk locking up the console/CIC.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200419"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200419">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200419#p200419"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jul 18, 2017 12:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Been sinking my teeth into USB lately, finally got a pretty good grasp of the protocol and everything necessary to implement it.  Got me thinking about another possible use for this project.  I believe it would be within reason for the STM8 to act as a USB 1.1 host to simple devices like a mouse/keyboard.  My idea would be implemented somewhat similarly to V-usb with bitbanging on the i/o, requiring very few external components.<br /><br />I couldn't easily get google to tell me what version of USB the majority of keyboards/mice utilize, so I checked a more recent Dell one I have sitting around and it reported 1.1 in the device descriptor.  I'm thinking it would make sense that the majority of them use 1.1 in efforts to be more compatible, and no real need for 2.0 speeds.<br /><br />In reality though, supporting a PS/2 protocol would be *MUCH* less effort, and probably be more stable/compatible.  That and USB to PS/2 converters are cheap if one doesn't have a PS/2 keyboard/mouse.  But that wouldn't have the same cool factor and push one of the lowest cost mcu's on the market (STM8) to it's highest limits!!<br /><br />The real annoyance with a cartridge providing support for an external peripheral is making a connector accessible for plugging into, and all that can't really be considered 'free' anymore.  At which point a $1-3 bluetooth module starts to make more sense.  Bluetooth would have the benefit of getting as simple as protocols get for the CIC mcu with SPI.  But has the drawback of compatibility with whatever device the user happens to own which I can only assume would be a nightmare.  Perhaps that's not the case though, I've never tinkered with BT as a developer, only have my user experiences to taint my impression of BT.  I started to look into it awhile back and the annoyances with lack of compatibility between BT versions was enough of a deterrent..</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p200420"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200420">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200420#p200420"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jul 18, 2017 12:07 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">USB HID devices are apparently supposed to be always at 1.5Mbit/s (USB1.0) speeds.<br /><br />If there's a hub in the way, the hub might retime it to 12Mbit/s speeds.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200421"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200421">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200421#p200421"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jul 18, 2017 12:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">USB HID devices are apparently supposed to be always at 1.5Mbit/s (USB1.0) speeds.</div><br />Curious if you have a link/quote on that, suppose I should just look at the standard but I always second guess what I'm reading with those things..  If I've learned anything about USB so far it's that the standard is more like a guideline, and things work differently in practice than documents suggest.<br /><br />USB HID devices are certainly not required to be 1.5mbit, plenty of projects/products utilize mcu's like the stm32 which only support 12mbit.  They then take advantage of HID class to get around driver requirements.  So can't see much in the way of one making a 12mbit USB keyboard.  I'd assume keyboards with built in hubs step up the speed as you mention.  It makes sense that keyboard manufactures would only utilize 1.5mbit for compatilbity/cost reasons, but IDK what keyboard/mouse manufactures are really doing...</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p200422"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200422">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200422#p200422"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Jul 18, 2017 12:43 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hm. I know I <em>had</em> read that somewhere, but I can't find any source corroborating it.<br /><br />And certainly any of the high speed (1kHz) mice must run at at least 12Mbit/s (although they might default to a lower rate?), so...<br /><br />Probably best to forget I said that.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200925"></a>
				<b class="postauthor">na_th_an</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200925">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200925#p200925"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 1:06 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon May 27, 2013 9:40 am<br /><b>Posts:</b> 478
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">I've came up with what I think is a fairly clean way to handle mcu mapper register reads and writes.  But until someone comes to me and wants to write software targeting this idea, I have a hard time motivating myself to devote the time to fully developing this idea.  On top of that, the idea of implementing this in an emulator on anything but a highly abstracted level sounds like living hell. </div><br /><br />What exactly do you need? You know I can write games <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> What kind of features would it support? PRG/CHR banking? 16K/32K? CHR banking? 8K, more granularity? Or I have missed it completely and it has nothing to do with this?</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.mojontwins.com">http://www.mojontwins.com</a><!-- m --></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6012"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p200957"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200957">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200957#p200957"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 12:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">na_th_an wrote:</div><div class="quotecontent"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">I've came up with what I think is a fairly clean way to handle mcu mapper register reads and writes.  But until someone comes to me and wants to write software targeting this idea, I have a hard time motivating myself to devote the time to fully developing this idea.  On top of that, the idea of implementing this in an emulator on anything but a highly abstracted level sounds like living hell. </div><br /><br />What exactly do you need? You know I can write games <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> </div><br /><br />Really I just need some interest from someone who would like to develop games/tools targetting this hardware to give me some motivation.  I know personally I'm not likely to get past a demo proving the hardware functional.  Other thing that's needed/helpful is if the developer/someone else is willing to add emulator support themselves if they feel it's necessary.  I can provide a flashable prototype cartridge &amp; programmer for quick build testing on real hardware.  I assume creating low level emu support which will actually emulate the limits of the STM8 core properly will be a challenge for the most seasoned emu developer.  So if one wanted to target this hardware, would be best to test on real hardware frequently anyway.<br /><div class="quotetitle">na_th_an wrote:</div><div class="quotecontent">What kind of features would it support? PRG/CHR banking? 16K/32K? CHR banking? 8K, more granularity? Or I have missed it completely and it has nothing to do with this?</div><br /><br />As for what features are possible, the specifics are up in the air at the moment.  Should things progress from here, I would likely focus on implementing the features said developer(s) were most interested in.  This STM8 &quot;CICOprocessor&quot; is only capable of certain types of features if we don't equip the board with any extra logic to help it out.  The original idea here is to have the ability to add the features below to nearly any discrete mapper.  I only need one mapper register flipflop bit to perform what I have in mind.  So the developer could pick from something like BNROM, AxROM, colordreams, or UxROM including any homebrew variants.  <br /><br />The idea of this CICOprocessor is for it to be an expansion that could be added to nearly any mapper.  We don't necessarily need to limit it to discrete mappers, I only had the idea to target discrete mappers as it provided these features without adding expensive hardware.  The CICOprocessor isn't well suited for bank switching tasks, so the memory banking would be left up to whatever mapper choice the developer made.  Choosing discrete mappers still limits you to 16/32KB PRG banking, and 8KB CHR banking effectively.  Desires of finer banking effectively necessitates addition of a CPLD on the board, doing that opens a can of worms.  Putting a CPLD on the board allows the mcu to run at 3v at which point I'd like to target the STM32 instead and we've lost our sense of scope.  So for now I'd like to focus on what features are possible for expansion of discrete mappers.<br /><br /><span style="text-decoration: underline"><strong>Potential features the CICOprocessor are capable of adding to a discrete mapper</strong></span><br />Keep in mind, CICOprocessor registers would be limited to 4bits in size due to it only having access to D0-3.<br /><ul>1)  IRQ timer: there are no counter inputs available, so the counter would have to be clocked by STM8 internal 16Mhz HSI,  (EDIT: <s>or 128Khz LSI</s>) RC oscillators.  Considering traditional IRQ counters don't fire at exact PPU timings due to PPU-CPU alignment I don't see lack of a synchrous counter being an issue.  A programmable prescaler that allows the timer to be set to PAL/NTSC/Dendy timing might be possible.<br />[EDIT: Take back what I said, TIM1 is able to be clocked externally by one of 2 different pins.  So scanline, and/or NES cycle counter are now planned features.]<br /><br />2) Expansion sound:  Paired with my <a href="https://forums.nesdev.com/viewtopic.php?f=9&amp;t=16156#p199685" class="postlink">solderless expansion port dongle</a>, and addition of a couple cap/resistors to the board for a PWM DAC, a few extra audio channels could be created.  In that thread we address some limitations of tuning.  The STM8 won't handle something on the level of FM synthesis.  But the addition of a few square, triangle, sine channels are within reason.  Within limitations of memory, samples could be possible as well.  Top loaders would require soldered mods to work, and I assume most clones wouldn't support.  I'm curious about high end clones like the NT and AVS, hopefully they support EXP6 audio.<br /><br />3) Game save data: While this feature is easily unlocked with discrete mappers using flash memory, it often requires extra logic gates, and is challenging to program requiring save routines to execute from SRAM.  The STM8 has upwards of 128Bytes of eeprom, and some portion of it's 8KB flash instruction memory that it could provide the 6502 for save data use.  The interface would be simpler than self-programing PRG-ROM flash, as it could be implemented as a simple set of mapper commands &quot;write nibble #x to value y&quot;, or &quot;read nibble #x&quot; for example.  <br /><br />4) Switchable H/V mirroring: The addition of a small 1G97 logic gate would allow the STM8 to control a mux selecting which mirroring was active.  However expanding any discrete mapper with CHR-RAM to 4screen mirroring is trivial and free for homebrew use, but 4screen mirroring is incompatible with cheap clones.  This CICOprocessor H/V selectable mirroring would have the benefit of working with clones.<br /><br />5) Data processing: I have a hard time envisioning what types of data processing would be worthwhile to hand off to the STM8.  While the STM8 does have a hardware multiply/divide, IDK if the current nibble register access to it would make it a significant benefit to the 6502.  Perhaps if one had some complex math tasks that weren't time sensitive; operands could be fed to the CICOprocessor which would interupt the 6502 when it was done crunching the numbers.<br /><br />6) Serial interfaces:  This is more of a wide open category of possible features that gets unlocked with using the CICOprocessor to give the NES a serial interface.  My current <a href="https://forums.nesdev.com/viewtopic.php?f=9&amp;t=15633&amp;start=30#p197164" class="postlink">nibble register interface</a> is somewhat limiting as it's not most speedy.  But it should be more than fast enough if we're not handling large chunks of data.  We have a hardware SPI &amp; UART interface at our disposal which opens the door to an infinite number of devices.  But it's also reasonable for the STM8 to bitbang some other interfaces as well.  Here are some possible ideas:<br />-SPI flash chip: access to MB/GB worth of data at low costs of serial flash chips<br />-SD card slot: really just a fancy form factor of the above idea, but comes with the added challenge of file structuring which will likely consume fair amount of STM8's available instruction rom.<br />-Internets: Could add a low cost ESP8266 Wifi module via UART interface for under $5.<br />-Bluetooth: Could add a low cost HC-06 BT module via UART interface for under $5.  Could use this for any number of peripherals, or maybe even some internet access.<br />-Peripherials: bitbang P/S2 interface for keyboard/mouse connectivity is easily within our abilities here.  I mentioned a bitbanged USB 1.1 host being possible, but I think this is pushing possibilities to the max..<br />-Your imagination: come up with something of your own, maybe some IR led device, anything that a couple spare general purpose i/o allows you do dream up on the cartridge.<br />-Real Time Clock: I probably shouldn't bring this up as it's a feature the STM8 can't support itself.  But with the addition of a RTC chip and battery it would be possible.  I might argue the STM32 would be a better choice as it includes an RTC but that's a separate discussion..<br /><br />7) Boot features: This is my primary intended feature set to take advantage of with my board designs.  My USB programmer will be able to program mapper configuration info into the CIC.  This allows the CIC to select H/V mirroring at boot time allowing me to do away with the toggle switch for H/V mirroring which requires the case to be opened and user know what H/V mirroring to select.  I plan to also use this feature set to make my CPLD designs more flexible.  The CIC will provide the CPLD some NVM that allows the CPLD to act as multiple different predefined hardware configurations selected at boot time.<br /><br /></ul><br />I've already converted most of my NES designs to the STM8 CIC and planning to release my boot features once I complete my rewrite of the inlretro/kazzo software release.  It's about time for me to layout a new discrete mapper board for my next PCB order.  I might be able to pull of a direct swap from attiny13 to STM8 on my discrete design, but with all this I'm tempted to rearrange everything and start from scratch since I'll need a new set of stencils anyway.  If I start from scratch I should be able to make space for routing CPU signals to the CIC as I've proposed so far.  I plan to add the H/V mirroring mux so I can axe the toggle switch.  I will probably add a cap and 1-2 resistors to provide PWM DAC allowing synth support.  Beyond that, I will probably route the SPI/UART signals to the edge of the board for prototyping or direct soldering of a proposed module/wiring to the PCB.  Whether or not these things will be made use of in the near future I'm not sure, I've got quite a few irons in the fire right now..  This minimalist CICOprocessor idea is fun, but without external motivation it's not very high on my development task list.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=4832">infiniteneslives</a> on Sat Jan 20, 2018 1:20 am, edited 3 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200961"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200961">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200961#p200961"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 2:13 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1704<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">2) Expansion sound</div><br />Some thoughts... I suspect composing music for a wholly new &quot;sound chip&quot; might be daunting. You'd either need to:<br />1) develop a branch of FT supporting it so you can write music with quick aural feedback<br />2) edit, write to cart, play on hardware, rinse and repeat<br />3) compose in a notation program or midi editor, then convert that to the specific format, by hand or script or both, or <br />4) do it all in theory then punch in the data (which usually turns out rather primitive, which would go against the purpose of the feature).<br /> <br />Then there's need of a music playing engine capable of playing it, so there's still that to do.  <br /><br />Implementing one of the sound chips (or parts of one) currently supported by FT might help. Actually, it'd be attractive. <br /><br />Another possibility with the expansion sound is not having sfx interrupt bgm notes. You could select from an options menu wether to use internal channels or external for sfx (depending on if you have the dongle or not). If the ext sound is interfaced as the internal ones would, the sfx part of the sound engine wouldn't need to be much different for the two options (which goes against the &quot;supported by FT&quot; argument as far as BGM goes, but for SFX, it would be fine).</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p200964"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200964">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200964#p200964"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 2:59 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You bring up great points FrankenGraphics.  Personally I'm not really motivated to write the FT support much like my lack of interest for writing emulator support.  So this would be up to the developer/others to overcome, although I'm all for making design choices that aid in their effort.<br /><br /><div class="quotetitle">FrankenGraphics wrote:</div><div class="quotecontent">Implementing one of the sound chips (or parts of one) currently supported by FT might help. Actually, it'd be attractive.</div> This was my initial thought.  Having the cartridge mimic the likes of VRC6, MMC5/2A03, or sunsoft5b would be within reason.  Only armed with the multitasked STM8 CIC and PWM DAC, not sure we can afford to get too caught up in the details of replicating the originals with near perfection.  With the minimalist goals one would have to accept the CICOprocessor synth for what it is flaws/quirks/personality and all.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Then there's need of a music playing engine capable of playing it. </div>  This would be an issue even if the CICOprocessor synth is to mimic existing synths as we only have the 4bit registers to work with.  Not sure how many sound engines support 'standard' expansion audio right now anyway.  That said the audio registers should be able to be arranged in a somewhat similar fashion to the originals if desired.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Another possibility with the expansion sound is not having sfx interrupt bgm notes. </div>  This would be a good option if the creator wanted a minimal experience difference for consoles without expansion sound support.  I'm no musician/composer but I don't think it would be the worst thing in the world if only backup/background voices were placed on the expansion synth.  Gimmick! for example plays most sfx on the synth which everyone notices when missing.  But there are also some voices on the synth which I didn't even realize were missing without the synth for the longest time.  Personally, I think Gimmick's songs stand alone pretty well even when the synth is missing.  But for the trained ear, and one who recognizes the fullness that's missing, will appreciate the extra channels.  My point/opinion is, the music doesn't have to fall apart when a channel is missing in order to be appreciated for when it is present.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200965"></a>
				<b class="postauthor">lidnariq</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200965">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200965#p200965"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 3:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Apr 13, 2008 11:12 am<br /><b>Posts:</b> 7391<br /><b>Location:</b> Seattle
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Arbitrarily assuming that the desired features are &quot;some kind of IRQ&quot; and &quot;some kind of sound&quot;, I suppose it's worth asking just how much synth can fit?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3512"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p200982"></a>
				<b class="postauthor">infiniteneslives</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200982">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200982#p200982"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jul 26, 2017 6:36 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4832_1403414291.jpg" width="100" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 04, 2011 11:49 am<br /><b>Posts:</b> 2082<br /><b>Location:</b> WhereverIparkIt, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Arbitrarily assuming that the desired features are &quot;some kind of IRQ&quot; and &quot;some kind of sound&quot;, I suppose it's worth asking just how much synth can fit?</div><br /><br />Yes that's the bigger question.  My estimates put CIC operations at ~10% utilization of the STM8 core, so there should be a fair amount of CPU time available for audio synthesis/mixing.  In practice I'm sure it'll come down to a trade off between number of channels and desired sample rate.  I've yet to get my hands dirty with audio synthesis on these mcu's but have my sights set on doing so.  I'll have to report back once I've got some hard data.<br /><br />FWIW I had to take back my mention of 128KHz LSI being a possible clock source for timers.  We're effectively limited to fmaster = 16Mhz with prescalers.  There are 3 timer counters available, here's my current plan for each:<br /><br /><span style="text-decoration: underline">TIM1 16bit advanced control timer:</span> up/down counter with auto-reload. Prescaler set to any integer from 1-65536. This being the only up/down counter available makes it the best candidate for PWM DAC providing center aligned PWM mode.  This counter also has best pinout to GPIO.  This is the most capable timer on chip, it shouldn't be needed for CIC operations, so we get to task it as desired.<br /><span style="text-decoration: underline"><br />TIM2 16bit general purpose timer:</span> up counter with auto-reload.  Prescaler any power of 2 from 1-32768.  This timer should be adequate for CIC timing management.  But it sure would be nice to have a 16bit counter for an IRQ timer if TIM1 is being to work as a PWM DAC. TIM2's pinout isn't as great with a few mapped to what's been chosen for CPU D0-3.  There are two other outputs available which conflict with the SPI pins, but one of those is slave select which could me mapped elsewhere via software.<br /><br /><span style="text-decoration: underline">TIM4 8bit basic timer:</span> up counter with auto-reload.  Prescaler any power of 2 from 1-128.  This counter doesn't have any channel outputs pinned to GPIO.  Being an 8bit counter makes it more challenging to use for CIC timing as the theoretical max mangle time is ~2.7msec = 44k clocks at 16Mhz.  That theoretical max doesn't even fit in a 16bit counter without prescaling/rollovers.  One should be able to pull off using this smaller timer for CIC operations but it will certainly be more challenging and require more CPU time counting rollovers.  One solution to fit the CIC in TIM4 would be to set at a higher prescale during mangle timing, and finer prescale between bit transfers.<br /><br />Suppose I'll make it my goal to pull off CIC timing using TIM4, and leave TIM1 &amp; TIM2 for sound &amp; IRQ timer.</div>

					
						<div class="postbody"><br />_________________<br />If you're gonna play the Game Boy, you gotta learn to play it right.  -Kenny Rogers</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4832"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p200989"></a>
				<b class="postauthor">FrankenGraphics</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p200989">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=200989#p200989"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jul 27, 2017 1:06 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Formerly WheelInventor</td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Apr 14, 2016 2:55 am<br /><b>Posts:</b> 1704<br /><b>Location:</b> Gothenburg, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">infiniteneslives wrote:</div><div class="quotecontent">not sure we can afford to get too caught up in the details of replicating the originals with near perfection. With the minimalist goals one would have to accept the CICOprocessor synth for what it is flaws/quirks/personality and all.<br /></div><br />This shouldn't be a problem, i think. If we can use the current version of FT to give us a rough but good enough idea, and then verify how it actually sounds on hardware now and then, that's much easier than needing to verify it on HW after each edit. It should be ok in most cases that FT won't be What You Hear Is What You Get; it's still usable for the sake of composing. If it's close enough, interface-wise and sound-wise, it wouldn't be as dependent on true FT support. What's left then is making a converter and the engine itself. If FT support would arrive eventually, it would be a great addition, but using the synth wouldn't be dependent on it this way.  So, i'd like to propose to have the synth making conversion as straightforward as possible. The more that is, so to speak, one for one (not taking into account the register size), the better. If it sounds a bit different, that's not too much of a worry.<br /><br />If you as a composer/dev plan on using these &quot;expanded&quot; carts, you must have a kazzo anyway, so the hardware requirement is already met.<br />If you're a team, though, you must convince the composer (or yourself if you're the composer) to get a kazzo for testing at home. But it's not that much of a step, i think? I mean, it's a one-time 20-30 usd + shipping depending on version. <br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'm no musician/composer but I don't think it would be the worst thing in the world if only backup/background voices were placed on the expansion synth.</div> I agree. A composer should be able to write music that would carry the idea on its own for the internal sound, and use ext. sound as support. Overtones (playing a harmony at a low volume), drum support (like snare tone while internal tri is still playing bass), extra echoes, chorus, and the occasional extra harmony. Or go all in, and add an &quot;only works with dongle&quot; sticker, if you really want to. <br /><br />If the tuning on one, several or all notes isn't 100% perfect relative to that of the internal (which has its own temperament), you might even exploit that as a chorus effect without having to fine-pitch bend it.</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.frankengraphics.com">http://www.frankengraphics.com</a><!-- m --> - personal NES blog</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7508"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p201026"></a>
				<b class="postauthor">na_th_an</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p201026">Re: Adding features to discrete mapper with multipurposed CI</a></div><div style="float: right;"><a href="./viewtopic.php?p=201026#p201026"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jul 27, 2017 11:39 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon May 27, 2013 9:40 am<br /><b>Posts:</b> 478
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">As far as modifying emulators to provide support, I'm afraid all I can do is to dully simulate some features, such as the ability to switch mirroring by software. It's quite a task.<br /><br />The different features you mention sound great. The extra sound channels, for example, or the aforementioned mirroring toggle. I could design a simple UNROM64 game which would change mirroring mid game, for example, but I can't really go any further as, as I said, my abilities are quite limited when it comes to providing emulator support.</div>

					
						<div class="postbody"><br />_________________<br /><!-- m --><a class="postlink" href="http://www.mojontwins.com">http://www.mojontwins.com</a><!-- m --></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6012"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=9&amp;t=15633&amp;start=30"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=9"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=9&amp;t=15633"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>7</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 97 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=9&amp;t=15633&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=9&amp;t=15633">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=45">4</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=60">5</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=9&amp;t=15633&amp;start=90">7</a> &nbsp;<a href="./viewtopic.php?f=9&amp;t=15633&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=9">NES Hardware and Flash Equipment</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 3 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="15633" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9" selected="selected">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
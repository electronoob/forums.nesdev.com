<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - hacking Battletoads to read input from the Famicom Exp port</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - hacking Battletoads to read input from the Famicom Exp port" href="http://forums.nesdev.com/feed.php?f=2&amp;t=16727" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=2&amp;t=16727';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 12:47 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=16727">hacking Battletoads to read input from the Famicom Exp port</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=16727"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 19 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=16727&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=16727&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=16727&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=16727&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=16727&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208504"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208504">hacking Battletoads to read input from the Famicom Exp port</a></div><div style="float: right;"><a href="./viewtopic.php?p=208504#p208504"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 6:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Hi,<br /><br />How can we make Battletoads read input from the Famicom expansion port, for player 1 and player 2? Neither P1 or P2 work, only the hard-wired controllers.<br /><br />Surprisingly battletoads Japan doesn't work with the exp port either.<br /><br />I can test hacks on my Everdrive using my Famicom Hori arcade stick that can switch between Player 1/Player 2.<br /><br />Player 2 mode works on Mario Bros 1 and Mario Bros 3, but did not work on Battletoads or Mario Bros 2 (player 1 does not work for either of these as well).<br /><br />Here is all I could pull from the USA game. This is the routine that handles reading the controls I think? I got this when setting a breakpoint for #$40 (B Button) on $0029. When I was monitoring the RAM, with each button press I was seeing $0029 get changed.<br /><br />I didn't really understand much. Before this routine there is an AND #$40 which seems to impact the controls if changed to #$80 or #$10, etc.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">00:8D78:A2 01&nbsp; &nbsp; &nbsp; &nbsp; LDX #$01<br />&nbsp;00:8D7A:8E 16 40&nbsp; STX $4016 = #$FF<br />&nbsp;00:8D7D:CA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DEX<br />&nbsp;00:8D7E:8E 16 40&nbsp; STX $4016 = #$FF<br />&nbsp;00:8D81:A2 08&nbsp; &nbsp; &nbsp; &nbsp;LDX #$08<br />&nbsp;00:8D83:AD 16 40&nbsp; LDA $4016 = #$FF<br />&nbsp;00:8D86:6A&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ROR<br />&nbsp;00:8D87:26 15&nbsp; &nbsp; &nbsp;ROL $0015 = #$00<br />&nbsp;00:8D89:AD 17 40&nbsp; LDA $4017 = #$FF<br />&nbsp;00:8D8C:6A&nbsp; &nbsp; &nbsp; &nbsp; ROR<br />&nbsp;00:8D8D:26 16&nbsp; &nbsp; &nbsp;ROL $0016 = #$00<br />&nbsp;00:8D8F:CA&nbsp; &nbsp; &nbsp; &nbsp; DEX<br />&nbsp;00:8D90:D0 F1&nbsp; &nbsp; &nbsp;BNE $8D83<br />&nbsp;00:8D92:A5 15&nbsp; &nbsp; &nbsp;LDA $0015 = #$00<br />&nbsp;00:8D94:AA&nbsp; &nbsp; &nbsp; &nbsp; TAX<br />&nbsp;00:8D95:45 29&nbsp; &nbsp; &nbsp;EOR $0029 = #$40<br />&gt;00:8D97:86 29&nbsp; &nbsp; &nbsp;STX $0029 = #$40<br />&nbsp;00:8D99:25 15&nbsp; &nbsp; &nbsp;AND $0015 = #$00<br />&nbsp;00:8D9B:85 2B&nbsp; &nbsp; &nbsp;STA $002B = #$40<br />&nbsp;00:8D9D:A5 16&nbsp; &nbsp; &nbsp;LDA $0016 = #$00<br />&nbsp;00:8D9F:AA&nbsp; &nbsp; &nbsp; &nbsp; TAX<br />&nbsp;00:8DA0:45 2A&nbsp; &nbsp; &nbsp;EOR $002A = #$00<br />&nbsp;00:8DA2:86 2A&nbsp; &nbsp; &nbsp;STX $002A = #$00<br />&nbsp;00:8DA4:25 16&nbsp; &nbsp; &nbsp;AND $0016 = #$00<br />&nbsp;00:8DA6:85 2C&nbsp; &nbsp; &nbsp;STA $002C = #$00<br />&nbsp;00:8DA8:60&nbsp; &nbsp; &nbsp; &nbsp; RTS -----------------------------------------</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208507"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208507">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208507#p208507"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:02 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Each <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">ROR</tt> instruction at $8D86 and $8D8C needs to be replaced with these two instructions<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">AND #$03&nbsp; ; A = 1 for hardwired, 2 for expansion, 0 for neither<br />CMP #$01&nbsp; ; C = 1 iff this button on either controller is pressed<br /></div><br /><br />Unfortunately, each of these adds 3 bytes to the routine for a total of 6 bytes. My first recommendation would be to eliminate X using a ring counter, but that'd only save one byte. But I can reclaim a few more bytes by turning the next part, a calculation of which buttons on each controller are newly pressed this frame, into a loop:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">P1 = $4016<br />P2 = $4017<br />cur_keys&nbsp; = $15<br />last_keys = $29<br />new_keys&nbsp; = $2B<br /><br />.proc read_pads<br />&nbsp; ldx #$01<br />&nbsp; stx P1<br />&nbsp; lda #$00&nbsp; &nbsp; &nbsp; &nbsp; ; Use A for this because X=1 is needed later<br />&nbsp; sta P1<br />&nbsp; stx cur_keys+1&nbsp; ; Once the 1 gets shifted into carry we're done<br />padbitloop:<br />&nbsp; lda P1<br />&nbsp; and #$03&nbsp; &nbsp; &nbsp; &nbsp; ; A = 1 for hardwired, 2 for expansion, 0 for neither<br />&nbsp; cmp #$01&nbsp; &nbsp; &nbsp; &nbsp; ; C = 1 for some press, 0 for none<br />&nbsp; rol cur_keys+0<br />&nbsp; lda P2<br />&nbsp; and #$03<br />&nbsp; cmp #$01<br />&nbsp; rol cur_keys+1&nbsp; ; On eighth ROL, carry becomes set<br />&nbsp; ; no DEX needed because cur_keys is our loop counter<br />&nbsp; bcc padbitloop<br /><br />&nbsp; ; Because the above expanded by 6 bytes, compensate by eliminating<br />&nbsp; ; the unrolling of last_keys and new_keys calculation<br />&nbsp; ; (from 22 bytes to 15)<br />&nbsp; ; X is still 1 from the above<br />fill_new_keys:<br />&nbsp; lda last_keys,x&nbsp; ; A = keys held last frame<br />&nbsp; eor #$FF&nbsp; &nbsp; &nbsp; &nbsp;; A = keys NOT held last frame<br />&nbsp; and cur_keys,x&nbsp; &nbsp;; A = keys held this frame but not last frame<br />&nbsp; sta new_keys,x<br />&nbsp; lda cur_keys,x<br />&nbsp; sta last_keys,x<br />&nbsp; dex<br />&nbsp; bpl fill_new_keys<br /><br />&nbsp; ; Gained enough for it to fit<br />&nbsp; rts<br />.endproc</div><br />I hope this isn't called in any cycle-timed portions of the game, as it probably won't take the same number of cycles.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208508"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208508">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208508#p208508"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Each <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">ROR</tt> instruction at $8D86 and $8D8C needs to be replaced with these two instructions<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">AND #$03&nbsp; ; A = 1 for hardwired, 2 for expansion, 0 for neither<br />CMP #$01&nbsp; ; C = 1 iff this button on either controller is pressed<br /></div><br /><br />Unfortunately, each of these adds 3 bytes to the routine for a total of 6 bytes. My first recommendation would be to eliminate X using a ring counter, but that'd only save one byte. But I can reclaim a few more bytes by turning the next part, a calculation of which buttons on each controller are newly pressed this frame, into a loop:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">P1 = $4016<br />P2 = $4017<br />cur_keys&nbsp; = $15<br />last_keys = $29<br />new_keys&nbsp; = $2B<br /><br />.proc read_pads<br />&nbsp; ldx #$01<br />&nbsp; stx P1<br />&nbsp; lda #$00&nbsp; &nbsp; &nbsp; &nbsp; ; Use A for this because X=1 is needed later<br />&nbsp; sta P1<br />&nbsp; stx cur_keys+1&nbsp; ; Once the 1 gets shifted into carry we're done<br />padbitloop:<br />&nbsp; lda P1<br />&nbsp; and #$03&nbsp; &nbsp; &nbsp; &nbsp; ; A = 1 for hardwired, 2 for expansion, 0 for neither<br />&nbsp; cmp #$01&nbsp; &nbsp; &nbsp; &nbsp; ; C = 1 for some press, 0 for none<br />&nbsp; rol cur_keys+0<br />&nbsp; lda P2<br />&nbsp; and #$03<br />&nbsp; cmp #$01<br />&nbsp; rol cur_keys+1&nbsp; ; On eighth ROL, carry becomes set<br />&nbsp; ; no DEX needed because cur_keys is our loop counter<br />&nbsp; bcc padbitloop<br /><br />&nbsp; ; Because the above expanded by 6 bytes, compensate by eliminating<br />&nbsp; ; the unrolling of last_keys and new_keys calculation<br />&nbsp; ; (from 22 bytes to 15)<br />&nbsp; ; X is still 1 from the above<br />fill_new_keys:<br />&nbsp; lda last_keys,x<br />&nbsp; eor #$FF<br />&nbsp; and cur_keys,x<br />&nbsp; sta new_keys,x<br />&nbsp; lda cur_keys,x<br />&nbsp; sta last_keys,x<br />&nbsp; dex<br />&nbsp; bpl fill_new_keys<br /><br />&nbsp; ; Gained enough for it to fit<br />&nbsp; rts<br />.endproc</div></div><br /><br />Can we JSR to unused space (stream of FFs maybe?) and replace some of the code so that we can fit those 3 extra bytes?<br /><br />$9470 has a lot of FF entries it looks like.<br /><br />Maybe JSR $9470 where ROR occurs which would also replace the ROL $0015 (26, 15).<br /><br />Then when we jump, we do <br /><br />AND #$03<br />CMP #$01<br />ROL $0015<br />RTS</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208510"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208510">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208510#p208510"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:21 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 10714<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Long strings of $00 or $FF aren't always unused space, they may very well be the high byte portion of look-up tables containing lots of values between -256 and -1, or 0 and 255. Always use a code/data logger to be sure of what's actually unused.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208511"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208511">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208511#p208511"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">JSR/RTS would add even more cycles than the size optimization that I did find (turning $2B/$2C computation into a loop). Try it; it should fit.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208512"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208512">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208512#p208512"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">ReverendSA wrote:</div><div class="quotecontent"><br />Can we JSR to unused space (stream of FFs maybe?) and replace some of the code so that we can fit those 3 extra bytes?<br /><br />$9470 has a lot of FF entries it looks like.<br /><br />Maybe JSR $9470 where ROR occurs which would also replace the ROL $0015 (26, 15).<br /><br />Then when we jump, we do <br /><br />AND #$03<br />CMP #$01<br />ROL $0015<br />RTS</div><br /><br />Here is my proposed modified routine (Psuedo):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;<br />LDX #$01<br />STX $4016<br />DEX<br />STX $4016<br />LDX #$08<br />LDA $4016<br />JSR $9470 &lt;--- Changed<br />LDA $4017<br />JSR $9480 &lt;--- Changed<br />DEX<br />BNE $8D83<br />LDA $0015<br />TAX<br />EOR $0029<br />STX $0029<br />AND $0015<br />STA $002B <br />LDA $0016<br />TAX<br />EOR $002A<br />STX $002A<br />AND $0016<br />STA $002C<br />RTS<br /></div><br /><br />At $9470<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">AND #$03<br />CMP #$01<br />ROL $0015<br />RTS<br /></div><br /><br />At $9480<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">AND #$03<br />CMP #$01<br />ROL $0016<br />RTS<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208513"></a>
				<b class="postauthor" style="color: #FF3300">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208513">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208513#p208513"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:31 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 20409<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Let me restate what I wrote one more time:<br /><br />You probably will not need to move things out to $9470 and $9480. Though I made the first part of the routine longer, I made the second part shorter to compensate.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208514"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208514">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208514#p208514"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 7:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Let me restate what I wrote one more time:<br /><br />You probably will not need to move things out to $9470 and $9480. Though I made the first part of the routine longer, I made the second part shorter to compensate.</div><br /><br />Here is what I have based on your post, to replace the entire routine.<br /><br />But for BCC and BPL, I do not understand. Your code said BCC padbitloop, but for BCC all I could see was $90. I don't know if it takes arguments, or works automatically.<br /><br />A2 01<br />8E 16 40<br />A9 00<br />8D 16 40<br />86 16<br />AD 16 40<br />29 03<br />C9 01<br />26 15<br />AD 17 40<br />29 03<br />C9 01<br />26 16<br />90<br />B5 29<br />49 FF<br />35 15<br />95 15<br />B5 15<br />95 29<br />CA<br />10<br />60<br /><br /><br /><strong><span style="font-size: 150%; line-height: normal">Edit:</span></strong><br /><br />Okay, I think the byte next to Branches is FF - X, X being whichever byte you put in there. I revised the above:<br /><br />A2 01<br />8E 16 40<br />A9 00<br />8D 16 40<br />86 16<br />AD 16 40<br />29 03<br />C9 01<br />26 15<br />AD 17 40<br />29 03<br />C9 01<br />26 16<br />90 <strong>EC</strong><br />B5 29<br />49 FF<br />35 15<br />95 15<br />B5 15<br />95 29<br />CA<br />10 <strong>F1</strong><br />60<br /><br />90 E7 should take us back to AD 16 40 (lda P1; padbitloop).<br /><br />10 EC should take us back 13 bytes, to B5 29 (lda last_keys,x; fillnewkeys).</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208522"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208522">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208522#p208522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 9:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Let me restate what I wrote one more time:<br /><br />You probably will not need to move things out to $9470 and $9480. Though I made the first part of the routine longer, I made the second part shorter to compensate.</div><br /><br />For some reason though, pushing the keys does nothing at all. The game is still running though.<br /><br />I've implemented it as you wrote it (I hope). Here is what FCEUX shows:<br /><br /> 00:8D78:A2 01     LDX #$01<br /> 00:8D7A:8E 16 40  STX $4016 = #$FF<br /> 00:8D7D:A9 00     LDA #$00<br /> 00:8D7F:8D 16 40  STA $4016 = #$FF<br /> 00:8D82:86 16     STX $0016 = #$FF<br /> 00:8D84:AD 16 40  LDA $4016 = #$FF<br /> 00:8D87:29 03     AND #$03<br /> 00:8D89:C9 01     CMP #$01<br /> 00:8D8B:26 15     ROL $0015 = #$00<br /> 00:8D8D:AD 17 40  LDA $4017 = #$FF<br /> 00:8D90:29 03     AND #$03<br /> 00:8D92:C9 01     CMP #$01<br /> 00:8D94:26 16     ROL $0016 = #$FF<br /> 00:8D96:90 EC     BCC $8D84<br /> 00:8D98:B5 29     LDA $29,X @ $002B = #$00<br /> 00:8D9A:49 FF     EOR #$FF<br /> 00:8D9C:35 15     AND $15,X @ $0017 = #$55<br /> 00:8D9E:95 15     STA $15,X @ $0017 = #$55<br /> 00:8DA0:B5 15     LDA $15,X @ $0017 = #$55<br /> 00:8DA2:95 29     STA $29,X @ $002B = #$00<br /> 00:8DA4:CA        DEX<br /> 00:8DA5:10 F1     BPL $8D98<br /> 00:8DA7:60        RTS ---------------------------------------</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208523"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208523">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208523#p208523"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 9:30 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">ReverendSA wrote:</div><div class="quotecontent"><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Let me restate what I wrote one more time:<br /><br />You probably will not need to move things out to $9470 and $9480. Though I made the first part of the routine longer, I made the second part shorter to compensate.</div><br /><br />For some reason though, pushing the keys does nothing at all. The game is still running though.<br /><br />I've implemented it as you wrote it (I hope). Here is what FCEUX shows:<br /><br /> 00:8D78:A2 01     LDX #$01<br /> 00:8D7A:8E 16 40  STX $4016 = #$FF<br /> 00:8D7D:A9 00     LDA #$00<br /> 00:8D7F:8D 16 40  STA $4016 = #$FF<br /> 00:8D82:86 16     STX $0016 = #$FF<br /> 00:8D84:AD 16 40  LDA $4016 = #$FF<br /> 00:8D87:29 03     AND #$03<br /> 00:8D89:C9 01     CMP #$01<br /> 00:8D8B:26 15     ROL $0015 = #$00<br /> 00:8D8D:AD 17 40  LDA $4017 = #$FF<br /> 00:8D90:29 03     AND #$03<br /> 00:8D92:C9 01     CMP #$01<br /> 00:8D94:26 16     ROL $0016 = #$FF<br /> 00:8D96:90 EC     BCC $8D84<br /> 00:8D98:B5 29     LDA $29,X @ $002B = #$00<br /> 00:8D9A:49 FF     EOR #$FF<br /> 00:8D9C:35 15     AND $15,X @ $0017 = #$55<br /> 00:8D9E:95 15     STA $15,X @ $0017 = #$55<br /> 00:8DA0:B5 15     LDA $15,X @ $0017 = #$55<br /> 00:8DA2:95 29     STA $29,X @ $002B = #$00<br /> 00:8DA4:CA        DEX<br /> 00:8DA5:10 F1     BPL $8D98<br /> 00:8DA7:60        RTS ---------------------------------------</div><br /><br /><br />Oh, my bad!  <br /><br />I was storing storing #$15 at 8D9E when I should have stored #$2B according to your code.<br /><br />I changed it to #$2B and now my character can jump and punch!! I'm going to test this on my ED and report back.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208524"></a>
				<b class="postauthor">rainwarrior</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208524">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208524#p208524"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 9:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5165_1471663472.jpg" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jan 22, 2012 12:03 pm<br /><b>Posts:</b> 6592<br /><b>Location:</b> Canada
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just in case it helps, in FCEUX's debugger if you left click in the grey column just to the left of the disassembly, you can use its built-in assembler to type a patch in assembly instead of trying to convert everything to hex.<br /><br />There are no labels in this assembler, but you type the target address for branches, e.g. &quot;BCC $8D96&quot; will create a branch instruction with the correct relative value to get to $8D96.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5165"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208525"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208525">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208525#p208525"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 9:47 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay.<br /><br />It works, holy crap.<br /><br />Even more surprising, the hack allows player 2 to join via pushing start. I thought start was not applicable for player 2 on Famicom.<br /><br />That's insane.<br /><br />Thanks a lot tepples.<br /><br />My friend and I have been meaning to play Battletoads USA on my famicom since forever and now we can do it.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208526"></a>
				<b class="postauthor">ReverendSA</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208526">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208526#p208526"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 10:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Mar 23, 2016 12:27 pm<br /><b>Posts:</b> 17
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">Just in case it helps, in FCEUX's debugger if you left click in the grey column just to the left of the disassembly, you can use its built-in assembler to type a patch in assembly instead of trying to convert everything to hex.<br /><br />There are no labels in this assembler, but you type the target address for branches, e.g. &quot;BCC $8D96&quot; will create a branch instruction with the correct relative value to get to $8D96.</div><br /><br />Thanks for that info. Would have saved me an extra hour when I was trying to learn branches. The labels were confusing me for a bit.<br /><br />I'm going to publish this hack as it may very well help others such as myself. I will credit you for your help Tepples.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7470"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p208527"></a>
				<b class="postauthor">Gilbert</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208527">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208527#p208527"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Nov 22, 2017 10:15 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=4653.gif" width="60" height="60" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Dec 12, 2010 10:27 pm<br /><b>Posts:</b> 319<br /><b>Location:</b> Hong Kong
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">ReverendSA wrote:</div><div class="quotecontent">Okay.<br />Even more surprising, the hack allows player 2 to join via pushing start. I thought start was not applicable for player 2 on Famicom.<br /></div><br />I think it's possible that all the codes for P2 joining in with START are intact, just that the hardwired P2 pad does not have a <em>physical</em> START button so that you can never use this feature, so if you hack the game to recognise inputs from expansion port the START button on the extra P2 controller will work as intended. It may even be possible that if you modify the console by changing the hardwired P2 pad to some other controllers the START button may work too.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4653"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p208549"></a>
				<b class="postauthor">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p208549">Re: hacking Battletoads to read input from the Famicom Exp p</a></div><div style="float: right;"><a href="./viewtopic.php?p=208549#p208549"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Nov 23, 2017 8:26 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1421
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Gilbert wrote:</div><div class="quotecontent"><div class="quotetitle">ReverendSA wrote:</div><div class="quotecontent">Okay.<br />Even more surprising, the hack allows player 2 to join via pushing start. I thought start was not applicable for player 2 on Famicom.<br /></div><br />I think it's possible that all the codes for P2 joining in with START are intact, just that the hardwired P2 pad does not have a <em>physical</em> START button so that you can never use this feature, so if you hack the game to recognise inputs from expansion port the START button on the extra P2 controller will work as intended. It may even be possible that if you modify the console by changing the hardwired P2 pad to some other controllers the START button may work too.</div><br />It would also work properly on an AV Famicom, which uses standard 7-pin NES controllers (which <em>both</em> have Select/Start buttons) instead of the hardwired ones.</div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=16727"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=16727"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 19 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=2&amp;t=16727&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=2&amp;t=16727&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 7 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="16727" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Code stuck at $0000</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Newbie Help Center" href="http://forums.nesdev.com/feed.php?f=10" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Code stuck at $0000" href="http://forums.nesdev.com/feed.php?f=10&amp;t=12089" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '15';
	var base_url = './viewtopic.php?f=10&amp;t=12089';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Sun May 10, 2015 4:42 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=10&amp;t=12089">Code stuck at $0000</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=12089"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 29 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=12089&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=12089&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=10&amp;t=12089&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=10&amp;t=12089&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=10&amp;t=12089&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137095"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137095">Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137095#p137095"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Nov 30, 2014 4:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 100<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, this is new to me. I just did a first test for my code and it just showed a grey screen. Both PPU and nametable viewers were the same. I checked the debugger and it was stuck at $0000. This is where the graphics are. Why it's there? it's supposed to start running from $8000 where the PRG bank is. Like I said, this is new to me, so I don't know what causes this and how to fix it.<br /><br />Code: <!-- m --><a class="postlink" href="http://pastebin.com/grhNpN87">http://pastebin.com/grhNpN87</a><!-- m --><br /><br />Note! Most of the code is just lists and tables. The actual code is not very long.</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137099"></a>
				<b class="postauthor">Jeroen</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137099">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137099#p137099"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Nov 30, 2014 7:32 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3369.png" width="16" height="32" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Jul 03, 2007 1:49 pm<br /><b>Posts:</b> 918
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Been awhile since I did anything with nesasm, but it looks like you have your vectors in a seperate bank AFTER the chr data.<br /><br />You want your vectors to be in your prg bank. (at the end)<br /><br />edit: So after looking at some nesasm specific code. Try swapping bank 1 and bank 2. (so vectors first, then chr)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3369"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137100"></a>
				<b class="postauthor">snarfblam</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137100">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137100#p137100"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Nov 30, 2014 8:58 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri May 13, 2011 7:36 pm<br /><b>Posts:</b> 104
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You need to make sure your vectors are showing up at the correct address<br /><br />from <!-- m --><a class="postlink" href="http://www.pagetable.com/?p=410">http://www.pagetable.com/?p=410</a><!-- m --><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Signal&nbsp; &nbsp; &nbsp;Vector<br />NMI&nbsp; &nbsp; &nbsp; &nbsp; $FFFA/$FFFB<br />RESET&nbsp; &nbsp; &nbsp; $FFFC/$FFFD<br />IRQ/BRK&nbsp; &nbsp; $FFFE/$FFFF<br /></div><br /><br />(Depending on the mapper) this means that you generally want the vectors to show up at the end of the last bank. It's easy enough to confirm that they are in the right place with the hex editor in FCEUX. You should be seeing 00 80 (i.e. $8000) at $FFFC. If the the mapper does not have a stable startup state and can allow bank swapping where the vectors are found, you'll want to duplicate the vectors and the basic mapper configuration at the end of every bank. I've never used NESASM, but there should be a directive to pad to a specified address. In ASM6 it would be &quot;.PAD $FFFA&quot;, which would be followed by your vectors.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=4871"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137106"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137106">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137106#p137106"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Nov 30, 2014 11:06 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 100<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">for some reason it started working when I swapped the banks 1 and 2 around (they were wrong way around when comparing to my old codes). Now we have new issue. The background is not loading correctly (I've had this issue before and I feel like I might never truly understand why I keep getting this same issue over and over again). The scrolling is not working correctly either. It's &quot;flickering&quot; between the two nametables even though it should slowly scroll vertically.<br /><br />Here is the new code:<br /><!-- m --><a class="postlink" href="http://pastebin.com/QZAQi2Pf">http://pastebin.com/QZAQi2Pf</a><!-- m --></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137129"></a>
				<b class="postauthor">Kasumi</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137129">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137129#p137129"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Nov 30, 2014 6:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3504.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Apr 02, 2008 2:09 pm<br /><b>Posts:</b> 798
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">There are quite a few problems here.<br /><br />Understand that you can only safely write to $2006/$2007 (and a few other registers) at specific times. <br /><br />If rendering is disabled entirely, you can safely write to them at any point. Disabling rendering is done by writing 0 to $2001 (which you have named PPUMask). This also makes it so the background, sprites etc aren't shown, so you can't do it during gameplay. <br /><br />Also, directly after this NMI fires, you have roughly ~2270 cycles to safely write to them. <br /><br />The time after the NMI fires is not enough time to write an ENTIRE nametable. If you want to write all of it in one go, you HAVE to disable rendering. <br /><br />Games that scroll do update the background while rendering is enabled, yes. They use the beginning of the NMI to only write the new row or column that was scrolled onto the screen, because it's pretty difficult to update even 4 rows (with their attributes) in the limited ~2270 cycle time.<br /><br />So for now I recommend initializing your nametables before you enable rendering for the first time after reset and removing the updates from your NMI.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDX #$01<br />&nbsp;STX updateBg0<br />&nbsp;STX updateBg1<br />&nbsp;STX updateSpr<br />&nbsp;<br />&nbsp;jsr BgUpdate0<br />&nbsp;jsr BgUpdate1<br /></div><br />There are instructions called read-modify-write instructions. DEC/LSR are examples of these. They're called that because they read the value, modify it and write it as what seems like one step.<br /><br />So... DEC RAMlocation still reads RAMlocation, modifies the value it read (subtracts 1), and writes the new value (the result of the subtraction.) even if it doesn't change A, X or Y.<br /><br />Don't use read-modify-write instructions on hardware registers, generally. $2005 can refer to two different values (it affects X on the first write, Y on the second). A read-modify-write instruction on a register that swaps on access like this could make it do something like... read the X scroll, subtract 1, and write that to the Y scroll. (I doubt exactly that would happen for $2005, but that should at least give you an idea of why read-modify-write instructions don't always behave nicely with registers)<br /><br />If it's not clear what a read-modify-write instruction is, just avoid anything that's not LD?/ST? on a register for now. And don't use LD? on a register that's not a read register, or ST? on a register that's not a write register. <a href="http://wiki.nesdev.com/w/index.php/PPU_registers" class="postlink">You can read what's what here.</a> <br /><br />A quick code example:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda #$00<br />sta $2005<br />lda $2005<br />lda $2005;You may not get zero in the accumulator after either read... $2005 has no obligation to give you what you wrote there ever.<br /></div><br /><br />For this specific problem, you want to have RAM that represents that scroll and modify THAT RAM. Then store the value of this RAM to $2005 every frame. Don't modify $2005 directly.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ScrollBg:<br />&nbsp;LDY timer0<br />&nbsp;CPY #$02<br />&nbsp;BNE SkipScroll<br />&nbsp;LDY #$00<br />&nbsp;STY PPUScroll;Store 0 to the X position<br />&nbsp;LDX ScrollY<br />&nbsp;DEX<br />&nbsp;STX ScrollY<br />&nbsp;STX PPUScroll;<br />&nbsp;STY timer0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; Reset timer0<br />SkipScroll:<br />&nbsp;RTS<br /></div><br />The above is a small bit glitchy just because ScrollY will go through 0-255, but the screen is only 240 pixels tall. Try fixing that quirk yourself.<br /><br />Not related to the issue, but this won't work:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDY #$01<br />&nbsp;STY mainWait<br />MainLoopWait:<br />&nbsp;CPY #$00<br />&nbsp;BNE MainLoopWait;Nothing below this branch will ever run<br />&nbsp;JMP MainLoop<br /></div><br />1 is in Y.  You compare it to zero. 1 doesn't equal 0, so the bne will always branch.<br /><br />Based on what's in your NMI, it looks like you want this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDY #$01<br />&nbsp;STY mainWait<br />MainLoopWait:<br />&nbsp;LDY mainWait<br />&nbsp;BNE MainLoopWait<br />&nbsp;JMP MainLoop<br /></div><br /><br />You're also missing some RTS instructions under Joy1Read and Joy2Read, which pretty much breaks Joy1Update and Joy2Update. They're checking the value in A at the end of what should be JoyXRead, but JoyXRead runs into BgUpdate0 because of lack of RTS instructions so JoyXUpdate is using whatever BgUpdate0 last did rather than the input from JoyXRead.<br /><br /><br />Anyway, read and digest this. Fixing all of these won't necessarily fix the problem at hand, but in that case just post again. Also, I have no idea what your background should really look like without your CHR. I could verify the values by hand using FCEUX's nametable viewer, I guess... but that's a lot of work. The few values I did look at make it seem like the above changes fix it, but in the future think about if you're providing enough info to really look at the problems you want solved.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3504"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137145"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137145">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137145#p137145"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 4:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 100<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks for the help so far! It's getting closer to working. There are still some issues:<br />Some of the graphics in the second nametable overflow to the first one.<br /><br />These are the only two lines that actually has something written to them (rest is $FF which is a blank tile).<br />Each .db has 32 values and each table has 30 rows. That should be right (unless the background update code isn't working as intended...)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.db $FF,$19,$15,$0A,$22,$0E,$1B,$FF,$24,$24,$24,$24,$24,$24,$24,$FF,$0B,$18,$16,$0B,$FF,$25,$25,$25,$25,$25,$25,$25,$FF,$FF,$FF,$FF ; 1B<br />&nbsp;.db $FF,$1C,$0C,$1B,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$FF,$FF,$FF,$11,$12,$FF,$1C,$0C,$1B,$FF,$00,$00,$00,$00,$00,$00,$00,$00,$FF ; 1C<br /></div><br /><br />The second thing is that the background &quot;twitches&quot; every time it wraps around. I made the vertical scroll to detect if the value underflows to $FF and setting it to $F0 (which as far as I know is 240) before storing it to $2005.<br /><br />See the attached video for more about what's happening right now.<br /><br />Here is the full code: <!-- m --><a class="postlink" href="http://pastebin.com/Gn8Wiear">http://pastebin.com/Gn8Wiear</a><!-- m --><br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Video of the current code</span><br />
		<!-- method used here from http://alistapart.com/articles/byebyeembed / autosizing seems to not work always, this will not fix -->
			<object width="320" height="285" classid="CLSID:6BF52A52-394A-11d3-B153-00C04F79FAA6" id="wmstream_2254">
				<param name="url" value="./download/file.php?id=2254" />
				<param name="showcontrols" value="1" />
				<param name="showdisplay" value="0" />
				<param name="showstatusbar" value="0" />
				<param name="autosize" value="1" />
				<param name="autostart" value="0" />
				<param name="visible" value="1" />
				<param name="animationstart" value="0" />
				<param name="loop" value="0" />
				<param name="src" value="./download/file.php?id=2254" />
				<!--[if !IE]>-->
					<object width="320" height="285" type="video/x-ms-wmv" data="./download/file.php?id=2254">
						<param name="src" value="./download/file.php?id=2254" />
						<param name="controller" value="1" />
						<param name="showcontrols" value="1" />
						<param name="showdisplay" value="0" />
						<param name="showstatusbar" value="0" />
						<param name="autosize" value="1" />
						<param name="autostart" value="0" />
						<param name="visible" value="1" />
						<param name="animationstart" value="0" />
						<param name="loop" value="0" />
					</object>
				<!--<![endif]-->
			</object>

		
			<br />
			
			<span class="gensmall"><a href="./download/file.php?id=2254">NES_Thing.wmv</a> [ 2.97 MiB | Viewed 435 times ]</span>
		

		<br />
	</div></div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137152"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137152">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137152#p137152"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 6:24 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 7354<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">I checked the debugger and it was stuck at $0000. This is where the graphics are.</div><br />Just to clear something up: this is NOT where the graphics are. This is where (PRG) RAM is. Well, at least up until $07FF, after that there are mirrors of it. An then the memory mapped registers. and then mirrors of those.<br /><br />Anyway, my point is that yes, the pattern table is at $0000-$1FFF, but that's in the PPU addressing space, which is completely separate from the CPU addressing space.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137163"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137163">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137163#p137163"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 9:58 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 100<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Just to clear something up: this is NOT where the graphics are. This is where (PRG) RAM is. Well, at least up until $07FF, after that there are mirrors of it. An then the memory mapped registers. and then mirrors of those.<br /><br />Anyway, my point is that yes, the pattern table is at $0000-$1FFF, but that's in the PPU addressing space, which is completely separate from the CPU addressing space.</div><br /><br />In the original post I meant $0000 in ROM. In my code I usually put graphics starting at ROM position $0000.</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137182"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137182">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137182#p137182"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 4:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">There is no actual &quot;ROM position $0000&quot; -- this is purely a terminology thing, which is where the confusion is stemming from.  I'm not even sure what you're trying to say here (it sure isn't &quot;file offset $0000&quot;, so I think what you mean is PPU RAM $0000, but I'm not sure if you understand how that correlates with CHR-ROM or not).<br /><br />So let's take some time to clarify about your setup and the memory mapping of <strong>everything</strong>, because this will almost certainly help you understand:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.inesprg 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 PRG bank<br />&nbsp;.ineschr 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 CHR bank<br />&nbsp;.inesmap 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; No mapper<br />&nbsp;.inesmir 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Vertical mirroring<br /><br />...<br /><br />&nbsp;.bank 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PRG bank<br />&nbsp;.org $8000<br /><br />...<br /><br />&nbsp;.bank 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHR bank<br />&nbsp;.org $0000<br />&nbsp;.incbin &quot;Spriteset.chr&quot;<br />&nbsp;.incbin &quot;Tileset.chr&quot;<br />&nbsp;<br />&nbsp;.bank 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Vector bank<br />&nbsp;.org $FFFA<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw 0<br /></div><br /><br />1. You're using mapper #0, a.k.a. <a href="http://wiki.nesdev.com/w/index.php/NROM" class="postlink">NROM</a>, but more specifically NROM-128.  NROM-128 consists of (1) 16KByte PRG bank, and (1) 8KByte CHR bank.<br /><br />2. With NROM-128, CPU address space (a.k.a. &quot;ROM&quot;, because it's read-only-memory) $8000-BFFF is mapped to the 1st 16KByte PRG bank/page in the ROM file.  These would be the bytes at file offset $0010-400F.<br /><br />3. With NROM-128, CPU address space (a.k.a. &quot;ROM&quot;, because it's read-only-memory) $C000-FFFF is a mirror (think &quot;copy&quot;) of the 1st 16KByte PRG bank/page in the ROM file.  These would be the bytes at file offset $0010-400F.<br /><br />4. The important thing to understand about items #2 and #3 above is that you're using 16KBytes of PRG, while the actual CPU memory map supports 32KBytes ($8000-FFFF).  This is why your PRG bank gets &quot;mirrored&quot; (keep reading).  Why that's important: because your RESET, NMI, and IRQ vectors need to reside within the very top of the PRG bank so that they get mapped to $FFFA-FFFF.<br /><br />5. With NROM-128, PPU address space $0000-1FFF (a.k.a. CHR-ROM or VROM) is mapped to the 1st 8KByte CHR bank/page in the ROM file.  These would be the bytes at file offset $4010 to end-of-file.<br /><br />6. Your above code has actual problems, specifically you're stating &quot;.inesprg 1&quot; even though within your code you're trying to use two 16KB PRG banks (kind of.  What was done there obviously isn't correct, indicating someone doesn't understand the memory map vs. how the assembler works).  Furthermore, the <strong>very last bank must be CHR</strong>.  So all you're doing in your code is making a mess.  I will show you how to fix this momentarily.<br /><br />7. I strongly suggest, if using asm6, to use the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">-l</tt> (dash lowercase ELL) flag to generate a listing file and actually take the time to read it.  This can help you understand file offsets vs. what's getting generated + put where in the file -- because it matters.<br /><br />Back to addressing.  Here's a chart to help you, given how your code is right now (not the fixed version):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">CPU address&nbsp; &nbsp;File offset&nbsp; &nbsp; &nbsp; &nbsp;Purpose<br />------------&nbsp; ------------&nbsp; &nbsp; &nbsp; --------------------------------------------------------------------<br />n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$0000-000F&nbsp; &nbsp; &nbsp; &nbsp; iNES header (not used by the console, only emulators)<br />$0000-07FF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RAM (used for zero page, stack, etc.)<br />$2000-2007&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NES PPU registers<br />$4000-401F&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NES APU and I/O registers<br />$6000-7FFF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SRAM (a.k.a. WRAM), but not used here<br />$8000-BFFF&nbsp; &nbsp; $0010-400F&nbsp; &nbsp; &nbsp; &nbsp; Code<br />$C000-FFFF&nbsp; &nbsp; $0010-400F&nbsp; &nbsp; &nbsp; &nbsp; Code (should include RESET/NMI/IRQ vectors)<br /><br />PPU address&nbsp; &nbsp;File offset&nbsp; &nbsp; &nbsp; &nbsp;Purpose<br />------------&nbsp; ------------&nbsp; &nbsp; &nbsp; --------------------------------------------------------------------<br />$0000-0FFF&nbsp; &nbsp; $4010-500F&nbsp; &nbsp; &nbsp; &nbsp; Pattern table #0 (mapped to lower half of CHR-ROM bank #0)<br />$1000-1FFF&nbsp; &nbsp; $5010-&lt;eof&gt;&nbsp; &nbsp; &nbsp; &nbsp;Pattern table #1 (mapped to upper half of CHR-ROM bank #0)<br />$2000-23FF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name table #0<br />$2400-27FF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name table #1<br />$2800-2BFF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name table #2<br />$2C00-2FFF&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Name table #3<br />$3F00-3F1F&nbsp; &nbsp; n/a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Palette<br /></div><br /><br />References:<br /><ul><li><a href="http://wiki.nesdev.com/w/index.php/CPU_memory_map" class="postlink">http://wiki.nesdev.com/w/index.php/CPU_memory_map</a></li><li><a href="http://wiki.nesdev.com/w/index.php/PPU_memory_map" class="postlink">http://wiki.nesdev.com/w/index.php/PPU_memory_map</a></li></ul><br />And here is your fixed code:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.inesprg 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 PRG bank<br />&nbsp;.ineschr 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 CHR bank<br />&nbsp;.inesmap 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; No mapper<br />&nbsp;.inesmir 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Vertical mirroring<br /><br />...<br /><br />&nbsp;.bank 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PRG bank<br />&nbsp;.org $C000<br /><br />...code here...<br /><br />&nbsp;.org $FFFA<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw IRQ<br /><br />&nbsp;.bank 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHR bank<br />&nbsp;.incbin &quot;Spriteset.chr&quot;<br />&nbsp;.incbin &quot;Tileset.chr&quot;<br /></div><br /><br />Note that the base origin address is $C000, not $8000 here -- because essentially one 16KByte PRG bank means you should be treating your code as $C000-FFFF in CPU memory space, not $8000-BFFF.<br /><br />Also since you're not using an IRQ handler per se, be sure to make a label called <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">IRQ</tt> and make its instruction <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">rti</tt>.  You can even do something like this (there's nothing fancy about this):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">NMI:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; NMI code<br />&nbsp;PHA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Push A, X &amp; Y to stack<br />&nbsp;TXA<br />...<br />&nbsp;TAX<br />&nbsp;PLA<br />IRQ:<br />&nbsp;RTI<br /></div><br /><br />Your code should then no longer &quot;crash at $0000&quot;.  The reason it was &quot;crashing at $0000&quot; was because your CHR-ROM banks were quite possibly being used as content within CPU memory space $C000-FFFF, and I'd bet money the last few bytes were all zeros, hence RESET vector was $0000, hence &quot;crash at $0000&quot;.  A code listing (see above) would shed light on this.<br /><br />If you ever want to extend your code to use NROM-256 (that is: (2) 16KByte PRG banks, and (1) CHR bank), then it's quite simple:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.inesprg 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 2 PRG banks<br />&nbsp;.ineschr 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 CHR bank<br />&nbsp;.inesmap 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; No mapper<br />&nbsp;.inesmir 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Vertical mirroring<br /><br />...<br /><br />&nbsp;.bank 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PRG bank<br />&nbsp;.org $8000<br /><br />...code here (up to 16KBytes)<br /><br />&nbsp;.bank 1<br />&nbsp;.org $C000<br /><br />...code here (up to 16KBytes minus vectors)...<br /><br />&nbsp;.org $FFFA<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw IRQ<br /><br />&nbsp;.bank 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHR bank<br />&nbsp;.incbin &quot;Spriteset.chr&quot;<br />&nbsp;.incbin &quot;Tileset.chr&quot;<br /></div><br /><br />Alternately, you could try to fit all your code one single 32KByte bank (two 16KByte banks from the iNES header perspective):<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.inesprg 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 2 PRG banks<br />&nbsp;.ineschr 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; 1 CHR bank<br />&nbsp;.inesmap 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; No mapper<br />&nbsp;.inesmir 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; Vertical mirroring<br /><br />...<br /><br />&nbsp;.bank 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PRG bank<br />&nbsp;.org $8000<br /><br />...code here (up to 32KBytes minus vectors)...<br /><br />&nbsp;.org $FFFA<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw IRQ<br /><br />&nbsp;.bank 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHR bank<br />&nbsp;.incbin &quot;Spriteset.chr&quot;<br />&nbsp;.incbin &quot;Tileset.chr&quot;<br /></div><br /><br />P.S. -- I have no idea what the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.bank</tt> pseudo-op does in whatever assembler you're using, so some of the advice I've given you may not be correct for your assembler.  I have no idea what your assembler thinks the size of a &quot;bank&quot; is.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137185"></a>
				<b class="postauthor">Kasumi</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137185">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137185#p137185"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 4:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3504.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Apr 02, 2008 2:09 pm<br /><b>Posts:</b> 798
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">DEX doesn't affect the carry flag, and isn't affected by the carry flag.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDX scrollY<br />&nbsp;SEC;Carry is set<br />&nbsp;DEX;This doesn't affect the carry, so it's still set<br />&nbsp;BCS SkipScrollFix;This will always branch.<br /></div><br /><a href="http://www.obelisk.demon.co.uk/6502/reference.html" class="postlink">Here is a handy reference guide for which instructions affect which flags.</a><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I made the vertical scroll to detect if the value underflows to $FF and setting it to $F0 (which as far as I know is 240) before storing it to $2005.</div><br />$F0 is 240, but you don't actually ever want 240 itself. The screen is 240 pixels tall. Pixel 0 through Pixel 239. Pixel 240 out of the screen bounds.<br /><br />Here's a fix for the twitching.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDX scrollY<br />&nbsp;DEX<br />&nbsp;cpx #$F0<br />&nbsp;BCC SkipScrollFix<br />&nbsp;LDX #$EF<br />SkipScrollFix:<br />&nbsp;STX scrollY<br /></div><br /><br />Also, just a tip, you don't have to use hex. The below would work fine.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;LDX scrollY<br />&nbsp;DEX<br />&nbsp;cpx #240<br />&nbsp;BCC SkipScrollFix<br />&nbsp;LDX #239<br />SkipScrollFix:<br />&nbsp;STX scrollY<br /></div><br /><br />This can help your code readability, since you don't have to convert to make sure your values are right.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">In the original post I meant $0000 in ROM. In my code I usually put graphics starting at ROM position $0000.</div><br />Tokumaru is still correct. We're not trying to be pedantic, this is an important thing to understand.<br /><br />It is a little confusing, but $0000 can refer to two things. <br /><br />Context 1. The first byte of the first tile of CHR. (This is mapped to the PPU)<br />Context 2. The first byte of zero page RAM. (This is mapped to the CPU)<br />Edit: I guess there's a third Context which is the first byte of the ROM. But it's impossible for graphics to go there as well. It'd be the header. Even if the rom was headerless, Either PRG or the trainer is first, and you can't have no PRG.<br /><br />The 6502 CPU in the NES cannot execute from context 1 ever. So if your code (program counter) is ever at $0000, it's always context 2 which is why Tokumaru is correct that that's not where your graphics are. lda $0000 will always load from zero page RAM, jmp $0000 will start executing from the first byte of zero page RAM etc. Never your tiles. The only way for the CPU to access anything mapped to the PPU is through the PPU registers $2007/$2006 etc.<br /><br />@koitsu: Some of that info is incorrect. NESASM's .bank directive divides the ROM into 8KB banks, not 16KB. Meanwhile .inesprg actually is 16KB. So if you have  .inesprg 1, you still need a .bank 0 and .bank 1 for PRG. .bank 2 is where CHR starts (if there is CHR). With .inesprg 2 (which is still NROM), you need .bank 0, .bank 1, .bank 2 and .bank 3 for PRG. .bank 4 is where CHR starts (if there is CHR). <br /><br />Typically, it would be set up a bit more like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.inesprg 1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; 1 16KB PRG bank<br />&nbsp;.ineschr 1&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; 1 CHR bank<br /><br />&nbsp;.bank 0&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;;First 8KB PRG bank<br />&nbsp;.org $C000<br />&nbsp;;Code here<br /><br />&nbsp;.bank 1<br />&nbsp;.org $E000;Second 8KB PRG bank<br />&nbsp;;Code in second 8KB bank here<br /><br /><br />&nbsp;.org $FFFA;Begin Vectors<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw 0<br /><br />&nbsp;.bank 2<br />&nbsp;.org $0000<br />&nbsp;;CHR here<br /></div><br /><br />But what he has isn't wrong.<br /><br />As for the nametable overflow... that's an interesting one. I fixed it, but I don't know why the fix works.<br /><br />Seems that the address $2007 will write to is affected by writes to either $2000 or $2001. I moved your writes to $2000/$2001 in BgUpdate0 and BgUpdate1  to before the writes to $2006 and $2007 and it works now. <br /><br />It must be some quirky hardware thing, because it only happens on more accurate emulators. Anyone have any ideas about why it happens? I can't seem to find anything about $2000/$2001 having an effect on $2007 in any way.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3504">Kasumi</a> on Mon Dec 01, 2014 4:52 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3504"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137187"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137187">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137187#p137187"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 4:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Thanks, @Kasumi.<br /><br />See my edit + P.S. at the bottom of my previous post, re: no idea what the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.bank</tt> directive does and what the assembler thinks a bank size is.  Yes, if NESASM thinks it's 8KBytes, then that would make his code &quot;slightly&quot; more correct, except stuff was still in the wrong order (he went PRG (bank 0) + CHR (bank 1) + PRG (bank 2) which isn't correct).<br /><br />As for the write-to-$2000-before-$2006 fixing things -- yes, that makes sense, and isn't a &quot;mystery&quot;.  This has to do with how $2000, $2005, and $2006 all affect the PPU's &quot;internal&quot; values for everything.  The order you write to things matters!<br /><br />All of that is documented here:<br /><br /><ul><li><a href="http://wiki.nesdev.com/w/index.php/The_skinny_on_NES_scrolling" class="postlink">The skinny on NES scrolling</a> </li><li><a href="http://wiki.nesdev.com/w/index.php/PPU_scrolling" class="postlink">PPU scrolling</a> </li></ul><br />I recommend reading the 2nd document first (I believe Tepples authored it, or at least made the screenshots), but the first document is what's most important.  Writes to $2000 (PPUCTRL) matter.  So yes, there is actually a &quot;correct&quot; (so-to-speak) order-of-operation in how you should write to $2000 / $2005 / $2006.<br /><br />If you aren't sure what to do, well, I was told at some point (I wish I could find the forum post/thread!) to basically just re-set certain things to $00 (I believe two writes to $2005, and/or two writes to $2006).  I wish I could find the post, I'm sorry.<br /><br />Specifically this crap is the one thing I hate about the NES.  The SNES/SFC makes all of this simple/easy for the programmer.<br /><br />Edit: fixed $2001 to be $2000 (PPUCTRL == $2000). This isn't a 2C05.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137190"></a>
				<b class="postauthor">Kasumi</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137190">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137190#p137190"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 4:58 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3504.gif" width="48" height="48" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Apr 02, 2008 2:09 pm<br /><b>Posts:</b> 798
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">See my edit + P.S. at the bottom of my previous post, re: no idea what the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.bank</tt> directive does and what the assembler thinks a bank size is.  Yes, if NESASM thinks it's 8KBytes, then that would make his code &quot;slightly&quot; more correct, except stuff was still in the wrong order (he went PRG (bank 0) + CHR (bank 1) + PRG (bank 2) which isn't correct).</div><br />Are you looking at the <a href="http://pastebin.com/Gn8Wiear" class="postlink">most recent version?</a> It's in the right order. It was fixed after Jeroen's post.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;.bank 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; PRG bank<br />&nbsp;.org $8000 <br />;Other junk stripped out<br />&nbsp;.bank 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; Vector bank<br />&nbsp;.org $FFFA<br />&nbsp;.dw NMI<br />&nbsp;.dw RESET<br />&nbsp;.dw 0<br />&nbsp;<br />&nbsp;.bank 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; CHR bank<br />&nbsp;.org $0000<br /></div><br /><br />Good to know it's not a mystery about $2000, also. <br /><br />Edit: AH! I get it now. I missed that BgUpdate0 reenables rendering, so BgUpdate1 was prone to do weird stuff even in the initialization step. The reason the fix worked is because it disabled rendering before the writes to $2006 in BgUpdate1 which made them safe. (Before they were written to while rendering was enabled which was not safe.)</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3504">Kasumi</a> on Mon Dec 01, 2014 5:13 pm, edited 3 times in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3504"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137192"></a>
				<b class="postauthor" style="color: #AA0000">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137192">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137192#p137192"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Dec 01, 2014 5:03 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Site Admin</td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 2391<br /><b>Location:</b> Mountain View, CA, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">No, I wasn't looking at the most recent version.  I was looking at the code linked in the initial post.  My bad.<br /><br />I'd still suggest getting rid of the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.dw 0</tt> for the IRQ vector, by the way -- that just points the IRQ vector to $0000, which is in zero page, and I'm 100% certain that is used.  Will an IRQ ever fire?  Who's to say -- remember that IRQ is used by the audio DMC/PCM channel, and opcodes like BRK could trigger it (likely to happen once indirect addressing comes into play and jumping around a lot).  Best set it to the address of an <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">rti</tt> instruction, such as the one at the very end of the NMI routine.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p137219"></a>
				<b class="postauthor">Tsutarja</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137219">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137219#p137219"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Dec 02, 2014 5:44 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=6724_1413199011.png" width="90" height="90" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Oct 12, 2014 11:06 am<br /><b>Posts:</b> 100<br /><b>Location:</b> Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay it works now. Next I need to figure out how to draw the status bar from the second nametable (I have a plan for that, but I'm not sure if it'll work).<br /><br />EDIT: Okay, my plan didn't work. I guess I need to use MMC3 mapper to get the vertical scrolling and status bar at the same time. I need to find tutorial for the usage of the mapper first though.</div>

					
						<div class="postbody"><br />_________________<br />UP SIDE DOWN A B A B B A B A Hidari migi<br />L R L R STOP &amp; DASH &amp; UP &amp; TALK Ijou nashi</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6724"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p137281"></a>
				<b class="postauthor">nIghtorius</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p137281">Re: Code stuck at $0000</a></div><div style="float: right;"><a href="./viewtopic.php?p=137281#p137281"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Dec 04, 2014 3:45 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Apr 29, 2014 1:31 pm<br /><b>Posts:</b> 39
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Tsutarja wrote:</div><div class="quotecontent">Okay it works now. Next I need to figure out how to draw the status bar from the second nametable (I have a plan for that, but I'm not sure if it'll work).<br /><br />EDIT: Okay, my plan didn't work. I guess I need to use MMC3 mapper to get the vertical scrolling and status bar at the same time. I need to find tutorial for the usage of the mapper first though.</div><br /><br />You do not need a MMC3 mapper to have vertical scrolling and status bar at the same time. It can be done using normal NROM mapping. You need to do the 2006/2005/2005/2006 PPU trick. I have done this myself by utilizing a sprite #0 hit at the last scanline aroundisch the 250th X position and then 2006/2005/2005/2006 scroll set technique.<br /><br />My Nametables are set as follows: VERTICAL scroll<br /><br />Nametable @ addr 0x2000 == gamescreen<br />Nametable @ addr 0x2400 == Statusbar thingy<br /><br />First I set the base nametable select register of the PPU ($2000) to render from basenametable #1 (where my statusbar resides), set sprite #0 to collide with the last bar of my statusbar.<br />in the NMI I update stuff and set base nametable to #1 (statusbar) then poll for the sprite #0 hit, after that I use the 2006/2005/2005/2006 trick to set base nametable #0 and set Y-scroll and Y-fine scroll.<br /><br />This enables me to splitscroll vertically <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />I'll include my not-finished game (port from an Konami MSX-game) as a .NES file to show it is possible <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />---- <br /><br />Disclaimer: it is unfinished code and mostly it is in a conceptional fase. As it is also my first NES game what I am trying to write. At least I use some kind of compression in the nametables <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /></div>

					
						<br clear="all" /><br />

						<table class="tablebg" width="100%" cellspacing="1">
						<tr>
							<td class="row3"><b class="genmed">Attachments: </b></td>
						</tr>
						
							<tr>
								<td class="row2">
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=2267">game.nes</a> [40.02 KiB]
			</span><br />
			<span class="gensmall">Downloaded 23 times</span>
		

		<br />
	</td>
							</tr>
						
						</table>
					

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6497"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=10&amp;t=12089"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=10"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=10&amp;t=12089"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 29 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <strong>1</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=10&amp;t=12089&amp;start=15">2</a> &nbsp;<a href="./viewtopic.php?f=10&amp;t=12089&amp;start=15">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=10">Newbie Help Center</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 4 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="12089" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10" selected="selected">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;Reproduction</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
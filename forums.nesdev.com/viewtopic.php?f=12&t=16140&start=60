<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - SPC700 instruction cycle breakdown</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - SPC700 instruction cycle breakdown" href="http://forums.nesdev.com/feed.php?f=12&amp;t=16140" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '5');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=16140';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Fri Aug 17, 2018 12:30 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />

	<div class="forumrules">
		
			<h3>Forum rules</h3><br />
			Related:<br /><ul><li>For making cartridges of your Super NES games, see <a href="http://forums.nesdev.com/viewforum.php?f=28" class="postlink">Reproduction</a>.</li></ul>
		
	</div>

	<br clear="all" />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=16140&amp;start=60">SPC700 instruction cycle breakdown</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=16140"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>5</strong> of <strong>6</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 86 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=16140&amp;start=45">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=16140">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=45">4</a><span class="page-sep">, </span><strong>5</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=75">6</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;start=75">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=16140&amp;start=60&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=16140&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=16140&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199423"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199423">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199423#p199423"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 30, 2017 11:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 406<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Is Revenant going to be up for writing all of those tests?</div><br />Hell no <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />Instead of compiling a different test ROM for every instruction, I wonder if it'd make more sense to just write some code to allow selecting one instruction at runtime, writing it into SMP RAM a good number of times (which would be better for this purpose than using a loop, if I understand the branch instructions' timing correctly) and then executing that and timing the results.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199428"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199428">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199428#p199428"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jul 01, 2017 6:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Although with enough loops we can compute the answer either way -- you could use JMP instead of BRA.<br /><br />A simple framework will work for most tests, but will not work for the stack manipuating ones. PUSH and POP may be okay if we let them overflow and wrap around the stack repeatedly.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199433"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199433">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199433#p199433"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jul 01, 2017 9:09 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><!-- m --><a class="postlink" href="https://github.com/awjackson/bsnes-classic/commit/04c29e527968ab471592297c243faf02d56f78fb">https://github.com/awjackson/bsnes-clas ... 02d56f78fb</a><!-- m --><br /><br />Note that none of the changes based on Overload's findings are in bsnes-classic yet--with this commit all &quot;idle&quot; cycles, including [pc+1] dummy operands, are treated as IO/ROM cycles (though we already know that's not quite correct, because two of the idle cycles in that mul/inc/bne loop are definitely RAM cycles).<br /><br />If I run the blargg timer speed tests in this branch, some of the numbers change by 1 one way or the other (but never more than 1) but all the tests still show &quot;passed&quot;. If I change the wait_states[] or timer_ticks[] lookup tables at all, the numbers change much more, and sometimes the tests even show &quot;failed&quot;.<br /><br /><div class="quotetitle">Revenant wrote:</div><div class="quotecontent">Instead of compiling a different test ROM for every instruction, I wonder if it'd make more sense to just write some code to allow selecting one instruction at runtime, writing it into SMP RAM a good number of times (which would be better for this purpose than using a loop, if I understand the branch instructions' timing correctly) and then executing that and timing the results.</div><br /><br />In order to get big enough numbers to minimize rounding error, we need to run each instruction a couple hundred times. There's no problem using loops if we verify the behaviour of the branch instructions first.<br /><br />The call instructions are no harder to verify than any other instruction, they just need a bit of setup ahead of time (i.e. plunking suitable vectors in high RAM)<br /><br />Still, the idea of an interactive test sounds good. Also, that way we can start with educated-guess emulation (e.g. my hypothesis that [pc+1] dummy operands are real reads and every other &quot;idle&quot; is an IO/ROM cycle) and zero in on the instructions that appear to diverge from that after emu-vs-hardware testing.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199436"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199436">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199436#p199436"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jul 01, 2017 10:22 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; <!-- m --><a class="postlink" href="https://github.com/awjackson/bsnes-classic/commit/04c29e527968ab471592297c243faf02d56f78fb">https://github.com/awjackson/bsnes-clas ... 02d56f78fb</a><!-- m --><br /><br />So according to your code ...<br /><br />If the current cycle wait state is 0, you get 3 ticks of the timer stage 0.<br />If it's 1, 6 ticks.<br />If it's 2, 12 ticks.<br />If it's 3, 24 ticks.<br /><br />So the real ratio is like:<br />24 clocks to 3 ticks.<br />48 clocks to 6 ticks.<br />120 clocks to 12 ticks.<br />240 clocks to 24 ticks.<br /><br />So it changes from a 1/8th ratio to a 1/10th ratio on the upper two. That's peculiar, but if it works, it works.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199437"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199437">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199437#p199437"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jul 01, 2017 10:32 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">&gt; <!-- m --><a class="postlink" href="https://github.com/awjackson/bsnes-classic/commit/04c29e527968ab471592297c243faf02d56f78fb">https://github.com/awjackson/bsnes-clas ... 02d56f78fb</a><!-- m --><br /><br />So according to your code ...<br /><br />If the current cycle wait state is 0, you get 3 ticks of the timer stage 0.<br />If it's 1, 6 ticks.<br />If it's 2, 12 ticks.<br />If it's 3, 24 ticks.<br /><br />So the real ratio is like:<br />24 clocks to 3 ticks.<br />48 clocks to 6 ticks.<br />120 clocks to 12 ticks.<br />240 clocks to 24 ticks.<br /><br />So it changes from a 1/8th ratio to a 1/10th ratio on the upper two. That's peculiar, but if it works, it works.</div><br /><br />I think speed values of 2 and 3 are <em>supposed</em> to be clock dividers of 4 and 8, but because of some interaction with the S-DSP (which actually generates the S-SMP's clock signal) they end up actually taking at least 5 or 10 cycles respectively, sometimes much longer (see Revenant's bizarre result with the mul ya test), and sometimes wedging the clock generator permanently.<br /><br />The timer_ticks[] values being multiples of 3 is a relic of the old timer_step formula. You can divide them all by 3, also divide the per-timer template arguments by 3 (so 64/64/8 instead of 192/192/24), and everything works out exactly the same:<br /><br /><!-- m --><a class="postlink" href="https://github.com/awjackson/bsnes-classic/commit/994b35cd30f0167c1e25ada6c7d51644d23c6dec">https://github.com/awjackson/bsnes-clas ... 44d23c6dec</a><!-- m --><br /><br />(tested with blargg's tests, Revenant's tests, and Tales of Phantasia's intro)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199449"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199449">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199449#p199449"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jul 01, 2017 1:28 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">&gt; I think speed values of 2 and 3 are supposed to be clock dividers of 4 and 8, but because of some interaction with the S-DSP (which actually generates the S-SMP's clock signal) they end up actually taking at least 5 or 10 cycles respectively, sometimes much longer (see Revenant's bizarre result with the mul ya test), and sometimes wedging the clock generator permanently.<br /><br />Interesting. And yeah, I don't really see us emulating the lock-ups. That's getting too pedantic even for me. Would rather put that effort into the CPU&lt;&gt;DMA crash on R1 CPUs that some homebrew actually hits by accident.<br /><br />&gt; The timer_ticks[] values being multiples of 3 is a relic of the old timer_step formula. You can divide them all by 3, also divide the per-timer template arguments by 3 (so 64/64/8 instead of 192/192/24), and everything works out exactly the same:<br /><br />True, that's a nice simplification. And not to nitpick, but at this point I'd suggest dropping timer_ticks and just use:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">unsigned ticks = 1 &lt;&lt; speed;</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199469"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199469">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199469#p199469"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jul 02, 2017 12:04 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 406<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Just for the sake of satisfying my own curiosity, <a href="http://i.imgur.com/9ygfreL.jpg" class="postlink">here</a> is a capture of smptesttest.sfc on BMF54123's SNS-101, in which CA/DA/EA/FA are actually usable. Meanwhile, his SNS-CPU-GPM-02 does the same thing as my SHVC-CPU-01, so I think my hunch about it being an issue with pre-1CHIP units might have been correct.<br /><br />If that's really the case, then doing something akin to smpidletest (where CA etc. makes the SMP run slowly but still eventually recover) could be a way for software to tell 1CHIP/mini consoles apart from previous revisions, if one ever wanted/needed to do that for some reason.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199488"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199488">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199488#p199488"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jul 02, 2017 11:47 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've just received a PM from Overload. He's done additional testing with a logic analyzer, updated <a href="http://www.crazysmart.net.au/kindred/files/spc700_inst_op.pdf" class="postlink">his document</a>, and confirmed a number of my intuitions:<br /><br />The second cycle of one-byte instructions (and one two-byte instruction) is indeed a kind of dummy operand fetch which uses the external clock divider (TEST bits 4-5) if executing from RAM. Other internal operation cycles always use the internal clock divider and don't trigger read side effects from internal SMP registers, regardless of the address they put on the external bus. The oddball is <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">dbnz y,rr</tt>, which has both a dummy operand fetch on cycle 2 and a real operand fetch on cycle 4. It's probably because that instruction shares microcode with the instructions that have a direct-page operand and a relative operand.<br /><br />blargg was right about <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">mov a,&#40;x&#41;+</tt>: the third cycle is the read and the fourth cycle is an internal operation. Whereas for <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">mov &#40;x&#41;+,a</tt> the third cycle is an internal operation and the fourth cycle is the write. If I were to guess why this addressing mode works differently from all the other register/memory addressing modes (e.g. <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">&#40;x&#41;</tt>), it's probably because the other modes share microcode with <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">adc</tt> et al, but the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">&#40;x&#41;+</tt> mode <em>only</em> exists for <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">mov</tt> so it's microcoded specially.<br /><br />TEST bits 4-7 are clock dividers of 2/4/8/16 applied to the clock coming from the S-DSP, which is already divided by 12 (so a final divider of 24/48/96/192). Dividers of 8 or 16 cause the S-DSP output clock to become &quot;not stable&quot; (seen from the software side by us as a 25% slowdown in the best case and a total loss of responsiveness in the worst case)<br /><br />Pin 16 (CPUK on the schematic) is the 2.048 MHz clock input from the S-DSP. Pin 15 is R/'W (low on writes, high on reads and internal operations, same as a 6502) Pin 14 is clock output (roughly equivalent to phi2 on a 6502, but its duty cycle is 25% low/75% high rather than 50%/50%) It looks to me like the SPC700 runs on a 4-phase clock internally like a 6809, rather than 2-phase like a 6502--maybe that's how it's able to do RMW ops without an idle cycle between the read and the write.<br /><br />For emulation purposes, the address on the bus during real internal operations (not dummy operand fetches) seems pretty much irrelevant.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199507"></a>
				<b class="postauthor">Revenant</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199507">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199507#p199507"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jul 02, 2017 4:21 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Apr 25, 2015 1:47 pm<br /><b>Posts:</b> 406<br /><b>Location:</b> FL
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">AWJ wrote:</div><div class="quotecontent">Dividers of 8 or 16 cause the S-DSP output clock to become &quot;not stable&quot; (seen from the software side by us as a 25% slowdown in the best case and a total loss of responsiveness in the worst case)</div><br /><br />That only applies to the internal divider (bits 6-7), right?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=6992"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199508"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199508">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199508#p199508"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sun Jul 02, 2017 4:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Revenant wrote:</div><div class="quotecontent"><div class="quotetitle">AWJ wrote:</div><div class="quotecontent">Dividers of 8 or 16 cause the S-DSP output clock to become &quot;not stable&quot; (seen from the software side by us as a 25% slowdown in the best case and a total loss of responsiveness in the worst case)</div><br /><br />That only applies to the internal divider (bits 6-7), right?</div><br /><br />An external divider setting of 2 or 3 seems less likely to lock up (at least with the mixtures of instructions and internal/external cycles we've been doing) but it still seems to cause a 25% slowdown on RAM cycles. Compare the results of all our tests with TEST=$FA to TEST=$0A. $FA makes all the tests take exactly 10 times as long as seen from the S-CPU.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199515"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199515">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199515#p199515"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 03, 2017 12:00 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Good news and bad news.<br /><br />The good news is that I've implemented all of Overload's new findings on IO cycles, plus I have the (x)+ case right for both reads and writes now.<br /><br />Further, I've implemented the SMP as running at DSP/12. For the CPU cycles, I consume {2,4,10,20} cycles to simulate the glitchy behavior where 8,16 are not evenly divisible by 12. Yet I still run the timers by {2,4,8,16}. As a result of this, I've reduced the timer stage 0 counters to {128, 128, 16}.<br /><br />Note that I could run the SMP at DSP/24 and use {1,2,5,10}, {1,2,4,8}, and {64,64,8}, but I figured I'd be more self-documenting and put a lot of notes about this behavior and its glitchiness into the smp/timing.cpp file.<br /><br />We now closely match every test by Revenant, and still pass test_speed by blargg.<br /><br />The bad news is that we fail test_timer_speed now on 1A (and most certainly on the others as well.) Since blargg doesn't print failed values, I traced the ROM and determined higan is getting 1561 for a timer value of 1A, whereas it wants ~1639 to pass. My suspicion is we have converted some cycles that really do read from RAM into idle cycles erroneously.<br /><br />It's possible that I made a mistake somewhere, but I was super cautious this time, and since all of Revenant's stuff passes ... I think we may still have more stuff to discover here.<br /><br />All the same, I'll link to the Git repo for the new code once it's been pushed.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199517"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199517">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199517#p199517"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 03, 2017 5:35 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Okay, relevant files are uploaded:<br /><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/processor/spc700/instructions.cpp">https://gitlab.com/higan/higan/blob/mas ... ctions.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/processor/spc700/instruction.cpp">https://gitlab.com/higan/higan/blob/mas ... uction.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/sfc/smp/timing.cpp">https://gitlab.com/higan/higan/blob/mas ... timing.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/sfc/smp/memory.cpp">https://gitlab.com/higan/higan/blob/mas ... memory.cpp</a><!-- m --><br /><br />AWJ, did you disassemble test_timer_speed as well already? Do you know what instructions it's executing during its timer tick counting loop?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199521"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199521">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199521#p199521"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 03, 2017 8:16 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Okay, relevant files are uploaded:<br /><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/processor/spc700/instructions.cpp">https://gitlab.com/higan/higan/blob/mas ... ctions.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/processor/spc700/instruction.cpp">https://gitlab.com/higan/higan/blob/mas ... uction.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/sfc/smp/timing.cpp">https://gitlab.com/higan/higan/blob/mas ... timing.cpp</a><!-- m --><br /><!-- m --><a class="postlink" href="https://gitlab.com/higan/higan/blob/master/higan/sfc/smp/memory.cpp">https://gitlab.com/higan/higan/blob/mas ... memory.cpp</a><!-- m --><br /><br />AWJ, did you disassemble test_timer_speed as well already? Do you know what instructions it's executing during its timer tick counting loop?</div><br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">auto SMP::wait(maybe&lt;uint16&gt; addr) -&gt; void {<br />&nbsp; static const uint cycleWaitStates&#91;4&#93; = {2, 4, 10, 20};<br />&nbsp; static const uint timerWaitStates&#91;4&#93; = {2, 4,&nbsp; 8, 16};<br /><br />&nbsp; uint waitStates = io.externalWaitStates;<br />&nbsp; if(!addr) waitStates = io.internalWaitStates;<br />//snip rest</div><br /><br /><s>Excessive C++ cleverness has bitten you in the back. This code is failing to distinguish between an argument of 0 and no argument, and turning accesses to address 0 &#40;which is RAM&#41; into internal accesses. I haven&#39;t bothered to disassemble the timer tests &#40;since they worked for me on the first try&#41; but I can tell from the debugger that they do use address 0.</s><br /><br />Also, you've changed the order things happen in read() and write(). Before you were doing the read/write and then advancing the timers, now you're advancing the timers and then doing the read/write. I don't think this is the cause of the failure or even that it's necessarily wrong, just pointing it out because you do have to pay close attention to these things (for the S-CPU in particular, it makes a big difference to many edge cases exactly what order things are done in CPU::read() and CPU::write())<br /><br />Aside, I don't think the glitchiness with dividers of 8 or 16 has anything to do with &quot;being divisible by 12&quot;. Dividing by n and then dividing by m is arithmetically equivalent to dividing by (m * n). Whether m is divisible by n or n is divisible by m is irrelevant. I think the S-DSP just isn't happy when the S-SMP's clock output is too slow. Remember that the S-DSP outputs a clock to the S-SMP and the S-SMP divides that clock and outputs it back to the S-DSP--it's a mutual interaction.<br /><br />ETA:<br /><br />Changing the subject, I just noticed that in higan you're initializing the S-DSP ENDX to random(0), which means that Magical Drop will never work if randomization is disabled. Surely it should be random(0xff) instead (that's what I've done in bsnes-classic).<br /><br />Here's my hypothesis for what is going on with the S-DSP initial state on real hardware. The initial state of each voice is completely random, which means that each voice <em>is playing</em> (from a random sample address and with random parameters) when the chip is powered on. If software doesn't touch any of the registers for a voice, eventually it will finish playing (it'll read a BRR header byte that has the END bit set and the LOOP bit clear) and set its corresponding bit in ENDX. There are two cases where this can fail to happen: if the random chunk of RAM that a voice is playing from happens to parse as a looping sample (and never gets overwritten by software to something that <em>doesn't</em> parse as a looping sample), or if the voice has a frequency of 0. Thus, by the time the IPL ROM passes control to an uploaded program, ENDX is usually 0xFF but occasionally one or two bits are clear, and those bits may or may not eventually get set depending on random chance and RAM contents.<br /><br />This would explain why Magical Drop occasionally fails on certain real consoles, but certainly doesn't fail 25% of the time.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3737">AWJ</a> on Tue Jul 04, 2017 9:26 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p199522"></a>
				<b class="postauthor">byuu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199522">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199522#p199522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 03, 2017 11:04 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Mar 27, 2006 5:23 pm<br /><b>Posts:</b> 1364
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Cydrak disassembled the test.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">8f4af0&nbsp; &nbsp; &nbsp; &nbsp; mov $f0, #$4a&nbsp; &nbsp;; set timings (modified per test)<br />8f81f1&nbsp; &nbsp; &nbsp; &nbsp; mov $f1, #$81&nbsp; &nbsp;; enable IPL, timer 0<br />8f00fa&nbsp; &nbsp; &nbsp; &nbsp; mov $fa, #$00&nbsp; &nbsp;; set timer 0<br />8f0100&nbsp; &nbsp; &nbsp; &nbsp; mov $00, #$01<br />8f0001&nbsp; &nbsp; &nbsp; &nbsp; mov $01, #$00&nbsp; &nbsp;; $0000 = 1<br />&nbsp; <br />e4fd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda $fd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; reset ticks<br />e800&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lda #$00<br />8d00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ldy #$00<br />f8fdf0fc&nbsp; &nbsp; &nbsp; -; ldx $fd; beq -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; wait on timer tick<br />7a00f8fdf0fa&nbsp; -; adw $00; ldx $fd; beq -&nbsp; ; count loops to next tick<br />&nbsp; <br />8f0af0&nbsp; &nbsp; &nbsp; &nbsp; mov $f0, #$0a&nbsp; &nbsp;; restore default timings<br />daf6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stw $f6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;; post loop results and sync S-CPU<br />8f55f4&nbsp; &nbsp; &nbsp; &nbsp; mov $f4, #$55<br />e8dd64f4d0fc&nbsp; lda #$dd; -; cmp $f4; bne -<br />&nbsp; <br />5fc0ff&nbsp; &nbsp; &nbsp; &nbsp; jmp $ffc0&nbsp; &nbsp; &nbsp; &nbsp;; return to IPL</div><br /><br />Here are the expected ranges.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; ; TEST&nbsp; loops<br />&nbsp; ;&nbsp; $0a&nbsp; &nbsp;$0a8f &lt;= X &lt; $0ac6<br />&nbsp; ;&nbsp; $1a&nbsp; &nbsp;$0656 &lt;= X &lt; $0677<br />&nbsp; ;&nbsp; $2a&nbsp; &nbsp;$0384 &lt;= X &lt; $0397<br />&nbsp; ;&nbsp; $3a&nbsp; &nbsp;$01dd &lt;= X &lt; $01e6<br />&nbsp; ;&nbsp; $4a&nbsp; &nbsp;$07eb &lt;= X &lt; $0814<br />&nbsp; ;&nbsp; $5a&nbsp; &nbsp;$0548 &lt;= X &lt; $0563<br />&nbsp; ;&nbsp; $6a&nbsp; &nbsp;$032a &lt;= X &lt; $033b<br />&nbsp; ;&nbsp; $7a&nbsp; &nbsp;$01c2 &lt;= X &lt; $01cb<br />&nbsp; ;&nbsp; $ca&nbsp; &nbsp;$032b &lt;= X &lt; $033c<br />&nbsp; ;&nbsp; $da&nbsp; &nbsp;$02a4 &lt;= X &lt; $02b1<br />&nbsp; ;&nbsp; $ea&nbsp; &nbsp;$01fa &lt;= X &lt; $0205<br />&nbsp; ;&nbsp; $fa&nbsp; &nbsp;$0151 &lt;= X &lt; $0158</div><br /><br />The problem turned out to be that I missed the (8) footnote on 6d. I probably missed the (9) footnote on 11 as well. It's a little tricky reading this PDF. Here is a crude fix:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">auto SPC700::instructionDirectReadWord(fpw op) -&gt; void {<br />&nbsp; uint8 address = fetch();<br />&nbsp; uint16 data = load(address + 0);<br />&nbsp; if(op == &amp;SPC700::algorithmLDW) load(address + 0);<br />&nbsp; else idle();<br />&nbsp; data |= load(address + 1) &lt;&lt; 8;<br />&nbsp; YA = alu(YA, data);<br />}</div><br /><br />(the other MOVW is in DirectWriteWord.)<br /><br />But anyway, all the tests pass now, hooray!<br /><br />&gt; Excessive C++ cleverness has bitten you in the back. This code is failing to distinguish between an argument of 0 and no argument, and turning accesses to address 0 (which is RAM) into internal accesses.<br /><br />Unfortunately, that's not correct.<br /><br />if(!addr) is testing the explicit operator bool() const of maybe&lt;uint16&gt;, which returns true if the maybe has a value in it, false if it's nothing. It won't see an address of zero until executing *addr to get the underlying value.<br /><br />&gt; Also, you've changed the order things happen in read() and write(). Before you were doing the read/write and then advancing the timers, now you're advancing the timers and then doing the read/write.<br /><br />Yeah, we had $2137/$4201 to confirm that difference on the CPU side. It probably exists on the SMP side too, but this new emulation code makes this very difficult. And I'm not even sure when the reads happen when the divider is not set to 0 (or effectively 2 cycles.)<br /><br />&gt; Remember that the S-DSP outputs a clock to the S-SMP and the S-SMP divides that clock and outputs it back to the S-DSP--it's a mutual interaction.<br /><br />Ah well. It's not like we're gonna be emulating the chance of crashing with this register anyway :/<br /><br />&gt; Changing the subject, I just noticed that in higan you're initializing the S-DSP ENDX to random(0), which means that Magical Drop will never work if randomization is disabled. Surely it should be random(0xff) instead (that's what I've done in bsnes-classic).<br /><br />There's no option to disable randomization currently. I'll keep that in mind though.<br /><br />It seems you know about the oddities with that title's game over screen. We can make a separate topic to work through that if you'd like. I'm very interested in what's going on there. But again, we'll need to confirm things before I'll make changes, and this one's probably not gonna have an &quot;easy mode&quot; like the SMP courtesy of Overload, heheh.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=375">byuu</a> on Mon Jul 03, 2017 11:23 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=375"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p199524"></a>
				<b class="postauthor">AWJ</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p199524">Re: SPC700 instruction cycle breakdown</a></div><div style="float: right;"><a href="./viewtopic.php?p=199524#p199524"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jul 03, 2017 11:22 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 10, 2008 3:09 pm<br /><b>Posts:</b> 433
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">byuu wrote:</div><div class="quotecontent">Unfortunately, that's not correct.<br /><br />if(!addr) is testing the explicit operator bool() const of maybe&lt;uint16&gt;, which returns true if the maybe has a value in it, false if it's nothing. It won't see an address of zero until executing *addr to get the underlying value.</div><br /><br />Are you absolutely sure about that? If I apply the following change in bsnes-classic so that address 0 is treated as internal:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">diff --git a/bsnes/snes/smp/memory/memory.cpp b/bsnes/snes/smp/memory/memory.cpp<br />index b577ca6..8fdd4cd 100644<br />--- a/bsnes/snes/smp/memory/memory.cpp<br />+++ b/bsnes/snes/smp/memory/memory.cpp<br />@@ -175,6 +175,7 @@ alwaysinline void SMP::op_buswrite(uint16 addr, uint8 data) {<br />&nbsp;}<br />&nbsp;<br />&nbsp;unsigned SMP::speed(uint16 addr) const {<br />+&nbsp; if(addr == 0) return status.clock_speed;<br />&nbsp; &nbsp;if((addr &amp; 0xfff0) == 0x00f0) return status.clock_speed;<br />&nbsp; &nbsp;if(addr &gt;= 0xffc0 &amp;&amp; status.iplrom_enabled) return status.clock_speed;<br />&nbsp; &nbsp;return status.ram_speed;</div><br /><br />then blargg's timer tests fail exactly the same way as they do for you.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3737"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=16140&amp;start=60"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=16140"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>5</strong> of <strong>6</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 86 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=16140&amp;start=45">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=16140">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=15">2</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=30">3</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=45">4</a><span class="page-sep">, </span><strong>5</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=16140&amp;start=75">6</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=16140&amp;start=75">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=23">Other Retro Dev</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="16140" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
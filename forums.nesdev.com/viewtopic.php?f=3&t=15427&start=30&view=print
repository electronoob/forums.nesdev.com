<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Resetting Micro Machines</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Resetting Micro Machines</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=15427">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=15427</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Thu Jan 26, 2017 6:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes! Nesdev rulz!! I'm learning a lot! And people here are polite.<br />I'm kind of disappointed with the Brazilian forums...<br />Unless there's some of them I had not come across, most are very superficial even for me that consider myself a rookie.<br /><br />But back on topic: <br />Were these tests somehow conclusive?<br />Should I try to capture some videos of the clones?<br />I think I should try to explain the audio bug more clearly...<br />I'll look this back tomorrow.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Thu Jan 26, 2017 8:49 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I can verify that it does hang on reset on my Famicom, using a PowerPak or Everdrive N8 with a 72-60 pin adapter. It also has some minor visual artifacts / jumpy screen due to the known problem with $2004. These problems do not occur on my NES, precisely as expected. (In case it wasn't made clear already: this game was not released in Japan.)<br /><br />I don't really see a necessity to seek out the original cart, though. All of the individual factors involved seem to be well understood. It's a very simple discrete mapper, and the effects involved aren't directly related to the mapper anyway.<br /><br />Is there some expectation that what we know doesn't precisely describe the behaviour of the real cart already?<br /><br />I mean, if someone has it on hand already, go ahead and test it if you like, but I don't think the potential for gained knowledge is very high.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Jan 26, 2017 9:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">I don't really see a necessity to seek out the original cart, though. [...] Is there some expectation that what we know doesn't precisely describe the behaviour of the real cart already?</div><br />The expectation is not among us as much as among <a href="https://en.wikipedia.org/wiki/Dunning%E2%80%93Kruger_effect" class="postlink">people who don't know what they don't know</a>. I wanted a way to make the misbehavior obvious enough for even the lowest common denominator who frequent YouTube: &quot;I plug <em>this</em> cartridge into <em>this</em> console, and <em>this</em> bug happens.&quot; By designing a demonstration that uses all original parts that one could reasonably have encountered prior to 1997, when emulation started to take off, we eliminate cause for comments to the effect &quot;You cheated; you used a flash cart and a Famicom.&quot; It's the same naivety that leads people to believe that use of the iNES container format in Virtual Console implies Nintendo copied games from infringing ROM sites.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Thu Jan 26, 2017 10:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hrm, I was expecting that link to go to Donald Rumsfeld's &quot;unknown unknowns&quot; quote, but regardless: IMO there's not even a hint of an unknown here to investigate at this point.<br /><br />I mean, if somebody really wants to own this game that's fine by me, but I'm just trying to suggest that we almost certainly have it nailed already. (If you feel like buying the game to prove that we have not, I'm not gonna stand in your way.)<br /><br /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">It's the same naivety that leads people to believe that use of the iNES container format in Virtual Console implies Nintendo copied games from infringing ROM sites.</div><br />But <em>you're</em> the one questioning the legitimacy of the emulated version in this case. O_o?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jan 27, 2017 7:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Right now I personally am satisfied. There is no pressing need to reproduce the test with all original parts. But if we <em>eventually</em> make a video demonstrating this bug <em>to the public,</em> I'd prefer it be done with original parts to avoid the appearance of impropriety.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Fri Jan 27, 2017 8:22 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Fine, fine... <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> So I can buy an used Famicom and that Micro Machines cartridge. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> It's always interesting stuff!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Great Hierophant</b> [ Sat Jan 28, 2017 9:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />We know that the glitchy graphics occur on a rev E or earlier PPU.  Early NES-001s used the rev E chips, so Micro Machines will show glitches on them.  On my AV Famicom, pressing reset at anything other than during the racing will cause a glitchy static image and a crash.  Sometimes pressing reset again will get out of the crash state, more often it won't.  However, pressing reset on while racing will reset to the Codemasters logo reliably.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zeroone</b> [ Mon Jan 30, 2017 8:06 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Do cartridges receive power up and reset signals?  In terms of emulation, should mappers reinitialize registers and other state information when the reset button is pressed?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Jan 30, 2017 8:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />AFAIK, these signals are not directly available, but it is possible to detect a reset by observing the behavior of other signals. Some mappers do initialize their registers to known values while others don't... I believe the wiki has this information, doesn't it?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Mon Jan 30, 2017 9:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />PowerPak and Everdrive N8 both rely on being able to detect reset.<br /><a href="https://wiki.nesdev.com/w/index.php/INES_Mapper_031" class="postlink">Mapper 31</a> requires power-on detection, but not reset.<br />There's a suggestion that some MMC5 games <a href="https://wiki.nesdev.com/w/index.php/MMC5#Hardware" class="postlink">have power-on expectations</a> but I don't know if that's a reliable feature of the mapper.<br /><br />There might be others, but the vast majority of mappers don't have any kind of power/reset initialization. Usually what I've found when I've tested them is random results (i.e. any state possible), but not evenly distributed.<br /><br />I believe reset detection is done based on the M2 clock signal, which halts while reset is held? I don't know how mapper 31 detects power-on though, infiniteneslives implemented it.<br /><br />Some info here: <!-- m --><a class="postlink" href="http://forums.nesdev.com/viewtopic.php?p=99137#p99137">http://forums.nesdev.com/viewtopic.php?p=99137#p99137</a><!-- m -->

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zeroone</b> [ Tue Jan 31, 2017 8:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">PowerPak and Everdrive N8 both rely on being able to detect reset.<br /><a href="https://wiki.nesdev.com/w/index.php/INES_Mapper_031" class="postlink">Mapper 31</a> requires power-on detection, but not reset.<br />There's a suggestion that some MMC5 games <a href="https://wiki.nesdev.com/w/index.php/MMC5#Hardware" class="postlink">have power-on expectations</a> but I don't know if that's a reliable feature of the mapper.<br /><br />There might be others, but the vast majority of mappers don't have any kind of power/reset initialization. Usually what I've found when I've tested them is random results (i.e. any state possible), but not evenly distributed.<br /><br />I believe reset detection is done based on the M2 clock signal, which halts while reset is held? I don't know how mapper 31 detects power-on though, infiniteneslives implemented it.<br /><br />Some info here: <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?p=99137#p99137">viewtopic.php?p=99137#p99137</a><!-- l --></div><br /><br />I noticed other games that fail on a soft reset.  For instance, Bao Xiao San Guo.7z &lt;Bao Xiao San Guo (Ch).nes&gt; from GoodNES3.23b crashes with the following error in Nintendulator when reset during the intro:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Invalid opcode $CF (DCP) encountered at $8523</div><br /><br />A hard reset works.  But, as you suggest above, that might not reflect real hardware behavior.<br /><br />Here are a few other ROMs with soft reset issues:<br /><br />Chong Wu Da Jia Zu Bu Luo Fen Zheng (Pet Family).7z<br />Cvetnye Linii (Color Lines).7z<br />Da Hang Hai VII.7z<br />Kou Dai Jing Ling - Fei Cui.7z<br />Mortal Kombat 3.7z<br />Shu Ma Bao Bei (Digimon Crystal).7z<br />Shui Hu Shen Shou (ES-1087).7z<br />Xi Chu Ba Wang.7z<br />Xiong Ba Tian Xia.7z<br /><br />And, none of these are failing for lack of resetting the PPU.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zeroone</b> [ Tue Jan 31, 2017 11:53 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Regarding the list of ROMs above, all of them appear to require a hard reset to properly start up, with one exception: Cvetnye Linii (Color Lines).  That Dendy ROM gets stuck in a loop on reset.  The reset address and the IRQ address are both $FF97.  Consequentially, in my emulator, it keeps bouncing between the following 2 instructions:  <br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;00:FF97:58&nbsp; &nbsp; &nbsp; &nbsp; CLI <br />&nbsp;00:FF98:A9 00&nbsp; &nbsp; &nbsp;LDA #$00</div><br /><br />According to <a href="https://wiki.nesdev.com/w/index.php/APU" class="postlink">the wiki</a>, the APU Status register ($4015) is set to 0 on reset.  This disables DMC interrupts.  But, what about Frame Counter interrupts?  Are they disabled on reset?  That is what is causing my emulator to get stuck above.<br /><br />Edit: That Dendy ROM enables Frame Counter interrupts via register $4017 and it never disables them.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Jan 31, 2017 12:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">zeroone wrote:</div><div class="quotecontent">According to <a href="https://wiki.nesdev.com/w/index.php/APU" class="postlink">the wiki</a>, the APU Status register ($4015) is set to 0 on reset.  This disables DMC interrupts.  But, what about Frame Counter interrupts?  Are they disabled on reset?  That is what is causing my emulator to get stuck above.</div><br /><br />This says $4017 is unchanged.<br /><!-- m --><a class="postlink" href="https://wiki.nesdev.com/w/index.php/CPU_power_up_state#After_reset">https://wiki.nesdev.com/w/index.php/CPU ... fter_reset</a><!-- m --><br /><br />It also says IRQ inhbit is set on reset, though, which should block it unless cleared by the software?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zeroone</b> [ Tue Jan 31, 2017 12:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">It also says IRQ inhbit is set on reset, though, which should block it unless cleared by the software?</div><br /><br />It resets to this address:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">00:FF97:58&nbsp; &nbsp; &nbsp; &nbsp; CLI </div><br /><br />Edit: Is it possible that the Dendy resets the APU?<br /><br />Edit 2: For the <a href="https://wiki.nesdev.com/w/index.php/CPU_power_up_state" class="postlink">CPU Power Up State wiki page</a>, was $4017 verified based on the behavior of the APU or did someone attempt to read from that register.  Aside from $4015, all the APU registers are write-only.<br /><br />Edit 3: No other emulator has issues resetting this Dendy ROM.  I assume this is some bug in my emulator, but I can't pinpoint the issue.  Any suggestions?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Feb 03, 2017 10:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Resetting Micro Machines</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I was just reading an old topic and apparently I DO own a copy of Micro Machines:<br /><br /><!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?p=11638#p11638">viewtopic.php?p=11638#p11638</a><!-- l --><br /><br />Now I wonder if the CIC circumvention hack could cause any damage whatsoever to an AV Famicom... I paid a lot of $$$ for mine (importing from Japan and paying 60% of price + shipping in taxes), so I'd really hate to screw it up.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>3</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
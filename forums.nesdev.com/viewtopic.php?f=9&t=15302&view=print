<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Pirate Kid Dracula reverse engineering</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Pirate Kid Dracula reverse engineering</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=9&amp;t=15302">http://forums.nesdev.com/viewtopic.php?f=9&amp;t=15302</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>5</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Mon Dec 26, 2016 11:44 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hi.<br />This is the thread I promissed on the Kid Dracula (Akumajō Special: Boku Dracula-kun) reverse engineering.<br />I'm posting the assembled card pictures first:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Kid Drac - Componentes</span><br />
		
			<a href="./download/file.php?id=7406&amp;mode=view"><img src="./download/file.php?id=7406&amp;t=1" alt="IMG-20161226-WA0006.jpg" /></a><br />
			<span class="gensmall">IMG-20161226-WA0006.jpg [ 136.51 KiB | Viewed 3240 times ]</span>
		

		<br />
	</div><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Kid Drac - Solda</span><br />
		
			<a href="./download/file.php?id=7407&amp;mode=view"><img src="./download/file.php?id=7407&amp;t=1" alt="IMG-20161226-WA0007.jpg" /></a><br />
			<span class="gensmall">IMG-20161226-WA0007.jpg [ 163.82 KiB | Viewed 3240 times ]</span>
		

		<br />
	</div><br /><br />I noticed some routing errors, there's possibly more:<br />1- Pins 6 and 7 of the 23c269 are swapped.<br />2- The CIC stun cicrcuit seems misrouted.<br />3- Pin 22 of the PRG? ROM is misrouted.<br /><br />Next I'll post the naked board scans.<br />Get ready for some PCB porn!!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Mon Dec 26, 2016 11:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />As promised, some PCB porn:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Kid Drac - Componentes</span><br />
		
			<a href="./download/file.php?id=7408&amp;mode=view"><img src="./download/file.php?id=7408&amp;t=1" alt="KidDrac - Componentes.png" /></a><br />
			<span class="gensmall">KidDrac - Componentes.png [ 1.66 MiB | Viewed 3239 times ]</span>
		

		<br />
	</div><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Kid Drac - Solda</span><br />
		
			<a href="./download/file.php?id=7409&amp;mode=view"><img src="./download/file.php?id=7409&amp;t=1" alt="KidDrac - Solda.png" /></a><br />
			<span class="gensmall">KidDrac - Solda.png [ 1.53 MiB | Viewed 3239 times ]</span>
		

		<br />
	</div><br /><br />Next I plan to dump the PRG and CHR ROMs plus the PAL chip.<br />Can someone please tell me wich pins are inputs and wich are outputs on the PAL?<br />I'm with 9 guests at home (5 are kids) that will stay this whole week and part of the other, so it's better to do these dumps in a single shot!!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Mon Dec 26, 2016 12:47 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />... This IRQ counts falling edges of PPU A13. Specifically, it counts 86 of them, or two scanlines.<br /><br />Of the six pins that could be inputs or outputs, they are either all outputs or connected to nothing. They are probably all outputs.<br /><br />Tracing completed.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Joe</b> [ Mon Dec 26, 2016 12:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Fisher wrote:</div><div class="quotecontent">I noticed some routing errors, there's possibly more:<br />1- Pibns 6 and 7 of the 23c269 are swapped.<br />2- The CIC stun cicrcuit seems misrouted.<br />3- Pin 22 of the PRG? ROM is misrouted.</div><br />This board is basically identical to the one zxbdragon took pictures of in <a href="https://forums.nesdev.com/viewtopic.php?p=185450#p185450" class="postlink">the other thread</a>, modified to work in a NES instead of a Famicom (and use mask ROMs instead of EPROMs).<br /><br />Pins 6 and 7 of the VRC2 clone are swapped because this board misroutes them. The NES swaps PPU A10 and A11 relative to the Famicom, and whoever modified this board for NES missed that key difference.<br /><br />Pin 22 of a 28-pin mask ROM is A16, but the equivalent pin on EPROMs is /OE. You can see where both PRG and CHR had the trace connecting that pin to GND hastily cut, but only the CHR was correctly rerouted. The PRG was connected back to GND! The hack job connects it to the correct location.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Mon Dec 26, 2016 1:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />PAL pinout appears to be<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .--V--.<br />&nbsp; &nbsp;/ROMSEL -&gt; |1&nbsp; 20| -- +5V<br />&nbsp; &nbsp; CPU A2 -&gt; |2&nbsp; 19| -&gt; CNT CLEAR<br />&nbsp; &nbsp; CPU A3 -&gt; |3&nbsp; 18| ?? nc<br />&nbsp; &nbsp;CPU A14 -&gt; |4&nbsp; 17| ?? nc<br />&nbsp; &nbsp; CPU D0 -&gt; |5&nbsp; 16| ?? nc<br />&nbsp; &nbsp; CPU D1 -&gt; |6&nbsp; 15| ?? nc<br />&nbsp; &nbsp; &nbsp; &nbsp;R/W -&gt; |7&nbsp; 14| -&gt; /IRQ<br />VRC2 NTA10 -&gt; |8&nbsp; 13| ?? nc<br />&nbsp; &nbsp; CNT=86 -&gt; |9&nbsp; 12| -&gt; CIRAM A10<br />&nbsp; &nbsp; &nbsp; &nbsp;Gnd -- |10 11| ?? nc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '-----'<br /></div><br />But why not just use resistors as I suggested in the other thread?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Mon Dec 26, 2016 3:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />thaks!Hope to be able to solve the MAPPER

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>krzysiobal</b> [ Mon Dec 26, 2016 4:31 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I rev-ed your PCB, thanks for providing a lots of fun!<br /><a href="http://obrazki.elektroda.pl/2013001800_1482795842.png" class="postlink"><img src="http://obrazki.elektroda.pl/2013001800_1482795842_thumb.jpg" alt="Image" /></a> <a href="http://obrazki.elektroda.pl/5724299000_1482795218.png" class="postlink"><img src="http://obrazki.elektroda.pl/5724299000_1482795218_thumb.jpg" alt="Image" /></a> <a href="http://obrazki.elektroda.pl/1999028800_1482795220.png" class="postlink"><img src="http://obrazki.elektroda.pl/1999028800_1482795220_thumb.jpg" alt="Image" /></a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Mon Dec 26, 2016 4:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well Lidnariq, I really want to do that circuit, but my house is a little overpopulated... <br />Let me explain:<br />My sister is visiting me with her husband, she has 3 kids, plus, my niece is here with her husband too, and she has 2 other kids.<br />This makes me a <a href="https://www.youtube.com/watch?v=hUbSpXgrI68" class="postlink">Uncle Grandpa!!</a><br />I really fear that some kid come near me while I'm working and get hurt by any of the tools I have on my workdesk.<br />So it was kind of &quot;Metal Gear&quot; stealth action to hide myself and try to do at least part of the job.<br />Hope Everything was done correctly. You know: &quot;haste makes waste&quot;!<br />They really liked me and I have past most of my free time playing with them and my own kids.<br /><br />Great job Krzysiobal!!<br />I just need to study and understand better these inner workings!! <br />I still consider myself a newbie in these stuff. Hope to change this soon! <img src="./images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br /><br />By the way, here is the PAL data I managed to dump:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> Kid Drac PAL IC</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=7416">PALKIDDR.BIN</a> [128 KiB]
			</span><br />
			<span class="gensmall">Downloaded 89 times</span>
		

		<br />
	</div><br />The pinout I used:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.--V--.<br />&nbsp; &nbsp; &nbsp;A0 -&gt; |1&nbsp; 20| -- +5<br />&nbsp; &nbsp; &nbsp;A1 -&gt; |2&nbsp; 19| -&gt; D5<br />&nbsp; &nbsp; &nbsp;A2 -&gt; |3&nbsp; 18| -&gt; D4<br />&nbsp; &nbsp; &nbsp;A3 -&gt; |4&nbsp; 17| -&gt; D3<br />&nbsp; &nbsp; &nbsp;A4 -&gt; |5&nbsp; 16| ?? A10<br />&nbsp; &nbsp; &nbsp;A5 -&gt; |6&nbsp; 15| -&gt; D2<br />&nbsp; &nbsp; &nbsp;A6 -&gt; |7&nbsp; 14| -&gt; D6<br />&nbsp; &nbsp; &nbsp;A7 -&gt; |8&nbsp; 13| -&gt; D1<br />&nbsp; &nbsp; &nbsp;A8 -&gt; |9&nbsp; 12| -&gt; D0<br />&nbsp; &nbsp; Gnd -- |10 11| &lt;- nc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'-----'<br /></div><br />It's the same circuit I used to get that Gradius 2's PAL data, I only changed pin 14 to D6.<br />Hope this helps clarify even more how the IRQ circuit works.<br /><br />If someone is interested, here is the ROMs dump, <s>I just don&#39;t know who is who</s>.<br />Edit: Discovered who is who by comparing the CRC32 with Bootgod's site.<br /><br />PRG ROM:<br /><strong>Edit: Removed to avoid future problems, as suggested.</strong><br />For reference: <br />NCN-18A.BIN CRC32 6a50b553<br />If someone needs it here's an IPS patch:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> PRG ROM patch</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=7427">NCN-18A.ips</a> [1.11 KiB]
			</span><br />
			<span class="gensmall">Downloaded 83 times</span>
		

		<br />
	</div><br />Apply it to the original PRG ROM, CRC32 93794634<br /><br />CHR ROM:<br /><strong>Edit: Removed to avoid future problems, as suggested.</strong><br />For reference: <br />NCN-18B.BIN CRC32 c5d1196e<br />The same CRC32 as the original.<br /><br /><s>If there&#39;s some problem posting this kind of stuff here, please, remove it.</s><br />Edit: Removed possibly copyrighted material, as suggested.<br /><br />Edit2: Fixed the NCN-18A.BIN, it was the same NCN-18B.BIN. Sorry...<br />Edit3: The CHR-ROM (NCN-18B.BIN) has the same CRC as the original.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Mon Dec 26, 2016 6:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Probably should delete the PRG and CHR dumps; unfortunately. <br /><br />This exact dump is already in GoodNES 3.14 as &quot;[p1][t1]&quot;<br /><br />(Interestingly, the PRG is also multiply present in multiple dumps, marked as &quot;[b2]&quot;, &quot;[p1][t1][b1]&quot;, and &quot;[p1][t1]&quot;, and the CHR is &quot;[!]&quot;, &quot;[p1][t1]&quot;, &quot;[t1]&quot;, and &quot;[t2]&quot;)<br /><br />Anyway, the PAL:<br />Pin 13 / D1 - does nothing at all, is always high.<br />Pin 15 / D2 - is low when writing to ((address &amp; 0xC00C) == 0xC004) <span style="font-size: 67%; line-height: normal">(edit, braino)</span><br />all other pins (12,17,18,19,14 = D0,3,4,5,6) are complicated, using feedback paths inside the PAL<br /><br />So ... the PAL probably latches D0, D1 sometimes, and may count some number of overflows from the interrupt handler also. (Uh-oh)<br /><br />Also, if you could re-dump with PAL pin 16 as an output that'd be nice.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Mon Dec 26, 2016 7:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Probably should delete the PRG and CHR dumps; unfortunately. <br /><br />This exact dump is already in GoodNES 3.14 as &quot;[p1][t1]&quot;<br /><br />(Interestingly, the PRG is also multiply present in multiple dumps, marked as &quot;[b2]&quot;, &quot;[p1][t1][b1]&quot;, and &quot;[p1][t1]&quot;, and the CHR is &quot;[!]&quot;, &quot;[p1][t1]&quot;, &quot;[t1]&quot;, and &quot;[t2]&quot;)<br /><br />Anyway, the PAL:<br />Pin 13 / D1 - does nothing at all, is always high.<br />Pin 15 / D2 - is low when writing to ((address &amp; 0xC00C) == 0xC008)<br />all other pins (12,17,18,19,14 = D0,3,4,5,6) are complicated, using feedback paths inside the PAL<br /><br />So ... the PAL probably latches D0, D1 sometimes, and may count some number of overflows from the interrupt handler also. (Uh-oh)<br /><br />Also, if you could re-dump with PAL pin 16 as an output that'd be nice.</div><br /><br />goodnes Sorting is imperfect.<br />[b] rom Many are GOOD DUMP,but is pirate.<br /><br />After the game Kid Dracula IRQ emu.next MMC5 Clone PCb?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Mon Dec 26, 2016 10:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />So, we know that the underlying VRC2 is VRC2b shaped. So all of the mapper accesses for CHR banking have to have been adjusted from the original game's VRC4e layout (0,4,8,C → 0,1,2,3).<br /><br />There are up to eight possible registers in the PAL. The mask is $C00C.<br />The ones at $8000 and $C000 are explicitly no-ops to minimize how intrusive the patch had to be.<br />The one at $9004 (i.e. $8004) is the new augmented mirroring control register (since register mirroring will fall through to the VRC2 underneath). Two of the unknown five outputs on the PAL must latch D0 and D1 to keep track of when the PAL is supposed to override the mirroring.<br /><br />There's one at $F004 (i.e. $C004); it doesn't pay attention to the data bus (the IRQ handler writes the contents of A as the very first thing). By context, this must restart the IRQ timer, keeping track of the number of times before it passes to the original IRQ handler.<br /><br />The patch also writes to $9008, $F008, and $F00C; it's less immediately obvious what these are doing. After the nametable controls, and the idle bit, there are only two possibly volatile bits remaining. One is probably whether the IRQ is enabled... another may be whether the IRQ is currently asserted.<br /><br />PAL pin 14 (dump D6) is 1 (IRQ not asserted) IF: /ROMSEL is 0 and CPUA2 is 1 and CPUA14 is 1 and R/W is 0. (i.e. $C004, $C00C)<br />— it's always 0 (IRQ asserted) IF: (pin 9) CNT=86, unless the immediate above line. More complicated behavior is hard to diagnose.<br /><br />PAL pin 12 (dump D0) should, sometimes, be one of: pin 8 (A7) , logic 1, logic 0, depending. Additionally, it should be correlated with some other bits.<br />— Due to the in-order way the PAL-as-ROM was dumped, we can only tell that it <em>does</em> care about $8004 and <em>does not</em> care about writes to $8000, but write to $8008 or $800C cannot be determined.<br /><br />PAL pin 17 and 18 (dump D3 and D4) appear to be the latched copy of CPUD1 and CPUD0 respectively in response to writes to the mirroring control register.<br /><br />PAL pin 19 (dump D5) is asserted (i.e. reset counters) if: CNT=86.<br />—Otherwise, writes to $C008 seem to deassert it, and writes to $C00C seem to assert it<br /><br /><br />I'm not entirely certain what the next useful test would be. Maybe shuffling some address lines so that the dumper tickles things in a different order. Or maybe writing a test that could be put on some 'PROM to tickle the six different registers. And it would be really nice to massage the /ROMSEL input so that the PAL's latches-made-of-feedback-paths weren't glitchy...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zxbdragon</b> [ Tue Dec 27, 2016 8:18 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Wait for Joe master

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Tue Dec 27, 2016 1:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />He may well think of something... but here's what I'm confident of:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Mask: $C00C<br />&nbsp; $8000: no effect<br />&nbsp; $8004: &#91;.... ..Mm&#93; - mirroring override<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;||<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|+--&nbsp; 0: 1-screen A mirroring, 1: 1-screen B mirroring<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+---&nbsp; 0: Mirroring from VRC2, 1: Mirroring from m bit<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;These two bits are stored in the PAL's outputs-<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; M on pin 17<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; m on pin 18<br />&nbsp; $8008: Functionality not knowable from available dump<br />&nbsp; $800C: Functionality not knowable from available dump<br />&nbsp; $C000: no effect<br />&nbsp; $C004: Acknowledge IRQ<br />&nbsp; $C008: ?start IRQ counter?<br />&nbsp; $C00C: Acknowledge and ?stop counter?<br /></div><br /><br />Separately:<br />pin 12: (per pinout) Nametable override<br />pin 13: Nothing<br />pin 14: (per pinout) /IRQ<br />pin 15: IRQ ack<br />pin 16: not measured yet<br />pin 17: nametable override<br />pin 18: nametable 1screen override setting<br />pin 19: (per pinout) 74'393 +CLEAR<br /><br />If one looks directly at the dump, each byte can be though of as a sequence of accesses to memory:<br />write &quot;00&quot; to $8000, idle, write to $8004, idle, write to $8008, idle … $800C $C000 $C004 $C008 $C00C, then the same for writing &quot;01&quot;, &quot;10&quot;, and &quot;11&quot;; then 64 cycles corresponding to reads from those same locations. Then 128 cycles while the nametable mirroring input is high instead of low.<br />Then 256 cycles while the 74'393 and 74'21 are indicating terminal count.<br /><br />This pattern is repeated 256 times throughout the dump, showing a significant amount of variation is some outputs, hopefully due to violated timing constraints.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Fisher</b> [ Tue Dec 27, 2016 2:57 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />New PAL dump:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<span class="gensmall"><b>File comment:</b> New PAL IC dump</span><br />
		
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=7426">NEWPALKD.BIN</a> [128 KiB]
			</span><br />
			<span class="gensmall">Downloaded 85 times</span>
		

		<br />
	</div><br />Pinout used:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.--V--.<br />&nbsp; &nbsp; &nbsp;A0 -&gt; |1&nbsp; 20| -- +5<br />&nbsp; &nbsp; &nbsp;A1 -&gt; |2&nbsp; 19| -&gt; D7<br />&nbsp; &nbsp; &nbsp;A2 -&gt; |3&nbsp; 18| -&gt; D6<br />&nbsp; &nbsp; &nbsp;A3 -&gt; |4&nbsp; 17| -&gt; D5<br />&nbsp; &nbsp; &nbsp;A4 -&gt; |5&nbsp; 16| ?? D4<br />&nbsp; &nbsp; &nbsp;A5 -&gt; |6&nbsp; 15| -&gt; D3<br />&nbsp; &nbsp; &nbsp;A6 -&gt; |7&nbsp; 14| -&gt; D2<br />&nbsp; &nbsp; &nbsp;A7 -&gt; |8&nbsp; 13| -&gt; D1<br />&nbsp; &nbsp; &nbsp;A8 -&gt; |9&nbsp; 12| -&gt; D0<br />&nbsp; &nbsp; Gnd -- |10 11| &lt;- nc<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'-----'<br /><br /></div><br /><br />I'm planning to do another dump later, using interleaved address lines (A0, A2, A4, A6, A8, A10, A12 and A14).<br />Would this be usefull?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Tue Dec 27, 2016 3:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Pirate Kid Dracula reverse engineering</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hm. I don't think skipping address lines would be helpful. I tentatively think reversing them should?<br /><br />That would change the virtual bus behavior to instead look like<br />Write '00' to $8000 while not terminal count and input nametable=0<br />Write '00' to $8000 while terminal count and input nametable=0<br />repeat above, but input nametable=1<br />repeat above, but reading from $8000 instead<br />repeat above, but data bus now holds '10', then '01', then '11'<br />repeat above, but to $C000, then $8008, then $C008, then $8004, then $C004, then $800C, then $C00C<br />finally 65536 samples while /ROMSEL is high, which if my mental model is right, ought to ignore every pin other than pin 9/A8/&quot;terminal count&quot;<br /><br />Because the 16L8 has six feedback loops, instead of registers, that means it has to be storing values in a multiplexer-like behavior, rather than caring about edges. So hopefully keeping things like this will help...

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>5</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - problem with tables all ceros</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">problem with tables all ceros</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1207">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=1207</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Fri Mar 10, 2006 12:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>problem with tables all ceros</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />EDIT: ok i try write in english. thank you for your time and over all to tokumaru for give a possible solution.
<br />in the post i said that the problem i have is that my emu write in the frame only color cero and only draw image grey, all the times.
<br />i have seen that the emu have ever only ceros in tables, name and atributte and palettes. The pattern tables seem loaded.
<br />
<br />p.d: i use a translator for the bocabulary...jaja (jaja is universal)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Fri Mar 10, 2006 2:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Er, no English.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Fri Mar 10, 2006 2:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The information you gave was very vague. If it only shows color 0 there could be a million of things going wrong. For all we know, the CPU core could be bad and the games don't even get the chance to write usefull information to the palettes, tables, etc.
<br />
<br />How well does your CPU core work?
<br />
<br />About the spanish... I don't know if the moderators will have anything against it, but if you can read english, wich means you know some, you should try and write in english anyway. There are users here that are not very good on the english. I, for example, make several mistakes, as my first language is portuguese. Lord Chile writes very strangelly, but people manage to understand him. You're likely to get more responses by writing in english, but that's my opinion.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Anes</b> [ Sat Mar 11, 2006 12:09 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">About the spanish... I don't know if the moderators will have anything against it, but if you can read english, wich means you know some, you should try and write in english anyway. There are users here that are not very good on the english. I, for example, make several mistakes, as my first language is portuguese. Lord Chile writes very strangelly, but people manage to understand him. You're likely to get more responses by writing in english, but that's my opinion.</div>
<br />
<br />Spanish version:
<br />Creo que lo que dice él esta bien, es un foro en inglés, yo también hablo español y mi ingles no es muy bueno, pero trato de darme a entender.
<br />Escribí en ingles y la gente seguro te va a entender. 
<br />Si no conocés mi acento es porque soy argentino.
<br />Saludos.
<br />
<br />Versión en ingles:
<br />I think what he says is pretty well, this is an english forum. I speak spanish too and my english is not to good, but i try to express my self the best i can.
<br />You should write in english and the people here sure will understand you.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Sat Mar 11, 2006 10:53 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />cisco, your english message is very understandable, so don't worry.
<br />
<br />But you didn't answer me... =)
<br />If it's all zeroed out, most likely the program (game) is not writing a thing to those memory locations. You must be sure your CPU core is working well. You should debug it somehow to follow the program flow, and see if the writes to the PPU are beeing executed at all. If they are, then it's a PPU bug, if not, it's a CPU bug.
<br />
<br />The fact that pattern tables are loaded does not mean much, as most of the time they come ready from the ROM image, unless the game uses CHR RAM, wich I don't think is the case here.
<br />
<br />You must be more specific... what game are you trying? The information you gave is still pretty vague.
<br />
<br />Well, you still have to put some step by step debugger, or log (easier), so you can follow the program flow and find out where/if things go wrong. Compare it to the program flow of a working emulator and maybe you'll see what yours is doing wrong.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Thu Mar 16, 2006 11:36 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />i don´t now what good is my cpu emulator
<br />
<br />i have used nestest.nes for testing the cpu, my emu starts the program, initial pc, in address 0xc004, where the memory have 0x78, this opcode is SEI or no?, but i have done the same test with another emu, how you said me, and he shows initial pc = 0xc004, same that mine, memory[0xc004]=0x78 that mine but he starts with instruccion BEQ !!! why??
<br />when nes starts after load the rom, what is the things to do??
<br />
<br />load rom
<br />interrupt_reset
<br />executing_cpu
<br />
<br />that is correct???

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Thu Mar 16, 2006 12:08 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes, $C004 is the correct place to start and $78 is SEI. This is to prevent IRQ's. After you have loaded a ROM, set the program counter to the reset vector (i.e. pc = memory[$FFFC] + memory[$FFFD] * $100). Since nestest.nes has only 1 page of PRG make sure that you load it at both $8000 and $C000. As for the other emulator's BEQ, that I can't explain.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Thu Mar 16, 2006 12:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />yes,two banks of prg are loaded with the same 16Kb. 
<br />
<br />any emu with good debugger???
<br />
<br />i put  the instructions that they are facts when load nestest
<br />
<br />1-SEI
<br />2-CLD
<br />3-LDX
<br />4-TSX
<br />5-LDA
<br />6-BPL
<br />7-opcode 0x02
<br />8-AND
<br />9-opcode 0xC7
<br />etc....
<br />
<br />any instructions after , cycling with BRK-RTI, all this without take any button.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Thu Mar 16, 2006 1:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">cisco wrote:</div><div class="quotecontent">6-BPL<br />7-opcode 0x02<br /></div>
<br />
<br />
<br />There's your problem.  You must not be handling branches correctly.  Just a bit into the program... the ROM has:
<br />
<br />AD 02 20 10 FB AD 02 20
<br />
<br />which is:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">LDA $2002 &#40;AD 02 20&#41;<br />BPL $FB&nbsp; &nbsp;&#40;10 FB&#41;<br />LDA $2002 &#40;AD 02 20&#41;<br /></div><br /><br />The branch, should jump back to that first LDA instruction.  You seem to be branching <em>FORWARD</em> $FB bytes... but branches are in fact signed... so with $FB you want to branch <em>backwards</em> 5 bytes ($FB = -5, not +251)<br /><br />In an emu, this is as easy as typecasting the byte to a signed char:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40;branch_condition_true&#41;<br />&#123;<br />&nbsp; PC += &#40;signed char&#41;operand;<br />&#125;<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Mar 16, 2006 1:38 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Disch wrote:</div><div class="quotecontent">You seem to be branching <em>FORWARD</em> $FB bytes... but branches are in fact signed... so with $FB you want to branch <em>backwards</em> 5 bytes ($FB = -5, not +251)<br /><br />In an emu, this is as easy as typecasting the byte to a signed char:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40;branch_condition_true&#41;<br />&#123;<br />&nbsp; PC += &#40;signed char&#41;operand;<br />&#125;<br /></div></div><br />And handle page crossing delay like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if&#40;branch_condition_true&#41;<br />&#123;<br />&nbsp; int oldPC = PC;<br /><br />&nbsp; /* eat one cycle to compute destination address */<br />&nbsp; CPU_Read&#40;PC&#41;;&nbsp; <br />&nbsp; PC += &#40;signed char&#41;operand;<br /><br />&nbsp; /* if the addition carried, eat another cycle */<br />&nbsp; if&#40;&#40;oldPC ^ PC&#41; &amp; 0xFF00&#41;<br />&nbsp; &#123;<br />&nbsp; &nbsp; CPU_Read&#40;&#40;PC &amp; 0x00FF&#41; | &#40;oldPC &amp; 0xFF00&#41;&#41;;<br />&nbsp; &#125;<br />&#125;<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Thu Mar 16, 2006 1:58 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />thanks, now ciclyng in bpl-lda.  But i continue without having nothing in the name/atributtes/palette tables, when write this dates the program in this tables?? i think that they do it with the code, i mean that they have been loaded with the code....mmmm i don´t know explain me..... should do somewhat the code in special for load this tables???
<br />
<br />
<br />disch, the mistake of the branch is for use java, that not have unsigned and i use int.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Thu Mar 16, 2006 2:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />LDA $2002
<br />BPL $FB
<br />
<br />is a common "wait for VBlank" loop.  If you do not have $2002 emulated in your emu, simply have $2002 return a value of $80 -- that should get the rest of the ROM running.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Fri Mar 17, 2006 8:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />1-any body can say me when write the nestest bytes in sprites/tiles              palettes?? or write bytes in name tables?
<br />
<br />
<br />2-this algoritm is correct for PAL ?????
<br />
<br />_make_reset
<br />_for 106,52 cpu cycles do
<br />___execute_instruction_cpu
<br />_end for
<br />_if scanline is 0
<br />___prerender scanline
<br />_else if scanline is betwen 1 and 240
<br />___render current scanline
<br />_else if scanline is 241
<br />___draw frame  ( using dummy scanline to do it )
<br />_else if scanline is 242
<br />___set bit 2002.7
<br />___if 2000.7 is one then
<br />_____make_nmi
<br />_____for 106,52 * 70 scanlines do
<br />_______execute_instruction_cpu
<br />_____end for
<br />___end if
<br />___clean_bits_2002.5/6/7
<br />_end if
<br />
<br />3-what happend when x=0 and make DEX??
<br />
<br />x=0
<br />DEX
<br />x=??  wrap?? maybe 255??

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>cisco</b> [ Mon Mar 20, 2006 10:25 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />anybody can answer to me???
<br />
<br />al least, say me if the algorithm may works

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mattmatteh</b> [ Mon Mar 20, 2006 12:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />your questions are very difficult to understand.  i suggest trying it and see what happens.  if you dont have a ppu or cpu then i would just work on the cpu and get that working.  you can out put that to a file and compare the output to this....
<br />
<br /><!-- m --><a class="postlink" href="http://nesdev.com/bbs/viewtopic.php?t=715&amp;highlight=nestest">http://nesdev.com/bbs/viewtopi ... ht=nestest</a><!-- m -->
<br />
<br />matt

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
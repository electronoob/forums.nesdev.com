<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - NES VGM player</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">NES VGM player</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=7794">http://forums.nesdev.com/viewtopic.php?f=22&amp;t=7794</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Thu May 26, 2011 12:29 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>NES VGM player</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This is my latest little project after doing the Gameboy VGM player.. an NES version: <a href="http://www.youtube.com/watch?v=Tcqk3zLj_qU" class="postlink">http://www.youtube.com/watch?v=Tcqk3zLj_qU</a>
<br />
<br />As mentioned in the video description I'm using VRC6, so this requires a PowerPak and a modded NES or a Famicom to work. Which is why channel 3 is missing in the video, because my NES isn't modded (yet). All 4 channels work fine in nintendulator and mednafen though.
<br />
<br />I still need to work a bit on the timing, and make the screen look less dull, etc.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu May 26, 2011 1:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />And perhaps you could add a compatibility mode for unmodded NES consoles that runs channel 3 over triangle.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri May 27, 2011 12:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />With no volume control? That would most likely sound like ****.
<br />And before you start saying that I could do some tricks to alter the volume of the triangle wave; keep in mind that I have to keep an average processing rate of 38 cycles/sample (or 41 for NTSC). <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" />
<br />
<br />One option I considered was to use the DMC channel to simulate a 3rd square wave channel. But to get all the frequency/volume combinations I would need thousands of samples, and I'm not sure if I could switch samples during playback without any noticeable distortion(?).
<br />
<br />VRC6 was just the most elegant solution IMO. Most people who develop for or make music for the NES probably has a PowerPak, meaning that they can run ROMs using VRC6. And the modification needed to get expansion audio on an NES is simple enough that I expect that even I can do it despite my crappy soldering skills.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Fri May 27, 2011 4:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Very cool.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri May 27, 2011 8:01 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Are you going to use the VRC6 saw channel for the SN76489 Noise+3rd Pulse waveform?
<br />
<br />Btw, If you're going to do the modification of your NES, do not use a 47K resistor.  Try to use a 100K potentiometer instead.  I made the mistake of using a 47K resistor and it's not enough; so the expansion audio is too loud.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri May 27, 2011 9:00 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Are you going to use the VRC6 saw channel for the SN76489 Noise+3rd Pulse waveform?</div><br />No, I'm using the first square wave channel of the VRC6. That's already supported by my player - you just can't hear it on my NES since I don't get expansion audio on it.<br />I guess I could use the other square wave channel for the SN76489 "periodic noise" since the VRC6 supports a 1/16 duty cycle.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Btw, If you're going to do the modification of your NES, do not use a 47K resistor. Try to use a 100K potentiometer instead. I made the mistake of using a 47K resistor and it's not enough; so the expansion audio is too loud.</div>
<br />I was thinking of using a 56k resistor. Or is that not enough?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri May 27, 2011 9:03 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I can see how volume manipulation would be easier on the VRC6 pulse, but not sure if it would sound simliar.
<br />
<br />Regarding the modification, using a potentiometer would allow you to adjust your values better instead of soldering something in there that isn't perfect.  You can also keep the potentiometer underneath your NES in the expansion bay hole so it's flush.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri May 27, 2011 9:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I can see how volume manipulation would be easier on the VRC6 pulse, but not sure if it would sound simliar.</div>
<br />
<br />It should sound the same. The periodic "noise" on the SN76489 is just a square wave with a 1/16 duty cycle (or 1/15 on the colecovision).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri May 27, 2011 2:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here are two demo ROMs, one for PAL and one for NTSC, containing different songs.
<br />
<br /><a href="http://jiggawatt.org/nesvgm_pal.nes" class="postlink">nesvgm_pal.nes</a>
<br /><a href="http://jiggawatt.org/nesvgm_ntsc.nes" class="postlink">nesvgm_ntsc.nes</a>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Fri May 27, 2011 6:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here are two basic hacks I've done:
<br />
<br /><a href="http://average.truechiptilldeath.com/nesdev/nesvgm_pal_greasemonkey_busride.zip" class="postlink">PAL</a>
<br /><a href="http://average.truechiptilldeath.com/nesdev/nesvgm_ntsc_kulor_snofer.zip" class="postlink">NTSC</a>
<br />
<br />The PAL ROM has a song by GreaseMonkey done with his IT2VGM driver.
<br />The NTSC ROM has a song by kulor using the MOD2PSG2 engine.
<br />
<br />I've included their unaltered VGMs as well.
<br />
<br />It appears that they cut out early.  GreaseMonkey's noise pulses are also not in tune.  There appears to be noise issues for both of the songs as well.  Among other issues.
<br />
<br />Hope this helps with the bug testing.
<br />
<br />I would include a version of my songs, but some of my VGMs are over 200K.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Fri May 27, 2011 9:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">It appears that they cut out early.</div>
<br />That's because my player doesn't look at any addresses to determine when to switch to the next bank. I relies on my ROM builder tool to insert VGM command $4B (no parameters) at the end of each 16kB. Command $4B doesn't mean anything in the VGM 1.50 spec, but to my player it means "switch in the next 16kB bank".
<br />
<br />Thanks for the songs. They might be of some help.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Sat May 28, 2011 1:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I managed to fix most of the noise problems: <a href="http://jiggawatt.org/kulor_ntsc.nes" class="postlink">kulor_ntsc.nes</a>
<br />It's not possible to get it to sound 100% right, since the 2A03 only has 16 different frequency settings for white noise, while on the SN76489 you can get 1024 by sacrificing the 3rd tone channel.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat May 28, 2011 6:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent">It's not possible to get it to sound 100% right, since the 2A03 only has 16 different frequency settings for white noise, while on the SN76489 you can get 1024 by sacrificing the 3rd tone channel.</div>
<br />Can you alternate between adjacent frequency settings if the period is close to halfway between two existing settings?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>B00daW</b> [ Sat May 28, 2011 7:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent">I managed to fix most of the noise problems: <a href="http://jiggawatt.org/kulor_ntsc.nes" class="postlink">kulor_ntsc.nes</a><br />It's not possible to get it to sound 100% right, since the 2A03 only has 16 different frequency settings for white noise, while on the SN76489 you can get 1024 by sacrificing the 3rd tone channel.</div>
<br />
<br />Sounding a lot better, except that it seems your non-pitch-referenced periodic noises come out as 2A03 periodic noise instead of octaves of A or 440Hz.  A lot of musicians use it as a cheap A too.
<br />
<br />As for pitch-driven white noise, I think the only effective option for that is changing the chip to Sunsoft 5B's AY.  Too bad it's not properly emulated anywhere yet; especially noise.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Sun May 29, 2011 8:14 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I got some help with installing a 100kohm potentiometer, so now I've been able to do proper testing on HW.
<br />
<br />It's getting closer to being ready for a proper release. The timing is pretty decent now, and I've added NTSC/PAL detection and automatic adjustment of playback speed (though since I only have PAL HW all my NTSC testing has been with Nintendulator).
<br />
<br />There's one weird issue left that only happens on HW. Some songs "lock up" at certain positions in the song, and then recover after a short time. My first theory was that it was related to the bank switching, but I can't see why that would be the case, or why only the switch between two specific banks would be a problem. This doesn't happen in Nintendulator or FCEUX, so it's kinda hard to debug.
<br />
<br /><a href="http://www.youtube.com/watch?v=uAtHm0lxczs" class="postlink">Youtube video</a> for the current version.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
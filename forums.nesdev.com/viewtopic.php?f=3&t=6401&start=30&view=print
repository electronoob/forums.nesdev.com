<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - young indiana jones new ppu discovery, nestopia help...</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">young indiana jones new ppu discovery, nestopia help...</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=6401">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=6401</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>3</strong> of <strong>14</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Thu Jun 10, 2010 2:45 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />- Sorry, but if I'm not making any confusion, reading/writing $2005/6/7 is not allowed during rendering, an old info.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Thu Jun 10, 2010 3:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Right, but now he's documented the specifics of what happens when you read from $2007 during rendering -- and, better &amp; worse, found a game that uses this 'prohibited' behavior.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>jwdonal</b> [ Thu Jun 10, 2010 3:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Right, but now he's documented the specifics of what happens when you read from $2007 during rendering -- and, better &amp; worse, found a game that uses this 'prohibited' behavior.</div>
<br />Exactly.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Thu Jun 10, 2010 4:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />*Amen* <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Thu Jun 10, 2010 4:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />sorry if this a stupid or newb question as obviously i dont have any idea on ppu inner workings but besides the relevant code in this thread is there any way to try this out with like an ips patch or let's say a hex edit of the rom?
<br />
<br />just curious and if this comes off as a stupid question i do apologize...
<br />
<br />once again excellent work! looks like theres always something new with the nes eh? lol

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Thu Jun 10, 2010 5:12 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well the change presented in this thread is one that would need to be applied to <em>emulators</em>, not to the ROM.  So no, there's no way to put it in an IPS patch.
<br />
<br />You could probably hack the ROM another way to remove the glitch, but that would be a completely different task.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Thu Jun 10, 2010 6:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />You know this behavior seems like it'd be relatively easy to test and confirm with a dev cart / Powerpak.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">; assume rendering is disabled<br />LDA&nbsp; #&gt;SomeAddress<br />STA $2006<br />LDA #&lt;SomeAddress<br />STA $2006<br /><br />LDA #$18<br />LDX #$00<br /><br />STA $2001 ; enable &#40;should probably be timed, see below&#41;<br />BIT $2007 ; read<br />STX $2001 ; disable<br /><br />; confirm how PPU address changed from SomeAddress here<br /></div>
<br />
<br />You should probably time this so the write happens between dots 260-320 (when the PPU is unlikely to change the PPU address on its own).
<br />
<br />This wouldn't cover possible edge cases when the $2007 read happens at the same time that the PPU is adjusting the address for rendering, but it could at least confirm the basic idea is right.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Jun 10, 2010 7:40 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It is the 2010s and there is time for <a href="http://pics.pineight.com/nes/boing2k7.zip" class="postlink">Boing 2007</a>. Put this on a PowerPak, put the PowerPak in an NTSC NES, and follow the bouncing ball. As they used to say on alt.aol-sucks: "Your will be amasing."

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Jun 11, 2010 2:46 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Now the question is "what happens when there is a warp arround" ? Is the circuitry that detects the end of name-table (and warp it to the top/left of the next nametable) is still active when it comes to $2007 reads during rendering ?
<br />
<br />When a column is skipped, does the horizontal scroll become back to normal value next line ? (I'm pretty sure so, else Zelda would be f** up when scrolling vertically)
<br />
<br />And last, but not least : Is there a way to predict WHAT the $2007 read will return ? A new way of synchronization maybe ?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Jun 11, 2010 5:14 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I wrote a test that runs what Disch suggested and added the output to the Wiki for group analysis: <a href="http://wiki.nesdev.com/w/index.php/Reading_2007_during_rendering" class="postlink">Reading 2007 during rendering</a>
<br />
<br />It sets the VRAM address to 141F before the code, since that seemed to reveal the most operation. If I set it to 0000 for example, you wouldn't see bit 10 getting toggled. the 1F allows that to happen. And the 0400 allows you to see it toggle 1000 sometimes, etc. I'm not up to speed on all the PPU details, so I was mostly just trying values and choosing this one as the most useful.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Jun 11, 2010 5:40 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, I saw it clock both the H and V positions at some points on the scanline when I was testing boing $2007.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 11, 2010 7:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">And the 0400 allows you to see it toggle 1000 sometimes</div>
<br />Can you explain this?  I'm assuming that, in your test, 2000.2 is set (i.e. address increment = 32).  In that case, any read of $2007 would clock FV (bits 12-13), toggling 0x1000, no?
<br />
<br />Do you think the +1 increment relative to dummy, in most of the reads, is simply a timing difference?
<br />
<br />BTW, YIJC doesn't actually do anything with the $2007 read:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">$FB66:8D 00 20&nbsp; STA $2000<br />$FB69:AD 02 20&nbsp; LDA $2002<br />$FB6C:A5 A7&nbsp; &nbsp; &nbsp;LDA $00A7<br />$FB6E:8D 05 20&nbsp; STA $2005<br />$FB71:A9 00&nbsp; &nbsp; &nbsp;LDA #$00<br />$FB73:8D 05 20&nbsp; STA $2005<br />$FB76:A5 A9&nbsp; &nbsp; &nbsp;LDA $00A9<br />$FB78:8D 06 20&nbsp; STA $2006<br />$FB7B:A5 AA&nbsp; &nbsp; &nbsp;LDA $00AA<br />$FB7D:8D 06 20&nbsp; STA $2006<br />$FB80:A5 A8&nbsp; &nbsp; &nbsp;LDA $00A8<br />$FB82:29 04&nbsp; &nbsp; &nbsp;AND #$04<br />$FB84:F0 0C&nbsp; &nbsp; &nbsp;BEQ $FB92<br />$FB86:AD 07 20&nbsp; LDA $2007<br />$FB89:AD 07 20&nbsp; LDA $2007<br />$FB8C:AD 07 20&nbsp; LDA $2007<br />$FB8F:AD 07 20&nbsp; LDA $2007<br />$FB92:AC 9F 04&nbsp; LDY $049F<br />$FB95:A9 00&nbsp; &nbsp; &nbsp;LDA #$00<br /></div>
<br />Looks like it's there to simply increment VT by one based on the value of $00A8.  Why this couldn't be done before writing to $2005/$2006 is unclear to me.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri Jun 11, 2010 7:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sounds like they did the monkeys and typewriters approach - Keep trying something until it works.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 11, 2010 8:19 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I may be off in my analysis...  FV is a 3-bit counter, so clocking it 4 times won't necessarily cause a carry into the VT counter.
<br />
<br />Maybe they're doing this so that can draw data from 2 halves of different tiles?
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tile 1:&nbsp; &nbsp;tile 2:&nbsp; &nbsp;new tile:<br />aaaaaaaa&nbsp; xxxxxxxx&nbsp; aaaaaaaa<br />aaaaaaaa&nbsp; xxxxxxxx&nbsp; aaaaaaaa<br />aaaaaaaa&nbsp; xxxxxxxx&nbsp; aaaaaaaa<br />aaaaaaaa&nbsp; xxxxxxxx&nbsp; aaaaaaaa<br />bbbbbbbb&nbsp; yyyyyyyy&nbsp; xxxxxxxx<br />bbbbbbbb&nbsp; yyyyyyyy&nbsp; xxxxxxxx<br />bbbbbbbb&nbsp; yyyyyyyy&nbsp; xxxxxxxx<br />bbbbbbbb&nbsp; yyyyyyyy&nbsp; xxxxxxxx<br /></div>
<br />
<br />?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>James</b> [ Fri Jun 11, 2010 9:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">It is the 2010s and there is time for <a href="http://pics.pineight.com/nes/boing2k7.zip" class="postlink">Boing 2007</a>.</div>
<br />Very cool!

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>3</strong> of <strong>14</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
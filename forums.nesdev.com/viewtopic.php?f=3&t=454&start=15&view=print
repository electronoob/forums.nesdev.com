<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - New APU frame &amp; length counter info and test ROMs</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">New APU frame &amp; length counter info and test ROMs</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=454">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=454</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Mon Sep 05, 2005 2:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I don't like the "look-at-my-sources" policy, but anyways... ^_^</div><br /><br />I'll say it now: I get quite ticked off by many of your posts. Maybe I simply misunderstand them.<br /><br />I posted the source because trying to explain things wasn't getting anywhere. Source code doesn't lie; it delivers the goods, so I thought that it might help. I wrote it specifically to pass the APU tests, nothing more, so it is very relevant and has very little extraneous material as general source code from an emulator would have.<br /><br /><div class="quotetitle">Fx3 wrote:</div><div class="quotecontent"><div class="quotetitle">blargg wrote:</div><div class="quotecontent">Hopefully it'll help dispel the idea that you can run each step every 7457.5 clocks.</div><br /><br />This looks like an APU hack...?<br /></div>
<br />
<br />At this point I don't have any more ideas of how to help with this. I am completely failing at English communication here. Maybe I've been misunderstanding all along, but I don't know how to resolve that. Oh well... sorry for the heat. :)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Mon Sep 05, 2005 3:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm not flaming you... ^_^;; and it's not a communication problem. Your docs/sources/findings/whaever are much appreciated. Personally, I was trying to be accurate with my emulator - please, accept my apologies if I flamed you in anyways... -_-;;
<br />
<br />Next, with no timing tricks, I could get tests 1-4, 10 and almost 11 (fails at #5). 
<br />
<br />About the sources, it's a nice resource, no doubt... but it was a "!" in the past, about "looking-and-ripping" practice. It's silly - that's why I wrote that. 
<br />
<br />Again, thanks for your efforts. I'm in hope to get my APU working fine.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Nessie</b> [ Tue Sep 06, 2005 9:48 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">I'll say it now: I get quite ticked off by many of your posts. Maybe I simply misunderstand them.</div>
<br />I thought I was the only one so I didn't say anything    lol

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Tue Sep 06, 2005 2:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah well, I got to vent so I'm back in the ring. :)
<br />
<br />One reason I posted the working code is so that you could run it outside an emulator, just in a simple C++ shell that calls it and prints the result. That way you could do the same with your APU and compare the result. Or at least probe the example code to find out what it does in each case.
<br />
<br />And like I said, this doesn't even cover the full complexity of the frame counter. I might give up on fully reverse-engineering it and stick to a subset of operation that doesn't include these crazy edge-cases.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Thu Sep 08, 2005 11:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'd like to say that <strong>I got all the eleven tests working!</strong> <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /> There's a few things... I'm writting a doc that covers some of my findings. I'm not using any timing tricks (like counters) or any hacking tricks.
<br />
<br />However, there's an interesting issue, much like test #11, error #5 (of length counter [ATL] reload): if the ATL expires at exact cycle of reading 4015h, then its state is not affected (4015h still returns 1). This is a 'grain of salt' - I'm sure my CPU core is accurate, I could trace everything thanks to a good LOG. 
<br />
<br />I have to admit it was MY fault... I was not trying hardly enough to get the APU working fine... -_-;; It was a nice exercise, blargg. All my day was tracing my APU core. That's it!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Sat Oct 08, 2005 6:50 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I realize I'm bumping an old thread... but I just got around to redesigning my APU for this and am had some questions... specifically there appears to be a contradiction in the attached readmes:
<br />
<br />quote from the test #8 description (and from a section in the 'misc' area of the readme):
<br />
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">IRQ handler is invoked at minimum <em><strong>29833</strong></em> clocks after writing $00 to<br />$4017.</div><br /><br />quote from the readme:<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">0     (write occurs here)<br />1<br />2<br />3<br />...<br />      Step 1<br />7459  Clock linear<br />...<br />      Step 2<br />14915 Clock linear &amp; length<br />...<br />      Step 3<br />22373 Clock linear<br />...<br />      Step 4<br /><em><strong>29830</strong></em> Set frame irq<br /></div>
<br />
<br />so which is it?  29833?  or 29830?  I skimmed the replies in this thread but didn't find any further clarification on it.
<br />
<br />Is there some delay or something between when the frame IRQ flag is raised and when the IRQ actually happens?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sat Oct 08, 2005 8:51 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Disch, I started a new thread titled <a href="http://nesdev.com/bbs/viewtopic.php?p=5289" class="postlink">APU Frame IRQ Flag and IRQ Timing</a>, to make more room for long code sequences.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
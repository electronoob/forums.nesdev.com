<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=9254" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2012-08-30T08:22:54-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=9254</id>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2012-08-30T08:22:54-07:00</updated>
<published>2012-08-30T08:22:54-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98820#p98820</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98820#p98820"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98820#p98820"><![CDATA[
<a href="http://www.youtube.com/watch?v=jZoYUQSU38E" class="postlink">http://www.youtube.com/watch?v=jZoYUQSU38E</a><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Thu Aug 30, 2012 8:22 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2012-08-30T06:31:35-07:00</updated>
<published>2012-08-30T06:31:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98818#p98818</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98818#p98818"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98818#p98818"><![CDATA[
note to self: stay out of England <img src="http://forums.nesdev.com/images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Thu Aug 30, 2012 6:31 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2012-08-29T09:56:38-07:00</updated>
<published>2012-08-29T09:56:38-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98776#p98776</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98776#p98776"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98776#p98776"><![CDATA[
<div class="quotetitle">James wrote:</div><div class="quotecontent"><br /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Sleep(1) through to Sleep(10) causes the program to sleep for 10ms<br /></div><br />You can get 1ms resolution by calling <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd757624%28v=vs.85%29.aspx" class="postlink">timeBeginPeriod</a>.</div><br /><br />James if I ever see you in the street, I'm gonna make sweet love to you. <img src="http://forums.nesdev.com/images/smilies/icon_cool.gif" alt="8)" title="Cool" /><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Wed Aug 29, 2012 9:56 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[James]]></name></author>
<updated>2012-08-29T05:14:52-07:00</updated>
<published>2012-08-29T05:14:52-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98773#p98773</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98773#p98773"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98773#p98773"><![CDATA[
<div class="quotetitle">WedNESday wrote:</div><div class="quotecontent"><br />Sleep(1) through to Sleep(10) causes the program to sleep for 10ms<br /></div><br />You can get 1ms resolution by calling <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd757624%28v=vs.85%29.aspx" class="postlink">timeBeginPeriod</a>.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=88">James</a> — Wed Aug 29, 2012 5:14 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dwedit]]></name></author>
<updated>2012-08-28T14:06:15-07:00</updated>
<published>2012-08-28T14:06:15-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98753#p98753</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98753#p98753"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98753#p98753"><![CDATA[
I'm not having any problems, I'm just saying that the author of a blog post had problems.<br /><br />But I was tracking down how XNA worked, as well as reading his post about how he was having problems.  I could clearly see how XNA was resolving them.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=53">Dwedit</a> — Tue Aug 28, 2012 2:06 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2012-08-28T13:52:03-07:00</updated>
<published>2012-08-28T13:52:03-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98752#p98752</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98752#p98752"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98752#p98752"><![CDATA[
QueryPerformanceFrequency gets you a value that lets you convert QueryPerformanceCounter values to seconds.<br /><br />Dwedit, if you have a problem with input not getting through, there are many solutions, and they don't necessarily need to be part of your video or audio synchronization solution, though they can be related to it if you want. If you're comfortable with multithreading, you should take advantage of it (though proper multithreading is a whole area of its own). For example, if you're about to load from disk and basically hang the game for a few seconds, instead of just doing it in your regular loop you can put your main thread into a loop that updates necessary things like the message pump, and spin off all the loading stuff in its own thread.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Tue Aug 28, 2012 1:52 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2012-08-28T13:01:20-07:00</updated>
<published>2012-08-28T13:01:20-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98745#p98745</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98745#p98745"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98745#p98745"><![CDATA[
<div class="codetitle"><b>Code:</b></div><div class="codecontent">onepercent = cpuspeed / 100;<br />frame = cpuspeed / 60;<br />runframe();<br />frame -= frametime;<br />if (frame &gt; onepercent)<br />    Sleep(10);<br /></div><br />This is what I am trying to achieve. This way I believe that my CPU can be put to sleep for at least 60% of its life to save energy.<br /><br />I've been calling QueryPerformanceFrequency to get my CPU speed in Hz but apparantly what it actually returns is something else?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Tue Aug 28, 2012 1:01 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dwedit]]></name></author>
<updated>2012-08-27T10:49:35-07:00</updated>
<published>2012-08-27T10:49:35-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98695#p98695</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98695#p98695"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98695#p98695"><![CDATA[
So, since XNA is calling Present(), that's the one to use for vblank waiting then.<br />Then I started doing web searches about present().  I was reading a blog post on virtualdub.org, where the author talks about input events (keyboard and mouse) being horribly delayed by 5 seconds.  XNA only calls Present() in an Application.Idle event handler, so this is after the windows message queue is empty, and it avoids that problem.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=53">Dwedit</a> — Mon Aug 27, 2012 10:49 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2012-08-27T10:28:55-07:00</updated>
<published>2012-08-27T10:28:55-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98693#p98693</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98693#p98693"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98693#p98693"><![CDATA[
The default behaviour in Direct3D is to sleep your thread until vsynch when you call Present. This is customizable; you probably want to use D3DPRESENT_INTERVAL_ONE.<br /><br />See: <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb174313%28v=vs.85%29.aspx" class="postlink">CreateDevice</a>, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb172585%28v=vs.85%29.aspx" class="postlink">D3DPRESENT</a>, and <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb205908%28v=vs.85%29.aspx" class="postlink">Present</a>.<br /><br />This works in windowed mode as well. Note that in windowed mode, it won't prevent screen tearing, as the vsync isn't actually observed for flipping the screen, but it will still wait on Present. (Note also the timing will be a little bit variable; on average it will be called at the specified rate, but individual frames may run short or long.)<br /><br />Note that the actual rate it locks to is not guaranteed. You can query the framerate you're actually going to get, I believe. Most systems will support 60hz, but you may want to tweak things if you don't get it.<br /><br />I forget if there's an equivalent way to do this in OpenGL, but there likely is.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Mon Aug 27, 2012 10:28 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2012-08-27T10:14:22-07:00</updated>
<published>2012-08-27T10:14:22-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98691#p98691</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98691#p98691"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98691#p98691"><![CDATA[
If you want to give up some CPU time, I already mentioned multiple ways to do this. Sleep, semaphores, timer callbacks, vsynch. Probably XNA does it via vsynch.<br /><br />The example code I provided was an example if you want to do it with Sleep.<br /><br />Regarding <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686298%28v=vs.85%29.aspx" class="postlink">Sleep(0)</a>:<br /><div class="quotetitle">MSDN wrote:</div><div class="quotecontent"><br />If you specify 0 milliseconds, the thread will relinquish the remainder of its time slice but remain ready. Note that a ready thread is not guaranteed to run immediately. Consequently, the thread may not run until some time after the sleep interval elapses.<br /></div><br /><br />As I said though, Sleep with the number of milliseconds you'd like to wait might be a little better. In practice, I don't think you'll find much of a difference; either way is fine for giving the CPU breathing room.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Mon Aug 27, 2012 10:14 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2012-08-27T10:09:56-07:00</updated>
<published>2012-08-27T10:09:56-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98690#p98690</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98690#p98690"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98690#p98690"><![CDATA[
<div class="quotetitle">Dwedit wrote:</div><div class="quotecontent"><br />I was trying to figure out how to get 60FPS, Vsync, and not 100% CPU usage, when I noticed that XNA does that stuff automatically, and it all just works.  So I guess we have to find out how XNA did it.<br /></div><br /><br />Getting VSYNC windowed was gonna be my next question.<br /><br />Edit: But how can XNA help us with our C++?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Mon Aug 27, 2012 10:09 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[Dwedit]]></name></author>
<updated>2012-08-27T10:34:34-07:00</updated>
<published>2012-08-27T10:05:24-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98689#p98689</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98689#p98689"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98689#p98689"><![CDATA[
I was trying to figure out how to get 60FPS, Vsync, and not 100% CPU usage, when I noticed that XNA does that stuff automatically, and it all just works.  So I guess we have to find out how XNA did it.<br /><br />Edit: checked out XNA, but the actual code responsible for performing the vblank wait is not .NET code.  The last .NET code used is &quot;GraphicsDevice.Present()&quot;.  Then it calls some native code after that.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=53">Dwedit</a> — Mon Aug 27, 2012 10:05 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2012-08-27T09:52:15-07:00</updated>
<published>2012-08-27T09:52:15-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98688#p98688</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98688#p98688"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98688#p98688"><![CDATA[
I agree that using Sleep(0) is better than nothing at all but doesn't solve my problem. How do PC games achieve 60FPS without 100% CPU usage?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Mon Aug 27, 2012 9:52 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rainwarrior]]></name></author>
<updated>2012-08-27T09:15:25-07:00</updated>
<published>2012-08-27T09:15:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98686#p98686</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98686#p98686"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98686#p98686"><![CDATA[
Sleep(0) doesn't necessarily return right away, even if you think no other programs are running, but as I suggested at the bottom it might be better to Sleep with the predicted needed number of milliseconds. In practice the difference between using Sleep(0) in a wait loop and just doing nothing can be huge in terms of CPU resource consumed.<br /><br />Cpow's solution is also good, waiting on a semaphore for a hardware driven timed signal. If you're synching to audio that requires a working audio signal. APIs for vsynch usually work similarly. There are other kinds of timers you can use to drive your loop. The main thing for maintaining a consistent framerate is to keep track of how many frames you should have executed based on that timer, catch up when behind (if desired), and especially wait up when ahead (preferrably giving CPU back to the system with Sleep or a semaphore or something similar).<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=5165">rainwarrior</a> — Mon Aug 27, 2012 9:15 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[WedNESday]]></name></author>
<updated>2012-08-27T09:04:25-07:00</updated>
<published>2012-08-27T09:04:25-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98684#p98684</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98684#p98684"/>
<title type="html"><![CDATA[Re: Sleep Function]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=9254&amp;p=98684#p98684"><![CDATA[
In an instance where no other programs were hogging the CPU wouldn't your example still result in 100% CPU usage?<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=191">WedNESday</a> — Mon Aug 27, 2012 9:04 am</p><hr />
]]></content>
</entry>
</feed>
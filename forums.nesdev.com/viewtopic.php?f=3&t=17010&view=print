<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Question about nestopia MMC5 emulation</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Question about nestopia MMC5 emulation</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=17010">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=17010</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Thu Feb 01, 2018 11:31 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Hey all, been a while since I have posted but had a question. Recently, I was watching videos on castlevania III and came across this video:<br /><br /><!-- m --><a class="postlink" href="https://www.youtube.com/watch?v=CJhwNRaOb0g">https://www.youtube.com/watch?v=CJhwNRaOb0g</a><!-- m --><br /><br />Fast forward to around to the 3:32 and look at the bottom of the status bar. It starts to bounce around uncontrollably. After watching a few vides of it in action on the real nes, it seems as if this is something that not supposed to happen. It seems to really rear it's head when going up and jumping up. It causes the bottom to shake harder. <br /><br />Is this accurate behavior? I fired up nestopia 1.40 and undead to check it out, and indeed, it still does this and really does it on the clock tower level as you work your way up. Can someone confirm is this is supposed to happen? IS CIII one of those harder to emulate games?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dougeff</b> [ Thu Feb 01, 2018 12:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I just played it on a real NES.<br /><br />This video is different from what I saw. There is some slight jitter on the screen split, but not this much.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Fri Feb 02, 2018 5:41 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for doing that dougeff. I guess something is obviously off somewhere. Maybe the irq perhaps?<br /><br /> Does anyone else have these issues with their emulator?<br /><br />EDIT**<br /><br />I looked at the image info in Nestopia, and noticed the mirroring is set to Horizontal, I changed it to Vertical like the mapper list said. No dice, it still bounces like crazy when going up on the first level and the clock tower level. Prob others too.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>NewRisingSun</b> [ Fri Feb 02, 2018 6:42 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><a href="https://youtu.be/6m75a6Zawg8?t=1m5s" class="postlink">Here</a> is a 60p capture from actual hardware. I actually find emulators' artifacts to be less objectionable. Emulators seem to just reveal the screen underneath the status bar at different points between frames, while on actual hardware, mysterious white lines appear. I wonder how that happens.<br /><br />I don't think it's that big an issue in this case. The Bandai Dragon Ball games have <a href="https://youtu.be/FTb3Xdn7vdk" class="postlink">far dirtier screen splits on actual hardware</a>.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>LightStruk</b> [ Fri Feb 02, 2018 7:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><a href="http://wiki.nesdev.com/w/index.php/MMC5#Nametable_mapping_.28.245105.29" class="postlink">MMC5 has mapper-controllable mirroring.</a> Altering the mirroring bits in the iNES header won't affect emulation.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Fri Feb 02, 2018 3:21 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Some emulators may use the mirroring bits in the rom header as a hint for their initial state though.  This matters more for DxROM games misassigned as MMC3.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Fri Feb 02, 2018 4:43 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks for all the responses guys. In this case though, is this accurate emulation or an issue that needs to be corrected?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Sat Feb 03, 2018 2:40 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Just ran another test using the famicom version. The Japanese version does not do this on nestopia. Is the Japanese version doing something different?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sat Feb 03, 2018 8:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Japanese version is VRC6, not MMC5.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Sat Feb 03, 2018 8:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ahh yes. Correct. Thank you Dwedit. It is my assumption that possibly something is off in the MMC5 irq scanline counting. Are there any test roms available to validate this assumption?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sat Feb 03, 2018 9:35 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Last time I looked over the MMC5 IRQ counter documentation, it was &quot;black box that just works, timing unknown&quot;.<br /><br />edit: Seems to trigger on the two end of line tile fetches?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sun Feb 04, 2018 2:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm guessing it's the same problem of the MMC3 IRQs, related to $2006. You must verify if writes to $2006 occur before the IRQ; otherwise, an extra clock is triggered... and the shaking you just see.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun Feb 04, 2018 2:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />We know that the MMC5 counts scanlines by checking for three reads from the same address as long as PPU A13 is high (well, really, PPU /A13 is low). So access to $2006 shouldn't trivially screw it up the same way it screws up the MMC3.<br /><br />We also know it knows when display is active or not.<br /><br />Looking at the <a href="https://wiki.nesdev.com/w/index.php/File:Ntsc_timing.png" class="postlink">diagram on the wiki</a>, those three reads should happen during dots 338, 340, and 2 ... Nestopia appears to trigger its counter on dot 0.<br /><br />I don't think two dots of error should cause this much of a difference, but ???

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>*Spitfire_NES*</b> [ Mon Feb 05, 2018 5:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Thanks guys for helping me look into this matter.  <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />Is there a particular place I can be looking in the Nestopia MMC5 code to look for this?  Hopefully a subtle change makes all the difference. I'll be the first to admit some of the more technical aspects are a little over my head, but hopefully the solution for this won't be too difficult. <br /><br />It def seems like IRQ misfiring, not unlike the mickey's safari in letterland issue nestopia used to have.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Tue Feb 06, 2018 2:34 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Question about nestopia MMC5 emulation</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />NestopiaUE source code: <!-- m --><a class="postlink" href="https://github.com/0ldsk00l/nestopia">https://github.com/0ldsk00l/nestopia</a><!-- m --><br /><br />File an Issue at <!-- m --><a class="postlink" href="https://github.com/0ldsk00l/nestopia/issues">https://github.com/0ldsk00l/nestopia/issues</a><!-- m --> so that the author can fix it, or people interesting in contributing code/fixes can submit pull requests that tie in to said issue.  You should reference this nesdev forum thread in the Issue.<br /><br />Also, <a href="https://wiki.nesdev.com/w/index.php/MMC5#Hardware" class="postlink">there are multiple revisions of MMC5</a>, differences unknown.  I only mention this because with MMC3 <a href="https://wiki.nesdev.com/w/index.php/MMC3#IRQ_Specifics" class="postlink">the IRQ counter differs based on revision and HW manufacturer</a>.  I also don't know if &quot;MMC5&quot; means &quot;MMC5A&quot; or not, because <a href="http://bootgod.dyndns.org:7777/profile.php?id=15" class="postlink">some have MMC5 silkscreening</a>, while <a href="http://bootgod.dyndns.org:7777/profile.php?id=4596" class="postlink">others have MMC5A</a> (I didn't find any with MMC5B, but I believe it).  Maybe more has been discussed off-board <a href="https://forums.nesdev.com/viewtopic.php?f=9&amp;t=14093" class="postlink">since then</a>?

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>2</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
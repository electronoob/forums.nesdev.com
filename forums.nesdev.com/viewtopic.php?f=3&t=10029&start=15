<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - CPU/PPU timing</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - CPU/PPU timing" href="http://forums.nesdev.com/feed.php?f=3&amp;t=10029" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '2');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=10029';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Tue Mar 19, 2019 12:55 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=10029&amp;start=15">CPU/PPU timing</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=10029"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 23 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=10029&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=10029">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=10029&amp;start=15&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=10029&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=10029&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p111321"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111321">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111321#p111321"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Apr 22, 2013 6:48 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Well, here's what I've got for now, just figuring out some kind of test framework to make these measurements.<br /><br />I've got code that synchronizes with VBL, then has a STA ABS instruction execute as late as possible just before NMI is vectored, and also have NMI just get vectored before that instruction (same code, does the before/after depending on CPU-PPU alignment after reset). On the scope is /NMI going low, and to show what the CPU is doing, A8. The STA ABS is at an address with A8 high, and the instruction just before it has A8 low (a JMP) to it. The STA ABS stores into $00xx, so A8 goes low during the store. During NMI vectoring, A8 is high. So you can see what's happening. I figured an address line would assert sooner than anything else. If anyone has better ideas, I'm open to them.<br /><br />In the pictures there are 1250ns/division (250ns/subdivision dots). A=A8 B=/NMI. Sorry about leaving the vertical cursor bars up.<br /><br />In the first one, /NMI goes low just too late, so the STA ABS executes. A8 goes high about 612ns after /NMI goes low. It does three fetches with A8 high (opcode, two bytes of address), 1780ns, then low for 560ns, then high for 3920ns, then low (the NMI handler code has A8 low).<br /><br />In the second one, /NMI goes low just in time, so you get 3920ns of vectoring with A8=high, then A8=low for NMI handler.<br /><br />(For triggering this, I run the scope in one-shot digital capture mode, and trigger it using EXT TRIG connected to the $4016 read strobe with a BIT $4016 a little before these events)<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=562&amp;mode=view"><img src="./download/file.php?id=562&amp;t=1" alt="NMI after.JPG" /></a><br />
			<span class="gensmall">NMI after.JPG [ 70.31 KiB | Viewed 2863 times ]</span>
		

		<br />
	</div><br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<a href="./download/file.php?id=563&amp;mode=view"><img src="./download/file.php?id=563&amp;t=1" alt="NMI before.JPG" /></a><br />
			<span class="gensmall">NMI before.JPG [ 71.58 KiB | Viewed 2863 times ]</span>
		

		<br />
	</div><br /><br />I've figured out how to capture the scope's RS-232 plotter output for better pictures (hp2xx FTW!), but need to get a DB-9 F-F null modem adapter before it's convenient.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p111322"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111322">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111322#p111322"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Apr 22, 2013 10:04 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> Linköping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I just figured out that you can make reads start at an exact master cycle in Visual 2C02 (see the updated <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/Visual_2C02">http://wiki.nesdev.com/w/index.php/Visual_2C02</a><!-- m --> for how. The io_ce node can be used to confirm where the read starts). The duty cycle is the same as the 2A03's, and it assumes the value is sampled at the end of the read cycle.<br /><br />There seems to be four cycles where the read can start where the interrupt line and the VBL flag setting gets suppressed <strong>completely</strong>, so for those it's probably safe to say that no NMI would happen on the real thing. For other start cycles INT/VBL rises momentarily, and those might be trickier I guess. Maybe this info could be combined with some of the earlier stuff to figure out what's going on.<br /><br />Brain dump below with results from Visual 2C02. The numbers at the top are PPU dots on the line after the post-render line. The 0's are the first phase of the read, the 1's the second (the duty cycle is 5/8).<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----------------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----------------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ------------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear, INT and VBL completely suppressed <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear, INT and VBL completely suppressed <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear, INT and VBL completely suppressed<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear, INT and VBL completely suppressed <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set (note the short INT assertion)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -----&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -----------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /></div><br /><br />Some kind of buffering is used in the PPU for the value &quot;returned&quot; by the read, which is why it can be read as set even though INT drops really quickly.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p111328"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111328">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111328#p111328"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Tue Apr 23, 2013 5:45 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> Linköping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Taking just the ticks from the &quot;preferred&quot; alignment, you get the following:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----------------------------... VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as clear, INT and VBL completely suppressed<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set (note the short INT assertion)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT<br /><br />&nbsp; -2&nbsp; &nbsp; &nbsp; -1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;4<br />* * * * * * * * * * * * * * * * * * * * * * * * * * * * * MASTER<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000000000111111111111111&nbsp; &nbsp; &nbsp; &nbsp; CPU&nbsp; &nbsp; &nbsp; Reads as set<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VBL/INT</div><br /><br />I'm guessing that those correspond, in order, to <em>2 before</em>, <em>1 before</em>, <em>at</em>, and <em>1 after</em>, as specified in <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/PPU_frame_timing">http://wiki.nesdev.com/w/index.php/PPU_frame_timing</a><!-- m --> and the vbl_nmi_timing tests. If the NMI input is sampled near the end of a CPU cycle (not sure if it is), then it makes sense that the last two would miss the NMI even though it momentarily rises. Later starting points would have parts of the NMI assertion overlapping the end of the <em>previous</em> CPU cycle however, and so would not be missed.<br /><br />Edit: I'm assuming this alignment corresponds to your 742. Is that correct? Just realized it's a bit tricky to see whether this one would be 742 or 743 in <!-- m --><a class="postlink" href="http://i.imgur.com/nq78U8I.gif">http://i.imgur.com/nq78U8I.gif</a><!-- m --> .  <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p111411"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111411">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111411#p111411"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 25, 2013 9:45 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've done several new test and am finishing them and going to post the readings. I'm forming a picture that isn't pleasing of the meta-situation here. I'm thinking there's no clear &quot;this happens at this moment&quot; situation, especially since the CPU can be at any master clock offset with respect to the PPU. That's less than 50ns, so a few gate propagation delays can mean the difference between it being read on one cycle or another. So because of buffers/counters there are between the clock and what the CPU reads/writes, timing is spread across cycles and dots. I think this means that there won't be a clear &quot;this happens on this cycle, that happens on that&quot;, unless you're emulating to master clocks and emulating all four CPU-PPU alignments. Even then, you'll have to implement delays, where something can happen but not be visible until a master clock later or so.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p111415"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111415">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111415#p111415"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Apr 25, 2013 10:11 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> Linköping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">blargg wrote:</div><div class="quotecontent">I've done several new test and am finishing them and going to post the readings. I'm forming a picture that isn't pleasing of the meta-situation here. I'm thinking there's no clear &quot;this happens at this moment&quot; situation, especially since the CPU can be at any master clock offset with respect to the PPU. That's less than 50ns, so a few gate propagation delays can mean the difference between it being read on one cycle or another. So because of buffers/counters there are between the clock and what the CPU reads/writes, timing is spread across cycles and dots. I think this means that there won't be a clear &quot;this happens on this cycle, that happens on that&quot;, unless you're emulating to master clocks and emulating all four CPU-PPU alignments. Even then, you'll have to implement delays, where something can happen but not be visible until a master clock later or so.</div><br /><br />What I'm doing above is picking a particular alignment for which the behavior is known (742 I believe - would be nice to have this confirmed), checking the results you get for different PPU clock offsets near a point (or region perhaps) of interest with that alignment in Visual 2C02 (VBL setting and INT assertion in this case), and then doing some elimination to figure out what these offsets correspond to (&quot;1 before&quot;, &quot;at&quot;, &quot;1 after&quot;, etc.). Of course you can only be completely sure by testing on the real hw, but I think you could still come up with some pretty good guesses.<br /><br />Barring me having messed up, there doesn't seem to be any other way to assign <em>1 before</em>, etc., with the 742 alignment that would be likely to produce the observed behavior, even taking propagation delays and such into account.<br /><br />Edit: s/master clock offsets/PPU clock offsets/<br /><br />Edit 2: Calling it &quot;1 before&quot;, etc. is a bit arbitrary. It's not a point, as you say, and depends on CPU/PPU interaction around the region of interest. I'm basically just trying to figure out what happens when a read starts at PPU tick n for the 742 alignment at the moment.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p111615"></a>
				<b class="postauthor">blargg</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p111615">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=111615#p111615"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 01, 2013 6:00 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=17.gif" width="60" height="69" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Sep 27, 2004 8:33 am<br /><b>Posts:</b> 3715<br /><b>Location:</b> Central Texas, USA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">OK, finally posting a lot of timing test results. Not complete by any measure, but if I don't post they might get lost in the shuffle of life. Pictures and some docs: <a href="http://blargg.8bitalley.com/temp/nes-signal-timings.zip" class="postlink">nes-signal-timings.zip</a><br /><br />The goal here is to get a clearer picture of when things happen and how these correspond to the various test ROMs and timings we see from a purely programming perspective.<br /><br />* terms - lays out basic terms, the four alignments, why they aren't trivial, how we can synchronize to the PPU frame, and a common timing reference in software to use<br />* timing pictures - descriptions of all the scope pictures showing various timings<br />* CPU cycle timing - distillation of the timings into one diagram<br /><br />One thing that is wanted is a picture of how CPU cycles correspong to PPU dots. It's still not clear when those begin.<br /><br />I believe that for the CPU, it may be considered beginning/ending on the falling edges of PHI2. I've used the CPU address line changes as a 0 reference, since it's useful for showing which cycle is of interest. I measured PHI2's falling edge to be 60ns before the address line change, and have read that this might be the &quot;proper&quot; beginning a CPU cycle.<br /><br />Do we have verification that /VBL goes low on the first dot of a frame? If so, then we have enough to form a clear picture of the timings for the four alignments.<br /><br />The PPU apparently latches internally when reading from it, so the CPU sees the state of things around the time PPU /CE is asserted. For example, even though /VBL goes high during the read, D7 to the CPU doesn't change, indicating that the PPU has a latch for outputs when reading from it.<br /><br />For what I'm calling the +0 clocks alignment (in the previously posted list, the last is +0 clocks, the next-to-last +1 clocks, etc.), we have CPU A8 going low for the access at +0ns, then at +163ns PPU /CE going low, presumably latching the VBL flag internally. If the CPU had read even one clock sooner, it wouldn't have found VBL set. So if VBL is set on the first dot, then we have a dot beginning around +163ns, and the CPU cycle at +0ns. A PPU dot is 186.24ns, so this is slightly less than a dot. There's probably a little propagation delay from the dot beginning to VBL getting set internally, so the dot probably begins a little sooner.<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;ns -------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 11111111112222222222333333333344444444445555555555<br />&nbsp; &nbsp; &nbsp; 7654321012345678901234567890123456789012345678901234567890123456789<br />&nbsp; &nbsp; &nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;___<br />A0-A15_______\_______________________________________________________/___<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 559<br />&nbsp; &nbsp; &nbsp; _&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_________________________________<br />PHI2&nbsp; &nbsp;\___________________/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\___________<br />&nbsp; &nbsp; &nbsp; -60&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;135&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;487<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ___________________&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_______<br />PPU /CE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \___________________________________/<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 163&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;517<br /><br />dots 0clk&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;VBL set&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;<br />dots 1clk&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;VBL set&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;<br />dots 2clk&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;VBL set&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#93;<br />dots 3clk&nbsp; &nbsp; &#93;&#91;VBL set&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#93;<br />cpu a8&nbsp; &nbsp; &nbsp; &#93;&#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Read&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#93;&#91;<br />&nbsp; phi2 &#91;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Read&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#93;&#91;</div><br />So there are the probable timings, with the two interpretations of a CPU cycle shown.<br /><br />Note that if we examine only CPU reads, it's irrelevant where the CPU cycle is, since all the reads occur at the same point. The important thing is that an alignment of +0 clocks corresponds to the CPU reading the VBL flag the earliest possible in the frame.<br /><br />I haven't looked as much at writes. I'm guessing that they occur on the rising edge of the /CE line, once data lines have stabilized. SO that would put them about 352ns after reads, or about 7.6 clocks later, slightly less than 2 dots.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p112396"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p112396">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=112396#p112396"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed May 22, 2013 11:48 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> Linköping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">About to look into this some more. I poked around a bit in Visual 2A03/2C02. Here's some stuff that might be useful before I forget it:<br /><br /><ul><li>I added a section on PPU address bus contents/timing to <a href="http://wiki.nesdev.com/w/index.php/PPU_rendering" class="postlink">http://wiki.nesdev.com/w/index.php/PPU_rendering</a> . In Visual 2C02 ALE is high exactly during the first cycle of a two-cycle VRAM access, so barring propagation delays, ALE goes high right when a PPU cycle starts (but obv. only for the first PPU cycle).</li><li><a href="http://wiki.nesdev.com/w/index.php/CPU_interrupts" class="postlink">http://wiki.nesdev.com/w/index.php/CPU_interrupts</a> (renamed from &quot;CPU interrupt quirks&quot;) now has more precise info on when interrupts are polled. Seems to be during the first phase (half-cycle) of the CPU cycle.</li><li><a href="http://wiki.nesdev.com/w/index.php/CPU_pin_out_and_signal_description" class="postlink">http://wiki.nesdev.com/w/index.php/CPU_pin_out_and_signal_description</a> has some more info on the timing of reads and writes.</li><li>Also added some misc. info to <a href="http://wiki.nesdev.com/w/index.php/PPU_pin_out_and_signal_description" class="postlink">http://wiki.nesdev.com/w/index.php/PPU_pin_out_and_signal_description</a>, though it might not be as relevant.</li></ul></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p112846"></a>
				<b class="postauthor">ulfalizer</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p112846">Re: CPU/PPU timing</a></div><div style="float: right;"><a href="./viewtopic.php?p=112846#p112846"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 06, 2013 9:22 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=5911_1363098840.png" width="80" height="52" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Mar 08, 2013 9:55 pm<br /><b>Posts:</b> 349<br /><b>Location:</b> Linköping, Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've figured out roughly what goes on with the <strong>VBlank</strong> in the PPU that causes the weird reading behavior.<br /><br />Inside the PPU, there are two key players when it comes to signal timing:<br /><br /><ol style="list-style-type: decimal"><li>Read/write signals like <strong>/r2002</strong> and <strong>/w2001</strong>.</li><li>The <strong>_io_ce</strong> signal.</li></ol><br />The read/write signals are generated directly by stuffing the <strong>r/w</strong> line and the three address bus lines from the CPU into a decoder (around node 419 in Visual 2C02). The <strong>r/w</strong> line and the address bus is set at the beginning of a read/write CPU cycle, so the read/write signals will have the corresponding values without delay as soon as the read or write starts (ignoring propagation delays - not sure if they're significant here).<br /><br />The <strong>_io_ce</strong> line comes from the address decoder (the chip marked &quot;LS139&quot; in <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/images/f/f3/Neswires.jpg">http://wiki.nesdev.com/w/images/f/f3/Neswires.jpg</a><!-- m -->). The address decoder is set up so that the chip enable signals are generated during the second, high phase of M2 (it basically has an &quot;AND M2&quot; condition on all the outputs, though some are inverted). The <strong>/DBE</strong> input to the PPU in the diagram corresponds to <strong>_io_ce</strong>, and is also inverted, so that <strong>_io_ce</strong> will be <em>low</em> during the second, high phase of M2. M2 has a modified non-50% duty cycle (see <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/CPU_pin_out_and_signal_description">http://wiki.nesdev.com/w/index.php/CPU_ ... escription</a><!-- m -->).<br /><br /><em>To summarize:</em> For a read/write cycle from the CPU, the internal read/write signals in the PPU will get their values right away, while <strong>_io_ce</strong> will go low during the second (high) phase of M2.<br /><br />Inside the PPU, the same signal, <strong>read_2002_output_vblank_flag</strong>, is used both to clear the VBlank flag and to hold the value of the read buffer (see the tutorial). While the read buffer is not held (closed off), it simply mirrors the VBlank flag. The relationship between the signals is<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">read_2002_output_vblank_flag = /r2002 NOR _io_ce</div><br /><br />This means that <strong>read_2002_output_vblank_flag</strong> goes high during the second phase of M2 during a read from $2002. Since this is the point where the value is held, we can make the following observation:<br /><br /><ul><li>The value returned by the read is the value the VBlank flag has when the high phase of M2 starts.</li></ul><br />To figure out the rest, there's one more piece needed: The signal that sets the VBlank flag (node 5807 - let's call it &quot;<strong>set_vbl_flag</strong>&quot;) is high during the first PPU half-cycle (i.e., during <strong>pclk0</strong>) of <strong>vpos</strong>=241/<strong>hpos</strong>=1. This means that if a read ends before the end of <strong>set_vbl_flag</strong>, the VBlank flag will still get set and remain set. However, if a read ends after <strong>set_vbl_flag</strong> (e.g. in a case where the high phase of M2 completely overlaps <strong>set_vbl_flag</strong>), then the flag will be cleared during and after it is being set, suppressing the setting.<br /><br />The NMI output is directly tied to the VBlank flag (it just has an additional &quot;AND nmi_enabled&quot; condition). Looking at the above, you can see how an NMI might be missed, as the high &quot;clearing&quot; phase of M2 might completely override <strong>set_vbl_flag</strong>, and thus the NMI.<br /><br />It's a bit confusing, but clicking around a bit helps. I also put some notes (mostly for myself) at <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/User:Ulfalizer">http://wiki.nesdev.com/w/index.php/User:Ulfalizer</a><!-- m --> .<br /><br />Sorry for not looking into the timing stuff you posted yet btw, but attacking the issue from two angles is probably a good idea at least. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Maybe <strong>read_2002_output_vblank_flag</strong> should be renamed to something like &quot;<strong>read_2002_clear_vblank_flag_and_hold_value</strong>&quot; by the way.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5911"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=10029&amp;start=15"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=10029"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>2</strong> of <strong>2</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 23 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=10029&amp;start=0">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=10029">1</a><span class="page-sep">, </span><strong>2</strong></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 5 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="10029" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
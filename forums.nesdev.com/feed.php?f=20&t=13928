<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=20&amp;t=13928" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2016-03-06T15:32:17-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=20&amp;t=13928</id>
<entry>
<author><name><![CDATA[nicklausw]]></name></author>
<updated>2016-03-06T15:32:17-07:00</updated>
<published>2016-03-06T15:32:17-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=13928&amp;p=165808#p165808</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=13928&amp;p=165808#p165808"/>
<title type="html"><![CDATA[Scrolling Text Snippet]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=13928&amp;p=165808#p165808"><![CDATA[
I've been cooking up something for the Gameboy, and while it's just a few fades and a main menu, already I have learned tons of stuff. Bank switching is actually alright on the GB, for one.<br /><br />Anyway, I want to at least share something with you all (having been absent for a while now), so here's my code for scrolling text. You call it like this: (macro)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">print_text: macro<br />  ld hl,\3 ; the text<br />  ld bc,bank(\3) ; the text bank<br />  ld de,_SCRN0+\1+(SCRN_VY_B*\2) ; \1 is x, \2 is y<br />  call f_print_text ; do it!<br />  endm</div><br /><br />and here's the code: (note, you need <a href="https://github.com/nicklausw/pong-console/blob/master/gb/rgbds/gb.z80" class="postlink">these lovely defines</a>)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">line_nl = $fe<br />line_end = $ff<br />line_length = 32<br /><br />section &quot;wram&quot;, wram0<br />counter:: db<br /><br />; wait for vblank<br />section &quot;wait_vblank&quot;, rom0<br />wait_vblank::<br />  ldh a, &#91;rSTAT-$ff00&#93;<br />  and 2 ; unimportant bytes<br />  jr nz, wait_vblank<br />  ret<br /><br />section &quot;f_print_text&quot;, rom0<br />f_print_text::<br />  ; set line counter<br />  push hl<br />  ld hl,counter<br />  ld &#91;hl&#93;,line_length<br />  pop hl<br />  <br />  <br />  ; set bank<br />  ld a,c<br />  ld &#91;$2000&#93;,a<br />  <br />  call wait_vblank<br />  <br />.loop:<br />  ld a,&#91;hl+&#93; ; get a byte<br />  <br />  push af<br />  ld a, &#91;counter&#93;<br />  dec a ; lower line counter<br />  ld &#91;counter&#93;,a<br />  pop af<br />  <br />  cp line_nl ; is it time for newline?<br />  jr z, .newline ; yep.<br />  cp line_end ; is it done?<br />  ret z ; yes, we're done.<br /><br />.back:<br />  add $6f ; this is assuming the text tiles are $70 higher than the raw data text<br />  ld &#91;de&#93;,a<br />  ei<br />  inc de<br />  halt ; wait a bit!<br />  halt ; wait some more!<br />  <br />  ; the last frame is only called<br />  ; if a is pressed...<br />  ; that functionality works, but is<br />  ; not wanted just yet.<br />  ;call controller<br />  ;bit PADB_A,a<br />  ;jr nz,.ext_halt<br />  <br />  halt ; keep waiting!<br />  <br />;.ext_halt:<br />  jr .loop<br />  <br />.newline:<br />  ld a, &#91;counter&#93;<br />  ld b,a<br />  xor a<br />  <br />; fill until next line<br />.nl_loop:<br />  xor a<br />  ld &#91;de&#93;,a<br />  inc de<br />  dec b<br />  jr nz, .nl_loop<br />  <br />  ld a, line_length<br />  ld &#91;counter&#93;,a<br />  xor a<br />  jr .back<br /></div><br /><br />An example of some text could be:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">the_text:<br />db &quot;hello this is nicklausw&quot;, line_nl<br />db &quot;and i do not tap dance&quot;, line_end</div><br /><br />It would be called like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">print_text 0, 0, the_text</div><br /><br />and would print on the screen as such:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">hello this is nicklausw<br />and i do not tap dance</div><br /><br />note that the gameboy screen probably isn't big enough for the width of that text.<br /><br />If you do not want the text to scroll, then easy, just remove the halts to keep from pausing. Maybe replace one of them with a &quot;call wait_vblank&quot; to make sure things don't mess up with vblank and all that.<br /><br />The code might be a little sloppy, but it works for me. I'll probably cook up a little demo to show it off in action soon.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6832">nicklausw</a> — Sun Mar 06, 2016 3:32 pm</p><hr />
]]></content>
</entry>
</feed>
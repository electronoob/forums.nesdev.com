  .inesmap 5   ; mapper 5 = MMC3
  .inesprg 8   ; # of 8KB PRG banks 64KB
  .ineschr 64  ; # of 4KB CHR banks 256KB
  .inesmir 1   ; background mirroring

  .bank 15
  .org $FFFA     ;first of the three vectors starts here
  .dw NMI        ;when an NMI happens (once per frame if enabled) the processor will jump to the label NMI
  .dw RESET      ;when the processor first turns on or is reset, it will jump to the label RESET
  .dw 0          ;external interrupt IRQ is not used in this tutorial

controller = $FF
  
  .org $E000

RESET:
  LDA #$03
  STA $5101
  LDA #$01
  STA $5104
  LDA #$02
  STA $5105
  LDA #$00
  STA $5124
  LDA #$01
  STA $5125
  LDA #$02
  STA $5126
  LDA #$03
  STA $5127
  LDA #$01
  STA $5203
  SEI          ; disable IRQs
  CLD          ; disable decimal mode
  LDX #$40
  STX $4017    ; disable APU frame IRQ
  LDX #$FF
  TXS          ; Set up stack
  INX
  STX $2000    ; disable NMI
  STX $2001    ; disable rendering
  STX $4010    ; disable DMC IRQs

ClearMemory:
  LDA #$00
  STA $0000,X
  STA $0100,X
  STA $0300,X
  STA $0400,X
  STA $0500,X
  STA $0600,X
  STA $0700,X
  LDA #$FF
  STA $0200,X
  INX
  BNE ClearMemory

LoadPalettes:
  LDA $2002
  LDA #$3F
  STA $2006
  LDA #$00
  STA $2006
  LDX #$00
LoadPalettesLoop:
  LDA Palette,X
  STA $2007
  INX
  CPX #$20            
  BNE LoadPalettesLoop
  
Black:
  LDA $2002
  LDA #$20
  STA $2006
  LDA #$20
  STA $2006
  LDA #$01
  LDX #$60
BlackLoop:
  STA $2007
  DEX
  BNE BlackLoop

  LDA #%10010100   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  STA $2000
  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
  STA $2001

Forever:
  JMP Forever

NMI:
  JSR UpdatePPU
  JSR ColumnMaker
  ;JSR ReadController
  JSR IRQLoop
  RTI
  
ColumnMaker:  
  LDA #$00
  STA $10
ColumnLoop:
  LDA $2002
  LDA #$20
  STA $2006
  LDA $10
  CLC
  ADC #$C0
  STA $2006
  LDX $10
  LDA Packers,X
  TAX
  LDA Strip0,X
  STA $30
  LDA Strip1,X
  STA $31
  LDY #$00
RowLoop:
  LDA [$30],Y
  STA $2007
  INY
  CPY #$17
  BNE RowLoop
  INC $10
  LDA $10
  CMP #$20
  BNE ColumnLoop

LatchController:
  LDA #$01
  STA $4016
  LDA #$00
  STA $4016
  LDX #$08
ReadControllerLoop:
  LDA $4016
  LSR A
  ROL controller
  DEX
  BNE ReadControllerLoop
  RTS

ReadController:
  JSR LatchController
Reread:
  LDA controller
  PHA
  JSR LatchController
  PLA
  CMP controller
  BNE Reread
  LDA controller
  BNE ReadGuard
  RTS
ReadGuard:
  RTS
  
IRQLoop:
  LDA $5204
  CLC
  ADC #%01000000
  BEQ IRQLoop
  STA $50
  INC $52
LoadExtendedRAM:
  LDA #$00
  LDX #$00
RAMLoop:
  STA $5C00,X
  STA $5D00,X
  STA $5E00,X
  STA $5F00,X
  INX
  BNE RAMLoop
  RTS

UpdatePPU:
  LDA #$00
  STA $2003
  LDA #$02
  STA $4014
  LDA #$00         ; tell the PPU there is no background scrolling
  STA $2005
  STA $2005

  LDA #%10010100   ; enable NMI, sprites from Pattern Table 0, background from Pattern Table 1
  STA $2000
  LDA #%00011110   ; enable sprites, enable background, no clipping on left side
  STA $2001
  LDA #$00         ; tell the PPU there is no background scrolling
  STA $2005
  STA $2005
  RTS

Palette:
  .db $00,$39,$30,$0D, $00,$39,$30,$0A, $00,$00,$00,$00, $00,$00,$00,$00   ; Background
  .db $1A,$00,$00,$00, $00,$00,$00,$00, $00,$00,$00,$00, $00,$00,$00,$00   ; Sprites

Attributes:
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  .db $00,$00,$00,$00,$00,$00,$00,$00
  
Packers:
  .db $00,$00,$07,$08
  .db $09,$01,$31,$32,$33,$34,$35,$36,$01,$0A   ; LEndzone
  .db $0B,$02,$03,$02,$04,$05,$02,$02,$0C,$0D   ; 0-10
  .db $0E,$0F,$02,$02,$04,$05,$02,$02           ; 10-20

Strip0:
  .db $00,$17,$2E,$45,$5C,$73,$8A,$A1,$B8,$CF,$E6,$FD,$14,$2B,$42,$59
  .db $70,$87,$9E,$B5,$CC,$E3,$FA,$11,$28,$3F,$56,$6D,$84,$9B,$B2,$C9
  .db $E0,$F7,$0E,$25,$3C,$53,$6A,$81,$98,$AF,$C6,$DD,$F4,$0B,$22,$39
  .db $50,$67,$7E,$95,$AC,$C3,$DA,$F1,$08,$1F,$36,$4D,$64,$7B,$92,$A9
  .db $C0,$D7,$EE
  
Strip1:
  .db $80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$80,$81,$81,$81,$81
  .db $81,$81,$81,$81,$81,$81,$81,$82,$82,$82,$82,$82,$82,$82,$82,$82
  .db $82,$82,$83,$83,$83,$83,$83,$83,$83,$83,$83,$83,$83,$84,$84,$84
  .db $84,$84,$84,$84,$84,$84,$84,$84,$85,$85,$85,$85,$85,$85,$85,$85
  .db $85,$85,$85
  
  .bank 14
  .org $8000
  
  .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00   ; 00 BlankOutside

  .db $02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02   ; 01 BlankEndzone

  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 02 Y

  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$39,$00,$38,$00,$3C,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 03 2Y

  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 04 5Y
  .db $02,$34,$34,$34,$34,$34,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$34,$34,$34,$34,$34,$02   ; 05

  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 06 35Y
  
  .db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$6D,$7D,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00   ; 07 L-Post
  .db $05,$05,$4D,$4E,$4E,$4D,$4E,$4E,$4E,$5E,$6E,$7E,$5D,$05,$05,$05,$05,$05,$05,$05,$05,$05,$05   ; 08

  .db $04,$34,$4F,$4F,$4F,$4F,$4F,$4F,$4F,$5F,$6F,$6F,$6F,$7F,$34,$34,$34,$34,$34,$34,$34,$33,$03   ; 09 L-BlankPost

  .db $02,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$32,$02   ; 0A L-InsideEndzone

  .db $04,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$34,$33,$03   ; 0B L-OutsideEndzone

  .db $02,$37,$00,$00,$00,$20,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$22,$00,$00,$00,$3E,$02   ; 0C L10
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$23,$00,$00,$00,$3E,$02   ; 0D
  .db $02,$34,$34,$34,$34,$12,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 0E
  .db $02,$37,$00,$00,$00,$1C,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$1B,$00,$00,$00,$3E,$02   ; 0F

  .db $02,$37,$00,$00,$00,$20,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$24,$00,$00,$00,$3E,$02   ; 10 L20
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$25,$00,$00,$00,$3E,$02   ; 11
  .db $02,$34,$34,$34,$34,$14,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 12
  .db $02,$37,$00,$00,$00,$1D,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$1B,$00,$00,$00,$3E,$02   ; 13

  .db $02,$37,$00,$00,$00,$20,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$26,$00,$00,$00,$3E,$02   ; 14 L30
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$27,$00,$00,$00,$3E,$02   ; 15
  .db $02,$34,$34,$34,$34,$16,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 16
  .db $02,$37,$00,$00,$00,$1E,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$1B,$00,$00,$00,$3E,$02   ; 17

  .db $02,$37,$00,$00,$00,$20,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$28,$00,$00,$00,$3E,$02   ; 18 L40
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$29,$00,$00,$00,$3E,$02   ; 19
  .db $02,$34,$34,$34,$34,$18,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 1A
  .db $02,$37,$00,$00,$00,$1F,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$1B,$00,$00,$00,$3E,$02   ; 1B

  .db $02,$37,$00,$00,$00,$2C,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$2F,$00,$00,$00,$3E,$02   ; 1C R40
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$29,$00,$00,$00,$3E,$02   ; 1D
  .db $02,$34,$34,$34,$34,$18,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 1E
  .db $02,$37,$00,$00,$00,$19,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$11,$00,$00,$00,$3E,$02   ; 1F

  .db $02,$37,$00,$00,$00,$2C,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$2E,$00,$00,$00,$3E,$02   ; 20 R30
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$27,$00,$00,$00,$3E,$02   ; 21
  .db $02,$34,$34,$34,$34,$16,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 22
  .db $02,$37,$00,$00,$00,$17,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$11,$00,$00,$00,$3E,$02   ; 23

  .db $02,$37,$00,$00,$00,$2C,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$2D,$00,$00,$00,$3E,$02   ; 24 R20
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$25,$00,$00,$00,$3E,$02   ; 25
  .db $02,$34,$34,$34,$34,$14,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 26
  .db $02,$37,$00,$00,$00,$15,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$11,$00,$00,$00,$3E,$02   ; 27

  .db $02,$37,$00,$00,$00,$2C,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 28 R10
  .db $02,$37,$00,$00,$00,$21,$00,$00,$00,$3A,$00,$00,$00,$3D,$00,$00,$00,$23,$00,$00,$00,$3E,$02   ; 29
  .db $02,$34,$34,$34,$34,$12,$34,$34,$34,$36,$34,$34,$34,$35,$34,$34,$34,$10,$34,$34,$34,$34,$02   ; 2A
  .db $02,$37,$00,$00,$00,$13,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$11,$00,$00,$00,$3E,$02   ; 2B

  .db $02,$37,$00,$00,$00,$1A,$00,$00,$00,$39,$00,$00,$00,$3C,$00,$00,$00,$2A,$00,$00,$00,$3E,$02   ; 2C R-ArrowPoint

  .db $04,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$06,$07,$03   ; 2D R-InsideEndzone

  .db $02,$00,$00,$00,$00,$00,$00,$00,$9D,$5D,$6D,$6D,$6D,$7D,$00,$00,$00,$00,$00,$00,$00,$00,$02   ; 2E R-BlankPost

  .db $04,$02,$4F,$4E,$4E,$4E,$4F,$4E,$4E,$5E,$6E,$7E,$4C,$4D,$02,$02,$02,$02,$02,$02,$02,$04,$03   ; 2F R-Post
  .db $00,$00,$00,$00,$00,$00,$00,$00,$9F,$5F,$6F,$7F,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00   ; 30

  .db $02,$00,$D2,$80,$90,$A0,$B0,$C0,$D0,$00,$E0,$F0,$D1,$86,$96,$A6,$B6,$C6,$D6,$E6,$F6,$00,$02   ; 31 L-Packers
  .db $02,$00,$D3,$81,$91,$A1,$B1,$C1,$D1,$00,$E1,$F1,$D1,$87,$97,$A7,$B7,$C7,$D7,$E7,$F7,$00,$02   ; 32
  .db $02,$00,$D4,$82,$92,$A2,$B2,$C2,$D1,$00,$E2,$F2,$D1,$88,$98,$A8,$B8,$C8,$D8,$E8,$F8,$00,$02   ; 33
  .db $02,$00,$00,$83,$93,$A3,$B3,$C3,$D1,$00,$E3,$F3,$D1,$89,$99,$A9,$B9,$C9,$D9,$E9,$F9,$00,$02   ; 34
  .db $02,$00,$00,$84,$94,$A4,$B4,$C4,$D1,$00,$E4,$F4,$D1,$8A,$9A,$AA,$BA,$CA,$DA,$EA,$FA,$00,$02   ; 35
  .db $02,$00,$00,$85,$95,$A5,$B5,$C5,$D5,$00,$E5,$F5,$D1,$8B,$9B,$AB,$BB,$CB,$DB,$EB,$FB,$00,$02   ; 36

  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$39,$DE,$EE,$FE,$3C,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 37 C-Packers
  .db $02,$37,$00,$00,$00,$08,$00,$00,$00,$8C,$9C,$AC,$BC,$CC,$00,$00,$00,$0C,$00,$00,$00,$3E,$02   ; 38
  .db $02,$37,$00,$00,$00,$09,$00,$00,$00,$8D,$9D,$AD,$BD,$CD,$00,$00,$00,$0D,$00,$00,$00,$3E,$02   ; 39
  .db $02,$34,$34,$34,$34,$0A,$34,$34,$34,$8E,$9E,$AE,$BE,$CE,$34,$34,$34,$0E,$34,$34,$34,$34,$02   ; 3A
  .db $02,$37,$00,$00,$00,$0B,$00,$00,$00,$8F,$9F,$AF,$BF,$CF,$00,$00,$00,$0F,$00,$00,$00,$3E,$02   ; 3B
  .db $02,$37,$00,$00,$00,$00,$00,$00,$00,$39,$DF,$EF,$FF,$3C,$00,$00,$00,$00,$00,$00,$00,$3E,$02   ; 3C
  
  .db $02,$00,$00,$00,$80,$90,$A0,$B0,$C0,$D0,$E0,$F0,$86,$96,$A6,$B6,$C6,$D6,$E6,$00,$00,$00,$02   ; 3D R-Packers
  .db $02,$00,$00,$00,$81,$91,$A1,$B1,$C1,$D1,$E1,$F1,$87,$97,$A7,$B7,$C7,$D7,$E7,$00,$00,$00,$02   ; 3E
  .db $02,$00,$00,$00,$82,$92,$A2,$B2,$C2,$D2,$E2,$F2,$88,$98,$A8,$B8,$C8,$D8,$E8,$00,$00,$00,$02   ; 3F
  .db $02,$00,$00,$00,$83,$93,$A3,$B3,$C3,$D3,$E3,$F3,$89,$99,$A9,$B9,$C9,$D9,$E9,$00,$00,$00,$02   ; 40
  .db $02,$00,$00,$00,$84,$94,$A4,$B4,$C4,$D4,$E4,$F4,$8A,$9A,$AA,$BA,$CA,$DA,$EA,$00,$00,$00,$02   ; 41
  .db $02,$00,$00,$00,$85,$95,$A5,$B5,$C5,$D5,$E5,$F5,$8B,$9B,$AB,$BB,$CB,$DB,$EB,$00,$00,$00,$02   ; 42

  .bank 16
  .org $0000
  .incbin "NFL.chr"
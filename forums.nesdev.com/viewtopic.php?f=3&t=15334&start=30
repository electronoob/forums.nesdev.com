<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Visual Nes - C++/C# port of Visual 2A03 + 2C02</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESemdev" href="http://forums.nesdev.com/feed.php?f=3" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Visual Nes - C++/C# port of Visual 2A03 + 2C02" href="http://forums.nesdev.com/feed.php?f=3&amp;t=15334" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '3');
	var per_page = '15';
	var base_url = './viewtopic.php?f=3&amp;t=15334';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



	/**
	* Play quicktime file by determining it's width/height
	* from the displayed rectangle area
	*
	* Only defined if there is a file block present.
	*/
	function play_qt_file(obj)
	{
		var rectangle = obj.GetRectangle();

		if (rectangle)
		{
			rectangle = rectangle.split(',')
			var x1 = parseInt(rectangle[0]);
			var x2 = parseInt(rectangle[2]);
			var y1 = parseInt(rectangle[1]);
			var y2 = parseInt(rectangle[3]);

			var width = (x1 < 0) ? (x1 * -1) + x2 : x2 - x1;
			var height = (y1 < 0) ? (y1 * -1) + y2 : y2 - y1;
		}
		else
		{
			var width = 200;
			var height = 0;
		}

		obj.width = width;
		obj.height = height + 16;

		obj.SetControllerVisible(true);

		obj.Play();
	}


// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<!--<div style="float: right;">
					<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
					<input type="hidden" name="cmd" value="_s-xclick">
					<input type="hidden" name="hosted_button_id" value="X2HM4WNR5YT8S">
					<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
					<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
					</form>
				</div>-->
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=minion"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 16, 2018 11:47 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />
	

					<center>
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- NesDev Forums -->
					<ins class="adsbygoogle"
						 style="display:block"
						 data-ad-client="ca-pub-7801010229099644"
						 data-ad-slot="7979066809"
						 data-ad-format="auto"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
					</center>
	<br />


<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=3&amp;t=15334&amp;start=30">Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=15334"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 50 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=15334&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=15334">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=15334&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=15334&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=15334&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=3&amp;t=15334&amp;start=30&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=3&amp;t=15334&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=3&amp;t=15334&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186430"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186430">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186430#p186430"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 11, 2017 6:15 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">There's a bug in the Visual 2C02 OAM DMA: <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?p=169373#p169373">viewtopic.php?p=169373#p169373</a><!-- l --> (it does not actually seem to corrupting the source address to 0 always unlike I said in that post, instead it seems to depend on the value written and the hibyte of &quot;ab&quot;: spr_addr = value_written AND hibyte(ab)).</div>Yea, that seems to be what DK is doing - the OAM data matches the zero page.  Isn't the high byte of AB always $40 in this particular scenario?<br />cpow seemed to be convinced these bugs were not there originally - is there any Git/SVN repository available for the Visual 2A03 that I might be able to use to figure out when the bugs appeared?<br /><br /><div class="quotetitle">Eugene.S wrote:</div><div class="quotecontent">There are different versions of scanline.nes</div>Ah, I wasn't aware there were 2 versions, thanks for pointing that out.  But the version I'm using is definitely supposed to be gray.<br /><br />The contents of the palette RAM doesn't match what I get in Mesen for both the scanline test &amp; DK.<br />My assembly skills are terrible, so I may have messed up, but I expected this to roughly fill palette ram with $01 to $20 (mirroring aside)<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; lda #$3F<br />&nbsp; sta $2006<br />&nbsp; lda #$00<br />&nbsp; sta $2006<br />&nbsp; ldx #$01<br />&nbsp; ldy #$1F<br />loop:<br />&nbsp; stx $2007<br />&nbsp; inx<br />&nbsp; dey<br />&nbsp; bne loop</div><br />Instead I got this: <div class="codetitle"><b>Code:</b></div><div class="codecontent">17 08 09 0A 1B 0C 0D 0E 1F 10 11 12 13 14 15 16<br />17 18 19 1A 1B 1C 1D 1E 1F 00 01 02 13 04 05 06</div>When I look at the trace, I see the PPU setting AB to $3F01 and DB to $01 at one point, which is off by 1 (should be $3F00?) but the content written in the actual RAM doesn't match - it seems to be writing to the AB value that the PPU is set to outside of those &quot;writes&quot; (typically 3F30-3F4Fish range).  So I guess there might be something wrong with palette writes, too (although I would have to test the palette writes on the visual 2C02 to make sure this isn't a bug specific to my code)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186434"></a>
				<b class="postauthor">Alyosha_TAS</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186434">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186434#p186434"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 11, 2017 7:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Jun 15, 2016 11:49 am<br /><b>Posts:</b> 69
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">This is really cool stuff Sour! I'm already impressed at the speed this is running at and what you are getting it to do. I'll definitely be keeping track of the progress and look forward to making use of it.<br /><br />Good Luck!</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7612"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186438"></a>
				<b class="postauthor">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186438">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186438#p186438"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 11, 2017 7:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 3477<br /><b>Location:</b> Mountain View, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">@Sour That code looks fine, but it's not going to write to $3f1f due to the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">dey/bne</tt> causing Y=$00 and the branch to not be taken.  Use of <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bpl</tt> should work (branch will be taken until the negative flag in P is set, which Y going from $00 to $FF will trigger (the branch to no longer be taken)), thus allowing PPU RAM $3f1f=$20.  Sorry for the wording of this paragraph.  :)<br /><br />As for the rest of the PPU RAM values: I'm fairly certain PPU palette mirroring plays a role here (with regards to what values you end up seeing in PPU RAM).  Can't really help with the &quot;internal behaviour&quot; aspect.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186472"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186472">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186472#p186472"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 12, 2017 9:29 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 3110<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Sour wrote:</div><div class="quotecontent"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">There's a bug in the Visual 2C02 OAM DMA: <!-- l --><a class="postlink-local" href="http://forums.nesdev.com/viewtopic.php?p=169373#p169373">viewtopic.php?p=169373#p169373</a><!-- l --> (it does not actually seem to corrupting the source address to 0 always unlike I said in that post, instead it seems to depend on the value written and the hibyte of &quot;ab&quot;: spr_addr = value_written AND hibyte(ab)).</div>Yea, that seems to be what DK is doing - the OAM data matches the zero page.  Isn't the high byte of AB always $40 in this particular scenario?<br />cpow seemed to be convinced these bugs were not there originally - is there any Git/SVN repository available for the Visual 2A03 that I might be able to use to figure out when the bugs appeared?<br /></div><br />IIRC &quot;ab&quot; was related to the value of PC (probably due to the fact that right after the $4014 write the CPU still has time to fetch the first byte of the next instruction before RDY is deasserted by the DMA unit). You can try this by executing <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">LDA #$FF</tt> / <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">STA $4014</tt> at $100. spr_addr should start as $FF and then get corrupted to $01.<br /><br />I don't think there's a repository or change history of Visual 2A03 publicly available, but with some luck Quietust might have one.</div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">Download STREEMERZ for NES from <a href="http://www.fauxgame.com" class="postlink">fauxgame.com</a>! — Some other stuff I've done: <a href="https://fo.aspekt.fi/" class="postlink">fo.aspekt.fi</a></span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186505"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186505">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186505#p186505"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 12, 2017 4:33 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">@Sour That code looks fine, but it's not going to write to $3f1f due to the <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">dey/bne</tt> causing Y=$00 and the branch to not be taken.  Use of <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">bpl</tt> should work (branch will be taken until the negative flag in P is set, which Y going from $00 to $FF will trigger (the branch to no longer be taken)), thus allowing PPU RAM $3f1f=$20.</div>Thanks, that probably explains the $00 value in the palette ram.  Not quite sure why the addresses are wrong though - maybe my test is wrong, considering DK seems to be able to write to the correct indexes (although about half the of values are incorrect in that case)<br /><br /><div class="quotetitle">thefox wrote:</div><div class="quotecontent">I don't think there's a repository or change history of Visual 2A03 publicly available, but with some luck Quietust might have one.</div>I just went ahead and checked on archive.org for both the 2A03 &amp; 2C02 - the oldest copy was from May 1st 2013. The 2A03 had no significant change (all node definitions are unchanged as far as I could tell). The 2C02 had some changes to node definitions, apparently related to sprite position, but that wouldn't explain the DMA bug (since it's a 2A03 issue). Maybe the bug has always been there?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186510"></a>
				<b class="postauthor">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186510">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186510#p186510"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 12, 2017 5:00 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1421
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">One somewhat important thing to consider is that the Visual 2A03 and Visual 2C02 use <strong>slightly different versions</strong> of ChipSim - I believe Visual 2A03 uses the same version as Visual 6502, but Visual 2C02 uses different logic to resolve groups of &quot;floating&quot; nodes (whereby it considers the <em>area</em> of each node to determine whether the group goes high or low) to fix $2007 writes and Sprite DRAM refreshes.<br /><br />Of course, there are also several bugs in the Javascript versions of Visual 2A03/2C02 that I've simply never gotten around to fixing...</div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186522"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186522">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186522#p186522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 12, 2017 8:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Quietust wrote:</div><div class="quotecontent">whereby it considers the <em>area</em> of each node to determine whether the group goes high or low</div>At the moment, both chips use this logic. Do you think the CPU would still run correctly with it, since it's technically just an extra level of precision on the simulation?<br /><br />Also, I decided to try running some CPU test roms to see how it fares:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">branch_timing_tests:<br />&nbsp; 1.Branch_Basics&nbsp; -Pass<br />&nbsp; 2.Backward_Branch&nbsp; -Pass<br />&nbsp; 3.Forward_Branch&nbsp; -Pass<br /><br />instr_misc:<br />&nbsp; 01-abs_x_wrap&nbsp; -Pass<br />&nbsp; 02-branch_wrap&nbsp; -Pass<br /><br />instr_test-v3:<br />&nbsp; 01-implied&nbsp; -Pass<br />&nbsp; 02-immediate&nbsp; -Fail (both 69 ADC #n and E9 SBC #n failed)<br />&nbsp; 10-stack&nbsp; -Pass&nbsp; (This one took 117m half clocks to complete, probably took over an hour to run)<br />&nbsp; 11-jmp_jsr&nbsp; -Pass<br />&nbsp; 12-rts&nbsp; -Pass<br />&nbsp; 13-rti&nbsp; -Pass<br />&nbsp; 14-brk&nbsp; -Pass<br />&nbsp; 15-special&nbsp; -Pass</div>So far it seems pretty good, but not quite perfect. I'll keep running some in the background and try to get through most of the CPU-related tests done eventually (some take a long time to run so it may take a while).  At least that way we'll have an idea of what works and what doesn't. Not sure if that would help in actually finding and fixing bugs, though - and unfortunately, I have very little hope of being able to fix these myself.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186599"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186599">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186599#p186599"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 13, 2017 6:16 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've been running tests for the past 10 hours or so (running 3 copies of the simulator at once).  I didn't run every single test, some take a ridiculously long time to run (1 second test = 1 hour... one of them took about 5-6 hours to complete)<br /><br />The CPU seems to be working correctly in most cases ($4014 writes aside).<br />ADC/SBC (and RRA/ISC which reuse their logic) are bugged (I imagine the &quot;carry&quot; part of the operation might not be working properly?) - this has the potential to break other tests if they are used.<br />The APU seems to be working as well (irq_flag failed, and dmc dma's behavior seems to be slightly incorrect)<br /><br />The PPU is hard to say - with the $4014 bug, sprite-related tests will all fail.<br />The palette RAM test passed, but I'm fairly sure there is something wrong with the palette in general.<br />The background color that gets output seems to always use $3F0F instead of $3F00 (so the lower 4 bits are inverted - incorrect wiring maybe?), among other things.<br /><br />Hopefully these results can eventually be useful in trying to fix the visual 2A03/2C02 - I'm not sure there is anything I can do beyond this, though.<br /><br />Edit: Also updated the download link to include the latest build (better speed, fixes, and some UI improvements)<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">blargg_apu_2005.07.30:<br />&nbsp; 01.len_ctr: Pass<br />&nbsp; 02.len_table: Pass<br />&nbsp; 03.irq_flag: FAIL ($06 - &quot;Writing $00 or $80 to $4017 doesn't affect flag&quot;)<br />&nbsp; 04.clock_jitter: Pass<br />&nbsp; 05.len_timing_mode0: Pass<br />&nbsp; 06.len_timing_mode1: Pass<br />&nbsp; 07.irq_flag_timing: Pass<br />&nbsp; 08.irq_timing: Pass<br />&nbsp; 09.reset_timing: Pass<br />&nbsp; 10.len_halt_timing: Pass<br />&nbsp; 11.len_reload_timing: Pass<br /><br />blargg_ppu_tests_2005.09.15b:<br />&nbsp; palette_ram: Pass<br />&nbsp; power_up_palette: FAIL (expected it to fail)<br />&nbsp; sprite_ram: FAIL ($06 - &quot;$4014 DMA copy doesn't work at all&quot;)<br />&nbsp; vbl_clear_time: Pass<br />&nbsp; vram_access: Pass<br />&nbsp; <br />branch_timing_tests:<br />&nbsp; 1.Branch_Basics: Pass<br />&nbsp; 2.Backward_Branch: Pass<br />&nbsp; 3.Forward_Branch: Pass<br /><br />cpu_interrupts_v2:<br />&nbsp; 1-cli_latency: Pass<br />&nbsp;<br />dmc_dma_during_read4:<br />&nbsp; dma_2007_read: FAIL? (Outputs: 11 22, 11 22, 11 22, 11 22, 33 44 - 4AEFDE12)<br />&nbsp; dma_2007_write: Pass<br />&nbsp; double_2007_read: FAIL? (Outputs: 22 33 44 55 66, 02 33 44 55 66, 31D9ED83)<br />&nbsp; read_write_2007: Pass<br /><br />instr_misc:<br />&nbsp; 01-abs_x_wrap: Pass<br />&nbsp; 02-branch_wrap: Pass<br />&nbsp; 03-dummy_reads: Pass<br />&nbsp; 04-dummy_reads_apu: Pass<br /><br />instr_test-v3:<br />&nbsp; 01-implied: Pass<br />&nbsp; 02-immediate: FAIL (69 ADC, E9 SBC)<br />&nbsp; 03-zero_page: FAIL (65 ADC, E5 SBC, 67 RRA, E7 ISC)<br />&nbsp; 04-zp_xy: FAIL (75 ADC, F5 SBC, 77 RRA, F7 ISC)<br />&nbsp; 05-absolute: FAIL (6D ADC, ED SBC, 6E RRA, EF ISC)<br />&nbsp; 06-abs_xy: FAIL (7D ADC, 79 ADC, FD SBC, F9 SBC, 7F RRA, FF ISC, 7B RRA, FB ISC)<br />&nbsp; 07-ind_x: FAIL (61 ADC, E1 SBC, 63 RRA, E3 ISC)<br />&nbsp; 08-ind_y: FAIL (F1 SBC, 71 ADC, 73 RRA, F3 ISC)<br />&nbsp; 09-branches: Pass<br />&nbsp; 10-stack: Pass<br />&nbsp; 11-jmp_jsr: Pass<br />&nbsp; 12-rts: Pass<br />&nbsp; 13-rti: Pass<br />&nbsp; 14-brk: Pass<br />&nbsp; 15-special: Pass<br />&nbsp; <br />oam_read: FAIL (Displays mostly stars)<br /><br />ppu_sprite_hit:<br />&nbsp; 01-basics: FAIL (&quot;Flag isn't working at all&quot; - Most likely caused by broken $4014 writes)<br /><br />ppu_sprite_overflow:<br />&nbsp; 01-basics: FAIL (&quot;Should clear flag at end of VBL&quot; - Not sure what is causing this)<br />&nbsp; <br />read_joy3:<br />&nbsp; count_errors_fast: FAIL (because no controller is connected - need to emulate a standard controller and try again)<br />&nbsp; <br />test_apu_2:<br />&nbsp; test_1: Pass<br />&nbsp; test_2: FAIL (might be normal - apparently can also fail on NES based on cpu-ppu alignment)<br />&nbsp; test_3: Pass<br />&nbsp; test_4: Pass<br />&nbsp; test_5: Pass<br />&nbsp; test_6: FAIL (not sure if this is normal - test 6 was originally affected by alignment, but it sounded like it was fixed?)<br />&nbsp; test_7: Pass<br />&nbsp; test_8: Pass<br />&nbsp; test_9: Pass<br />&nbsp; test_10: Pass<br />&nbsp; test_11: Pass</div><br />The OAM read test looked like this:<br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=7573" alt="oamread.png" /><br />
			<span class="gensmall">oamread.png [ 18.12 KiB | Viewed 1509 times ]</span>
		

		<br />
	</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186602"></a>
				<b class="postauthor">koitsu</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186602">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186602#p186602"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 13, 2017 7:17 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3.png" width="100" height="75" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 9:28 pm<br /><b>Posts:</b> 3477<br /><b>Location:</b> Mountain View, CA
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">All the ADC/SBC operations failing is interesting.  Quite possibly someone didn't implement twos-complement correctly?  These two opcodes are the #1 pain point, opcode-wise, for emulator authors.  Just the first thing that comes to mind.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186604"></a>
				<b class="postauthor">Quietust</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186604">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186604#p186604"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 13, 2017 7:52 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=7.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 10:59 pm<br /><b>Posts:</b> 1421
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">koitsu wrote:</div><div class="quotecontent">All the ADC/SBC operations failing is interesting.  Quite possibly someone didn't implement twos-complement correctly?  These two opcodes are the #1 pain point, opcode-wise, for emulator authors.  Just the first thing that comes to mind.</div><br />There's one distinct possibility: as I originally mentioned when I released the Visual 2A03, the 6502 core I used is a direct copy of the Visual 6502 which has <strong>working decimal mode</strong>, so if the D flag somehow got set, then I would expect lots of ADC/SBC test failures.</div>

					
						<div class="postbody"><br />_________________<br />Quietust, QMT Productions
<br />P.S. If you don't get this note, let me know and I'll write you another.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186608"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186608">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186608#p186608"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 13, 2017 11:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">The decimal flag isn't set at startup, and the tests don't set it anywhere in their code - so it doesn't look like that would be it.<br /><br />I just spent 30+ minutes trying a lot of combinations of ADC #$xx (with and without the carry flag set) and couldn't find any that didn't set the flags as expected or gave the wrong result..  I think I'll try to recompile blargg's test with only the ADC portion of the test, trace the value of A and the flags at each step &amp; then compare that with an emulator's trace.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186623"></a>
				<b class="postauthor">thefox</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186623">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186623#p186623"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jan 14, 2017 7:18 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=80.png" width="100" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Jan 03, 2005 10:36 am<br /><b>Posts:</b> 3110<br /><b>Location:</b> Tampere, Finland
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Sour wrote:</div><div class="quotecontent">The decimal flag isn't set at startup, and the tests don't set it anywhere in their code - so it doesn't look like that would be it.</div><br />Make sure it also doesn't get set by PLP. It really does seem like the most likely culprit in this case.<br /><br />(How difficult would it be to disable the decimal mode in Visual 6502 in the same way that they disabled it in 2A03? Wasn't it something like one wire cut or a transistor removed?)</div>

					
						<div class="postbody"><br />_________________<br /><span style="font-size: 85%; line-height: normal">Download STREEMERZ for NES from <a href="http://www.fauxgame.com" class="postlink">fauxgame.com</a>! — Some other stuff I've done: <a href="https://fo.aspekt.fi/" class="postlink">fo.aspekt.fi</a></span></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=80"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p186625"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186625">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186625#p186625"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jan 14, 2017 7:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">thefox wrote:</div><div class="quotecontent">Make sure it also doesn't get set by PLP. It really does seem like the most likely culprit in this case.</div>And it looks like you're probably correct - forgot that was even possible.<br />The test roms seem to be doing this at some point:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda #$FF<br />sta in_p<br />&#91;...&#93;<br />lda in_p<br />pha<br />&#91;...&#93;<br />plp</div>So it's pretty likely the decimal flag is on during some of the tests (although &quot;cld&quot; is called at one point in the code).<br />I'll replace the $FF with $F7 in the rom and see if that changes anything.<br /><br />According to <a href="http://visual6502.org/wiki/index.php?title=6502DecimalMode#Decimal_mode_and_the_NES.27_RP2A03G" class="postlink">this</a>, it sounds like removing transistors t1329, t3212, t2750, t2202 and t2256 would replicate the 2A03's modifications.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p186672"></a>
				<b class="postauthor">Sour</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p186672">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=186672#p186672"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Sat Jan 14, 2017 4:57 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Feb 07, 2016 6:16 pm<br /><b>Posts:</b> 481
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=7578" alt="immediate.png" /><br />
			<span class="gensmall">immediate.png [ 20.48 KiB | Viewed 1409 times ]</span>
		

		<br />
	</div><br />Progress?  Sort of...<br /><br />I've forced all 5 transistors mentioned above to be &quot;on&quot; at all times (this is what the link said the 2A03's modifications did) and this is what I'm getting now - the official opcodes pass, but now these unofficial ones apparently don't (I've only tried this test though, since it completes in about an hour, vs 4+ for some of the others).<br /><br />I had hacked up blargg's test before trying this to make sure the instructions were always performed with the decimal flag off, and that version of the test actually gave me the same result (I think - unfortunately did not save the result screen from that) - so I guess decimal mode is actually correctly disabled by this, but then why do these break when decimal mode is off is another story.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=7406"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p187056"></a>
				<b class="postauthor">fred</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p187056">Re: Visual Nes - C++/C# port of Visual 2A03 + 2C02</a></div><div style="float: right;"><a href="./viewtopic.php?p=187056#p187056"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Jan 18, 2017 8:19 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Dec 30, 2011 7:15 am<br /><b>Posts:</b> 44<br /><b>Location:</b> Sweden
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Since the wiki says it takes 2-3 and 3-4 cpu cycles for the sequencer counter to reset, i tried to see if i could find out with visual nes. Also if half and quarter frames are delayed or not.<br />I'm not very good at using visual nes or especially operating the apu, but here goes...<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">test:<br />lda 0x0F<br />sta 0x4000 //set volume / envelope to 15 to see when it decreases<br />lda 0x80<br />sta 0x4017 //restart things<br />jmp test<br /><br /><br />Cpu cycles, starting from the write cycle in STA 0x4017:<br /><br />0: Write to 0x4017<br />1: Read<br />2: Read* (happens if write was or wasn't on an apu cycle, probably if it wasn't)<br />3: Read - cpu_frm_half and cpu_frm_quarter goes low, cpu_sq0_envt3-0 decrements<br />4: Read - cpu_'frm_/tXX' resets</div><br /><span style="font-size: 85%; line-height: normal">If I shouldn't post random visual nes testing in this topic, tell me haha...</span><br /><br /><br />So I guess that's 2-3 cpu cycles of delay until half and quarter frames resets? The sequencer counter, if I even logged the correct thing, resets one cycle later instead of doing some kind of increment.<br />I'm incrementing the sequencer counter every cpu cycle, resetting the counter instead of / and incrementing at the same time as half &amp; quarter frames should work in that case, I think. I say &quot;instead of / and&quot; because resetting *and* incrementing makes my emulator pass blargg's apu jitter test, but that doesn't really mean much.<br /><br />I also tried &quot;asl 0x4017&quot; just because, it seems to write back 0xFF which wasn't what I was expecting (0x80?) but should work anyway. It doesn't toggle cpu_frm_half and cpu_frm_quarter. It seems to reset the counter based on the first write, which would make sense.<br /><br />---<br /><br />The download link has a typo, btw! &quot;VisualNEs.zip&quot;</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=5139"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=3&amp;t=15334&amp;start=30"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=3"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=3&amp;t=15334"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>3</strong> of <strong>4</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 50 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to page…">Go to page</a> <a href="./viewtopic.php?f=3&amp;t=15334&amp;start=15">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=3&amp;t=15334">1</a><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=15334&amp;start=15">2</a><span class="page-sep">, </span><strong>3</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=3&amp;t=15334&amp;start=45">4</a> &nbsp;<a href="./viewtopic.php?f=3&amp;t=15334&amp;start=45">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=3">NESemdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=9370">JonteP</a> and 7 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="15334" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3" selected="selected">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="34">&nbsp; &nbsp;&nbsp; &nbsp;2018 NESdev Competition</option>
		
			<option value="33">&nbsp; &nbsp;&nbsp; &nbsp;2017 NESdev Competition</option>
		
			<option value="32">&nbsp; &nbsp;&nbsp; &nbsp;2016 NESdev Competition</option>
		
			<option value="31">&nbsp; &nbsp;&nbsp; &nbsp;2014 NESdev Competition</option>
		
			<option value="30">&nbsp; &nbsp;&nbsp; &nbsp;2011 NESdev Competition</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Reproduction</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="11">&nbsp; &nbsp;&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="12">&nbsp; &nbsp;&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;&nbsp; &nbsp;GBDev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>


<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61452025-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - 8x16 and whatever else unreg wants to know</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">8x16 and whatever else unreg wants to know</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7451">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=7451</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>11</strong> of <strong>83</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Wed Jun 29, 2011 4:25 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">That depends on how your assembler outputs listing or map files.</div>WOAH WOW! LISTING FILES RULE!  <img src="./images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" />  Thank you!!<br /><br /><div class="quotetitle">qbradq wrote:</div><div class="quotecontent">What I usually do is put in a dummy instruction and set a breakpoint on that. In Nintendulator you can tell it to break when a certain address is read or written to.<br /><br />I usually do a bit $0100 to read from the last byte of the stack, something that does not normally happen in my programs. I stick that instruction in wherever I want a break, then set the break point to Read $0100.</div>Thank you qbradq! <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Thu Jun 30, 2011 6:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />In NintendulatorDX you can also input the function name in the debug watch window (given that your assembler is capable of spitting out a compatible debug file) and set breakpoint on that. In NESICIDE you can simply click on the left hand margin to set a breakpoint (again, if you have the debug info).
<br />
<br />BTW, it probably wouldn't be too hard to add debug file support to ASM6/NESASM.. the debug file format is pretty much self explanatory (and if there are problems, I can help). Any takers?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Thu Jun 30, 2011 7:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I could look into this, although <a href="https://sites.google.com/site/qbradq/projects-1/qasm" class="postlink">QASM</a> is coming along nicely <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Which one do you think would be more worth-while to start with?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Thu Jun 30, 2011 7:51 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">qbradq wrote:</div><div class="quotecontent">I could look into this, although <a href="https://sites.google.com/site/qbradq/projects-1/qasm" class="postlink">QASM</a> is coming along nicely <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Which one do you think would be more worth-while to start with?</div>
<br />Probably ASM6, but I don't know. Probably going to be an unthankful job for anybody who's not using the said assemblers themselves. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Thu Jun 30, 2011 8:08 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />---
<br />This question is to anyone.  (Sorrry to interrupt yall's conversation. <img src="./images/smilies/icon_sad.gif" alt=":(" title="Sad" /> ) 
<br />
<br />Does the controller work during the step through?  I can't tell, it's all much to learn, and I'm going to learn it.  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  edit: I'm using a regular nintendo controller with a nes-to-usb adapter that i bought <a href="http://www.retrousb.com" class="postlink">here</a>.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Thu Jun 30, 2011 8:10 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Everything should work through step throughs. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Jun 30, 2011 8:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">unregistered wrote:</div><div class="quotecontent">Does the controller work during the step through?</div>
<br />In theory, yes. In practice, some emulators might ignore button presses while the emulator's video output window (the one with the game in it) is not focused, causing buttons to read as not pressed or as stuck if you Run several frames in the debugger. This behavior of ignoring presses to an unfocused has little to do with whether you're using a keyboard, a PC game controller, an NES controller through a retrousb.com adapter, or a Nintendo 64 controller through an Adaptoid adapter (what I use), and more to do with how Windows handles input focus.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Thu Jun 30, 2011 8:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I have a rough time getting Nintendulator to do this. When I need to debug a program's input handling I usually add a small test to fake a conditional breakpoint.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; lda control_state<br />&nbsp; beq skip_break<br />&nbsp; &nbsp; bit $0100<br />skip_break:</div>
<br />
<br />And I set a breakpoint for reads to $0100. That way the emulator breaks the next time I press a button, and I can single-step through my handling of it.
<br />
<br />It's little tricks like this that need to be documented somewheres <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>thefox</b> [ Thu Jun 30, 2011 9:24 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />The only fix for the focus problem I know is to focus the main window and then step using Shift+F2 or whatever the shortcut for step was. This way the controller keys can be held down simultaneously, altho it's a bit awkward.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Thu Jun 30, 2011 9:32 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Wouldn't the keys need to be held down at the start of the frame though? Or do we get the state of the keyboard the instant we strobe $4016 in Nintendulator?
<br />
<br />I was trying to do frame advance mode, hold down the buttons I needed, use Space Bar to advance a frame, then step into my controller code. Never worked right for me.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Thu Jun 30, 2011 9:47 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Well, the controller correctly reads 8, 4, 2, or 1 for the first hex number and 0 for the last hex number.  Something is not working, but it's all good cause God and I can figure it out! <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  Yall are so helpfull, thanks 3gengames, tepples, and qbradq.  <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />  I'lm going to  try doing it your way now qbradq...    
<br />
<br />Oh, before that there's something else I wanted to share.  tepples, I did rearange what the buttons do and it seemed to me, yesterday, that the code I added below BUTTON_UP didn't work for me then; it kindof did... it incremented the aFrame... but incorrectly.  After two presses of the Up button it went through all our frames (which is definitly more than 2 frames).  <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" />  The updownleftright pad must repeatedly be pressed over and over... like turbo?
<br />
<br />edit: Thank you to thefox too! <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>qbradq</b> [ Thu Jun 30, 2011 10:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Maybe your controller reading routine is a bit off? I dunno, I have a hard time groking all of the binary xor'ing stuff that's required. I haven't touched my controller library in ages <img src="./images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />
<br />
<br />I've been scolded once before for posting incomplete controller polling routines, so I'll include my entire library. It's in <a href="https://sites.google.com/site/qbradq/projects-1/qasm" class="postlink">QASM</a> syntax, so you'd have to change it a little bit to work with other assemblers, but it's very well tested and works reliably. As a bonus it calculates what was just pressed this frame and what was just released this frame as well.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">; Control pad library, for player 1 only<br /><br /><br />.scope control<br /><br /><br />; Button bits<br />; abltudlr<br />; |||||||+- DPad Right<br />; ||||||+-- DPad Left<br />; |||||+--- DPad Down<br />; ||||+---- DPad Up<br />; |||+----- Start<br />; ||+------ Select<br />; |+------- B Button<br />; +-------- A Button<br />.equ abutton&nbsp; &nbsp;%10000000<br />.equ bbutton&nbsp; &nbsp;%01000000<br />.equ select&nbsp; &nbsp;&nbsp; &nbsp;%00100000<br />.equ start&nbsp; &nbsp;&nbsp; &nbsp;%00010000<br />.equ dpadup&nbsp; &nbsp;&nbsp; &nbsp;%00001000<br />.equ dpaddown&nbsp; &nbsp;%00000100<br />.equ dpadleft&nbsp; &nbsp;%00000010<br />.equ dpadright&nbsp; &nbsp;%00000001<br /><br /><br />; Control pad registers<br />.equ reg_pad1&nbsp; &nbsp;$4016<br />.equ reg_pad2&nbsp; &nbsp;$4017<br /><br /><br />; Globals<br />.segment zeropage<br />&nbsp; &nbsp;.res pressed 1&nbsp; &nbsp;&nbsp; &nbsp;; If a bit is set in this register the button was just pressed this frame<br />&nbsp; &nbsp;.res released 1&nbsp; &nbsp;&nbsp; &nbsp;; If a bit is set in this register the button was just released this frame<br />&nbsp; &nbsp;.res state 1&nbsp; &nbsp;&nbsp; &nbsp;; If a bit is set in this regsiter the button is currently down<br />.endsegment<br /><br /><br />; Updates the controller states<br />.proc update<br />&nbsp; &nbsp;; Locals<br />&nbsp; &nbsp;.segment ram<br />&nbsp; &nbsp;&nbsp; &nbsp;.res previous_controler_state 1&nbsp; &nbsp;; The value of state from the previous frame<br />&nbsp; &nbsp;.endsegment<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;; Cycle controller states<br />&nbsp; &nbsp;lda&nbsp; &nbsp;state<br />&nbsp; &nbsp;sta&nbsp; &nbsp;previous_controler_state<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;; Strobe the controler port<br />&nbsp; &nbsp;ldx&nbsp; &nbsp;#$09<br />&nbsp; &nbsp;stx&nbsp; &nbsp;reg_pad1<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;stx&nbsp; &nbsp;reg_pad1<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;; Read control port data<br />loop:<br />&nbsp; &nbsp;lda&nbsp; &nbsp;reg_pad1<br />&nbsp; &nbsp;lsr&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; bit0 -&gt; Carry<br />&nbsp; &nbsp;rol&nbsp; &nbsp;state&nbsp; &nbsp;; bit0 &lt;- Carry<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;bne loop<br /><br />&nbsp; &nbsp;; Compute pressed<br />&nbsp; &nbsp;lda&nbsp; &nbsp;previous_controler_state<br />&nbsp; &nbsp;eor&nbsp; &nbsp;#$ff<br />&nbsp; &nbsp;and&nbsp; &nbsp;state<br />&nbsp; &nbsp;sta&nbsp; &nbsp;pressed<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;; Compute released<br />&nbsp; &nbsp;lda&nbsp; &nbsp;state<br />&nbsp; &nbsp;eor&nbsp; &nbsp;#$ff<br />&nbsp; &nbsp;and&nbsp; &nbsp;previous_controler_state<br />&nbsp; &nbsp;sta&nbsp; &nbsp;released<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;rts<br />.endproc<br /><br /><br />.endscope<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Fri Jul 01, 2011 9:34 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">qbradq wrote:</div><div class="quotecontent">I have a rough time getting Nintendulator to do this. When I need to debug a program's input handling I usually add a small test to fake a conditional breakpoint.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; lda control_state<br />&nbsp; beq skip_break<br />&nbsp; &nbsp; bit $0100<br />skip_break:</div><br /><br />And I set a breakpoint for reads to $0100. That way the emulator breaks the next time I press a button, and I can single-step through my handling of it.</div>
<br />
<br />How does that work?  It didnt for me.  I understand now though how inserting <span style="color: violet">bit $0100</span> and setting a breakpoint for a read from $0100 is done, thanks <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />, but I dont see how these 4 lines of  code  here  make the emulator break every time a button is pressed.   <img src="./images/smilies/icon_confused.gif" alt=":?" title="Confused" />  Am I susposed to figure that part out for myself?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>3gengames</b> [ Fri Jul 01, 2011 9:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Go to the debugger, and set a break point for every time it reads/write from/to that location in memory, it won't do anything with your game [besides possibly mess it up] unless you use the debugger. When it hits the read/write from that location, it'll stop, allowing you to step through your code there.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>unregistered</b> [ Fri Jul 01, 2011 9:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">3gengames wrote:</div><div class="quotecontent">Go to the debugger, and set a break point for every time it reads/write from/to that location in memory, it won't do anything with your game [besides possibly mess it up]...</div>
<br />It reads $0100 and then writes twice to the status register, right?  That's pretty safe, to me. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>11</strong> of <strong>83</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
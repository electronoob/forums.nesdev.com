<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Some PPU Questions</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Some PPU Questions</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=2864">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=2864</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Thu Jan 11, 2007 4:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It may not be "allowed", but you can do it, so the question is simply what happens when you do it. In emulation, do or do not do; there is no try. <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Thu Jan 11, 2007 6:18 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">What Bregalad described actually does put CHR ROM on the cartridge, part of a shared ROM.</div><br />That's not what I understood...<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">A real exception would be to somehow make the PPU use the internal pattern table memory for pattern data as well.</div>
<br />I though that's what he meant... force 1-screen mirroring and use the memory normally used for the other nametable for pattern data. I don't see how that qualifies as "CHR as part a shared ROM"...
<br />
<br />I will read what he wrote again though... O_o

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Thu Jan 11, 2007 6:59 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Oh, sorry, I guess I skimmed over the linked thread. Nifty what he describes, then. I was remembering another thread where I think they mentioned the PPU using the PRG ROM or maybe PRG RAM or something.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Fri Jan 12, 2007 9:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, what I said was actually use 1kb of <em>internal</em> RAM as pattern table data, and forcing 1-screen mirroring. That would be pretty much equivalent of mapper 7 with only 64-tiles available (mirrored 8 times) instead of 512.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Fri Jan 12, 2007 12:21 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">That would be pretty much equivalent of mapper 7 with only 64-tiles available (mirrored 8 times) instead of 512.</div>
<br />
<br />Well.. that and only having one nametable instead of 2  ;P.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>kyuusaku</b> [ Fri Jan 12, 2007 12:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Or PRG switching.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sat Jan 13, 2007 9:28 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Sorry but none of that answers my question. What I mean is, when the Name Table Byte is fetched, does the NES remember which Name Table it came from or, if the PPU address is changed immediately after the fetch, will that affect the following fetches? (attribute + 2 bitmap).
<br />
<br />So if a cartridge has no VROM, then it must have $2000 worth of VRAM on the cartridge?
<br />
<br />Btw, hap I've looked at the colour intensity charts that you provided me with and I just wanted to make sure of one thing. I've got the same values in my emulator, but I think that I've go the red and blue values the wrong way round. How accurate was you chart?
<br />
<br />I also read somewhere that the Shift Registers are shifted right on every clock cycle. Is that 0-255 or 0-340?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>hap</b> [ Sat Jan 13, 2007 10:05 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Btw, hap I've looked at the colour intensity charts that you provided me with and I just wanted to make sure of one thing. I've got the same values in my emulator, but I think that I've go the red and blue values the wrong way round. How accurate was you chart?</div>Works fine here..
<br />emphasis_factor[x][y]
<br />x=PPU2001&gt;&gt;5
<br />y=factor for colour channel  (0: red, 1: green, 2: blue)
<br />
<br />You might already know this, but a good colour emphasis emulation test is Loopy's "PALTEST" ( <!-- m --><a class="postlink" href="http://nesdev.com/paltest.zip">http://nesdev.com/paltest.zip</a><!-- m --> ), hold button(s) for effects:
<br />B: PPU2001.6 (green)
<br />A: PPU2001.5 (red)
<br />select: PPU2001.0 (mono)
<br />start: PPU2001.7 (blue)

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Sat Jan 13, 2007 12:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Sorry but none of that answers my question. What I mean is, when the Name Table Byte is fetched, does the NES remember which Name Table it came from or, if the PPU address is changed immediately after the fetch, will that affect the following fetches? (attribute + 2 bitmap).</div><br /><br />I don't think anyone knows for sure as it's extremely difficult to test this (the PPU is just clocked too fast for the CPU to reliably land between those  fetches).  This is one of those trifling things that I wouldn't worry about too much (or even at all) -- as a PPU address change mid-scanline will cause a bit of distortion anyway -- failing to emulate this 100% accurately will result in no worse than 8 pixels of miscoloration that won't be humanly noticable.<br /><br />As for some pure speculation on what happens (I'm shooting in the dark here):<br /><br />- before each NT/attribute/pattern read, the PPU updates the address lines on the bus.<br /><br />- the second $2006 write also updates the bus with the new PPU address.  (I would assume -- since MMC3 watches A12 on the bus and can see when it changes via $2006 writes -- so logically the second $2006 write puts the address on the bus).<br /><br />So whether or not the new written address is used for the attribute fetch or  the "normal" address is used depends on whether or not the $2006 write was completed after the PPU updated the bus (probably at the end of cycle 2 -- where the attribute byte is read on cycle 3)<br /><br />There's also the possibility of a conflict happening where two things are trying to change the bus at once, resulting in potentially largly unpredictable results.<br /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So if a cartridge has no VROM, then it must have $2000 worth of VRAM on the cartridge?</div><br /><br />Well theoretically it is possible for a game to have no CHR at all and to just have open bus for the pattern tables... but that wouldn't be very useful.  So typically yeah -- games without CHR-ROM will have at least 8k CHR-RAM.  But anything is possible<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I also read somewhere that the Shift Registers are shifted right on every clock cycle. Is that 0-255 or 0-340?</div>
<br />
<br />I would guess every cycle except for cycles 336-340.  But really it doesn't matter -- since there's no way for any part of the NES to see what's in the shift registers at any time except for pixel output -- so as long as you output the desired pixel at the desired time, it doesn't matter how you emulate the shift registers.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sat Jan 13, 2007 12:15 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Disch wrote:</div><div class="quotecontent">But really it doesn't matter -- since there's no way for any part of the NES to see what's in the shift registers at any time except for pixel output -- so as long as you output the desired pixel at the desired time, it doesn't matter how you emulate the shift registers.</div>
<br />This is getting into emulation accuracy areas that are absurd to emulate, but it really might matter if you're turning rendering on and off at various points in a scanline. Good luck motivating anyone to run tests on a NES to determine and verify this kind of detail.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Sat Jan 13, 2007 12:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Disch wrote:</div><div class="quotecontent"><div class="quotetitle">WedNESday wrote:</div><div class="quotecontent">Sorry but none of that answers my question. What I mean is, when the Name Table Byte is fetched, does the NES remember which Name Table it came from or, if the PPU address is changed immediately after the fetch, will that affect the following fetches? (attribute + 2 bitmap).</div><br />I don't think anyone knows for sure as it's extremely difficult to test this (the PPU is just clocked too fast for the CPU to reliably land between those  fetches).  This is one of those trifling things that I wouldn't worry about too much (or even at all) -- as a PPU address change mid-scanline will cause a bit of distortion anyway -- failing to emulate this 100% accurately will result in no worse than 8 pixels of miscoloration that won't be humanly noticable.</div>
<br />Anything that can cause a transparent pixel to become opaque or vice versa will affect sprite 0.
<br />
<br />As for motivation, programs might use this as a form of hardware authentication to block use of a program on emulators (as in "Demotronic" for PC) or to block use of a program on another company's famiclones.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sat Jan 13, 2007 1:59 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent"><div class="quotetitle">Disch wrote:</div><div class="quotecontent">But really it doesn't matter -- since there's no way for any part of the NES to see what's in the shift registers at any time except for pixel output -- so as long as you output the desired pixel at the desired time, it doesn't matter how you emulate the shift registers.</div><br />This is getting into emulation accuracy areas that are absurd to emulate, but it really might matter if you're turning rendering on and off at various points in a scanline. Good luck motivating anyone to run tests on a NES to determine and verify this kind of detail.</div>
<br />
<br />Hint! Hint!...
<br />
<br />When the PPU fetches two NT tiles at the end of each scanline, it loads the Shift Registers with the necessary data. Of course, when the SR's are updated for the second time, the data from the first fetch must have been shifted right eight times, otherwise the second fetch will overwrite the first.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Zepper</b> [ Sat Jan 13, 2007 7:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Well theoretically it is possible for a game to have no CHR at all and to just have open bus for the pattern tables... but that wouldn't be very useful. So typically yeah -- games without CHR-ROM will have at least 8k CHR-RAM. But anything is possible</div>
<br />
<br />As far as I know, it's perfectly possible to have nothing in the VRAM, or garbage. On other side, you can write a single demo ROM that writes only 2 tiles into VRAM and display a crazy nametable. Even the PRG banks are not 2000h long, there are games that bankswitches a 1000h bank long... <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />
<br />
<br />About the unanswered question, well... you could write your own demo and run it in any emulator (yeah, the real thing isn't needed anyways for this case) and see what happens, as color distortion or a graphical glitch.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>WedNESday</b> [ Sun Jan 14, 2007 4:28 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="codetitle"><b>Code:</b></div><div class="codecontent">At the start of a new tile fetch phase &#40;every 8 cc's&#41;, both latched pattern <br />table bitmaps are loaded into the upper 8-bits of 2- 16-bit shift registers <br />&#40;which both shift right every clock cycle&#41;.</div>
<br />
<br />That would make 32 times per scanline (minus the end two). But at which cycle (0, 1, 2) are the shift registers updated?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Disch</b> [ Mon Jan 15, 2007 11:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I would think it would have to be on whatever cycle leaves the top 8 bits "empty" and the previously loaded tile in the low 8 bits.  So either cycle 7 after the shift regs are shifted -- or cycle 0 before they're shifted?
<br />
<br />If I had to guess -- I'd say cycle 7.  Then again that doc says "at the start" -- so maybe it's cycle 0.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
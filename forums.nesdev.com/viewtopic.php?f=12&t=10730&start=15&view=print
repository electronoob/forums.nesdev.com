<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - spca65</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">spca65</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=12&amp;t=10730">http://forums.nesdev.com/viewtopic.php?f=12&amp;t=10730</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>byuu</b> [ Wed Nov 27, 2013 11:03 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">That's unfortunate, I'm going to start programming the spc700 soon enough so I think I'll give bass v13 a shot. The only emulator I know of that has spc700 debugging is no$sns, you can switch the view in one of the menus.</div><br /><br />I do still need to produce a classic SPC700 mnemonic table for bass; for right now I only have the 6502-like syntax. Of course you can make your own mnemonic table, but I'd like to offer a classical one anyway so you don't have to.<br /><br />As for the debugger, many versions of bsnes have had that when the debugger was around. I'm currently working on a new debugger that'll be console-based. The hope is to avoid the inevitable GUI crunch that bogs down every debugger I try and design (eg trying to keep track of twelve window states at the same time so that you can't do certain things while another action is taking place.)<br /><br />Will be a few months, though.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Wed Nov 27, 2013 12:20 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think tepples' idea for a 6502 syntax for the SPC700 is so code can literally be moved between the two without any changes in logic, only interface at the edges.<br /><br />I've used wla for spc700 and gb-z80 and will be extremely happy to never touch it again. Every turn I was encountering bugs, inconsistent behavior, and counter-intuitive design (often it was hard to tell whether it was intentionally broken or a bug). I will also welcome being able to use a common set of assembler features across those platforms.  I don't care that you like wla. Those of you who use it have taken plenty of opportunities to make it clear. Use it. I'm not trying to stop you. But please don't try to tell me that I didn't encounter tons of bugs or that I shouldn't work on a better assembler for anyone who wants it.<br /><br />My experience with wla is one reason I'm so amazed that ca65's macro package has stood up to reimplementing another instruction set without throwing up every step of the way. I figured tepples would encounter several show-stopping bugs in trying to do so, ones that would require days or more to fix, and require major design changes to the assembler.<br /><br />EDIT: strolled through my collection of wla bugs. Oh yeah, will be soooo happy to never touch it again.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Thu Nov 28, 2013 9:56 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I'm gonna guess that you're not happy with WLA, blargg.  What kinds of bugs does it have?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Nov 28, 2013 11:57 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">doppelganger wrote:</div><div class="quotecontent">I'm gonna guess that you're not happy with WLA, blargg.  What kinds of bugs does it have?</div><br />I already answered to this question, just read my previous post.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Thu Nov 28, 2013 12:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Perhaps doppelganger was asking for clarification on your previous post. I am too:<br /><br /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">First you have to define ROM and RAM sections despite the fact that the SPC700 only has RAM (and a small IPL ROM that you can't program anyways).</div><br />PCs are like the SPC700 in that all code runs in RAM other than the IPL. Toolchains for PCs use the same model as ca65 with code, rodata, data, and bss sections. I imagine some of this has to do with memory protection, where some segments are writable and others trigger a segfault upon accidental write. In fact, some operating systems even disallow execution of any writable page to prevent an attacker from running arbitrary code through a buffer overflow in the stack or heap.<br /><br /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">it will randomly generate garbage instead of the instructions you told it to generate.</div><br />Test cases would be appreciated.<br /><br />You mentioned byuu's spcas. A Google search for that led me to the page for bass, which appears oriented more toward patching than toward creating original work. Is spcas part of bass now the way bsnes is part of higan?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>doppelganger</b> [ Thu Nov 28, 2013 12:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I was seeking clarification specifically on the bugs that blargg found, as I've noticed blargg goes a bit more technical than the average nesdevver (sp?).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Thu Nov 28, 2013 3:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah sorry. You should have asked for clarification directly.<br /><br />ROM section is no huge issue, I agree, but the main problem is with the name itself. &quot;Read-only RAM section&quot; would be more appropriate. In the SPC700 you're always producing a 64kb file so the WLA model works, but for the C64 you'd want the size of the file to be equal to the size of the program, and this is simply impossible with WLA.<br /><br />If you want to produce an actual .bin size to include in a SNES project (where the SPC code will be updated from the main CPU through the IPL ROM progam) then WLA's model would fail, as you'd also want the .bin size to be equal to the size of the program, not the max size you reserved for it.<br /><br />As for the bugs triggered in WLA, well I lost the source code of my sound engine, I only have the SPC file left, but I remember that something like adding an instruction could make the program crash because it would suddently add a dozen of dummy bytes in the binary file which have nothing to do with the instruction you wrote. This was a very chaotic behaviour, not something consistent. Something you really don't wan to see when you're developing code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Nov 29, 2013 12:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Finally ready to post what I've got. First, SPC-700 assembly using ca65:<br /><br /><a href="http://blargg.8bitalley.com/snes/spc-ca65-0.1.0.zip" class="postlink">spc-ca65-0.1.0.zip</a><br /><br />Then, 65C02 syntax for SPC-700:<br /><br /><a href="http://blargg.8bitalley.com/snes/spc65-0.1.0.zip" class="postlink">spc65-0.1.0.zip</a><br /><br />And, a buildable source code example using it that plays a chord using the SPC-700:<br /><br /><a href="http://blargg.8bitalley.com/snes/spc-chord.zip" class="postlink">spc-chord.zip</a><br /><br />These use cc65-2.13.3, the last stable release I could find. Both include scripts to run full instruction tests. There are lots of notes with them, so I'm just summarizing the points worth discussing. The SPC-700 macros include an option to use ca65-style addressing, where it defaults to absolute rather than direct-page (&lt; gives direct-page). ! can also be used. The one addressing mode I couldn't get to work as specified is memory.bit, where bit must be in parenthesis if it uses a named constant, as ca65 thinks it's a . directive otherwise:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; mov1 c, $1412.7&nbsp; &nbsp;; OK<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; bitnum = 6<br />&nbsp; &nbsp; mov1 c, $1412.bitnum&nbsp; &nbsp;; error<br />&nbsp; &nbsp; mov1 c, $1412.(bitnum) ; OK: workaround<br /></div><br />I hope I got the syntax right for these addressing modes:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; CALL !abs&nbsp; ; ! really required even though it only supports abs?<br />&nbsp; &nbsp; TCALL $x&nbsp; &nbsp; ; 0-15<br />&nbsp; &nbsp; PCALL $xx&nbsp; &nbsp;; 0-$FF, calls $FF00 + $xx<br />&nbsp; &nbsp; MOV1 C, mem.bit<br />&nbsp; &nbsp; AND1 C, /mem.bit ; the slash for AND with complement of memory bit?<br /></div><br />The 65C02 macros coexist with the SPC-700 instruction syntax, for easy use of both styles of code in the same progam, as when including SPC-700 libraries and using 65C02 syntax in your code:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">and ($12),y&nbsp; &nbsp; ; OK<br />and a, &#91;$12&#93;+y ; OK<br /></div><br />I consider automatic use of direct-page addressing an optimization issue, since you can use &lt; where it's critical, thus haven't looked at the patched ca65 yet.<br /><br />PLA, PLX, and PLY don't set status flags. Perhaps we should have these do a compare or inc/dec (to avoid modifying carry) afterwards?<br /><br />It's quite novel to be able to code 65xx assembly for the SPC-700. Even things like stack access work:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">lda #$12<br />tsx<br />pha<br />lda $100,x ; A=$12<br /></div><br />Thanks again tepples for paving the way for this! I'm eager to do GB-Z80 in the near future.<br /><br />EDIT: added spc-chord code example I forgot to link when I posted.<br /><br />Edit: how about sp65c02? Heh

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Movax12</b> [ Fri Nov 29, 2013 1:20 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">blargg wrote:</div><div class="quotecontent">The one addressing mode I couldn't get to work as specified is memory.bit, where bit must be in parenthesis if it uses a named constant, as ca65 thinks it's a . directive otherwise</div><br /><br />You may want to explore if <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">.feature leading_dot_in_identifiers</tt> could help with that. I'm guessing it could still be difficult to extract the name without the dot however.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Nov 29, 2013 12:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yep, I just tried but had to stop when I saw there was no way to remove the . from the identifier formed (e.g. get the identifier <em>bitnum</em> from <em>.bitnum</em>). Identifier-&gt;string-&gt;identifier, but no way to remove characters from a string.<br /><br />I guess the leading dot support is so you can define your own macro-directives, perhaps to support others some ported code might have used<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">.myinclude &quot;file.inc&quot;<br /></div><br /><br />As for sp65c02, I think I'm going to make PLA etc. set the proper flags (e.g. preserve carry) and then run some code through the 65C02 and this that tests the instructions, to show that the set supported is solid. Further, I think I'll have this test code assembled for 65C02 and SPC-700 in the same source file, with the SPC-700 version then whisked off to the SPC-700 by the same code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>ARM9</b> [ Fri Nov 29, 2013 2:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Very nice blargg, native spc700 syntax works great so far, definitely giving ca65 another shot now.<br /><br />One question, documentation says zeropage is 0000 - 00EF, why did you do this in the config?<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">ZP: start = $10, size = $E0; # leave $10 free at each end</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Nov 29, 2013 2:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />People like to hardcode &lt;0, &lt;1 &lt;$f and I don't want those overlapping with named zero-page variables. The space from $E0-$EF is for further hardcoded variables that you don't want potentially moving around between builds, e.g. for runtime things. I believe I've used this with multi-file tests, where they can all share the same runtime variables (and communicate through them to the test runner) even if they use different sets of named zero-page variables.<br /><br />The example code isn't really polished; I'm hoping tepples will be working on something more substantial.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Fri Nov 29, 2013 2:13 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />A common convention in my coding style (and possibly others') is to leave $0000-$000F open for a subroutine's local variables.<br /><br />EDIT: Got ninja'd, so i'll add something. If you want $E0-$EF to be free for hardcoded variables, you'll need size $D0.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Nov 29, 2013 2:46 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />ARM9, thanks for the critique of the linker config file; I've started experimenting again with them and am about to break down and document how all they work, since I'm having success making a nice one for the SPC and would like to share the clarity for others building their own linker files.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Fri Nov 29, 2013 5:21 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: spca65</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Doc on ca65 linker files:<br /><br /><a href="http://blargg.8bitalley.com/tools/ca65-linker-doc.md" class="postlink">ca65-linker-doc.md</a><br /><br />I'm working on some good examples of SPC-700 config files.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>4</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
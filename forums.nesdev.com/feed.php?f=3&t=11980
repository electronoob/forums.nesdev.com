<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-gb">
<link rel="self" type="application/atom+xml" href="http://forums.nesdev.com/feed.php?f=3&amp;t=11980" />

<title>nesdev.com</title>
<subtitle>NES Development and Strangulation Records message boards</subtitle>
<link href="http://forums.nesdev.com/index.php" />
<updated>2014-11-03T07:27:53-07:00</updated>

<author><name><![CDATA[nesdev.com]]></name></author>
<id>http://forums.nesdev.com/feed.php?f=3&amp;t=11980</id>
<entry>
<author><name><![CDATA[Quietust]]></name></author>
<updated>2014-11-03T07:27:53-07:00</updated>
<published>2014-11-03T07:27:53-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135936#p135936</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135936#p135936"/>
<title type="html"><![CDATA[Re: Need your help for APU timing issue]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135936#p135936"><![CDATA[
<div class="quotetitle">lidnariq wrote:</div><div class="quotecontent"><br />The APU is strictly locked to the CPU (exactly half), and the &quot;240Hz&quot; is actually (APU Clock = 39375000 Hz ÷ 44) ÷ 3728.5 ≈ 240.0124 Hz.<br /><br />Using exactly 21477273 Hz ÷ 4 ÷ 22372 would have the frame interrupt happening too fast by 1 APU cycle = 2 CPU cycles.<br /><br />See <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/APU_Frame_Counter">http://wiki.nesdev.com/w/index.php/APU_Frame_Counter</a><!-- m --><br /></div><br /><br />By the article itself, the rate is <strong>not</strong> 240.0124 Hz, but 239.996 Hz - the first clock happens after 3728.5 APU cycles, but the second one happens 3728 cycles later, then 3729 cycles for the next one, and 3729 more cycles for the last one, plus an extra half cycle to round it off when it repeats. The end result is 14915 APU cycles per 4 quarter-frames, or (APU Clock = 39375000 Hz ÷ 44) ÷ 14915 * 4 ≈ 239.996 Hz.<br /><br />In other words, the 240Hz &quot;clock&quot; is not generated by a flat 240Hz divider - it is instead clocked by a ~60Hz counter at 4 specific cycles within the sequence. The 120Hz &quot;clock&quot; is done the same way.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=7">Quietust</a> — Mon Nov 03, 2014 7:27 am</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[lidnariq]]></name></author>
<updated>2014-11-01T20:57:47-07:00</updated>
<published>2014-11-01T20:57:47-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135874#p135874</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135874#p135874"/>
<title type="html"><![CDATA[Re: Need your help for APU timing issue]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135874#p135874"><![CDATA[
The APU is strictly locked to the CPU (exactly half), and the &quot;240Hz&quot; is actually (APU Clock = 39375000 Hz ÷ 44) ÷ 3728.5 ≈ 240.0124 Hz.<br /><br />Using exactly 21477273 Hz ÷ 4 ÷ 22372 would have the frame interrupt happening too fast by 1 APU cycle = 2 CPU cycles.<br /><br />See <!-- m --><a class="postlink" href="http://wiki.nesdev.com/w/index.php/APU_Frame_Counter">http://wiki.nesdev.com/w/index.php/APU_Frame_Counter</a><!-- m --><p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=3512">lidnariq</a> — Sat Nov 01, 2014 8:57 pm</p><hr />
]]></content>
</entry>
<entry>
<author><name><![CDATA[rockcarry]]></name></author>
<updated>2014-11-01T20:35:19-07:00</updated>
<published>2014-11-01T20:35:19-07:00</published>
<id>http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135872#p135872</id>
<link href="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135872#p135872"/>
<title type="html"><![CDATA[Need your help for APU timing issue]]></title>

<content type="html" xml:base="http://forums.nesdev.com/viewtopic.php?t=11980&amp;p=135872#p135872"><![CDATA[
I have implemented APU emulation for ffnes.<br />After run some of APU test rom, I found there are lots of timing issue of my APU emulation.<br /><br />run 4-jitter.nes, it says:<br /><br />Frame irq is set too soon<br />4-jitter<br />Failed #2<br /><br />As I known, The Frame sequencer's divider generates an output clock rate of just under 240 Hz, may be 21.47727 MHz master clock, divided by 89490. My implemention of apu, I using ppu clock, which is divided by 4 of master clock, to clock the divider, instead of master clock.<br />so I using 21477272 / 4 / 240 = 22372.158333333333333333333333333 = (int)22372 as the period of Frame sequencer divider.<br />I checked all related code of apu, could't found any problem, except the period of Frame sequencer divider, which is not divisible but using 22372 approximately instead.<br /><br />If I use 22372 + 1 instead of 22372, then run the 4-jitter.nes, it says:<br /><br />Odd jitter not handled<br />properly<br />4-jitter<br />Failed #5<br /><br />We can see the test result is related to the period, when change the period, test result will be changed. so.<br />I think the divider period is the root cause. Anyone could help me to explain the details of the timming, and the real root cause of this issue.<br />And also give me a method how to fix this issue.<br /><br />Thanks.<p>Statistics: Posted by <a href="http://forums.nesdev.com/memberlist.php?mode=viewprofile&amp;u=6728">rockcarry</a> — Sat Nov 01, 2014 8:35 pm</p><hr />
]]></content>
</entry>
</feed>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - New pal only glitch?</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">New pal only glitch?</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=2&amp;t=4841">http://forums.nesdev.com/viewtopic.php?f=2&amp;t=4841</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sat Feb 07, 2009 1:17 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>New pal only glitch?</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />As I said in my pong thread:
<br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Now more important. I played this on my famicom but took it to school today and played it on my pal nes. For some reason my pal nes the up button got shifted to start. A pal only glitch perhaps. I'd like to see if theres more info on this.</div>
<br />
<br />I doubt its the dmpc glitch since it doesnt happen on my famicom and I dont even have audio.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sat Feb 07, 2009 2:00 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Can't help much without source code. Best to first try building a test program that just reads the controller and prints the byte returned, and see if that still exhibits the problem. If not, you know the cause is in your other code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sat Feb 07, 2009 2:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It's on my laptop. I"ll upload the code later. I used an inefficient way of reading the pads. But it works on ntsc machines so its really weird.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sat Feb 07, 2009 2:30 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />PAL does have a slower CPU than NTSC, would that contribute at all?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sat Feb 07, 2009 2:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I dont see how......it reads the controller basicly by latching it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sat Feb 07, 2009 2:52 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Ok this is fucked up. I did some more testing.
<br />first of all all controllers work on all units with other games like dpad hero.
<br />Heres all tests with my game:
<br />dogbone (famicom) on pal nes: works
<br />pal controller on pal nes: doesnt work (tried 2)
<br />
<br />pal controller on famicom: works
<br />dogbone controller on famicom works to.
<br />
<br />This is f-ed up

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Mednafen</b> [ Sat Feb 07, 2009 11:32 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Are you masking out open bus/gamepad unused bits?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sun Feb 08, 2009 11:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; .inesprg&nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; .ineschr&nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; .inesmir&nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; .inesmap&nbsp; &nbsp; 0<br /><br />&nbsp; &nbsp;.org $8000<br />&nbsp; &nbsp;.bank 0<br /><br /><br />paddle_y = $0200<br />paddle_x = $0203<br />paddle2_y = $020c<br />paddle2_x = $020f<br />ball_y = $0218<br />ball_x = $021b<br />score_1 = $0221<br />score_2 = $021d<br />direction = $304<br /><br />reset:<br />&nbsp; &nbsp; sei&nbsp; &nbsp; &nbsp; &nbsp; ; ignore IRQs<br />&nbsp; &nbsp; cld&nbsp; &nbsp; &nbsp; &nbsp; ; disable decimal mode<br />&nbsp; &nbsp; ldx #$40<br />&nbsp; &nbsp; stx $4017&nbsp; ; disable APU frame IRQ<br />&nbsp; &nbsp; ldx #$ff<br />&nbsp; &nbsp; txs&nbsp; &nbsp; &nbsp; &nbsp; ; Set up stack<br />&nbsp; &nbsp; inx&nbsp; &nbsp; &nbsp; &nbsp; ; now X = 0<br />&nbsp; &nbsp; stx $2000&nbsp; ; disable NMI<br />&nbsp; &nbsp; stx $2001&nbsp; ; disable rendering<br />&nbsp; &nbsp; stx $4010&nbsp; ; disable DMC IRQs<br />&nbsp;<br />&nbsp; &nbsp; ; Optional &#40;omitted&#41;:<br />&nbsp; &nbsp; ; Set up mapper and jmp to further init code here.<br />&nbsp;<br />&nbsp; &nbsp; ; First of two waits for vertical blank to make sure that the<br />&nbsp; &nbsp; ; PPU has stabilized<br />vblankwait1:&nbsp; <br />&nbsp; &nbsp; bit $2002<br />&nbsp; &nbsp; bpl vblankwait1<br />&nbsp;<br />&nbsp; &nbsp; ; We now have about 30,000 cycles to burn before the PPU stabilizes.<br />&nbsp; &nbsp; ; Use it to clear RAM.&nbsp; X is still 0...<br />&nbsp; &nbsp; txa<br />clrmem:<br />&nbsp; &nbsp; sta $000,x<br />&nbsp; &nbsp; sta $100,x<br />&nbsp; &nbsp; sta $200,x<br />&nbsp; &nbsp; sta $300,x<br />&nbsp; &nbsp; sta $400,x<br />&nbsp; &nbsp; sta $500,x<br />&nbsp; &nbsp; sta $600,x<br />&nbsp; &nbsp; sta $700,x&nbsp; ; Remove this if you're storing reset-persistent data<br />&nbsp; &nbsp; inx<br />&nbsp; &nbsp; bne clrmem<br />&nbsp;<br />vblankwait2:<br />&nbsp; &nbsp; bit $2002<br />&nbsp; &nbsp; bpl vblankwait2<br /><br />ldpalletadr:<br />&nbsp; &nbsp;lda #$3F<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;lda #$10<br />&nbsp; &nbsp;sta $2006 <br />&nbsp; &nbsp;ldx #$00<br /><br />palletloop:<br />&nbsp; LDA palette, x&nbsp; &nbsp; &nbsp; &nbsp; ;load palette byte<br />&nbsp; STA $2007&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;write to PPU<br />&nbsp; INX&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;;set index to next byte<br />&nbsp; CPX #$20&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; BNE palletloop&nbsp; ;if x = $20, 32 bytes copied, all done<br /><br />preploadscreen:<br />&nbsp; lda $2002<br />&nbsp; lda #$20<br />&nbsp; sta $2006<br />&nbsp; lda #$20<br />&nbsp; sta $2006<br />&nbsp; ldx #$00<br />&nbsp; lda #$01<br /><br />loadscreen:<br />&nbsp; sta $2007<br />&nbsp; inx<br />&nbsp; cpx #$20<br />&nbsp; bne loadscreen<br /><br />preloadscreen2:<br />&nbsp; lda $2002<br />&nbsp; lda #$23<br />&nbsp; sta $2006<br />&nbsp; lda #$00<br />&nbsp; sta $2006<br />&nbsp; ldx #$00<br />&nbsp; lda #$01<br /><br />loadscreen2:<br />&nbsp; sta $2007<br />&nbsp; inx<br />&nbsp; cpx #$20<br />&nbsp; bne loadscreen2<br />&nbsp;<br /><br />set2006:<br />&nbsp; lda #$00<br />&nbsp; sta $2006<br />&nbsp; sta $2006<br /><br />drawscore1:<br />&nbsp; &nbsp;lda #$c7<br />&nbsp; &nbsp;sta $021C<br />&nbsp; &nbsp;lda #$04<br />&nbsp; &nbsp;STA $021d<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $021e<br />&nbsp; &nbsp;lda #$50<br />&nbsp; &nbsp;sta $021f<br /><br />drawscore2:<br />&nbsp; &nbsp;lda #$c7<br />&nbsp; &nbsp;sta $0220<br />&nbsp; &nbsp;lda #$04<br />&nbsp; &nbsp;STA $0221<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $0222<br />&nbsp; &nbsp;lda #$A7<br />&nbsp; &nbsp;sta $0223<br />&nbsp; &nbsp;<br />drawpaddle:<br />&nbsp; &nbsp;lda #$48 ;first sprite<br />&nbsp; &nbsp;sta paddle_y ;store y position<br />&nbsp; &nbsp;lda #$03 <br />&nbsp; &nbsp;sta $0201 ;store sprite number<br />&nbsp; &nbsp;lda #%00000000<br />&nbsp; &nbsp;sta $0202 ;store no flipping ect.<br />&nbsp; &nbsp;lda #$08<br />&nbsp; &nbsp;sta paddle_x ;store x position<br />&nbsp; &nbsp;lda #$50 ;second sprite<br />&nbsp; &nbsp;sta $0204<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $0205<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $0206<br />&nbsp; &nbsp;lda #$08<br />&nbsp; &nbsp;sta $0207<br />&nbsp; &nbsp;lda #$58 ;third sprite<br />&nbsp; &nbsp;sta $0208<br />&nbsp; &nbsp;lda #$03<br />&nbsp; &nbsp;sta $0209<br />&nbsp; &nbsp;lda #%10000000<br />&nbsp; &nbsp;sta $020A<br />&nbsp; &nbsp;lda #$08<br />&nbsp; &nbsp;sta $020B ;end third sprite<br /><br />drawpaddle2:<br />&nbsp; &nbsp;lda #$48 ;first sprite<br />&nbsp; &nbsp;sta paddle2_y ;store y position<br />&nbsp; &nbsp;lda #$03 <br />&nbsp; &nbsp;sta $020d ;store sprite number<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $020e ;store no flipping ect.<br />&nbsp; &nbsp;lda #$f0<br />&nbsp; &nbsp;sta paddle2_x ;store x position<br />&nbsp; &nbsp;lda #$50 ;second sprite<br />&nbsp; &nbsp;sta $0210<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $0211<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $0212<br />&nbsp; &nbsp;lda #$f0<br />&nbsp; &nbsp;sta $0213<br />&nbsp; &nbsp;lda #$58 ;third sprite<br />&nbsp; &nbsp;sta $0214<br />&nbsp; &nbsp;lda #$03<br />&nbsp; &nbsp;sta $0215<br />&nbsp; &nbsp;lda #%10000000<br />&nbsp; &nbsp;sta $0216<br />&nbsp; &nbsp;lda #$f0<br />&nbsp; &nbsp;sta $0217 ;end third sprite<br />&nbsp; &nbsp;lda #$02<br />&nbsp; &nbsp;sta $4014<br /><br />drawball: <br />&nbsp; &nbsp;lda #$50 ;sprite<br />&nbsp; &nbsp;sta ball_y ;store y position<br />&nbsp; &nbsp;lda #$02 <br />&nbsp; &nbsp;sta $0219 ;store sprite number<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $021a ;store no flipping ect.<br />&nbsp; &nbsp;lda #$7b<br />&nbsp; &nbsp;sta ball_x ;store x position<br /><br />setbalv:<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta $301<br />&nbsp; &nbsp;lda #$02<br />&nbsp; &nbsp;sta $300<br /><br />generate:<br />&nbsp; &nbsp;lda #%10000000<br />&nbsp; &nbsp;sta $2000<br /><br />turnon:<br />&nbsp; &nbsp;lda #%00011110<br />&nbsp; &nbsp;sta $2001<br /><br />setscore:<br />&nbsp; &nbsp;lda #$04<br />&nbsp; &nbsp;sta score_1<br />&nbsp; &nbsp;sta score_2<br />&nbsp;<br />loop:<br />&nbsp;<br />&nbsp; &nbsp;jmp loop<br /><br />reverse:<br />&nbsp; &nbsp;Lda direction<br />&nbsp; &nbsp;eor #$00000001<br />&nbsp; &nbsp;sta direction<br />&nbsp; &nbsp;rts<br /><br />nmi:<br /><br />&nbsp; &nbsp;pha&nbsp; &nbsp; ; Push A on the stack &#40;which were the contents in A&#41;<br />&nbsp; &nbsp;txa&nbsp; &nbsp; ; transfer X to A<br />&nbsp; &nbsp;pha&nbsp; &nbsp; ; Push A on the stack &#40;which were the contents in X&#41;<br />&nbsp; &nbsp;tya&nbsp; &nbsp; ; transfer Y to A<br />&nbsp; &nbsp;pha&nbsp; &nbsp; ; Push A on the stack &#40;which were the contents in Y&#41;<br /><br /><br /><br />checkscore1:<br />&nbsp; &nbsp;ldx ball_x<br />&nbsp; &nbsp;cpx #$F7<br />&nbsp; &nbsp;bcc checkscore2<br />&nbsp; &nbsp;lda score_2<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp #$07<br />&nbsp; &nbsp;bne scorelol1<br />&nbsp; &nbsp;jmp reset<br /><br />scorelol1:<br />&nbsp; &nbsp;lda #$7b<br />&nbsp; &nbsp;sta ball_x<br />&nbsp; &nbsp;lda #$50<br />&nbsp; &nbsp;sta ball_y<br />&nbsp; &nbsp;ldx score_2<br />&nbsp; &nbsp;inx <br />&nbsp; &nbsp;stx score_2<br />&nbsp; &nbsp;jsr reverse<br />&nbsp; &nbsp;<br /><br />checkscore2:<br />&nbsp; &nbsp;ldx ball_x<br />&nbsp; &nbsp;cpx #$08<br />&nbsp; &nbsp;bcs checkdirection<br />&nbsp; &nbsp;lda score_1<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp #$07<br />&nbsp; &nbsp;bne scorelol2<br />&nbsp; &nbsp;jmp reset<br /><br />scorelol2:<br />&nbsp; &nbsp;lda #$7b<br />&nbsp; &nbsp;sta ball_x<br />&nbsp; &nbsp;lda #$50<br />&nbsp; &nbsp;sta ball_y<br />&nbsp; &nbsp;ldx score_1<br />&nbsp; &nbsp;inx <br />&nbsp; &nbsp;stx score_1<br />&nbsp; &nbsp;jsr reverse<br /><br /><br />checkdirection:<br />&nbsp; &nbsp;ldx direction<br />&nbsp; &nbsp;cpx #$00<br />&nbsp; &nbsp;bne checkballpaddle2<br /><br /><br />checkballpaddle1:<br />&nbsp; &nbsp;lda paddle2_x<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp ball_x<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the left edge of the enemy is farther than the Player's Right edge, there is could be no collision.<br /><br />&nbsp; &nbsp;lda ball_x<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp paddle2_x<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the Player's Left edge is beyond the enemy's right, there's no way there could be a collision.<br /><br />&nbsp; &nbsp;lda paddle2_y<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$15<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp ball_y<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the Player's Bottom Border is above the top of the enemy, there is no way for collision.<br /><br />&nbsp; &nbsp;lda ball_y<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp paddle2_y<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the player's Top edge is below &#40;Greater than&#41; the enemy's bottom edge, there can be no collision. <br /><br />reverseball:<br />&nbsp; &nbsp;jsr reverse<br /><br />checkballpaddle2:<br />&nbsp; &nbsp;lda paddle_x<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp ball_x<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the left edge of the enemy is farther than the Player's Right edge, there is could be no collision.<br /><br />&nbsp; &nbsp;lda ball_x<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp paddle_x<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the Player's Left edge is beyond the enemy's right, there's no way there could be a collision.<br /><br />&nbsp; &nbsp;lda paddle_y<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$15<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp ball_y<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the Player's Bottom Border is above the top of the enemy, there is no way for collision.<br /><br />&nbsp; &nbsp;lda ball_y<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #$08<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;cmp paddle_y<br />&nbsp; &nbsp;bcc checkbounce&nbsp; &nbsp; &nbsp; &nbsp;;If the player's Top edge is below &#40;Greater than&#41; the enemy's bottom edge, there can be no collision.<br /><br />reverseball2:<br />&nbsp; &nbsp;jsr reverse<br />&nbsp;<br />checkbounce:<br />&nbsp; &nbsp;ldx ball_y<br />&nbsp; &nbsp;cpx #$10<br />&nbsp; &nbsp;beq checkbounce2<br /><br />reversey:<br />&nbsp; &nbsp;lda $303<br />&nbsp; &nbsp;eor #$00000001<br />&nbsp; &nbsp;sta $303<br /><br />checkbounce2:<br />&nbsp; &nbsp;ldx ball_y<br />&nbsp; &nbsp;cpx #$b8<br />&nbsp; &nbsp;beq updatebally1<br /><br />reversey2:<br />&nbsp; lda $303<br />&nbsp; eor #$00000001<br />&nbsp; sta $303<br /><br />updatebally1:<br />&nbsp; &nbsp;lda $303<br />&nbsp; &nbsp;and #$01<br />&nbsp; &nbsp;bne updatebally2<br />&nbsp; &nbsp;lda ball_y<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc $300<br />&nbsp; &nbsp;sta ball_y<br />&nbsp; &nbsp;jmp updateballx1<br /><br />updatebally2:<br />&nbsp; &nbsp;lda ball_y<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc $300<br />&nbsp; &nbsp;sta ball_y<br /><br />updateballx1:<br />&nbsp; &nbsp;lda direction<br />&nbsp; &nbsp;and #%00000001<br />&nbsp; &nbsp;bne updateballx2<br />&nbsp; &nbsp;lda ball_x<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc $301<br />&nbsp; &nbsp;sta ball_x<br />&nbsp; &nbsp;jmp check1<br /><br />updateballx2:<br />&nbsp; &nbsp;lda ball_x<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc $301<br />&nbsp; &nbsp;sta ball_x<br /><br /><br />checkcheck1:<br />&nbsp; &nbsp;ldx ball_x<br />&nbsp; &nbsp;cpx #$EF<br />&nbsp; &nbsp;bcc checkcheck2<br />&nbsp; &nbsp;jmp finish<br /><br />checkcheck2:<br />&nbsp; &nbsp;ldx ball_x<br />&nbsp; &nbsp;cpx #$10<br />&nbsp; &nbsp;bcs check1<br />&nbsp; &nbsp;jmp finish<br />&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;<br />check1:<br />&nbsp; &nbsp;ldx paddle_y ;see if paddle is at top<br />&nbsp; &nbsp;cpx #$10<br />&nbsp; &nbsp;beq check2<br />&nbsp; &nbsp;lda #$01 ; start latch<br />&nbsp; &nbsp;sta $4016<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $4016 ;latch the controller<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016 ;ignore everything till up and down<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;and #%00000001<br />&nbsp; &nbsp;beq check2 ;if up pressed go up<br />&nbsp; &nbsp;ldx paddle_y<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;stx paddle_y ;first sprite<br />&nbsp; &nbsp;ldx $0204<br />&nbsp; &nbsp;dex <br />&nbsp; &nbsp;stx $0204 ;second<br />&nbsp; &nbsp;ldx $0208<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;stx $0208 ;third<br />&nbsp; &nbsp;<br />check2:<br />&nbsp; &nbsp;ldx $0208 ;see if paddle is at bottom<br />&nbsp; &nbsp;cpx #$b8<br />&nbsp; &nbsp;beq check3<br />&nbsp; &nbsp;lda #$01 ; start latch<br />&nbsp; &nbsp;sta $4016<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $4016 ;latch the controller<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016 ;ignore everything till up and down<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;lda $4016<br />&nbsp; &nbsp;and #%00000001<br />&nbsp; &nbsp;beq check3 ;yaya<br />&nbsp; &nbsp;ldx paddle_y<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;stx paddle_y ;first<br />&nbsp; &nbsp;ldx $0204<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;stx $0204 ;second<br />&nbsp; &nbsp;ldx $0208<br />&nbsp; &nbsp;inx <br />&nbsp; &nbsp;stx $0208 ;third.<br /><br />check3:<br />&nbsp; &nbsp;ldx paddle2_y ;see if paddle is at top<br />&nbsp; &nbsp;cpx #$10<br />&nbsp; &nbsp;beq check4<br />&nbsp; &nbsp;lda #$01 ; start latch<br />&nbsp; &nbsp;sta $4016<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $4016 ;latch the controller<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017 ;ignore everything till up and down<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;and #%00000001<br />&nbsp; &nbsp;beq check4 ;if up pressed go up<br />&nbsp; &nbsp;ldx paddle2_y<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;stx paddle2_y ;first sprite<br />&nbsp; &nbsp;ldx $0210<br />&nbsp; &nbsp;dex <br />&nbsp; &nbsp;stx $0210 ;second<br />&nbsp; &nbsp;ldx $0214<br />&nbsp; &nbsp;dex<br />&nbsp; &nbsp;stx $0214 ;third<br /><br />check4:<br />&nbsp; &nbsp;ldx $0214 ;see if paddle is at bottom<br />&nbsp; &nbsp;cpx #$b8<br />&nbsp; &nbsp;beq finish<br />&nbsp; &nbsp;lda #$01 ; start latch<br />&nbsp; &nbsp;sta $4016<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta $4016 ;latch the controller<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017 ;ignore everything till up and down<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;lda $4017<br />&nbsp; &nbsp;and #%00000001<br />&nbsp; &nbsp;beq finish ;yaya<br />&nbsp; &nbsp;ldx paddle2_y<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;stx paddle2_y ;first<br />&nbsp; &nbsp;ldx $0210<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;stx $0210 ;second<br />&nbsp; &nbsp;ldx $0214<br />&nbsp; &nbsp;inx <br />&nbsp; &nbsp;stx $0214 ;third.<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;<br /><br />finish: <br />&nbsp; &nbsp;lda #$02<br />&nbsp; &nbsp;sta $4014<br />&nbsp; &nbsp;pla&nbsp; &nbsp; &nbsp;; Pull A off of the stack &#40;which were the contents in Y&#41;<br />&nbsp; &nbsp;tay&nbsp; &nbsp; &nbsp;; transfer A to Y<br />&nbsp; &nbsp;pla&nbsp; &nbsp; &nbsp;; Pull A off of the stack &#40;which were the contents in X&#41;<br />&nbsp; &nbsp;tax&nbsp; &nbsp; &nbsp;; transfer A to X<br />&nbsp; &nbsp;pla&nbsp; &nbsp; &nbsp;; Pull A off of the stack &#40;which were the contents in A&#41;<br />&nbsp; &nbsp;rti&nbsp; &nbsp; &nbsp;; return from NMI interrupt <br /><br /><br />&nbsp; &nbsp; &nbsp;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; palette:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .db $0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .db $0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30,&nbsp; &nbsp;$0F,$30,$30,$30&nbsp; <br /><br />&nbsp; &nbsp; &nbsp; &nbsp;.bank 1<br />&nbsp; &nbsp;.org&nbsp; &nbsp;$FFFA<br />&nbsp; &nbsp;.dw&nbsp; &nbsp;&nbsp; &nbsp;nmi ;&#40;NMI_Routine&#41;<br />&nbsp; &nbsp;.dw&nbsp; &nbsp;&nbsp; &nbsp;reset ;&#40;Reset_Routine&#41;<br />&nbsp; &nbsp;.dw&nbsp; &nbsp;&nbsp; &nbsp;0 ;&#40;IRQ_Routine&#41;<br /><br />&nbsp; &nbsp; .bank 2<br />&nbsp; &nbsp; .org&nbsp; &nbsp; $0000<br />&nbsp; &nbsp; .incbin &quot;pong.chr&quot;&nbsp; ;gotta be 8192 bytes long</div>
<br />
<br />My code in its entirety.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Memblers</b> [ Sun Feb 08, 2009 12:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Try adding a NOP between the consecutive $4016/$4017 reads.  I doubt that will fix it, but I don't know what else to suggest (unless the bug is somewhere else).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sun Feb 08, 2009 12:56 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Kev told me pal pads are different. But I dont see why the pal pads would work on my famicom fine then.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>blargg</b> [ Sun Feb 08, 2009 1:03 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yeah, looks to be that it can't be read that quickly. Perhaps capacitance on the input. Any reason you aren't using a normal controller read loop?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jeroen</b> [ Sun Feb 08, 2009 1:07 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />meh this was one of the first things I worked on. And it was when I first started nesdev. Thats the reason for the non standard controller read loop. However it might be good to make note of this.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
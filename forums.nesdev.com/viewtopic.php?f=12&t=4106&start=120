<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - SPC7110 Reverse Engineering Project</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - SNESdev" href="http://forums.nesdev.com/feed.php?f=12" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - SPC7110 Reverse Engineering Project" href="http://forums.nesdev.com/feed.php?f=12&amp;t=4106" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '9');
	var per_page = '15';
	var base_url = './viewtopic.php?f=12&amp;t=4106';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Mon Sep 22, 2014 12:22 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=12&amp;t=4106&amp;start=120">SPC7110 Reverse Engineering Project</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=4106"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>9</strong> of <strong>21</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 315 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=4106&amp;start=105">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=4106">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=105">8</a><span class="page-sep">, </span><strong>9</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=135">10</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=150">11</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=165">12</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=300">21</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=4106&amp;start=135">Next</a></b></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=12&amp;t=4106&amp;start=120&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=12&amp;t=4106&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=12&amp;t=4106&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34323"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34323"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34323#p34323"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 1:02 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">. From previous tests it looks like for type 0 it saturates at roughly one input bit -&gt; 128 output bits. And thus I would take as a starting guess that the depth is 8-bit. </div><br /><br />Yeah, that was exactly my guess. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">It is my understanding that a binary arithmetic compression algorithm works something like this: </div><br /><br />That's a possible description, but i think there are schemes where you can fix one of the limits, let's say BOTTOM=0, and only play with TOP after adequate renormalizations. To make that, usually you assign a part of the table (usually the top one) to the LPS (least probable symbol), so you have to take note of which is your current LPS.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">5A,5A,5A,5A, 5A,5A,5A,5A,<br />5A,25,25,5A, 25,25,25,25,<br />25,25,25,25, 25,11,25,25,<br />11,25,25,25, 11,11,25,11,<br />11,25,25,11, 11,11,11,11,<br />11,25,25,8, 11,11,11,11, <br /><br />So it looks like the probability has very discrete states and doesn't evolve very 'continuously'.</div><br /><br />Yes, that use to be the case, i think. If i remember correctly, IBM's Q-coder used a 5 bits state table, while the number of bits of his intervale were higher (12?, 16?, i don't remember)<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I don't understand what I'm doing wrong.</div>
<br />
<br />I can exply it. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> While i still need to take a deeper look at the data, at first glance the table seems very reasonable to me indeed. Your problem is that, while you are concentrating in the compression scheme, you seem to have completely missed the importance of the context here. I doubt the SPC7110 be using a generic "linear" context like you seem to be expecting. Instead of it, i would bet it's using contexts to optimize the decompression of 8x8 SNES tiles, like the S-DD1. I would recommend you to take another look at my docs about the S-DD1; the S-DD1 used a very clever one-pass context model that allowed the decompressor to change contexts depending on the bits of the surrounding pixels appearing previously in the output stream. So what is happening probably is not that the decompressor is "increasing the probability of getting a 1"; the explanation maybe is that those consecutive bits are using different context, so the evolution of the probability estimation are indepent  one from another.
<br />
<br />Of course, the existence of different contexts must be checked, but i think that's the case here. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34324"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34324"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34324#p34324"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 1:38 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I've editted my previous post many times trying to "fix" the algorithm I listed.  Forcing myself to write it down makes me now understand that I am missing something, for that algorithm can fail if  TOP-BOTTOM &lt;= $80.
<br />
<br />I can fix it by forcing a bit to be output if 0 &lt; TOP-BOTTOM &lt;= $80.  But now I'm wandering off, and not sure I'm working with standard algorithms.  Is that how it is fixed in practice?  That still wouldn't fix the strangeness of the PROB evolution I'm seeing. (I agree context is a possibility, but there appears to be no symmetry whatsoever in the contexts in that case... which seems unlikely to me.)
<br />
<br />
<br />And you mentioned the possibility that somehow only one range tracker variable was needed.  That sounds familiar, but I'm having trouble finding some simple documents anywhere.  I haven't taken a look at that patent yet, as I wanted to get a fresh view and orient myself before jumping into that.  Can you suggest any links?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34325"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34325"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34325#p34325"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 2:47 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I'm sorry i don't remember where i read the use of only one variable, so i can't help you with links; however, i think it worked this way:
<br />
<br />At a given time, you have your "next bit interval"  coded as the interval [0, TOP]. TOP has his MSb set to 1.
<br />
<br />If at this moment you are going to read the next bit from the compressed stream, two things can happen:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">1&#41; You read a 0; then you start a loop:<br /><br />do<br />&nbsp; &nbsp;output a MPS<br />&nbsp; &nbsp;TOP = TOP - PROB<br />&nbsp; &nbsp;*maybe* lower PROB, depending on your evolution model<br />while TOP's MSb is 1<br />finally, you renormalize the interval by shifting one bit TOP &#40;and maybe modifying PROB&#41; and prepare to ask for other input bit.<br /><br />2&#41; You read a 1. Then:<br /><br />if PROB has his maximum value &#40;a one followed by zeros&#41; <br />&nbsp; &nbsp; output a LPS<br />&nbsp; &nbsp; decide if you want to interchange the roles of MPS and LPS<br />&nbsp; &nbsp; *probably* you decide to set TOP to his maximum value<br />else<br />&nbsp; &nbsp; renormalize the interval by biggering PROB and/or biggering TOP<br />&nbsp; &nbsp; &nbsp; &nbsp;in a proper way depending on your model &#40;using indexed tables,<br />&nbsp; &nbsp; &nbsp; &nbsp;shifting bits, setting directly the maximum value, etc&#41;.<br />Finally, you prepare to ask for other input bit.</div>
<br />------------
<br />
<br />I think this is the basic schema, but there are lots of possible variants, depending on: the way you modify the probability estimates, the way you renormalize the intervals, and the way you decide when you are going to interchange the roles of MPS and LPS.
<br />
<br />At this point, i don't feel the need to use much time on anything else than understanding the basic ideas of a arithmetic coding algorithm; the details (there are lots of possible variants) should be make clear as the research progress.
<br />
<br />For those who have never taken a look at an arithmetic compression, i would suggest to read something about one of the first practical examples: IBM's Q-coder. Maybe there are better references, but a quick look at the Internet show this:
<br />
<br /><a href="http://www.research.ibm.com/journal/rd/326/ibmrd3206C.pdf" class="postlink">http://www.research.ibm.com/journal/rd/326/ibmrd3206C.pdf</a>
<br />
<br />It can be a good starting point for those interested in understanding the discussion. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3445">Andreas Naive</a> on Thu Jun 19, 2008 5:02 am, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34326"></a>
				<b class="postauthor">kammedo</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34326"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34326#p34326"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 3:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed May 28, 2008 5:43 am<br /><b>Posts:</b> 57
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">It can be a good starting point for those interested in understanding the discussion. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>
<br />
<br />Yup thanks ^^ that is way better than the one i found.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3536"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34331"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34331"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34331#p34331"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 11:26 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Using the above values, it looks like PROB evolves like this:<br />5A,5A,5A,5A, 5A,5A,5A,5A,<br />5A,25,25,5A, 25,25,25,25,<br />25,25,25,25, 25,11,25,25,<br />11,25,25,25, 11,11,25,11,<br />11,25,25,11, 11,11,11,11,<br />11,25,25,8, 11,11,11,11, </div>
<br />
<br />Which method did you use to calculate this table? Did it give exact or only approximate results? Details are welcomed.  <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34336"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34336"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34336#p34336"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jun 19, 2008 4:50 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Using the above values, it looks like PROB evolves like this:<br />5A,5A,5A,5A, 5A,5A,5A,5A,<br />5A,25,25,5A, 25,25,25,25,<br />25,25,25,25, 25,11,25,25,<br />11,25,25,25, 11,11,25,11,<br />11,25,25,11, 11,11,11,11,<br />11,25,25,8, 11,11,11,11, </div><br /><br />Which method did you use to calculate this table? Did it give exact or only approximate results? Details are welcomed.  <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>
<br />Most are exact, assuming 8-bit registers.  Since the PROB values are fairly discrete, I used that fact to help me if it was a bit uncertain from the data.
<br />
<br />Caitsith's .loc files gave a decent amount of the data which I just looked at the summary files to find the cutoff values.  There are some other files I ran to get some more data (sorry, I didn't even think about that till now. I'll upload them when I get home tonight).
<br />
<br />The 'probability' values were calculated from the cutoff values assuming a subtraction instead of an actual multiplication of the probability with the current "data range".
<br />
<br />If you check my cutoff values (and 'probability' values), let me know what you get.  I hope I didn't make any arithmetic errors.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34340"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34340"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34340#p34340"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 3:56 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Here are the extra data files useful for finding those 'boundary values':
<br />feoez-000xxx: <a href="http://neviksti.com/SPC7110/feoez-000xxx.loc" class="postlink">.loc</a>,<a href="http://neviksti.com/SPC7110/feoez-000xxx.dumped" class="postlink">.dumped</a>,<a href="http://neviksti.com/SPC7110/feoez-000xxx.txt" class="postlink">.txt</a>
<br />feoez-001xxx: <a href="http://neviksti.com/SPC7110/feoez-001xxx.loc" class="postlink">.loc</a>,<a href="http://neviksti.com/SPC7110/feoez-001xxx.dumped" class="postlink">.dumped</a>,<a href="http://neviksti.com/SPC7110/feoez-001xxx.txt" class="postlink">.txt</a>
<br />feoez-18zbits: <a href="http://neviksti.com/SPC7110/feoez-18zbits.loc" class="postlink">.loc</a>,<a href="http://neviksti.com/SPC7110/feoez-18zbits.dumped" class="postlink">.dumped</a>,<a href="http://neviksti.com/SPC7110/feoez-18zbits.txt" class="postlink">.txt</a> (18 zero bits, followed by all xxx nibble combinations)
<br />feoez-10nbits: <a href="http://neviksti.com/SPC7110/feoez-10nbits.loc" class="postlink">.loc</a>,<a href="http://neviksti.com/SPC7110/feoez-10nbits.dumped" class="postlink">.dumped</a>,<a href="http://neviksti.com/SPC7110/feoez-10nbits.txt" class="postlink">.txt</a> (10 non-zero bits, followed by all xxx nibble combinations)
<br />feoez-16nbits: <a href="http://neviksti.com/SPC7110/feoez-16nbits.loc" class="postlink">.loc</a>,<a href="http://neviksti.com/SPC7110/feoez-16nbits.dumped" class="postlink">.dumped</a>,<a href="http://neviksti.com/SPC7110/feoez-16nbits.txt" class="postlink">.txt</a>
<br />
<br />---------------------------------------------------------------------------------
<br />
<br />Okay, I thought about this for a long time tonight and I figured out how to word what is bothering me here.  Hopefully I've learned something useful for at least myself (even if it may be obvious to others, or worse, completely wrong)... but here's my logic and please let me know if I am making a mistake:
<br />
<br />First, my core assumptions here are:
<br />1) efficient compressors have 1 to 1 correspondence between compressed data sequences and uncompressed data sequences
<br />2) the SPC7110 uses arithmetic encoding that is efficient in sense #1
<br />
<br />Rough logic, concerning a compressor compatible with SPC7110:
<br />- To ensure property #2, at any point the compressor must know the current 'allowable range' state.
<br />- The current range consist of two values: the TOP or BOTTOM.  Without further information (such as the method of updating them), this cannot be reduced because these can in principle be varied independently.
<br />- The update method, in order to allow inversion of this process, must follow a deterministic pattern based solely on the range state and probability for a LPS (or MPS) at any point.
<br />- For compression to occur, the probability must not remain constant.
<br />- Then, except for contrived cases where any probability deviating from 50% is 2^-n and is always followed by probabilities so that the string of these deviations add to 2^-n' until it adds to 50% (in which case the 'non-determined' bits of the bottom or top of the range can be held constant), the range cannot be determined just from one of TOP or BOTTOM values alone even with (reasonable) freedom to choose the update process.
<br />- Therefore the 1 to 1 correspondence of compressed data and uncompressed data requires the range to be represented with a minimum of two state variables.
<br />
<br />Rough logic, concerning update of range:
<br />- Unless the case can be avoided by design, if TOP-BOTTOM&lt;PROB a special case needs to be invoked.
<br />- If PROB is calculated independent of current range (ie. we use addition and subtration instead of actual multiplication of a probability*range to get the value to subtract from the range), then this case cannot be avoided.
<br />- Since the SPC7110 data indicates the update likely involves discrete values subtracted from the range, there needs to be a special case for this condition.
<br />
<br />
<br />I tried to work out the boundary values for continually chosing a LPS, and kept noticing what seemed like strange updates to me.   Combined with what looked like strange updates in the 'always choose MPS' data, I think we are seeing evidence of this special case.  Or at least I hope we are, so we can figure out how it is handled.
<br />
<br />This is the best I can up with yet.  It really seems there are few variants that are even possible (considering the MPS and PROB calculation arbitrary at the moment).
<br />
<br />(EDIT: There are errors in this pseudo-code too. See my next post.)
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Possible outline for SPC7110 compatible Arithmetic compressor &#40;for some reason it is easier for me to think in terms of compression to ensure I don't accidentally leave out some range in the output&#41;<br />note: PROB is the probability of getting a LPS<br /><br />TOP=$FF<br />BOT=$00<br /><br />For each bit in uncompressed data<br />&nbsp; get PROB and MPS<br />&nbsp; if TOP-BOT&lt;PROB<br />&nbsp; &nbsp; if bit is MPS<br />&nbsp; &nbsp; &nbsp; output 0<br />&nbsp; &nbsp; &nbsp; TOP = $FF<br />&nbsp; &nbsp; &nbsp; BOT = &#40;BOT &lt;&lt; 1&#41;<br />&nbsp; &nbsp; &nbsp; while high bit BOT == 1<br />&nbsp; &nbsp; &nbsp; &nbsp; output 1<br />&nbsp; &nbsp; &nbsp; &nbsp; BOT = &#40;BOT &lt;&lt; 1&#41;<br />&nbsp; &nbsp; &nbsp; endwhile<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; output 1<br />&nbsp; &nbsp; &nbsp; BOT = $00<br />&nbsp; &nbsp; &nbsp; TOP = &#40;TOP &lt;&lt; 1&#41; +1<br />&nbsp; &nbsp; &nbsp; while high bit TOP == 0<br />&nbsp; &nbsp; &nbsp; &nbsp; output 0<br />&nbsp; &nbsp; &nbsp; &nbsp; TOP = &#40;TOP &lt;&lt; 1&#41; +1<br />&nbsp; &nbsp; &nbsp; endwhile<br />&nbsp; &nbsp; endif<br />&nbsp; elseif bit is MPS<br />&nbsp; &nbsp; TOP = TOP - PROB<br />&nbsp; &nbsp; while high bit TOP == 0<br />&nbsp; &nbsp; &nbsp; output 0<br />&nbsp; &nbsp; &nbsp; BOT = &#40;BOT &lt;&lt; 1&#41;<br />&nbsp; &nbsp; &nbsp; TOP = &#40;TOP &lt;&lt; 1&#41; +1<br />&nbsp; &nbsp; endwhile<br />&nbsp; else ** bit is LPS ** <br />&nbsp; &nbsp; BOT = TOP - PROB + 1<br />&nbsp; &nbsp; while high bit BOT == 1<br />&nbsp; &nbsp; &nbsp; output 1<br />&nbsp; &nbsp; &nbsp; BOT = &#40;BOT &lt;&lt; 1&#41;<br />&nbsp; &nbsp; &nbsp; TOP = &#40;TOP &lt;&lt; 1&#41; +1<br />&nbsp; &nbsp; endwhile<br />&nbsp; endif<br />endfor<br /></div>
<br />
<br />Maybe my logic is faulty and I'm restricting myself too much.  But except for trivial modifications like flipping TOP/BOTTOM and such, it seems like this has to be the algorithm.
<br />
<br />Tomorrow I'll test if this can in anyway make the prob calculation look more reasonable.  I want to make sure first that I haven't unjustly ruled out large swaths of ideas.
<br />
<br />---------------------------------------------------------
<br />
<br />Oh, and I finally looked at the patent posted earlier now that I (hopefully) have a slightly better feel for the situation.
<br />
<br />The patent has a run length encoding scheme, which doesn't match what we're seeing at all.
<br />It predicts a run of bits, and a 0 means it is correct, a 1 doesn't.  If the RUN is just 1 bit, then all it takes is one bit to know the next bit.  We don't see that in the data for the first bit.  The only remaining option is that RUN starts &gt; 1, but that would require a starting 0 bit to fix several output bits... it doesn't.
<br />
<br />So, unfortunately, it looks like that patent is not applicable here.
<br />Oh well, it was a good try.</div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=716">neviksti</a> on Fri Jun 20, 2008 2:00 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34350"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34350"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34350#p34350"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 11:42 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If you check my cutoff values (and 'probability' values), let me know what you get. I hope I didn't make any arithmetic errors.</div>
<br />
<br />I agree with you; i have reproduced the table. I haven't needed the BOTTOM thing and i have obtained exact matchings for all the table entries.
<br />
<br />The scheme seems to works like this (considering the MPS and PROB calculation arbitrary as you did):
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">TOP=0x100 &#40;==0x00 modulus 256&#41;<br />VALUE=first 8 bits in the compressed stream<br /><br />for each bit we want to output<br />&nbsp; &nbsp;if&nbsp; VALUE &lt; TOP-PROB<br />&nbsp; &nbsp; &nbsp; output MPS<br />&nbsp; &nbsp; &nbsp; TOP = TOP-PROB<br />&nbsp; &nbsp; &nbsp; if TOP's MSb is 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE &lt;&lt;=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE |= next bit in the compressed stream<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while TOP's MSb is 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TOP &lt;&lt;= 1<br />&nbsp; &nbsp;else<br />&nbsp; &nbsp; &nbsp; output LPS<br />&nbsp; &nbsp; &nbsp; VALUE &lt;&lt;=1<br />&nbsp; &nbsp; &nbsp; VALUE |= next bit in the compressed stream</div>
<br />
<br />I have intentionally left unsaid in which part(s) of the loop PROB is recalculated, as i'm not sure at this point, but checking the table you calculated it's clear that those are the PROB values the algorithm have when iterating the loop after having outputted 0's in the previous iterations.
<br />
<br />I have to add you seem to  be working in this at a big pace, but i'm not being able to follow that pace, so be patient if i don't give quick feedback.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34356"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34356"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34356#p34356"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 1:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I noticed some errors in my pseudo-code above,  here's a corrected (and slightly cleaned up) version for the compressor:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Possible outline for SPC7110 compatible Arithmetic compressor<br />note: PROB is the probability of getting a LPS <br /><br />TOP=$FF <br />BOT=$00 <br /><br />For each bit in uncompressed data <br />&nbsp; get PROB and MPS <br />&nbsp; if TOP-BOT&lt;PROB <br />&nbsp; &nbsp; if bit is MPS <br />&nbsp; &nbsp; &nbsp; TOP = $7F <br />&nbsp; &nbsp; else <br />&nbsp; &nbsp; &nbsp; BOT = $80 <br />&nbsp; &nbsp; endif <br />&nbsp; elseif bit is MPS <br />&nbsp; &nbsp; TOP = TOP - PROB <br />&nbsp; else<br />&nbsp; &nbsp; BOT = TOP - PROB + 1 <br />&nbsp; endif <br /><br />&nbsp; ** shift out determined bits **<br />&nbsp; loop<br />&nbsp; &nbsp; if highbit BOT==0 &amp;&amp; highbit TOP==1<br />&nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; elseif highbit BOT==1<br />&nbsp; &nbsp; &nbsp; output 1<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; output 0<br />&nbsp; &nbsp; endif<br />&nbsp; &nbsp; BOT = &#40;BOT&lt;&lt;1&#41;<br />&nbsp; &nbsp; TOP = &#40;TOP&lt;&lt;1&#41;+1<br />&nbsp; endloop<br /><br />endfor</div> <br /><br />---------------------------------<br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">If you check my cutoff values (and 'probability' values), let me know what you get. I hope I didn't make any arithmetic errors.</div><br /><br />I agree with you; i have reproduced the table.</div><br />That's great!  Thank you.<br /> <br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">I haven't needed the BOTTOM thing and i have obtained exact matchings for all the table entries.</div><br />I don't think that is possible (assuming my logic in the previous post is correct).   So I think there is probably something wrong with your pseudo-code.<br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">The scheme seems to works like this (considering the MPS and PROB calculation arbitrary as you did): <br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">TOP=0x100 &#40;==0x00 modulus 256&#41;<br />VALUE=first 8 bits in the compressed stream<br /><br />for each bit we want to output<br />&nbsp; &nbsp;if&nbsp; VALUE &lt; TOP-PROB<br />&nbsp; &nbsp; &nbsp; output MPS<br />&nbsp; &nbsp; &nbsp; TOP = TOP-PROB<br />&nbsp; &nbsp; &nbsp; if TOP's MSb is 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE &lt;&lt;=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VALUE |= next bit in the compressed stream<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while TOP's MSb is 0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TOP &lt;&lt;= 1<br />&nbsp; &nbsp;else<br />&nbsp; &nbsp; &nbsp; output LPS<br />&nbsp; &nbsp; &nbsp; VALUE &lt;&lt;=1<br />&nbsp; &nbsp; &nbsp; VALUE |= next bit in the compressed stream</div></div><br />I don't agree with this.  It will work for a sequence of MPS, but throw some LPS in there and it can screw up.<br /><br />The reason is the need to keep track of the current range (you need more than just the TOP value).  Currently you have BOTTOM fixed at zero, which is not possible (except, as mentioned above, for very specific choices of PROB values, which isn't the case here).  Consider for example the first PROB value: $5A.  Using your notation, initially TOP=$00, BOT=$00.  If first bit is MPS, then it is updated to TOP=$A6,BOT=$00.  But if first bit is LPS then it <em>should</em> be updated to TOP=$00, BOT=$A6.  Your code shifts once and considers BOT to still be zero.  This is as if BOT=$80... which would overlap the range we already set to MPS.<br /><br />I think the decompressor would look like (inverting my code above):<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Possible outline for SPC7110 compatible Arithmetic _de_compressor<br />note: PROB is the probability of getting a LPS <br /><br />TOP=$FF <br />BOT=$00 <br />VALUE = first 8 bits of compressed data<br /><br />For each bit in decompressed data <br />&nbsp; get PROB and MPS <br />&nbsp; if TOP-BOT&lt;PROB <br />&nbsp; &nbsp; if high bit of VALUE == 0<br />&nbsp; &nbsp; &nbsp; output MPS <br />&nbsp; &nbsp; &nbsp; TOP = $7F <br />&nbsp; &nbsp; else <br />&nbsp; &nbsp; &nbsp; output LPS<br />&nbsp; &nbsp; &nbsp; BOT = $80 <br />&nbsp; &nbsp; endif <br />&nbsp; elseif VAL &lt;= TOP-PROB<br />&nbsp; &nbsp; output MPS<br />&nbsp; &nbsp; TOP = TOP - PROB <br />&nbsp; else<br />&nbsp; &nbsp; output LPS<br />&nbsp; &nbsp; BOT = TOP - PROB + 1 <br />&nbsp; endif <br /><br />&nbsp; ** shift out determined bits **<br />&nbsp; loop<br />&nbsp; &nbsp; if highbit BOT==0 &amp;&amp; highbit TOP==1<br />&nbsp; &nbsp; &nbsp; break;<br />&nbsp; &nbsp; endif<br />&nbsp; &nbsp; BOT = &#40;BOT&lt;&lt;1&#41;<br />&nbsp; &nbsp; TOP = &#40;TOP&lt;&lt;1&#41;+1<br />&nbsp; &nbsp; VAL = &#40;VAL&lt;&lt;1&#41; + next bit from compressed data<br />&nbsp; endloop<br /><br />endfor</div> <br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">I have intentionally left unsaid in which part(s) of the loop PROB is recalculated, as i'm not sure at this point</div><br />If you look at the compressor code, it has to either go at the top or bottom of the for loop... which since it is a loop is the same thing.  So I don't think we need to worry about placement.<br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">I have to add you seem to  be working in this at a big pace, but i'm not being able to follow that pace, so be patient if i don't give quick feedback.</div>
<br />I haven't really done that much yet... but I have rambled a lot <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />
<br />I'm worried this will be like the SDD1; I'll reach my knowledge limit and be stuck.  I think I'm quickly approaching that point.
<br />
<br />And don't worry, I realize this is just a fun hobby for everyone and free time can be sparse. (actually, I feel bad that I didn't get the FEoEZ cart long ago when you wanted to look at this... I thought someone else would get around to it, and instead you ended up having to wait a couple years to play with the data.)
<br />
<br />---------------------------------------
<br />Other notes:
<br />
<br />SPC7110 memory map tests
<br />The registers that DarkForce lists are <em>literally</em> the only registers in that region.  All the spare bytes around there are unmapped and just usually return the last value on the data bus (open bus).
<br />
<br />bank $50 just looks like all zeros, until a decompression is started with $480B set to $02 (I only tried the values 0 and 2), in which case the values are rapidly changing according to my memory viewer (in agreement with DarkForce's document which says reading any byte in bank $50 is like reading $4800).  With every byte read, the counter at $4809 decrements, but decompression doesn't appear to depend on this in anyway (appears to just be a useful feature for software), as you can seemingly read bytes indefinitely and the counter just wraps.
<br />
<br />I can't write to bank $50, or register $4808, and read them back.
<br />
<br />I'm writing this from memory from last night, so hopefully I didn't mess anything up here.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34360"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34360"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34360#p34360"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 2:46 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Excuse me, neviksti, if i don't pay attention to your argument by now. You will understand why. <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />
<br />
<br />I got the way the evolution works. It is using 8 contexts, one per bitplane, and a  index to a PROB table value
<br />
<br />the PROB table has this values
<br />
<br />5A,25,11,8,...
<br />
<br />and all the contexts are initialized at the index 0 (5A)
<br />
<br />Then, following my pseudo-code, when you are following the "lots of zeros plus one 1" thing, when you are going to output a bit for a given context, you use the current value and, after doing it, if you need to renormalize TOP (the "while TOP's MSb is set to 1" in my pseudo-code) you add 1 to the index for that context.
<br />
<br />Maybe you don't trust the algorithm by now, but i have reproduced completely the table by this method <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />
<br />
<br />Indeed, if i have not failed (i have done this with paper &amp; pencil), i can claim that the table follow like this ("J" is the next value to 8 in the PROB table)
<br />
<br />
<br />5A,5A,5A,5A, 5A,5A,5A,5A,
<br />5A,25,25,5A, 25,25,25,25,
<br />25,25,25,25, 25,11,25,25,
<br />11,25,25,25, 11,11,25,11,
<br />11,25,25,11, 11,11,11,11,
<br />11,25,25,8, 11,11,11,11,
<br />---------------------------------
<br />11,25,11,8,11,11,8,11
<br />11,25,11,8,11,8,8,11
<br />11,25,11,8,8,8,8,11
<br />11,25,8,8,8,8,8,11
<br />11,25,J,8,8,8,8,11
<br />11,25,J,8,...
<br />
<br />I can not follow from that point on, as i need to know the exact value of J.
<br />
<br />I think this is 60% done now <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" />
<br />
<br />EDITED: "A" was a bad choice for the next value to 8... <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /> I was not referring to 0xa=10, but to a unknown number &lt; 8. I have corrected this by using the "J" letter
<br />
<br />EDITED (2): OK; now i have read some of your post. Yeah, maybe something is incorrect with LPS, as, indeed, i have only worked with the "lots of 0's plus a 1 thing". I admit that could be wrong...
<br />
<br />EDITED (3): Of course, the PROB table need to start at something greater thatn 5A, so 5A is not going to be the "index 0". <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

					
							<br /><br />
							<span class="gensmall">Last edited by <a href="./memberlist.php?mode=viewprofile&amp;u=3445">Andreas Naive</a> on Fri Jun 20, 2008 3:14 pm, edited 1 time in total.</span>
						<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34363"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34363"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34363#p34363"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 3:03 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The reason is the need to keep track of the current range (you need more than just the TOP value). Currently you have BOTTOM fixed at zero, which is not possible (except, as mentioned above, for very specific choices of PROB values, which isn't the case here). Consider for example the first PROB value: $5A. Using your notation, initially TOP=$00, BOT=$00. If first bit is MPS, then it is updated to TOP=$A6,BOT=$00. But if first bit is LPS then it should be updated to TOP=$00, BOT=$A6. Your code shifts once and considers BOT to still be zero. This is as if BOT=$80... which would overlap the range we already set to MPS. </div>
<br />
<br />I don't agree. The problem  here is that you always try to associate the 256-values internal variable to an interval *containing* the "next bit" subinterval, but fails to see that, as the interval you are mapping with your internal 8-bits variable is arbitrarily decided by you (*you* meaning: the designer of the scheme), you can always understand that the 8-bits variable maps to an interval starting in the point where the last outputted symbol start so, effectively BOTTOM is identically set to 0 because, *BY DESIGN*, you have decided it to be so.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34370"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34370"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34370#p34370"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 8:01 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">I got the way the evolution works. It is using 8 contexts, one per bitplane, and a  index to a PROB table value<br /><br />...<br />Then, following my pseudo-code, when you are following the "lots of zeros plus one 1" thing, when you are going to output a bit for a given context, you use the current value and, after doing it, if you need to renormalize TOP (the "while TOP's MSb is set to 1" in my pseudo-code) you add 1 to the index for that context.</div><br />Great insight!<br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent">EDITED (3): Of course, the PROB table need to start at something greater thatn 5A, so 5A is not going to be the "index 0". <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div><br />If you look at the evolution when prob=5A, it settles into a 1 bit in -&gt; 1 bit out (the internal state values are the same after every bit).  So it might as well be considered 50% after the little 'startup' cost.<br /><br />---------------<br /><br /><div class="quotetitle">Andreas Naive wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">The reason is the need to keep track of the current range (you need more than just the TOP value). Currently you have BOTTOM fixed at zero, which is not possible (except, as mentioned above, for very specific choices of PROB values, which isn't the case here). Consider for example the first PROB value: $5A. Using your notation, initially TOP=$00, BOT=$00. If first bit is MPS, then it is updated to TOP=$A6,BOT=$00. But if first bit is LPS then it should be updated to TOP=$00, BOT=$A6. Your code shifts once and considers BOT to still be zero. This is as if BOT=$80... which would overlap the range we already set to MPS. </div><br /><br />I don't agree. The problem  here is that you always try to associate the 256-values internal variable to an interval *containing* the "next bit" subinterval, but fails to see that, as the interval you are mapping with your internal 8-bits variable is arbitrarily decided by you (*you* meaning: the designer of the scheme), you can always understand that the 8-bits variable maps to an interval starting in the point where the last outputted symbol start so, effectively BOTTOM is identically set to 0 because, *BY DESIGN*, you have decided it to be so.</div>
<br />It took quite awhile to convince myself on this issue, and is also why I wrote out my logic to see all the steps.  I must say I still disagree with you here.
<br />
<br />BOTTOM <em><span style="text-decoration: underline">can't</span></em> be zero by design here since it is $A6 (before shifting out bits).  As discussed above, the freedom of design choice only allows one to fix BOTTOM=0 in an almost pathological case of specific probability values which depend on each other in a strange way.
<br />
<br />If my example didn't help, try to invert your algorithm into a compressor and you should see the problem.
<br />
<br />---------------------------
<br />
<br />Since it appears the prob values for the first 8 bits are fixed, we should be able to decompress that far as soon as we figure out how they handle the TOP-BOT&lt;PROB case (I gave a possible solution above).  Nothing seemed to work... until I noticed this:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">Look at the transition value for FA-&gt;FB<br />At this point the first seven bits of decompressed data and 5 bits of compressed data are determined, and from nearby transitions we can see:<br /><br />top&nbsp; &nbsp;=FD2FFFFF.... <br />cutoff=FC7C0000...<br />bot&nbsp; &nbsp;=FBC80000....<br /><br />top&nbsp; &nbsp;= 1111 1101 0010 11111111111111111111111111111111...<br />cutoff= 1111 1100 0111 1100000000000000000000000000000...<br />bot&nbsp; &nbsp;= 1111 1011 1100 10000000000000000000000000000000...<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xxx xxxx xx<br /><br />NINE BITS!</div>
<br />So while the probability values taken from the table only have 8 significant figures, the chip must use registers wider than 8 bits.  Since it has 16bit multiplication and counting registers, let's guess it has 16bit registers throughout.
<br />
<br />Knowing this I was then able to figure out that the TOP-BOT&lt;PROB case is resolved by dividing PROB by 2 until that equality is false.
<br />
<br />My code matches the cutoff for all 8 bits now (I can always decompress the first byte correctly).  So I believe the heart of the compressor iteration is exact now and we can focus on how the "bitplane contexts" update.
<br />
<br />---------------
<br />
<br />I've seen a case where PROB=5A and MPS is wrong, and on the return to that bitplane, PROB=25 with MPS changed.  In the long trail of always choosing LPS, I have yet to see a PROB &gt; $5A.  So maybe that really is index 0 of the prob table?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34372"></a>
				<b class="postauthor">Andreas Naive</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34372"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34372#p34372"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 11:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Nov 26, 2007 2:06 am<br /><b>Posts:</b> 104<br /><b>Location:</b> Madrid, Spain
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">So while the probability values taken from the table only have 8 significant figures, the chip must use registers wider than 8 bits. Since it has 16bit multiplication and counting registers, let's guess it has 16bit registers throughout.<br /></div>
<br />
<br />At this point i'm not convinced about this. I would like to make further study before jumping to that conclusion as, after doing some paper &amp; pencil work, i think there could be other possibilities to explain that FA-FB transition.
<br />
<br />I can not work more at this right now, however, so i will say something when it be possible for me to resume the work.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p34374"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34374"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34374#p34374"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jun 20, 2008 11:49 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yeah, there might be details regarding the TOP-BOT&lt;PROB case that I haven't figured out.
<br />
<br />The FF70-&gt;FF72 transition is also giving me similar troubles. It seems to want to use $5A/4 as the probability but I can't figure out a reasonable excuse to set it as such.
<br />
<br />EDIT:
<br />To give an impression of how precise everything needs to be to always get the first byte decompressed correctly, check out the case of decompressing the first byte at 37.  I have checked the cutoff values and they are correct.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; cutoff=A6000000&nbsp; &nbsp; top=FFFF bot=0000 prob=5A00 val=4009&nbsp; mps=0&nbsp; -&gt; 0&nbsp; &nbsp;shift&#40;0&#41;<br />&nbsp; cutoff=4C000000&nbsp; &nbsp; top=A5FF bot=0000 prob=5A00 val=4009&nbsp; mps=0&nbsp; -&gt; 0&nbsp; &nbsp;shift&#40;1&#41;<br />&nbsp; cutoff=1F000000&nbsp; &nbsp; top=97FF bot=0000 prob=5A00 val=8013&nbsp; mps=0&nbsp; -&gt; 1&nbsp; &nbsp;shift&#40;0&#41;<br />&nbsp; cutoff=35800000&nbsp; &nbsp; top=97FF bot=3E00 prob=2D00 val=8013&nbsp; mps=0&nbsp; -&gt; 1&nbsp; &nbsp;shift&#40;0&#41; DIV! prob=5A/2^1<br />&nbsp; cutoff=40C00000&nbsp; &nbsp; top=97FF bot=6B00 prob=1680 val=8013&nbsp; mps=0&nbsp; -&gt; 0&nbsp; &nbsp;shift&#40;0&#41; DIV! prob=5A/2^2 <br />&nbsp; cutoff=3B200000&nbsp; &nbsp; top=817F bot=6B00 prob=0B40 val=8013&nbsp; mps=0&nbsp; -&gt; 1&nbsp; &nbsp;shift&#40;0&#41; DIV! prob=5A/2^3 <br />&nbsp; cutoff=3DF00000&nbsp; &nbsp; top=817F bot=7640 prob=05A0 val=8013&nbsp; mps=0&nbsp; -&gt; 1&nbsp; &nbsp;shift&#40;0&#41; DIV! prob=5A/2^4 <br />&nbsp; cutoff=3F580000&nbsp; &nbsp; top=817F bot=7BE0 prob=02D0 val=8013&nbsp; mps=0&nbsp; -&gt; 1&nbsp; &nbsp;shift&#40;0&#41; DIV! prob=5A/2^5<br /></div><br /><br />Focussing on the 36-&gt;37 transition:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">36-&gt;37<br />At this point only ONE compressed bit and 7 decompressed bits are fully determined.<br /><br />top&nbsp; &nbsp;=40BFFFFFF.... <br />cutoff=3F580000... <br />bot&nbsp; &nbsp;=3DF00000.... <br /><br />top&nbsp; &nbsp;= 0100 0000 1011 11111111111111111111111111111111... <br />cutoff= 0011 1111 0101 1000000000000000000000000000000... <br />bot&nbsp; &nbsp;= 0011 1101 1111 00000000000000000000000000000000... <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;xxx xxxx xxxx x <br /><br />TWELVE BITS!</div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p34396"></a>
				<b class="postauthor">neviksti</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p34396"></a></div><div style="float: right;"><a href="./viewtopic.php?p=34396#p34396"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Mon Jun 23, 2008 2:14 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Thu Jun 22, 2006 11:39 pm<br /><b>Posts:</b> 205
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I borrowed an oscilloscope to do some tests on the feasibility of the FIFO mod.
<br />
<br />First though:
<br />
<br />Kammedo, 
<br />Can you please rewrite your document to make clear what you measured and what you just made 'educated guesses' on.  This is a <em><span style="text-decoration: underline">very</span></em> important distinction.  Currently I've found several errors and I can't tell what can be trusted as a measurement or is just a guess. It looks like you put a good deal of time into that document and unfortunately without that distinction it is almost useless as I need to check everything myself anyway.  So please, please add that distinction to your document.
<br />
<br />Also, you are not numbering all pins the standard way, nor even a consistent way between chips (sometimes you do go counter-clockwise, sometimes you start going around one way and then change directions on the other side, etc.).  The pins should be numbered counter-clockwise from pin 1, which is the marked pin, or is counter-clockwise from the mark on dual inline packages.  Unfortunately you don't even stick to your own numbering for a chip once you numbered it, for you say about the SPC7110 "Pin nr 76 : SRAM 3", and it doesn't connect to pin 3 it connects to pin 26 in your diagram.  Not following the standard numbers makes your document difficult to read, and ambiguous when you change your numbering in the middle.
<br />
<br />And then there are things which are just wrong, for example you say about the SRAM that "pin #26 connected to SNES pin #26 (RESET)" when it actually connects to the SPC7110.  I assume this and other connection mistakes are where you just made guesses instead of measuring.
<br />
<br />So please please fix up your document to make the distinction between measurement and guess clear, and also use standard pin numberings.
<br />
<br />==========================================
<br />The tests:
<br />
<br />All tests done with FEoEZ cart on external cartridge slot of Game Doctor SF3, while running my memory viewer program (which after loads prog to RAM then runs from there) via the SF3.
<br />
<br />Note:
<br />I assumed the SRAM pinout matched HY6264.  I assumed U1 pinout similar to documents online about SNES carts, and assumed U2 pinout similar to x8/x16 44pin Flash chips (which also matches well with online docs about SNES carts).  The x8/x16 I used to check was AM29F400B 44 pin SOIC.
<br />
<br />Note: 
<br />SF3 external cartridge connector:
<br />
<br />All cartridge pins go straight through except: 
<br />1 CLK 
<br />24 CIC data out 
<br />25 CIC data in 
<br />48 BA7 
<br />49 /CART 
<br />55 CIC data out 
<br />56 CIC clk 
<br />
<br />CLK goes through a 74LS00 (NAND gate) with pin8=cart CLK, pin9 =SNES CLK, and pin10=Vcc. 
<br />So the clock line is inverted.
<br />
<br />
<br />FEoEZ cartridge:
<br />Cartridge does not use pad 49 (/CART).
<br />So the SF3 can't prevent it from clashing on the bus.
<br />So how does anything run!?
<br />The SF3 can't boot with cartridge in slot.  But running programs and then inserting the cartridge is fine.  So it sounds like the SF3 can win bus wars with its DRAM, but probably not with its SRAM or ROM?
<br />
<br />--------------------------------
<br />DataROM (U2)
<br />/CE pin 12 -- GND
<br />/OE pin 14 -- normally high. low pulses, two possible timings ~325-330ns or ~230-235ns
<br />
<br />While memory viewer program is looking at $4800-$480F range an no other $48xx regs:
<br />- I see access cycle even when decompression is not active.  Cycle timing in this case seems to always be long cycle.
<br />- After decompression active, cycle timing can be short or long.  Sometimes I've seen two short pulses in a row, separated by ~95-100 ns.
<br />
<br />
<br />Address lines appear to usually be held low.
<br />Positive pulses have two different lengths. ~285-290ns or ~230-235ns
<br />I once saw two short separated by 280ns. 
<br />
<br />Looking at pin10 and pin14.
<br />For long, /OE and address pulse start at roughly the same time.
<br />Same for short pulse (I even saw one of the 'double' pulses).
<br />
<br />When the memory viewer was only looking at $00:0080-$00:00FF, I still saw accesses to U2.
<br />I don't know what these are.  Even resetting the cartridge and never accessing $48xx regs, I still saw this.
<br />Due to the short pulses, and long time between them, I couldn't get a good timing for them.
<br />But they seem to be at least &gt; 1ms apart. (If they are randomly spaced, &lt; 1ms is at least rare.)
<br />
<br />-------------------------------
<br />SRAM  (LH52A64N-YL 64kbits, assume pinout matches HY6264)
<br />
<br />pin 26 (CE)  -- usually low, pulse high 370-375ns
<br />pin 20 (/CE) -- appears to always be low
<br />pin 22 (/OE) -- 230ns cycle
<br />pin 27 (/WR) -- usually high, for SRAM cycle pulse low for about 230-240ns
<br />
<br />write cycle:
<br />CE pulse high starts ~100-105ns before /WR goes low.
<br />
<br />-------------------------------
<br />connections:
<br />
<br />SRAM pin 26 (CE) -&gt; pin76 SPC7110
<br />SRAM pin 20 (/CE) -&gt; pin5 MM1026AF
<br />SRAM pin 22 (/OE) -&gt; cart pad 23 (/RD)
<br />SRAM pin 27 (/WR) -&gt; cart pad 54 (/WR)
<br />
<br />U2 ROM pin 12 (/CE) -&gt; GND
<br />U2 ROM pin 14 (/OE) -&gt; pin 48 SPC7110
<br />
<br />U1 ROM pin 31 (/CE) -&gt; GND
<br />U1 ROM pin 22 (/OE) -&gt; pin 47 SPC7110
<br />
<br />note: /CE and /OE were not distinguishable from my tests for the ROM.
<br />However, U2 seems to match most pins of standard x8/x16 memory so I'd guess /CE is grounded and not /OE (which also makes sense to achieve fastest access times).
<br />
<br />=======================================
<br />What this means:
<br />
<br />Problem (when using a copier):
<br />When using a copier, the cartridge is clashing with the copier.  Because I can run programs, clearly the SF3 DRAM is winning the bus war, but this is not good for the devices.  This can be fixed by lifting U1 ROM /OE and fixing it to Vcc.
<br />
<br />FIFO mod feasibility:
<br />Possible, but there are issues
<br />- SRAM /CS can't be used as a signal now.  Another chip is needed, such as a 74ACT138.  Attach FIFO /W to the logic such that it goes low when /WR low, BA7 high, and other conditions if desired.
<br />
<br />- The unknown, while rare, U2 accesses are a problem for the FIFO.  The accesses seem rare enough that we can probably load up the FIFO and read out a decompression before it does anything.  However the result will have to be checked several times before saving the result.
<br />
<br />kyuusaku's design is more trustworthy once connected and working, but requires many more connections and chips, and is somewhat harder to debug if there are wire connection issues.  So if someone is willing to make a PCB and go that route, it is probably the way to go.  However the FIFO way is cheap enough (and any connections you make for that will be needed for kyuusaku's design) that it may be worth a quick try if someone can set it up.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=716"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=12&amp;t=4106&amp;start=120"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=12"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=12&amp;t=4106"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>9</strong> of <strong>21</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 315 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"><b><a href="#" onclick="jumpto(); return false;" title="Click to jump to pageâ€¦">Go to page</a> <a href="./viewtopic.php?f=12&amp;t=4106&amp;start=105">Previous</a>&nbsp;&nbsp;<a href="./viewtopic.php?f=12&amp;t=4106">1</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=75">6</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=90">7</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=105">8</a><span class="page-sep">, </span><strong>9</strong><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=135">10</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=150">11</a><span class="page-sep">, </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=165">12</a><span class="page-dots"> ... </span><a href="./viewtopic.php?f=12&amp;t=4106&amp;start=300">21</a> &nbsp;<a href="./viewtopic.php?f=12&amp;t=4106&amp;start=135">Next</a></b></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=25">Other</a> &#187; <a href="./viewforum.php?f=12">SNESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 1 guest</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="4106" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="27">&nbsp; &nbsp;NESdev Middle East</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12" selected="selected">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - file(1) magic(5) for iNES and UNIF ROMs</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">file(1) magic(5) for iNES and UNIF ROMs</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9208">http://forums.nesdev.com/viewtopic.php?f=3&amp;t=9208</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sat Aug 11, 2012 2:06 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>file(1) magic(5) for iNES and UNIF ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />If you use unix, you might use the file(1) command. You might, like me, want to be able to look at an rom image cursorally without having to manually decode the first 16 bytes of the .NES file. If so, you might like this. For NES2 roms, it produces output that looks like <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">TetrisMMC3.nes: iNES2 ROM, Mapper 0x004, submapper 0, 0x002x16k PRG, 0x002x8k CHR, no PRGRAM, no CHRRAM, [NTSC], [Horz]</tt><br /><br />Copy or append it to /etc/magic or ~/.magic, depending on your version of file(1).<br /><br />edit: Now that we have an attachment mechanism here, added to the forum instead; also changes in the syntax used by file(1) require a trivial change to the &quot;default&quot; directives.

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=10277">iNESmagic.txt</a> [7.57 KiB]
			</span><br />
			<span class="gensmall">Downloaded 33 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Sun Aug 12, 2012 3:10 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Can suppport also for NES 2.0, UNIF, DotFami, NSF, NSFe, and NSF2, be added?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Dwedit</b> [ Sun Aug 12, 2012 6:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I think the first post said that it already did NES 2.0 roms.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Sun Aug 12, 2012 8:14 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Dwedit wrote:</div><div class="quotecontent">I think the first post said that it already did NES 2.0 roms.</div>Yes, you are correct, I just forgot about that at first but now I can see that you are correct. That still doesn't have to do with the other formats though.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Sun Aug 12, 2012 9:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Debian (and therefore Ubuntu) are already distributed supporting NSF parsing; I wasn't able / didn't try very hard to find a description for UNIF or the expansions to NSF.<br /><br />I'll wait 'til you finish .FAMI before I look at supporting it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>zzo38</b> [ Sun Aug 12, 2012 10:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">lidnariq wrote:</div><div class="quotecontent">Debian (and therefore Ubuntu) are already distributed supporting NSF parsing; I wasn't able / didn't try very hard to find a description for UNIF or the expansions to NSF.</div>OK.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'll wait 'til you finish .FAMI before I look at supporting it.</div>OK.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Mon Aug 13, 2012 7:16 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES and UNIF ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />It turns out UNIF is even more obnoxious to implement using magic(5)'s syntax, but I've updated the archive (<!-- m --><a class="postlink" href="http://eamp.org/li/iNESmagic.zip">http://eamp.org/li/iNESmagic.zip</a><!-- m -->) with two different implementations. Both have problems.<br /><br />Because UNIF distributes its metadata all over the image, and file(1) only ever reads the first 100kB from disk, chances are semirandom as to whether you'll actually get any useful information out of any given UNIF image.<br /><br />I initially tried going and using indirect math, but math made it impossible to calculate the location of a third tag in the file; additionally I'd have to encode tests for every permutation the tags can arrive in.<br /><br />The first implementation (UNIF1.txt) uses magic(5)'s <strong>indirect</strong> command, which has the downside that it horribly pollutes the search space, and other files can be parsed as chunks of a UNIF file or vice versa.<br />It looks like: <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">NES Color Bars Demo V2 by Quietust &#40;PD&#41; [U].unf:              UNIFv7, [Vert], mapper:&quot;NES-NROM-128&quot;, named:&quot;Color Bars demo, version 2&quot;, [NTSC], 16384 B PRG, 8192 B CHR</tt><br />The second implementation (UNIF2.txt) uses magic(5)'s <strong>search</strong> command, which doesn't follow the chunks and so can be tricked into parsing non-chunks as real data.<br />When all goes well it looks like <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">NES Color Bars Demo V2 by Quietust &#40;PD&#41; [U].unf:              UNIFv7, 16384 B PRG, 8192 B CHR, mapper:&quot;NES-NROM-128&quot;, named:&quot;Color Bars demo, version 2&quot;, [NTSC], [Vert]</tt>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Jarhmander</b> [ Mon Aug 20, 2012 6:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I noticed on my Linux machine there's even file(1) support for iNES1 files, (shows mirroring PRG size and CHR size).<br />Your contribution is useful though because now it shows the MAPPER <img src="./images/smilies/icon_wink.gif" alt=";)" title="Wink" /> <br /><br />Thanks!

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>lidnariq</b> [ Tue Sep 26, 2017 8:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: file(1) magic(5) for iNES and UNIF ROMs</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I noticed that new versions of file(1) support naming headers, and invoking them at a specified offset into the file.<br /><br />Which suddenly makes parsing chunked formats like UNIF headers really easy <em>and</em> robust! So here's my UNIF parser that uses these new-ish &quot;name&quot; and &quot;use&quot; commands. (It's almost identical to the previous version that used &quot;indirect&quot;, but &quot;indirect&quot; just says &quot;start over from scratch&quot;, and could match against things outside of our desired parse tree, as well as letting other things incorrectly match against internal headers)

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=10278">UNIFmagic.txt</a> [2.12 KiB]
			</span><br />
			<span class="gensmall">Downloaded 33 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
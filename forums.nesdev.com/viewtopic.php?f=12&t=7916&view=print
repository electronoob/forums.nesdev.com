<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - emulator crashing when sep/rep processor status bits</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">emulator crashing when sep/rep processor status bits</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=12&amp;t=7916">http://forums.nesdev.com/viewtopic.php?f=12&amp;t=7916</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dext3r</b> [ Tue Jun 28, 2011 2:11 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>emulator crashing when sep/rep processor status bits</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />hello, im using Neviksti's snes-starterkit (WLA-DX assembler) and messing with the example Hello.asm...
<br />
<br />let me show some example code:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;<br />; some other init code/misc stuff goes here....<br /><br />; do some math with the decimal flag clear<br />&nbsp; &nbsp;PrintString &quot;\nDecimal flag clear: 9+8 = &quot;<br />&nbsp; &nbsp;lda #9<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #8<br />&nbsp; &nbsp;sta var2&nbsp; &nbsp;<br />&nbsp; &nbsp;PrintNum var2<br /><br />;this is what i put in<br />&nbsp; &nbsp;rep #$30 ;16 bit A, X, Y<br />&nbsp; &nbsp;lda #$FEEB<br />&nbsp; &nbsp;sta $0000<br />&nbsp; &nbsp;sep #$30 ;8 bit A,X,Y<br />;end of 'this is what i put in'<br /><br />forever:<br />&nbsp; &nbsp;wai&nbsp; &nbsp;;wait for next frame<br />&nbsp; &nbsp;;do whatever you feel like here&nbsp; &nbsp;<br />&nbsp; &nbsp;;let's print the current frame number<br />&nbsp; &nbsp;SetCursorPos 20, 10<br />&nbsp; &nbsp;ldy #FrameNum<br />&nbsp; &nbsp;PrintString &quot;Frame num = %d&nbsp; &nbsp; &quot;<br />&nbsp; &nbsp;jmp forever</div>
<br />
<br />Snes9x Geiger's Debugger will crash every time (as in program hard crash)
<br />bsnes will just give be a blank screen.
<br />
<br />Why is this happening? I was told to look at the output generated by WLA-DX after it processes the macros, but I'm not sure how to do that. I do suspect that there is an issue with the macros here, I just don't know how to pinpoint it.
<br />
<br />I also thought maybe interrupt had something to do with it, like it was trying to run some other code in the middle of the thing i inserted, so i 
<br />disabled interrupts before and then enabled them after my snippet but it did not help. 
<br />
<br />any help would be appreciated, thanks.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Tue Jun 28, 2011 10:08 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't know why Snes9x crashes. What I can say is that you should ditch Snes9x right away and use BSNES instead, as it's a lot more accurate and also has a debugger.
<br />
<br />What were the register size bits set to before the instructions you inserted? You should make sure they're set to the same as they were before. Otherwise you might start executing garbage.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dext3r</b> [ Wed Jun 29, 2011 9:11 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent">I don't know why Snes9x crashes. What I can say is that you should ditch Snes9x right away and use BSNES instead, as it's a lot more accurate and also has a debugger.<br /><br />What were the register size bits set to before the instructions you inserted? You should make sure they're set to the same as they were before. Otherwise you might start executing garbage.</div>
<br />
<br />im not sure what they were set to before but im 100% sure that its crashing at the first occurrence of modifying the register size bits. (so its not even getting a chance to execute garbage code)
<br />
<br />i can fiddle with the decmial and IRQ, etc flags all day but as soon as i touch the register size, everything breaks.
<br />
<br />i am not running in 6502 emulation mode either, at least i dont think i am. i put this at the start of my code:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;clc<br />&nbsp; &nbsp;xce</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mic_</b> [ Wed Jun 29, 2011 9:50 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I couldn't even assemble the code if I added those 4 lines. The assembler chokes at an LDX instruction in SetCursorPos that is trying to load an immediate larger than 8 bits after you've set all the registers to 8-bit with SEP #$30.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>psycopathicteen</b> [ Wed Jun 29, 2011 10:27 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />ZSNES and SNES9x are cheating emulators that hide technical shortcommings with game-specific patching.
<br />
<br />I find all the interrupt stuff confusing and not very well documented.  I just had to keep manipulating my code until it worked.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>MottZilla</b> [ Wed Jun 29, 2011 1:36 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Solution, use BSNES. It's the best emulator for testing things. But testing in real hardware is always going to be the only way to really know if your programs work or not.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>dext3r</b> [ Wed Jun 29, 2011 2:48 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b></b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">mic_ wrote:</div><div class="quotecontent">I couldn't even assemble the code if I added those 4 lines. The assembler chokes at an LDX instruction in SetCursorPos that is trying to load an immediate larger than 8 bits after you've set all the registers to 8-bit with SEP #$30.</div>
<br />
<br />Yeah not sure how i was getting the code to assemble...i restarted over and youre right, it would not assemble (which makes sense).
<br />(i know bsnes is the accuracy emulator but it wasnt performing as expected in bsnes either, meaning the problem is my ability to code <img src="./images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> )
<br />
<br />i've been messing with it more and i think i have got it working.
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">forever:<br />&nbsp; &nbsp;wai&nbsp; &nbsp;;wait for next frame<br />&nbsp; &nbsp;;do whatever you feel like here&nbsp; &nbsp;<br />&nbsp; &nbsp;;let's print the current frame number<br />&nbsp; &nbsp;;rep #$10<br />&nbsp; &nbsp;SetCursorPos 20, 10<br />&nbsp; &nbsp;ldy #FrameNum<br />&nbsp; &nbsp;PrintString &quot;Frame num = %d&nbsp; &nbsp; &quot;<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;rep #$20<br />&nbsp; &nbsp;lda #$EFBE<br />&nbsp; &nbsp;sta $0000<br />&nbsp; &nbsp;sep #$20<br />&nbsp; &nbsp;<br />jmp forever</div>
<br />
<br />so in conclusion i think i'm just a retard of some kind. thank you for the help.

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>1</strong> of <strong>1</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - Ludum Dare</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">Ludum Dare</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=22&amp;t=15192">http://forums.nesdev.com/viewtopic.php?f=22&amp;t=15192</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Sat Dec 10, 2016 7:24 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nice duck.<br /><br />(o)&lt; QUACK

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Sun Dec 11, 2016 2:12 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />That's actually a poorly drawn fireball - I had originally seen them as moving down-left, hence the angle!<br /><br />For surrealism, have you seen the games by <a href="https://www.kickstarter.com/projects/2136199701/moments-of-silence" class="postlink">my former selves (link to one of their old kickstarters)</a>? I believe I backed one or two on kickstarter. They're RPGmaker so the interactivity is rather limited, but the aesthetics are quite wonderful - they're like moving Hieronymus Bosch paintings.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Sun Dec 11, 2016 5:30 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Getting closer:<br /><br /><div class="attachtitle">Attachment:</div><div class="attachcontent">
			<img src="./download/file.php?id=7238" alt="shenzenminiclassic.gif" /><br />
			<span class="gensmall">shenzenminiclassic.gif [ 286.68 KiB | Viewed 2763 times ]</span>
		

		<br />
	</div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Tue Dec 13, 2016 5:19 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />This is now released: <br /><br /><a href="https://team-disposable.itch.io/you-are-insignificant" class="postlink">https://team-disposable.itch.io/you-are-insignificant</a><br /><br />Thanks everyone, comments and criticism appreciated. Thanks also for the comments while making the thing, nesdoug's tutorials, and all the help on the newbie forum in general. It's an excellent community, and much appreciated.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Krill</b> [ Fri Dec 16, 2016 7:59 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Good job! It isn't easy getting a game playable by the end of Ludum Dare. <br />I enjoyed your game and made it to the end, although the delay when trying to move really threw me off while attempting many of the jumps.<br /><br />How was your experience with making an NES game for Ludum Dare?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>chromableedstudios</b> [ Mon Dec 19, 2016 4:53 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Really impressive to get a nes game out for the LD!<br /><br />I can haz source?  <img src="./images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /> <br /><br />Here is my feeble attempt: <!-- m --><a class="postlink" href="http://ludumdare.com/compo/ludum-dare-37/?action=preview&amp;uid=65233">http://ludumdare.com/compo/ludum-dare-3 ... &amp;uid=65233</a><!-- m --><br /><br />I took it as an excuse to try and download/test out the latest xamarin/mono android support.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Tue Dec 20, 2016 3:33 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Your game looks good, I'll definitely try it out. <br /><br />I'm not releasing the full source right now as it's a bit of a pig's ear, having been put together in three days. I'll probably release it if/when I clean it up a bit, but right now I'm a bit busy working on my compo entry. <br /><br />Is there anything in it you where interested in? I'd be happy to pull out bits and explain them. Nothing is handled in a particularly elegant way, however!<br /><br />All of the levels are raw byte by byte maps produced in the NES Screen tool - I did this as I also use them for collision detection, which is how the spikes, the lava, the gold and the player physics work.<br /><br />The enemies are a set of arrays, the main one being &quot;enemy_active&quot;, which the central routine runs a for loop against, like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">for(index = 0; index &lt; sizeof(enemy_active);++index)<br />{<br />&nbsp; &nbsp; &nbsp;if(enemy_active&#91;index&#93; == 0x01)<br />&nbsp; &nbsp; &nbsp;{<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//do enemy routine<br />&nbsp; &nbsp; &nbsp;}<br /><br />}<br /></div><br /><br />There are then a bunch of other arrays - enemy_x, enemy_y, enemy_directionfacing, etc - all of which correspond to the same index as enemy_active.<br /><br />Those two and the player physics are pretty much the bulk of the game. The player physics are pretty basic - I haven't noticed the lag in movement myself, but it is likely because I am using an 8.8 movement system - so there are eight positions for each pixel. <br /><br />Jumping is something I would definitely improve on if I did this again. Currently, the longer you press the jump button, the more is added to the magnificently named variable player_remainingjumpstrengthtoapply. Chunks of this are then whacked on to the players Y value each frame until it is zero, or the player hits their head. Gravity is actually running the whole time on them, so it just kind of naturally takes over, much like in real life. Hence the awkward jumping. I would go for velocity based system if I were doing it again.<br /><br />The big thing that I've found programming in c on the NES is that you really, really need to appreciate it is just converting everything to 3 registers in the backend. So there lots of occasions where I'd like to be comparing two arrays together, like this:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">if(enemy_destination_x&#91;index&#93; &gt; enemy_x&#91;index&#93;)<br />{<br />//do something<br />}<br /></div><br /><br />Only the result of the above will default to true, no matter what the values in enemy_destination_x and enemy_x.<br /><br />Storing one of the values to a var, and then doing the comparison, makes it work properly however. So this works:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">index2 = enemy_x&#91;index&#93;;<br />if(enemy_destination_x&#91;index&#93; &gt; index2)<br />{<br />//do something<br />}<br /></div><br /><br />Apart from the obvious stuff, like yes, even I can technically put a NES game together, this is the most important thing I learned - if a routine isn't working, it's probably too complex for the machine, and you need to shift some of the values off the registers and in to RAM. At least, I think that is what is happening. Regardless, it works, as the above is a literal example that had me stumped for a good hour or two before I figured out the answer.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>calima</b> [ Wed Dec 21, 2016 4:43 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Are you using an old version of cc65? I don't believe I've ever hit a bug like that where a two-array comparison would produce wrong results. It's slow yes, but correct.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Wed Dec 21, 2016 10:55 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />cc65 V2.15 pre-compiled windows binary, which appears to be the same version in the current downloadable windows snapshot. <br /><br />I can post an example later, if you like. I haven't checked what it's doing in the ASM though - it's just a presumption based on the fact an assignment of the right value to a var in C fixes it. Similar things have happened in both the ludum dare project and my latest project.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Wed Dec 21, 2016 11:03 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">team_disposable wrote:</div><div class="quotecontent">I can post an example later, if you like.</div><br />Please do. If the compiler is generating incorrect code that is a serious bug (and surprising).

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>calima</b> [ Wed Dec 21, 2016 11:15 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yep, cc65 is actively maintained, so any bugs should be reported with test cases.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Wed Dec 21, 2016 11:36 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Here's a rom that demonstrates both cases. Apologies, I just figured this was a regular thing - I'm sure it must be something I am doing, if not someone else would have noticed, no?<br /><br />Pressing select switches between the two.<br /><br />Please ignore the garish palettes and sparse rooms - I'm redecorating and haven't chosen a tone yet.<br /><br />Here is the code difference (warning - big ol' chunk of code):<br /><br />If no one spots anything stupid in the below, I'll go and report it to the CC65 people. And yes, index and index2 have a value in them. Do you want to see the ASM as well?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(debug_flip == 0x00)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;index2 = enemy_x&#91;index&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_x&#91;index&#93; &gt; index2)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;++enemy_x&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Right;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_x&#91;index&#93; &lt; index2)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--enemy_x&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Left;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;index2 = enemy_y&#91;index&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_y&#91;index&#93; &gt; index2){<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;++enemy_y&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Down;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_y&#91;index&#93; &lt; index2)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--enemy_y&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Up;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}//end of debug flip is 0<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(debug_flip == 0x01)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;//index2 = <br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_x&#91;index&#93; &gt; enemy_x&#91;index&#93;)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;++enemy_x&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Right;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_x&#91;index&#93; &lt; enemy_x&#91;index&#93;)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--enemy_x&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Left;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;//index2 = enemy_y&#91;index&#93;;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_y&#91;index&#93; &gt; enemy_y&#91;index&#93;){<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;++enemy_y&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Down;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;else<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if(enemy_destination_y&#91;index&#93; &lt; enemy_y&#91;index&#93;)<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;{<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;--enemy_y&#91;index&#93; ;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;enemy_directionfacing&#91;index&#93; = Going_Up;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}//end of debug flip is 1<br /></div>

		
			<br clear="all" /><br />

			<table class="tablebg" width="100%" cellspacing="1">
			<tr>
				<td><b class="genmed">Attachments: </b></td>
			</tr>
			
				<tr>
					<td>
			<span class="genmed">
				<img src="./styles/subsilver2/imageset/icon_topic_attach.gif" width="14" height="18" alt="" title="" /> 
				<a href="./download/file.php?id=7375">compo2.nes</a> [24.02 KiB]
			</span><br />
			<span class="gensmall">Downloaded 51 times</span>
		

		<br />
	</td>
				</tr>
			
			</table>
		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Wed Dec 21, 2016 12:27 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">team_disposable wrote:</div><div class="quotecontent">If no one spots anything stupid in the below</div><br />I don't see anything wrong with it offhand, though we're lacking the definition of index2 and other values, which could be important.<br /><br /><div class="quotetitle">team_disposable wrote:</div><div class="quotecontent">Do you want to see the ASM as well?</div><br />That would be helpful. It wouldn't be very easy to find the generated code in the ROM based on the C code.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>team_disposable</b> [ Wed Dec 21, 2016 12:42 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Going_Left, Going_Right etc are an enum.<br />enemy_destination_x, enemy_x, and its y counterparts are variable arrays populated from set of const arrays when the player enters a room.<br /><br />It would seem the bug would probably be in the first comparison, and replicated in the others, so I've posted the first loops first. I'm not too fussed as I have a solution, so let me know if digging through ASM isn't your thing and I'll just go bugtrack it over at CC65.<br /><br />here is the buggy first loop:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">;<br />; if(enemy_destination_x&#91;index&#93; &gt; enemy_x&#91;index&#93;)<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;pusha0<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;tosicmp0<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2671<br />&nbsp; &nbsp;beq&nbsp; &nbsp; &nbsp;L2671<br />;<br />; ++enemy_x&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_x)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_x)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2679<br />&nbsp; &nbsp;inx<br />L2679:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Right;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$00<br /></div><br /><br />the non-buggy first loop:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent"><br />;<br />; index2 = enemy_x&#91;index&#93;;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_x,y<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;_index2<br />;<br />; if(enemy_destination_x&#91;index&#93; &gt; index2)<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_x,y<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc&nbsp; &nbsp; &nbsp;_index2<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L263C<br />&nbsp; &nbsp;beq&nbsp; &nbsp; &nbsp;L263C<br />;<br />; ++enemy_x&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_x)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_x)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2642<br />&nbsp; &nbsp;inx<br />L2642:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Right;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$00<br /><br /></div><br /><br />Here's the full ASM of the buggy if loop:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;<br />;<br />; if(debug_flip == 0x01)<br />;<br />L2832:&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_debug_flip<br />&nbsp; &nbsp;cmp&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;jne&nbsp; &nbsp; &nbsp;L266F<br />;<br />; if(enemy_destination_x&#91;index&#93; &gt; enemy_x&#91;index&#93;)<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;pusha0<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;tosicmp0<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2671<br />&nbsp; &nbsp;beq&nbsp; &nbsp; &nbsp;L2671<br />;<br />; ++enemy_x&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_x)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_x)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2679<br />&nbsp; &nbsp;inx<br />L2679:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Right;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$00<br />;<br />; else<br />;<br />&nbsp; &nbsp;jmp&nbsp; &nbsp; &nbsp;L2830<br />;<br />; if(enemy_destination_x&#91;index&#93; &lt; enemy_x&#91;index&#93;)<br />;<br />L2671:&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;pusha0<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_x,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;tosicmp0<br />&nbsp; &nbsp;bcs&nbsp; &nbsp; &nbsp;L267F<br />;<br />; --enemy_x&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_x)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_x)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2687<br />&nbsp; &nbsp;inx<br />L2687:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Left;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$01<br />;<br />; else<br />;<br />&nbsp; &nbsp;jmp&nbsp; &nbsp; &nbsp;L2830<br />;<br />; if(enemy_destination_y&#91;index&#93; &gt; enemy_y&#91;index&#93;){<br />;<br />L267F:&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_y,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;pusha0<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_y,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;tosicmp0<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L268D<br />&nbsp; &nbsp;beq&nbsp; &nbsp; &nbsp;L268D<br />;<br />; ++enemy_y&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_y)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_y)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L2695<br />&nbsp; &nbsp;inx<br />L2695:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Down;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$03<br />;<br />; else<br />;<br />&nbsp; &nbsp;jmp&nbsp; &nbsp; &nbsp;L2830<br />;<br />; if(enemy_destination_y&#91;index&#93; &lt; enemy_y&#91;index&#93;)<br />;<br />L268D:&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_destination_y,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;pusha0<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;_enemy_y,y<br />&nbsp; &nbsp;jsr&nbsp; &nbsp; &nbsp;tosicmp0<br />&nbsp; &nbsp;bcs&nbsp; &nbsp; &nbsp;L266F<br />;<br />; --enemy_y&#91;index&#93; ;<br />;<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#&lt;(_enemy_y)<br />&nbsp; &nbsp;ldx&nbsp; &nbsp; &nbsp;#&gt;(_enemy_y)<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;bcc&nbsp; &nbsp; &nbsp;L26A3<br />&nbsp; &nbsp;inx<br />L26A3:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;ptr1<br />&nbsp; &nbsp;stx&nbsp; &nbsp; &nbsp;ptr1+1<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;#$00<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;(ptr1),y<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc&nbsp; &nbsp; &nbsp;#$01<br />&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;(ptr1),y<br />;<br />; enemy_directionfacing&#91;index&#93; = Going_Up;<br />;<br />&nbsp; &nbsp;ldy&nbsp; &nbsp; &nbsp;_index<br />&nbsp; &nbsp;lda&nbsp; &nbsp; &nbsp;#$02<br />L2830:&nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp;_enemy_directionfacing,y<br /></div>

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Wed Dec 21, 2016 9:55 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: Ludum Dare</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I don't actually see errors in the disassembly. I think the code its producing is actually correct.<br /><br />By tracing that function in your running ROM I think the error is with your &quot;sp&quot; variable, which is supposed to point to the C stack area, but looks like you have it initialized to 0 instead. (Follow the value of $8A in the trace, uses of the C stack are trying to push variables to ROM at ~$FFFE as a result.)<br /><br />The reason your workaround &quot;fixes&quot; it is that it doesn't happen to use the C stack, but I'm tremendously surprised you haven't seen huge errors elsewhere yet.<br /><br />Here's an example trace:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">A:01 X:00 Y:00 S:FB P:nvUbdIZC&nbsp; &nbsp; &nbsp;$C5D9: A4 0E&nbsp; &nbsp; &nbsp;LDY $000E = #$00<br />A:01 X:00 Y:00 S:FB P:nvUbdIZC&nbsp; &nbsp; &nbsp;$C5DB: B9 58 00&nbsp; LDA $0058,Y @ $0058 = #$60<br />A:60 X:00 Y:00 S:FB P:nvUbdIzC&nbsp; &nbsp; &nbsp;$C5DE: 20 A4 CD&nbsp; JSR $CDA4<br />A:60 X:00 Y:00 S:F9 P:nvUbdIzC&nbsp; &nbsp; &nbsp; &nbsp;$CDA4: A2 00&nbsp; &nbsp; &nbsp;LDX #$00<br />A:60 X:00 Y:00 S:F9 P:nvUbdIZC&nbsp; &nbsp; &nbsp; &nbsp;$CDA6: 48&nbsp; &nbsp; &nbsp; &nbsp; PHA<br />A:60 X:00 Y:00 S:F8 P:nvUbdIZC&nbsp; &nbsp; &nbsp; &nbsp; $CDA7: A5 8A&nbsp; &nbsp; &nbsp;LDA $008A = #$00<br />A:00 X:00 Y:00 S:F8 P:nvUbdIZC&nbsp; &nbsp; &nbsp; &nbsp; $CDA9: 38&nbsp; &nbsp; &nbsp; &nbsp; SEC<br />A:00 X:00 Y:00 S:F8 P:nvUbdIZC&nbsp; &nbsp; &nbsp; &nbsp; $CDAA: E9 02&nbsp; &nbsp; &nbsp;SBC #$02<br />A:FE X:00 Y:00 S:F8 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp; $CDAC: 85 8A&nbsp; &nbsp; &nbsp;STA $008A = #$00<br />A:FE X:00 Y:00 S:F8 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp; $CDAE: B0 02&nbsp; &nbsp; &nbsp;BCS $CDB2<br />A:FE X:00 Y:00 S:F8 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp; $CDB0: C6 8B&nbsp; &nbsp; &nbsp;DEC $008B = #$00<br />A:FE X:00 Y:00 S:F8 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp; $CDB2: A0 01&nbsp; &nbsp; &nbsp;LDY #$01<br />A:FE X:00 Y:01 S:F8 P:nvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp; $CDB4: 8A&nbsp; &nbsp; &nbsp; &nbsp; TXA<br />A:00 X:00 Y:01 S:F8 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp; $CDB5: 91 8A&nbsp; &nbsp; &nbsp;STA ($8A),Y @ $FFFF = #$C0<br />A:00 X:00 Y:01 S:F8 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp; $CDB7: 68&nbsp; &nbsp; &nbsp; &nbsp; PLA<br />A:60 X:00 Y:01 S:F9 P:nvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CDB8: 88&nbsp; &nbsp; &nbsp; &nbsp; DEY<br />A:60 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CDB9: 91 8A&nbsp; &nbsp; &nbsp;STA ($8A),Y @ $FFFE = #$AA<br />A:60 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CDBB: 60&nbsp; &nbsp; &nbsp; &nbsp; RTS (from $CDA4) ---------------------------<br />A:60 X:00 Y:00 S:FB P:nvUbdIZc&nbsp; &nbsp; &nbsp;$C5E1: A4 0E&nbsp; &nbsp; &nbsp;LDY $000E = #$00<br />A:60 X:00 Y:00 S:FB P:nvUbdIZc&nbsp; &nbsp; &nbsp;$C5E3: B9 30 00&nbsp; LDA $0030,Y @ $0030 = #$67<br />A:67 X:00 Y:00 S:FB P:nvUbdIzc&nbsp; &nbsp; &nbsp;$C5E6: 20 2F CD&nbsp; JSR $CD2F<br />A:67 X:00 Y:00 S:F9 P:nvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD2F: A2 00&nbsp; &nbsp; &nbsp;LDX #$00<br />A:67 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD31: 85 8C&nbsp; &nbsp; &nbsp;STA $008C = #$3F<br />A:67 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD33: 86 8D&nbsp; &nbsp; &nbsp;STX $008D = #$02<br />A:67 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD35: A0 00&nbsp; &nbsp; &nbsp;LDY #$00<br />A:67 X:00 Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD37: B1 8A&nbsp; &nbsp; &nbsp;LDA ($8A),Y @ $FFFE = #$AA<br />A:AA X:00 Y:00 S:F9 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD39: AA&nbsp; &nbsp; &nbsp; &nbsp; TAX<br />A:AA X:AA Y:00 S:F9 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD3A: E6 8A&nbsp; &nbsp; &nbsp;INC $008A = #$FE<br />A:AA X:AA Y:00 S:F9 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD3C: D0 02&nbsp; &nbsp; &nbsp;BNE $CD40<br />A:AA X:AA Y:00 S:F9 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD40: B1 8A&nbsp; &nbsp; &nbsp;LDA ($8A),Y @ $FFFF = #$C0<br />A:C0 X:AA Y:00 S:F9 P:NvUbdIzc&nbsp; &nbsp; &nbsp; &nbsp;$CD42: E6 8A&nbsp; &nbsp; &nbsp;INC $008A = #$FF<br />A:C0 X:AA Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD44: D0 02&nbsp; &nbsp; &nbsp;BNE $CD48<br />A:C0 X:AA Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD46: E6 8B&nbsp; &nbsp; &nbsp;INC $008B = #$FF<br />A:C0 X:AA Y:00 S:F9 P:nvUbdIZc&nbsp; &nbsp; &nbsp; &nbsp;$CD48: 38&nbsp; &nbsp; &nbsp; &nbsp; SEC<br />A:C0 X:AA Y:00 S:F9 P:nvUbdIZC&nbsp; &nbsp; &nbsp; &nbsp;$CD49: E5 8D&nbsp; &nbsp; &nbsp;SBC $008D = #$00<br />A:C0 X:AA Y:00 S:F9 P:NvUbdIzC&nbsp; &nbsp; &nbsp; &nbsp;$CD4B: D0 09&nbsp; &nbsp; &nbsp;BNE $CD56<br />A:C0 X:AA Y:00 S:F9 P:NvUbdIzC&nbsp; &nbsp; &nbsp; &nbsp;$CD56: 50 FD&nbsp; &nbsp; &nbsp;BVC $CD55<br />A:C0 X:AA Y:00 S:F9 P:NvUbdIzC&nbsp; &nbsp; &nbsp; &nbsp;$CD55: 60&nbsp; &nbsp; &nbsp; &nbsp; RTS (from $CD2F) ---------------------------</div><br /><br />So, the fix is not with CC65. The problem is that you have not initialized <em>sp</em>, which must be done by your CRT startup before entering <em>main</em>. I don't know whose CRT startup you are using, so I can't tell you where to fix it.<br /><br />See line 100 here (in CC65's included NES CRT), and make sure the same gets done in your startup: <a href="https://github.com/cc65/cc65/blob/master/libsrc/nes/crt0.s" class="postlink">https://github.com/cc65/cc65/blob/master/libsrc/nes/crt0.s</a>

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
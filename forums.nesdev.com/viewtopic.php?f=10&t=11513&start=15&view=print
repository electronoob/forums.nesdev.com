<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr" lang="en-gb">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Language" content="en-gb">
<title>nesdev.com :: View topic - KIL opcodes and such</title>

<style type="text/css">
<!--

body {
	font-family: Verdana,serif;
	font-size: 10pt;
}

img {
	border: 0;
}

td {
	font-family: Verdana,serif;
	font-size: 10pt;
	line-height: 150%;
}

.code, .codecontent, 
.quote, .quotecontent {
	margin: 0 5px 0 5px;
	padding: 5px;
	font-size: smaller;
	border: black solid 1px;
}

.quotetitle {
	color: black;
	display : block;
	font-weight: bold;
}

.forum {
	font-family: Arial,Helvetica,sans-serif;
	font-weight: bold;
	font-size: 18pt;
}

.topic {
	font-family: Arial,Helvetica,sans-serif;
	font-size: 14pt;
	font-weight: bold;
}

.gensmall {
	font-size: 8pt;
}

hr {
	color: #888;
	height: 3px;
	border-style: solid;
}

hr.sep {
	color: #aaa;
	height: 1px;
	border-style: dashed;
}
//-->
</style>

</head>
<body>

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td colspan="2" align="center"><span class="Forum">nesdev.com</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/">http://forums.nesdev.com/</a></span></td>
</tr>
<tr>
	<td colspan="2"><br /></td>
</tr>
<tr>
	<td><span class="topic">KIL opcodes and such</span><br /><span class="gensmall"><a href="http://forums.nesdev.com/viewtopic.php?f=10&amp;t=11513">http://forums.nesdev.com/viewtopic.php?f=10&amp;t=11513</a></span></td>
	<td align="right" valign="bottom"><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
</tr>
</table>



	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Mon Aug 11, 2014 5:33 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent"><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">They're just like drugs, they're illegal and they're not cool.</div><br />The legality of drugs varies from place to place.</div><br />It's hard to just move away from the UN Single Convention on Narcotic Drugs.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Alcohol is legal everywhere.</div><br />Not in most of the Muslim world.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">when you use illegal/undocumented/unofficial opcodes to noticeably improve your program, you're risking compatibility with clones and such, which might not support said opcodes.</div><br />Any more so than when you use 4-screen mirroring?

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tokumaru</b> [ Mon Aug 11, 2014 5:38 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">Not in most of the Muslim world.</div><br />I knew I should've written &quot;almost everywhere&quot;!<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Any more so than when you use 4-screen mirroring?</div><br />About the same, I guess. I don't know specifically about NES clones and unofficial opcodes, but I remember people mentioning there were Atari 2600 clones that didn't like them.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Mon Aug 11, 2014 8:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes, I think &quot;unofficial&quot; is definitely the best term. &quot;Illegal&quot; is wrong, but not as wrong as &quot;undoccumented&quot;. The usage of them is mostly legacy back when their existance was relatively new (early 80s).<br /><br />And yes comparing unofficial opcodes to drugs is a bit silly I know. I just felt like doing this.<br /><br />Like you said programming should be about usefulness and/or efficiency, not about being cool. The unofficial opcodes are not terribly useful, at least I never found myself requiring those. Usually the stable ones just does too much stuff at once to be any useful.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mikaelmoizt</b> [ Mon Aug 11, 2014 9:29 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />After learning some basic (official) opcodes and how to use them you start to wonder why there is no<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">BRA ;Branch Always! Could ofcourse be simulated in different ways<br />PHX<br />PHY<br />CPS ; Compare stack pointer<br />NUA ;Null A..<br />NUY <br />NUX </div><br /><br />I guess I am not the first who had these or similar ideas <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Mon Aug 11, 2014 12:02 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />There's a lot of instructions I dream of when writing 6502. Most often I want an indexed STX/STY, and an INC for the accumulator. A short jump (your BRA) would be nice for saving a byte.<br /><br />x86 let you XOR a register with itself, which was the most compact way to load it with 0, just as good as your NUA but more powerful.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>koitsu</b> [ Mon Aug 11, 2014 2:09 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />65c02 addresses the lack of <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">inc a</tt>, 65816 addresses the desired indexing for <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">stx/sty</tt> (but only one addressing mode is supported: directpage,{x|y}).  Tellin' you guys, the 65816 spoils you.  It's hard to go back to 6502/65c02 once you've used it.<br /><br />The primary thing I wish 65xxx had were integer multiplication and division opcodes, e.g. <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">imul/idiv</tt> on the x86.  That's pretty much the only thing I've ever wanted (on 65816), and the SNES/SFC has those memory-mapped registers for such (though they take a while, something like 20 cycles before you get a result?).<br /><br />Anyway, all that's off-topic...

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Drag</b> [ Mon Aug 11, 2014 5:01 pm ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />I see how undocumented opcodes can be useful, but unless I'm doing some kind of demoscene-esque demo, I prefer to code the &quot;correct&quot; way and rely on other tricks instead, especially because I'm more concerned with the code <em>working</em> than I am with saving a byte in a potentially dangerous way.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>Bregalad</b> [ Tue Aug 12, 2014 2:19 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Most often I want an indexed STX/STY</div><br />This exists, but only on zero-page.<br /><br />For branch always, in 80% of the cases there is another flag that you can know it's state and do a &quot;fake&quot; conditional branching (i.e. BCC with carry always = 0, etc..). However, it's very vulnerable to problems with former modification of the code.<br /><br />Same with INC A, you can often use simply use ADC #$01 or ADC #$00 if you know the state of the carry.<br /><br />Opcodes I've also been wishing (but that unofficial opcodes doesn't help with unfortunately) : <strong>LDX/LDY indexed with the same register, and NEG A</strong>.<br /><br />LDX $blabla,X<br />LDY $blabla,Y<br /><br />I don't know what's wrong in indexing with a register, and then scrapping the index with a new value. Apparently, MOSTEC decided it was worthless, but I find myself always doing a<br /><br />LDA $blabla,X<br />TAX<br /><br />As for <strong>NEG A</strong> (two's complement A), doing this :<br /><br />EOR #$ff<br />CLC<br />ADC #$01<br /><br />is tedious and wastes 5 bytes (and overwrites the carry) for a very simple operation.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Aug 12, 2014 6:17 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Yes of course there is indexed STX/STY on the zeropage, but obviously that's not what I wish for. <img src="./images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />In general I try not to make a habit of assuming the state of a flag, mainly for the reason you mentioned. I need to push things around now and then, and it's easy to lose track of this kind of thing. When I do feel the need, I try to comment it something like: <tt style="margin-left: 2px; margin-right: 2px; padding:3px; background-color: #3355aa; color: white;">;clc ; already clear</tt><br /><br />Most of the code I write might run once or twice per frame at most. Saving two cycles isn't much of an issue. Saving a byte could be, though. As such I would usually reserve the use of illegal opcodes and assumed flags for inner loops and very often called code, or for when I've actually identified a performance problem. The rest of the time I'd rather have code that's easy to read/edit.<br /><br />Though, illegal opcodes don't really hinder readability, just portability. Would you rather your code run on more obscure emulators that haven't implemented these opcodes, or save a few bytes/cycles? I could go either way on this decision, depending on the situation.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Aug 12, 2014 6:39 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Nestest tests the most useful unofficial opcodes. Avoiding known capabilities of the NES hardware for the sake of compatibility with emulators that don't even pass nestest is like avoiding HTML capabilities for the sake of compatibility with Internet Explorer 8. Everybody who owns a computer running supported Windows is eligible for an upgrade to at least IE 9, and everybody who owns a computer running even the most recently end-of-lifed Windows (that is, Windows XP) still has access to Firefox and Chr...oh wait this isn't Slashdot. Let me just say that any platform with FCEUX should be able to run it, and any platform with support for USB joysticks has FCEUX.<br /><br />Saving bytes can help a great deal when trying to pack the last few features into NROM, especially if you can find several dozen places where you can LAX or AXS.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Aug 12, 2014 7:07 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />Neither VirtuaNSF nor NEZPlug++ supports illegal opcodes and they are two of the most popular NSF players.<br /><br />I would bet there's more than one popular NES emulator on more obscure targets (e.g. video game consoles, cell phones) that doesn't support them.<br /><br />I'm not too concerned about Windows users, but even still, when a ROM doesn't run, <em>especially</em> a homebrew, users are very likely to blame the ROM before they blame their emulator.<br /><br />Sometimes you don't have much of a choice on which emulator to use, and a lot of times the choice is made for other reasons (nicest interface) than accuracy (why aren't we all playing games on nintendulator?).<br /><br />So, what I'm saying is that if I can spare, say, 150 bytes to avoid the issue, I am likely to do so. Or, more practically, I code first without considering fussy optimizations like this. When I run out of space/performance, then I start considering these tradeoffs. This often leaves me a nice buffer to work with when a project becomes tight near its conclusion, and at this point the design is very stable, so the maintainability issue becomes less important. On the other hand, if it never becomes tight, then it was never an issue and I didn't have to trade anything for it.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>tepples</b> [ Tue Aug 12, 2014 7:35 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">rainwarrior wrote:</div><div class="quotecontent">VirtuaNSF doesn't support illegal opcodes and it's one of the most popular NSF players.</div><br />What does it do when an unofficial opcode is executed, so that it can be detected?<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I would bet there's more than one popular NES emulator on more obscure targets (e.g. video game consoles, cell phones) that doesn't support them.</div><br />If a publisher has the resources to become a licensed developer for a video game console, it probably has the resources to improve an emulator to support the opcodes that nestest tests. For cell phones, I'm not aware of any that ship with a gamepad, and I had no end of problems trying to control a platformer with a virtual gamepad on my Nexus 7 tablet. Xperia Play is outdated and discontinued.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">I'm not too concerned about Windows users, but even still, when a ROM doesn't run, <em>especially</em> a homebrew, users are very likely to blame the ROM before they blame their emulator.</div><br />To continue the web JavaScript analogy: &quot;object detection&quot; and other forms of behavior detection are best practice there. A game that uses unofficial opcodes for speed could show a copyright notice for a couple seconds while testing the behavior of the opcodes it uses, but I grant that that doesn't work for space.<br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">Sometimes you don't have much of a choice on which emulator to use, and a lot of times the choice is made for other reasons (nicest interface) than accuracy (why aren't we all playing games on nintendulator?).</div><br />Someone who receives a bug report about a game not running on a particular emulator could have the user try running nestest on the same emulator and reporting the bug to the emulator's developer.<br /><br />But at some point you have to give up. There are emulators that can't run a very simple UNROM, as <a href="http://forums.nesdev.com/viewtopic.php?t=1179" class="postlink">I discovered in 2006</a> when I was developing an e-book reader to run on a DVD player.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Aug 12, 2014 7:45 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" />VirtuaNSF just increments the PC on an illegal opcode, as I recall, but its been a while since I tested it, and it's not open source.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>rainwarrior</b> [ Tue Aug 12, 2014 7:54 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">tepples wrote:</div><div class="quotecontent">If a publisher has the resources to become a licensed developer for a video game console, it probably has the resources to improve an emulator to support the opcodes that nestest tests.<br /><br />...<br /><br />Someone who receives a bug report about a game not running on a particular emulator could have the user try running nestest on the same emulator and reporting the bug to the emulator's developer.</div><br /><br />I'm talking about someone running a homebrew ROM here. I think most NES emulators that can run a user's ROMs aren't going to be licensed, and there are plenty of platforms where licensing isn't a requirement either.<br /><br />Bug reports are good only when:<br />1. users actually submit them<br />2. to somebody who will actually do something about them<br /><br />I love to get bug reports, and I try to submit them when I can, but I think people that do so are in the vast minority, unfortunately. Furthermore, there are lots of popular emulators that have long been abandoned, and there's nobody there to listen to bug reports anyway.

		

		</td>
	</tr>
	</table>


	<hr width="85%" />

	<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
	<tr>
		<td width="10%" nowrap="nowrap">Author:&nbsp;</td>
		<td><b>mikaelmoizt</b> [ Tue Aug 12, 2014 8:06 am ]</td>
	</tr>
	<tr>
		<td width="10%" nowrap="nowrap">Post subject:&nbsp;</td>
		<td><b>Re: KIL opcodes and such</b></td>
	</tr>
	<tr>
		<td colspan="2"><hr class="sep" /><div class="quotetitle">Bregalad wrote:</div><div class="quotecontent">LDX $blabla,X<br />LDY $blabla,Y<br /><br />I don't know what's wrong in indexing with a register, and then scrapping the index with a new value. Apparently, MOSTEC decided it was worthless  ...<br /></div><br /><br />Agreed. This would be a nice way of doing things. <br /><br />Also, it would be nice if I had a set of logical operations to be &quot;non destructive&quot; to acc. and just result in a flag. <br />But that might only be an unexperienced coder issue <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />So far, I am forced to do stupid things like this when checking joypad input because A gets changed when ANDed.<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">LDA somewhere<br />TAX<br />AND #something<br />BNE go some place<br />TXA <br />AND #something 2<br />BNE go somewhere else<br />TXA<br />AND #something 3<br />...<br /></div>

		

		</td>
	</tr>
	</table>


<hr width="85%" />

<table width="85%" cellspacing="3" cellpadding="0" border="0" align="center">
<tr>
	<td><span class="gensmall">Page <strong>2</strong> of <strong>3</strong></span></td>
	<td align="right"><span class="gensmall">All times are UTC - 7 hours </span></td>
</tr>
<tr>
	<td colspan="2" align="center"><span class="gensmall">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</span></td>
</tr>
</table>

</body>
</html>
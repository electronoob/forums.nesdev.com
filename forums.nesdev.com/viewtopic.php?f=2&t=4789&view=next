<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>nesdev.com &bull; View topic - Loading 16x16 Metatiles</title>

<link rel="alternate" type="application/atom+xml" title="Feed - nesdev.com" href="http://forums.nesdev.com/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://forums.nesdev.com/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://forums.nesdev.com/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://forums.nesdev.com/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://forums.nesdev.com/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - NESdev" href="http://forums.nesdev.com/feed.php?f=2" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Loading 16x16 Metatiles" href="http://forums.nesdev.com/feed.php?f=2&amp;t=4789" />

<link rel="stylesheet" href="./style.php?id=1&amp;lang=en" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
	</div>

	<div id="menubar">

		<table width="100%" cellspacing="0">
		<tr>
			<td rowspan="2"><a href="./index.php"><img src="./styles/subsilver2/imageset/site_logo.gif" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>nesdev.com</h1><span class="gen">NES Development and Strangulation Records message boards</span></td>
		</tr>
		<tr>
			<td align="center">
				<a href="./faq.php"><img src="./styles/prosilver/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php"><img src="./styles/prosilver/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
				<br />	
				 &nbsp;<a href="./ucp.php?mode=register"><img src="./styles/prosilver/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					&nbsp; &nbsp;<a href="./ucp.php?mode=login"><img src="./styles/prosilver/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp;
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Thu Aug 30, 2012 9:20 pm<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered">View unanswered posts</a> | <a href="./search.php?search_id=active_topics">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=2&amp;t=4801">Loading 16x16 Metatiles</a></h2>


	<p class="moderators">Moderator: <a href="./memberlist.php?mode=group&amp;g=320">Moderators</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=4801"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 13 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=2&amp;t=4801&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=2&amp;t=4801&amp;view=previous">Previous topic</a> | <a href="./viewtopic.php?f=2&amp;t=4801&amp;view=next">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42504"></a>
				<b class="postauthor">Roth</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42504">Loading 16x16 Metatiles</a></div><div style="float: right;"><a href="./viewtopic.php?p=42504#p42504"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 5:35 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://img.photobucket.com/albums/v287/I_am_Roth/stuff/roth.jpg" width="100" height="81" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Aug 03, 2005 3:15 pm<br /><b>Posts:</b> 362
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">For the past couple of days I've been trying to come up with a way to load 16x16 metatiles into the PPU. The only way I could imagine is to have a buffer that you load into prior to pulling it all to the screen. As it is right now, I am working on getting the top 256 tiles in the PPU. I've tried a few things, and so far this is getting me the best results, but it's still not displaying properly.
<br />
<br />What I am doing is grabbing the level number, which is in multiples of two, and getting the address from a table:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;jsr PPU_off<br />&nbsp; &nbsp;ldy game_level<br /><br />&nbsp; &nbsp;lda level_data_start,y<br />&nbsp; &nbsp;sta address_temp_lo<br />&nbsp; &nbsp;lda level_data_start+1,y<br />&nbsp; &nbsp;sta address_temp_hi<br /><br />; The table of word sized labels<br />level_data_start:<br />&nbsp; &nbsp;.addr board_1_1, board_1_2, board_1_3, board_1_4<br /></div><br /><br />After that, I am using a pointer to get the kind of block in the address (in this case, board_1_1).<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp;<br />&nbsp; &nbsp;ldy #$00<br />:&nbsp; &nbsp;lda &#40;address_temp_lo&#41;,y<br />&nbsp; &nbsp;sta get_block<br /></div><br /><br />After that, I do a couple of subroutines, one to grab the tile numbers from, which is also my first time dealing with jump tables, and the other routine sticks the tiles in a buffer located at $600. Then I increment Y, check it to be #$40, and go loading from the buffer at $600 to the PPU:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;jsr choose_block<br /><br />&nbsp; &nbsp;jsr do_block_buffer<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;cpy #$40<br />&nbsp; &nbsp;bne :-<br />&nbsp; &nbsp;inc address_temp_hi<br /><br />&nbsp; &nbsp;jsr do_top_nametable<br /><br />; ------------------------------------------<br /><br />choose_block:<br />&nbsp; &nbsp;lda get_block<br />&nbsp; &nbsp;asl a<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;lda block_types+1,x<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;lda block_types,x<br />&nbsp; &nbsp;pha<br />&nbsp; &nbsp;rts<br /><br />; Below is the table of addresses for what to do for each block<br />block_types:<br />&nbsp; &nbsp;.addr open_block-1<br />&nbsp; &nbsp;.addr stage1_solid_block-1<br />&nbsp; &nbsp;.addr electric_side_block-1<br />&nbsp; &nbsp;.addr stage2_solid_block-1<br />&nbsp; &nbsp;.addr electric_top_block-1<br /><br />; Here are the kind of things I do in those subroutines:<br />open_block:<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br />stage1_solid_block:<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;lda #$02<br />&nbsp; &nbsp;sta tile_2<br />; etc etc.... <br /><br />; Here is where the tiles are put into a buffer<br />do_block_buffer:<br />&nbsp; &nbsp;ldx metatile_index<br />&nbsp; &nbsp;lda tile_1<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;lda tile_2<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #31<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;lda tile_3<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;lda tile_4<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc #31<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;stx metatile_index<br />;&nbsp; &nbsp;bne :+<br />;&nbsp; &nbsp;inc metatile_index+1&nbsp; &nbsp; &nbsp;; I forgot to take this block out of the code<br />;:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ; edited now<br />&nbsp; &nbsp;rts<br /><br />; Pull it to the PPU<br /><br />do_top_nametable:<br />&nbsp; &nbsp;lda #$20<br />&nbsp; &nbsp;sta $2006<br />&nbsp; &nbsp;ldx #$00<br />&nbsp; &nbsp;sta $2006<br />:&nbsp; &nbsp;lda bg_buffer,x<br />&nbsp; &nbsp;sta $2007<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;bne :-<br />&nbsp; &nbsp;rts<br /></div>
<br />
<br />The left pic is what it looks like when I build it, and the right one is what it should look <em>similar</em> to (top 256 tiles):
<br />
<br /><img src="http://img.photobucket.com/albums/v287/I_am_Roth/web_examples/crappy_loading.png" alt="Image" /> <img src="http://robertlbryant.com/gaming/images/clik_ss0.png" alt="Image" />
<br />
<br />I can't figure out what is going on at all :/ If anyone can spot something I'm doing entirely wrong, let me know. This is getting pretty aggravating.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=174"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42507"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42507"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42507#p42507"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 6:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">You are overwriting the bottom row of the metatiles because of the way metatile_index is incremented. Think about it: after writing the last metatile of the first row, that "sbc #31" will try to place the pointer to the left of it, but since the row ended that will actually be the first tile of the next row of tiles, so the new row of metatiles overwrites the bottom half of the previous one.
<br />
<br />What you have to do is detect the end of a metatile row and add 32 to the index when that happens. Maybe you can fix it with this (between "tax" and "stx metatile_index"):
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;and #%00011111<br />&nbsp; &nbsp;bne :+<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #32<br />&nbsp; &nbsp;tax<br />:</div>
<br />
<br />EDIT: I just want to add that I think you are overcomplicating things, and wasting a lot of ROM by storing metatiles like that (as code, instead of just data). There are many ways you can make that code faster, smaller and simpler. If you want some tips for that, let us know.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42511"></a>
				<b class="postauthor">Roth</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42511"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42511#p42511"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:03 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://img.photobucket.com/albums/v287/I_am_Roth/stuff/roth.jpg" width="100" height="81" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Aug 03, 2005 3:15 pm<br /><b>Posts:</b> 362
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Well, I have switched those numbers to numerous things (the two 31's above). Because, I lay two tiles down, add 31 to that to get to the next row, then lay two tiles down. OHHHHHHH! Wait, after the whole first two rows are laid down, then the rest is getting over-written... crap. Okay. Because the first row goes down, then the second row, then the third row doesn't start on the third row, instead it starts on the second row... okay. Wow, how stupid haha Thanks for that : )
<br />
<br />About the way I store it, here is how I store the metatiles:
<br />
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">board_1_1:<br />&nbsp; &nbsp;.byte $01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01<br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br />&nbsp; &nbsp;.byte $01,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$01<br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br /><br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br />&nbsp; &nbsp;.byte $01,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$01<br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br />&nbsp; &nbsp;.byte $01,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$01<br /><br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br />&nbsp; &nbsp;.byte $01,$02,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$02,$01<br />&nbsp; &nbsp;.byte $01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01<br /><br />; This is how I define each metatile block:<br />open_block:<br />&nbsp; &nbsp;lda #$00<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br />stage1_solid_block:<br />&nbsp; &nbsp;lda #$01<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;lda #$02<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;lda #$03<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;lda #$04<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br />electric_side_block:<br />&nbsp; &nbsp;lda #$05<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;lda #$06<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br />stage2_solid_block:<br />&nbsp; &nbsp;lda #$07<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;lda #$08<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;lda #$09<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;lda #$0a<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br />electric_top_block:<br />&nbsp; &nbsp;lda #$0b<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;lda #$0c<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;sta tile_4<br />&nbsp; &nbsp;rts<br /><br /></div>
<br />
<br />The blocks are called from the jump table, and those are the only metatiles I have defined right now. If there is a better way, I am always open to suggestions!
<br />
<br />EDIT: Oh, and the fix didn't fix it, but after rereading your post and what-not, it finally clicked what was going on, so now I can mess with it some more. Thanks man : )</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=174"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42512"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42512"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42512#p42512"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:10 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Roth wrote:</div><div class="quotecontent">Oh, and the fix didn't fix it, but after rereading your post and what-not, it finally clicked what was going on, so now I can mess with it some more. Thanks man : )</div>
<br />Oh, there is a glitch in my fix! it should be:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">and #%00011111<br />&nbsp; &nbsp;bne :+<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #32<br />&nbsp; &nbsp;tax<br />:</div>
<br />Forgot the TXA! Maybe it will work now. The 31s you used should work fine.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42515"></a>
				<b class="postauthor">Roth</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42515"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42515#p42515"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:22 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://img.photobucket.com/albums/v287/I_am_Roth/stuff/roth.jpg" width="100" height="81" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Aug 03, 2005 3:15 pm<br /><b>Posts:</b> 362
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><span style="font-size: 200%; line-height: normal">: D</span>
<br />
<br /><img src="http://img.photobucket.com/albums/v287/I_am_Roth/web_examples/proper_loading_w00t.png" alt="Image" />
<br />
<br />You're a king man. Now I have to check this out and pick it apart. Every time ANDs and ORAs and EORs are involved, I have to look at things and think hard hehe</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=174"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42516"></a>
				<b class="postauthor">Dwedit</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42516"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42516#p42516"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:24 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=53.png" width="68" height="100" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Fri Nov 19, 2004 7:35 pm<br /><b>Posts:</b> 2547
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">AND: mask bits off
<br />ORA: turning bits on
<br />EOR: bit toggling</div>

					
						<div class="postbody"><br />_________________<br />Here come the fortune cookies!  Here come the fortune cookies!  They're wearing paper hats!</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=53"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42518"></a>
				<b class="postauthor">Celius</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42518"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42518#p42518"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:29 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://www.freewebs.com/the_bott/Avatar3.JPG" width="100" height="79" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Jun 05, 2005 2:04 pm<br /><b>Posts:</b> 2019<br /><b>Location:</b> Minneapolis, Minnesota, United States
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Even worse it BCC and BCS. I can never remember which one means Branch on Greater than or which means Branch on Less than. I think Tokumaru said once that it's easy to remember because if the carry has been cleared, M &gt; A because the 1 has been borrowed or something, and I loosely remember that.</div>

					
						<div class="postbody"><br />_________________<br /><a href="http://www.freewebs.com/the_bott/" class="postlink">-Owner of Poultry Games</a></div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=138"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42519"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42519"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42519#p42519"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 7:41 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">That "and #%00011111" is used to detect the end of a row. A row has 32 tiles, numbered 0 to 31. 31 in binary is 00011111, and if you add 1 to it, it becomes 00100000 (32 decimal). This means that every time a row ends, the lower 5 bits will switch from 11111 to 00000. The higher bits don't matter. When you AND 00011111 with another value, the result will only be 0 if all 5 bits of the value are 0, so the Z flag tells us if the row ended or not.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42520"></a>
				<b class="postauthor">tokumaru</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42520"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42520#p42520"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 8:11 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=95.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Feb 12, 2005 9:43 pm<br /><b>Posts:</b> 5251<br /><b>Location:</b> Rio de Janeiro - Brazil
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Now for some optimizations to your code! =)
<br />
<br />First, it's great that you understood the jump table + RTS trick, but this is hardly a good place to use it. All those metatile routines with lots of LDAs and STAs will cost you a nice chunk of ROM down the road. Instead of a table of routines, you could have 4 tables listing the tiles used by the metatiles:
<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; open<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; stage1_solid<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; |&nbsp; &nbsp; electric_side<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; |&nbsp; &nbsp; |&nbsp; &nbsp; &#40;...&#41;<br />tile1:<br />&nbsp; &nbsp; &nbsp; &nbsp; .db $00, $01, $05, &#40;...&#41;<br />tile2:<br />&nbsp; &nbsp; &nbsp; &nbsp; .db $00, $02, $05, &#40;...&#41;<br />tile3:<br />&nbsp; &nbsp; &nbsp; &nbsp; .db $00, $03, $06, &#40;...&#41;<br />tile4:<br />&nbsp; &nbsp; &nbsp; &nbsp; .db $00, $04, $06, &#40;...&#41;</div><br />That way, after "lda (address_temp_lo),y" you could read the tiles much faster with:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;tax<br />&nbsp; &nbsp;lda tile1, x<br />&nbsp; &nbsp;sta tile_1<br />&nbsp; &nbsp;lda tile2, x<br />&nbsp; &nbsp;sta tile_2<br />&nbsp; &nbsp;lda tile3, x<br />&nbsp; &nbsp;sta tile_3<br />&nbsp; &nbsp;lda tile4, x<br />&nbsp; &nbsp;sta tile_4</div>
<br />OK, but the next optimization is actually to get rid of the tile_1, tile_2, tile_3, tile_4 variables. There is no need for them when you can read the tiles directly from the table. In your <strong>do_block_buffer</strong> routine, you could just read from the tile tables directly, but you'll have to free either X or Y to do it. You could probably free Y, as it's just being used to read map data, so you could save it somewhere before copying the metatile to the buffer and restore it later.
<br />
<br />There are some other things you could do, such as use a smaller buffer, like 64 bytes for only 1 full row of metatiles, and draw rows one by one. This will come in handy when you decide to make scrolling games, because then you'll only be able to update single columns or rows of metatiles. Making the rendering system row/column oriented will help when that time comes. And it's actually an advantage to use a smaller buffer, because you'll have more free RAM.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=95"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42524"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42524"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42524#p42524"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 9:23 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9048<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">There are some other things you could do, such as use a smaller buffer, like 64 bytes for only 1 full row of metatiles, and draw rows one by one. This will come in handy when you decide to make scrolling games, because then you'll only be able to update single columns or rows of metatiles. Making the rendering system row/column oriented will help when that time comes. And it's actually an advantage to use a smaller buffer, because you'll have more free RAM.</div>
<br />But depending on how you decide to compress your maps and/or make the environment destructible, you may still need to keep a screen's worth of metatiles in RAM in order to do collision detection.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42527"></a>
				<b class="postauthor" style="color: #AA0000">tepples</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42527"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42527#p42527"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Jan 29, 2009 9:36 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://pineight.com/nes/terrible/PSRFX.png" width="100" height="56" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2004 11:12 pm<br /><b>Posts:</b> 9048<br /><b>Location:</b> NE Indiana, USA (NTSC)
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Celius wrote:</div><div class="quotecontent">Even worse it BCC and BCS. I can never remember which one means Branch on Greater than or which means Branch on Less than.</div>
<br />The Apple IIGS Hardware Reference included a copy of the 65C816 data sheet. This defined BLT as an alias for BCC, and BGE as an alias for BCS. (<a href="http://6502.org/documents/datasheets/wdc/" class="postlink">6502.org has a newer version as a PDF</a>; check page 38.) So yes, these mnemonics are canon, and <a href="http://www.cc65.org/doc/ca65-3.html#ss3.2" class="postlink">ca65 can be set to recognize them</a>.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=9"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p42538"></a>
				<b class="postauthor">MetalSlime</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42538"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42538#p42538"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 30, 2009 1:30 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=3632.jpg" width="62" height="66" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Tue Aug 19, 2008 11:01 pm<br /><b>Posts:</b> 186<br /><b>Location:</b> Japan
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">Celius wrote:</div><div class="quotecontent">Even worse it BCC and BCS. I can never remember which one means Branch on Greater than or which means Branch on Less than. I think Tokumaru said once that it's easy to remember because if the carry has been cleared, M &gt; A because the 1 has been borrowed or something, and I loosely remember that.</div>
<br />
<br />sorry to continue the threadjack, but I remember it like this:
<br />
<br />S is greater than C in the alphabet, so BCS is the "greater than" branch</div>

					
						<div class="postbody"><br />_________________<br />MetalSlime runs away.</div>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3632"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p42552"></a>
				<b class="postauthor">Roth</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> <a href="#p42552"></a></div><div style="float: right;"><a href="./viewtopic.php?p=42552#p42552"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Fri Jan 30, 2009 11:46 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td><img src="http://img.photobucket.com/albums/v287/I_am_Roth/stuff/roth.jpg" width="100" height="81" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Aug 03, 2005 3:15 pm<br /><b>Posts:</b> 362
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">EDIT: I have since figured out how to do the bottom portion of this post, though it is a bit ugly. I included a beq between the bcs and bne. Ugly I think, but works : P
<br />
<br /><strong>ORIGINAL POST:</strong>
<br /><div class="quotetitle">tokumaru wrote:</div><div class="quotecontent">Instead of a table of routines, you could have 4 tables listing the tiles used by the metatiles <strong>&lt;snip&gt;</strong> OK, but the next optimization is actually to get rid of the tile_1, tile_2, tile_3, tile_4 variables. There is no need for them when you can read the tiles directly from the table. In your <strong>do_block_buffer</strong> routine, you could just read from the tile tables directly, but you'll have to free either X or Y to do it. You could probably free Y, as it's just being used to read map data, so you could save it somewhere before copying the metatile to the buffer and restore it later.</div><br /><br />Ah, nice, that was pretty easy to implement, too!<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">tile_a:<br />&nbsp; &nbsp;.byte $00,$01,$05,$07,$0b<br />tile_b:<br />&nbsp; &nbsp;.byte $00,$02,$05,$08,$0c<br />tile_c:<br />&nbsp; &nbsp;.byte $00,$03,$06,$09,$0b<br />tile_d:<br />&nbsp; &nbsp;.byte $00,$04,$06,$0a,$0c<br /><br />do_block_buffer:<br />&nbsp; &nbsp;ldy get_block<br />&nbsp; &nbsp;ldx metatile_index<br />&nbsp; &nbsp;lda tile_a,y<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;lda tile_b,y<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #31<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;lda tile_c,y<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;inx<br />&nbsp; &nbsp;lda tile_d,y<br />&nbsp; &nbsp;sta bg_buffer,x<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;sec<br />&nbsp; &nbsp;sbc #31<br />&nbsp; &nbsp;tax<br />&nbsp; &nbsp;and #%00011111<br />&nbsp; &nbsp;bne :+<br />&nbsp; &nbsp;txa<br />&nbsp; &nbsp;clc<br />&nbsp; &nbsp;adc #32<br />&nbsp; &nbsp;tax<br />:&nbsp; &nbsp;stx metatile_index<br />&nbsp; &nbsp;rts<br /><br />; preserving Y after getting the block<br />&nbsp; &nbsp;ldy #$00<br />:&nbsp; &nbsp;lda &#40;address_temp_lo&#41;,y<br />&nbsp; &nbsp;sta get_block<br />&nbsp; &nbsp;tya<br />&nbsp; &nbsp;pha<br /><br />&nbsp; &nbsp;jsr do_block_buffer<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;tay<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;cpy #$40<br />; more code blah blah<br /></div><br /><br /><div class="quotetitle"><b>Quote:</b></div><div class="quotecontent">There are some other things you could do, such as use a smaller buffer, like 64 bytes for only 1 full row of metatiles, and draw rows one by one. This will come in handy when you decide to make scrolling games, because then you'll only be able to update single columns or rows of metatiles. Making the rendering system row/column oriented will help when that time comes. And it's actually an advantage to use a smaller buffer, because you'll have more free RAM.</div><br /><br />That sounds pretty interesting, but right now my focus is going to be on pulling the nametable in. Right now it's having problems doing both the top and middle portion at the same time, although it looks to me like it should be working fine. Correct me if I'm wrong, but should the BCS branch down to where I have it going, and the BNE should branch up, but if Y is 40, it should skip both of those and run the code to fill the top nametable?<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">&nbsp; &nbsp;ldy #$00<br />:&nbsp; &nbsp;lda &#40;address_temp_lo&#41;,y<br />&nbsp; &nbsp;sta get_block<br />&nbsp; &nbsp;tya<br />&nbsp; &nbsp;pha<br /><br />;&nbsp; &nbsp;jsr choose_block<br /><br />&nbsp; &nbsp;jsr do_block_buffer<br />&nbsp; &nbsp;pla<br />&nbsp; &nbsp;tay<br />&nbsp; &nbsp;iny<br />&nbsp; &nbsp;cpy #$40<br />&nbsp; &nbsp;bcs :+<br />&nbsp; &nbsp;bne :-<br /><br />&nbsp; &nbsp;inc address_temp_hi<br />&nbsp; &nbsp;jsr do_top_nametable<br />:<br />&nbsp; &nbsp;cpy #$80<br />&nbsp; &nbsp;bne :--<br />&nbsp; &nbsp;inc address_temp_hi<br />&nbsp; &nbsp;jsr do_middle_nametable<br /></div></div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=174"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=2&amp;t=4801"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=2"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=2&amp;t=4801"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 13 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php">Board index</a> &#187; <a href="./viewforum.php?f=24">NES / Famicom</a> &#187; <a href="./viewforum.php?f=2">NESdev</a></p>
			<p class="datetime">All times are UTC - 7 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: No registered users and 2 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="get" name="search" action="./search.php"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /><input type="hidden" name="t" value="4801" />
<input type="hidden" name="sf" value="msgonly" />
</form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="24">NES / Famicom</option>
		
			<option value="2" selected="selected">&nbsp; &nbsp;NESdev</option>
		
			<option value="3">&nbsp; &nbsp;NESemdev</option>
		
			<option value="21">&nbsp; &nbsp;NES Graphics</option>
		
			<option value="6">&nbsp; &nbsp;NES Music</option>
		
			<option value="9">&nbsp; &nbsp;NES Hardware and Flash Equipment</option>
		
			<option value="22">&nbsp; &nbsp;Homebrew Projects</option>
		
			<option value="10">&nbsp; &nbsp;Newbie Help Center</option>
		
			<option value="11">&nbsp; &nbsp;FCdev</option>
		
			<option value="18">&nbsp; &nbsp;NESdev China</option>
		
			<option value="19">&nbsp; &nbsp;NESdev International</option>
		
			<option value="25">Other</option>
		
			<option value="5">&nbsp; &nbsp;General Stuff</option>
		
			<option value="4">&nbsp; &nbsp;Membler Industries</option>
		
			<option value="12">&nbsp; &nbsp;SNESdev</option>
		
			<option value="20">&nbsp; &nbsp;GBDev</option>
		
			<option value="23">&nbsp; &nbsp;Other Retro Dev</option>
		
			<option value="15">&nbsp; &nbsp;Test Forum</option>
		
			<option value="26">Site Issues</option>
		
			<option value="13">&nbsp; &nbsp;phpBB Issues</option>
		
			<option value="14">&nbsp; &nbsp;Web Issues</option>
		
			<option value="16">&nbsp; &nbsp;nesdevWiki</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group
	</span>
</div>

</body>
</html>